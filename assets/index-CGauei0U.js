var Iw=Object.defineProperty;var jw=(t,e,r)=>e in t?Iw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var rt=(t,e,r)=>jw(t,typeof e!="symbol"?e+"":e,r);import{u as Hr,j as o,a as Vt,B as z,V as ce,T as E,b as Oe,c as Cn,A as Nv,d as Dv,e as Rv,H as le,f as wt,g as Ov,h as _v,M as Zr,i as Dr,k as Xr,l as Rr,m as Hn,n as Or,I as yt,o as zt,p as Lt,q as oo,r as tn,s as dc,L as Fv,t as Bt,D as on,S as kn,v as rn,F as Ye,w as Qe,x as Kt,y as Hu,z as Jd,C as nc,P as Xo,E as Qo,G as Ai,J as Yd,K as Pi,N as uc,O as hc,Q as Nt,W as Ra,R as Tw,U as sc,X as Gm,Y as vi,Z as Tt,_ as Zn,$ as ss,a0 as Xn,a1 as Ew,a2 as Qs,a3 as un,a4 as hn,a5 as mn,a6 as rs,a7 as ho,a8 as jo,a9 as Nn,aa as br,ab as mo,ac as fr,ad as Yn,ae as zc,af as Es,ag as Ms,ah as pr,ai as sn,aj as Wu,ak as On,al as hl,am as Ef,an as Vv,ao as $v,ap as Mf,aq as Kd,ar as zv,as as Lv,at as Mw,au as Ga,av as Hm,aw as Aw,ax as ds,ay as sl,az as Od,aA as ol,aB as Pw,aC as Ni,aD as Af,aE as Zd,aF as To,aG as Wm,aH as qm,aI as Jm,aJ as Ym,aK as Km,aL as Ls,aM as Ir,aN as Xd,aO as Nw,aP as Dw,aQ as Rw,aR as Ow,aS as _w,aT as hy,aU as Fw,aV as Vw,aW as $w,aX as zw,aY as Bv,aZ as Qd,a_ as Lw,a$ as Bw,b0 as Uw,b1 as Fr,b2 as Gw,b3 as Hw,b4 as Uv,b5 as Ww,b6 as Yo,b7 as qw,b8 as Jw}from"./chakra-C5xAv7Zk.js";import{a as Pf,r as M,b as nr,d as Yw,c as Gv,g as Kw}from"./vendor-CnbTAVxw.js";import{u as Zw,B as Xw,R as Qw,a as hd}from"./router-B-mtfNp1.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();var Zm={},my=Pf;Zm.createRoot=my.createRoot,Zm.hydrateRoot=my.hydrateRoot;const e3="modulepreload",t3=function(t){return"/"+t},py={},ir=function(e,r,n){let s=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(r.map(c=>{if(c=t3(c),c in py)return;py[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const m=document.createElement("link");if(m.rel=d?"stylesheet":e3,d||(m.as="script"),m.crossOrigin="",m.href=c,l&&m.setAttribute("nonce",l),document.head.appendChild(m),d)return new Promise((g,y)=>{m.addEventListener("load",g),m.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};class r3{constructor(){rt(this,"API_BASE_URL","https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent");rt(this,"COST_PER_1K_TOKENS",.001)}getApiKey(){return"AIzaSyAoHJU0sakeBGsKJ0TIOd7yeJAHyOHoVt0"}async query(e,r){var n,s,i,a,l,c,d;try{const u=this.getApiKey();console.log("[GeminiAIService] Context data being sent to AI:",{systemName:r.systemName,systemId:r.systemId,coreConcepts:{resolvedValueTypesCount:r.coreConcepts.resolvedValueTypes.length,dimensionsCount:r.coreConcepts.dimensions.length,modesCount:r.coreConcepts.modes.length,tokenCollectionsCount:r.coreConcepts.tokenCollections.length,aliasesCount:r.coreConcepts.aliases.length},data:{tokensCount:r.data.tokens.length,collectionsCount:r.data.collections.length,dimensionsCount:r.data.dimensions.length,componentsCount:r.data.components.length,taxonomiesCount:r.data.taxonomies.length},metadata:r.metadata});const m=`You are an expert design system assistant. You have access to a comprehensive design system with the following data (JSON):

${JSON.stringify(r,null,2)}

IMPORTANT: When answering questions about platform extensions, theme overrides, or token overrides, ALWAYS check the 'overrideSummary' section in the data. This section contains:
- platformOverrides: Array of platform override information with tokenOverridesCount and tokenOverrides arrays
- themeOverrides: Array of theme override information with tokenOverridesCount and tokenOverrides arrays  
- totalPlatformOverrides: Total count of platform token overrides
- totalThemeOverrides: Total count of theme token overrides

If the data contains an overrideSummary, use it to provide accurate information about overrides.

Question: ${e}

Please provide a clear, helpful response based on the available design system data.`,g=this.estimateTokenCount(m),y=this.estimateCost(g);if(!this.checkBudget(y))throw new Error("Monthly budget exceeded. Please try again next month or increase your budget.");const v=await fetch(`${this.API_BASE_URL}?key=${u}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:m}]}],generationConfig:{temperature:.3,maxOutputTokens:1e3,topP:.8,topK:40}})});if(!v.ok){const A=await v.json();throw new Error(`Gemini API error: ${((n=A.error)==null?void 0:n.message)||"Unknown error"}`)}const I=await v.json(),S=((c=(l=(a=(i=(s=I.candidates)==null?void 0:s[0])==null?void 0:i.content)==null?void 0:a.parts)==null?void 0:l[0])==null?void 0:c.text)||"No response received",b=((d=I.usageMetadata)==null?void 0:d.totalTokenCount)||g,k=this.calculateCost(b,0);return{answer:S,cost:k,tokensUsed:b,confidence:.8}}catch(u){throw console.error("[GeminiAIService] Query failed:",u),u}}buildContext(e){const r=e.dimensions.flatMap(s=>s.modes.map(i=>({dimensionId:s.id,modeId:i.id,name:i.name}))),n=e.tokens.filter(s=>s.valuesByMode&&Object.values(s.valuesByMode).some(i=>typeof i=="object"&&i&&"tokenId"in i)).map(s=>{const i=Object.values(s.valuesByMode).find(a=>typeof a=="object"&&a&&"tokenId"in a);return{tokenId:s.id,referencedTokenId:i==null?void 0:i.tokenId}});return{systemName:e.systemName,systemId:e.systemId,coreConcepts:{resolvedValueTypes:e.resolvedValueTypes||[],dimensions:e.dimensions,modes:r,tokenCollections:e.tokenCollections||[],aliases:n},data:{tokens:e.tokens,collections:e.tokenCollections||[],dimensions:e.dimensions,components:e.components||[],taxonomies:e.taxonomies||[]},metadata:{tokenCount:e.tokens.length,collectionCount:(e.tokenCollections||[]).length,dimensionCount:e.dimensions.length,componentCount:(e.components||[]).length},overrideSummary:e.overrideSummary}}estimateCost(e){return e/1e3*this.COST_PER_1K_TOKENS}checkBudget(e){return this.getCurrentMonthlyUsage()+e<=5}buildPrompt(e,r){return`You are an AI assistant for a design system application. You have access to the following design system data:

SYSTEM INFORMATION:
- System Name: ${r.systemName}
- System ID: ${r.systemId}

CORE CONCEPTS:
1. Resolved Value Types: These are fundamental types like "color", "font", "gap", "shadow" that correspond to UI development value types.
   Available types: ${r.coreConcepts.resolvedValueTypes.map(n=>n.displayName).join(", ")}

2. Dimensions: Groups of mutually exclusive modes with a common conceptual theme.
   Available dimensions: ${r.coreConcepts.dimensions.map(n=>n.displayName).join(", ")}

3. Modes: Specific options within a dimension. Each mode exists only within its parent dimension.
   Available modes: ${r.coreConcepts.modes.map(n=>`${n.name} (${n.dimensionId})`).join(", ")}

4. Token Collections: Categorization groups that can contain multiple resolved value types.
   Available collections: ${r.coreConcepts.tokenCollections.map(n=>n.name).join(", ")}

5. Aliases: Tokens that reference other tokens. The resolved value type of an alias matches the referenced token.
   Aliases: ${r.coreConcepts.aliases.map(n=>`${n.tokenId} â†’ ${n.referencedTokenId}`).join(", ")}

DATA SUMMARY:
- ${r.metadata.tokenCount} tokens
- ${r.metadata.collectionCount} collections
- ${r.metadata.dimensionCount} dimensions
- ${r.metadata.componentCount} components

USER QUESTION: ${e}

Please provide a helpful, contextual response about this design system. Focus on the specific concepts and data available. If the question is about something not in the data, explain what information would be needed to answer it.

Response:`}estimateTokenCount(e){return Math.ceil(e.length/4)}calculateCost(e,r){return(e+r)/1e3*this.COST_PER_1K_TOKENS}getCurrentMonthlyUsage(){try{const e=localStorage.getItem("gemini-ai:monthly-usage");if(e){const r=JSON.parse(e),n=new Date().toISOString().slice(0,7);if(r.month===n)return r.cost||0}return 0}catch(e){return console.error("[GeminiAIService] Error reading monthly usage:",e),0}}}const n3=new r3;class s3{constructor(){rt(this,"MAX_CONTEXT_TOKENS",8e3);rt(this,"COST_PER_1K_TOKENS",.001)}buildDesignSystemContext(e){var n,s,i,a,l,c,d,u,m,g;console.log("[GeminiContextBuilder] Building context from design system:",{systemName:e.systemName,systemId:e.systemId,tokensCount:((n=e.tokens)==null?void 0:n.length)||0,collectionsCount:((s=e.tokenCollections)==null?void 0:s.length)||0,dimensionsCount:((i=e.dimensions)==null?void 0:i.length)||0,componentsCount:((a=e.components)==null?void 0:a.length)||0,taxonomiesCount:((l=e.taxonomies)==null?void 0:l.length)||0,resolvedValueTypesCount:((c=e.resolvedValueTypes)==null?void 0:c.length)||0,platformsCount:((d=e.platforms)==null?void 0:d.length)||0,themesCount:((u=e.themes)==null?void 0:u.length)||0,componentCategoriesCount:((m=e.componentCategories)==null?void 0:m.length)||0,componentPropertiesCount:((g=e.componentProperties)==null?void 0:g.length)||0});const r=this.buildFullContext(e);return this.optimizeForCost(r)}buildFullContext(e){const r=e.dimensions.flatMap(a=>a.modes.map(l=>({dimensionId:a.id,modeId:l.id,name:l.name}))),n=this.extractAliases(e.tokens),i=e.overrideSummary;return console.log("[GeminiContextBuilder] Building full context with overrideSummary:",{hasOverrideSummary:!!i,overrideSummary:i}),{systemName:e.systemName,systemId:e.systemId,coreConcepts:{resolvedValueTypes:e.resolvedValueTypes||[],dimensions:e.dimensions,modes:r,tokenCollections:e.tokenCollections||[],aliases:n},data:{tokens:e.tokens,collections:e.tokenCollections||[],dimensions:e.dimensions,components:e.components||[],taxonomies:e.taxonomies||[]},metadata:{tokenCount:e.tokens.length,collectionCount:(e.tokenCollections||[]).length,dimensionCount:e.dimensions.length,componentCount:(e.components||[]).length},overrideSummary:i}}buildCoreConceptsContext(e){const r=e.resolvedValueTypes||[],n=e.dimensions,s=n.flatMap(l=>l.modes.map(c=>({dimensionId:l.id,modeId:c.id,name:c.name}))),i=e.tokenCollections||[],a=this.extractAliases(e.tokens);return{resolvedValueTypes:r,dimensions:n,modes:s,tokenCollections:i,aliases:a}}optimizeForCost(e){const r={...e};return this.estimateContextSize(r)>this.MAX_CONTEXT_TOKENS&&(r.data={tokens:this.prioritizeTokens(e.data.tokens),collections:e.data.collections.slice(0,10),dimensions:e.data.dimensions,components:e.data.components.slice(0,20),taxonomies:e.data.taxonomies.slice(0,5)},console.log("[GeminiContextBuilder] Context optimized, preserving overrideSummary:",{hasOverrideSummary:!!r.overrideSummary,overrideSummary:r.overrideSummary})),r}extractAliases(e){return e.filter(r=>r.valuesByMode&&Object.values(r.valuesByMode).some(n=>typeof n=="object"&&n&&"tokenId"in n)).map(r=>{const n=Object.values(r.valuesByMode).find(s=>typeof s=="object"&&s&&"tokenId"in s);return{tokenId:r.id,referencedTokenId:n==null?void 0:n.tokenId}})}prioritizeTokens(e){const r=[...e];return r.sort((n,s)=>{const i=n.tokenCollectionId?1:0;return(s.tokenCollectionId?1:0)-i}),r.slice(0,50)}estimateContextSize(e){const r=JSON.stringify(e);return Math.ceil(r.length/4)}calculateCost(e){return this.estimateContextSize(e)/1e3*this.COST_PER_1K_TOKENS}isContextWithinBudget(e){const r=this.calculateCost(e);return this.getCurrentMonthlyUsage()+r<=5}getCurrentMonthlyUsage(){try{const e=localStorage.getItem("gemini-ai:monthly-usage");if(e){const r=JSON.parse(e),n=new Date().toISOString().slice(0,7);if(r.month===n)return r.cost||0}return 0}catch(e){return console.error("[GeminiContextBuilder] Error reading monthly usage:",e),0}}}const fy=new s3;class o3{constructor(){rt(this,"COST_PER_1K_TOKENS",.001);rt(this,"MONTHLY_BUDGET",5);rt(this,"STORAGE_KEY","gemini-ai:monthly-usage");rt(this,"SETTINGS_KEY","gemini-ai:budget-settings")}calculateCost(e,r){return(e+r)/1e3*this.COST_PER_1K_TOKENS}checkBudget(e){return this.getCurrentMonthlyUsage()+e<=this.MONTHLY_BUDGET}trackUsage(e,r){try{const n=new Date().toISOString().slice(0,7),s=localStorage.getItem(this.STORAGE_KEY);let i;s?(i=JSON.parse(s),i.month!==n&&(i={month:n,queries:[],totalCost:0,queryCount:0})):i={month:n,queries:[],totalCost:0,queryCount:0},i.queries.push({query:e.substring(0,100),cost:r,timestamp:new Date().toISOString()}),i.totalCost+=r,i.queryCount+=1,i.queries.length>100&&(i.queries=i.queries.slice(-100)),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(i)),this.checkBudgetAlerts(i.totalCost),console.log(`[GeminiCostManager] Usage tracked: $${r.toFixed(4)} (Total: $${i.totalCost.toFixed(4)})`)}catch(n){console.error("[GeminiCostManager] Error tracking usage:",n)}}getCurrentMonthlyUsage(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const r=JSON.parse(e),n=new Date().toISOString().slice(0,7);if(r.month===n)return r.totalCost||0}return 0}catch(e){return console.error("[GeminiCostManager] Error reading monthly usage:",e),0}}getUsageMetrics(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const r=JSON.parse(e),n=new Date().toISOString().slice(0,7);if(r.month===n&&r.queryCount>0)return{monthlyQueries:r.queryCount,monthlyCost:r.totalCost,averageTokensPerQuery:this.estimateAverageTokens(r.queries),costPerQuery:r.totalCost/r.queryCount}}return{monthlyQueries:0,monthlyCost:0,averageTokensPerQuery:0,costPerQuery:0}}catch(e){return console.error("[GeminiCostManager] Error getting usage metrics:",e),{monthlyQueries:0,monthlyCost:0,averageTokensPerQuery:0,costPerQuery:0}}}getBudgetSettings(){try{const e=localStorage.getItem(this.SETTINGS_KEY);if(e)return JSON.parse(e)}catch(e){console.error("[GeminiCostManager] Error reading budget settings:",e)}return{monthlyBudget:this.MONTHLY_BUDGET,costAlerts:!0,autoFallback:!0}}updateBudgetSettings(e){try{const n={...this.getBudgetSettings(),...e};localStorage.setItem(this.SETTINGS_KEY,JSON.stringify(n)),console.log("[GeminiCostManager] Budget settings updated:",n)}catch(r){console.error("[GeminiCostManager] Error updating budget settings:",r)}}resetMonthlyUsage(){try{localStorage.removeItem(this.STORAGE_KEY),console.log("[GeminiCostManager] Monthly usage reset")}catch(e){console.error("[GeminiCostManager] Error resetting monthly usage:",e)}}getBudgetStatus(){const e=this.getCurrentMonthlyUsage(),r=this.getBudgetSettings().monthlyBudget,n=Math.max(0,r-e),s=e/r*100,i=e>r;return{currentUsage:e,budget:r,remaining:n,percentageUsed:s,isOverBudget:i}}checkBudgetAlerts(e){const r=this.getBudgetSettings().monthlyBudget,n=e/r*100;n>=80&&n<90&&(console.warn(`[GeminiCostManager] Budget warning: ${n.toFixed(1)}% of monthly budget used`),this.showBudgetAlert("warning",`You've used ${n.toFixed(1)}% of your monthly budget.`)),n>=90&&n<100&&(console.warn(`[GeminiCostManager] Budget alert: ${n.toFixed(1)}% of monthly budget used`),this.showBudgetAlert("error",`You've used ${n.toFixed(1)}% of your monthly budget. Consider reducing usage.`)),n>=100&&(console.error(`[GeminiCostManager] Budget exceeded: ${n.toFixed(1)}% of monthly budget used`),this.showBudgetAlert("error","Monthly budget exceeded. AI features will be disabled until next month."))}showBudgetAlert(e,r){window.dispatchEvent(new CustomEvent("gemini-ai:budget-alert",{detail:{type:e,message:r}}))}estimateAverageTokens(e){if(e.length===0)return 0;const n=e.reduce((s,i)=>s+i.cost,0)/e.length;return Math.round(n/this.COST_PER_1K_TOKENS*1e3)}isFeatureAvailable(){return!this.getBudgetStatus().isOverBudget}getNextResetDate(){const e=new Date;return new Date(e.getFullYear(),e.getMonth()+1,1)}}const Ho=new o3,i3=["COLOR","DIMENSION","SPACING","FONT_FAMILY","FONT_WEIGHT","FONT_SIZE","LINE_HEIGHT","LETTER_SPACING","DURATION","CUBIC_BEZIER","BLUR","SPREAD","RADIUS"];function a3(){return i3.map(t=>{const e=t.toLowerCase().replace(/_/g,"-"),r=t.toLowerCase().replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase());return{id:e,displayName:r,type:t}})}const Hv=a3();console.debug("[StorageService] Initialized default value types:",Hv);const Gt={TOKENS:"token-model:tokens",COLLECTIONS:"token-model:collections",MODES:"token-model:modes",VALUE_TYPES:"token-model:value-types",DIMENSIONS:"token-model:dimensions",DIMENSION_ORDER:"token-model:dimension-order",PLATFORMS:"token-model:platforms",THEMES:"token-model:themes",TAXONOMIES:"token-model:taxonomies",TAXONOMY_ORDER:"token-model:taxonomy-order",ALGORITHMS:"token-model:algorithms",ALGORITHM_FILE:"token-model:algorithm-file",ROOT_DATA:"token-model:root-data",LINKED_REPOSITORIES:"token-model:linked-repositories",PLATFORM_EXTENSIONS:"token-model:platform-extensions",THEME_OVERRIDES:"token-model:theme-overrides",PLATFORM_EXTENSION_FILES:"token-model:platform-extension-files",FIGMA_CONFIGURATION:"token-model:figma-configuration",COMPONENT_PROPERTIES:"token-model:component-properties",COMPONENT_CATEGORIES:"token-model:component-categories",COMPONENTS:"token-model:components",CORE_DATA:"token-model:core-data",PLATFORM_EXTENSION_DATA:"token-model:platform-extension-data",THEME_OVERRIDE_DATA:"token-model:theme-override-data",PRESENTATION_DATA:"token-model:presentation-data",SOURCE_SNAPSHOT:"token-model:source-snapshot",LOCAL_EDITS:"token-model:local-edits",MERGED_DATA:"token-model:merged-data",SOURCE_CONTEXT:"token-model:source-context"};class L{static getItem(e,r){try{const n=localStorage.getItem(e);return n?JSON.parse(n):r}catch(n){return console.error(`[StorageService] Error parsing item for key ${e}:`,n),r}}static setItem(e,r){localStorage.setItem(e,JSON.stringify(r))}static getTokens(){return this.getItem(Gt.TOKENS,[])}static setTokens(e){localStorage.setItem(Gt.TOKENS,JSON.stringify(e))}static getCollections(){return this.getItem(Gt.COLLECTIONS,[])}static setCollections(e){localStorage.setItem(Gt.COLLECTIONS,JSON.stringify(e))}static getModes(){return this.getItem(Gt.MODES,[])}static setModes(e){localStorage.setItem(Gt.MODES,JSON.stringify(e))}static getValueTypes(){if(this.valueTypesCache!==null)return this.valueTypesCache;const e=this.getItem(Gt.VALUE_TYPES,Hv);return console.debug("[StorageService] Retrieved value types:",e),this.valueTypesCache=e,e}static setValueTypes(e){console.debug("[StorageService] Setting value types:",e),localStorage.setItem(Gt.VALUE_TYPES,JSON.stringify(e)),this.valueTypesCache=null}static getDimensions(){return this.getItem(Gt.DIMENSIONS,[])}static setDimensions(e){localStorage.setItem(Gt.DIMENSIONS,JSON.stringify(e))}static getDimensionOrder(){return this.getItem(Gt.DIMENSION_ORDER,[])}static setDimensionOrder(e){localStorage.setItem(Gt.DIMENSION_ORDER,JSON.stringify(e))}static getPlatforms(){return this.getItem(Gt.PLATFORMS,[])}static setPlatforms(e){localStorage.setItem(Gt.PLATFORMS,JSON.stringify(e))}static getThemes(){return this.getItem(Gt.THEMES,[])}static setThemes(e){localStorage.setItem(Gt.THEMES,JSON.stringify(e))}static getTaxonomies(){return this.getItem(Gt.TAXONOMIES,[])}static setTaxonomies(e){localStorage.setItem(Gt.TAXONOMIES,JSON.stringify(e))}static getTaxonomyOrder(){return this.getItem(Gt.TAXONOMY_ORDER,[])}static setTaxonomyOrder(e){const r=this.getTaxonomies(),n=new Set(r.map(i=>i.id)),s=e.filter(i=>n.has(i));s.length!==e.length&&console.warn("[StorageService] Removed invalid taxonomy IDs from taxonomy order:",e.filter(i=>!n.has(i))),this.setItem(Gt.TAXONOMY_ORDER,s)}static getAlgorithms(){return this.getItem(Gt.ALGORITHMS,[])}static setAlgorithms(e){this.setItem(Gt.ALGORITHMS,e)}static getAlgorithmFile(){const e=localStorage.getItem(Gt.ALGORITHM_FILE);return e?JSON.parse(e):null}static setAlgorithmFile(e){this.setItem(Gt.ALGORITHM_FILE,e)}static getRootData(){return this.getItem(Gt.ROOT_DATA,{})}static setRootData(e){this.setItem(Gt.ROOT_DATA,e)}static getLinkedRepositories(){return this.getItem(Gt.LINKED_REPOSITORIES,[])}static setLinkedRepositories(e){this.setItem(Gt.LINKED_REPOSITORIES,e)}static getPlatformExtensions(){return this.getItem(Gt.PLATFORM_EXTENSIONS,{})}static setPlatformExtensions(e){this.setItem(Gt.PLATFORM_EXTENSIONS,e)}static getThemeOverrides(){return this.getItem(Gt.THEME_OVERRIDES,null)}static setThemeOverrides(e){this.setItem(Gt.THEME_OVERRIDES,e)}static getFigmaConfiguration(){return this.getItem(Gt.FIGMA_CONFIGURATION,null)}static setFigmaConfiguration(e){this.setItem(Gt.FIGMA_CONFIGURATION,e)}static getPlatformExtensionFiles(){return this.getItem(Gt.PLATFORM_EXTENSION_FILES,{})}static setPlatformExtensionFiles(e){this.setItem(Gt.PLATFORM_EXTENSION_FILES,e)}static getPlatformExtensionFile(e){return this.getPlatformExtensionFiles()[e]||null}static setPlatformExtensionFile(e,r){const n=this.getPlatformExtensionFiles();n[e]=r,this.setPlatformExtensionFiles(n)}static removePlatformExtensionFile(e){const r=this.getPlatformExtensionFiles();delete r[e],this.setPlatformExtensionFiles(r)}static getPlatformExtensionFileContent(e){const r=`token-model:platform-extension-file:${e}`;return localStorage.getItem(r)}static setPlatformExtensionFileContent(e,r){const n=`token-model:platform-extension-file:${e}`;localStorage.setItem(n,r)}static removePlatformExtensionFileContent(e){const r=`token-model:platform-extension-file:${e}`;localStorage.removeItem(r)}static getComponentProperties(){return this.getItem(Gt.COMPONENT_PROPERTIES,[])}static setComponentProperties(e){this.setItem(Gt.COMPONENT_PROPERTIES,e)}static getComponentCategories(){return this.getItem(Gt.COMPONENT_CATEGORIES,[])}static setComponentCategories(e){this.setItem(Gt.COMPONENT_CATEGORIES,e)}static getComponents(){return this.getItem(Gt.COMPONENTS,[])}static setComponents(e){this.setItem(Gt.COMPONENTS,e)}static clearAll(){const e=localStorage.getItem("github_token_encrypted"),r=localStorage.getItem("github_user"),n=localStorage.getItem("github_repo");localStorage.clear(),e&&localStorage.setItem("github_token_encrypted",e),r&&localStorage.setItem("github_user",r),n&&localStorage.setItem("github_repo",n),this.valueTypesCache=null}static clearSchemaData(){Object.values(Gt).forEach(e=>{localStorage.removeItem(e)}),this.valueTypesCache=null}static getCoreData(){return this.getItem(Gt.CORE_DATA,null)}static setCoreData(e){this.setItem(Gt.CORE_DATA,e)}static getPlatformExtensionData(e){const r=this.getStorageKey("platform-extension",e);return this.getItem(r,null)}static setPlatformExtensionData(e,r){const n=this.getStorageKey("platform-extension",e);this.setItem(n,r)}static getAllPlatformExtensionData(){const e={},r=this.getPlatformExtensions();return Object.keys(r).forEach(n=>{const s=this.getPlatformExtensionData(n);s&&(e[n]=s)}),e}static getThemeOverrideData(e){const r=this.getStorageKey("theme-override",e);return this.getItem(r,null)}static setThemeOverrideData(e,r){const n=this.getStorageKey("theme-override",e);this.setItem(n,r)}static getAllThemeOverrideData(){const e={};return this.getThemes().forEach(n=>{const s=this.getThemeOverrideData(n.id);s&&(e[n.id]=s)}),e}static getPresentationData(){return this.getItem(Gt.PRESENTATION_DATA,null)}static setPresentationData(e){this.setItem(Gt.PRESENTATION_DATA,e)}static clearSchemaStorage(){localStorage.removeItem(Gt.CORE_DATA);const e=this.getPlatformExtensions();Object.keys(e).forEach(n=>{const s=this.getStorageKey("platform-extension",n);localStorage.removeItem(s)}),this.getThemes().forEach(n=>{const s=this.getStorageKey("theme-override",n.id);localStorage.removeItem(s)}),localStorage.removeItem(Gt.PRESENTATION_DATA)}static getStorageKey(e,r){switch(e){case"core":return Gt.CORE_DATA;case"platform-extension":return`${Gt.PLATFORM_EXTENSION_DATA}:${r}`;case"theme-override":return`${Gt.THEME_OVERRIDE_DATA}:${r}`;default:throw new Error(`Unknown storage type: ${e}`)}}static getPendingOverrides(e,r){const n=`token-model:pending-overrides:${e}:${r}`;return this.getItem(n,[])}static setPendingOverrides(e,r,n){const s=`token-model:pending-overrides:${e}:${r}`;this.setItem(s,n)}static clearPendingOverrides(e,r){const n=`token-model:pending-overrides:${e}:${r}`;localStorage.removeItem(n)}static getEditContext(){return this.getItem("token-model:edit-context",{sourceType:"core",sourceId:void 0,isEditMode:!1})}static setEditContext(e){this.setItem("token-model:edit-context",e)}static getOverrideHistory(){return this.getItem("token-model:override-history",[])}static addOverrideHistoryEntry(e){const r=this.getOverrideHistory(),n={...e,timestamp:new Date().toISOString()};r.push(n),r.length>100&&r.splice(0,r.length-100),this.setItem("token-model:override-history",r)}static clearOverrideHistory(){localStorage.removeItem("token-model:override-history")}static getSourceSnapshot(){return this.getItem(Gt.SOURCE_SNAPSHOT,null)}static setSourceSnapshot(e){this.setItem(Gt.SOURCE_SNAPSHOT,e)}static getLocalEdits(){return this.getItem(Gt.LOCAL_EDITS,null)}static setLocalEdits(e){console.log("[StorageService] setLocalEdits called with data type:",typeof e),this.setItem(Gt.LOCAL_EDITS,e),console.log("[StorageService] Dispatching token-model:local-edits-changed event"),window.dispatchEvent(new CustomEvent("token-model:local-edits-changed"))}static getMergedData(){return this.getItem(Gt.MERGED_DATA,null)}static setMergedData(e){this.setItem(Gt.MERGED_DATA,e)}static getSourceContext(){return this.getItem(Gt.SOURCE_CONTEXT,null)}static setSourceContext(e){this.setItem(Gt.SOURCE_CONTEXT,e)}static updateLocalEditsDimensions(e){console.log("[StorageService] updateLocalEditsDimensions called with:",e.length,"dimensions");const r=this.getLocalEdits();if(console.log("[StorageService] Current localEdits:",r?"exists":"null"),r&&"dimensions"in r){const n={...r,dimensions:e};console.log("[StorageService] Updating local edits with new dimensions"),this.setLocalEdits(n)}else console.warn("[StorageService] Cannot update dimensions - localEdits missing or wrong type")}static updateLocalEditsValueTypes(e){const r=this.getLocalEdits();if(r&&"resolvedValueTypes"in r){const n={...r,resolvedValueTypes:e};this.setLocalEdits(n)}}static updateLocalEditsTaxonomies(e){const r=this.getLocalEdits();if(r&&"taxonomies"in r){const n={...r,taxonomies:e};this.setLocalEdits(n)}}static updateLocalEditsComponentCategories(e){const r=this.getLocalEdits();if(r&&"componentCategories"in r){const n={...r,componentCategories:e};this.setLocalEdits(n)}}static updateLocalEditsComponentProperties(e){const r=this.getLocalEdits();if(r&&"componentProperties"in r){const n={...r,componentProperties:e};this.setLocalEdits(n)}}static updateLocalEditsComponents(e){const r=this.getLocalEdits();if(r&&"components"in r){const n={...r,components:e};this.setLocalEdits(n)}}static updateLocalEditsTokens(e){console.log("[StorageService] updateLocalEditsTokens called with:",e.length,"tokens");const r=this.getLocalEdits();if(console.log("[StorageService] Current localEdits:",r?"exists":"null"),r&&"tokens"in r){const n={...r,tokens:e};console.log("[StorageService] Updating local edits with new tokens"),this.setLocalEdits(n)}else console.warn("[StorageService] Cannot update tokens - localEdits missing or wrong type")}static updateLocalEditsCollections(e){const r=this.getLocalEdits();if(r&&"tokenCollections"in r){const n={...r,tokenCollections:e};this.setLocalEdits(n)}}static migrateExistingData(){console.log("[StorageService] Starting data migration...");const e=this.getCoreData();if(e&&!this.getSourceSnapshot()&&(console.log("[StorageService] Migrating existing core data to source snapshot"),this.setSourceSnapshot(e),this.setLocalEdits(e),this.setMergedData(e)),!this.getSourceContext()){const r={sourceType:"core",sourceId:null,coreRepository:{fullName:"",branch:"main",filePath:"schema.json",fileType:"schema"},sourceRepository:{fullName:"",branch:"main",filePath:"schema.json",fileType:"schema"},lastLoadedAt:new Date().toISOString(),hasLocalChanges:!1,editMode:{isActive:!1,sourceType:"core",sourceId:null,targetRepository:null}};this.setSourceContext(r)}console.log("[StorageService] Data migration completed")}static validateDataStructure(e){const r=[];if(!e)return r.push("Data is null or undefined"),{isValid:!1,errors:r};if(typeof e!="object")return r.push("Data must be an object"),{isValid:!1,errors:r};const n=e;return n.tokens&&!Array.isArray(n.tokens)&&r.push("tokens must be an array"),n.dimensions&&!Array.isArray(n.dimensions)&&r.push("dimensions must be an array"),n.platforms&&!Array.isArray(n.platforms)&&r.push("platforms must be an array"),{isValid:r.length===0,errors:r}}}rt(L,"valueTypesCache",null);const ko=Object.freeze(Object.defineProperty({__proto__:null,StorageService:L},Symbol.toStringTag,{value:"Module"})),Wv=M.createContext(null),l3=({children:t,currentData:e})=>{const[r,n]=M.useState([]),[s,i]=M.useState(!1),[a,l]=M.useState({monthlyQueries:0,monthlyCost:0,averageCostPerQuery:0,budgetStatus:{currentUsage:0,budget:5,remaining:5,percentageUsed:0,isOverBudget:!1}}),[c,d]=M.useState({monthlyBudget:5,costAlerts:!0,autoFallback:!0}),u=Hr();M.useEffect(()=>{const S=Ho.getBudgetSettings();d(S)},[]),M.useEffect(()=>{const S=()=>{const k=Ho.getUsageMetrics(),A=Ho.getBudgetStatus();l({monthlyQueries:k.monthlyQueries,monthlyCost:k.monthlyCost,averageCostPerQuery:k.costPerQuery,budgetStatus:A})};S();const b=setInterval(S,3e4);return()=>clearInterval(b)},[]),M.useEffect(()=>{const S=b=>{const{type:k,message:A}=b.detail;u({title:k==="error"?"Budget Exceeded":"Budget Warning",description:A,status:k,duration:5e3,isClosable:!0})};return window.addEventListener("gemini-ai:budget-alert",S),()=>{window.removeEventListener("gemini-ai:budget-alert",S)}},[u]);const m=M.useCallback(async()=>{var xe,$,B,U,X,ee,be,Se,Me,se,de,fe,_e,Y,Ce;let S=L.getMergedData();if(!S){console.log("[GeminiAI] No merged data found, attempting to compute it...");const{DataMergerService:ue}=await ir(async()=>{const{DataMergerService:ze}=await Promise.resolve().then(()=>jC);return{DataMergerService:ze}},void 0);S=await ue.getInstance().computeMergedData()}const b=(S==null?void 0:S.platforms)||L.getPlatforms(),k=(S==null?void 0:S.themes)||L.getThemes();console.log("[GeminiAI] Debug storage contents:",{platforms:b==null?void 0:b.map(ue=>({id:ue.id,displayName:ue.displayName,extensionSource:ue.extensionSource})),themes:k==null?void 0:k.map(ue=>({id:ue.id,displayName:ue.displayName,overrideSource:ue.overrideSource})),platformExtensionsFromStorage:L.getPlatformExtensions(),themeOverridesFromStorage:L.getThemeOverrides()}),console.log("[GeminiAI] Attempting to load missing platform extensions and theme overrides...");const A={},C={};for(const ue of b||[])if(ue.extensionSource&&!L.getPlatformExtensionData(ue.id)){const{repositoryUri:Ee,filePath:ze}=ue.extensionSource,De="main";console.log(`[GeminiAI] Loading platform extension for ${ue.id} from ${Ee}/${ze}`);try{const{PlatformExtensionDataService:Ke}=await ir(async()=>{const{PlatformExtensionDataService:Te}=await Promise.resolve().then(()=>Jv);return{PlatformExtensionDataService:Te}},void 0),ve=await Ke.getPlatformExtensionData(Ee,ze,De,ue.id);ve.data?(L.setPlatformExtensionData(ue.id,ve.data),A[ue.id]={tokenOverrides:(xe=ve.data.tokenOverrides)==null?void 0:xe.map(Te=>({id:Te.id}))},console.log(`[GeminiAI] Successfully fetched and stored platform extension for ${ue.id}`,{tokenOverridesCount:(($=ve.data.tokenOverrides)==null?void 0:$.length)||0})):console.warn(`[GeminiAI] Platform extension fetch returned no data for ${ue.id}`,{source:ve.source,error:ve.error})}catch(Ke){console.warn(`[GeminiAI] Failed to load platform extension for ${ue.id}:`,Ke)}}for(const ue of k||[])if(ue.overrideSource&&!L.getThemeOverrideData(ue.id)){const{repositoryUri:Ee,filePath:ze}=ue.overrideSource,De="main";console.log(`[GeminiAI] Loading theme override for ${ue.id} from ${Ee}/${ze}`);try{const{ThemeOverrideDataService:Ke}=await ir(async()=>{const{ThemeOverrideDataService:Te}=await Promise.resolve().then(()=>d3);return{ThemeOverrideDataService:Te}},void 0),ve=await Ke.getThemeOverrideData(Ee,ze,De,ue.id);ve.data?(L.setThemeOverrideData(ue.id,ve.data),C[ue.id]={tokenOverrides:ve.data.tokenOverrides},console.log(`[GeminiAI] Successfully fetched and stored theme override for ${ue.id}`,{tokenOverridesCount:((B=ve.data.tokenOverrides)==null?void 0:B.length)||0})):console.warn(`[GeminiAI] Theme override fetch returned no data for ${ue.id}`,{source:ve.source,error:ve.error})}catch(Ke){console.warn(`[GeminiAI] Failed to load theme override for ${ue.id}:`,Ke)}}const T=L.getPlatformExtensions(),P={};(b||[]).forEach(ue=>{var ze;const Ee=L.getPlatformExtensionData(ue.id)||A[ue.id];Ee?(console.log(`[GeminiAI] Found platform extension data for ${ue.id}:`,{hasTokenOverrides:!!Ee.tokenOverrides,tokenOverridesCount:((ze=Ee.tokenOverrides)==null?void 0:ze.length)||0,platformId:ue.id}),P[ue.id]=Ee):console.log(`[GeminiAI] No platform extension data found for ${ue.id}`)});const _=L.getAllThemeOverrideData(),R={};(k||[]).forEach(ue=>{var ze;const Ee=L.getThemeOverrideData(ue.id)||C[ue.id];Ee?(console.log(`[GeminiAI] Found theme override data for ${ue.id}:`,{hasTokenOverrides:!!Ee.tokenOverrides,tokenOverridesCount:((ze=Ee.tokenOverrides)==null?void 0:ze.length)||0,themeId:ue.id}),R[ue.id]=Ee):console.log(`[GeminiAI] No theme override data found for ${ue.id}`)}),console.log("[GeminiAI] Fetched (in-memory) override sources:",{fetchedPlatformExtensionsCount:Object.keys(A).length,fetchedThemeOverridesCount:Object.keys(C).length});const{MultiRepositoryManager:G}=await ir(async()=>{const{MultiRepositoryManager:ue}=await Promise.resolve().then(()=>kC);return{MultiRepositoryManager:ue}},void 0),he=G.getInstance().getCurrentData();console.log("[GeminiAI] MultiRepositoryManager data:",{hasCore:!!he.core,platformExtensionsCount:he.platformExtensions.size,hasThemeOverrides:!!he.themeOverrides,platformExtensionIds:Array.from(he.platformExtensions.keys())});const te={};he.platformExtensions.forEach((ue,Ee)=>{var ze;console.log(`[GeminiAI] Found MultiRepo platform extension for ${Ee}:`,{hasTokenOverrides:!!ue.tokenOverrides,tokenOverridesCount:((ze=ue.tokenOverrides)==null?void 0:ze.length)||0}),te[Ee]=ue});const K={};he.themeOverrides&&(console.log("[GeminiAI] Found MultiRepo theme overrides:",{hasTokenOverrides:!!he.themeOverrides.tokenOverrides,tokenOverridesCount:((U=he.themeOverrides.tokenOverrides)==null?void 0:U.length)||0}),K["multi-repo-themes"]=he.themeOverrides);const O={...T,...P,...A},Z={..._,...R,...C};console.log("[GeminiAI] Loading schema files for AI context...");let ie={};try{const ue=await ir(()=>Promise.resolve().then(()=>CC),void 0);ie={mainSchema:ue.default||ue,platformExtensionSchema:await ir(()=>import("./platform-extension-schema-CZsLzp6Q.js"),[]),themeOverridesSchema:await ir(()=>import("./theme-overrides-schema-CZbv219D.js"),[]),algorithmSchema:await ir(()=>import("./algorithm-schema-pHP-CuTR.js"),[])},console.log("[GeminiAI] Successfully loaded schema files")}catch(ue){console.warn("[GeminiAI] Failed to load schema files:",ue)}const ge={...S,platformExtensions:O,themeOverrides:Z,schemas:{main:ie.mainSchema,platformExtension:ie.platformExtensionSchema,themeOverride:ie.themeOverridesSchema,algorithm:ie.algorithmSchema},overrideSummary:{platformOverrides:Object.entries(O).map(([ue,Ee])=>{var ze,De;return{platformId:ue,tokenOverridesCount:((ze=Ee.tokenOverrides)==null?void 0:ze.length)||0,tokenOverrides:((De=Ee.tokenOverrides)==null?void 0:De.map(Ke=>Ke.id))||[]}}),themeOverrides:Object.entries(Z).map(([ue,Ee])=>{var ze;return{themeId:ue,tokenOverridesCount:((ze=Ee.tokenOverrides)==null?void 0:ze.length)||0,tokenOverrides:Ee.tokenOverrides||[]}}),totalPlatformOverrides:Object.values(O).reduce((ue,Ee)=>{var ze;return ue+(((ze=Ee.tokenOverrides)==null?void 0:ze.length)||0)},0),totalThemeOverrides:Object.values(Z).reduce((ue,Ee)=>{var ze;return ue+(((ze=Ee.tokenOverrides)==null?void 0:ze.length)||0)},0)}};return console.log("[GeminiAI] FINAL enriched data structure being sent to AI:",{hasPlatformExtensions:!!ge.platformExtensions,platformExtensionsKeys:ge.platformExtensions?Object.keys(ge.platformExtensions):[],platformExtensionsCount:ge.platformExtensions?Object.keys(ge.platformExtensions).length:0,hasThemeOverrides:!!ge.themeOverrides,themeOverridesKeys:ge.themeOverrides?Object.keys(ge.themeOverrides):[],themeOverridesCount:ge.themeOverrides?Object.keys(ge.themeOverrides).length:0,hasOverrideSummary:!!ge.overrideSummary,overrideSummary:ge.overrideSummary,samplePlatformExtension:ge.platformExtensions?Object.values(ge.platformExtensions)[0]:null,sampleThemeOverride:ge.themeOverrides?Object.values(ge.themeOverrides)[0]:null,hasSchemas:!!ge.schemas,schemaKeys:ge.schemas?Object.keys(ge.schemas):[]}),console.log("[GeminiAI] Raw platform extensions data:",O),console.log("[GeminiAI] Raw theme overrides data:",Z),console.log("[GeminiAI] Using enriched data with ALL override information:",{tokensCount:((X=ge.tokens)==null?void 0:X.length)||0,collectionsCount:((ee=ge.tokenCollections)==null?void 0:ee.length)||0,dimensionsCount:((be=ge.dimensions)==null?void 0:be.length)||0,componentsCount:((Se=ge.components)==null?void 0:Se.length)||0,taxonomiesCount:((Me=ge.taxonomies)==null?void 0:Me.length)||0,resolvedValueTypesCount:((se=ge.resolvedValueTypes)==null?void 0:se.length)||0,platformsCount:((de=ge.platforms)==null?void 0:de.length)||0,themesCount:((fe=ge.themes)==null?void 0:fe.length)||0,algorithmsCount:((_e=ge.algorithms)==null?void 0:_e.length)||0,componentCategoriesCount:((Y=ge.componentCategories)==null?void 0:Y.length)||0,componentPropertiesCount:((Ce=ge.componentProperties)==null?void 0:Ce.length)||0,platformExtensionsCount:Object.keys(O).length,themeOverridesCount:Object.keys(Z).length,schemasCount:Object.keys(ie).length,platformExtensionSources:{fromStorage:Object.keys(T).length,perPlatform:Object.keys(P).length,fromMultiRepo:Object.keys(te).length},themeOverrideSources:{fromStorage:Object.keys(_).length,perTheme:Object.keys(R).length,fromMultiRepo:Object.keys(K).length}}),ge},[e]),g=M.useCallback(async S=>{if(S.trim()){i(!0);try{if(!Ho.isFeatureAvailable())throw new Error("AI features are currently disabled due to budget limits. Please try again next month.");const b=await m();try{const P=b.platformExtensions||{},_=b.themeOverrides||{},R=new Set((b.tokens||[]).map(K=>K.id)),G=Object.entries(P).map(([K,O])=>{const Z=(O.tokenOverrides||[]).filter(ie=>ie&&typeof ie.id=="string"&&R.has(ie.id)).length;return{platformId:K,count:Z}}).filter(K=>K.count>0),ne=Object.entries(_).map(([K,O])=>({themeId:K,count:Array.isArray(O==null?void 0:O.tokenOverrides)?O.tokenOverrides.length:0})).filter(K=>K.count>0),he=G.reduce((K,O)=>K+O.count,0),te=ne.reduce((K,O)=>K+O.count,0);console.log("[GeminiAI][Diagnostics] Override counts:",{totalPlatformOverrides:he,totalThemeOverrides:te,byPlatform:G,byTheme:ne})}catch(P){console.warn("[GeminiAI][Diagnostics] Failed to compute override diagnostics:",P)}const k=fy.buildDesignSystemContext(b);if(!fy.isContextWithinBudget(k))throw new Error("This query would exceed your monthly budget. Please try a more specific question.");const A=await n3.query(S,k);n(P=>[...P,{type:"user",content:S,timestamp:new Date},{type:"assistant",content:A.answer,timestamp:new Date,cost:A.cost}]),Ho.trackUsage(S,A.cost);const C=Ho.getUsageMetrics(),T=Ho.getBudgetStatus();l({monthlyQueries:C.monthlyQueries,monthlyCost:C.monthlyCost,averageCostPerQuery:C.costPerQuery,budgetStatus:T}),console.log(`[GeminiAI] Query completed: $${A.cost.toFixed(4)}`)}catch(b){console.error("[GeminiAI] Query failed:",b);const k=b instanceof Error?b.message:"An unexpected error occurred";n(A=>[...A,{type:"user",content:S,timestamp:new Date},{type:"assistant",content:`Sorry, I encountered an error: ${k}`,timestamp:new Date}]),u({title:"AI Query Failed",description:k,status:"error",duration:5e3,isClosable:!0})}finally{i(!1)}}},[m,u]),y=M.useCallback(()=>{n([])},[]),v=M.useCallback(S=>{const b={...c,...S};d(b),Ho.updateBudgetSettings(b),u({title:"Settings Updated",description:"Budget settings have been updated successfully.",status:"success",duration:3e3,isClosable:!0})},[c,u]),I={isAvailable:Ho.isFeatureAvailable(),isLoading:s,conversation:r,askQuestion:g,clearConversation:y,costStats:a,budgetSettings:c,updateBudgetSettings:v};return o.jsx(Wv.Provider,{value:I,children:t})},Ur={clientId:"Ov23li4XeOJKztYd3mkd",clientSecret:"656ec47fd3d79e8d5e22af6e8b75322032fa3b92",redirectUri:"https://designsystemfoundry.com/#/auth/github/callback",scope:"repo",apiBaseUrl:"https://api.github.com",authUrl:"https://github.com/login/oauth/authorize",tokenUrl:"https://github.com/login/oauth/access_token"};class co{static encryptToken(e){return btoa(e)}static decryptToken(e){return atob(e)}static storeGitHubToken(e){try{const r=this.encryptToken(e);localStorage.setItem(this.TOKEN_KEY,r)}catch(r){console.error("Failed to store GitHub token:",r)}}static getGitHubToken(){try{const e=localStorage.getItem(this.TOKEN_KEY);return e?this.decryptToken(e):null}catch(e){return console.error("Failed to retrieve GitHub token:",e),null}}static clearGitHubToken(){localStorage.removeItem(this.TOKEN_KEY)}static storeGitHubUser(e){try{localStorage.setItem(this.USER_KEY,JSON.stringify(e))}catch(r){console.error("Failed to store GitHub user:",r)}}static getGitHubUser(){try{const e=localStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}catch(e){return console.error("Failed to retrieve GitHub user:",e),null}}static clearGitHubUser(){localStorage.removeItem(this.USER_KEY)}static storeSelectedRepo(e){try{localStorage.setItem(this.REPO_KEY,JSON.stringify(e))}catch(r){console.error("Failed to store selected repo:",r)}}static getSelectedRepo(){try{const e=localStorage.getItem(this.REPO_KEY);return e?JSON.parse(e):null}catch(e){return console.error("Failed to retrieve selected repo:",e),null}}static clearSelectedRepo(){localStorage.removeItem(this.REPO_KEY)}static clearAllGitHubData(){this.clearGitHubToken(),this.clearGitHubUser(),this.clearSelectedRepo()}}rt(co,"TOKEN_KEY","github_token_encrypted"),rt(co,"USER_KEY","github_user"),rt(co,"REPO_KEY","github_repo");class Yt{static generateState(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}static generateCodeVerifier(){const e=new Uint8Array(32);return crypto.getRandomValues(e),btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}static async generateCodeChallenge(e){const n=new TextEncoder().encode(e),s=await crypto.subtle.digest("SHA-256",n);return btoa(String.fromCharCode(...new Uint8Array(s))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}static async initiateAuth(){const e=this.generateState(),r=this.generateCodeVerifier(),n=await this.generateCodeChallenge(r);localStorage.setItem("github_oauth_state",e),localStorage.setItem("github_oauth_code_verifier",r);const s=new URLSearchParams(window.location.search),i={repo:s.get("repo"),branch:s.get("branch"),path:s.get("path"),platform:s.get("platform"),theme:s.get("theme")};(i.repo||i.platform||i.theme)&&(localStorage.setItem("github_oauth_original_url_context",JSON.stringify(i)),console.log("[GitHubAuthService] Storing original URL context for OAuth flow:",i));const a=new URLSearchParams({client_id:Ur.clientId,redirect_uri:Ur.redirectUri,scope:Ur.scope,state:e,code_challenge:n,code_challenge_method:"S256"});window.location.href=`${Ur.authUrl}?${a}`}static async handleCallback(e,r){const n=localStorage.getItem("github_oauth_state"),s=localStorage.getItem("github_oauth_code_verifier");if(console.log("OAuth callback - Received state:",r),console.log("OAuth callback - Stored state:",n),console.log("OAuth callback - Code verifier exists:",!!s),!n)throw new Error("No stored state parameter found. The OAuth flow may have been interrupted.");if(!s)throw new Error("No stored code verifier found. The OAuth flow may have been interrupted.");if(r!==n)throw console.error("State mismatch - Received:",r,"Stored:",n),new Error("Invalid state parameter - possible CSRF attack or OAuth flow interruption");localStorage.removeItem("github_oauth_state"),localStorage.removeItem("github_oauth_code_verifier");try{const i=await this.exchangeCodeForTokenWithPKCE(e,s);co.storeGitHubToken(i);const a=await this.fetchCurrentUser(i);return co.storeGitHubUser(a),this.startTokenRefreshMonitor(),a}catch(i){throw console.error("Failed to handle OAuth callback:",i),i}}static async exchangeCodeForTokenWithPKCE(e,r){const s=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"/api/github/token":Ur.tokenUrl,i=await fetch(s,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({client_id:Ur.clientId,client_secret:Ur.clientSecret,code:e,redirect_uri:Ur.redirectUri,code_verifier:r})});if(!i.ok){const l=await i.text();throw console.error("Token exchange failed:",i.status,l),new Error(`Failed to get access token: ${i.statusText}`)}const a=await i.json();if(a.error)throw new Error(`OAuth error: ${a.error_description||a.error}`);return a.access_token}static async exchangeCodeForToken(e){const r=await fetch(Ur.tokenUrl,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({client_id:Ur.clientId,client_secret:Ur.clientSecret,code:e,redirect_uri:Ur.redirectUri})});if(!r.ok)throw new Error(`Failed to get access token: ${r.statusText}`);const n=await r.json();if(n.error)throw new Error(`OAuth error: ${n.error_description||n.error}`);return n.access_token}static async fetchCurrentUser(e){const r=await fetch(`${Ur.apiBaseUrl}/user`,{headers:{Authorization:`token ${e}`,Accept:"application/vnd.github.v3+json"}});if(!r.ok)throw new Error(`Failed to get user info: ${r.statusText}`);return r.json()}static hasStaleOAuthState(){return localStorage.getItem("github_oauth_state")!==null}static isAuthenticated(){return co.getGitHubToken()!==null}static getCurrentUser(){return co.getGitHubUser()}static clearOAuthState(){localStorage.removeItem("github_oauth_state"),localStorage.removeItem("github_oauth_code_verifier"),localStorage.removeItem("github_oauth_original_url_context")}static logout(){co.clearAllGitHubData(),this.clearOAuthState(),this.stopTokenRefreshMonitor()}static startTokenRefreshMonitor(){this.refreshTokenInterval=setInterval(()=>{this.handleTokenRefresh()},30*60*1e3)}static stopTokenRefreshMonitor(){this.refreshTokenInterval&&(clearInterval(this.refreshTokenInterval),this.refreshTokenInterval=null)}static async handleTokenRefresh(){if(!this.refreshInProgress){this.refreshInProgress=!0;try{const e=co.getGitHubToken();if(!e)return;const r=await this.fetchCurrentUser(e);co.storeGitHubUser(r)}catch(e){console.error("Token refresh failed:",e),this.logout()}finally{this.refreshInProgress=!1}}}static async getValidAccessToken(){const e=co.getGitHubToken();if(!e)throw new Error("No GitHub token available");try{return await this.fetchCurrentUser(e),e}catch{throw this.logout(),new Error("GitHub token is invalid - please re-authenticate")}}}rt(Yt,"refreshInProgress",!1),rt(Yt,"refreshTokenInterval",null);const c3=Object.freeze(Object.defineProperty({__proto__:null,GitHubAuthService:Yt},Symbol.toStringTag,{value:"Module"})),Yi={repositories:{ttl:5*60*1e3,maxSize:1024*1024,maxEntries:1e3},branches:{ttl:2*60*1e3,maxSize:100*1024},organizations:{ttl:10*60*1e3,maxSize:50*1024}};class qr{static getOrganizations(){return this.getCachedData(this.ORGANIZATIONS_KEY)}static setOrganizations(e){this.setCachedData(this.ORGANIZATIONS_KEY,e,Yi.organizations.ttl,Yi.organizations.maxSize)}static getRepositories(){const e=this.getCachedData(this.REPOSITORIES_KEY);return e?e.map(r=>({...r,html_url:`https://github.com/${r.full_name}`,clone_url:`https://github.com/${r.full_name}.git`,ssh_url:`git@github.com:${r.full_name}.git`,git_url:`git://github.com/${r.full_name}.git`,svn_url:`https://svn.github.com/${r.full_name}`,homepage:null,language:null,forks_count:0,stargazers_count:0,watchers_count:0,size:0,default_branch:"main",open_issues_count:0,has_issues:!0,has_projects:!0,has_downloads:!0,has_wiki:!0,has_pages:!1,has_discussions:!1,archived:!1,disabled:!1,allow_forking:!0,is_template:!1,web_commit_signoff_required:!1,topics:[],visibility:r.private?"private":"public",pushed_at:r.updated_at,created_at:r.updated_at,permissions:{admin:!1,maintain:!1,push:!1,triage:!1,pull:!0},security_and_analysis:{advanced_security:{status:"disabled"},secret_scanning:{status:"disabled"},secret_scanning_push_protection:{status:"disabled"}}})):null}static setRepositories(e){const n=e.slice(0,Yi.repositories.maxEntries).map(s=>({id:s.id,name:s.name,full_name:s.full_name,private:s.private,updated_at:s.updated_at}));this.setCachedData(this.REPOSITORIES_KEY,n,Yi.repositories.ttl,Yi.repositories.maxSize)}static getBranches(e){const r=`${this.BRANCHES_PREFIX}${e.replace("/","_")}`;return this.getCachedData(r)}static setBranches(e,r){const n=`${this.BRANCHES_PREFIX}${e.replace("/","_")}`;this.setCachedData(n,r,Yi.branches.ttl,Yi.branches.maxSize)}static clearAll(){Object.keys(localStorage).forEach(r=>{r.startsWith(this.CACHE_PREFIX)&&localStorage.removeItem(r)})}static clearRepositoryData(e){const r=`${this.CACHE_PREFIX}${this.BRANCHES_PREFIX}${e.replace("/","_")}`;localStorage.removeItem(r)}static clearRepositoryCache(e){try{this.clearBranchesForRepository(e),Object.keys(localStorage).filter(s=>s.startsWith(this.CACHE_PREFIX)&&s.includes(e.replace("/","_"))).forEach(s=>{localStorage.removeItem(s)}),console.log(`[GitHubCacheService] Cleared cache for repository: ${e}`)}catch(r){console.error("[GitHubCacheService] Error clearing repository cache:",r)}}static clearBranchesForRepository(e){try{const r=this.BRANCHES_PREFIX+e.replace("/","_");localStorage.removeItem(this.CACHE_PREFIX+r),console.log(`[GitHubCacheService] Cleared branches for repository: ${e}`)}catch(r){console.error("[GitHubCacheService] Error clearing branches for repository:",r)}}static preserveBranchesForRepository(e){console.log(`[GitHubCacheService] Preserving branches for repository: ${e}`)}static isCacheValid(e){return e?Date.now()<e.expiresAt:!1}static getCachedData(e){try{const r=localStorage.getItem(`${this.CACHE_PREFIX}${e}`);if(!r)return null;const n=JSON.parse(r);return this.isCacheValid(n)?n.data:(localStorage.removeItem(`${this.CACHE_PREFIX}${e}`),null)}catch(r){return console.error("Failed to retrieve cached data:",r),localStorage.removeItem(`${this.CACHE_PREFIX}${e}`),null}}static getAvailableStorage(){try{const e="storage_test";localStorage.setItem(e,"test"),localStorage.removeItem(e);let n=0;for(let i=0;i<localStorage.length;i++){const a=localStorage.key(i);if(a){const l=localStorage.getItem(a);l&&(n+=a.length+l.length)}}const s=5*1024*1024;return Math.max(0,s-n)}catch(e){return console.warn("Could not determine available storage:",e),0}}static evictOldestEntries(e){const n=Object.keys(localStorage).filter(a=>a.startsWith(this.CACHE_PREFIX)),s=[];n.forEach(a=>{try{const l=localStorage.getItem(a);if(l){const c=JSON.parse(l);s.push({key:a,timestamp:c.timestamp,size:c.size||l.length})}}catch{localStorage.removeItem(a)}}),s.sort((a,l)=>a.timestamp-l.timestamp);let i=0;for(const a of s){if(i>=e)break;localStorage.removeItem(a.key),i+=a.size}}static setCachedData(e,r,n,s){try{const i={data:r,timestamp:Date.now(),expiresAt:Date.now()+n,size:0},l=JSON.stringify(i).length;if(i.size=l,s&&l>s){console.warn(`Data size (${l} bytes) exceeds limit (${s} bytes) for key: ${e}`);return}const c=this.getAvailableStorage();l>c&&(console.warn(`Insufficient storage space. Required: ${l}, Available: ${c}`),this.evictOldestEntries(l)),localStorage.setItem(`${this.CACHE_PREFIX}${e}`,JSON.stringify(i))}catch(i){console.error("Failed to cache data:",i),this.debugCacheIssue("setCachedData",i),this.clearExpiredCache(),this.evictOldestEntries(1024*1024);try{const a={data:r,timestamp:Date.now(),expiresAt:Date.now()+n,size:0},c=JSON.stringify(a).length;a.size=c,localStorage.setItem(`${this.CACHE_PREFIX}${e}`,JSON.stringify(a))}catch(a){console.error("Failed to cache data after cleanup:",a),this.clearAll();try{const l={data:r,timestamp:Date.now(),expiresAt:Date.now()+n,size:0},c=JSON.stringify(l);l.size=c.length,localStorage.setItem(`${this.CACHE_PREFIX}${e}`,JSON.stringify(l))}catch(l){console.error("Failed to cache data after clearing all cache:",l)}}}}static clearExpiredCache(){Object.keys(localStorage).forEach(r=>{if(r.startsWith(this.CACHE_PREFIX))try{const n=localStorage.getItem(r);if(n){const s=JSON.parse(n);Date.now()>=s.expiresAt&&localStorage.removeItem(r)}}catch{localStorage.removeItem(r)}})}static getCacheStats(){const r=Object.keys(localStorage).filter(a=>a.startsWith(this.CACHE_PREFIX));let n=0,s=0,i=0;return r.forEach(a=>{try{const l=localStorage.getItem(a);if(l){i+=l.length;const c=JSON.parse(l);Date.now()>=c.expiresAt?n++:s++}}catch{n++}}),{totalEntries:r.length,expiredEntries:n,validEntries:s,totalSize:i,availableStorage:this.getAvailableStorage()}}static debugCacheIssue(e,r){const n=this.getCacheStats();console.group("GitHub Cache Debug Info"),console.log("Operation:",e),console.log("Error:",r.message),console.log("Cache Stats:",n),console.log("localStorage length:",localStorage.length),console.log("localStorage keys:",Object.keys(localStorage).filter(s=>s.startsWith(this.CACHE_PREFIX))),console.groupEnd()}static forceClearAll(){console.log("Force clearing all GitHub cache..."),this.clearAll(),console.log("GitHub cache cleared successfully")}static getCacheState(){try{const e=localStorage.getItem(`${this.CACHE_PREFIX}${this.CACHE_STATE_KEY}`);return e?JSON.parse(e):{lastRefreshTimestamp:0,repositoryBranches:{},permissions:{}}}catch(e){return console.error("[GitHubCacheService] Error getting cache state:",e),{lastRefreshTimestamp:0,repositoryBranches:{},permissions:{}}}}static setCacheState(e){try{localStorage.setItem(`${this.CACHE_PREFIX}${this.CACHE_STATE_KEY}`,JSON.stringify(e))}catch(r){console.error("[GitHubCacheService] Error setting cache state:",r)}}static getBranchesWithTTL(e){return this.getBranches(e)}static setBranchesWithTTL(e,r){this.setBranches(e,r);const n=this.getCacheState();n.repositoryBranches[e]=r.map(s=>s.name),n.lastRefreshTimestamp=Date.now(),this.setCacheState(n)}}rt(qr,"CACHE_PREFIX","github_cache_"),rt(qr,"ORGANIZATIONS_KEY","organizations"),rt(qr,"REPOSITORIES_KEY","repositories"),rt(qr,"BRANCHES_PREFIX","branches_"),rt(qr,"CACHE_STATE_KEY","cache_state");class xt{static async getOrganizations(){const e=qr.getOrganizations();if(e)return console.log("[GitHubApiService] Using cached organizations"),e;console.log("[GitHubApiService] Fetching organizations from GitHub API");const r=await Yt.getValidAccessToken(),n=await fetch(`${Ur.apiBaseUrl}/user`,{headers:{Authorization:`token ${r}`,Accept:"application/vnd.github.v3+json"}});if(!n.ok)throw new Error(`Failed to fetch user: ${n.statusText}`);const s=await n.json(),i=await fetch(`${Ur.apiBaseUrl}/user/orgs`,{headers:{Authorization:`token ${r}`,Accept:"application/vnd.github.v3+json"}});if(!i.ok)throw new Error(`Failed to fetch organizations: ${i.statusText}`);const a=await i.json(),c=[{id:s.id,login:s.login,name:s.name||s.login,avatar_url:s.avatar_url,type:"User"},...a];try{qr.setOrganizations(c)}catch(d){console.warn("Failed to cache organizations, but continuing with API response:",d)}return c}static async getRepositories(){const e=qr.getRepositories();if(e)return console.log("[GitHubApiService] Using cached repositories"),e;console.log("[GitHubApiService] Fetching repositories from GitHub API");const r=await Yt.getValidAccessToken();let n=[],s=1;const i=100;let a=!0;for(;a;){const l=await fetch(`${Ur.apiBaseUrl}/user/repos?sort=updated&per_page=${i}&page=${s}`,{headers:{Authorization:`token ${r}`,Accept:"application/vnd.github.v3+json"}});if(!l.ok)throw new Error(`Failed to fetch repositories: ${l.statusText}`);const c=await l.json();c.length===0?a=!1:(n=n.concat(c),s++,s>10&&(a=!1))}try{qr.setRepositories(n)}catch(l){console.warn("Failed to cache repositories, but continuing with API response:",l)}return n}static async getBranches(e){const r=qr.getBranches(e);if(r)return console.log(`[GitHubApiService] Using cached branches for ${e}`),r;console.log(`[GitHubApiService] Fetching branches for ${e} from GitHub API`);const n=await Yt.getValidAccessToken(),s=await fetch(`${Ur.apiBaseUrl}/repos/${e}/branches`,{headers:{Authorization:`token ${n}`,Accept:"application/vnd.github.v3+json"}});if(!s.ok)throw new Error(`Failed to fetch branches: ${s.statusText}`);const i=await s.json();try{qr.setBranches(e,i)}catch(a){console.warn("Failed to cache branches, but continuing with API response:",a)}return i}static async getFileContent(e,r,n){const s=await Yt.getValidAccessToken(),i=await fetch(`${Ur.apiBaseUrl}/repos/${e}/contents/${r}?ref=${n}`,{headers:{Authorization:`token ${s}`,Accept:"application/vnd.github.v3+json"}});if(!i.ok)throw new Error(`Failed to fetch file content: ${i.statusText}`);const a=await i.json();if(a.content&&a.encoding==="base64")try{const l=atob(a.content);return{...a,content:l}}catch{throw new Error("Failed to decode file content")}return a}static async getPublicFileContent(e,r,n){console.log("[GitHubApiService] Fetching public file content:",{repo:e,path:r,branch:n});const s=await fetch(`${Ur.apiBaseUrl}/repos/${e}`,{headers:{Accept:"application/vnd.github.v3+json"}});if(!s.ok)throw s.status===404?new Error(`Repository not found: ${e}`):s.status===403?new Error(`Repository is private: ${e}`):new Error(`Failed to access repository: ${s.status} ${s.statusText}`);const i=await fetch(`${Ur.apiBaseUrl}/repos/${e}/contents/${r}?ref=${n}`,{headers:{Accept:"application/vnd.github.v3+json"}});if(!i.ok)throw i.status===404?new Error(`File not found: ${r} in ${e}/${n}`):i.status===403?new Error(`Repository is private: ${e}`):new Error(`Failed to fetch file content: ${i.status} ${i.statusText}`);const a=await i.json();if(a.content&&a.encoding==="base64")try{const l=atob(a.content);return{...a,content:l}}catch{throw new Error("Failed to decode file content")}return a}static async createOrUpdateFile(e,r,n,s,i="Update token data"){const a=await Yt.getValidAccessToken();let l;try{l=(await this.getFileContent(e,r,s)).sha}catch{}const c={message:i,content:this.encodeToBase64(n),branch:s};l&&(c.sha=l);const d=await fetch(`${Ur.apiBaseUrl}/repos/${e}/contents/${r}`,{method:"PUT",headers:{Authorization:`token ${a}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify(c)});if(!d.ok){const u=await d.json().catch(()=>({})),m=`Failed to create/update file: ${d.status} ${d.statusText}${u.message?` - ${u.message}`:""}`;throw new Error(m)}}static async createFile(e,r,n,s,i="Update token data"){return this.createOrUpdateFile(e,r,n,s,i)}static async deleteFile(e,r,n,s="Delete file"){const i=await Yt.getValidAccessToken();let a;try{a=(await this.getFileContent(e,r,n)).sha}catch{throw new Error(`File not found or cannot be accessed: ${r}`)}const l={message:s,sha:a,branch:n},c=await fetch(`${Ur.apiBaseUrl}/repos/${e}/contents/${r}`,{method:"DELETE",headers:{Authorization:`token ${i}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify(l)});if(!c.ok){const d=await c.json().catch(()=>({}));throw new Error(`Failed to delete file: ${c.statusText}${d.message?` - ${d.message}`:""}`)}}static async createPullRequest(e,r,n,s,i){const a=await Yt.getValidAccessToken(),l=await fetch(`${Ur.apiBaseUrl}/repos/${e}/pulls`,{method:"POST",headers:{Authorization:`token ${a}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify({title:r,body:n,head:s,base:i})});if(!l.ok)throw new Error(`Failed to create pull request: ${l.statusText}`);return l.json()}static encodeToBase64(e){const n=new TextEncoder().encode(e);return btoa(String.fromCharCode(...n))}static async createRepository(e){const r=await Yt.getValidAccessToken(),n=e.organization?`${Ur.apiBaseUrl}/orgs/${e.organization}/repos`:`${Ur.apiBaseUrl}/user/repos`,s=await fetch(n,{method:"POST",headers:{Authorization:`token ${r}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify({name:e.name,description:e.description||"",private:e.private||!1,auto_init:e.autoInit||!1})});if(!s.ok){const i=await s.text();throw new Error(`Failed to create repository: ${s.statusText} - ${i}`)}return s.json()}static async createBranch(e,r,n){console.log("[GitHubApiService] Creating branch:",{repo:e,baseBranch:r,newBranch:n});const s=await Yt.getValidAccessToken(),i=await fetch(`${Ur.apiBaseUrl}/repos/${e}/branches/${r}`,{headers:{Authorization:`token ${s}`,Accept:"application/vnd.github.v3+json"}});if(!i.ok)throw new Error(`Failed to get base branch info: ${i.statusText}`);const a=await i.json(),l=await fetch(`${Ur.apiBaseUrl}/repos/${e}/git/refs`,{method:"POST",headers:{Authorization:`token ${s}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify({ref:`refs/heads/${n}`,sha:a.commit.sha})});if(!l.ok)throw new Error(`Failed to create branch: ${l.statusText}`)}static async branchExists(e,r){const n=await Yt.getValidAccessToken();return(await fetch(`${Ur.apiBaseUrl}/repos/${e}/branches/${r}`,{headers:{Authorization:`token ${n}`,Accept:"application/vnd.github.v3+json"}})).ok}static async scanRepositoryForValidFiles(e,r,n){const s=await Yt.getValidAccessToken();console.log(`Scanning repository: ${e} (branch: ${r})${n?` for systemId: ${n}`:""}`);const i=await this.getAllJsonFiles(e,r,s);console.log(`Found ${i.length} JSON files in repository:`,i.map(l=>l.path));const a=[];for(const l of i)try{console.log(`Validating file: ${l.path}`);const c=await this.getFileContent(e,l.path,r),d=this.identifyFileType(c.content);if(console.log(`File ${l.path} identified as: ${d}`),d!=="unknown"){if(d==="platform-extension"&&n)try{const u=JSON.parse(c.content);if(u.systemId!==n){console.log(`Skipping platform extension file ${l.path}: systemId mismatch (expected: ${n}, found: ${u.systemId})`);continue}console.log(`Platform extension file ${l.path} has matching systemId: ${u.systemId}`)}catch(u){console.warn(`Failed to parse systemId from platform extension file ${l.path}:`,u);continue}a.push({path:l.path,name:l.name,type:d,size:l.size,lastModified:l.lastModified||new Date().toISOString()})}}catch(c){console.warn(`Failed to validate file ${l.path}:`,c)}return console.log(`Valid files found: ${a.length}`,a.map(l=>`${l.path} (${l.type})`)),a.sort((l,c)=>new Date(c.lastModified).getTime()-new Date(l.lastModified).getTime())}static async getAllJsonFiles(e,r,n,s=""){const i=`${Ur.apiBaseUrl}/repos/${e}/contents/${s}?ref=${r}`;console.log(`Fetching directory contents from: ${i}`);const a=await fetch(i,{headers:{Authorization:`token ${n}`,Accept:"application/vnd.github.v3+json"}});if(!a.ok)throw console.error(`Failed to fetch directory contents: ${a.status} ${a.statusText}`),new Error(`Failed to fetch directory contents: ${a.statusText}`);const l=await a.json();console.log(`Directory contents for ${s}:`,l.map(d=>({name:d.name,type:d.type})));const c=[];for(const d of l)if(d.type==="file"&&d.name.endsWith(".json"))c.push({path:d.path,name:d.name,size:d.size,lastModified:d.updated_at});else if(d.type==="dir"){const u=await this.getAllJsonFiles(e,r,n,d.path);c.push(...u)}return c}static identifyFileType(e){try{const r=JSON.parse(e);return r.systemId&&r.platformId&&r.version&&r.figmaFileKey?"platform-extension":r.systemId&&r.themeId&&r.tokenOverrides&&!r.platformId?"theme-override":r.tokenCollections&&r.dimensions&&r.tokens&&r.platforms&&r.systemName&&r.systemId&&r.version&&!r.platformId?"schema":"unknown"}catch{return"unknown"}}static getSelectedRepositoryInfo(){try{const e=localStorage.getItem("github_selected_repo");return e?JSON.parse(e):null}catch(e){return console.error("Failed to parse selected repository info:",e),null}}static hasSelectedRepository(){return this.getSelectedRepositoryInfo()!==null}static async hasWriteAccessToRepository(e){var l,c,d;console.log(`[GitHubApiService] Checking write access for repository: ${e}`);const r=await Yt.getValidAccessToken();console.log(`[GitHubApiService] Access token available: ${!!r}`);try{const u=await fetch(`${Ur.apiBaseUrl}/repos/${e}`,{headers:{Authorization:`token ${r}`,Accept:"application/vnd.github.v3+json"}});if(u.ok){const m=await u.json(),g=((l=m.permissions)==null?void 0:l.push)===!0||((c=m.permissions)==null?void 0:c.admin)===!0||((d=m.permissions)==null?void 0:d.maintain)===!0;return console.log(`[GitHubApiService] Direct repo check: User ${g?"has":"does not have"} write access to ${e}`),g}}catch(u){console.warn(`[GitHubApiService] Direct repo check failed for ${e}:`,u)}const n=[];let s=1;const i=100;for(;s<=10;){const u=await fetch(`${Ur.apiBaseUrl}/user/repos?affiliation=owner,collaborator&per_page=${i}&page=${s}`,{headers:{Authorization:`token ${r}`,Accept:"application/vnd.github.v3+json"}});if(!u.ok)return console.error(`[GitHubApiService] Failed to check repository access: ${u.statusText}`),!1;const m=await u.json();if(m.length===0||(n.push(...m),m.length<i))break;s++}const a=n.some(u=>u.full_name===e);return console.log(`[GitHubApiService] List method: User ${a?"has":"does not have"} write access to ${e} (checked ${n.length} repos)`),a}static async getPublicBranches(e){console.log("[GitHubApiService] Fetching public branches:",{repo:e});const r=await fetch(`${Ur.apiBaseUrl}/repos/${e}`,{headers:{Accept:"application/vnd.github.v3+json"}});if(!r.ok)throw r.status===404?new Error(`Repository not found: ${e}`):r.status===403?new Error(`Repository is private: ${e}`):new Error(`Failed to access repository: ${r.status} ${r.statusText}`);const n=await fetch(`${Ur.apiBaseUrl}/repos/${e}/branches`,{headers:{Accept:"application/vnd.github.v3+json"}});if(!n.ok)throw n.status===404?new Error(`Branches not found for repository: ${e}`):n.status===403?new Error(`Repository is private: ${e}`):new Error(`Failed to fetch branches: ${n.status} ${n.statusText}`);const s=await n.json();try{qr.setBranches(e,s)}catch(i){console.warn("Failed to cache public branches, but continuing with API response:",i)}return s}}const fo=Object.freeze(Object.defineProperty({__proto__:null,GitHubApiService:xt},Symbol.toStringTag,{value:"Module"}));class go{static initializeSession(e){if(!e.editMode.isActive||e.editMode.sourceType==="core")return;const{sourceType:r,sourceId:n,targetRepository:s}=e.editMode;if(r==="core"||!n)return;const i=this.getCurrentSession();if(i&&i.dataSourceContext.sourceType===r&&i.dataSourceContext.sourceId===n){this.currentSession=i,this.updateLastModified();return}this.currentSession={sessionId:this.generateSessionId(),dataSourceContext:{sourceType:r,sourceId:n,targetRepository:s},overrides:[],createdAt:new Date().toISOString(),lastModified:new Date().toISOString()},this.persistSession()}static addOverride(e,r,n){if(!this.currentSession){console.warn("[OverrideTrackingService] No active session for override tracking");return}const{sourceType:s,sourceId:i}=this.currentSession.dataSourceContext,a={tokenId:e,sourceType:s,sourceId:i,overrideData:r,timestamp:new Date().toISOString(),changes:n};this.currentSession.overrides=this.currentSession.overrides.filter(l=>l.tokenId!==e),this.currentSession.overrides.push(a),this.updateLastModified(),this.persistSession(),console.log(`[OverrideTrackingService] Added override for token ${e}:`,a)}static removeOverride(e){this.currentSession&&(this.currentSession.overrides=this.currentSession.overrides.filter(r=>r.tokenId!==e),this.updateLastModified(),this.persistSession(),console.log(`[OverrideTrackingService] Removed override for token ${e}`))}static getPendingOverrides(){return this.currentSession?[...this.currentSession.overrides]:[]}static getPendingOverride(e){return this.currentSession&&this.currentSession.overrides.find(r=>r.tokenId===e)||null}static hasPendingOverride(e){return this.getPendingOverride(e)!==null}static getCurrentSession(){return this.currentSession?{...this.currentSession}:null}static clearSession(){this.currentSession=null,this.clearPersistedSession(),console.log("[OverrideTrackingService] Cleared override session")}static getOverrideDataForCommit(){if(!this.currentSession||this.currentSession.overrides.length===0)return null;const{sourceType:e,sourceId:r}=this.currentSession.dataSourceContext,n=this.currentSession.overrides;if(e==="platform-extension"){const s=n.map(i=>({id:i.tokenId,...i.overrideData}));return{systemId:"design-system",platformId:r,version:"1.0.0",figmaFileKey:`platform-${r}-key`,tokenOverrides:s}}else if(e==="theme-override"){const s=n.map(i=>({tokenId:i.tokenId,valuesByMode:i.overrideData.valuesByMode||[]}));return{systemId:"design-system",themeId:r,figmaFileKey:`theme-${r}-key`,tokenOverrides:s}}return null}static getChangeCount(){return this.currentSession?this.currentSession.overrides.length:0}static hasPendingOverrides(){return this.getChangeCount()>0}static updateLastModified(){this.currentSession&&(this.currentSession.lastModified=new Date().toISOString())}static generateSessionId(){return`override-session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}static persistSession(){if(this.currentSession)try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.currentSession))}catch(e){console.error("[OverrideTrackingService] Failed to persist session:",e)}}static loadPersistedSession(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):null}catch(e){return console.error("[OverrideTrackingService] Failed to load persisted session:",e),null}}static clearPersistedSession(){try{localStorage.removeItem(this.STORAGE_KEY)}catch(e){console.error("[OverrideTrackingService] Failed to clear persisted session:",e)}}}rt(go,"STORAGE_KEY","token-model-pending-overrides"),rt(go,"currentSession",null);class uo{static initializeSession(e){if(!e.editMode.isActive||e.editMode.sourceType==="core")return;const{sourceType:r,sourceId:n,targetRepository:s}=e.editMode;if(r==="core"||!n)return;const i=this.getCurrentSession();if(i&&i.dataSourceContext.sourceType===r&&i.dataSourceContext.sourceId===n){this.currentSession=i,this.updateLastModified();return}this.currentSession={sessionId:this.generateSessionId(),dataSourceContext:{sourceType:r,sourceId:n,targetRepository:s},overrides:[],createdAt:new Date().toISOString(),lastModified:new Date().toISOString()},this.persistSession()}static stageConfigurationChange(e,r,n){if(!this.currentSession){console.warn("[FigmaConfigurationOverrideService] No active session for configuration tracking");return}const{sourceType:s,sourceId:i}=this.currentSession.dataSourceContext,a={sourceType:s,sourceId:i,figmaFileKey:e,fileColorProfile:n,syntaxPatterns:r,timestamp:new Date().toISOString()};this.currentSession.overrides=this.currentSession.overrides.filter(l=>l.sourceId!==i),this.currentSession.overrides.push(a),this.updateLastModified(),this.persistSession(),console.log(`[FigmaConfigurationOverrideService] Staged configuration change for ${s} ${i}:`,a)}static getStagedConfigurationChanges(){if(!this.currentSession||this.currentSession.overrides.length===0)return null;const e=this.currentSession.dataSourceContext.sourceId,r=this.currentSession.overrides.filter(n=>n.sourceId===e);return r.length===0?null:r[r.length-1]}static hasStagedChanges(){return this.getStagedConfigurationChanges()!==null}static getCurrentSession(){return this.currentSession}static clearSession(){this.currentSession=null,this.clearPersistedSession()}static getOverrideDataForCommit(){const e=this.getStagedConfigurationChanges();if(!e)return null;const{sourceType:r,sourceId:n,figmaFileKey:s,fileColorProfile:i,syntaxPatterns:a}=e;return r==="platform-extension"?{systemId:"design-system",platformId:n,version:"1.0.0",figmaFileKey:s,fileColorProfile:i,syntaxPatterns:a}:r==="theme-override"?{systemId:"design-system",themeId:n,figmaFileKey:s,fileColorProfile:i}:null}static updateLastModified(){this.currentSession&&(this.currentSession.lastModified=new Date().toISOString())}static generateSessionId(){return`figma-config-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}static persistSession(){if(this.currentSession)try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.currentSession))}catch(e){console.error("[FigmaConfigurationOverrideService] Failed to persist session:",e)}}static loadPersistedSession(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e)return JSON.parse(e)}catch(e){console.error("[FigmaConfigurationOverrideService] Failed to load persisted session:",e)}return null}static clearPersistedSession(){try{localStorage.removeItem(this.STORAGE_KEY)}catch(e){console.error("[FigmaConfigurationOverrideService] Failed to clear persisted session:",e)}}}rt(uo,"STORAGE_KEY","token-model-figma-config-overrides"),rt(uo,"currentSession",null);class Gn{static hasLocalChanges(){const e=this.getCurrentDataSnapshot(),r=this.getBaselineDataSnapshot();if(!r)return!1;const n=JSON.stringify(e)!==JSON.stringify(r),s=go.hasPendingOverrides(),i=uo.hasStagedChanges();return n||s||i}static getChangeCount(){const e=this.getCurrentDataSnapshot(),r=this.getBaselineDataSnapshot();if(!r)return 0;let n=0;["tokens","collections","dimensions","themes","resolvedValueTypes","taxonomies","algorithms","platforms","componentProperties","componentCategories","components"].forEach(d=>{const u=e[d]||[],m=r[d]||[];if(Array.isArray(u)&&Array.isArray(m)){const g=new Set(u.map(k=>{const A=k;return A==null?void 0:A.id}).filter(Boolean)),y=new Set(m.map(k=>{const A=k;return A==null?void 0:A.id}).filter(Boolean)),v=Array.from(g).filter(k=>!y.has(k)).length,I=Array.from(y).filter(k=>!g.has(k)).length,S=Array.from(g).filter(k=>y.has(k));let b=0;S.forEach(k=>{const A=u.find(T=>{const P=T;return(P==null?void 0:P.id)===k}),C=m.find(T=>{const P=T;return(P==null?void 0:P.id)===k});A&&C&&JSON.stringify(A)!==JSON.stringify(C)&&b++}),n+=v+I+b}});const i=e.taxonomyOrder||[],a=r.taxonomyOrder||[];JSON.stringify(i)!==JSON.stringify(a)&&(n+=1);const l=go.getChangeCount();n+=l;const c=uo.hasStagedChanges()?1:0;return n+=c,n}static async hasGitHubDivergence(){if(!Yt.isAuthenticated())return console.log("[ChangeTrackingService] No GitHub authentication, no divergence"),!1;if(!xt.getSelectedRepositoryInfo())return console.log("[ChangeTrackingService] No repository selected, no divergence"),!1;const r=this.getBaselineDataSnapshot();if(!r)return console.log("[ChangeTrackingService] No baseline data, no divergence"),!1;const n=this.getCurrentDataSnapshot(),s=["tokens","collections","dimensions","themes","resolvedValueTypes","taxonomies","algorithms"];for(const l of s){const c=n[l]||[],d=r[l]||[];if(JSON.stringify(c)!==JSON.stringify(d))return console.log(`[ChangeTrackingService] Divergence detected in field: ${l}`),console.log(`[ChangeTrackingService] Local ${l} count:`,c.length),console.log(`[ChangeTrackingService] Baseline ${l} count:`,d.length),!0}const i=n.taxonomyOrder||[],a=r.taxonomyOrder||[];return JSON.stringify(i)!==JSON.stringify(a)?(console.log("[ChangeTrackingService] Divergence detected in field: taxonomyOrder"),!0):(console.log("[ChangeTrackingService] No divergence detected"),!1)}static async getChangeTrackingState(){const e=this.hasLocalChanges(),r=await this.hasGitHubDivergence(),n=this.getChangeCount(),s=!e||!r;return console.log("[ChangeTrackingService] Change tracking state:",{hasLocalChanges:e,hasGitHubDivergence:r,canExport:s,changeCount:n}),{hasLocalChanges:e,hasGitHubDivergence:r,canExport:s,changeCount:n,lastGitHubSync:this.getLastGitHubSync()}}static getCurrentDataSnapshot(){return{tokens:L.getTokens(),collections:L.getCollections(),modes:L.getModes(),resolvedValueTypes:L.getValueTypes(),dimensions:L.getDimensions(),dimensionOrder:L.getDimensionOrder(),platforms:L.getPlatforms(),themes:L.getThemes(),taxonomies:L.getTaxonomies(),taxonomyOrder:L.getTaxonomyOrder(),algorithms:L.getAlgorithms(),algorithmFile:L.getAlgorithmFile(),platformExtensionFiles:L.getPlatformExtensionFiles(),componentProperties:L.getComponentProperties(),componentCategories:L.getComponentCategories(),components:L.getComponents()}}static getBaselineDataSnapshot(){const e=localStorage.getItem("token-model:baseline-data");if(!e)return null;try{return JSON.parse(e)}catch(r){return console.error("[ChangeTrackingService] Error parsing baseline data:",r),null}}static getLastGitHubSync(){return localStorage.getItem("token-model:last-github-sync")||void 0}static setBaselineData(e){localStorage.setItem("token-model:baseline-data",JSON.stringify(e))}static updateLastGitHubSync(){localStorage.setItem("token-model:last-github-sync",new Date().toISOString())}static setBaselineForSource(e,r,n){switch(e){case"core":{this.baselines.core=n;break}case"platform-extension":{this.baselines.platformExtensions[r]=n;break}case"theme-override":{this.baselines.themeOverrides[r]=n;break}}}static hasChangesInSource(e,r){const n=this.getCurrentDataForSource(e,r),s=this.getBaselineForSource(e,r);return JSON.stringify(n)!==JSON.stringify(s)}static getChangesForSource(e,r){const n=this.getCurrentDataForSource(e,r),s=this.getBaselineForSource(e,r);return this.computeChanges(s,n)}static getCurrentDataForSource(e,r){switch(e){case"core":return L.getCoreData()||{};case"platform-extension":return L.getPlatformExtensionData(r)||{};case"theme-override":return L.getThemeOverrideData(r)||{};default:throw new Error(`Unknown source type: ${e}`)}}static getBaselineForSource(e,r){switch(e){case"core":return this.baselines.core||{};case"platform-extension":return this.baselines.platformExtensions[r]||{};case"theme-override":return this.baselines.themeOverrides[r]||{};default:throw new Error(`Unknown source type: ${e}`)}}static computeChanges(e,r){const n={added:[],modified:[],removed:[],totalChanges:0},s=Object.keys(e),i=Object.keys(r);return i.forEach(a=>{s.includes(a)||n.added.push(a)}),s.forEach(a=>{i.includes(a)||n.removed.push(a)}),s.forEach(a=>{if(i.includes(a)){const l=e[a],c=r[a];JSON.stringify(l)!==JSON.stringify(c)&&n.modified.push(a)}}),n.totalChanges=n.added.length+n.modified.length+n.removed.length,n}static clearAllBaselines(){this.baselines={core:null,platformExtensions:{},themeOverrides:{}}}static getChangeSummary(){const e={core:this.hasChangesInSource("core",""),platforms:{},themes:{},totalChanges:0};return Object.keys(this.baselines.platformExtensions).forEach(r=>{e.platforms[r]=this.hasChangesInSource("platform-extension",r)}),Object.keys(this.baselines.themeOverrides).forEach(r=>{e.themes[r]=this.hasChangesInSource("theme-override",r)}),e.core&&e.totalChanges++,Object.values(e.platforms).forEach(r=>{r&&e.totalChanges++}),Object.values(e.themes).forEach(r=>{r&&e.totalChanges++}),e}static trackOverrideChanges(e,r,n,s,i){const a={tokenId:e,originalValue:r,newValue:n,sourceType:s,sourceId:i,timestamp:new Date().toISOString()};this.overrideChanges=this.overrideChanges.filter(l=>l.tokenId!==e),this.overrideChanges.push(a)}static getOverrideChanges(){return[...this.overrideChanges]}static getChangesForEditSource(e,r){return e==="core"?this.getChangesForSource("core","main"):r?this.getChangesForSource(e,r):{added:[],modified:[],removed:[],totalChanges:0}}static clearOverrideChanges(){this.overrideChanges=[]}static getOverrideChangesForSource(e,r){return this.overrideChanges.filter(n=>n.sourceType===e&&n.sourceId===r)}static hasOverrideChangesForSource(e,r){return this.overrideChanges.some(n=>n.sourceType===e&&n.sourceId===r)}}rt(Gn,"baselines",{core:null,platformExtensions:{},themeOverrides:{}}),rt(Gn,"overrideChanges",[]);class qv{static validateJson(e,r="JSON"){try{return JSON.parse(e),{isValid:!0}}catch(n){if(n instanceof SyntaxError){const s=this.analyzeSyntaxError(n,e,r);return{isValid:!1,error:n.message,...s}}return{isValid:!1,error:n instanceof Error?n.message:"Unknown JSON error"}}}static analyzeSyntaxError(e,r,n){const s={},i=e.message.match(/position (\d+)/);if(i){const a=parseInt(i[1]);s.position=a;const l=r.split(`
`);let c=0;for(let d=0;d<l.length;d++){const u=l[d],m=u.length+1;if(c+m>a){s.lineNumber=d+1,s.columnNumber=a-c,s.problematicLine=u;break}c+=m}}return s.suggestions=this.generateSuggestions(e,s.problematicLine),s}static generateSuggestions(e,r){const n=[];return e.message.includes("Unexpected token")&&(n.push("Check for missing commas between object properties or array elements"),n.push("Ensure all strings are properly quoted with double quotes"),n.push("Verify that all brackets and braces are properly closed")),e.message.includes("Unexpected end of JSON input")&&(n.push("Check for missing closing brackets, braces, or quotes"),n.push("Ensure the JSON file is complete and not truncated")),e.message.includes("Unexpected number")&&(n.push("Check for invalid number formats (e.g., leading zeros, invalid decimals)"),n.push("Ensure numbers are not quoted as strings")),e.message.includes("Unexpected string")&&(n.push("Check for unescaped quotes within strings"),n.push("Ensure all strings use double quotes, not single quotes")),r&&(r.includes("'")&&!r.includes('"')&&n.push("Replace single quotes with double quotes for JSON strings"),(r.includes(",,")||r.includes(",]")||r.includes(",}"))&&n.push("Remove trailing comma before closing bracket or brace"),(r.includes("undefined")||r.includes("null"))&&n.push('Use "null" instead of "undefined" in JSON'),(r.includes("//")||r.includes("/*"))&&n.push("Remove JavaScript-style comments - JSON does not support comments")),n}static formatErrorInfo(e,r,n){const s=this.analyzeSyntaxError(e,r,n);let i=`
[JsonValidator] JSON Syntax Error in ${n}:
`;if(i+=`Error: ${e.message}
`,s.lineNumber&&s.columnNumber&&(i+=`Location: Line ${s.lineNumber}, Column ${s.columnNumber}
`),s.problematicLine&&(i+=`Problematic Line: ${s.problematicLine}
`,s.columnNumber)){const a=" ".repeat(s.columnNumber-1);i+=`              ${a}^
`}return s.suggestions&&s.suggestions.length>0&&(i+=`Suggestions:
`,s.suggestions.forEach(a=>{i+=`  - ${a}
`})),i}static formatJson(e){try{const r=JSON.parse(e);return{isValid:!0,formatted:JSON.stringify(r,null,2)}}catch(r){return{isValid:!1,error:r instanceof Error?r.message:"Unknown error"}}}}class Di{static async getPlatformExtensionData(e,r,n,s){const i=`${s}-${e}-${r}-${n}`,a=this.cache.get(i);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return console.log(`[PlatformExtensionDataService] Using cached data for ${s}`),{data:a.data,source:"cache"};try{console.log(`[PlatformExtensionDataService] Fetching data for ${s} from ${e}/${r}`);let l;const c=await ir(()=>Promise.resolve().then(()=>c3),void 0).then(m=>m.GitHubAuthService.isAuthenticated()),d=e.match(/^company\/design-system-/);if(c&&!d)l=await xt.getFileContent(e,r,n);else{if(d)return console.log(`[PlatformExtensionDataService] Skipping private repository pattern for ${s}: ${e}`),{data:null,source:"not-found",error:"Private repository - access not available"};console.log(`[PlatformExtensionDataService] Using public API for ${s} (user not authenticated)`),l=await xt.getPublicFileContent(e,r,n)}if(!l||!l.content)return console.warn(`[PlatformExtensionDataService] No content found for ${s}`),{data:null,source:"not-found",error:"No content found"};let u;try{u=JSON.parse(l.content)}catch(m){if(console.error(`[PlatformExtensionDataService] JSON parse error for ${s}:`,{error:m,contentLength:l.content.length,contentPreview:l.content.substring(0,200)+"...",repositoryUri:e,filePath:r,branch:n}),m instanceof SyntaxError){const g=qv.formatErrorInfo(m,l.content,`Platform Extension ${s} (${e}/${r})`);console.error(g)}throw m}return!u.systemId||!u.platformId||!u.version?(console.warn(`[PlatformExtensionDataService] Invalid platform extension data for ${s}`),{data:null,source:"not-found",error:"Invalid platform extension data"}):(this.cache.set(i,{data:u,timestamp:Date.now()}),L.setPlatformExtensionFile(s,u),L.setPlatformExtensionFileContent(s,l.content),console.log(`[PlatformExtensionDataService] Successfully fetched and cached data for ${s}`),{data:u,source:"github"})}catch(l){console.error(`[PlatformExtensionDataService] Failed to fetch data for ${s}:`,l);const c=L.getPlatformExtensionFile(s);return c?(console.log(`[PlatformExtensionDataService] Using local storage data for ${s}`),{data:c,source:"localStorage",error:l instanceof Error?l.message:"Unknown error"}):{data:null,source:"not-found",error:l instanceof Error?l.message:"Unknown error"}}}static clearCache(e){const r=[];for(const[n]of this.cache)n.includes(e)&&r.push(n);r.forEach(n=>this.cache.delete(n)),console.log(`[PlatformExtensionDataService] Cleared cache for ${e}`)}static clearAllCache(){this.cache.clear(),console.log("[PlatformExtensionDataService] Cleared all cache")}static getCachedData(e){for(const[n,s]of this.cache)if(n.includes(e))return s.data;return L.getPlatformExtensionFile(e)||null}}rt(Di,"cache",new Map),rt(Di,"CACHE_DURATION",5*60*1e3);const Jv=Object.freeze(Object.defineProperty({__proto__:null,PlatformExtensionDataService:Di},Symbol.toStringTag,{value:"Module"})),ea=class ea{constructor(){rt(this,"cache",new Map);rt(this,"CACHE_DURATION",5*60*1e3)}static getInstance(){return ea.instance||(ea.instance=new ea),ea.instance}async getCachedPlatformExtensionAnalytics(e){const r=e.map(a=>{const l=a.extensionSource?`${a.extensionSource.repositoryUri}:${a.extensionSource.filePath}`:"no-extension";return`${a.id}:${l}`}).join("|"),n=`platform-analytics-${e.length}-${r}`,s=this.cache.get(n);if(s&&Date.now()-s.timestamp<this.CACHE_DURATION)return s.data;const i=await this.calculatePlatformExtensionAnalytics(e);return this.cache.set(n,{data:i,timestamp:Date.now()}),i}async calculatePlatformExtensionAnalytics(e){var c,d,u,m,g,y,v,I,S,b,k,A;const r=[];let n=0,s=0,i=0,a=0,l=0;for(const C of e){if(!C.extensionSource){r.push({platformId:C.id,platformName:C.displayName,tokenOverridesCount:0,algorithmVariableOverridesCount:0,omittedModesCount:0,omittedDimensionsCount:0,hasError:!1});continue}try{const T=await Di.getPlatformExtensionData(C.extensionSource.repositoryUri,C.extensionSource.filePath,"main",C.id);if(T.data&&(T.source==="github"||T.source==="cache")){l++;const P=((c=T.data.tokenOverrides)==null?void 0:c.length)||0,_=((d=T.data.algorithmVariableOverrides)==null?void 0:d.length)||0,R=((u=T.data.omittedModes)==null?void 0:u.length)||0,G=((m=T.data.omittedDimensions)==null?void 0:m.length)||0;n+=P,s+=_,i+=R,a+=G,r.push({platformId:C.id,platformName:C.displayName,version:T.data.version,tokenOverridesCount:P,algorithmVariableOverridesCount:_,omittedModesCount:R,omittedDimensionsCount:G,hasError:!1})}else if(T.data&&T.source==="localStorage")if(C.extensionSource.repositoryUri==="local"){l++;const _=((g=T.data.tokenOverrides)==null?void 0:g.length)||0,R=((y=T.data.algorithmVariableOverrides)==null?void 0:y.length)||0,G=((v=T.data.omittedModes)==null?void 0:v.length)||0,ne=((I=T.data.omittedDimensions)==null?void 0:I.length)||0;n+=_,s+=R,i+=G,a+=ne,r.push({platformId:C.id,platformName:C.displayName,version:T.data.version,tokenOverridesCount:_,algorithmVariableOverridesCount:R,omittedModesCount:G,omittedDimensionsCount:ne,hasError:!1})}else{const _="repository-not-found",R=`Repository not found: ${C.extensionSource.repositoryUri}`;r.push({platformId:C.id,platformName:C.displayName,version:T.data.version,tokenOverridesCount:((S=T.data.tokenOverrides)==null?void 0:S.length)||0,algorithmVariableOverridesCount:((b=T.data.algorithmVariableOverrides)==null?void 0:b.length)||0,omittedModesCount:((k=T.data.omittedModes)==null?void 0:k.length)||0,omittedDimensionsCount:((A=T.data.omittedDimensions)==null?void 0:A.length)||0,hasError:!0,errorType:_,errorMessage:R})}else{const P=C.extensionSource.repositoryUri==="local",_=C.extensionSource.repositoryUri.match(/^company\/design-system-/);let R,G;_?(R="private-repository",G="Private repository - sign in to access"):P?(R="file-not-found",G=`File not found: ${C.extensionSource.filePath}`):(R="repository-not-found",G=`Repository not found: ${C.extensionSource.repositoryUri}`),r.push({platformId:C.id,platformName:C.displayName,tokenOverridesCount:0,algorithmVariableOverridesCount:0,omittedModesCount:0,omittedDimensionsCount:0,hasError:!0,errorType:R,errorMessage:G})}}catch(T){const P=T instanceof Error?T.message:"Unknown error occurred";let _="validation-error";(P.includes("404")||P.includes("Not Found")||P.includes("Failed to fetch file content"))&&(_=C.extensionSource.repositoryUri==="local"?"file-not-found":"repository-not-found"),r.push({platformId:C.id,platformName:C.displayName,tokenOverridesCount:0,algorithmVariableOverridesCount:0,omittedModesCount:0,omittedDimensionsCount:0,hasError:!0,errorType:_,errorMessage:_==="file-not-found"?`File not found: ${C.extensionSource.filePath}`:_==="repository-not-found"?`Repository not found: ${C.extensionSource.repositoryUri}`:P})}}return{totalPlatforms:e.length,platformsWithExtensions:l,totalTokenOverrides:n,totalAlgorithmOverrides:s,totalOmittedModes:i,totalOmittedDimensions:a,platformAnalytics:r}}clearCache(){this.cache.clear()}clearCacheForPlatforms(e){const r=[];for(const[n]of this.cache)e.some(s=>n.includes(s))&&r.push(n);r.forEach(n=>this.cache.delete(n)),console.log("[PlatformExtensionAnalyticsService] Cleared cache for platforms:",e)}};rt(ea,"instance");let eu=ea;class ml{static async getThemeOverrideData(e,r,n="main",s){try{const i=`${e}:${r}:${n}:${s}`,a=this.cache.get(i);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return console.log(`[ThemeOverrideDataService] Returning cached data for ${s}`),{data:a.data,source:"cache"};let l;const c=Yt.isAuthenticated(),d=e.match(/^company\/design-system-/);if(c&&!d)l=await xt.getFileContent(e,r,n);else{if(d)return console.log(`[ThemeOverrideDataService] Skipping private repository pattern for ${s}: ${e}`),{error:"Private repository - access not available",source:"github"};console.log(`[ThemeOverrideDataService] Using public API for ${s} (user not authenticated)`),l=await xt.getPublicFileContent(e,r,n)}if(!l||!l.content)throw new Error(`No content found in ${e}/${r}`);let u;try{u=JSON.parse(l.content)}catch(m){if(console.error(`[ThemeOverrideDataService] JSON parse error for ${s}:`,{error:m,contentLength:l.content.length,contentPreview:l.content.substring(0,200)+"...",repositoryUri:e,filePath:r,branch:n}),m instanceof SyntaxError){const g=qv.formatErrorInfo(m,l.content,`Theme Override ${s} (${e}/${r})`);console.error(g)}throw m}if(u.themeId!==s)throw new Error(`Theme ID mismatch: expected ${s}, got ${u.themeId}`);return this.cache.set(i,{data:u,timestamp:Date.now()}),console.log(`[ThemeOverrideDataService] Successfully loaded theme override data for ${s} from ${e}/${r}`),{data:u,source:"github"}}catch(i){console.error(`[ThemeOverrideDataService] Failed to load theme override data for ${s}:`,{error:i instanceof Error?i.message:"Unknown error",repositoryUri:e,filePath:r,branch:n,themeId:s});try{const a=`theme-override-${s}`,l=localStorage.getItem(a);if(l){const c=JSON.parse(l);return console.log(`[ThemeOverrideDataService] Using localStorage fallback for ${s}`),{data:c,source:"localStorage"}}}catch(a){console.warn(`[ThemeOverrideDataService] localStorage fallback failed for ${s}:`,a)}return{error:i instanceof Error?i.message:"Failed to load theme override data",source:"github"}}}static clearCacheForTheme(e){const r=[];for(const n of this.cache.keys())n.includes(e)&&r.push(n);r.forEach(n=>this.cache.delete(n)),console.log(`[ThemeOverrideDataService] Cleared cache for theme ${e}`)}static clearAllCache(){this.cache.clear(),console.log("[ThemeOverrideDataService] Cleared all cache")}static getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}}rt(ml,"cache",new Map),rt(ml,"CACHE_DURATION",5*60*1e3);const d3=Object.freeze(Object.defineProperty({__proto__:null,ThemeOverrideDataService:ml},Symbol.toStringTag,{value:"Module"}));var Gr;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function r(s){throw new Error}t.assertNever=r,t.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},t.getValidEnumValues=s=>{const i=t.objectKeys(s).filter(l=>typeof s[s[l]]!="number"),a={};for(const l of i)a[l]=s[l];return t.objectValues(a)},t.objectValues=s=>t.objectKeys(s).map(function(i){return s[i]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},t.find=(s,i)=>{for(const a of s)if(i(a))return a},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}t.joinValues=n,t.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(Gr||(Gr={}));var gy;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(gy||(gy={}));const Rt=Gr.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),fi=t=>{switch(typeof t){case"undefined":return Rt.undefined;case"string":return Rt.string;case"number":return Number.isNaN(t)?Rt.nan:Rt.number;case"boolean":return Rt.boolean;case"function":return Rt.function;case"bigint":return Rt.bigint;case"symbol":return Rt.symbol;case"object":return Array.isArray(t)?Rt.array:t===null?Rt.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?Rt.promise:typeof Map<"u"&&t instanceof Map?Rt.map:typeof Set<"u"&&t instanceof Set?Rt.set:typeof Date<"u"&&t instanceof Date?Rt.date:Rt.object;default:return Rt.unknown}},ft=Gr.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class No extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){const r=e||function(i){return i.message},n={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)n._errors.push(r(a));else{let l=n,c=0;for(;c<a.path.length;){const d=a.path[c];c===a.path.length-1?(l[d]=l[d]||{_errors:[]},l[d]._errors.push(r(a))):l[d]=l[d]||{_errors:[]},l=l[d],c++}}};return s(this),n}static assert(e){if(!(e instanceof No))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Gr.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){const r={},n=[];for(const s of this.issues)if(s.path.length>0){const i=s.path[0];r[i]=r[i]||[],r[i].push(e(s))}else n.push(e(s));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}No.create=t=>new No(t);const Xm=(t,e)=>{let r;switch(t.code){case ft.invalid_type:t.received===Rt.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case ft.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Gr.jsonStringifyReplacer)}`;break;case ft.unrecognized_keys:r=`Unrecognized key(s) in object: ${Gr.joinValues(t.keys,", ")}`;break;case ft.invalid_union:r="Invalid input";break;case ft.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Gr.joinValues(t.options)}`;break;case ft.invalid_enum_value:r=`Invalid enum value. Expected ${Gr.joinValues(t.options)}, received '${t.received}'`;break;case ft.invalid_arguments:r="Invalid function arguments";break;case ft.invalid_return_type:r="Invalid function return type";break;case ft.invalid_date:r="Invalid date";break;case ft.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Gr.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case ft.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case ft.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case ft.custom:r="Invalid input";break;case ft.invalid_intersection_types:r="Intersection results could not be merged";break;case ft.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case ft.not_finite:r="Number must be finite";break;default:r=e.defaultError,Gr.assertNever(t)}return{message:r}};let u3=Xm;function h3(){return u3}const m3=t=>{const{data:e,path:r,errorMaps:n,issueData:s}=t,i=[...r,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let l="";const c=n.filter(d=>!!d).slice().reverse();for(const d of c)l=d(a,{data:e,defaultError:l}).message;return{...s,path:i,message:l}};function jt(t,e){const r=h3(),n=m3({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Xm?void 0:Xm].filter(s=>!!s)});t.common.issues.push(n)}class gs{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){const n=[];for(const s of r){if(s.status==="aborted")return ar;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){const n=[];for(const s of r){const i=await s.key,a=await s.value;n.push({key:i,value:a})}return gs.mergeObjectSync(e,n)}static mergeObjectSync(e,r){const n={};for(const s of r){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return ar;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(n[i.value]=a.value)}return{status:e.value,value:n}}}const ar=Object.freeze({status:"aborted"}),Zl=t=>({status:"dirty",value:t}),io=t=>({status:"valid",value:t}),yy=t=>t.status==="aborted",xy=t=>t.status==="dirty",pl=t=>t.status==="valid",tu=t=>typeof Promise<"u"&&t instanceof Promise;var Ht;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(Ht||(Ht={}));class Do{constructor(e,r,n,s){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const vy=(t,e)=>{if(pl(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new No(t.common.issues);return this._error=r,this._error}}};function wr(t){if(!t)return{};const{errorMap:e,invalid_type_error:r,required_error:n,description:s}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,l)=>{const{message:c}=t;return a.code==="invalid_enum_value"?{message:c??l.defaultError}:typeof l.data>"u"?{message:c??n??l.defaultError}:a.code!=="invalid_type"?{message:l.defaultError}:{message:c??r??l.defaultError}},description:s}}class Er{get description(){return this._def.description}_getType(e){return fi(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:fi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new gs,ctx:{common:e.parent.common,data:e.data,parsedType:fi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const r=this._parse(e);if(tu(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){const r=this._parse(e);return Promise.resolve(r)}parse(e,r){const n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){const n={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:fi(e)},s=this._parseSync({data:e,path:n.path,parent:n});return vy(n,s)}"~validate"(e){var n,s;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:fi(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:r});return pl(i)?{value:i.value}:{issues:r.common.issues}}catch(i){(s=(n=i==null?void 0:i.message)==null?void 0:n.toLowerCase())!=null&&s.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(i=>pl(i)?{value:i.value}:{issues:r.common.issues})}async parseAsync(e,r){const n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:fi(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(tu(s)?s:Promise.resolve(s));return vy(n,i)}refine(e,r){const n=s=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(s):r;return this._refinement((s,i)=>{const a=e(s),l=()=>i.addIssue({code:ft.custom,...n(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(c=>c?!0:(l(),!1)):a?!0:(l(),!1)})}refinement(e,r){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof r=="function"?r(n,s):r),!1))}_refinement(e){return new Fa({schema:this,typeName:lr.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ei.create(this,this._def)}nullable(){return Va.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ao.create(this)}promise(){return au.create(this,this._def)}or(e){return nu.create([this,e],this._def)}and(e){return su.create(this,e,this._def)}transform(e){return new Fa({...wr(this._def),schema:this,typeName:lr.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const r=typeof e=="function"?e:()=>e;return new lu({...wr(this._def),innerType:this,defaultValue:r,typeName:lr.ZodDefault})}brand(){return new Xv({typeName:lr.ZodBranded,type:this,...wr(this._def)})}catch(e){const r=typeof e=="function"?e:()=>e;return new cu({...wr(this._def),innerType:this,catchValue:r,typeName:lr.ZodCatch})}describe(e){const r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Df.create(this,e)}readonly(){return du.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const p3=/^c[^\s-]{8,}$/i,f3=/^[0-9a-z]+$/,g3=/^[0-9A-HJKMNP-TV-Z]{26}$/i,y3=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,x3=/^[a-z0-9_-]{21}$/i,v3=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,b3=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,S3=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,w3="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let tm;const C3=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,k3=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,I3=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,j3=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,T3=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,E3=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Yv="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",M3=new RegExp(`^${Yv}$`);function Kv(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function A3(t){return new RegExp(`^${Kv(t)}$`)}function P3(t){let e=`${Yv}T${Kv(t)}`;const r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function N3(t,e){return!!((e==="v4"||!e)&&C3.test(t)||(e==="v6"||!e)&&I3.test(t))}function D3(t,e){if(!v3.test(t))return!1;try{const[r]=t.split(".");if(!r)return!1;const n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function R3(t,e){return!!((e==="v4"||!e)&&k3.test(t)||(e==="v6"||!e)&&j3.test(t))}class Ko extends Er{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Rt.string){const i=this._getOrReturnCtx(e);return jt(i,{code:ft.invalid_type,expected:Rt.string,received:i.parsedType}),ar}const n=new gs;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),jt(s,{code:ft.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),jt(s,{code:ft.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,l=e.data.length<i.value;(a||l)&&(s=this._getOrReturnCtx(e,s),a?jt(s,{code:ft.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):l&&jt(s,{code:ft.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")S3.test(e.data)||(s=this._getOrReturnCtx(e,s),jt(s,{validation:"email",code:ft.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")tm||(tm=new RegExp(w3,"u")),tm.test(e.data)||(s=this._getOrReturnCtx(e,s),jt(s,{validation:"emoji",code:ft.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")y3.test(e.data)||(s=this._getOrReturnCtx(e,s),jt(s,{validation:"uuid",code:ft.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")x3.test(e.data)||(s=this._getOrReturnCtx(e,s),jt(s,{validation:"nanoid",code:ft.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")p3.test(e.data)||(s=this._getOrReturnCtx(e,s),jt(s,{validation:"cuid",code:ft.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")f3.test(e.data)||(s=this._getOrReturnCtx(e,s),jt(s,{validation:"cuid2",code:ft.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")g3.test(e.data)||(s=this._getOrReturnCtx(e,s),jt(s,{validation:"ulid",code:ft.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),jt(s,{validation:"url",code:ft.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),jt(s,{validation:"regex",code:ft.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),jt(s,{code:ft.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),jt(s,{code:ft.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),jt(s,{code:ft.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?P3(i).test(e.data)||(s=this._getOrReturnCtx(e,s),jt(s,{code:ft.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?M3.test(e.data)||(s=this._getOrReturnCtx(e,s),jt(s,{code:ft.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?A3(i).test(e.data)||(s=this._getOrReturnCtx(e,s),jt(s,{code:ft.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?b3.test(e.data)||(s=this._getOrReturnCtx(e,s),jt(s,{validation:"duration",code:ft.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?N3(e.data,i.version)||(s=this._getOrReturnCtx(e,s),jt(s,{validation:"ip",code:ft.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?D3(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),jt(s,{validation:"jwt",code:ft.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?R3(e.data,i.version)||(s=this._getOrReturnCtx(e,s),jt(s,{validation:"cidr",code:ft.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?T3.test(e.data)||(s=this._getOrReturnCtx(e,s),jt(s,{validation:"base64",code:ft.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?E3.test(e.data)||(s=this._getOrReturnCtx(e,s),jt(s,{validation:"base64url",code:ft.invalid_string,message:i.message}),n.dirty()):Gr.assertNever(i);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(s=>e.test(s),{validation:r,code:ft.invalid_string,...Ht.errToObj(n)})}_addCheck(e){return new Ko({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Ht.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Ht.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Ht.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Ht.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Ht.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Ht.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Ht.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Ht.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Ht.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Ht.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Ht.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Ht.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Ht.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...Ht.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...Ht.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Ht.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...Ht.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r==null?void 0:r.position,...Ht.errToObj(r==null?void 0:r.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...Ht.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...Ht.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...Ht.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...Ht.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...Ht.errToObj(r)})}nonempty(e){return this.min(1,Ht.errToObj(e))}trim(){return new Ko({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ko({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ko({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}Ko.create=t=>new Ko({checks:[],typeName:lr.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...wr(t)});function O3(t,e){const r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=r>n?r:n,i=Number.parseInt(t.toFixed(s).replace(".","")),a=Number.parseInt(e.toFixed(s).replace(".",""));return i%a/10**s}class fl extends Er{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Rt.number){const i=this._getOrReturnCtx(e);return jt(i,{code:ft.invalid_type,expected:Rt.number,received:i.parsedType}),ar}let n;const s=new gs;for(const i of this._def.checks)i.kind==="int"?Gr.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),jt(n,{code:ft.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),jt(n,{code:ft.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),jt(n,{code:ft.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?O3(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),jt(n,{code:ft.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),jt(n,{code:ft.not_finite,message:i.message}),s.dirty()):Gr.assertNever(i);return{status:s.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,Ht.toString(r))}gt(e,r){return this.setLimit("min",e,!1,Ht.toString(r))}lte(e,r){return this.setLimit("max",e,!0,Ht.toString(r))}lt(e,r){return this.setLimit("max",e,!1,Ht.toString(r))}setLimit(e,r,n,s){return new fl({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:Ht.toString(s)}]})}_addCheck(e){return new fl({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Ht.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Ht.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Ht.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Ht.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Ht.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:Ht.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:Ht.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Ht.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Ht.toString(e)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Gr.isInteger(e.value))}get isFinite(){let e=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}}fl.create=t=>new fl({checks:[],typeName:lr.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...wr(t)});class mc extends Er{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Rt.bigint)return this._getInvalidInput(e);let n;const s=new gs;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),jt(n,{code:ft.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),jt(n,{code:ft.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),jt(n,{code:ft.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):Gr.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){const r=this._getOrReturnCtx(e);return jt(r,{code:ft.invalid_type,expected:Rt.bigint,received:r.parsedType}),ar}gte(e,r){return this.setLimit("min",e,!0,Ht.toString(r))}gt(e,r){return this.setLimit("min",e,!1,Ht.toString(r))}lte(e,r){return this.setLimit("max",e,!0,Ht.toString(r))}lt(e,r){return this.setLimit("max",e,!1,Ht.toString(r))}setLimit(e,r,n,s){return new mc({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:Ht.toString(s)}]})}_addCheck(e){return new mc({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Ht.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Ht.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Ht.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Ht.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:Ht.toString(r)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}mc.create=t=>new mc({checks:[],typeName:lr.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...wr(t)});class Qm extends Er{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Rt.boolean){const n=this._getOrReturnCtx(e);return jt(n,{code:ft.invalid_type,expected:Rt.boolean,received:n.parsedType}),ar}return io(e.data)}}Qm.create=t=>new Qm({typeName:lr.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...wr(t)});class ru extends Er{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Rt.date){const i=this._getOrReturnCtx(e);return jt(i,{code:ft.invalid_type,expected:Rt.date,received:i.parsedType}),ar}if(Number.isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return jt(i,{code:ft.invalid_date}),ar}const n=new gs;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),jt(s,{code:ft.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),jt(s,{code:ft.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):Gr.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ru({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:Ht.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:Ht.toString(r)})}get minDate(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}}ru.create=t=>new ru({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:lr.ZodDate,...wr(t)});class by extends Er{_parse(e){if(this._getType(e)!==Rt.symbol){const n=this._getOrReturnCtx(e);return jt(n,{code:ft.invalid_type,expected:Rt.symbol,received:n.parsedType}),ar}return io(e.data)}}by.create=t=>new by({typeName:lr.ZodSymbol,...wr(t)});class ep extends Er{_parse(e){if(this._getType(e)!==Rt.undefined){const n=this._getOrReturnCtx(e);return jt(n,{code:ft.invalid_type,expected:Rt.undefined,received:n.parsedType}),ar}return io(e.data)}}ep.create=t=>new ep({typeName:lr.ZodUndefined,...wr(t)});class tp extends Er{_parse(e){if(this._getType(e)!==Rt.null){const n=this._getOrReturnCtx(e);return jt(n,{code:ft.invalid_type,expected:Rt.null,received:n.parsedType}),ar}return io(e.data)}}tp.create=t=>new tp({typeName:lr.ZodNull,...wr(t)});class rp extends Er{constructor(){super(...arguments),this._any=!0}_parse(e){return io(e.data)}}rp.create=t=>new rp({typeName:lr.ZodAny,...wr(t)});class Sy extends Er{constructor(){super(...arguments),this._unknown=!0}_parse(e){return io(e.data)}}Sy.create=t=>new Sy({typeName:lr.ZodUnknown,...wr(t)});class Ri extends Er{_parse(e){const r=this._getOrReturnCtx(e);return jt(r,{code:ft.invalid_type,expected:Rt.never,received:r.parsedType}),ar}}Ri.create=t=>new Ri({typeName:lr.ZodNever,...wr(t)});class wy extends Er{_parse(e){if(this._getType(e)!==Rt.undefined){const n=this._getOrReturnCtx(e);return jt(n,{code:ft.invalid_type,expected:Rt.void,received:n.parsedType}),ar}return io(e.data)}}wy.create=t=>new wy({typeName:lr.ZodVoid,...wr(t)});class Ao extends Er{_parse(e){const{ctx:r,status:n}=this._processInputParams(e),s=this._def;if(r.parsedType!==Rt.array)return jt(r,{code:ft.invalid_type,expected:Rt.array,received:r.parsedType}),ar;if(s.exactLength!==null){const a=r.data.length>s.exactLength.value,l=r.data.length<s.exactLength.value;(a||l)&&(jt(r,{code:a?ft.too_big:ft.too_small,minimum:l?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&r.data.length<s.minLength.value&&(jt(r,{code:ft.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&r.data.length>s.maxLength.value&&(jt(r,{code:ft.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((a,l)=>s.type._parseAsync(new Do(r,a,r.path,l)))).then(a=>gs.mergeArray(n,a));const i=[...r.data].map((a,l)=>s.type._parseSync(new Do(r,a,r.path,l)));return gs.mergeArray(n,i)}get element(){return this._def.type}min(e,r){return new Ao({...this._def,minLength:{value:e,message:Ht.toString(r)}})}max(e,r){return new Ao({...this._def,maxLength:{value:e,message:Ht.toString(r)}})}length(e,r){return new Ao({...this._def,exactLength:{value:e,message:Ht.toString(r)}})}nonempty(e){return this.min(1,e)}}Ao.create=(t,e)=>new Ao({type:t,minLength:null,maxLength:null,exactLength:null,typeName:lr.ZodArray,...wr(e)});function il(t){if(t instanceof Rn){const e={};for(const r in t.shape){const n=t.shape[r];e[r]=ei.create(il(n))}return new Rn({...t._def,shape:()=>e})}else return t instanceof Ao?new Ao({...t._def,type:il(t.element)}):t instanceof ei?ei.create(il(t.unwrap())):t instanceof Va?Va.create(il(t.unwrap())):t instanceof Oa?Oa.create(t.items.map(e=>il(e))):t}class Rn extends Er{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),r=Gr.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==Rt.object){const d=this._getOrReturnCtx(e);return jt(d,{code:ft.invalid_type,expected:Rt.object,received:d.parsedType}),ar}const{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),l=[];if(!(this._def.catchall instanceof Ri&&this._def.unknownKeys==="strip"))for(const d in s.data)a.includes(d)||l.push(d);const c=[];for(const d of a){const u=i[d],m=s.data[d];c.push({key:{status:"valid",value:d},value:u._parse(new Do(s,m,s.path,d)),alwaysSet:d in s.data})}if(this._def.catchall instanceof Ri){const d=this._def.unknownKeys;if(d==="passthrough")for(const u of l)c.push({key:{status:"valid",value:u},value:{status:"valid",value:s.data[u]}});else if(d==="strict")l.length>0&&(jt(s,{code:ft.unrecognized_keys,keys:l}),n.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const u of l){const m=s.data[u];c.push({key:{status:"valid",value:u},value:d._parse(new Do(s,m,s.path,u)),alwaysSet:u in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const d=[];for(const u of c){const m=await u.key,g=await u.value;d.push({key:m,value:g,alwaysSet:u.alwaysSet})}return d}).then(d=>gs.mergeObjectSync(n,d)):gs.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return Ht.errToObj,new Rn({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{var i,a;const s=((a=(i=this._def).errorMap)==null?void 0:a.call(i,r,n).message)??n.defaultError;return r.code==="unrecognized_keys"?{message:Ht.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new Rn({...this._def,unknownKeys:"strip"})}passthrough(){return new Rn({...this._def,unknownKeys:"passthrough"})}extend(e){return new Rn({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Rn({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:lr.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new Rn({...this._def,catchall:e})}pick(e){const r={};for(const n of Gr.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new Rn({...this._def,shape:()=>r})}omit(e){const r={};for(const n of Gr.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new Rn({...this._def,shape:()=>r})}deepPartial(){return il(this)}partial(e){const r={};for(const n of Gr.objectKeys(this.shape)){const s=this.shape[n];e&&!e[n]?r[n]=s:r[n]=s.optional()}return new Rn({...this._def,shape:()=>r})}required(e){const r={};for(const n of Gr.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof ei;)i=i._def.innerType;r[n]=i}return new Rn({...this._def,shape:()=>r})}keyof(){return Zv(Gr.objectKeys(this.shape))}}Rn.create=(t,e)=>new Rn({shape:()=>t,unknownKeys:"strip",catchall:Ri.create(),typeName:lr.ZodObject,...wr(e)});Rn.strictCreate=(t,e)=>new Rn({shape:()=>t,unknownKeys:"strict",catchall:Ri.create(),typeName:lr.ZodObject,...wr(e)});Rn.lazycreate=(t,e)=>new Rn({shape:t,unknownKeys:"strip",catchall:Ri.create(),typeName:lr.ZodObject,...wr(e)});class nu extends Er{_parse(e){const{ctx:r}=this._processInputParams(e),n=this._def.options;function s(i){for(const l of i)if(l.result.status==="valid")return l.result;for(const l of i)if(l.result.status==="dirty")return r.common.issues.push(...l.ctx.common.issues),l.result;const a=i.map(l=>new No(l.ctx.common.issues));return jt(r,{code:ft.invalid_union,unionErrors:a}),ar}if(r.common.async)return Promise.all(n.map(async i=>{const a={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const c of n){const d={...r,common:{...r.common,issues:[]},parent:null},u=c._parseSync({data:r.data,path:r.path,parent:d});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:d}),d.common.issues.length&&a.push(d.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;const l=a.map(c=>new No(c));return jt(r,{code:ft.invalid_union,unionErrors:l}),ar}}get options(){return this._def.options}}nu.create=(t,e)=>new nu({options:t,typeName:lr.ZodUnion,...wr(e)});const qo=t=>t instanceof sp?qo(t.schema):t instanceof Fa?qo(t.innerType()):t instanceof iu?[t.value]:t instanceof _a?t.options:t instanceof op?Gr.objectValues(t.enum):t instanceof lu?qo(t._def.innerType):t instanceof ep?[void 0]:t instanceof tp?[null]:t instanceof ei?[void 0,...qo(t.unwrap())]:t instanceof Va?[null,...qo(t.unwrap())]:t instanceof Xv||t instanceof du?qo(t.unwrap()):t instanceof cu?qo(t._def.innerType):[];class Nf extends Er{_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==Rt.object)return jt(r,{code:ft.invalid_type,expected:Rt.object,received:r.parsedType}),ar;const n=this.discriminator,s=r.data[n],i=this.optionsMap.get(s);return i?r.common.async?i._parseAsync({data:r.data,path:r.path,parent:r}):i._parseSync({data:r.data,path:r.path,parent:r}):(jt(r,{code:ft.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),ar)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){const s=new Map;for(const i of r){const a=qo(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const l of a){if(s.has(l))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(l)}`);s.set(l,i)}}return new Nf({typeName:lr.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:s,...wr(n)})}}function np(t,e){const r=fi(t),n=fi(e);if(t===e)return{valid:!0,data:t};if(r===Rt.object&&n===Rt.object){const s=Gr.objectKeys(e),i=Gr.objectKeys(t).filter(l=>s.indexOf(l)!==-1),a={...t,...e};for(const l of i){const c=np(t[l],e[l]);if(!c.valid)return{valid:!1};a[l]=c.data}return{valid:!0,data:a}}else if(r===Rt.array&&n===Rt.array){if(t.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<t.length;i++){const a=t[i],l=e[i],c=np(a,l);if(!c.valid)return{valid:!1};s.push(c.data)}return{valid:!0,data:s}}else return r===Rt.date&&n===Rt.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class su extends Er{_parse(e){const{status:r,ctx:n}=this._processInputParams(e),s=(i,a)=>{if(yy(i)||yy(a))return ar;const l=np(i.value,a.value);return l.valid?((xy(i)||xy(a))&&r.dirty(),{status:r.value,value:l.data}):(jt(n,{code:ft.invalid_intersection_types}),ar)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}su.create=(t,e,r)=>new su({left:t,right:e,typeName:lr.ZodIntersection,...wr(r)});class Oa extends Er{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==Rt.array)return jt(n,{code:ft.invalid_type,expected:Rt.array,received:n.parsedType}),ar;if(n.data.length<this._def.items.length)return jt(n,{code:ft.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ar;!this._def.rest&&n.data.length>this._def.items.length&&(jt(n,{code:ft.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const i=[...n.data].map((a,l)=>{const c=this._def.items[l]||this._def.rest;return c?c._parse(new Do(n,a,n.path,l)):null}).filter(a=>!!a);return n.common.async?Promise.all(i).then(a=>gs.mergeArray(r,a)):gs.mergeArray(r,i)}get items(){return this._def.items}rest(e){return new Oa({...this._def,rest:e})}}Oa.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Oa({items:t,typeName:lr.ZodTuple,rest:null,...wr(e)})};class ou extends Er{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==Rt.object)return jt(n,{code:ft.invalid_type,expected:Rt.object,received:n.parsedType}),ar;const s=[],i=this._def.keyType,a=this._def.valueType;for(const l in n.data)s.push({key:i._parse(new Do(n,l,n.path,l)),value:a._parse(new Do(n,n.data[l],n.path,l)),alwaysSet:l in n.data});return n.common.async?gs.mergeObjectAsync(r,s):gs.mergeObjectSync(r,s)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof Er?new ou({keyType:e,valueType:r,typeName:lr.ZodRecord,...wr(n)}):new ou({keyType:Ko.create(),valueType:e,typeName:lr.ZodRecord,...wr(r)})}}class Cy extends Er{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==Rt.map)return jt(n,{code:ft.invalid_type,expected:Rt.map,received:n.parsedType}),ar;const s=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map(([l,c],d)=>({key:s._parse(new Do(n,l,n.path,[d,"key"])),value:i._parse(new Do(n,c,n.path,[d,"value"]))}));if(n.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const c of a){const d=await c.key,u=await c.value;if(d.status==="aborted"||u.status==="aborted")return ar;(d.status==="dirty"||u.status==="dirty")&&r.dirty(),l.set(d.value,u.value)}return{status:r.value,value:l}})}else{const l=new Map;for(const c of a){const d=c.key,u=c.value;if(d.status==="aborted"||u.status==="aborted")return ar;(d.status==="dirty"||u.status==="dirty")&&r.dirty(),l.set(d.value,u.value)}return{status:r.value,value:l}}}}Cy.create=(t,e,r)=>new Cy({valueType:e,keyType:t,typeName:lr.ZodMap,...wr(r)});class pc extends Er{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==Rt.set)return jt(n,{code:ft.invalid_type,expected:Rt.set,received:n.parsedType}),ar;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(jt(n,{code:ft.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),r.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(jt(n,{code:ft.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),r.dirty());const i=this._def.valueType;function a(c){const d=new Set;for(const u of c){if(u.status==="aborted")return ar;u.status==="dirty"&&r.dirty(),d.add(u.value)}return{status:r.value,value:d}}const l=[...n.data.values()].map((c,d)=>i._parse(new Do(n,c,n.path,d)));return n.common.async?Promise.all(l).then(c=>a(c)):a(l)}min(e,r){return new pc({...this._def,minSize:{value:e,message:Ht.toString(r)}})}max(e,r){return new pc({...this._def,maxSize:{value:e,message:Ht.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}}pc.create=(t,e)=>new pc({valueType:t,minSize:null,maxSize:null,typeName:lr.ZodSet,...wr(e)});class sp extends Er{get schema(){return this._def.getter()}_parse(e){const{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}sp.create=(t,e)=>new sp({getter:t,typeName:lr.ZodLazy,...wr(e)});class iu extends Er{_parse(e){if(e.data!==this._def.value){const r=this._getOrReturnCtx(e);return jt(r,{received:r.data,code:ft.invalid_literal,expected:this._def.value}),ar}return{status:"valid",value:e.data}}get value(){return this._def.value}}iu.create=(t,e)=>new iu({value:t,typeName:lr.ZodLiteral,...wr(e)});function Zv(t,e){return new _a({values:t,typeName:lr.ZodEnum,...wr(e)})}class _a extends Er{_parse(e){if(typeof e.data!="string"){const r=this._getOrReturnCtx(e),n=this._def.values;return jt(r,{expected:Gr.joinValues(n),received:r.parsedType,code:ft.invalid_type}),ar}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const r=this._getOrReturnCtx(e),n=this._def.values;return jt(r,{received:r.data,code:ft.invalid_enum_value,options:n}),ar}return io(e.data)}get options(){return this._def.values}get enum(){const e={};for(const r of this._def.values)e[r]=r;return e}get Values(){const e={};for(const r of this._def.values)e[r]=r;return e}get Enum(){const e={};for(const r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return _a.create(e,{...this._def,...r})}exclude(e,r=this._def){return _a.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}}_a.create=Zv;class op extends Er{_parse(e){const r=Gr.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==Rt.string&&n.parsedType!==Rt.number){const s=Gr.objectValues(r);return jt(n,{expected:Gr.joinValues(s),received:n.parsedType,code:ft.invalid_type}),ar}if(this._cache||(this._cache=new Set(Gr.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const s=Gr.objectValues(r);return jt(n,{received:n.data,code:ft.invalid_enum_value,options:s}),ar}return io(e.data)}get enum(){return this._def.values}}op.create=(t,e)=>new op({values:t,typeName:lr.ZodNativeEnum,...wr(e)});class au extends Er{unwrap(){return this._def.type}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==Rt.promise&&r.common.async===!1)return jt(r,{code:ft.invalid_type,expected:Rt.promise,received:r.parsedType}),ar;const n=r.parsedType===Rt.promise?r.data:Promise.resolve(r.data);return io(n.then(s=>this._def.type.parseAsync(s,{path:r.path,errorMap:r.common.contextualErrorMap})))}}au.create=(t,e)=>new au({type:t,typeName:lr.ZodPromise,...wr(e)});class Fa extends Er{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===lr.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:r,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{jt(n,a),a.fatal?r.abort():r.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const a=s.transform(n.data,i);if(n.common.async)return Promise.resolve(a).then(async l=>{if(r.value==="aborted")return ar;const c=await this._def.schema._parseAsync({data:l,path:n.path,parent:n});return c.status==="aborted"?ar:c.status==="dirty"||r.value==="dirty"?Zl(c.value):c});{if(r.value==="aborted")return ar;const l=this._def.schema._parseSync({data:a,path:n.path,parent:n});return l.status==="aborted"?ar:l.status==="dirty"||r.value==="dirty"?Zl(l.value):l}}if(s.type==="refinement"){const a=l=>{const c=s.refinement(l,i);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(n.common.async===!1){const l=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return l.status==="aborted"?ar:(l.status==="dirty"&&r.dirty(),a(l.value),{status:r.value,value:l.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(l=>l.status==="aborted"?ar:(l.status==="dirty"&&r.dirty(),a(l.value).then(()=>({status:r.value,value:l.value}))))}if(s.type==="transform")if(n.common.async===!1){const a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!pl(a))return ar;const l=s.transform(a.value,i);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:l}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>pl(a)?Promise.resolve(s.transform(a.value,i)).then(l=>({status:r.value,value:l})):ar);Gr.assertNever(s)}}Fa.create=(t,e,r)=>new Fa({schema:t,typeName:lr.ZodEffects,effect:e,...wr(r)});Fa.createWithPreprocess=(t,e,r)=>new Fa({schema:e,effect:{type:"preprocess",transform:t},typeName:lr.ZodEffects,...wr(r)});class ei extends Er{_parse(e){return this._getType(e)===Rt.undefined?io(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ei.create=(t,e)=>new ei({innerType:t,typeName:lr.ZodOptional,...wr(e)});class Va extends Er{_parse(e){return this._getType(e)===Rt.null?io(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Va.create=(t,e)=>new Va({innerType:t,typeName:lr.ZodNullable,...wr(e)});class lu extends Er{_parse(e){const{ctx:r}=this._processInputParams(e);let n=r.data;return r.parsedType===Rt.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}lu.create=(t,e)=>new lu({innerType:t,typeName:lr.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...wr(e)});class cu extends Er{_parse(e){const{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return tu(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new No(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new No(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}cu.create=(t,e)=>new cu({innerType:t,typeName:lr.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...wr(e)});class ky extends Er{_parse(e){if(this._getType(e)!==Rt.nan){const n=this._getOrReturnCtx(e);return jt(n,{code:ft.invalid_type,expected:Rt.nan,received:n.parsedType}),ar}return{status:"valid",value:e.data}}}ky.create=t=>new ky({typeName:lr.ZodNaN,...wr(t)});class Xv extends Er{_parse(e){const{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class Df extends Er{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?ar:i.status==="dirty"?(r.dirty(),Zl(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?ar:s.status==="dirty"?(r.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,r){return new Df({in:e,out:r,typeName:lr.ZodPipeline})}}class du extends Er{_parse(e){const r=this._def.innerType._parse(e),n=s=>(pl(s)&&(s.value=Object.freeze(s.value)),s);return tu(r)?r.then(s=>n(s)):n(r)}unwrap(){return this._def.innerType}}du.create=(t,e)=>new du({innerType:t,typeName:lr.ZodReadonly,...wr(e)});var lr;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(lr||(lr={}));const ye=Ko.create,$r=fl.create,en=Qm.create,os=rp.create;Ri.create;const mt=Ao.create,ot=Rn.create,En=nu.create,_3=Nf.create;su.create;Oa.create;const Li=ou.create,Iy=iu.create,hr=_a.create;au.create;ei.create;Va.create;const ip=hr(["COLOR","DIMENSION","SPACING","FONT_FAMILY","FONT_WEIGHT","FONT_SIZE","LINE_HEIGHT","LETTER_SPACING","DURATION","CUBIC_BEZIER","BLUR","SPREAD","RADIUS"]),Qv=ot({pattern:ye().optional(),minimum:$r().optional(),maximum:$r().optional(),allowedValues:mt(ye()).optional()}),uu=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),displayName:ye(),type:ip.optional(),description:ye().optional(),validation:Qv.optional()}),ap=hr(["experimental","stable","deprecated"]),lp=hr(["PRIMITIVE","SEMANTIC","COMPONENT"]),fc=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),displayName:ye(),category:hr(["color","typography","spacing","dimension","effect","border","layout","animation"]),compatibleValueTypes:mt(ye()),platformMappings:ot({css:mt(ye()).optional(),figma:mt(ye()).optional(),ios:mt(ye()).optional(),android:mt(ye()).optional()}).optional(),defaultUnit:ye().optional(),inheritance:en().default(!1)}),cp=hr(["MOST_SPECIFIC_MATCH","DIMENSION_PRIORITY","NEAREST_PARENT","DEFAULT_VALUE"]),gl=ot({hex:ye().regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{8})$/),rgb:ot({r:$r().int().min(0).max(255),g:$r().int().min(0).max(255),b:$r().int().min(0).max(255),a:$r().min(0).max(1).optional()}).optional()}),us=En([ot({value:$r(),unit:hr(["px","rem","%","em","vh","vw","pt"])}),ye().regex(/^[0-9]+(\.[0-9]+)?(px|rem|%|em|vh|vw|pt)$/)]),dp=En([ot({value:$r().min(0),unit:hr(["ms","s"])}),ye().regex(/^[0-9]+(\.[0-9]+)?(ms|s)$/)]),up=En([ot({x1:$r().min(0).max(1),y1:$r(),x2:$r().min(0).max(1),y2:$r()}),ye().regex(/^cubic-bezier\([0-9]*(\.[0-9]+)?, ?[0-9]*(\.[0-9]+)?, ?[0-9]*(\.[0-9]+)?, ?[0-9]*(\.[0-9]+)?\)$/)]),hp=En([ot({offsetX:us,offsetY:us,blur:us,spread:us,color:gl,inset:en().optional()}),mt(ot({offsetX:us,offsetY:us,blur:us,spread:us,color:gl,inset:en().optional()})),ye().regex(/^([0-9]+(\.[0-9]+)?(px|rem) [0-9]+(\.[0-9]+)?(px|rem) [0-9]+(\.[0-9]+)?(px|rem) [0-9]+(\.[0-9]+)?(px|rem) (#[A-Fa-f0-9]{6}|rgba?\([0-9]+, ?[0-9]+, ?[0-9]+(, ?[0-9]+(\.[0-9]+)?)?\))( inset)?)(, ?[0-9]+(\.[0-9]+)?(px|rem) [0-9]+(\.[0-9]+)?(px|rem) [0-9]+(\.[0-9]+)?(px|rem) [0-9]+(\.[0-9]+)?(px|rem) (#[A-Fa-f0-9]{6}|rgba?\([0-9]+, ?[0-9]+, ?[0-9]+(, ?[0-9]+(\.[0-9]+)?)?\))( inset)?)*$/)]),mp=ot({fontFamily:ye(),fontSize:us,fontWeight:En([$r().int().min(100).max(900).multipleOf(100),hr(["normal","bold","lighter","bolder"])]),lineHeight:En([$r(),us]).optional(),letterSpacing:us.optional(),textDecoration:hr(["none","underline","line-through","overline"]).optional(),textTransform:hr(["none","capitalize","uppercase","lowercase"]).optional()}),pp=En([ot({width:us,style:hr(["solid","dashed","dotted","double","groove","ridge","inset","outset","none"]),color:gl}),ye().regex(/^[0-9]+(\.[0-9]+)?(px|rem) (solid|dashed|dotted|double|groove|ridge|inset|outset|none) (#[A-Fa-f0-9]{6}|rgba?\([0-9]+, ?[0-9]+, ?[0-9]+(, ?[0-9]+(\.[0-9]+)?)?\))$/)]),hu=En([ot({value:os()}),ot({tokenId:ye().regex(/^[a-zA-Z0-9-_]+$/)})]),fp=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),name:ye(),description:ye().optional(),dimensionId:ye().regex(/^[a-zA-Z0-9-_]+$/)}),mu=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),displayName:ye(),description:ye().optional(),modes:mt(fp).min(1),required:en().default(!1),defaultMode:ye(),resolvedValueTypeIds:mt(ye()).optional()}),pu=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),name:ye(),description:ye().optional(),resolvedValueTypeIds:mt(ye().regex(/^[a-zA-Z0-9-_]+$/)),private:en().default(!1),defaultModeIds:mt(ye().regex(/^[a-zA-Z0-9-_]+$/)).optional(),modeResolutionStrategy:ot({priorityByType:mt(ye()),fallbackStrategy:cp}).optional()}),eb=ot({platformId:ye(),value:ye(),metadata:Li(os()).optional()}),gp=ot({taxonomyId:ye(),termId:ye()}),yl=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),displayName:ye(),description:ye().optional(),tokenCollectionId:ye().regex(/^[a-zA-Z0-9-_]+$/).optional(),resolvedValueTypeId:ye().regex(/^[a-zA-Z0-9-_]+$/),private:en().default(!1),themeable:en().default(!1),status:ap.optional(),tokenTier:lp,generatedByAlgorithm:en().default(!1),algorithmId:ye().regex(/^[a-zA-Z0-9-_]+$/).optional(),taxonomies:mt(gp),propertyTypes:mt(fc),valuesByMode:mt(ot({modeIds:mt(ye()),value:hu,metadata:Li(os()).optional(),platformOverrides:mt(eb).optional()})).describe("If any entry in valuesByMode has modeIds: [], it must be the only entry in the array. Otherwise, all entries must have modeIds.length > 0. This enforces that a token can have either a single global value or multiple mode-specific values, but not both.").min(1)}),yp=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),name:ye(),description:ye().optional(),tokenCollectionId:ye().regex(/^[a-zA-Z0-9-_]+$/),tokens:mt(yl)}),jy=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),name:ye(),description:ye().optional(),tokenCollectionId:ye().regex(/^[a-zA-Z0-9-_]+$/),tokens:mt(yl)}),Rf=hr(["","_","-",".","/"]),xp=ot({id:ye(),displayName:ye(),description:ye().optional(),syntaxPatterns:ot({prefix:ye().optional(),suffix:ye().optional(),delimiter:Rf.optional(),capitalization:hr(["none","camel","uppercase","lowercase","capitalize"]).optional(),formatString:ye().optional()}).optional(),valueFormatters:ot({color:hr(["hex","rgb","rgba","hsl","hsla"]).optional(),dimension:hr(["px","rem","em","pt","dp","sp"]).optional(),numberPrecision:$r().int().min(0).max(10).optional()}).optional(),extensionSource:ot({repositoryUri:ye(),filePath:ye()}).optional(),status:hr(["active","deprecated"]).default("active").optional(),figmaPlatformMapping:hr(["WEB","iOS","ANDROID"]).nullable().optional()}).refine(t=>t.extensionSource?!t.syntaxPatterns&&!t.valueFormatters:!0,{message:"Platforms can have either core patterns or extension source, but not both."}),vp=ot({componentId:ye(),componentName:ye(),description:ye().optional(),componentCategoryId:ye().optional(),packageName:ye().optional(),storybookStory:ye().optional(),playgroundUrl:ye().optional(),status:hr(["experimental","stable","deprecated"]).optional(),imageUrl:ye().optional(),tokenUsage:mt(ot({attribute:ye(),tokenTypes:mt(ye()),defaultTokenId:ye().optional(),description:ye().optional()})).optional(),examples:ot({storybookId:ye().optional(),documentationUri:ye().optional(),codeExample:ye().optional()}).optional()}),bp=ot({systemId:ye(),platformId:ye(),version:ye(),figmaFileKey:ye().regex(/^[a-zA-Z0-9-_]+$/),packageUri:ye().optional(),documentationUri:ye().optional(),metadata:ot({name:ye().optional(),description:ye().optional(),maintainer:ye().optional(),lastUpdated:ye().optional(),repositoryVisibility:hr(["public","private"]).optional()}).optional(),syntaxPatterns:ot({prefix:ye().optional(),suffix:ye().optional(),delimiter:Rf.optional(),capitalization:hr(["camel","uppercase","lowercase","capitalize"]).optional(),formatString:ye().optional()}).optional(),valueFormatters:ot({color:hr(["hex","rgb","rgba","hsl","hsla"]).optional(),dimension:hr(["px","rem","em","pt","dp","sp"]).optional(),numberPrecision:$r().int().min(0).max(10).optional()}).optional(),algorithmVariableOverrides:mt(ot({algorithmId:ye(),variableId:ye(),valuesByMode:mt(ot({modeIds:mt(ye()),value:En([ye(),$r(),en()])}))})).optional(),tokenOverrides:mt(ot({id:ye(),displayName:ye().optional(),description:ye().optional(),themeable:en().optional(),private:en().optional(),status:ye().optional(),tokenTier:ye().optional(),resolvedValueTypeId:ye().optional(),generatedByAlgorithm:en().optional(),algorithmId:ye().optional(),taxonomies:mt(os()).optional(),propertyTypes:mt(os()).optional(),valuesByMode:mt(ot({modeIds:mt(ye()),value:En([ot({value:os()}),ot({tokenId:ye()})]),metadata:os().optional()})),omit:en().optional()})).optional(),omittedModes:mt(ye()).optional(),omittedDimensions:mt(ye()).optional(),componentImplementations:mt(vp).optional(),status:hr(["active","deprecated"]).default("active").optional(),figmaPlatformMapping:hr(["WEB","iOS","ANDROID"]).nullable().optional()}),Of=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),displayName:ye(),description:ye().optional(),overrideSource:ot({repositoryUri:ye(),filePath:ye()}).optional(),status:hr(["active","deprecated"]).optional()}),_f=ot({value:En([ye(),$r(),en()]),tokenId:ye().regex(/^[a-zA-Z0-9-_]+$/).optional()}),tb=ot({platformId:ye(),value:_f}),Ff=ot({tokenId:ye().regex(/^[a-zA-Z0-9-_]+$/),value:_f,platformOverrides:mt(tb).optional()}),Vf=Li(mt(Ff)),rb=ot({systemId:ye(),themeId:ye(),figmaFileKey:ye().regex(/^[a-zA-Z0-9-_]+$/),tokenOverrides:mt(ot({tokenId:ye(),valuesByMode:mt(ot({modeIds:mt(ye()),value:En([ot({value:os()}),ot({tokenId:ye()})]),platformOverrides:mt(ot({platformId:ye(),value:os(),metadata:os().optional()})).optional(),metadata:os().optional()}))}))}),nb=ot({id:ye(),name:ye(),description:ye().optional()}),fu=ot({id:ye(),name:ye(),description:ye(),terms:mt(nb),resolvedValueTypeIds:mt(ye()).optional()}),Sp=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),displayName:ye(),description:ye().optional()}),wp=_3("type",[ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),displayName:ye(),description:ye().optional(),type:Iy("boolean"),default:en()}),ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),displayName:ye(),description:ye().optional(),type:Iy("list"),default:ye(),options:mt(Sp).min(1)})]).refine(t=>t.type==="list"?t.options.some(e=>e.id===t.default):!0,{message:"Default value must reference an existing option ID for list type properties",path:["default"]}),Cp=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),displayName:ye(),description:ye().optional()}),kp=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),displayName:ye(),description:ye().optional(),componentCategoryId:ye(),componentProperties:mt(ot({componentPropertyId:ye().regex(/^[a-zA-Z0-9-_]+$/),description:ye().optional(),supportedOptionIds:mt(ye().regex(/^[a-zA-Z0-9-_]+$/)).optional(),default:En([en(),ye()]).optional()}))}),sb=ot({emptyModeIds:hr(["mapToDefaults","preserveEmpty","requireExplicit"]),preserveOriginalValues:en()}),ob=ot({version:ye(),dimensions:mt(ye().regex(/^[a-zA-Z0-9-_]+$/)),date:ye(),migrationStrategy:sb.optional()}),ib=ot({whenAdding:ye().regex(/^[a-zA-Z0-9-_]+$/),mapEmptyModeIdsTo:mt(ye().regex(/^[a-zA-Z0-9-_]+$/)),preserveDefaultValues:en().optional()}),ab=ot({rules:mt(ib)}),Ip=ot({systemName:ye(),systemId:ye().regex(/^[a-zA-Z0-9-_]+$/),description:ye().optional(),figmaConfiguration:ot({syntaxPatterns:ot({prefix:ye().optional(),suffix:ye().optional(),delimiter:hr(["","_","-",".","/"]).optional(),capitalization:hr(["camel","uppercase","lowercase","capitalize"]).optional(),formatString:ye().optional()}).optional(),fileKey:ye(),fileColorProfile:hr(["srgb","display-p3"]).default("srgb").optional()}).optional(),version:ye(),versionHistory:mt(ob),dimensionEvolution:ab.optional(),dimensions:mt(mu),dimensionOrder:mt(ye().regex(/^[a-zA-Z0-9-_]+$/)).optional(),taxonomyOrder:mt(ye().regex(/^[a-zA-Z0-9-_]+$/)).optional(),tokenCollections:mt(pu),tokens:mt(yl),platforms:mt(xp),platformExtensions:mt(ot({platformId:ye(),repositoryUri:ye(),filePath:ye()})).optional(),themes:mt(Of).optional(),themeOverrides:Vf.optional(),taxonomies:mt(fu),standardPropertyTypes:mt(fc),propertyTypes:mt(fc),resolvedValueTypes:mt(uu),componentProperties:mt(wp),componentCategories:mt(Cp),components:mt(kp),extensions:ot({tokenGroups:mt(yp).optional(),tokenVariants:Li(os()).optional()}).optional()}).refine(t=>{if(!t.dimensionOrder)return!0;const e=new Set(t.dimensions.map(r=>r.id));return t.dimensionOrder.every(r=>e.has(r))},{message:"All dimensionOrder IDs must match existing dimension IDs",path:["dimensionOrder"]}).refine(t=>{if(!t.taxonomyOrder)return!0;const e=new Set(t.taxonomies.map(r=>r.id));return t.taxonomyOrder.every(r=>e.has(r))},{message:"All taxonomyOrder IDs must match existing taxonomy IDs",path:["taxonomyOrder"]}),qu=t=>Ip.parse(t),F3=t=>uu.parse(t),V3=t=>yl.parse(t),$3=t=>pu.parse(t),z3=t=>mu.parse(t),L3=t=>hu.parse(t),B3=t=>gl.parse(t),U3=t=>us.parse(t),G3=t=>dp.parse(t),H3=t=>up.parse(t),W3=t=>hp.parse(t),q3=t=>mp.parse(t),J3=t=>pp.parse(t),Y3=t=>Of.parse(t),K3=t=>Ff.parse(t),lb=t=>Vf.parse(t),cb=t=>rb.parse(t),Ju=t=>bp.parse(t);function Z3(t,e){const r=[];for(const n of t.taxonomies){const s=e.find(a=>a.id===n.taxonomyId);if(!s){r.push(`Token '${t.id}' references missing taxonomyId '${n.taxonomyId}'.`);continue}s.terms.find(a=>a.id===n.termId)||r.push(`Token '${t.id}' references missing termId '${n.termId}' in taxonomy '${s.id}'.`)}return r}function X3(t,e){const r=[];if(!t.tokenCollectionId)return r;const n=e.find(s=>s.id===t.tokenCollectionId);return n?(n.resolvedValueTypeIds.includes(t.resolvedValueTypeId)||r.push(`Token '${t.id}' has resolvedValueTypeId '${t.resolvedValueTypeId}' which is not supported by collection '${n.id}'.`),r):(r.push(`Token '${t.id}' references missing collection '${t.tokenCollectionId}'.`),r)}function Q3(t){const e=[],r=new Set;for(const n of t)if(r.has(n.id)&&e.push(`Duplicate component property ID: ${n.id}`),r.add(n.id),n.type==="list"){const s=new Set;for(const i of n.options)s.has(i.id)&&e.push(`Duplicate option ID '${i.id}' in component property '${n.id}'`),s.add(i.id);n.options.some(i=>i.id===n.default)||e.push(`Default value '${n.default}' in component property '${n.id}' does not reference an existing option`)}return e}function eC(t){const e=[],r=new Set;for(const n of t)r.has(n.id)&&e.push(`Duplicate component category ID: ${n.id}`),r.add(n.id);return e}function tC(t,e,r){const n=[],s=new Set(e.map(l=>l.id)),i=new Set(r.map(l=>l.id)),a=new Set;for(const l of t){a.has(l.id)&&n.push(`Duplicate component ID: ${l.id}`),a.add(l.id),s.has(l.componentCategoryId)||n.push(`Component '${l.id}' references non-existent component category: ${l.componentCategoryId}`);for(const c of l.componentProperties){if(i.has(c.componentPropertyId)||n.push(`Component '${l.id}' references non-existent component property: ${c.componentPropertyId}`),c.supportedOptionIds){const d=r.find(u=>u.id===c.componentPropertyId);if(d&&d.type==="list"){const u=new Set(d.options.map(m=>m.id));for(const m of c.supportedOptionIds)u.has(m)||n.push(`Component '${l.id}' references non-existent option '${m}' for property '${c.componentPropertyId}'`)}else d&&d.type==="boolean"&&n.push(`Component '${l.id}' specifies supportedOptionIds for boolean property '${c.componentPropertyId}'`)}if(c.default!==void 0){const d=r.find(u=>u.id===c.componentPropertyId);d&&(d.type==="boolean"&&typeof c.default!="boolean"?n.push(`Component '${l.id}' has invalid default value type for boolean property '${c.componentPropertyId}'`):d.type==="list"&&typeof c.default=="string"&&(new Set(d.options.map(m=>m.id)).has(c.default)||n.push(`Component '${l.id}' has invalid default option '${c.default}' for property '${c.componentPropertyId}'`)))}}}return n}function rC(t,e){return e.find(r=>r.resolvedValueTypeIds.includes(t.resolvedValueTypeId))}const nC=ot({syntaxPatterns:ot({prefix:ye().optional(),suffix:ye().optional(),delimiter:hr(["","_","-",".","/"]).optional(),capitalization:hr(["camel","uppercase","lowercase","capitalize"]).optional(),formatString:ye().optional()}).optional(),fileKey:ye()});class Ta{static validateCoreData(e){var i;const r=[],n=[];if(e.figmaConfiguration){const a=this.validateFigmaConfiguration(e.figmaConfiguration);r.push(...a.errors),n.push(...a.warnings)}else n.push("No figmaConfiguration found. Core tokens will not be published to Figma.");if(e.platforms.find(a=>a.id==="platform-figma")&&r.push("Figma should not be included in the platforms array. It is now configured separately in figmaConfiguration."),e.platformExtensions){const a=this.validatePlatformExtensionsRegistry(e.platformExtensions);r.push(...a.errors),n.push(...a.warnings)}if(e.platformExtensions&&e.platforms){const a=new Set(e.platforms.map(l=>l.id));for(const l of e.platformExtensions)a.has(l.platformId)||r.push(`Platform extension references non-existent platform: ${l.platformId}`)}if(e.taxonomyOrder){const a=new Set(((i=e.taxonomies)==null?void 0:i.map(l=>l.id))||[]);for(const l of e.taxonomyOrder)a.has(l)||r.push(`taxonomyOrder contains ID "${l}" that does not exist in taxonomies`)}if(e.componentProperties){const a=this.validateComponentProperties(e.componentProperties);r.push(...a.errors),n.push(...a.warnings)}if(e.componentCategories){const a=this.validateComponentCategories(e.componentCategories);r.push(...a.errors),n.push(...a.warnings)}if(e.components){const a=this.validateComponents(e.components,e.componentCategories||[],e.componentProperties||[]);r.push(...a.errors),n.push(...a.warnings)}if(e.components&&e.componentProperties){const a=this.validateComponentCrossReferences(e.components,e.componentProperties,e.componentCategories||[]);r.push(...a.errors),n.push(...a.warnings)}if(e.componentProperties){const a=this.validateComponentPropertyDefaults(e.componentProperties);r.push(...a.errors),n.push(...a.warnings)}return{isValid:r.length===0,errors:r,warnings:n}}static validatePlatformExtensions(e){return e.map(r=>this.validatePlatformExtension(r))}static validatePlatformExtension(e){const r=[],n=[];if(e.systemId||r.push("Platform extension must have a systemId"),e.platformId||r.push("Platform extension must have a platformId"),e.version||r.push("Platform extension must have a version"),e.figmaFileKey?/^[a-zA-Z0-9-_]+$/.test(e.figmaFileKey)||r.push("figmaFileKey must contain only alphanumeric characters, hyphens, and underscores"):r.push("Platform extension must have a figmaFileKey"),e.packageUri||e.documentationUri){const s=this.validatePlatformExtensionUrls(e.packageUri,e.documentationUri);r.push(...s.errors),n.push(...s.warnings)}if(e.componentImplementations){const s=this.validateComponentImplementations(e.componentImplementations);r.push(...s.errors),n.push(...s.warnings)}if(e.syntaxPatterns){const s=this.validateSyntaxPatterns(e.syntaxPatterns);r.push(...s.errors),n.push(...s.warnings)}if(e.valueFormatters){const s=this.validateValueFormatters(e.valueFormatters);r.push(...s.errors),n.push(...s.warnings)}if(e.algorithmVariableOverrides)for(const s of e.algorithmVariableOverrides)s.algorithmId||r.push("Algorithm variable override must have an algorithmId"),s.variableId||r.push("Algorithm variable override must have a variableId"),(!s.valuesByMode||s.valuesByMode.length===0)&&r.push(`Algorithm variable override for ${s.algorithmId}:${s.variableId} must have at least one value in valuesByMode`);if(e.tokenOverrides)for(const s of e.tokenOverrides)s.id||r.push("Token override must have an id"),(!s.valuesByMode||s.valuesByMode.length===0)&&r.push(`Token override ${s.id} must have at least one value in valuesByMode`);return{isValid:r.length===0,errors:r,warnings:n}}static validateFigmaConfiguration(e){const r=[],n=[];if(e.fileKey?/^[a-zA-Z0-9-_]+$/.test(e.fileKey)||r.push("figmaConfiguration.fileKey must contain only alphanumeric characters, hyphens, and underscores"):r.push("figmaConfiguration.fileKey is required"),e.syntaxPatterns){const s=this.validateSyntaxPatterns(e.syntaxPatterns);r.push(...s.errors),n.push(...s.warnings)}return{isValid:r.length===0,errors:r,warnings:n}}static validateSyntaxPatterns(e){const r=[],n=[];return e.delimiter&&!["","_","-",".","/"].includes(e.delimiter)&&r.push(`Invalid delimiter: ${e.delimiter}. Must be one of: "", "_", "-", ".", "/"`),e.capitalization&&!["camel","uppercase","lowercase","capitalize"].includes(e.capitalization)&&r.push(`Invalid capitalization: ${e.capitalization}. Must be one of: "camel", "uppercase", "lowercase", "capitalize"`),e.formatString&&(["{name}","{type}","{category}","{mode}"].some(a=>e.formatString.includes(a))||n.push("Format string should include at least one placeholder like {name}, {type}, {category}, or {mode}")),{isValid:r.length===0,errors:r,warnings:n}}static validateValueFormatters(e){const r=[],n=[];return e.color&&!["hex","rgb","rgba","hsl","hsla"].includes(e.color)&&r.push(`Invalid color format: ${e.color}. Must be one of: "hex", "rgb", "rgba", "hsl", "hsla"`),e.dimension&&!["px","rem","em","pt","dp","sp"].includes(e.dimension)&&r.push(`Invalid dimension unit: ${e.dimension}. Must be one of: "px", "rem", "em", "pt", "dp", "sp"`),e.numberPrecision!==void 0&&(!Number.isInteger(e.numberPrecision)||e.numberPrecision<0||e.numberPrecision>10)&&r.push(`Invalid number precision: ${e.numberPrecision}. Must be an integer between 0 and 10`),{isValid:r.length===0,errors:r,warnings:n}}static validatePlatformExtensionsRegistry(e){const r=[],n=[],s=new Set;for(const i of e){const a=`${i.platformId}:${i.repositoryUri}:${i.filePath}`;s.has(a)&&r.push(`Duplicate platform extension registry entry: ${i.platformId}`),s.add(a)}return{isValid:r.length===0,errors:r,warnings:n}}static validateComponentProperties(e){const r=[],n=[],s=new Set;for(const i of e)if(s.has(i.id)&&r.push(`Duplicate component property ID: ${i.id}`),s.add(i.id),i.type==="list"){const a=new Set;for(const l of i.options)a.has(l.id)&&r.push(`Duplicate option ID '${l.id}' in component property '${i.id}'`),a.add(l.id);i.options.some(l=>l.id===i.default)||r.push(`Default value '${i.default}' in component property '${i.id}' does not reference an existing option`)}else i.type==="boolean"&&"options"in i&&r.push(`Boolean component property '${i.id}' cannot have options`);return{isValid:r.length===0,errors:r,warnings:n}}static validateComponentCategories(e){const r=[],n=[],s=new Set;for(const i of e)s.has(i.id)&&r.push(`Duplicate component category ID: ${i.id}`),s.add(i.id);return{isValid:r.length===0,errors:r,warnings:n}}static validateComponents(e,r,n){const s=[],i=[],a=new Set(r.map(d=>d.id)),l=new Set(n.map(d=>d.id)),c=new Set;for(const d of e){c.has(d.id)&&s.push(`Duplicate component ID: ${d.id}`),c.add(d.id),a.has(d.componentCategoryId)||s.push(`Component '${d.id}' references non-existent component category: ${d.componentCategoryId}`);for(const u of d.componentProperties){if(l.has(u.componentPropertyId)||s.push(`Component '${d.id}' references non-existent component property: ${u.componentPropertyId}`),u.supportedOptionIds){const m=n.find(g=>g.id===u.componentPropertyId);if(m&&m.type==="list"){const g=new Set(m.options.map(y=>y.id));for(const y of u.supportedOptionIds)g.has(y)||s.push(`Component '${d.id}' references non-existent option '${y}' for property '${u.componentPropertyId}'`)}else m&&m.type==="boolean"&&s.push(`Component '${d.id}' specifies supportedOptionIds for boolean property '${u.componentPropertyId}'`)}if(u.default!==void 0){const m=n.find(g=>g.id===u.componentPropertyId);m&&(m.type==="boolean"&&typeof u.default!="boolean"?s.push(`Component '${d.id}' has invalid default value type for boolean property '${u.componentPropertyId}'`):m.type==="list"&&typeof u.default=="string"&&(new Set(m.options.map(y=>y.id)).has(u.default)||s.push(`Component '${d.id}' has invalid default option '${u.default}' for property '${u.componentPropertyId}'`)))}}}return{isValid:s.length===0,errors:s,warnings:i}}static validateComponentCrossReferences(e,r,n){const s=[],i=[],a=new Set(n.map(c=>c.id)),l=new Set(r.map(c=>c.id));for(const c of e){a.has(c.componentCategoryId)||s.push(`Component '${c.id}' references non-existent component category: ${c.componentCategoryId}`);for(const d of c.componentProperties){if(l.has(d.componentPropertyId)||s.push(`Component '${c.id}' references non-existent component property: ${d.componentPropertyId}`),d.supportedOptionIds){const u=r.find(m=>m.id===d.componentPropertyId);if(u&&u.type==="list"){const m=new Set(u.options.map(g=>g.id));for(const g of d.supportedOptionIds)m.has(g)||s.push(`Component '${c.id}' references non-existent option '${g}' for property '${d.componentPropertyId}'`)}else u&&u.type==="boolean"&&s.push(`Component '${c.id}' specifies supportedOptionIds for boolean property '${d.componentPropertyId}'`)}if(d.default!==void 0){const u=r.find(m=>m.id===d.componentPropertyId);u&&(u.type==="boolean"&&typeof d.default!="boolean"?s.push(`Component '${c.id}' has invalid default value type for boolean property '${d.componentPropertyId}'`):u.type==="list"&&typeof d.default=="string"&&(new Set(u.options.map(g=>g.id)).has(d.default)||s.push(`Component '${c.id}' has invalid default option '${d.default}' for property '${d.componentPropertyId}'`)))}}}return{isValid:s.length===0,errors:s,warnings:i}}static validateComponentPropertyDefaults(e){const r=[],n=[];for(const s of e)if(s.default!==void 0){const i=e.find(a=>a.id===s.id);i&&(i.type==="boolean"&&typeof s.default!="boolean"?r.push(`Component property '${s.id}' has invalid default value type: expected boolean, got ${typeof s.default}`):i.type==="list"&&typeof s.default=="string"&&(new Set(i.options.map(l=>l.id)).has(s.default)||r.push(`Component property '${s.id}' has invalid default option: ${s.default}`)))}return{isValid:r.length===0,errors:r,warnings:n}}static validateFigmaFileKeyUniqueness(e){const r=[],n=[],s=new Set;for(const i of e)i.figmaFileKey&&(s.has(i.figmaFileKey)&&r.push(`Duplicate figmaFileKey found: ${i.figmaFileKey}. Each platform extension must have a unique Figma file key.`),s.add(i.figmaFileKey));return{isValid:r.length===0,errors:r,warnings:n}}static validateThemeOverrideFile(e){const r=[],n=[];if(e.figmaFileKey?/^[a-zA-Z0-9-_]+$/.test(e.figmaFileKey)||r.push("figmaFileKey must contain only alphanumeric characters, hyphens, and underscores"):r.push("Theme override file must have a figmaFileKey"),e.systemId||r.push("Theme override file must have a systemId"),e.themeId||r.push("Theme override file must have a themeId"),!e.tokenOverrides||e.tokenOverrides.length===0)n.push("Theme override file has no token overrides");else for(const s of e.tokenOverrides)s.tokenId||r.push("Token override must have a tokenId"),(!s.valuesByMode||s.valuesByMode.length===0)&&r.push(`Token override ${s.tokenId} must have at least one value in valuesByMode`);return{isValid:r.length===0,errors:r,warnings:n}}static validateFigmaFileKeyUniquenessAcrossAll(e,r=[]){const n=[],s=[],i=new Set;for(const a of e)a.figmaFileKey&&(i.has(a.figmaFileKey)&&n.push(`Duplicate figmaFileKey found: ${a.figmaFileKey}. Each platform extension must have a unique Figma file key.`),i.add(a.figmaFileKey));for(const a of r)a.figmaFileKey&&(i.has(a.figmaFileKey)&&n.push(`Duplicate figmaFileKey found: ${a.figmaFileKey}. Theme override file ${a.themeId} conflicts with existing file key.`),i.add(a.figmaFileKey));return{isValid:n.length===0,errors:n,warnings:s}}static validateComponentImplementations(e,r=[]){const n=[],s=[],i=new Set(r.map(a=>a.id));for(const a of e)if(a.componentId&&!i.has(a.componentId)&&s.push(`Component implementation '${a.componentName}' references non-existent core component: ${a.componentId}`),a.storybookStory&&!this.isValidUrl(a.storybookStory)&&n.push(`Invalid storybookStory URL for component '${a.componentName}': ${a.storybookStory}`),a.playgroundUrl&&!this.isValidUrl(a.playgroundUrl)&&n.push(`Invalid playgroundUrl for component '${a.componentName}': ${a.playgroundUrl}`),a.imageUrl&&!this.isValidUrl(a.imageUrl)&&n.push(`Invalid imageUrl for component '${a.componentName}': ${a.imageUrl}`),a.examples&&a.examples.documentationUri&&!this.isValidUrl(a.examples.documentationUri)&&n.push(`Invalid documentationUri for component '${a.componentName}': ${a.examples.documentationUri}`),a.tokenUsage)for(const l of a.tokenUsage)(!l.attribute||l.attribute.trim()==="")&&n.push(`Component '${a.componentName}' has token usage with empty attribute`),(!l.tokenTypes||l.tokenTypes.length===0)&&n.push(`Component '${a.componentName}' has token usage with empty tokenTypes`);return{isValid:n.length===0,errors:n,warnings:s}}static validatePlatformExtensionUrls(e,r){const n=[],s=[];return e&&!this.isValidUrl(e)&&n.push(`Invalid packageUri: ${e}`),r&&!this.isValidUrl(r)&&n.push(`Invalid documentationUri: ${r}`),{isValid:n.length===0,errors:n,warnings:s}}static isValidUrl(e){try{return new URL(e),!0}catch{return!1}}static validateSystem(e,r,n=[]){const s=this.validateCoreData(e),i=this.validatePlatformExtensions(r),a=n.map(m=>this.validateThemeOverrideFile(m)),l=this.validateFigmaFileKeyUniquenessAcrossAll(r,n),c=this.validateCrossReferences(e,r),d=[...s.errors,...l.errors,...c.errors,...i.flatMap(m=>m.errors),...a.flatMap(m=>m.errors)],u=[...s.warnings,...l.warnings,...c.warnings,...i.flatMap(m=>m.warnings),...a.flatMap(m=>m.warnings)];return{core:s,platformExtensions:i,overall:{isValid:d.length===0,errors:d,warnings:u}}}static validateCrossReferences(e,r){const n=[],s=[];for(const a of r)a.systemId!==e.systemId&&n.push(`Platform extension ${a.platformId} references non-existent system: ${a.systemId}`);const i=new Set(e.platforms.map(a=>a.id));for(const a of r)i.has(a.platformId)||n.push(`Platform extension references non-existent platform: ${a.platformId}`);for(const a of r)if(a.componentImplementations&&e.components){const l=this.validateComponentImplementations(a.componentImplementations,e.components);n.push(...l.errors),s.push(...l.warnings)}for(const a of r)if(a.componentImplementations&&e.tokens){const l=this.validateComponentImplementationTokens(a.componentImplementations,e.tokens);n.push(...l.errors),s.push(...l.warnings)}return{isValid:n.length===0,errors:n,warnings:s}}static validateComponentImplementationTokens(e,r){const n=[],s=[],i=new Set(r.map(a=>a.id));for(const a of e)if(a.tokenUsage)for(const l of a.tokenUsage)l.defaultTokenId&&!i.has(l.defaultTokenId)&&n.push(`Component '${a.componentName}' references non-existent token: ${l.defaultTokenId}`);return{isValid:n.length===0,errors:n,warnings:s}}static validateForEditSource(e,r,n){try{switch(r){case"core":return this.validateCoreData(e);case"platform-extension":return this.validatePlatformExtension(e);case"theme-override":return this.validateThemeOverrideFile(e);default:return{isValid:!1,errors:[`Unknown source type: ${r}`],warnings:[]}}}catch(s){return{isValid:!1,errors:[s instanceof Error?s.message:"Validation failed"],warnings:[]}}}static validateOverrideCreation(e,r,n,s){const i=[],a=[];return e||i.push("Token ID is required"),s||i.push("Source ID is required"),r||i.push("New value is required"),n==="theme-override"&&(!r.valuesByMode||!Array.isArray(r.valuesByMode))&&i.push("Theme overrides must include valuesByMode array"),n==="platform-extension"&&e.includes("theme-")&&a.push(`Token ${e} appears to be theme-specific and may not be appropriate for platform override`),{isValid:i.length===0,errors:i,warnings:a}}static validateThemeEdit(e,r){const n=[],s=[];return r||n.push(`Token ${e} is not themeable and cannot be edited in theme mode`),{isValid:n.length===0,errors:n,warnings:s}}static validatePlatformEdit(e,r){const n=[],s=[];return e.includes("theme-")&&s.push(`Token ${e} appears to be theme-specific and may not be appropriate for platform override`),r||n.push("Platform ID is required for platform editing"),{isValid:n.length===0,errors:n,warnings:s}}}function db(t){const e=[],r=[];try{const n=Ju(t);return n.systemId||e.push("systemId is required"),n.platformId||e.push("platformId is required"),n.version||e.push("version is required"),n.platformId&&!n.platformId.startsWith("platform-")&&r.push('Platform ID should follow the pattern "platform-{name}"'),n.platformId==="platform-figma"&&n.syntaxPatterns&&e.push("Figma platform extensions should not include syntaxPatterns (these belong in core data)"),{isValid:e.length===0,errors:e,warnings:r}}catch(n){return n instanceof No?{isValid:!1,errors:n.errors.map(s=>`${s.path.join(".")}: ${s.message}`),warnings:[]}:{isValid:!1,errors:["Unknown validation error"],warnings:[]}}}function ub(t){const{coreData:e,platformExtension:r}=t,n=[],s=[];if(r.systemId!==e.systemId&&n.push(`System ID mismatch: extension has "${r.systemId}", core has "${e.systemId}"`),e.platforms.some(a=>a.id===r.platformId)||n.push(`Platform "${r.platformId}" not found in core data platforms`),r.tokenOverrides)for(const a of r.tokenOverrides){const l=e.tokens.find(c=>c.id===a.id);if(l)a.resolvedValueTypeId&&a.resolvedValueTypeId!==l.resolvedValueTypeId&&s.push(`Token "${a.id}" overrides resolvedValueTypeId from "${l.resolvedValueTypeId}" to "${a.resolvedValueTypeId}"`);else{a.resolvedValueTypeId||n.push(`New token "${a.id}" must specify resolvedValueTypeId`);const c=e.resolvedValueTypes.some(d=>d.id===a.resolvedValueTypeId);a.resolvedValueTypeId&&!c&&n.push(`Resolved value type "${a.resolvedValueTypeId}" not found in core data for token "${a.id}"`)}if(a.valuesByMode)for(const c of a.valuesByMode)for(const d of c.modeIds)e.dimensions.some(m=>m.modes.some(g=>g.id===d))||n.push(`Mode "${d}" not found in core data for token "${a.id}"`)}if(r.algorithmVariableOverrides)for(const a of r.algorithmVariableOverrides)for(const l of a.valuesByMode)for(const c of l.modeIds)e.dimensions.some(u=>u.modes.some(m=>m.id===c))||n.push(`Mode "${c}" not found in core data for algorithm override "${a.algorithmId}.${a.variableId}"`);if(r.omittedModes)for(const a of r.omittedModes)e.dimensions.some(c=>c.modes.some(d=>d.id===a))||n.push(`Omitted mode "${a}" not found in core data`);if(r.omittedDimensions)for(const a of r.omittedDimensions)e.dimensions.some(c=>c.id===a)||n.push(`Omitted dimension "${a}" not found in core data`);return{isValid:n.length===0,errors:n,warnings:s}}function sC(t,e){const r=[],n=[],s=t.platforms.find(i=>i.id==="platform-figma");s!=null&&s.syntaxPatterns||n.push("Figma platform in core data should include syntaxPatterns");for(const i of e)i.platformId==="platform-figma"&&i.syntaxPatterns&&r.push(`Figma platform extension "${i.platformId}" should not include syntaxPatterns (these belong in core data)`);return{isValid:r.length===0,errors:r,warnings:n}}function oC(t){var s,i,a;const e=[],r=[],n=t.platforms.filter(l=>l.extensionSource);for(const l of n)(s=l.extensionSource)!=null&&s.repositoryUri||e.push(`Platform "${l.id}" missing repositoryUri in extensionSource`),(i=l.extensionSource)!=null&&i.filePath||e.push(`Platform "${l.id}" missing filePath in extensionSource`),l.id&&!l.id.startsWith("platform-")&&r.push(`Platform ID "${l.id}" should follow the pattern "platform-{name}"`),(a=l.extensionSource)!=null&&a.repositoryUri&&!l.extensionSource.repositoryUri.includes("/")&&e.push(`Repository URI "${l.extensionSource.repositoryUri}" should be in format "owner/repo"`),t.platforms.filter(d=>d.id===l.id).length>1&&e.push(`Duplicate platform ID "${l.id}" in platforms array`),l.syntaxPatterns&&e.push(`Platform "${l.id}" has extensionSource but also includes syntaxPatterns in core data`),l.valueFormatters&&e.push(`Platform "${l.id}" has extensionSource but also includes valueFormatters in core data`);return{isValid:e.length===0,errors:e,warnings:r}}function iC(t){const e=db(t.platformExtension),r=ub(t);return{isValid:e.isValid&&r.isValid,errors:[...e.errors,...r.errors],warnings:[...e.warnings,...r.warnings]}}function aC(t,e){return t.length!==e.length?!1:t.every((r,n)=>r===e[n])}function lC(t,e){return t.length>0?t:e.map(r=>r.defaultMode)}function jp(t,e,r){console.log("[mergeValuesByMode] ðŸ”„ Starting mergeValuesByMode:",{existingCount:t.length,overrideCount:e.length,dimensionsCount:r.length}),console.log("[mergeValuesByMode] ðŸ“‹ Existing valuesByMode:",t.map(s=>({modeIds:s.modeIds,hasValue:!!s.value,valueType:s.value?typeof s.value=="object"&&"tokenId"in s.value?"alias":"direct":"none"}))),console.log("[mergeValuesByMode] ðŸ“‹ Override valuesByMode:",e.map(s=>({modeIds:s.modeIds,hasValue:!!s.value,valueType:s.value?typeof s.value=="object"&&"tokenId"in s.value?"alias":"direct":"none"})));const n=[...t];console.log("[mergeValuesByMode] ðŸ“¥ Initial result (copy of existing):",n.length,"items");for(const s of e){const i=lC(s.modeIds,r);console.log("[mergeValuesByMode] ðŸ” Processing override:",{originalModeIds:s.modeIds,resolvedModeIds:i,hasValue:!!s.value});const a=n.findIndex(l=>aC(l.modeIds.sort(),i.sort()));console.log("[mergeValuesByMode] ðŸ” Found existing index:",a),a!==-1?(console.log("[mergeValuesByMode] âœ… Overriding existing entry at index:",a),n[a]={...n[a],value:s.value,metadata:s.metadata??n[a].metadata,platformOverrides:s.platformOverrides??n[a].platformOverrides}):(console.log("[mergeValuesByMode] âž• Adding new entry for modeIds:",i),n.push({modeIds:i,value:s.value,metadata:s.metadata,platformOverrides:s.platformOverrides}))}return console.log("[mergeValuesByMode] ðŸ“¤ Final result:",{count:n.length,items:n.map(s=>({modeIds:s.modeIds,hasValue:!!s.value,valueType:s.value?typeof s.value=="object"&&"tokenId"in s.value?"alias":"direct":"none"}))}),n}function $f(t,e=[],r,n={}){var S;const{targetPlatformId:s,targetThemeId:i,includeOmitted:a=!1}=n,l=((S=t.dimensions)==null?void 0:S.map(b=>({id:b.id,defaultMode:b.defaultMode})))||[];xC(e);const c=s?e.filter(b=>b.platformId===s):e;let d=[...t.tokens],u=[...t.platforms],m=[],g=[];const y=[];for(const b of c){const k=cC(d,u,b,a,l);if(d=k.tokens,u=k.platforms,m=[...m,...b.omittedModes||[]],g=[...g,...b.omittedDimensions||[]],b.tokenOverrides)for(const A of b.tokenOverrides)A.omit&&!a&&y.push(A.id)}let v={tokens:d,excludedOverrides:0};if(r){const b=i?{[i]:r[i]}:r;v=hC(d,b,y,l),d=v.tokens}const I=pC(t.tokens,d,e,r,v.excludedOverrides);return{core:t,platformExtensions:c,themeOverrides:r,mergedTokens:d,mergedPlatforms:u,omittedModes:[...new Set(m)],omittedDimensions:[...new Set(g)],analytics:I}}function cC(t,e,r,n,s){const i=[...t],a=[...e],l=a.findIndex(c=>c.id===r.platformId);if(l!==-1&&(a[l]={...a[l],syntaxPatterns:r.syntaxPatterns?{...r.syntaxPatterns,capitalization:r.syntaxPatterns.capitalization==="camel"?"none":r.syntaxPatterns.capitalization}:void 0,valueFormatters:r.valueFormatters||void 0}),r.tokenOverrides)for(const c of r.tokenOverrides){const d=i.findIndex(u=>u.id===c.id);d!==-1?c.omit&&!n?i.splice(d,1):i[d]=dC(i[d],c,s):(!c.omit||n)&&i.push(c)}return{tokens:i,platforms:a}}function dC(t,e,r){var s,i,a,l;console.log("[mergeTokenProperties] ðŸ”„ Merging token:",{tokenId:t.id,tokenName:t.displayName,existingValuesByModeCount:((s=t.valuesByMode)==null?void 0:s.length)||0,overrideValuesByModeCount:((i=e.valuesByMode)==null?void 0:i.length)||0,hasOverride:!!e.valuesByMode}),e.valuesByMode&&(console.log("[mergeTokenProperties] ðŸ“‹ Existing valuesByMode:",(a=t.valuesByMode)==null?void 0:a.map(c=>({modeIds:c.modeIds,hasValue:!!c.value}))),console.log("[mergeTokenProperties] ðŸ“‹ Override valuesByMode:",e.valuesByMode.map(c=>({modeIds:c.modeIds,hasValue:!!c.value}))));const n={...t,displayName:e.displayName??t.displayName,description:e.description??t.description,themeable:e.themeable??t.themeable,private:e.private??t.private,status:e.status??t.status,tokenTier:e.tokenTier??t.tokenTier,resolvedValueTypeId:e.resolvedValueTypeId??t.resolvedValueTypeId,generatedByAlgorithm:e.generatedByAlgorithm??t.generatedByAlgorithm,algorithmId:e.algorithmId??t.algorithmId,taxonomies:e.taxonomies??t.taxonomies,propertyTypes:e.propertyTypes??t.propertyTypes,valuesByMode:e.valuesByMode?jp(t.valuesByMode,e.valuesByMode,r):t.valuesByMode};return console.log("[mergeTokenProperties] ðŸ“¤ Result valuesByMode count:",((l=n.valuesByMode)==null?void 0:l.length)||0),n}function uC(t,e,r){const n=e.some(i=>i.id===t),s=!r.includes(t);return n&&s}function hC(t,e,r=[],n){const s=[...t];let i=0;for(const[a,l]of Object.entries(e)){if(!Array.isArray(l)){console.error(`[DataMerger] Theme ${a} overrides is not an array:`,l);continue}for(const c of l)if(uC(c.tokenId,t,r)){const d=s.findIndex(u=>u.id===c.tokenId);d!==-1&&(s[d]=mC(s[d],c,n))}else i++,console.warn(`[DataMerger] Theme override excluded: Token ${c.tokenId} does not exist or was omitted by platform`)}return{tokens:s,excludedOverrides:i}}function mC(t,e,r){const n={...t};if(e.platformOverrides)for(const s of e.platformOverrides){n.valuesByMode=jp(n.valuesByMode,[{value:s.value,modeIds:[]}],r);break}else n.valuesByMode=jp(n.valuesByMode,[{value:e.value,modeIds:[]}],r);return n}function pC(t,e,r,n,s=0){const i=t.length,a=e.filter(y=>t.some(v=>v.id===y.id&&JSON.stringify(v.valuesByMode)!==JSON.stringify(y.valuesByMode))).length,l=e.filter(y=>!t.some(v=>v.id===y.id)).length,c=t.length-e.length+l,u=(n?Object.values(n).flat().length:0)-s;return{totalTokens:i,overriddenTokens:a,newTokens:l,omittedTokens:c,platformCount:r.length,themeCount:n?Object.keys(n).length:0,excludedThemeOverrides:s,validThemeOverrides:u,themeOverrideValidationErrors:[],modeCombinationsPreserved:0,modeCombinationsOverridden:0}}function fC(t,e,r){const n=e.find(s=>s.platformId===r);return n==null?void 0:n.syntaxPatterns}function gC(t,e,r){const n=e.find(s=>s.platformId===r);return n==null?void 0:n.valueFormatters}function yC(t,e){return t.filter(r=>!r.valuesByMode.some(s=>s.modeIds.some(i=>e.includes(i))))}function xC(t){const e=new Set;for(const r of t){if(!r.figmaFileKey)throw new Error(`Platform extension ${r.platformId} must have a figmaFileKey`);if(e.has(r.figmaFileKey))throw new Error(`Duplicate figmaFileKey found: ${r.figmaFileKey}. Each platform extension must have a unique Figma file key.`);e.add(r.figmaFileKey)}}function vC(t,e,r){var s;if(!r)return((s=t.figmaConfiguration)==null?void 0:s.fileKey)||"default-figma-file";const n=e.find(i=>i.platformId===r);if(!(n!=null&&n.figmaFileKey))throw new Error(`Platform extension ${r} must have a figmaFileKey`);return n.figmaFileKey}function bC(t){if(!t.figmaFileKey)throw new Error(`Theme override file ${t.themeId} must have a figmaFileKey`);return t.figmaFileKey}function SC(t){if(!Array.isArray(t)||t.length===0)return"valuesByMode must be a non-empty array.";if(t.some(r=>Array.isArray(r.modeIds)&&r.modeIds.length===0)){if(t.length>1)return"If a global value (modeIds: []) is defined, it must be the only entry in valuesByMode."}else if(t.some(r=>!Array.isArray(r.modeIds)||r.modeIds.length===0))return"All entries in valuesByMode must have at least one modeId, unless a single global value is defined.";return!0}const zf={core:()=>ir(()=>import("./core-data-BQi_QcQV.js"),[]),brandAOverrides:()=>ir(()=>import("./brand-a-overrides-M73XPKxh.js"),[]),brandBOverrides:()=>ir(()=>import("./brand-b-overrides-DvAYG7JV.js"),[]),minimal:()=>ir(()=>import("./example-minimal-data-B9qGf-P9.js"),[])},hb={core:()=>ir(()=>import("./core-algorithms-CZqvVs2X.js"),[]).catch(()=>null),minimal:()=>ir(()=>import("./example-minimal-algorithms-B4SVSBJt.js"),[]).catch(()=>null)},wC={ios:()=>ir(()=>import("./ios-platform-extension-D5XPpIoW.js"),[]),web:()=>ir(()=>import("./web-platform-extension-CYyfN-K5.js"),[])},CC=Object.freeze(Object.defineProperty({__proto__:null,BorderValue:pp,BorderValueSchema:pp,ColorValue:gl,ColorValueSchema:gl,Component:kp,ComponentCategory:Cp,ComponentCategorySchema:Cp,ComponentImplementation:vp,ComponentImplementationSchema:vp,ComponentProperty:wp,ComponentPropertyOption:Sp,ComponentPropertyOptionSchema:Sp,ComponentPropertySchema:wp,ComponentSchema:kp,CubicBezierValue:up,CubicBezierValueSchema:up,Dimension:mu,DimensionEvolution:ab,DimensionEvolutionRule:ib,DimensionSchema:mu,DimensionValue:us,DimensionValueSchema:us,DurationValue:dp,DurationValueSchema:dp,FallbackStrategy:cp,FallbackStrategySchema:cp,FigmaConfiguration:nC,MigrationStrategy:sb,Mode:fp,ModeSchema:fp,Platform:xp,PlatformDelimiter:Rf,PlatformExtension:bp,PlatformExtensionSchema:bp,PlatformOverride:eb,PlatformSchema:xp,PropertyType:fc,PropertyTypeSchema:fc,ResolvedValueType:uu,ResolvedValueTypeSchema:uu,SchemaValidationService:Ta,ShadowValue:hp,ShadowValueSchema:hp,StandardValueType:ip,StandardValueTypeSchema:ip,Taxonomy:fu,TaxonomySchema:fu,TaxonomyTerm:nb,Theme:Of,ThemeOverride:Ff,ThemeOverrideFile:rb,ThemeOverrideValue:_f,ThemeOverrides:Vf,ThemePlatformOverride:tb,Token:yl,TokenCollection:pu,TokenCollectionSchema:pu,TokenGroup:yp,TokenGroupSchema:yp,TokenSchema:yl,TokenStatus:ap,TokenStatusSchema:ap,TokenSystem:Ip,TokenSystemSchema:Ip,TokenTaxonomyRef:gp,TokenTaxonomyRefSchema:gp,TokenTier:lp,TokenTierSchema:lp,TokenValue:hu,TokenValueSchema:hu,TokenVariant:jy,TokenVariantSchema:jy,TypographyValue:mp,TypographyValueSchema:mp,ValueTypeValidation:Qv,VersionHistoryEntry:ob,algorithmData:hb,exampleData:zf,filterTokensByOmissions:yC,findCompatibleCollection:rC,getFigmaFileKeyForPlatform:vC,getFigmaFileKeyForThemeOverride:bC,getSyntaxPatternsForPlatform:fC,getValueFormattersForPlatform:gC,mergeData:$f,platformExtensionData:wC,validateBorderValue:J3,validateColorValue:B3,validateComponentCategories:eC,validateComponentProperties:Q3,validateComponents:tC,validateCubicBezierValue:H3,validateDimension:z3,validateDimensionValue:U3,validateDurationValue:G3,validatePlatformExtension:Ju,validatePlatformExtensionComprehensive:iC,validatePlatformExtensionStandalone:db,validatePlatformExtensionWithCore:ub,validatePlatformExtensionsRegistry:oC,validateResolvedValueType:F3,validateShadowValue:W3,validateSyntaxPatternOwnership:sC,validateTheme:Y3,validateThemeOverride:K3,validateThemeOverrideFile:cb,validateThemeOverrides:lb,validateToken:V3,validateTokenCollection:$3,validateTokenCollectionCompatibility:X3,validateTokenSystem:qu,validateTokenTaxonomiesReferentialIntegrity:Z3,validateTokenValue:L3,validateTokenValuesByMode:SC,validateTypographyValue:q3},Symbol.toStringTag,{value:"Module"})),ta=class ta{constructor(){rt(this,"sourceTracking",new Map);rt(this,"overrideTracking",new Map)}static getInstance(){return ta.instance||(ta.instance=new ta),ta.instance}mergeData(e,r,n,s){var i,a;try{if(console.log("[EnhancedDataMerger] ðŸš€ Starting mergeData with context:",{currentPlatform:e.currentPlatform,currentTheme:e.currentTheme,editMode:e.editMode}),!r)throw new Error("Core data is required for merging");console.log("[EnhancedDataMerger] ðŸ“Š Core data summary:",{tokensCount:r.tokens.length,dimensionsCount:r.dimensions.length,dimensionOrder:r.dimensionOrder});const l=[],c={};if(e.currentPlatform&&e.currentPlatform!=="none"){const g=n[e.currentPlatform];g&&(console.log("[EnhancedDataMerger] ðŸ”§ Adding platform extension:",{platformId:e.currentPlatform,tokenOverridesCount:((i=g.tokenOverrides)==null?void 0:i.length)||0}),l.push(g))}if(e.currentTheme&&e.currentTheme!=="none"){const g=s[e.currentTheme];g&&(console.log("[EnhancedDataMerger] ðŸŽ¨ Adding theme override:",{themeId:e.currentTheme,tokenOverridesCount:((a=g.tokenOverrides)==null?void 0:a.length)||0}),c[e.currentTheme]=g.tokenOverrides||[])}console.log("[EnhancedDataMerger] ðŸ“‹ Merge inputs prepared:",{platformExtensionsCount:l.length,themeOverridesCount:Object.keys(c).length});const d=$f(r,l,Object.keys(c).length>0?c:void 0);console.log("[EnhancedDataMerger] âœ… Merge completed:",{mergedTokensCount:d.mergedTokens.length,mergedPlatformsCount:d.mergedPlatforms.length}),console.log("[EnhancedDataMerger] ðŸ” Debugging valuesByMode merging:"),d.mergedTokens.forEach((g,y)=>{var v,I;y<5&&console.log(`[EnhancedDataMerger] Token ${g.id} (${g.displayName}):`,{valuesByModeCount:((v=g.valuesByMode)==null?void 0:v.length)||0,valuesByMode:(I=g.valuesByMode)==null?void 0:I.map(S=>({modeIds:S.modeIds,hasValue:!!S.value,valueType:S.value?typeof S.value=="object"&&"tokenId"in S.value?"alias":"direct":"none"}))})});const u={...r,tokens:d.mergedTokens,platforms:d.mergedPlatforms,tokenCollections:r.tokenCollections,dimensions:r.dimensions,resolvedValueTypes:r.resolvedValueTypes,themes:r.themes,taxonomies:r.taxonomies,componentProperties:r.componentProperties,componentCategories:r.componentCategories,components:r.components,taxonomyOrder:r.taxonomyOrder,dimensionOrder:r.dimensionOrder,systemName:r.systemName,systemId:r.systemId,version:r.version,figmaConfiguration:r.figmaConfiguration},m=this.coreToMergedSnapshot(u);return console.log("[EnhancedDataMerger] ðŸ“¤ Final merged snapshot:",{tokensCount:m.tokens.length,collectionsCount:m.collections.length,dimensionsCount:m.dimensions.length}),this.trackSourceInformation(d,e),m}catch(l){throw console.error("[EnhancedDataMerger] âŒ Error merging data:",l),new Error("Failed to merge data sources")}}getSourceInfo(e){return this.sourceTracking.get(e)||null}getAnalytics(e,r,n,s){const i={totalTokens:0,overriddenTokens:0,newTokens:0,omittedTokens:0,platformCount:0,themeCount:0,sourceBreakdown:{core:0,platformExtensions:{},themeOverrides:{}}};if(r!=null&&r.tokens&&(i.sourceBreakdown.core=r.tokens.length,i.totalTokens+=r.tokens.length),e.currentPlatform&&e.currentPlatform!=="none"){const a=n[e.currentPlatform];if(a!=null&&a.tokenOverrides){const l=a.tokenOverrides.length;i.sourceBreakdown.platformExtensions[e.currentPlatform]=l,i.overriddenTokens+=l}}if(e.currentTheme&&e.currentTheme!=="none"){const a=s[e.currentTheme];if(a!=null&&a.tokenOverrides){const l=a.tokenOverrides.length;i.sourceBreakdown.themeOverrides[e.currentTheme]=l,i.overriddenTokens+=l}}return i.platformCount=Object.keys(n).length,i.themeCount=Object.keys(s).length,i}validateMergedData(e){var s,i,a;const r=[],n=[];try{if(e.systemId||r.push("Missing systemId"),e.systemName||r.push("Missing systemName"),e.version||r.push("Missing version"),e.tokens)for(const u of e.tokens)u.id||r.push(`Token missing ID: ${u.displayName||"Unknown"}`),u.resolvedValueTypeId||r.push(`Token missing resolvedValueTypeId: ${u.id}`);if(e.collections)for(const u of e.collections)u.id||r.push(`Collection missing ID: ${u.displayName||"Unknown"}`);if(e.dimensions)for(const u of e.dimensions)u.id||r.push(`Dimension missing ID: ${u.displayName||"Unknown"}`);const l=new Set,c=new Set,d=new Set;(s=e.tokens)==null||s.forEach(u=>{l.has(u.id)&&n.push(`Duplicate token ID: ${u.id}`),l.add(u.id)}),(i=e.collections)==null||i.forEach(u=>{c.has(u.id)&&n.push(`Duplicate collection ID: ${u.id}`),c.add(u.id)}),(a=e.dimensions)==null||a.forEach(u=>{d.has(u.id)&&n.push(`Duplicate dimension ID: ${u.id}`),d.add(u.id)})}catch(l){r.push(`Validation error: ${l instanceof Error?l.message:"Unknown error"}`)}return{isValid:r.length===0,errors:r,warnings:n}}coreToMergedSnapshot(e){var r;return e?((r=e.tokens)==null||r.forEach(n=>{this.sourceTracking.set(n.id,{sourceType:"core",sourceId:null,isOverride:!1})}),{collections:e.tokenCollections||[],modes:this.extractModes(e.dimensions||[]),dimensions:e.dimensions||[],resolvedValueTypes:e.resolvedValueTypes||[],platforms:e.platforms||[],themes:e.themes||[],tokens:e.tokens||[],taxonomies:e.taxonomies||[],componentProperties:e.componentProperties||[],componentCategories:e.componentCategories||[],components:e.components||[],taxonomyOrder:e.taxonomyOrder||[],dimensionOrder:e.dimensionOrder||[],algorithmFile:null,systemName:e.systemName||"Design System",systemId:e.systemId||"design-system",version:e.version||"1.0.0",figmaConfiguration:e.figmaConfiguration||null}):{collections:[],modes:[],dimensions:[],resolvedValueTypes:[],platforms:[],themes:[],tokens:[],taxonomies:[],componentProperties:[],componentCategories:[],components:[],taxonomyOrder:[],dimensionOrder:[],algorithmFile:null,systemName:"Design System",systemId:"design-system",version:"1.0.0",figmaConfiguration:null}}mergePlatformExtension(e,r,n){const s={...e};if(r.tokenOverrides)for(const a of r.tokenOverrides){const l=s.tokens.findIndex(c=>c.id===a.id);l>=0?(s.tokens[l]={...s.tokens[l],...a,omit:a.omit||!1},this.sourceTracking.set(a.id,{sourceType:"platform-extension",sourceId:n,isOverride:!0,originalValue:s.tokens[l]})):(s.tokens.push(a),this.sourceTracking.set(a.id,{sourceType:"platform-extension",sourceId:n,isOverride:!1}))}const i=new Set;for(const a of s.tokens)for(const l of a.valuesByMode||[])l.value&&typeof l.value=="object"&&"tokenId"in l.value&&i.add(l.value.tokenId);return s.tokens=s.tokens.filter(a=>a.omit?i.has(a.id)?(console.log(`[EnhancedDataMerger] Preserving omitted token ${a.id} because it is referenced by other tokens`),!0):(console.log(`[EnhancedDataMerger] Removing omitted token ${a.id} (not referenced)`),!1):!0),r.omittedModes&&(s.modes=s.modes.filter(a=>!r.omittedModes.includes(a.id))),r.omittedDimensions&&(s.dimensions=s.dimensions.filter(a=>!r.omittedDimensions.includes(a.id)),s.dimensionOrder&&(s.dimensionOrder=s.dimensionOrder.filter(a=>!r.omittedDimensions.includes(a)),console.log("[EnhancedDataMerger] Updated dimensionOrder after removing omitted dimensions:",s.dimensionOrder))),s}mergeThemeOverride(e,r,n){const s={...e};if(r.tokenOverrides)for(const i of r.tokenOverrides){const a=s.tokens.findIndex(l=>l.id===i.tokenId);if(a>=0){const l=s.tokens[a];s.tokens[a]={...l,valuesByMode:i.valuesByMode},this.sourceTracking.set(i.tokenId,{sourceType:"theme-override",sourceId:n,isOverride:!0,originalValue:l})}}return s}extractModes(e){const r=[];return e.forEach(n=>{n.modes&&r.push(...n.modes)}),r}clearSourceTracking(){this.sourceTracking.clear()}getAllSourceInfo(){return new Map(this.sourceTracking)}trackOverride(e,r,n,s,i){this.overrideTracking.set(e,{originalValue:r,newValue:n,sourceType:s,sourceId:i,isOverride:!0})}getPendingOverrides(){return Array.from(this.overrideTracking.entries()).map(([e,r])=>({tokenId:e,override:r.newValue}))}commitOverrides(){this.overrideTracking.clear()}discardOverrides(){this.overrideTracking.clear()}mergeWithOverrides(e,r,n,s){const i={currentPlatform:null,currentTheme:null,availablePlatforms:[],availableThemes:[],permissions:{core:!1,platforms:{},themes:{}},repositories:{core:null,platforms:{},themes:{}},editMode:{isActive:!1,sourceType:"core",sourceId:null,targetRepository:null,validationSchema:"schema"},viewMode:{isMerged:!1,mergeSources:["core"],displayData:"core-only"},platformSyntaxPatterns:{}},a=this.mergeData(i,e,r,n);for(const{tokenId:l,override:c}of s){const d=a.tokens.findIndex(u=>u.id===l);d>=0&&(a.tokens[d]={...a.tokens[d],...c})}return a}trackSourceInformation(e,r){var n,s,i,a;(n=e.tokens)==null||n.forEach(l=>{this.sourceTracking.set(l.id,{sourceType:"core",sourceId:null,isOverride:!1})}),r.currentPlatform&&r.currentPlatform!=="none"&&((s=e.platformExtensions)==null||s.forEach(l=>{var c;(c=l.tokenOverrides)==null||c.forEach(d=>{this.sourceTracking.set(d.id,{sourceType:"platform-extension",sourceId:r.currentPlatform,isOverride:!0})})})),r.currentTheme&&r.currentTheme!=="none"&&((a=(i=e.themeOverrides)==null?void 0:i[r.currentTheme])==null||a.forEach(l=>{this.sourceTracking.set(l.tokenId,{sourceType:"theme-override",sourceId:r.currentTheme,isOverride:!0})}))}};rt(ta,"instance");let gu=ta;const ra=class ra{constructor(){rt(this,"callbacks",{});rt(this,"isInitialized",!1);rt(this,"isPreloadingPlatformExtensions",!1);rt(this,"isPreloadingThemeOverrides",!1);rt(this,"state",{presentationData:{collections:[],modes:[],dimensions:[],resolvedValueTypes:[],platforms:[],themes:[],tokens:[],taxonomies:[],componentProperties:[],componentCategories:[],components:[],algorithms:[],taxonomyOrder:[],dimensionOrder:[],algorithmFile:null,linkedRepositories:[],platformExtensions:{},themeOverrides:null,figmaConfiguration:null},storageData:{core:null,platformExtensions:{},themeOverrides:{}},currentSourceType:"core",currentSourceId:void 0})}static getInstance(){return ra.instance||(ra.instance=new ra),ra.instance}setCallbacks(e){this.callbacks={...this.callbacks,...e}}async initialize(e={}){var n,s;if(this.callbacks=e,this.isInitialized)return this.getCurrentSnapshot();console.log("[DataManager] Initializing...");const r=this.loadFromStorage();return r.platforms.length>0&&await this.preloadPlatformExtensions(r.platforms),r.themes.length>0&&await this.preloadThemeOverrides(r.themes),r.themes.length>0&&await this.preloadThemeOverrides(r.themes),this.setBaseline(r),this.updatePresentationData(),this.isInitialized=!0,(s=(n=this.callbacks).onDataLoaded)==null||s.call(n,this.state.presentationData),console.log("[DataManager] Initialized with data:",{tokens:this.state.presentationData.tokens.length,collections:this.state.presentationData.collections.length,dimensions:this.state.presentationData.dimensions.length,platforms:this.state.presentationData.platforms.length}),this.state.presentationData}async loadFromGitHub(e,r){var n,s,i,a;console.log("[DataManager] Loading GitHub data with file type:",r);try{let l;if(r==="schema")l=this.processSchemaData(e);else if(r==="theme-override")l=this.processThemeOverrideData(e);else if(r==="platform-extension")console.log("[DataManager] Treating platform extension as schema file for repository selection"),l=this.processSchemaData(e);else throw new Error(`Unsupported file type: ${r}`);return l.platforms.length>0&&await this.preloadPlatformExtensions(l.platforms),this.storeSnapshot(l),console.log("[DataManager] Stored GitHub data snapshot in localStorage"),this.setBaseline(l),console.log("[DataManager] Set new baseline for change tracking"),this.updatePresentationData(),(s=(n=this.callbacks).onDataLoaded)==null||s.call(n,this.state.presentationData),(a=(i=this.callbacks).onBaselineUpdated)==null||a.call(i,this.state.presentationData),console.log("[DataManager] Successfully loaded GitHub data:",{tokens:this.state.presentationData.tokens.length,collections:this.state.presentationData.collections.length,dimensions:this.state.presentationData.dimensions.length}),this.state.presentationData}catch(l){throw console.error("[DataManager] Error loading GitHub data:",l),l}}async loadFromURLConfig(e){var r,n,s,i;console.log("[DataManager] Loading data from URL config:",e);try{const a=e.path||"schema.json",l=e.branch||"main",c=Yt.isAuthenticated();let d;c?(console.log("[DataManager] Using authenticated access for repository:",e.repo),d=await xt.getFileContent(e.repo,a,l)):(console.log("[DataManager] Using public access for repository:",e.repo),d=await xt.getPublicFileContent(e.repo,a,l));const u=JSON.parse(d.content);console.log("[DataManager] Parsed data themes:",u.themes);const m=this.processSchemaData(u);return this.storeSnapshot(m),this.setBaseline(m),this.updatePresentationData(),(n=(r=this.callbacks).onDataLoaded)==null||n.call(r,this.state.presentationData),(i=(s=this.callbacks).onBaselineUpdated)==null||i.call(s,this.state.presentationData),console.log("[DataManager] Successfully loaded URL config data:",{repo:e.repo,path:a,branch:l,tokens:this.state.presentationData.tokens.length,collections:this.state.presentationData.collections.length,dimensions:this.state.presentationData.dimensions.length}),this.state.presentationData}catch(a){throw console.error("[DataManager] Error loading URL config data:",a),a}}updateData(e){var s,i;const n={...this.getCurrentSnapshot(),...e};return this.storeSnapshot(n),(i=(s=this.callbacks).onDataChanged)==null||i.call(s,n),n}getCurrentSnapshot(){return this.loadFromStorage()}hasExistingData(){const e=L.getTokens(),r=L.getCollections(),n=L.getDimensions();return e.length>0||r.length>0||n.length>0}clearAllData(){var r,n,s,i;console.log("[DataManager] Clearing all data"),L.clearAll();const e={collections:[],modes:[],dimensions:[],resolvedValueTypes:[],platforms:[],themes:[],tokens:[],taxonomies:[],componentProperties:[],componentCategories:[],components:[],algorithms:[],taxonomyOrder:[],dimensionOrder:[],algorithmFile:null,linkedRepositories:[],platformExtensions:{},themeOverrides:null,figmaConfiguration:null};return this.setBaseline(e),(n=(r=this.callbacks).onDataLoaded)==null||n.call(r,e),(i=(s=this.callbacks).onDataChanged)==null||i.call(s,e),e}resetBaselineToCurrent(){var r,n;console.log("[DataManager] Resetting baseline to current data");const e=this.getCurrentSnapshot();this.setBaseline(e),(n=(r=this.callbacks).onBaselineUpdated)==null||n.call(r,e)}loadFromStorage(){const e={collections:L.getCollections(),modes:L.getModes(),dimensions:L.getDimensions(),resolvedValueTypes:L.getValueTypes(),platforms:L.getPlatforms(),themes:L.getThemes(),tokens:L.getTokens(),taxonomies:L.getTaxonomies(),componentProperties:L.getComponentProperties(),componentCategories:L.getComponentCategories(),components:L.getComponents(),algorithms:L.getAlgorithms(),taxonomyOrder:L.getTaxonomyOrder(),dimensionOrder:L.getDimensionOrder(),algorithmFile:L.getAlgorithmFile(),linkedRepositories:L.getLinkedRepositories(),platformExtensions:L.getPlatformExtensions(),themeOverrides:L.getThemeOverrides(),figmaConfiguration:L.getFigmaConfiguration()};return this.state.storageData={core:{systemName:"Design System",systemId:"design-system",version:"1.0.0",versionHistory:[],dimensions:e.dimensions,dimensionOrder:e.dimensionOrder,taxonomyOrder:e.taxonomyOrder,tokenCollections:e.collections,tokens:e.tokens,platforms:e.platforms,themes:e.themes||[],taxonomies:e.taxonomies,standardPropertyTypes:[],propertyTypes:[],resolvedValueTypes:e.resolvedValueTypes,componentProperties:e.componentProperties,componentCategories:e.componentCategories,components:e.components,figmaConfiguration:e.figmaConfiguration||{fileKey:"",fileColorProfile:"srgb"}},platformExtensions:e.platformExtensions||{},themeOverrides:e.themeOverrides||{}},e}storeSnapshot(e){console.log("[DataManager] storeSnapshot called at:",new Date().toISOString()),console.log("[DataManager] Storing themes:",e.themes),L.setCollections(e.collections),L.setModes(e.modes),L.setDimensions(e.dimensions),L.setValueTypes(e.resolvedValueTypes),L.setTokens(e.tokens),L.setPlatforms(e.platforms),L.setThemes(e.themes),L.setTaxonomies(e.taxonomies),L.setComponentProperties(e.componentProperties),L.setComponentCategories(e.componentCategories),L.setComponents(e.components),L.setAlgorithms(e.algorithms),L.setTaxonomyOrder(e.taxonomyOrder),L.setDimensionOrder(e.dimensionOrder),e.algorithmFile&&L.setAlgorithmFile(e.algorithmFile),L.setLinkedRepositories(e.linkedRepositories),L.setPlatformExtensions(e.platformExtensions),L.setThemeOverrides(e.themeOverrides),L.setFigmaConfiguration(e.figmaConfiguration)}setBaseline(e){var n,s;const r={collections:e.collections,modes:e.modes,dimensions:e.dimensions,resolvedValueTypes:e.resolvedValueTypes,platforms:e.platforms,themes:e.themes,tokens:e.tokens,taxonomies:e.taxonomies,componentProperties:e.componentProperties,componentCategories:e.componentCategories,components:e.components,algorithms:e.algorithms,taxonomyOrder:e.taxonomyOrder,linkedRepositories:e.linkedRepositories,platformExtensions:e.platformExtensions,themeOverrides:e.themeOverrides,figmaConfiguration:e.figmaConfiguration};Gn.setBaselineData(r),(s=(n=this.callbacks).onBaselineUpdated)==null||s.call(n,e)}processSchemaData(e){console.log("[DataManager] processSchemaData called at:",new Date().toISOString()),console.log("[DataManager] Raw themes from fileContent:",e.themes);const r=e.tokenCollections??[],n=e.dimensions??[],s=(e.tokens??[]).map(C=>({...C,valuesByMode:C.valuesByMode})),i=e.platforms??[],a=(e.themes??[]).map(C=>(console.log(`[DataManager] Processing theme ${C.id}:`,C),{id:C.id,displayName:C.displayName,description:C.description,overrideSource:C.overrideSource,status:C.status}));console.log("[DataManager] Normalized themes:",a);const l=e.taxonomies??[],c=e.resolvedValueTypes??[],d=e.taxonomyOrder??l.map(C=>C.id),u=e.componentProperties??[],m=e.componentCategories??[],g=e.components??[],y=n.flatMap(C=>C.modes||[]),v=e.systemName??"Design System",I=e.systemId??"design-system",S=e.description??"A comprehensive design system with tokens, dimensions, and themes",b=e.version??"1.0.0",k=e.versionHistory??[];L.setRootData({systemName:v,systemId:I,description:S,version:b,versionHistory:k});const A=e.figmaConfiguration??null;return{collections:r,modes:y,dimensions:n,resolvedValueTypes:c,platforms:i,themes:a,tokens:s,taxonomies:l,componentProperties:u,componentCategories:m,components:g,algorithms:[],taxonomyOrder:d,dimensionOrder:n.map(C=>C.id),algorithmFile:null,linkedRepositories:[],platformExtensions:{},themeOverrides:null,figmaConfiguration:A}}processThemeOverrideData(e){return console.log("[DataManager] Theme override processing not yet implemented for:",e),this.getCurrentSnapshot()}async preloadPlatformExtensions(e){const r=e.filter(s=>s.extensionSource);if(r.length===0){console.log("[DataManager] No platforms with extensions to pre-load");return}if(this.isPreloadingPlatformExtensions){console.log("[DataManager] Platform extension preloading already in progress, skipping");return}this.isPreloadingPlatformExtensions=!0,console.log("[DataManager] Pre-loading platform extensions for",r.length,"platforms"),Di.clearAllCache(),eu.getInstance().clearCache();const n=r.map(async s=>{var i;try{const{repositoryUri:a,filePath:l}=s.extensionSource;console.log(`[DataManager] Pre-loading platform extension for ${s.id} (${s.displayName}) from ${a}/${l}`);const c=await Di.getPlatformExtensionData(a,l,"main",s.id);if(c.error){const d=(i=s.extensionSource)==null?void 0:i.repositoryUri.match(/^company\/design-system-/),u=c.error.includes("Private repository")||c.error.includes("authentication required")||c.error.includes("access not available");d&&u?console.log(`[DataManager] Skipping private platform extension ${s.id} (${s.displayName}) - authentication required`):console.warn(`[DataManager] Platform extension ${s.id} (${s.displayName}) returned error:`,c.error)}else console.log(`[DataManager] Successfully pre-loaded platform extension for ${s.id} (${s.displayName})`)}catch(a){console.error(`[DataManager] Failed to pre-load platform extension for ${s.id} (${s.displayName}):`,{error:a instanceof Error?a.message:"Unknown error",platform:{id:s.id,displayName:s.displayName,extensionSource:s.extensionSource}})}});try{await Promise.allSettled(n),console.log("[DataManager] Completed platform extension pre-loading")}catch(s){console.error("[DataManager] Error during platform extension pre-loading:",s)}finally{this.isPreloadingPlatformExtensions=!1}}async preloadThemeOverrides(e){const r=e.filter(s=>s.overrideSource);if(r.length===0){console.log("[DataManager] No themes with external sources to pre-load");return}if(this.isPreloadingThemeOverrides){console.log("[DataManager] Theme override preloading already in progress, skipping");return}this.isPreloadingThemeOverrides=!0,console.log("[DataManager] Pre-loading theme overrides for",r.length,"themes"),ml.clearAllCache();const n=r.map(async s=>{var i;try{const{repositoryUri:a,filePath:l}=s.overrideSource;console.log(`[DataManager] Pre-loading theme override for ${s.id} (${s.displayName}) from ${a}/${l}`);const c=await ml.getThemeOverrideData(a,l,"main",s.id);if(c.error){const d=(i=s.overrideSource)==null?void 0:i.repositoryUri.match(/^company\/design-system-/),u=c.error.includes("Private repository")||c.error.includes("authentication required")||c.error.includes("access not available")||c.error.includes("404");d&&u?console.log(`[DataManager] Skipping private theme override ${s.id} (${s.displayName}) - authentication required`):console.warn(`[DataManager] Theme override ${s.id} (${s.displayName}) returned error:`,c.error)}else console.log(`[DataManager] Successfully pre-loaded theme override for ${s.id} (${s.displayName})`)}catch(a){console.error(`[DataManager] Failed to pre-load theme override for ${s.id} (${s.displayName}):`,{error:a instanceof Error?a.message:"Unknown error",theme:{id:s.id,displayName:s.displayName,overrideSource:s.overrideSource}})}});try{await Promise.allSettled(n),console.log("[DataManager] Completed theme override pre-loading")}catch(s){console.error("[DataManager] Error during theme override pre-loading:",s)}finally{this.isPreloadingThemeOverrides=!1}}getPresentationSnapshot(){return this.state.presentationData}getStorageDataForSource(e,r){switch(e){case"core":return this.state.storageData.core||{};case"platform-extension":if(!r)throw new Error("Platform ID required for platform extension data");return this.state.storageData.platformExtensions[r]||{};case"theme-override":if(!r)throw new Error("Theme ID required for theme override data");return this.state.storageData.themeOverrides[r]||{};default:throw new Error(`Unknown source type: ${e}`)}}updateDataWithSchemaValidation(e,r,n){try{const s=this.validateDataForStorage(e,r);if(!s.isValid)return s;switch(r){case"core":this.state.storageData.core={...this.state.storageData.core,...e};break;case"platform-extension":if(!n)throw new Error("Platform ID required for platform extension update");this.state.storageData.platformExtensions[n]={...this.state.storageData.platformExtensions[n],...e};break;case"theme-override":if(!n)throw new Error("Theme ID required for theme override update");this.state.storageData.themeOverrides[n]={...this.state.storageData.themeOverrides[n],...e};break}return this.updatePresentationData(),{isValid:!0,errors:[],warnings:[]}}catch(s){return{isValid:!1,errors:[s instanceof Error?s.message:"Update failed"],warnings:[]}}}validateStorageData(e,r){return this.validateDataForStorage(e,r)}setCurrentDataSource(e,r){this.state.currentSourceType=e,this.state.currentSourceId=r}getCurrentDataSource(){return{sourceType:this.state.currentSourceType,sourceId:this.state.currentSourceId}}getEditData(e,r){return this.getStorageDataForSource(e,r)}getViewData(){return this.getPresentationSnapshot()}async updateEditData(e,r,n){try{const{OverrideManager:s}=await ir(async()=>{const{OverrideManager:l}=await import("./overrideManager-CrvGSCwr.js");return{OverrideManager:l}},[]),i=s.getInstance(),a=this.validateDataForStorage(e,r);if(!a.isValid)return a;if(r==="platform-extension"&&n){const l=e.tokens;if(l)for(const c of l){const d=this.findTokenInCoreData(c.id);d&&Gn.trackOverrideChanges(c.id,d,c,r,n)}}else if(r==="theme-override"&&n){const l=e.tokens;if(l)for(const c of l){if(!i.isTokenThemeable(c.id,this.state.storageData.core))return{isValid:!1,errors:[`Token ${c.id} is not themeable and cannot be edited in theme mode`],warnings:[]};const d=this.findTokenInCoreData(c.id);d&&Gn.trackOverrideChanges(c.id,d,c,r,n)}}return this.updateDataWithSchemaValidation(e,r,n)}catch(s){return{isValid:!1,errors:[s instanceof Error?s.message:"Update failed"],warnings:[]}}}findTokenInCoreData(e){var r;return(r=this.state.storageData.core)!=null&&r.tokens&&this.state.storageData.core.tokens.find(n=>n.id===e)||null}getPendingOverrides(){return Gn.getOverrideChanges().map(e=>({tokenId:e.tokenId,override:e.newValue}))}clearPendingOverrides(){Gn.clearOverrideChanges()}validateDataForStorage(e,r){try{switch(r){case"core":Ta.validateCoreData(e);break;case"platform-extension":Ta.validatePlatformExtension(e);break;case"theme-override":Ta.validateThemeOverrideFile(e);break}return{isValid:!0,errors:[],warnings:[]}}catch(n){return{isValid:!1,errors:[n instanceof Error?n.message:"Validation failed"],warnings:[]}}}updatePresentationData(){if(!this.state.storageData.core){console.log("[DataManager] Skipping updatePresentationData - no core data available");return}const e=gu.getInstance();ir(async()=>{const{DataSourceManager:r}=await Promise.resolve().then(()=>IC);return{DataSourceManager:r}},void 0).then(({DataSourceManager:r})=>{var a,l;r.getInstance().getCurrentContext();const s=this.getPendingOverrides(),i=e.mergeWithOverrides(this.state.storageData.core,this.state.storageData.platformExtensions,this.state.storageData.themeOverrides,s);this.state.presentationData={collections:i.collections,modes:i.modes,dimensions:i.dimensions,resolvedValueTypes:i.resolvedValueTypes,platforms:i.platforms,themes:i.themes,tokens:i.tokens,taxonomies:i.taxonomies,componentProperties:i.componentProperties,componentCategories:i.componentCategories,components:i.components,algorithms:[],taxonomyOrder:i.taxonomyOrder,dimensionOrder:i.dimensionOrder,algorithmFile:i.algorithmFile,linkedRepositories:[],platformExtensions:this.state.storageData.platformExtensions,themeOverrides:this.state.storageData.themeOverrides,figmaConfiguration:i.figmaConfiguration},(l=(a=this.callbacks).onDataChanged)==null||l.call(a,this.state.presentationData)}).catch(r=>{console.error("Failed to update presentation data:",r)})}};rt(ra,"instance");let Un=ra;const oc=Object.freeze(Object.defineProperty({__proto__:null,DataManager:Un},Symbol.toStringTag,{value:"Module"})),na=class na{constructor(){rt(this,"callbacks",{});rt(this,"permissionCache",new Map);rt(this,"CACHE_DURATION",5*60*1e3)}static getInstance(){return na.instance||(na.instance=new na),na.instance}setCallbacks(e){this.callbacks={...this.callbacks,...e}}async checkRepositoryPermissions(e){var r,n;try{const s=this.permissionCache.get(e);if(s&&Date.now()-s.timestamp<this.CACHE_DURATION)return s.permissions;const i=await xt.hasWriteAccessToRepository(e);return this.permissionCache.set(e,{permissions:i,timestamp:Date.now()}),i}catch(s){return(n=(r=this.callbacks).onError)==null||n.call(r,s instanceof Error?s.message:"Failed to check repository permissions"),!1}}async checkAllPermissions(e){var r,n,s,i;try{const a={core:!1,platforms:{},themes:{}};e.core&&(a.core=await this.checkRepositoryPermissions(e.core.fullName));for(const[l,c]of Object.entries(e.platforms))c&&(a.platforms[l]=await this.checkRepositoryPermissions(c.fullName));for(const[l,c]of Object.entries(e.themes))c&&(a.themes[l]=await this.checkRepositoryPermissions(c.fullName));return(n=(r=this.callbacks).onPermissionsChanged)==null||n.call(r,a),a}catch(a){return(i=(s=this.callbacks).onError)==null||i.call(s,a instanceof Error?a.message:"Failed to check all permissions"),{core:!1,platforms:{},themes:{}}}}getCurrentEditPermissions(e,r,n){return e&&e!=="none"?n.platforms[e]||!1:r&&r!=="none"?n.themes[r]||!1:n.core}clearCache(){this.permissionCache.clear()}clearCacheForRepository(e){this.permissionCache.delete(e)}getCachedPermissions(e){const r=this.permissionCache.get(e);return r&&Date.now()-r.timestamp<this.CACHE_DURATION?r.permissions:null}isCacheValid(e){const r=this.permissionCache.get(e);return r!==void 0&&Date.now()-r.timestamp<this.CACHE_DURATION}getCacheStats(){const e=Date.now();let r=0,n=0;for(const[,s]of this.permissionCache.entries())e-s.timestamp<this.CACHE_DURATION?r++:n++;return{totalEntries:this.permissionCache.size,validEntries:r,expiredEntries:n}}cleanupExpiredCache(){const e=Date.now();for(const[r,n]of this.permissionCache.entries())e-n.timestamp>=this.CACHE_DURATION&&this.permissionCache.delete(r)}};rt(na,"instance");let Ea=na;const sa=class sa{constructor(){}static getInstance(){return sa.instance||(sa.instance=new sa),sa.instance}hasLocalChanges(){const e=L.getSourceSnapshot(),r=L.getLocalEdits();return!e||!r?!1:!this.isEqual(e,r)}getChangeCount(){return this.getChanges().length}getChanges(){const e=L.getSourceSnapshot(),r=L.getLocalEdits();return!e||!r?[]:this.computeChanges(e,r)}getChangeTracking(){const e=this.getChanges();return{hasChanges:e.length>0,changeCount:e.length,changes:e,lastModified:new Date().toISOString()}}getChangesByEntityType(e){return this.getChanges().filter(r=>r.entityType===e)}getChangesByType(e){return this.getChanges().filter(r=>r.type===e)}getChangesForEntity(e){return this.getChanges().filter(r=>r.entityId===e)}getChangeSummary(){const e=this.getChanges(),r={token:{added:0,modified:0,deleted:0},collection:{added:0,modified:0,deleted:0},dimension:{added:0,modified:0,deleted:0},platform:{added:0,modified:0,deleted:0},theme:{added:0,modified:0,deleted:0},resolvedValueType:{added:0,modified:0,deleted:0},taxonomy:{added:0,modified:0,deleted:0},algorithm:{added:0,modified:0,deleted:0},componentProperty:{added:0,modified:0,deleted:0},componentCategory:{added:0,modified:0,deleted:0},component:{added:0,modified:0,deleted:0},repository:{added:0,modified:0,deleted:0},platformExtension:{added:0,modified:0,deleted:0},platformExtensionFile:{added:0,modified:0,deleted:0},figmaConfiguration:{added:0,modified:0,deleted:0}};return e.forEach(n=>{r[n.entityType]?r[n.entityType][n.type]++:console.warn(`[DataEditorService] Unknown entity type in change: ${n.entityType}`)}),r}hasEntityChanges(e){return this.getChangesForEntity(e).length>0}getMostRecentChange(){const e=this.getChanges();return e.length>0?e[e.length-1]:null}getChangesSince(e){return this.getChanges().filter(n=>!0)}updateLocalEdits(e){L.setLocalEdits(e);const r=L.getSourceContext();r&&(r.hasLocalChanges=this.hasLocalChanges(),r.lastLoadedAt=new Date().toISOString(),L.setSourceContext(r)),console.log("[DataEditorService] Local edits updated")}resetLocalEdits(){const e=L.getSourceSnapshot();if(e){L.setLocalEdits(e);const r=L.getSourceContext();r&&(r.hasLocalChanges=!1,L.setSourceContext(r)),console.log("[DataEditorService] Local edits reset to source snapshot")}}enterEditMode(){const e=L.getSourceContext();e&&(e.editMode.isActive=!0,e.editMode.sourceType=e.sourceType==="platform"?"platform-extension":e.sourceType==="theme"?"theme-override":"core",e.editMode.sourceId=e.sourceId,e.editMode.targetRepository=e.sourceRepository,L.setSourceContext(e),console.log("[DataEditorService] Entered edit mode"))}exitEditMode(){const e=L.getSourceContext();e&&(e.editMode.isActive=!1,e.editMode.targetRepository=null,L.setSourceContext(e),console.log("[DataEditorService] Exited edit mode"))}getEditModeState(){const e=L.getSourceContext();return e?{isActive:e.editMode.isActive,sourceType:e.editMode.sourceType,sourceId:e.editMode.sourceId}:{isActive:!1,sourceType:"core",sourceId:null}}async saveChanges(){try{const e=L.getLocalEdits();if(!e)return{success:!1,error:"No local edits to save"};L.setSourceSnapshot(e);const r=L.getSourceContext();return r&&(r.hasLocalChanges=!1,r.lastLoadedAt=new Date().toISOString(),L.setSourceContext(r)),console.log("[DataEditorService] Changes saved successfully"),{success:!0}}catch(e){return console.error("[DataEditorService] Error saving changes:",e),{success:!1,error:e instanceof Error?e.message:"Failed to save changes"}}}discardChanges(){this.resetLocalEdits(),console.log("[DataEditorService] Changes discarded")}isEqual(e,r){if(e===r)return!0;if(e==null||r==null)return e===r;if(typeof e!=typeof r)return!1;if(typeof e!="object")return e===r;if(Array.isArray(e)!==Array.isArray(r))return!1;if(Array.isArray(e)){if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(!this.isEqual(e[i],r[i]))return!1;return!0}const n=Object.keys(e),s=Object.keys(r);if(n.length!==s.length)return!1;for(const i of n)if(!s.includes(i)||!this.isEqual(e[i],r[i]))return!1;return!0}computeChanges(e,r){const n=[];return this.isEqual(e,r)||(this.isTokenSystem(e)&&this.isTokenSystem(r)?n.push(...this.computeTokenSystemChanges(e,r)):this.isPlatformExtension(e)&&this.isPlatformExtension(r)?n.push(...this.computePlatformExtensionChanges(e,r)):this.isThemeOverride(e)&&this.isThemeOverride(r)?n.push(...this.computeThemeOverrideChanges(e,r)):n.push({type:"modified",path:[],oldValue:e,newValue:r,entityType:"token",entityId:"unknown"})),n}computeTokenSystemChanges(e,r){const n=[];n.push(...this.compareArrays(e.tokens||[],r.tokens||[],"token","id")),n.push(...this.compareArrays(e.tokenCollections||[],r.tokenCollections||[],"collection","id")),n.push(...this.compareArrays(e.dimensions||[],r.dimensions||[],"dimension","id")),n.push(...this.compareArrays(e.platforms||[],r.platforms||[],"platform","id")),n.push(...this.compareArrays(e.themes||[],r.themes||[],"theme","id")),n.push(...this.compareArrays(e.resolvedValueTypes||[],r.resolvedValueTypes||[],"resolvedValueType","id")),n.push(...this.compareArrays(e.taxonomies||[],r.taxonomies||[],"taxonomy","id")),n.push(...this.compareArrays(e.algorithms||[],r.algorithms||[],"algorithm","id")),n.push(...this.compareArrays(e.componentProperties||[],r.componentProperties||[],"componentProperty","id")),n.push(...this.compareArrays(e.componentCategories||[],r.componentCategories||[],"componentCategory","id")),n.push(...this.compareArrays(e.components||[],r.components||[],"component","id")),n.push(...this.compareArrays(e.linkedRepositories||[],r.linkedRepositories||[],"repository","id"));const s=e.platformExtensions||{},i=r.platformExtensions||{},a=Object.keys(s),l=Object.keys(i);for(const k of l)a.includes(k)||n.push({type:"added",path:["platformExtensions",k],oldValue:void 0,newValue:i[k],entityType:"platformExtension",entityId:k});for(const k of a)l.includes(k)||n.push({type:"deleted",path:["platformExtensions",k],oldValue:s[k],newValue:void 0,entityType:"platformExtension",entityId:k});const c=e.platformExtensionFiles||{},d=r.platformExtensionFiles||{},u=Object.keys(c),m=Object.keys(d);for(const k of m)u.includes(k)||n.push({type:"added",path:["platformExtensionFiles",k],oldValue:void 0,newValue:d[k],entityType:"platformExtensionFile",entityId:k});for(const k of u)m.includes(k)||n.push({type:"deleted",path:["platformExtensionFiles",k],oldValue:c[k],newValue:void 0,entityType:"platformExtensionFile",entityId:k});const g=e.taxonomyOrder||[],y=r.taxonomyOrder||[];JSON.stringify(g)!==JSON.stringify(y)&&n.push({type:"modified",path:["taxonomyOrder"],oldValue:g,newValue:y,entityType:"taxonomy",entityId:"taxonomyOrder"});const v=e.dimensionOrder||[],I=r.dimensionOrder||[];JSON.stringify(v)!==JSON.stringify(I)&&n.push({type:"modified",path:["dimensionOrder"],oldValue:v,newValue:I,entityType:"dimension",entityId:"dimensionOrder"});const S=e.figmaConfiguration||{},b=r.figmaConfiguration||{};return JSON.stringify(S)!==JSON.stringify(b)&&n.push({type:"modified",path:["figmaConfiguration"],oldValue:S,newValue:b,entityType:"figmaConfiguration",entityId:"figmaConfiguration"}),n}computePlatformExtensionChanges(e,r){const n=[];return n.push(...this.compareArrays(e.tokenOverrides||[],r.tokenOverrides||[],"token","id")),n.push(...this.compareArrays(e.algorithmVariableOverrides||[],r.algorithmVariableOverrides||[],"token","variableId")),n}computeThemeOverrideChanges(e,r){const n=[];return n.push(...this.compareArrays(e.tokenOverrides||[],r.tokenOverrides||[],"token","tokenId")),n}compareArrays(e,r,n,s){const i=[],a=new Map(e.map(c=>[c[s],c])),l=new Map(r.map(c=>[c[s],c]));for(const[c,d]of l)a.has(c)||i.push({type:"added",path:[n+"s"],newValue:d,entityType:n,entityId:c});for(const[c,d]of a)l.has(c)||i.push({type:"deleted",path:[n+"s"],oldValue:d,entityType:n,entityId:c});for(const[c,d]of l){const u=a.get(c);u&&!this.isEqual(u,d)&&i.push({type:"modified",path:[n+"s",c],oldValue:u,newValue:d,entityType:n,entityId:c})}return i}isTokenSystem(e){return e&&typeof e=="object"&&"systemId"in e&&"tokens"in e}isPlatformExtension(e){return e&&typeof e=="object"&&"platformId"in e}isThemeOverride(e){return e&&typeof e=="object"&&"themeId"in e}getCurrentEditData(){return L.getLocalEdits()}getCurrentDisplayData(){return L.getMergedData()}updateMergedData(e){L.setMergedData(e),console.log("[DataEditorService] Merged data updated")}};rt(sa,"instance");let ti=sa;const oa=class oa{constructor(){}static getInstance(){return oa.instance||(oa.instance=new oa),oa.instance}parseURLParameters(e){const r=e.get("repo"),n=e.get("path"),s=e.get("branch")||"main",i=e.get("platform"),a=e.get("theme");let l="core";return a?l="theme":i&&(l="platform"),{repo:r,path:n,branch:s,platformId:i,themeId:a,sourceType:l}}async switchSource(e,r){try{console.log(`[SourceManagerService] Switching source to ${e}${r?` (${r})`:""}`);const n=ti.getInstance();if(n.hasLocalChanges()&&!await this.showChangeWarning())return{success:!1,error:"Source switch cancelled by user",changesDiscarded:!1};const s=L.getSourceContext();console.log(`[SourceManagerService] About to call loadSourceSnapshot for ${e}${r?` (${r})`:""}`);const i=await this.loadSourceSnapshot(e,r);if(console.log(`[SourceManagerService] loadSourceSnapshot returned: ${i}`),!i)return console.error(`[SourceManagerService] loadSourceSnapshot failed for ${e}${r?` (${r})`:""}`),{success:!1,error:`Failed to load source snapshot for ${e}${r?` (${r})`:""}`};const a=await this.updateSourceContext(e,r);if(!a)return{success:!1,error:"Failed to update source context"};ti.getInstance().resetLocalEdits();const c=Un.getInstance();return console.log("[SourceManagerService] Triggering DataManager presentation data update"),console.log("[SourceManagerService] Source switch completed successfully"),{success:!0,previousSource:s,newSource:a,changesDiscarded:n.hasLocalChanges()}}catch(n){return console.error("[SourceManagerService] Error during source switch:",n),{success:!1,error:n instanceof Error?n.message:"Unknown error during source switch"}}}async loadSourceSnapshot(e,r){var s,i;console.log(`[SourceManagerService] loadSourceSnapshot called with sourceType: ${e}, sourceId: ${r}`);const n=L.getCoreData();if(!n)return console.error("[SourceManagerService] No core data available for loading source snapshot"),!1;try{if(e==="core")return L.setSourceSnapshot(n),!0;if(e==="platform"&&r){let a=L.getPlatformExtensionData(r);if(!a){console.log(`[SourceManagerService] Platform data not in storage, loading from GitHub for ID: ${r}`);try{const c=xr.getInstance().getCurrentContext();console.log("[SourceManagerService] Available platform repositories:",c.repositories.platforms),console.log(`[SourceManagerService] Looking for platform ID: ${r}`);const d=c.repositories.platforms[r];if(d){console.log(`[SourceManagerService] Loading platform extension from ${d.fullName}/${d.filePath}`);const{GitHubApiService:u}=await ir(async()=>{const{GitHubApiService:g}=await Promise.resolve().then(()=>fo);return{GitHubApiService:g}},void 0),m=await u.getFileContent(d.fullName,d.filePath,d.branch);m&&m.content&&(a=JSON.parse(m.content),console.log("[SourceManagerService] Platform extension data loaded from GitHub:",a),L.setPlatformExtensionData(r,a))}else{console.log(`[SourceManagerService] No repository info found, trying PlatformExtensionDataService for ${r}`);const u=L.getCoreData(),m=(s=u==null?void 0:u.platforms)==null?void 0:s.find(g=>g.id===r);if(m!=null&&m.extensionSource){console.log("[SourceManagerService] Found platform extension source:",m.extensionSource);const{PlatformExtensionDataService:g}=await ir(async()=>{const{PlatformExtensionDataService:v}=await Promise.resolve().then(()=>Jv);return{PlatformExtensionDataService:v}},void 0),y=await g.getPlatformExtensionData(m.extensionSource.repositoryUri,m.extensionSource.filePath,"main",r);y.data&&!y.error?(a=y.data,console.log("[SourceManagerService] Platform extension data loaded via PlatformExtensionDataService:",a),L.setPlatformExtensionData(r,a)):console.error(`[SourceManagerService] PlatformExtensionDataService failed for ${r}:`,y.error)}else console.error(`[SourceManagerService] No extension source found for platform ${r}`)}}catch(l){console.error(`[SourceManagerService] Failed to load platform extension from GitHub for ${r}:`,l)}}return a?(console.log("[SourceManagerService] Platform data loaded successfully, setting source snapshot"),L.setSourceSnapshot(a),!0):(console.error(`[SourceManagerService] Platform data not found for ID: ${r}`),!1)}if(e==="theme"&&r){let a=L.getThemeOverrideData(r);if(!a){console.log(`[SourceManagerService] Theme data not in storage, loading from GitHub for ID: ${r}`);try{const d=xr.getInstance().getCurrentContext().repositories.themes[r];if(d){console.log(`[SourceManagerService] Loading theme override from ${d.fullName}/${d.filePath}`);const{GitHubApiService:u}=await ir(async()=>{const{GitHubApiService:g}=await Promise.resolve().then(()=>fo);return{GitHubApiService:g}},void 0);let m;try{m=await u.getFileContent(d.fullName,d.filePath,d.branch)}catch{console.log("[SourceManagerService] Authenticated theme loading failed, trying public API"),m=await u.getPublicFileContent(d.fullName,d.filePath,d.branch)}m&&m.content&&(a=JSON.parse(m.content),console.log("[SourceManagerService] Theme override data loaded from GitHub:",a),L.setThemeOverrideData(r,a))}else{console.log(`[SourceManagerService] Theme repository not found in context, loading directly from core data for: ${r}`);const u=L.getCoreData(),m=(i=u==null?void 0:u.themes)==null?void 0:i.find(g=>g.id===r);if(m!=null&&m.overrideSource){const{repositoryUri:g,filePath:y}=m.overrideSource,v="main";console.log(`[SourceManagerService] Loading theme override directly from ${g}/${y}`);const{GitHubApiService:I}=await ir(async()=>{const{GitHubApiService:b}=await Promise.resolve().then(()=>fo);return{GitHubApiService:b}},void 0);let S;try{S=await I.getFileContent(g,y,v)}catch{console.log("[SourceManagerService] Authenticated theme loading failed, trying public API"),S=await I.getPublicFileContent(g,y,v)}S&&S.content&&(a=JSON.parse(S.content),console.log("[SourceManagerService] Theme override data loaded from GitHub:",a),L.setThemeOverrideData(r,a))}}}catch(l){console.error(`[SourceManagerService] Failed to load theme override from GitHub for ${r}:`,l)}}return a?(L.setSourceSnapshot(a),!0):(console.error(`[SourceManagerService] Theme data not found for ID: ${r}`),!1)}return!1}catch(a){return console.error("[SourceManagerService] Error loading source snapshot:",a),!1}}async updateSourceContext(e,r){var l,c;const n=L.getSourceContext();if(!n)return console.error("[SourceManagerService] No current source context available"),null;const s=L.getCoreData();let i;if(e==="platform"&&r){const d=(l=s==null?void 0:s.platforms)==null?void 0:l.find(u=>u.id===r);d!=null&&d.extensionSource?(i={fullName:d.extensionSource.repositoryUri,branch:"main",filePath:d.extensionSource.filePath,fileType:"platform-extension"},console.log(`[SourceManagerService] Platform extension repository: ${d.extensionSource.repositoryUri}/${d.extensionSource.filePath}`)):(console.warn(`[SourceManagerService] Platform ${r} not found in core data or missing extensionSource`),i=n.sourceRepository)}else if(e==="theme"&&r){const d=(c=s==null?void 0:s.themes)==null?void 0:c.find(u=>u.id===r);d!=null&&d.overrideSource?(i={fullName:d.overrideSource.repositoryUri,branch:"main",filePath:d.overrideSource.filePath,fileType:"theme-override"},console.log(`[SourceManagerService] Theme override repository: ${d.overrideSource.repositoryUri}/${d.overrideSource.filePath}`)):(console.warn(`[SourceManagerService] Theme ${r} not found in core data or missing overrideSource`),i=n.sourceRepository)}else i=n.coreRepository;const a={...n,sourceType:e,sourceId:r||null,sourceRepository:i,lastLoadedAt:new Date().toISOString(),hasLocalChanges:!1,editMode:{...n.editMode,sourceType:e==="platform"?"platform-extension":e==="theme"?"theme-override":"core",sourceId:r||null}};return L.setSourceContext(a),console.log("[SourceManagerService] Source context updated with proper repository mapping"),a}async showChangeWarning(){return console.warn("[SourceManagerService] Unsaved changes detected. User would be prompted to confirm."),!0}getCurrentSourceContext(){return L.getSourceContext()}getCurrentSourceType(){const e=L.getSourceContext();return(e==null?void 0:e.sourceType)||"core"}getCurrentSourceId(){const e=L.getSourceContext();return(e==null?void 0:e.sourceId)||null}hasLocalChanges(){return ti.getInstance().hasLocalChanges()}getAvailablePlatforms(){const e=L.getCoreData();return e!=null&&e.platforms?e.platforms.map(r=>({id:r.id,displayName:r.displayName})):[]}getAvailableThemes(){const e=L.getCoreData();return e!=null&&e.themes?e.themes.map(r=>({id:r.id,displayName:r.displayName})):[]}getCurrentRepositoryInfo(){const e=L.getSourceContext();return e?e.sourceRepository:null}getCoreRepositoryInfo(){const e=L.getSourceContext();return e?e.coreRepository:null}isSourceSwitchingAvailable(){const e=L.getCoreData();if(!e)return!1;const r=e.platforms&&e.platforms.length>0,n=e.themes&&e.themes.length>0;return r||n}getSourceSwitchingOptions(){return{platforms:this.getAvailablePlatforms(),themes:this.getAvailableThemes()}}validateSourceConfiguration(e,r){return e==="core"?{isValid:!0}:e==="platform"?r?this.getAvailablePlatforms().some(i=>i.id===r)?{isValid:!0}:{isValid:!1,error:`Platform with ID '${r}' not found`}:{isValid:!1,error:"Platform ID is required for platform source type"}:e==="theme"?r?this.getAvailableThemes().some(i=>i.id===r)?{isValid:!0}:{isValid:!1,error:`Theme with ID '${r}' not found`}:{isValid:!1,error:"Theme ID is required for theme source type"}:{isValid:!1,error:`Unknown source type: ${e}`}}};rt(oa,"instance");let ni=oa;const ia=class ia{constructor(){rt(this,"currentContext",null)}static getInstance(){return ia.instance||(ia.instance=new ia),ia.instance}setContext(e){console.log("[SourceContextManager] Setting context:",e),this.currentContext=e,window.dispatchEvent(new CustomEvent("source-context-changed",{detail:{context:e}}))}getContext(){return this.currentContext}validateContext(){if(!this.currentContext)return console.warn("[SourceContextManager] No context available"),!1;const{sourceType:e,repositoryInfo:r,schemaType:n}=this.currentContext;return!e||!(r!=null&&r.fullName)||!n?(console.warn("[SourceContextManager] Invalid context:",this.currentContext),!1):!0}clearContext(){console.log("[SourceContextManager] Clearing context"),this.currentContext=null,window.dispatchEvent(new CustomEvent("source-context-cleared"))}updateFromDataSource(){var m,g,y,v,I,S;const r=xr.getInstance().getCurrentContext(),s=ni.getInstance().getCurrentSourceContext();if(!s){console.warn("[SourceContextManager] No source context available");return}let i="core",a="schema",l=null,c=null;(m=r.editMode)!=null&&m.sourceType&&((g=r.editMode)!=null&&g.sourceId)?(i=r.editMode.sourceType,a=r.editMode.sourceType==="core"?"schema":r.editMode.sourceType,l=r.editMode.sourceId,i==="platform-extension"?c=((y=r.availablePlatforms.find(b=>b.id===l))==null?void 0:y.displayName)||null:i==="theme-override"&&(c=((v=r.availableThemes.find(b=>b.id===l))==null?void 0:v.displayName)||null),console.log("[SourceContextManager] Using editMode context:",{sourceType:i,sourceId:l,sourceName:c})):r.currentPlatform&&r.currentPlatform!=="none"?(i="platform-extension",a="platform-extension",l=r.currentPlatform,c=((I=r.availablePlatforms.find(b=>b.id===l))==null?void 0:I.displayName)||null,console.log("[SourceContextManager] Using currentPlatform fallback:",{sourceType:i,sourceId:l,sourceName:c})):r.currentTheme&&r.currentTheme!=="none"?(i="theme-override",a="theme-override",l=r.currentTheme,c=((S=r.availableThemes.find(b=>b.id===l))==null?void 0:S.displayName)||null,console.log("[SourceContextManager] Using currentTheme fallback:",{sourceType:i,sourceId:l,sourceName:c})):console.log("[SourceContextManager] Using core data as default");let d=r.repositories.core;if(i==="platform-extension"&&l?d=r.repositories.platforms[l]:i==="theme-override"&&l&&(d=r.repositories.themes[l]),!d){console.warn("[SourceContextManager] No repository info available for source type:",i);return}const u={sourceType:i,sourceId:l,sourceName:c,repositoryInfo:{fullName:d.fullName,branch:d.branch,filePath:d.filePath,fileType:d.fileType},schemaType:a,editMode:s.editMode};this.setContext(u)}getTargetSchemaType(){return this.validateContext()?this.currentContext.schemaType:"schema"}getTargetRepositoryInfo(){return this.validateContext()?this.currentContext.repositoryInfo:null}isPlatformExtension(){var e;return((e=this.currentContext)==null?void 0:e.sourceType)==="platform-extension"}isThemeOverride(){var e;return((e=this.currentContext)==null?void 0:e.sourceType)==="theme-override"}isCoreData(){var e;return((e=this.currentContext)==null?void 0:e.sourceType)==="core"}};rt(ia,"instance");let ri=ia;const aa=class aa{constructor(){rt(this,"callbacks",{});rt(this,"linkedRepositories",new Map);rt(this,"currentData",{core:null,platformExtensions:new Map,themeOverrides:null,mergedData:null,analytics:{totalTokens:0,overriddenTokens:0,newTokens:0,omittedTokens:0,platformCount:0,themeCount:0}});rt(this,"dataManager",Un.getInstance());this.loadPersistedData()}detectCurrentDataType(e){return e.tokens&&Array.isArray(e.tokens)&&e.tokens.length>0?"core":e.themeOverrides&&typeof e.themeOverrides=="object"&&Object.keys(e.themeOverrides).length>0?"theme":e.platformExtensions&&typeof e.platformExtensions=="object"&&Object.keys(e.platformExtensions).length>0&&(!e.tokens||!Array.isArray(e.tokens)||e.tokens.length===0)?"extension":"core"}static getInstance(){return aa.instance||(aa.instance=new aa),aa.instance}loadPersistedData(){try{const e=this.dataManager.getCurrentSnapshot();this.linkedRepositories.clear(),e.linkedRepositories.forEach(r=>{this.linkedRepositories.set(r.id,r)}),this.currentData.platformExtensions.clear(),Object.entries(e.platformExtensions).forEach(([r,n])=>{this.currentData.platformExtensions.set(r,n)}),this.currentData.themeOverrides=e.themeOverrides,console.log("[MultiRepositoryManager] Loaded persisted data:",{repositories:this.linkedRepositories.size,platformExtensions:this.currentData.platformExtensions.size,hasThemeOverrides:!!this.currentData.themeOverrides})}catch(e){console.error("[MultiRepositoryManager] Failed to load persisted data:",e)}}persistData(){try{const r={...this.dataManager.getCurrentSnapshot(),linkedRepositories:Array.from(this.linkedRepositories.values()),platformExtensions:Object.fromEntries(this.currentData.platformExtensions),themeOverrides:this.currentData.themeOverrides};this.dataManager.updateData(r),console.log("[MultiRepositoryManager] Persisted data through DataManager")}catch(e){console.error("[MultiRepositoryManager] Failed to persist data:",e)}}setCallbacks(e){this.callbacks={...this.callbacks,...e}}async linkRepository(e,r,n,s,i,a){var m,g,y,v;const l=this.dataManager.getCurrentSnapshot(),c=this.detectCurrentDataType(l);if(c==="core"&&e!=="platform-extension")throw new Error("Core data can only link to platform extension repositories");if(c==="extension"&&e!=="core")throw new Error("Extension data can only link to core repositories");if(c==="extension"&&e==="core"&&Array.from(this.linkedRepositories.values()).filter(S=>S.type==="core").length>0)throw new Error("Extension data can only have one core repository link");const d=this.generateLinkId(e,r,s,i,a),u={id:d,type:e,repositoryUri:r,branch:n,filePath:s,platformId:i,themeId:a,status:"loading"};this.linkedRepositories.set(d,u),this.persistData(),(g=(m=this.callbacks).onRepositoryLinked)==null||g.call(m,u);try{await this.loadRepositoryData(u),await this.updateMergedData(),u.status="synced",u.lastSync=new Date().toISOString(),this.persistData()}catch(I){u.status="error",u.error=I instanceof Error?I.message:"Unknown error",this.persistData(),(v=(y=this.callbacks).onError)==null||v.call(y,u.error)}return u}unlinkRepository(e){var n,s;const r=this.linkedRepositories.get(e);r&&(this.linkedRepositories.delete(e),this.persistData(),(s=(n=this.callbacks).onRepositoryUnlinked)==null||s.call(n,e),r.type==="core"?this.currentData.core=null:r.type==="platform-extension"&&r.platformId?this.currentData.platformExtensions.delete(r.platformId):r.type==="theme-override"&&(this.currentData.themeOverrides=null),this.updateMergedData(),this.persistData())}getLinkedRepositories(){return Array.from(this.linkedRepositories.values())}getCurrentData(){return this.currentData}async refreshAllData(){const e=this.getLinkedRepositories();for(const r of e)if(r.status==="synced"){r.status="loading";try{await this.loadRepositoryData(r),r.status="synced",r.lastSync=new Date().toISOString()}catch(n){r.status="error",r.error=n instanceof Error?n.message:"Unknown error"}}await this.updateMergedData()}validatePlatformExtensions(){if(!this.currentData.core)return[];const e=[];for(const[r,n]of this.currentData.platformExtensions)try{const s=!!(n.systemId&&n.platformId&&n.version),i=[],a=[];n.systemId||i.push("Missing systemId"),n.platformId||i.push("Missing platformId"),n.version||i.push("Missing version"),this.currentData.core&&n.systemId!==this.currentData.core.systemId&&i.push(`System ID mismatch: extension has "${n.systemId}", core has "${this.currentData.core.systemId}"`),e.push({platformId:r,isValid:s,errors:i,warnings:a})}catch(s){e.push({platformId:r,isValid:!1,errors:[s instanceof Error?s.message:"Unknown error"],warnings:[]})}return e}getSyntaxPatternsForPlatform(e){if(!this.currentData.core)return null;if(e==="platform-figma"){const n=this.currentData.core.platforms.find(s=>s.id==="platform-figma");return n==null?void 0:n.syntaxPatterns}const r=this.currentData.platformExtensions.get(e);return r==null?void 0:r.syntaxPatterns}getValueFormattersForPlatform(e){if(!this.currentData.core)return null;if(e==="platform-figma"){const n=this.currentData.core.platforms.find(s=>s.id==="platform-figma");return n==null?void 0:n.valueFormatters}const r=this.currentData.platformExtensions.get(e);return r==null?void 0:r.valueFormatters}async loadRepositoryData(e){console.log("[MultiRepositoryManager] Loading repository data:",e),await Yt.getValidAccessToken();const r=await xt.getFileContent(e.repositoryUri,e.filePath,e.branch);console.log("[MultiRepositoryManager] File content received:",{size:r.content.length,encoding:r.encoding});const n=JSON.parse(r.content);console.log("[MultiRepositoryManager] Parsed content keys:",Object.keys(n));const s=this.detectFileType(n);console.log("[MultiRepositoryManager] Detected file type:",s,"vs requested type:",e.type),s!==e.type&&console.warn(`[MultiRepositoryManager] File type mismatch! Detected: ${s}, Requested: ${e.type}`);try{switch(s){case"core":{console.log("[MultiRepositoryManager] Validating core data...");const i=qu(n);this.currentData.core=i,console.log("[MultiRepositoryManager] Core data validated and stored");break}case"platform-extension":{let i=e.platformId;if(!i&&n.platformId&&(i=n.platformId,console.log("[MultiRepositoryManager] Auto-extracted platform ID from file:",i)),!i)throw new Error("Platform ID is required for platform extension repositories. Please provide it in the UI or ensure the file contains a platformId field.");console.log("[MultiRepositoryManager] Validating platform extension data...");const a=Ju(n);this.currentData.platformExtensions.set(i,a),console.log("[MultiRepositoryManager] Platform extension validated and stored for platform:",i);break}case"theme-override":{console.log("[MultiRepositoryManager] Validating theme override data...");const i=lb(n);this.currentData.themeOverrides=i,console.log("[MultiRepositoryManager] Theme override validated and stored");break}}}catch(i){throw console.error("[MultiRepositoryManager] Validation error:",i),i}}detectFileType(e){if(e.tokenCollections&&e.dimensions&&e.tokens&&e.platforms)return"core";if(e.systemId&&e.platformId&&e.version)return"platform-extension";if(e.systemId&&e.themeId&&e.tokenOverrides)return"theme-override";throw new Error("Unable to detect file type. File does not match any known schema structure.")}async updateMergedData(){var n,s;if(!this.currentData.core){this.currentData.mergedData=null,this.currentData.analytics={totalTokens:0,overriddenTokens:0,newTokens:0,omittedTokens:0,platformCount:0,themeCount:0};return}const e=Array.from(this.currentData.platformExtensions.values()),r=$f(this.currentData.core,e,this.currentData.themeOverrides);this.currentData.mergedData=r,this.currentData.analytics=r.analytics,(s=(n=this.callbacks).onDataChanged)==null||s.call(n,this.currentData)}generateLinkId(e,r,n,s,i){const a=[e,r,n];return s&&a.push(s),i&&a.push(i),a.join("|")}isRepositoryLinked(e,r,n,s,i){const a=this.generateLinkId(e,r,n,s,i);return this.linkedRepositories.has(a)}getRepositoryLink(e){return this.linkedRepositories.get(e)}async updateRepositoryLink(e,r){const n=this.linkedRepositories.get(e);if(n){Object.assign(n,r),n.status="loading";try{await this.loadRepositoryData(n),await this.updateMergedData(),n.status="synced",n.lastSync=new Date().toISOString()}catch(s){n.status="error",n.error=s instanceof Error?s.message:"Unknown error"}}}async updateDataForSource(e,r,n){var s,i;try{let a;switch(e){case"core":{a=this.currentData.core||{};break}case"platform-extension":{a=this.currentData.platformExtensions.get(r)||{};break}case"theme-override":{a=this.currentData.themeOverrides||{};break}}const l={...a,...n},c=this.validateDataAgainstSchema(l,e);if(!c.isValid)return c;switch(e){case"core":{this.currentData.core=l;break}case"platform-extension":{this.currentData.platformExtensions.set(r,l);break}case"theme-override":{this.currentData.themeOverrides=l;break}}return await this.updateMergedData(),this.persistData(),(i=(s=this.callbacks).onDataChanged)==null||i.call(s,this.currentData),{isValid:!0,errors:[],warnings:[]}}catch(a){return{isValid:!1,errors:[a instanceof Error?a.message:"Update failed"],warnings:[]}}}validateDataAgainstSchema(e,r){try{switch(r){case"core":{Ta.validateCoreData(e);break}case"platform-extension":{Ta.validatePlatformExtension(e);break}case"theme-override":{Ta.validateThemeOverrideFile(e);break}}return{isValid:!0,errors:[],warnings:[]}}catch(n){return{isValid:!1,errors:[n instanceof Error?n.message:"Validation failed"],warnings:[]}}}};rt(aa,"instance");let $a=aa;const kC=Object.freeze(Object.defineProperty({__proto__:null,MultiRepositoryManager:$a},Symbol.toStringTag,{value:"Module"})),la=class la{constructor(){rt(this,"multiRepositoryManager",$a.getInstance())}static getInstance(){return la.instance||(la.instance=new la),la.instance}async collectAndStoreSyntaxPatterns(){var r,n;console.log("[PlatformSyntaxPatternService] === STARTING SYNTAX PATTERN COLLECTION ===");const e={};try{console.log("[PlatformSyntaxPatternService] Method 1: Checking core platforms from StorageService...");const s=L.getCoreData();console.log("[PlatformSyntaxPatternService] DEBUG - Core data systemId:",s==null?void 0:s.systemId),console.log("[PlatformSyntaxPatternService] DEBUG - Core data systemName:",s==null?void 0:s.systemName);const i=(s==null?void 0:s.platforms)||[];console.log("[PlatformSyntaxPatternService] Core platforms found:",i.length),console.log("[PlatformSyntaxPatternService] Core platform details:",i.map(m=>({id:m.id,displayName:m.displayName,hasSyntaxPatterns:!!m.syntaxPatterns,syntaxPatterns:m.syntaxPatterns,extensionSource:m.extensionSource})));for(const m of i)m.syntaxPatterns?(e[m.id]=this.normalizeSyntaxPatterns(m.syntaxPatterns),console.log(`[PlatformSyntaxPatternService] âœ… Collected syntax patterns for core platform: ${m.id}`,m.syntaxPatterns)):console.log(`[PlatformSyntaxPatternService] âŒ Core platform ${m.id} has no syntax patterns`);console.log("[PlatformSyntaxPatternService] Method 1.5: Loading platform extension files...");for(const m of i)if(m.extensionSource){console.log(`[PlatformSyntaxPatternService] Platform ${m.id} has extensionSource:`,m.extensionSource);try{const g=await this.loadPlatformExtensionFile(m.extensionSource);console.log(`[PlatformSyntaxPatternService] DEBUG - Extension data for ${m.id}:`,{extensionData:g,hasSyntaxPatterns:!!(g!=null&&g.syntaxPatterns),syntaxPatterns:g==null?void 0:g.syntaxPatterns,extensionDataKeys:g?Object.keys(g):"null/undefined",extensionDataType:typeof g}),g!=null&&g.syntaxPatterns?(e[m.id]=this.normalizeSyntaxPatterns(g.syntaxPatterns),console.log(`[PlatformSyntaxPatternService] âœ… Collected syntax patterns for platform ${m.id} from extension file:`,g.syntaxPatterns)):console.log(`[PlatformSyntaxPatternService] âŒ Platform extension file for ${m.id} has no syntax patterns`)}catch(g){console.error(`[PlatformSyntaxPatternService] âŒ Error loading platform extension for ${m.id}:`,g)}}else console.log(`[PlatformSyntaxPatternService] Platform ${m.id} has no extensionSource`);if(i.length===0){console.log("[PlatformSyntaxPatternService] No platforms found, checking figmaConfiguration...");const m=L.getCoreData();(r=m==null?void 0:m.figmaConfiguration)!=null&&r.syntaxPatterns?(e.figma=this.normalizeSyntaxPatterns(m.figmaConfiguration.syntaxPatterns),console.log("[PlatformSyntaxPatternService] âœ… Collected syntax patterns from figmaConfiguration:",m.figmaConfiguration.syntaxPatterns)):console.log("[PlatformSyntaxPatternService] âŒ No figmaConfiguration.syntaxPatterns found")}console.log("[PlatformSyntaxPatternService] Method 2: Checking platform extension data from StorageService...");const a=L.getAllPlatformExtensionData();console.log("[PlatformSyntaxPatternService] Platform extension data keys:",Object.keys(a)),console.log("[PlatformSyntaxPatternService] Platform extension data details:",Object.entries(a).map(([m,g])=>({id:m,hasSyntaxPatterns:!!g.syntaxPatterns,syntaxPatterns:g.syntaxPatterns})));for(const[m,g]of Object.entries(a))g.syntaxPatterns?(e[m]=this.normalizeSyntaxPatterns(g.syntaxPatterns),console.log(`[PlatformSyntaxPatternService] âœ… Collected syntax patterns for platform extension: ${m}`,g.syntaxPatterns)):console.log(`[PlatformSyntaxPatternService] âŒ Platform extension ${m} has no syntax patterns`);console.log("[PlatformSyntaxPatternService] Method 3: Checking MultiRepositoryManager...");const l=this.multiRepositoryManager.getCurrentData();if(console.log("[PlatformSyntaxPatternService] MultiRepositoryManager data:",{hasPlatformExtensions:!!l.platformExtensions,platformExtensionsSize:((n=l.platformExtensions)==null?void 0:n.size)||0}),l.platformExtensions&&l.platformExtensions.size>0){const m=Array.from(l.platformExtensions.keys());console.log("[PlatformSyntaxPatternService] MultiRepositoryManager platform extension keys:",m);for(const[g,y]of l.platformExtensions)console.log(`[PlatformSyntaxPatternService] Checking MultiRepositoryManager extension ${g}:`,{hasSyntaxPatterns:!!y.syntaxPatterns,syntaxPatterns:y.syntaxPatterns}),y.syntaxPatterns&&!e[g]?(e[g]=this.normalizeSyntaxPatterns(y.syntaxPatterns),console.log(`[PlatformSyntaxPatternService] âœ… Collected syntax patterns from MultiRepositoryManager for platform: ${g}`,y.syntaxPatterns)):y.syntaxPatterns?console.log(`[PlatformSyntaxPatternService] âš ï¸ Skipping MultiRepositoryManager syntax patterns for ${g} (already collected from other source)`):console.log(`[PlatformSyntaxPatternService] âŒ MultiRepositoryManager extension ${g} has no syntax patterns`)}else console.log("[PlatformSyntaxPatternService] âŒ No platform extensions found in MultiRepositoryManager");console.log("[PlatformSyntaxPatternService] Updating DataSourceContext...");const c=xr.getInstance(),d=c.getCurrentContext();console.log("[PlatformSyntaxPatternService] Current DataSourceContext before update:",{platformSyntaxPatterns:d.platformSyntaxPatterns,platformSyntaxPatternsKeys:Object.keys(d.platformSyntaxPatterns||{})}),c.updatePlatformSyntaxPatterns(e);const u=c.getCurrentContext();console.log("[PlatformSyntaxPatternService] DataSourceContext after update:",{platformSyntaxPatterns:u.platformSyntaxPatterns,platformSyntaxPatternsKeys:Object.keys(u.platformSyntaxPatterns||{}),platformSyntaxPatternsCount:Object.keys(u.platformSyntaxPatterns||{}).length}),console.log("[PlatformSyntaxPatternService] === COLLECTION COMPLETE ==="),console.log(`[PlatformSyntaxPatternService] Successfully collected syntax patterns for ${Object.keys(e).length} platforms:`,Object.keys(e)),console.log("[PlatformSyntaxPatternService] Final syntax patterns object:",e)}catch(s){console.error("[PlatformSyntaxPatternService] âŒ Error collecting syntax patterns:",s)}}getSyntaxPatternsForPlatform(e){return xr.getInstance().getCurrentContext().platformSyntaxPatterns[e]||null}getAllSyntaxPatterns(){return{...xr.getInstance().getCurrentContext().platformSyntaxPatterns}}async getSyntaxPatternsForCurrentContext(){console.log("[PlatformSyntaxPatternService] getSyntaxPatternsForCurrentContext called");const e=xr.getInstance(),r=e.getCurrentContext(),n=r.platformSyntaxPatterns;if(console.log("[PlatformSyntaxPatternService] Current context details:",{editModeSourceType:r.editMode.sourceType,editModeSourceId:r.editMode.sourceId,currentPlatform:r.currentPlatform,allPatterns:n,allPatternsKeys:Object.keys(n||{}),allPatternsCount:Object.keys(n||{}).length,allPatternsType:typeof n,allPatternsString:JSON.stringify(n)}),Object.keys(n||{}).length===0){console.log("[PlatformSyntaxPatternService] No patterns found, triggering collection...");try{await this.collectAndStoreSyntaxPatterns();const a=e.getCurrentContext().platformSyntaxPatterns;return console.log("[PlatformSyntaxPatternService] Collection completed, updated patterns:",{updatedPatterns:a,updatedPatternsKeys:Object.keys(a||{}),updatedPatternsCount:Object.keys(a||{}).length}),a||{}}catch(i){return console.error("[PlatformSyntaxPatternService] Error during collection:",i),{}}}if(!r.currentPlatform||r.currentPlatform==="none")return console.log("[PlatformSyntaxPatternService] Core mode detected, returning all patterns:",{allPatterns:n,allPatternsKeys:Object.keys(n||{}),allPatternsCount:Object.keys(n||{}).length}),n;const s={};return n[r.currentPlatform]?(s[r.currentPlatform]=n[r.currentPlatform],console.log("[PlatformSyntaxPatternService] Platform mode detected, returning current platform patterns:",{currentPlatform:r.currentPlatform,currentPlatformPatterns:s,currentPlatformPatternsKeys:Object.keys(s),currentPlatformPatternsCount:Object.keys(s).length})):console.log("[PlatformSyntaxPatternService] Platform mode detected but no patterns found for current platform:",{currentPlatform:r.currentPlatform,availablePatterns:Object.keys(n||{})}),s}normalizeSyntaxPatterns(e){return{prefix:e.prefix||"",suffix:e.suffix||"",delimiter:e.delimiter||"_",capitalization:e.capitalization||"none",formatString:e.formatString||""}}async loadPlatformExtensionFile(e){console.log("[PlatformSyntaxPatternService] Loading platform extension file:",e);try{const r=L.getPlatformExtensionData(e.repositoryUri);if(r)return console.log("[PlatformSyntaxPatternService] Found platform extension data in storage:",{storedData:r,hasSyntaxPatterns:!!r.syntaxPatterns,syntaxPatterns:r.syntaxPatterns,storedDataKeys:Object.keys(r),storedDataType:typeof r}),r;const n=`https://raw.githubusercontent.com/${e.repositoryUri}/main/${e.filePath}`;console.log("[PlatformSyntaxPatternService] Loading from GitHub:",n);const s=await fetch(n);if(!s.ok)throw new Error(`Failed to load platform extension: ${s.status} ${s.statusText}`);const i=await s.json();return console.log("[PlatformSyntaxPatternService] Loaded platform extension data:",i),L.setPlatformExtensionData(e.repositoryUri,i),i}catch(r){throw console.error("[PlatformSyntaxPatternService] Error loading platform extension file:",r),r}}async refreshSyntaxPatterns(){console.log("[PlatformSyntaxPatternService] Refreshing syntax patterns..."),await this.collectAndStoreSyntaxPatterns()}};rt(la,"instance");let gc=la;const Ty="token-model:persistent-state",_d="1.0.0",Bl={currentRepository:null,dataSourceContext:{currentPlatform:null,currentTheme:null,availablePlatforms:[],availableThemes:[]},editMode:{isActive:!1,branch:null,sourceType:"core",sourceId:null,repositoryContext:null},cacheState:{lastRefreshTimestamp:0,repositoryBranches:{},permissions:{}},version:_d},ca=class ca{constructor(){rt(this,"currentState");this.currentState=this.loadState()}static getInstance(){return ca.instance||(ca.instance=new ca),ca.instance}saveState(){try{this.currentState.cacheState.lastRefreshTimestamp=Date.now(),this.currentState.version=_d,localStorage.setItem(Ty,JSON.stringify(this.currentState)),console.log("[StatePersistenceManager] State saved successfully")}catch(e){console.error("[StatePersistenceManager] Failed to save state:",e)}}loadState(){try{const e=localStorage.getItem(Ty);if(!e)return console.log("[StatePersistenceManager] No stored state found, using defaults"),{...Bl};const r=JSON.parse(e);return r.version!==_d?(console.log("[StatePersistenceManager] Migrating state from version",r.version,"to",_d),this.migrateState(r)):(console.log("[StatePersistenceManager] State loaded successfully"),r)}catch(e){return console.error("[StatePersistenceManager] Failed to load state:",e),{...Bl}}}getCurrentState(){return{...this.currentState}}updateRepositoryContext(e){console.log("[StatePersistenceManager] Updating repository context:",e),this.currentState.currentRepository={...e},this.saveState()}getCurrentRepositoryContext(){return this.currentState.currentRepository?{...this.currentState.currentRepository}:null}updateEditMode(e){console.log("[StatePersistenceManager] Updating edit mode state:",e),this.currentState.editMode={...e},this.saveState()}getCurrentEditMode(){return{...this.currentState.editMode}}updateDataSourceContext(e){console.log("[StatePersistenceManager] Updating data source context"),this.currentState.dataSourceContext={...e},this.saveState()}getCurrentDataSourceContext(){return{...this.currentState.dataSourceContext}}updateCacheState(e){console.log("[StatePersistenceManager] Updating cache state"),this.currentState.cacheState={...this.currentState.cacheState,...e},this.saveState()}getCurrentCacheState(){return{...this.currentState.cacheState}}clearEditModeOnly(){console.log("[StatePersistenceManager] Clearing edit mode only"),this.currentState.editMode={...Bl.editMode},this.saveState()}clearAll(){console.log("[StatePersistenceManager] Clearing all state"),this.currentState={...Bl},this.saveState()}restoreRepositoryContext(e){const r=e||this.currentState.currentRepository;r&&(console.log("[StatePersistenceManager] Restoring repository context:",r),this.currentState.currentRepository={...r},this.saveState())}hasValidRepositoryContext(){var e,r,n;return!!((e=this.currentState.currentRepository)!=null&&e.fullName&&((r=this.currentState.currentRepository)!=null&&r.branch)&&((n=this.currentState.currentRepository)!=null&&n.filePath))}getRepositoryBranches(e){return this.currentState.cacheState.repositoryBranches[e]||[]}setRepositoryBranches(e,r){this.currentState.cacheState.repositoryBranches[e]=[...r],this.saveState()}getRepositoryPermission(e){return this.currentState.cacheState.permissions[e]||!1}setRepositoryPermission(e,r){this.currentState.cacheState.permissions[e]=r,this.saveState()}migrateState(e){return console.warn("[StatePersistenceManager] State migration not implemented, using defaults"),{...Bl}}};rt(ca,"instance");let Sn=ca;const da=class da{constructor(){rt(this,"context");rt(this,"eventListeners");console.log("[RepositoryContextService] Initializing new instance"),this.context=this.getInitialContext(),this.eventListeners=new Map}static getInstance(){return da.instance||(da.instance=new da),da.instance}getCurrentContext(){return console.log("[RepositoryContextService] Getting current context:",this.context),{...this.context}}getCurrentSourceContext(){return console.log("[RepositoryContextService] Getting current source context:",this.context.currentSource),{...this.context.currentSource}}getRepositoryInfo(){const e=this.context.currentSource.repositoryInfo;return console.log("[RepositoryContextService] Getting repository info:",e),e?{...e}:null}updateContext(e){console.log("[RepositoryContextService] Updating context with:",e);try{this.context={...this.context,...e},this.context.lastUpdated=new Date().toISOString(),this.emitEvent("contextUpdated",this.context),console.log("[RepositoryContextService] Context updated successfully")}catch(r){throw console.error("[RepositoryContextService] Error updating context:",r),r}}updateSourceContext(e){console.log("[RepositoryContextService] Updating source context with:",e);try{this.context.currentSource={...this.context.currentSource,...e},this.context.lastUpdated=new Date().toISOString(),this.emitEvent("sourceContextUpdated",this.context.currentSource),this.emitEvent("contextUpdated",this.context),console.log("[RepositoryContextService] Source context updated successfully")}catch(r){throw console.error("[RepositoryContextService] Error updating source context:",r),r}}setEditMode(e){console.log("[RepositoryContextService] Setting edit mode:",e);try{this.context.currentSource.editMode={...e},this.context.lastUpdated=new Date().toISOString(),this.emitEvent("editModeUpdated",e),this.emitEvent("contextUpdated",this.context),console.log("[RepositoryContextService] Edit mode updated successfully")}catch(r){throw console.error("[RepositoryContextService] Error setting edit mode:",r),r}}subscribeToChanges(e,r){console.log("[RepositoryContextService] Subscribing to event:",e),this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(r),console.log("[RepositoryContextService] Subscription added successfully")}unsubscribeFromChanges(e,r){console.log("[RepositoryContextService] Unsubscribing from event:",e);const n=this.eventListeners.get(e);if(n){const s=n.indexOf(r);s>-1&&(n.splice(s,1),console.log("[RepositoryContextService] Unsubscription successful"))}}emitEvent(e,r){console.log("[RepositoryContextService] Emitting event:",e,"with data:",r);const n=this.eventListeners.get(e);n&&n.forEach(s=>{try{s(r)}catch(i){console.error("[RepositoryContextService] Error in event callback:",i)}})}initializeFromExistingServices(){console.log("[RepositoryContextService] Initializing from existing services");try{const r=xr.getInstance().getCurrentContext(),s=ri.getInstance().getContext(),a=Sn.getInstance().getCurrentState();this.mergeExistingState(r,s,a),console.log("[RepositoryContextService] Initialization completed successfully")}catch(e){console.error("[RepositoryContextService] Initialization failed:",e),this.context=this.getInitialContext()}}syncWithDataSourceManager(){console.log("[RepositoryContextService] Syncing with DataSourceManager");try{const r=xr.getInstance().getCurrentContext();this.mergeFromDataSourceContext(r),console.log("[RepositoryContextService] Sync with DataSourceManager completed")}catch(e){throw console.error("[RepositoryContextService] Error syncing with DataSourceManager:",e),e}}syncWithSourceContextManager(){console.log("[RepositoryContextService] Syncing with SourceContextManager");try{const r=ri.getInstance().getContext();r&&this.mergeFromSourceContext(r),console.log("[RepositoryContextService] Sync with SourceContextManager completed")}catch(e){throw console.error("[RepositoryContextService] Error syncing with SourceContextManager:",e),e}}getInitialContext(){return console.log("[RepositoryContextService] Creating initial context"),{coreRepository:null,platformRepositories:{},themeRepositories:{},currentSource:{sourceType:"core",sourceId:null,sourceName:null,repositoryInfo:null,schemaType:"schema",editMode:{isActive:!1,sourceType:"core",sourceId:null,targetRepository:null}},lastUpdated:new Date().toISOString()}}mergeExistingState(e,r,n){var s,i,a;console.log("[RepositoryContextService] Merging existing state"),this.context.coreRepository=((s=e==null?void 0:e.repositories)==null?void 0:s.core)||(r==null?void 0:r.repositoryInfo)||(n==null?void 0:n.currentRepository),this.context.platformRepositories=((i=e==null?void 0:e.repositories)==null?void 0:i.platforms)||{},this.context.themeRepositories=((a=e==null?void 0:e.repositories)==null?void 0:a.themes)||{},this.context.currentSource=this.mergeSourceContext(e,r,n),this.context.lastUpdated=new Date().toISOString(),console.log("[RepositoryContextService] State merging completed")}mergeSourceContext(e,r,n){var d,u,m,g,y;console.log("[RepositoryContextService] Merging source context"),console.log("[RepositoryContextService] DataSourceContext for merging:",e);let s="core",i=null;e!=null&&e.currentPlatform&&e.currentPlatform!=="none"?(s="platform-extension",i=e.currentPlatform):e!=null&&e.currentTheme&&e.currentTheme!=="none"&&(s="theme-override",i=e.currentTheme);let a=null;console.log("[RepositoryContextService] Determining repository info for source type:",s,"sourceId:",i),console.log("[RepositoryContextService] DataSourceContext repositories:",e==null?void 0:e.repositories),s==="platform-extension"&&i?(a=((u=(d=e==null?void 0:e.repositories)==null?void 0:d.platforms)==null?void 0:u[i])||null,console.log("[RepositoryContextService] Platform repository info:",a)):s==="theme-override"&&i?(a=((g=(m=e==null?void 0:e.repositories)==null?void 0:m.themes)==null?void 0:g[i])||null,console.log("[RepositoryContextService] Theme repository info:",a)):s==="core"&&(a=((y=e==null?void 0:e.repositories)==null?void 0:y.core)||null,console.log("[RepositoryContextService] Core repository info:",a)),console.log("[RepositoryContextService] Determined repository info:",a);const l=(e==null?void 0:e.editMode)||{isActive:!1,sourceType:s,sourceId:i,targetRepository:a},c={sourceType:s,sourceId:i,sourceName:this.getSourceName(s,i,e),repositoryInfo:a,schemaType:s==="core"?"schema":s,editMode:l};return console.log("[RepositoryContextService] Source context merged:",c),c}getSourceName(e,r,n){var s,i;if(e==="platform-extension"&&r){const a=(s=n==null?void 0:n.availablePlatforms)==null?void 0:s.find(l=>l.id===r);return(a==null?void 0:a.name)||null}else if(e==="theme-override"&&r){const a=(i=n==null?void 0:n.availableThemes)==null?void 0:i.find(l=>l.id===r);return(a==null?void 0:a.name)||null}return null}mergeFromDataSourceContext(e){var c,d,u,m,g;if(console.log("[RepositoryContextService] Merging from DataSourceContext"),console.log("[RepositoryContextService] DataSourceContext repositories:",e==null?void 0:e.repositories),!e){console.warn("[RepositoryContextService] No DataSourceContext provided for merging");return}this.context.coreRepository=((c=e.repositories)==null?void 0:c.core)||this.context.coreRepository,this.context.platformRepositories=((d=e.repositories)==null?void 0:d.platforms)||this.context.platformRepositories,this.context.themeRepositories=((u=e.repositories)==null?void 0:u.themes)||this.context.themeRepositories,console.log("[RepositoryContextService] Updated context repositories:",{core:this.context.coreRepository,platforms:this.context.platformRepositories,themes:this.context.themeRepositories});const{currentPlatform:r,currentTheme:n,repositories:s}=e;let i="core",a=null,l=null;r&&r!=="none"?(i="platform-extension",a=r,l=((m=s==null?void 0:s.platforms)==null?void 0:m[r])||null):n&&n!=="none"?(i="theme-override",a=n,l=((g=s==null?void 0:s.themes)==null?void 0:g[n])||null):(i="core",a=null,l=(s==null?void 0:s.core)||null),this.context.currentSource={...this.context.currentSource,sourceType:i,sourceId:a,sourceName:this.getSourceName(i,a,e),repositoryInfo:l,schemaType:i==="core"?"schema":i,editMode:e.editMode||this.context.currentSource.editMode},this.context.lastUpdated=new Date().toISOString(),console.log("[RepositoryContextService] DataSourceContext merge completed"),console.log("[RepositoryContextService] Final current source:",this.context.currentSource)}mergeFromSourceContext(e){if(console.log("[RepositoryContextService] Merging from SourceContext"),!e){console.warn("[RepositoryContextService] No SourceContext provided for merging");return}e.repositoryInfo&&(this.context.currentSource.repositoryInfo=e.repositoryInfo),e.sourceType&&(this.context.currentSource.sourceType=e.sourceType),e.sourceId&&(this.context.currentSource.sourceId=e.sourceId),this.context.lastUpdated=new Date().toISOString(),console.log("[RepositoryContextService] SourceContext merge completed")}};rt(da,"instance");let ki=da;const ua=class ua{constructor(){rt(this,"callbacks",{});rt(this,"repositoryContextService");rt(this,"currentContext",{currentPlatform:null,currentTheme:null,availablePlatforms:[],availableThemes:[],permissions:{core:!1,platforms:{},themes:{}},repositories:{core:null,platforms:{},themes:{}},editMode:{isActive:!1,sourceType:"core",sourceId:null,targetRepository:null,validationSchema:"schema"},viewMode:{isMerged:!1,mergeSources:["core"],displayData:"core-only"},platformSyntaxPatterns:{}});this.repositoryContextService=ki.getInstance(),this.initializeFromStorage(),setTimeout(()=>{this.repositoryContextService.initializeFromExistingServices()},0)}static getInstance(){return ua.instance||(ua.instance=new ua),ua.instance}setCallbacks(e){this.callbacks={...this.callbacks,...e}}setupEventListeners(){this.repositoryContextService.subscribeToChanges("contextUpdated",e=>{this.syncFromRepositoryContext(e)})}syncFromRepositoryContext(e){var n,s;console.log("[DataSourceManager] Syncing from repository context:",e);const r=this.transformToDataSourceContext(e);this.currentContext={...this.currentContext,...r},this.updatePermissions().catch(i=>{console.error("[DataSourceManager] Failed to update permissions after context sync:",i)}),(s=(n=this.callbacks).onDataSourceChanged)==null||s.call(n,this.getCurrentContext())}transformToDataSourceContext(e){var r,n,s;return{currentPlatform:((r=e.currentSource)==null?void 0:r.sourceType)==="platform-extension"?e.currentSource.sourceId:null,currentTheme:((n=e.currentSource)==null?void 0:n.sourceType)==="theme-override"?e.currentSource.sourceId:null,repositories:{core:e.coreRepository,platforms:e.platformRepositories,themes:e.themeRepositories},editMode:((s=e.currentSource)==null?void 0:s.editMode)||this.currentContext.editMode,viewMode:this.getViewMode(e.currentSource)}}getViewMode(e){if(!e)return this.currentContext.viewMode;const r=e.sourceType,n=r!=="core",s=["core"];return r==="platform-extension"?s.push("platform-extension"):r==="theme-override"&&s.push("theme-override"),{isMerged:n,mergeSources:s,displayData:r==="core"?"core-only":r==="platform-extension"?"platform-only":r==="theme-override"?"theme-only":"merged"}}getPlatformName(e){if(!e)return null;const r=this.currentContext.availablePlatforms.find(n=>n.id===e);return(r==null?void 0:r.name)||null}getPlatformRepository(e){return e&&this.currentContext.repositories.platforms[e]||null}getThemeName(e){if(!e)return null;const r=this.currentContext.availableThemes.find(n=>n.id===e);return(r==null?void 0:r.displayName)||null}getThemeRepository(e){return e&&this.currentContext.repositories.themes[e]||null}getCoreRepository(){return this.currentContext.repositories.core}getCurrentContext(){const e=this.repositoryContextService.getCurrentContext(),r=this.transformToDataSourceContext(e);return{...this.currentContext,...r,availablePlatforms:this.currentContext.availablePlatforms,availableThemes:this.currentContext.availableThemes,permissions:this.currentContext.permissions,platformSyntaxPatterns:this.currentContext.platformSyntaxPatterns}}async switchToPlatform(e){var r,n,s,i,a,l;console.log("[DataSourceManager] Switching to platform:",e);try{const c=ni.getInstance(),d=ti.getInstance();if(d.hasLocalChanges()){const I=d.getChangeCount();if(!await this.showSourceSwitchWarning(I))return}const m=e?"platform":"core",g=await c.switchSource(m,e||void 0);if(!g.success){console.error("[DataSourceManager] Failed to switch platform:",g.error),(n=(r=this.callbacks).onError)==null||n.call(r,g.error||"Failed to switch platform");return}this.currentContext.currentPlatform=e,this.updateEditModeContext(),this.updateViewModeContext(),await this.updateAvailableSources();const y={sourceType:e?"platform-extension":"core",sourceId:e,sourceName:this.getPlatformName(e),repositoryInfo:e?this.getPlatformRepository(e):this.getCoreRepository(),schemaType:e?"platform-extension":"schema"};this.repositoryContextService.updateSourceContext(y),this.updateEditModeContext(),await this.updatePermissions(),ri.getInstance().updateFromDataSource(),this.persistToStorage(),(i=(s=this.callbacks).onDataSourceChanged)==null||i.call(s,this.getCurrentContext()),console.log("[DataSourceManager] Platform switch completed successfully")}catch(c){throw console.error("[DataSourceManager] Platform switch failed:",c),(l=(a=this.callbacks).onError)==null||l.call(a,c instanceof Error?c.message:"Failed to switch platform"),c}}async switchToTheme(e){var r,n,s,i,a,l;try{const c=ni.getInstance(),d=ti.getInstance();if(d.hasLocalChanges()){const I=d.getChangeCount();if(!await this.showSourceSwitchWarning(I))return}const m=e?"theme":"core",g=await c.switchSource(m,e||void 0);if(!g.success){console.error("[DataSourceManager] Failed to switch theme:",g.error),(n=(r=this.callbacks).onError)==null||n.call(r,g.error||"Failed to switch theme");return}this.currentContext.currentTheme=e,this.updateViewModeContext(),this.updateBaselineForCurrentSource(),await this.updateAvailableSources();const y={sourceType:e?"theme-override":"core",sourceId:e,sourceName:this.getThemeName(e),repositoryInfo:e?this.getThemeRepository(e):this.getCoreRepository(),schemaType:e?"theme-override":"schema"};this.repositoryContextService.updateSourceContext(y),this.updateEditModeContext(),await this.updatePermissions(),ri.getInstance().updateFromDataSource(),this.persistToStorage(),(i=(s=this.callbacks).onDataSourceChanged)==null||i.call(s,this.getCurrentContext())}catch(c){(l=(a=this.callbacks).onError)==null||l.call(a,c instanceof Error?c.message:"Failed to switch theme")}}async updateAvailableSources(){var e,r;try{const n=L.getPlatforms();this.currentContext.availablePlatforms=n;const s=L.getThemes();this.currentContext.availableThemes=s,this.currentContext.repositories.platforms={},console.log("[DataSourceManager] Processing platforms:",n),n.filter(l=>{if(!l.extensionSource)return console.log(`[DataSourceManager] Platform ${l.id} has NO extensionSource`),!1;const{repositoryUri:c}=l.extensionSource;return console.log(`[DataSourceManager] Platform ${l.id} has valid extensionSource:`,l.extensionSource),!0}).forEach(l=>{this.currentContext.repositories.platforms[l.id]={fullName:l.extensionSource.repositoryUri,branch:"main",filePath:l.extensionSource.filePath,fileType:"platform-extension"}}),console.log("[DataSourceManager] Final platform repositories:",this.currentContext.repositories.platforms),await this.populateDynamicPlatformRepositories(),this.currentContext.repositories.themes={},console.log("[DataSourceManager] Processing themes:",s),s.filter(l=>l.overrideSource?(console.log(`[DataSourceManager] Theme ${l.id} has valid overrideSource:`,l.overrideSource),!0):(console.log(`[DataSourceManager] Theme ${l.id} has NO overrideSource`),!1)).forEach(l=>{this.currentContext.repositories.themes[l.id]={fullName:l.overrideSource.repositoryUri,branch:"main",filePath:l.overrideSource.filePath,fileType:"theme-override"}}),console.log("[DataSourceManager] Final theme repositories:",this.currentContext.repositories.themes),this.validateCurrentSelections(),console.log("[DataSourceManager] Calling collectAndStoreSyntaxPatterns in updateAvailableSources"),gc.getInstance().collectAndStoreSyntaxPatterns().catch(l=>{console.error("[DataSourceManager] Error collecting syntax patterns:",l)})}catch(n){(r=(e=this.callbacks).onError)==null||r.call(e,n instanceof Error?n.message:"Failed to update available sources")}}updateRepositoryInfo(e,r,n){var s,i;try{switch(e){case"core":this.currentContext.repositories.core=r;break;case"platform-extension":n&&(this.currentContext.repositories.platforms[n]=r);break;case"theme-override":n&&(this.currentContext.repositories.themes[n]=r);break}this.persistToStorage()}catch(a){(i=(s=this.callbacks).onError)==null||i.call(s,a instanceof Error?a.message:"Failed to update repository info")}}getCurrentEditPermissions(){console.log("[DataSourceManager] getCurrentEditPermissions - Starting permission check");const{currentPlatform:e,currentTheme:r,permissions:n}=this.currentContext;if(console.log("[DataSourceManager] getCurrentEditPermissions - Current context:",{currentPlatform:e,currentTheme:r,permissions:n}),e&&e!=="none"){const i=n.platforms[e]||!1;return console.log("[DataSourceManager] getCurrentEditPermissions - Platform permission:",i),i}if(r&&r!=="none"){const i=n.themes[r]||!1;return console.log("[DataSourceManager] getCurrentEditPermissions - Theme permission:",i),i}const s=n.core||!1;return console.log("[DataSourceManager] getCurrentEditPermissions - Core permission:",s),s}getCurrentDataSourceType(){const{currentPlatform:e,currentTheme:r}=this.currentContext;return e&&e!=="none"?"platform-extension":r&&r!=="none"?"theme-override":"core"}getCurrentSourceId(){const{currentPlatform:e,currentTheme:r}=this.currentContext;return e&&e!=="none"?e:r&&r!=="none"?r:null}async updatePermissions(){var e,r,n,s;try{const{repositories:i}=this.currentContext;console.log("[DataSourceManager] Updating permissions for repositories:",{core:i.core,platforms:i.platforms,themes:i.themes});const a={core:!1,platforms:{},themes:{}};i.core&&(console.log("[DataSourceManager] Checking core repository permissions:",i.core.fullName),a.core=await xt.hasWriteAccessToRepository(i.core.fullName));for(const[l,c]of Object.entries(i.platforms))c&&(console.log("[DataSourceManager] Checking platform repository permissions:",l,c.fullName),a.platforms[l]=await xt.hasWriteAccessToRepository(c.fullName));for(const[l,c]of Object.entries(i.themes))c&&(console.log("[DataSourceManager] Checking theme repository permissions:",l,c.fullName),a.themes[l]=await xt.hasWriteAccessToRepository(c.fullName));console.log("[DataSourceManager] Final permissions:",a),this.currentContext.permissions=a,this.updateRepositoryContextService(),this.persistToStorage(),(r=(e=this.callbacks).onPermissionsChanged)==null||r.call(e,a)}catch(i){(s=(n=this.callbacks).onError)==null||s.call(n,i instanceof Error?i.message:"Failed to update permissions")}}updateRepositoryContextService(){try{console.log("[DataSourceManager] Updating RepositoryContextService with current context");const e=this.getCurrentContext();this.repositoryContextService.mergeFromDataSourceContext(e),console.log("[DataSourceManager] RepositoryContextService updated successfully")}catch(e){console.error("[DataSourceManager] Failed to update RepositoryContextService:",e)}}async forceRefreshPermissions(){var e,r;try{Ea.getInstance().clearCache(),await this.updatePermissions()}catch(n){(r=(e=this.callbacks).onError)==null||r.call(e,n instanceof Error?n.message:"Failed to force refresh permissions")}}initializeFromURL(){var e,r;try{const n=new URLSearchParams(window.location.search),s=n.get("platform"),i=n.get("theme"),a=n.get("repo"),l=n.get("path"),c=n.get("branch")||"main";s&&(this.currentContext.currentPlatform=s==="none"?null:s),i&&(this.currentContext.currentTheme=i==="none"?null:i),a&&l&&(this.currentContext.repositories.core={fullName:a,branch:c,filePath:l,fileType:"schema"},console.log("[DataSourceManager] Set core repository from URL:",this.currentContext.repositories.core)),this.validateCurrentSelections(),this.updateRepositoryContextService()}catch(n){(r=(e=this.callbacks).onError)==null||r.call(e,n instanceof Error?n.message:"Failed to initialize from URL")}}updateURLParameters(){var e,r;try{const n=new URL(window.location.href),{currentPlatform:s,currentTheme:i}=this.currentContext;s?n.searchParams.set("platform",s):n.searchParams.delete("platform"),i?n.searchParams.set("theme",i):n.searchParams.delete("theme"),window.history.replaceState({},"",n.toString())}catch(n){(r=(e=this.callbacks).onError)==null||r.call(e,n instanceof Error?n.message:"Failed to update URL parameters")}}validateCurrentSelections(){const{currentPlatform:e,currentTheme:r,availablePlatforms:n,availableThemes:s}=this.currentContext;e&&e!=="none"&&(n.some(a=>a.id===e)||(this.currentContext.currentPlatform=null)),r&&r!=="none"&&(s.some(a=>a.id===r)||(this.currentContext.currentTheme=null))}initializeFromStorage(){try{const e=localStorage.getItem("token-model:data-source-context");if(e){const r=JSON.parse(e);this.currentContext={...this.currentContext,...r}}}catch(e){console.warn("Failed to load data source context from storage:",e)}}persistToStorage(){try{localStorage.setItem("token-model:data-source-context",JSON.stringify(this.currentContext))}catch(e){console.warn("Failed to save data source context to storage:",e)}}clear(){var e,r;this.currentContext={currentPlatform:null,currentTheme:null,availablePlatforms:[],availableThemes:[],permissions:{core:!1,platforms:{},themes:{}},repositories:{core:null,platforms:{},themes:{}},editMode:{isActive:!1,sourceType:"core",sourceId:null,targetRepository:null,validationSchema:"schema"},viewMode:{isMerged:!1,mergeSources:["core"],displayData:"core-only"},platformSyntaxPatterns:{}},localStorage.removeItem("token-model:data-source-context"),(r=(e=this.callbacks).onDataSourceChanged)==null||r.call(e,this.getCurrentContext())}updateEditModeContext(){const{currentPlatform:e,currentTheme:r,repositories:n}=this.currentContext;e&&e!=="none"?this.currentContext.editMode={isActive:!1,sourceType:"platform-extension",sourceId:e,targetRepository:n.platforms[e]||null,validationSchema:"platform-extension"}:r&&r!=="none"?this.currentContext.editMode={isActive:!1,sourceType:"theme-override",sourceId:r,targetRepository:n.themes[r]||null,validationSchema:"theme-override"}:this.currentContext.editMode={isActive:!1,sourceType:"core",sourceId:null,targetRepository:n.core,validationSchema:"schema"}}updateViewModeContext(){const{currentPlatform:e,currentTheme:r}=this.currentContext,n=["core"];let s="core-only",i=!1;e&&e!=="none"&&(n.push("platform-extension"),i=!0,s=r&&r!=="none"?"merged":"platform-only"),r&&r!=="none"&&(n.push("theme-override"),i=!0,s=e&&e!=="none"?"merged":"theme-only"),this.currentContext.viewMode={isMerged:i,mergeSources:n,displayData:s}}enterEditMode(){var r,n;this.currentContext.editMode.isActive=!0,this.currentContext.editMode.sourceType==="platform-extension"&&this.currentContext.editMode.sourceId?(this.currentContext.currentPlatform=this.currentContext.editMode.sourceId,console.log(`[DataSourceManager] Entering edit mode for platform: ${this.currentContext.editMode.sourceId}`)):this.currentContext.editMode.sourceType==="theme-override"&&this.currentContext.editMode.sourceId?(this.currentContext.currentTheme=this.currentContext.editMode.sourceId,console.log(`[DataSourceManager] Entering edit mode for theme: ${this.currentContext.editMode.sourceId}`)):this.currentContext.editMode.sourceType==="core"&&(this.currentContext.currentPlatform=null,this.currentContext.currentTheme=null,console.log("[DataSourceManager] Entering edit mode for core data")),go.initializeSession(this.currentContext),ri.getInstance().updateFromDataSource(),this.persistToStorage(),(n=(r=this.callbacks).onDataSourceChanged)==null||n.call(r,this.getCurrentContext())}exitEditMode(){var e,r;this.currentContext.editMode.isActive=!1,go.clearSession(),this.persistToStorage(),(r=(e=this.callbacks).onDataSourceChanged)==null||r.call(e,this.getCurrentContext())}getCurrentEditMode(){return{...this.currentContext.editMode}}getCurrentViewMode(){return{...this.currentContext.viewMode}}updatePlatformSyntaxPatterns(e){console.log("[DataSourceManager] Updating platform syntax patterns:",{patterns:e,patternsKeys:Object.keys(e||{}),patternsCount:Object.keys(e||{}).length}),this.currentContext.platformSyntaxPatterns=e,this.callbacks.onDataSourceChanged&&this.callbacks.onDataSourceChanged(this.currentContext),console.log("[DataSourceManager] Platform syntax patterns updated successfully")}updateBaselineForCurrentSource(){const e=Gn.getCurrentDataSnapshot();e&&Gn.setBaselineData(e)}async showSourceSwitchWarning(e){return new Promise(r=>{const n=new CustomEvent("token-model:source-switch-warning",{detail:{changeCount:e,onConfirm:()=>r(!0),onCancel:()=>r(!1)}});window.dispatchEvent(n)})}async resetToMainBranchForSource(e,r){var n,s;try{if(!r)return;const i=e==="platform-extension"?this.currentContext.repositories.platforms[r]:this.currentContext.repositories.themes[r];i&&i.branch!=="main"&&(this.updateRepositoryInfo(e,{...i,branch:"main"},r),Gn.clearOverrideChanges(),(s=(n=this.callbacks).onDataSourceChanged)==null||s.call(n,this.getCurrentContext()))}catch(i){console.error("Failed to reset to main branch:",i)}}async populateDynamicPlatformRepositories(){var e,r;try{const n=L.getPlatformExtensionData();if(console.log("[DataSourceManager] Populating dynamic platform repositories from:",n),!n){console.log("[DataSourceManager] No dynamic platform data found");return}for(const[s,i]of Object.entries(n)){if(this.currentContext.repositories.platforms[s]){console.log(`[DataSourceManager] Platform ${s} already in repositories, skipping`);continue}const a=L.getCoreData(),l=(e=a==null?void 0:a.platforms)==null?void 0:e.find(c=>c.id===s);if(l!=null&&l.extensionSource)console.log(`[DataSourceManager] Adding dynamic platform ${s} with repository from core data: ${l.extensionSource.repositoryUri}`),this.currentContext.repositories.platforms[s]={fullName:l.extensionSource.repositoryUri,branch:"main",filePath:l.extensionSource.filePath,fileType:"platform-extension"};else{console.log(`[DataSourceManager] Platform ${s} not found in core data, trying to get from source context`);const c=L.getSourceContext();if((c==null?void 0:c.sourceType)==="platform"&&c.sourceId===s)console.log(`[DataSourceManager] Adding dynamic platform ${s} with repository from source context: ${c.sourceRepository.fullName}`),this.currentContext.repositories.platforms[s]={fullName:c.sourceRepository.fullName,branch:c.sourceRepository.branch,filePath:c.sourceRepository.filePath,fileType:"platform-extension"};else{const d=L.getCoreData(),u=(r=d==null?void 0:d.platforms)==null?void 0:r.find(m=>m.id===s);u!=null&&u.extensionSource?(console.log(`[DataSourceManager] Adding dynamic platform ${s} with repository from core data: ${u.extensionSource.repositoryUri}`),this.currentContext.repositories.platforms[s]={fullName:u.extensionSource.repositoryUri,branch:"main",filePath:u.extensionSource.filePath,fileType:"platform-extension"}):console.log(`[DataSourceManager] Platform ${s} has no repository information available`)}}}console.log("[DataSourceManager] Final repositories after dynamic population:",this.currentContext.repositories.platforms)}catch(n){console.error("[DataSourceManager] Error populating dynamic platform repositories:",n)}}};rt(ua,"instance");let xr=ua;const IC=Object.freeze(Object.defineProperty({__proto__:null,DataSourceManager:xr},Symbol.toStringTag,{value:"Module"})),ha=class ha{constructor(){}static getInstance(){return ha.instance||(ha.instance=new ha),ha.instance}async loadFromURL(e){try{console.log("[DataLoaderService] Starting data loading from URL parameters");const r=await this.loadCoreData(e);if(!r.success)return r;const n=this.determineSourceType(e),s=await this.loadSourceData(n,e);return s.success?(await this.createMergedData(),await this.createLocalEdits(),await this.updateSourceContext(n,e),console.log("[DataLoaderService] Data loading completed successfully"),{success:!0,data:L.getMergedData()||void 0}):s}catch(r){return console.error("[DataLoaderService] Error during data loading:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error during data loading"}}}async loadCoreData(e){const r=e.get("repo"),n=e.get("path"),s="main";if(!r||!n)return{success:!1,error:"Repository and path are required for loading core data"};try{console.log(`[DataLoaderService] Loading core data from ${r}/${n} on branch ${s} (branch parameter ignored for core data)`);const i=Yt.isAuthenticated();console.log(`[DataLoaderService] User is authenticated: ${i}`);let a;if(i)console.log("[DataLoaderService] User is authenticated, trying authenticated access"),a=(await xt.getFileContent(r,n,s)).content;else{console.log("[DataLoaderService] User not authenticated, trying public access");const d=await fetch(`https://raw.githubusercontent.com/${r}/${s}/${n}`);if(!d.ok)throw new Error(`Failed to fetch data: ${d.status} ${d.statusText}`);a=await d.text()}const l=JSON.parse(a),c=this.validateData(l,"schema");return c.isValid?(!l.dimensionOrder||!Array.isArray(l.dimensionOrder)?(console.warn("[DataLoaderService] Core data missing dimensionOrder, reconstructing from dimensions"),l.dimensions&&Array.isArray(l.dimensions)?(l.dimensionOrder=l.dimensions.map(d=>d.id),console.log("[DataLoaderService] Reconstructed dimensionOrder:",l.dimensionOrder)):(console.error("[DataLoaderService] Cannot reconstruct dimensionOrder - no dimensions available"),l.dimensionOrder=[])):console.log("[DataLoaderService] Core data has valid dimensionOrder:",l.dimensionOrder),L.setCoreData(l),console.log("[DataLoaderService] Core data loaded and validated successfully"),{success:!0,data:l}):{success:!1,error:`Invalid core data structure: ${c.errors.join(", ")}`,validationResult:c}}catch(i){return console.error("[DataLoaderService] Error loading core data:",i),{success:!1,error:i instanceof Error?i.message:"Failed to load core data"}}}async loadSourceData(e,r){const n=L.getCoreData();if(!n)return{success:!1,error:"Core data must be loaded before loading source data"};try{if(e==="core")return L.setSourceSnapshot(n),{success:!0,data:n};if(e==="platform"){const s=r.get("platform");return s?await this.loadPlatformData(s,n,r):{success:!1,error:"Platform ID is required for platform source type"}}if(e==="theme"){const s=r.get("theme");return s?await this.loadThemeData(s,n,r):{success:!1,error:"Theme ID is required for theme source type"}}return{success:!1,error:`Unknown source type: ${e}`}}catch(s){return console.error("[DataLoaderService] Error loading source data:",s),{success:!1,error:s instanceof Error?s.message:"Failed to load source data"}}}async loadPlatformData(e,r,n){var i;const s=(i=r.platforms)==null?void 0:i.find(a=>a.id===e);if(!s)return{success:!1,error:`Platform with ID '${e}' not found in core data`};if(!s.extensionSource)return{success:!1,error:`Platform '${e}' does not have an extension source configured`};try{const{repositoryUri:a,filePath:l}=s.extensionSource,c=n.get("branch")||"main",[d,u]=a.split("/"),m=`${d}/${u}`;console.log(`[DataLoaderService] Loading platform data from ${m}/${l} on branch ${c}`);let g;try{if(Yt.isAuthenticated())g=await xt.getFileContent(m,l,c);else throw new Error("User not authenticated, trying public access")}catch{console.log("[DataLoaderService] Platform authenticated access failed, trying public access"),g=await xt.getPublicFileContent(m,l,c)}const y=JSON.parse(g.content),v=this.validateData(y,"platform-extension");if(!v.isValid)return{success:!1,error:`Invalid platform extension data: ${v.errors.join(", ")}`,validationResult:v};const I=y;return L.setSourceSnapshot(I),L.setPlatformExtensionData(e,I),console.log("[DataLoaderService] Platform data loaded successfully"),{success:!0,data:I}}catch(a){return console.error("[DataLoaderService] Error loading platform data:",a),{success:!1,error:a instanceof Error?a.message:"Failed to load platform data"}}}async loadThemeData(e,r,n){var i;const s=(i=r.themes)==null?void 0:i.find(a=>a.id===e);if(!s)return{success:!1,error:`Theme with ID '${e}' not found in core data`};if(!s.overrideSource)return{success:!1,error:`Theme '${e}' does not have an override source configured`};try{const{repositoryUri:a,filePath:l}=s.overrideSource,c=n.get("branch")||"main",[d,u]=a.split("/"),m=`${d}/${u}`;console.log(`[DataLoaderService] Loading theme data from ${m}/${l} on branch ${c}`);let g;try{if(Yt.isAuthenticated())g=await xt.getFileContent(m,l,c);else throw new Error("User not authenticated, trying public access")}catch{console.log("[DataLoaderService] Theme authenticated access failed, trying public access"),g=await xt.getPublicFileContent(m,l,c)}const y=JSON.parse(g.content),v=this.validateData(y,"theme-override");if(!v.isValid)return{success:!1,error:`Invalid theme override data: ${v.errors.join(", ")}`,validationResult:v};const I=y;return L.setSourceSnapshot(I),L.setThemeOverrideData(e,I),console.log("[DataLoaderService] Theme data loaded successfully"),{success:!0,data:I}}catch(a){return console.error("[DataLoaderService] Error loading theme data:",a),{success:!1,error:a instanceof Error?a.message:"Failed to load theme data"}}}async createMergedData(){const e=L.getCoreData(),r=L.getSourceSnapshot();if(!e){console.warn("[DataLoaderService] No core data available for merging");return}if(!r){console.warn("[DataLoaderService] No source snapshot available for merging");return}L.setMergedData(e),console.log("[DataLoaderService] Merged data created")}async createLocalEdits(){const e=L.getSourceSnapshot();if(!e){console.warn("[DataLoaderService] No source snapshot available for local edits");return}L.setLocalEdits(e),console.log("[DataLoaderService] Local edits initialized from source snapshot")}async updateSourceContext(e,r){var m,g;const n=r.get("repo"),s=r.get("path"),i=r.get("branch")||"main",a=r.get("platform"),l=r.get("theme");if(!n||!s){console.warn("[DataLoaderService] Cannot update source context without repo and path");return}const c=L.getCoreData();let d;if(e==="platform"&&a){const y=(m=c==null?void 0:c.platforms)==null?void 0:m.find(v=>v.id===a);y!=null&&y.extensionSource?(d={fullName:y.extensionSource.repositoryUri,branch:"main",filePath:y.extensionSource.filePath,fileType:"platform-extension"},console.log(`[DataLoaderService] Platform extension repository: ${y.extensionSource.repositoryUri}/${y.extensionSource.filePath}`)):(console.warn(`[DataLoaderService] Platform ${a} not found in core data or missing extensionSource`),d={fullName:n,branch:i,filePath:s,fileType:"platform-extension"})}else if(e==="theme"&&l){const y=(g=c==null?void 0:c.themes)==null?void 0:g.find(v=>v.id===l);y!=null&&y.overrideSource?(d={fullName:y.overrideSource.repositoryUri,branch:"main",filePath:y.overrideSource.filePath,fileType:"theme-override"},console.log(`[DataLoaderService] Theme override repository: ${y.overrideSource.repositoryUri}/${y.overrideSource.filePath}`)):(console.warn(`[DataLoaderService] Theme ${l} not found in core data or missing overrideSource`),d={fullName:n,branch:i,filePath:s,fileType:"theme-override"})}else d={fullName:n,branch:i,filePath:s,fileType:"schema"};const u={sourceType:e,sourceId:a||l||null,coreRepository:{fullName:n,branch:i,filePath:s,fileType:"schema"},sourceRepository:d,lastLoadedAt:new Date().toISOString(),hasLocalChanges:!1,editMode:{isActive:!1,sourceType:e==="platform"?"platform-extension":e==="theme"?"theme-override":"core",sourceId:a||l||null,targetRepository:null}};L.setSourceContext(u),console.log("[DataLoaderService] Source context updated with proper repository mapping")}determineSourceType(e){return e.get("theme")?"theme":e.get("platform")?"platform":"core"}validateData(e,r){const n=[],s=[],i=L.validateDataStructure(e);if(i.isValid||n.push(...i.errors),r==="schema"){const a=e;a.systemId||n.push("systemId is required for schema data"),a.tokens||n.push("tokens array is required for schema data")}if(r==="platform-extension"){const a=e;a.platformId||n.push("platformId is required for platform extension data"),a.systemId||n.push("systemId is required for platform extension data")}if(r==="theme-override"){const a=e;a.themeId||n.push("themeId is required for theme override data"),a.systemId||n.push("systemId is required for theme override data")}return{isValid:n.length===0,errors:n,warnings:s}}};rt(ha,"instance");let Tp=ha;const ma=class ma{constructor(){}static getInstance(){return ma.instance||(ma.instance=new ma),ma.instance}async computeMergedData(){var n,s;console.log("[DataMergerService] computeMergedData called");const e=L.getCoreData(),r=L.getSourceContext();if(console.log("[DataMergerService] Source context:",{hasSourceContext:!!r,sourceType:r==null?void 0:r.sourceType,sourceId:r==null?void 0:r.sourceId,sourceContextKeys:r?Object.keys(r):[]}),!e)return console.warn("[DataMergerService] No core data available for merging"),null;if(console.log("[DataMergerService] Core data dimensionOrder:",e.dimensionOrder),console.log("[DataMergerService] Core data dimensions:",(n=e.dimensions)==null?void 0:n.map(i=>({id:i.id,displayName:i.displayName}))),!r)return console.warn("[DataMergerService] No source context available for merging"),e;try{const i=new URLSearchParams(window.location.search),a=i.get("platform"),l=i.get("theme");console.log("[DataMergerService] Current URL selections:",{currentPlatform:a,currentTheme:l});let c=e;return a&&a!=="none"&&(console.log("[DataMergerService] Applying platform extension:",a),c=await this.mergePlatformData(c,a),console.log("[DataMergerService] After platform merge - dimensionOrder:",c.dimensionOrder)),l&&l!=="none"&&(console.log("[DataMergerService] Applying theme override:",l),c=await this.mergeThemeData(c,l),console.log("[DataMergerService] After theme merge - dimensionOrder:",c.dimensionOrder)),console.log("[DataMergerService] Final merge order applied: Core",a&&a!=="none"?"+ Platform("+a+")":"",l&&l!=="none"?"+ Theme("+l+")":""),!c.dimensionOrder||c.dimensionOrder.length===0?(console.error("[DataMergerService] CRITICAL ERROR: Final merged data missing dimensionOrder!"),console.error("[DataMergerService] This will break daisy-chaining in Figma export!"),c.dimensionOrder=((s=c.dimensions)==null?void 0:s.map(u=>u.id))||[],console.log("[DataMergerService] Reconstructed dimensionOrder:",c.dimensionOrder)):console.log("[DataMergerService] Final merged data dimensionOrder is valid:",c.dimensionOrder),L.setMergedData(c),ti.getInstance().updateMergedData(c),console.log("[DataMergerService] Merged data computed successfully"),c}catch(i){return console.error("[DataMergerService] Error computing merged data:",i),e}}async mergePlatformData(e,r){var i,a,l,c,d,u,m,g,y,v,I,S,b,k,A,C;if(console.log(`[DataMergerService] mergePlatformData called with platformId: ${r}`),console.log(`[DataMergerService] Core data tokens count: ${((i=e.tokens)==null?void 0:i.length)||0}`),!r)return console.warn("[DataMergerService] No platform ID provided for merging"),e;const n=L.getPlatformExtensionData(r);if(console.log("[DataMergerService] Retrieved platform data:",{hasData:!!n,dataType:typeof n,dataKeys:n?Object.keys(n):[]}),!n)return console.warn(`[DataMergerService] No platform data found for ID: ${r}`),e;console.log(`[DataMergerService] Merging platform data for: ${r}`),console.log("[DataMergerService] Platform data structure:",{hasTokenOverrides:!!n.tokenOverrides,tokenOverridesCount:((a=n.tokenOverrides)==null?void 0:a.length)||0,hasAlgorithmVariableOverrides:!!n.algorithmVariableOverrides,algorithmVariableOverridesCount:((l=n.algorithmVariableOverrides)==null?void 0:l.length)||0,hasOmittedModes:!!n.omittedModes,omittedModesCount:((c=n.omittedModes)==null?void 0:c.length)||0,hasOmittedDimensions:!!n.omittedDimensions,omittedDimensionsCount:((d=n.omittedDimensions)==null?void 0:d.length)||0,platformDataKeys:Object.keys(n)});const s=JSON.parse(JSON.stringify(e));if((!s.dimensionOrder||s.dimensionOrder.length===0)&&(console.warn("[DataMergerService] Core data missing dimensionOrder, attempting to reconstruct"),s.dimensionOrder=((u=e.dimensions)==null?void 0:u.map(T=>T.id))||[]),e.figmaConfiguration&&(s.figmaConfiguration={...e.figmaConfiguration,fileColorProfile:n.fileColorProfile||e.figmaConfiguration.fileColorProfile||"srgb"},console.log(`[DataMergerService] Preserved figmaConfiguration with fileColorProfile: ${s.figmaConfiguration.fileColorProfile}`)),n.tokenOverrides){console.log(`[DataMergerService] Processing ${n.tokenOverrides.length} token overrides`);let T=0,P=0;for(const _ of n.tokenOverrides){console.log(`[DataMergerService] ðŸ” Processing token override: ${_.id} (${_.displayName})`);const R=(m=s.tokens)==null?void 0:m.find(ne=>ne.id===_.id);R&&console.log("[DataMergerService] ðŸ“‹ Existing token valuesByMode:",{tokenId:R.id,tokenName:R.displayName,valuesByModeCount:((g=R.valuesByMode)==null?void 0:g.length)||0,valuesByMode:(y=R.valuesByMode)==null?void 0:y.map(ne=>({modeIds:ne.modeIds,hasValue:!!ne.value,valueType:ne.value?typeof ne.value=="object"&&"tokenId"in ne.value?"alias":"direct":"none"}))}),console.log("[DataMergerService] ðŸ“‹ Override valuesByMode:",{tokenId:_.id,tokenName:_.displayName,valuesByModeCount:((v=_.valuesByMode)==null?void 0:v.length)||0,valuesByMode:(I=_.valuesByMode)==null?void 0:I.map(ne=>({modeIds:ne.modeIds,hasValue:!!ne.value,valueType:ne.value?typeof ne.value=="object"&&"tokenId"in ne.value?"alias":"direct":"none"}))});const G=(S=s.tokens)==null?void 0:S.findIndex(ne=>ne.id===_.id);if(G!==void 0&&G>=0){console.log(`[DataMergerService] âœ… Overriding existing token: ${_.id}`);const ne=s.tokens[G];if(console.log("[DataMergerService] ðŸ”„ Before override - valuesByMode count:",((b=ne.valuesByMode)==null?void 0:b.length)||0),_.valuesByMode&&ne.valuesByMode){const te=[...ne.valuesByMode],K=_.valuesByMode;console.log("[DataMergerService] ðŸ”§ Performing mode-specific merge:",{existingCount:te.length,overrideCount:K.length});for(const O of K){const Z=te.findIndex(ie=>JSON.stringify(ie.modeIds.sort())===JSON.stringify(O.modeIds.sort()));Z!==-1?(console.log("[DataMergerService] ðŸ”„ Replacing mode combination:",O.modeIds),te[Z]=O):(console.log("[DataMergerService] âž• Adding new mode combination:",O.modeIds),te.push(O))}s.tokens[G]={...ne,..._,valuesByMode:te}}else s.tokens[G]={...s.tokens[G],..._};const he=s.tokens[G];console.log("[DataMergerService] ðŸ”„ After override - valuesByMode count:",((k=he.valuesByMode)==null?void 0:k.length)||0),console.log("[DataMergerService] ðŸ”„ After override - valuesByMode:",(A=he.valuesByMode)==null?void 0:A.map(te=>({modeIds:te.modeIds,hasValue:!!te.value,valueType:te.value?typeof te.value=="object"&&"tokenId"in te.value?"alias":"direct":"none"}))),T++}else console.log(`[DataMergerService] âž• Adding new token: ${_.id}`),s.tokens?s.tokens.push(_):s.tokens=[_],P++}console.log(`[DataMergerService] Token override summary: ${T} overridden, ${P} new`)}else console.log("[DataMergerService] No token overrides found in platform data");if(n.algorithmVariableOverrides)for(const T of n.algorithmVariableOverrides){const P=(C=s.algorithms)==null?void 0:C.find(_=>_.id===T.algorithmId);if(P&&P.variables){const _=P.variables.find(R=>R.id===T.variableId);_&&(_.valuesByMode=T.valuesByMode)}}return n.omittedModes&&s.tokens&&(s.tokens=s.tokens.map(T=>{var P;return{...T,valuesByMode:((P=T.valuesByMode)==null?void 0:P.filter(_=>!_.modeIds.some(R=>n.omittedModes.includes(R))))||[]}})),n.omittedDimensions&&(s.dimensions&&(s.dimensions=s.dimensions.filter(T=>!n.omittedDimensions.includes(T.id))),s.dimensionOrder&&(s.dimensionOrder=s.dimensionOrder.filter(T=>!n.omittedDimensions.includes(T)),console.log("[DataMergerService] Updated dimensionOrder after removing omitted dimensions:",s.dimensionOrder))),console.log("[DataMergerService] Platform data merged successfully"),s}async mergeThemeData(e,r){var i,a;if(!r)return console.warn("[DataMergerService] No theme ID provided for merging"),e;const n=L.getThemeOverrideData(r);if(!n)return console.warn(`[DataMergerService] No theme data found for ID: ${r}`),e;console.log(`[DataMergerService] Merging theme data for: ${r}`);const s=JSON.parse(JSON.stringify(e));if((!s.dimensionOrder||s.dimensionOrder.length===0)&&(console.warn("[DataMergerService] Core data missing dimensionOrder, attempting to reconstruct"),s.dimensionOrder=((i=e.dimensions)==null?void 0:i.map(l=>l.id))||[]),e.figmaConfiguration&&(s.figmaConfiguration={...e.figmaConfiguration,fileColorProfile:e.figmaConfiguration.fileColorProfile||"srgb"},console.log(`[DataMergerService] Preserved figmaConfiguration with inherited fileColorProfile: ${s.figmaConfiguration.fileColorProfile}`)),n.tokenOverrides)for(const l of n.tokenOverrides){const c=(a=s.tokens)==null?void 0:a.findIndex(d=>d.id===l.tokenId);if(c!==void 0&&c>=0){const d=s.tokens[c];l.valuesByMode&&(d.valuesByMode=l.valuesByMode)}}return console.log("[DataMergerService] Theme data merged successfully"),s}getMergedDataCacheKey(e,r){const n=L.getCoreData(),s=n?JSON.stringify(n).length.toString():"0";return`${e}-${r||"core"}-${s}`}clearCache(){console.log("[DataMergerService] Cache cleared")}getCurrentMergedData(){return L.getMergedData()}async recomputeMergedData(){return console.log("[DataMergerService] Forcing recomputation of merged data"),await this.computeMergedData()}needsRecomputation(){const e=L.getSourceContext(),r=L.getMergedData();if(!e||!r)return!0;const n=new Date(e.lastLoadedAt);return new Date().getTime()-n.getTime()>5*60*1e3}};rt(ma,"instance");let Ma=ma;const jC=Object.freeze(Object.defineProperty({__proto__:null,DataMergerService:Ma},Symbol.toStringTag,{value:"Module"})),pa=class pa{constructor(){}static getInstance(){return pa.instance||(pa.instance=new pa),pa.instance}static async refreshWithContext(e={},r){console.log("[RefreshManager] Starting refresh with options:",e,"repositoryContext:",r);try{const n=Sn.getInstance(),s=n.getCurrentState(),a=xr.getInstance().getCurrentContext();console.log("[RefreshManager] Current repository context:",s.currentRepository);let l=r||s.currentRepository;if(l||(l=this.getTargetRepositoryFromContext(a)),!l)throw console.warn("[RefreshManager] No target repository found for refresh"),new Error("No repository information available for refresh.");console.log("[RefreshManager] Target repository for refresh:",l),e.preserveBranchCache?(console.log("[RefreshManager] Preserving branch cache for repository:",l.fullName),qr.preserveBranchesForRepository(l.fullName)):(console.log("[RefreshManager] Clearing branch cache for repository:",l.fullName),qr.clearBranchesForRepository(l.fullName)),e.preservePermissions?console.log("[RefreshManager] Preserving permission cache"):(console.log("[RefreshManager] Clearing permission cache"),Ea.getInstance().clearCache()),await this.refreshDataFromRepository(l),e.preserveRepositoryContext&&(console.log("[RefreshManager] Restoring repository context"),n.restoreRepositoryContext(l)),e.clearEditMode&&(console.log("[RefreshManager] Clearing edit mode state"),this.clearEditModeState()),console.log("[RefreshManager] Refresh completed successfully")}catch(n){throw console.error("[RefreshManager] Error during refresh:",n),n}}static getTargetRepositoryFromContext(e){let r=e.repositories.core;return e.currentPlatform&&e.currentPlatform!=="none"?r=e.repositories.platforms[e.currentPlatform]:e.currentTheme&&e.currentTheme!=="none"&&(r=e.repositories.themes[e.currentTheme]),r?{fullName:r.fullName,branch:r.branch,filePath:r.filePath,fileType:r.fileType}:null}static async refreshDataFromRepository(e){console.log("[RefreshManager] Refreshing data from repository:",e);let r,n=!1;try{r=await xt.getFileContent(e.fullName,e.filePath,e.branch)}catch(a){console.log("[RefreshManager] Authenticated file refresh failed, trying public API");try{r=await xt.getPublicFileContent(e.fullName,e.filePath,e.branch)}catch(l){if(console.log("[RefreshManager] Both authenticated and public requests failed, checking if this is a new branch"),a instanceof Error&&a.message.includes("404")||l instanceof Error&&(l.message.includes("404")||l.message.includes("File not found")))n=!0,console.log("[RefreshManager] Detected new branch, will create initial file content");else throw l}}if(n)await this.initializeNewBranch(e);else{if(!r||!r.content)throw new Error("Failed to load file content from GitHub");{const a=JSON.parse(r.content);await Un.getInstance().loadFromGitHub(a,e.fileType)}}const i=xr.getInstance().getCurrentContext();await this.mergeDataForCurrentContext(i),console.log("[RefreshManager] Data refresh completed for repository:",e.fullName)}static async initializeNewBranch(e){console.log("[RefreshManager] Initializing new branch with initial file content:",e);try{let r,n;if(e.fileType==="schema"){const i=L.getCoreData();i?(r=i,n=`Initialize ${e.filePath} with current core data`):(r={tokens:[],collections:[],modes:[],dimensions:[],platforms:[],themes:[],taxonomies:[],resolvedValueTypes:[],algorithms:[],componentProperties:[],componentCategories:[],components:[],figmaConfiguration:null},n=`Initialize ${e.filePath} with default structure`)}else if(e.fileType==="platform-extension")r={platformId:"",platformName:"",extensions:{tokens:[],collections:[],modes:[],dimensions:[],resolvedValueTypes:[]}},n=`Initialize ${e.filePath} with platform extension structure`;else if(e.fileType==="theme-override")r={themeId:"",themeName:"",overrides:{tokens:[],collections:[],modes:[],dimensions:[]}},n=`Initialize ${e.filePath} with theme override structure`;else throw new Error(`Unknown file type: ${e.fileType}`);await xt.createFile(e.fullName,e.filePath,JSON.stringify(r,null,2),e.branch,n),console.log("[RefreshManager] Successfully created initial file content in new branch"),await Un.getInstance().loadFromGitHub(r,e.fileType)}catch(r){throw console.error("[RefreshManager] Failed to initialize new branch:",r),new Error(`Failed to initialize new branch: ${r instanceof Error?r.message:"Unknown error"}`)}}static async mergeDataForCurrentContext(e){if(console.log("[RefreshManager] Merging data for current context"),!L.getCoreData()){console.warn("[RefreshManager] No core data available for merging");return}const n={};if(e.currentPlatform&&e.currentPlatform!=="none"){const i=L.getPlatformExtensionData(e.currentPlatform);i&&(n[e.currentPlatform]=i)}const s={};if(e.currentTheme&&e.currentTheme!=="none"){const i=L.getThemeOverrideData(e.currentTheme);i&&(s[e.currentTheme]=i)}console.log("[RefreshManager] Data merging completed")}static clearEditModeState(){console.log("[RefreshManager] Clearing edit mode state"),go.clearSession(),xr.getInstance().exitEditMode(),Sn.getInstance().clearEditModeOnly()}static async refreshForBranchSwitch(e){console.log("[RefreshManager] Refreshing for branch switch:",e),Sn.getInstance().updateRepositoryContext(e),await this.refreshWithContext({preserveRepositoryContext:!0,preserveBranchCache:!0,clearEditMode:!1,suppressToast:!0},e)}static async refreshForExitEditMode(){console.log("[RefreshManager] Refreshing for exit edit mode"),await this.refreshWithContext({preserveRepositoryContext:!0,preserveBranchCache:!0,clearEditMode:!0,suppressToast:!0})}static async refreshForManualRefresh(){console.log("[RefreshManager] Refreshing for manual refresh"),await this.refreshWithContext({preserveRepositoryContext:!0,preserveBranchCache:!1,clearEditMode:!1,suppressToast:!1})}static async refreshForSourceSwitch(e){console.log("[RefreshManager] Refreshing for source switch:",e),Sn.getInstance().updateRepositoryContext(e),await this.refreshWithContext({preserveRepositoryContext:!0,preserveBranchCache:!1,clearEditMode:!0,suppressToast:!0})}};rt(pa,"instance");let yc=pa;const fa=class fa{constructor(){}static getInstance(){return fa.instance||(fa.instance=new fa),fa.instance}static async switchToBranch(e,r,n=!0,s){console.log("[BranchManager] Switching to branch:",{repositoryFullName:e,branchName:r,preserveContext:n,repositoryContext:s});try{const i=Sn.getInstance(),a=i.getCurrentRepositoryContext(),l={fullName:e,branch:r,filePath:(s==null?void 0:s.filePath)||(a==null?void 0:a.filePath)||"schema.json",fileType:(s==null?void 0:s.fileType)||(a==null?void 0:a.fileType)||"schema"};i.updateRepositoryContext(l),await yc.refreshForBranchSwitch(l),console.log("[BranchManager] Successfully switched to branch:",r)}catch(i){throw console.error("[BranchManager] Failed to switch to branch:",i),i}}static async loadBranchesForRepository(e,r=!1){console.log("[BranchManager] Loading branches for repository:",{repositoryFullName:e,forceRefresh:r});try{if(!r){const l=qr.getBranchesWithTTL(e);if(l&&l.length>0){console.log("[BranchManager] Using cached branches for:",e);const c=l.map(u=>u.name);return Sn.getInstance().setRepositoryBranches(e,c),c}}let n=!1;try{await Yt.getValidAccessToken(),n=!0,console.log("[BranchManager] Using authenticated branch loading")}catch{console.log("[BranchManager] No valid access token, using public API for branch loading"),n=!1}console.log("[BranchManager] Fetching branches from GitHub for:",e);const s=n?await xt.getBranches(e):await xt.getPublicBranches(e);qr.setBranchesWithTTL(e,s);const i=Sn.getInstance(),a=s.map(l=>l.name);return i.setRepositoryBranches(e,a),console.log("[BranchManager] Successfully loaded branches for:",e),a}catch(n){console.error("[BranchManager] Failed to load branches for repository:",n);const i=Sn.getInstance().getRepositoryBranches(e);if(i&&i.length>0)return console.log("[BranchManager] Using fallback cached branches for:",e),i;throw n}}static getCachedBranches(e){return Sn.getInstance().getRepositoryBranches(e)}static async branchExists(e,r){try{return(await this.loadBranchesForRepository(e)).includes(r)}catch(n){return console.error("[BranchManager] Error checking if branch exists:",n),!1}}static async getDefaultBranch(e){try{const r=await this.loadBranchesForRepository(e),n=["main","master","develop"];for(const s of n)if(r.includes(s))return s;if(r.length>0)return r[0];throw new Error("No branches found in repository")}catch(r){throw console.error("[BranchManager] Error getting default branch:",r),r}}static async createBranch(e,r,n){console.log("[BranchManager] Creating new branch:",{repositoryFullName:e,baseBranch:r,newBranchName:n});try{await xt.createBranch(e,r,n),qr.clearBranchesForRepository(e),await this.loadBranchesForRepository(e,!0),console.log("[BranchManager] Successfully created branch:",n)}catch(s){throw console.error("[BranchManager] Failed to create branch:",s),s}}static validateBranchName(e){const r=[];return/[~^:?*[\\]/.test(e)&&r.push("Branch name contains invalid characters: ~, ^, :, ?, *, [, \\"),e.includes("..")&&r.push("Branch name cannot contain consecutive dots (..)"),(e.startsWith(".")||e.endsWith("."))&&r.push("Branch name cannot start or end with a dot"),(e.startsWith("/")||e.endsWith("/"))&&r.push("Branch name cannot start or end with a slash"),e.length>255&&r.push("Branch name is too long (max 255 characters)"),e.trim().length===0&&r.push("Branch name cannot be empty"),{isValid:r.length===0,errors:r}}static generateBranchName(e,r,n=!0){let s=e.toLowerCase().replace(/[^a-z0-9-_]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");if(r!=null&&r.login&&(s=`${r.login}-${s}`),n){const i=new Date().toISOString().replace(/[:.]/g,"-").replace("T","-").replace("Z","").slice(0,-4);s=`${s}-${i}`}return s}static clearBranchCache(e){console.log("[BranchManager] Clearing branch cache for:",e),qr.clearBranchesForRepository(e),Sn.getInstance().setRepositoryBranches(e,[])}static async getBranchStats(e){try{const r=await this.loadBranchesForRepository(e),n=await this.getDefaultBranch(e),s=r.filter(i=>i!==n).slice(0,5);return{totalBranches:r.length,defaultBranch:n,recentBranches:s}}catch(r){throw console.error("[BranchManager] Error getting branch stats:",r),r}}};rt(fa,"instance");let xc=fa;const ga=class ga{constructor(){}static getInstance(){return ga.instance||(ga.instance=new ga),ga.instance}static enterEditMode(e,r,n){console.log("[EditModeManager] Entering edit mode:",{branch:e,sourceType:r,sourceId:n});try{const s=Sn.getInstance(),i=s.getCurrentState(),a={isActive:!0,branch:e,sourceType:r,sourceId:n||null,repositoryContext:i.currentRepository};s.updateEditMode(a),xr.getInstance().enterEditMode(),console.log("[EditModeManager] Successfully entered edit mode")}catch(s){throw console.error("[EditModeManager] Failed to enter edit mode:",s),s}}static async exitEditMode(e=!0){console.log("[EditModeManager] Exiting edit mode, preserve context:",e);try{Sn.getInstance().clearEditModeOnly(),xr.getInstance().exitEditMode(),await yc.refreshForExitEditMode(),console.log("[EditModeManager] Successfully exited edit mode")}catch(r){throw console.error("[EditModeManager] Failed to exit edit mode:",r),r}}static getCurrentEditMode(){return Sn.getInstance().getCurrentEditMode()}static isInEditMode(){return this.getCurrentEditMode().isActive}static getCurrentEditBranch(){return this.getCurrentEditMode().branch}static getCurrentEditSourceType(){return this.getCurrentEditMode().sourceType}static getCurrentEditSourceId(){return this.getCurrentEditMode().sourceId}static getCurrentEditRepositoryContext(){return this.getCurrentEditMode().repositoryContext}static updateEditBranch(e){console.log("[EditModeManager] Updating edit branch to:",e);const r=Sn.getInstance(),s={...r.getCurrentEditMode(),branch:e};r.updateEditMode(s)}static updateEditSource(e,r){console.log("[EditModeManager] Updating edit source:",{sourceType:e,sourceId:r});const n=Sn.getInstance(),i={...n.getCurrentEditMode(),sourceType:e,sourceId:r||null};n.updateEditMode(i)}static validateEditModeState(){const e=this.getCurrentEditMode();return e.isActive?e.branch?e.sourceType?e.repositoryContext?!0:(console.error("[EditModeManager] Edit mode active but no repository context"),!1):(console.error("[EditModeManager] Edit mode active but no source type specified"),!1):(console.error("[EditModeManager] Edit mode active but no branch specified"),!1):!0}static resetEditModeState(){console.log("[EditModeManager] Resetting edit mode state"),Sn.getInstance().clearEditModeOnly(),xr.getInstance().exitEditMode()}};rt(ga,"instance");let yu=ga;const TC=()=>({getItem:r=>{try{return localStorage.getItem(r)}catch(n){return console.error("Error reading from localStorage:",n),null}},setItem:(r,n)=>{try{localStorage.setItem(r,n)}catch(s){console.error("Error writing to localStorage:",s)}}});let md=class{static validateData(e,r){try{switch(r){case"core":{qu(e);break}case"platform-extension":{Ju(e);break}case"theme-override":{cb(e);break}}return{isValid:!0,errors:[],warnings:[]}}catch(n){return{isValid:!1,errors:[n instanceof Error?n.message:"Validation failed"],warnings:[]}}}static validateAllDataSources(e,r,n){const s={core:{isValid:!0,errors:[],warnings:[]},platforms:{},themes:{},overall:{isValid:!0,errors:[],warnings:[]}};e&&(s.core=this.validateData(e,"core")),Object.entries(r).forEach(([d,u])=>{s.platforms[d]=this.validateData(u,"platform-extension")}),Object.entries(n).forEach(([d,u])=>{s.themes[d]=this.validateData(u,"theme-override")});const i=[s.core,...Object.values(s.platforms),...Object.values(s.themes)],a=i.some(d=>!d.isValid),l=i.flatMap(d=>d.errors),c=i.flatMap(d=>d.warnings);return s.overall={isValid:!a,errors:l,warnings:c},s}static validateDataConsistency(e,r,n){const s=[],i=[];return e?(Object.entries(r).forEach(([a,l])=>{var d;((d=e.platforms)==null?void 0:d.some(u=>u.id===a))||s.push(`Platform extension references non-existent platform: ${a}`),l.systemId!==e.systemId&&s.push(`Platform extension systemId mismatch: ${l.systemId} vs ${e.systemId}`),l.tokenOverrides&&l.tokenOverrides.forEach(u=>{var g;((g=e.tokens)==null?void 0:g.some(y=>y.id===u.tokenId))||s.push(`Platform extension references non-existent token: ${u.tokenId}`)})}),Object.entries(n).forEach(([a,l])=>{var d;((d=e.themes)==null?void 0:d.some(u=>u.id===a))||s.push(`Theme override references non-existent theme: ${a}`),l.systemId!==e.systemId&&s.push(`Theme override systemId mismatch: ${l.systemId} vs ${e.systemId}`),l.tokenOverrides&&l.tokenOverrides.forEach(u=>{var g;((g=e.tokens)==null?void 0:g.some(y=>y.id===u.tokenId))||s.push(`Theme override references non-existent token: ${u.tokenId}`)})}),{isValid:s.length===0,errors:s,warnings:i}):{isValid:!0,errors:[],warnings:[]}}static validateTokenReferences(e,r,n){var l;const s=[],i=[];if(!e)return{isValid:!0,errors:[],warnings:[]};const a=new Set(((l=e.tokens)==null?void 0:l.map(c=>c.id))||[]);return Object.entries(r).forEach(([c,d])=>{d.tokenOverrides&&d.tokenOverrides.forEach(u=>{a.has(u.tokenId)||s.push(`Platform ${c} references non-existent token: ${u.tokenId}`)})}),Object.entries(n).forEach(([c,d])=>{d.tokenOverrides&&d.tokenOverrides.forEach(u=>{a.has(u.tokenId)||s.push(`Theme ${c} references non-existent token: ${u.tokenId}`)})}),{isValid:s.length===0,errors:s,warnings:i}}static validateDimensionModeReferences(e,r){var l,c;const n=[],s=[];if(!e)return{isValid:!0,errors:[],warnings:[]};const i=new Set(((l=e.dimensions)==null?void 0:l.map(d=>d.id))||[]),a=new Set;return(c=e.dimensions)==null||c.forEach(d=>{var u;(u=d.modes)==null||u.forEach(m=>{a.add(m.id)})}),Object.entries(r).forEach(([d,u])=>{u.omittedDimensions&&u.omittedDimensions.forEach(m=>{i.has(m)||n.push(`Platform ${d} omits non-existent dimension: ${m}`)}),u.omittedModes&&u.omittedModes.forEach(m=>{a.has(m)||n.push(`Platform ${d} omits non-existent mode: ${m}`)})}),{isValid:n.length===0,errors:n,warnings:s}}static validateResolvedValueTypeReferences(e,r){var a;const n=[],s=[];if(!e)return{isValid:!0,errors:[],warnings:[]};const i=new Set(((a=e.resolvedValueTypes)==null?void 0:a.map(l=>l.id))||[]);return Object.entries(r).forEach(([l,c])=>{c.syntaxPatterns&&Object.entries(c.syntaxPatterns).forEach(([d,u])=>{i.has(d)||n.push(`Platform ${l} references non-existent resolved value type: ${d}`)}),c.valueFormatters&&Object.entries(c.valueFormatters).forEach(([d,u])=>{i.has(d)||n.push(`Platform ${l} references non-existent resolved value type: ${d}`)})}),{isValid:n.length===0,errors:n,warnings:s}}static getValidationReport(e,r,n){const s=this.validateAllDataSources(e,r,n),i=this.validateDataConsistency(e,r,n),a=this.validateTokenReferences(e,r,n),l=this.validateDimensionModeReferences(e,r),c=this.validateResolvedValueTypeReferences(e,r),d=[s.overall,i,a,l,c],u=d.some(v=>!v.isValid),m=d.flatMap(v=>v.errors),g=d.flatMap(v=>v.warnings);return{summary:s,consistency:i,tokenReferences:a,dimensionModeReferences:l,resolvedValueTypeReferences:c,overall:{isValid:!u,errors:m,warnings:g}}}};const EC=()=>{const{getItem:t,setItem:e}=TC(),r=Hr(),n=(u,m)=>{const g=new Set(m.map(v=>v.id)),y=u.filter(v=>g.has(v));return y.length!==u.length&&console.warn("[useSchema] Removed invalid taxonomy IDs from taxonomy order:",u.filter(v=>!g.has(v))),y},s=u=>u.map(m=>{const g=m;if(g.propertyTypes&&Array.isArray(g.propertyTypes)){const y=g.propertyTypes.map(v=>{if(typeof v=="string"){const I=v;return{id:I,displayName:I.replace(/_/g," ").toLowerCase().replace(/\b\w/g,S=>S.toUpperCase()),category:"layout",compatibleValueTypes:[],inheritance:!1}}return v});return{...g,propertyTypes:y}}return m}),i=u=>(u.standardPropertyTypes||(u.standardPropertyTypes=[{id:"ALL",displayName:"All Properties",category:"layout",compatibleValueTypes:["color","dimension","font-family","font-weight","font-size","line-height","letter-spacing","duration","cubic-bezier","blur","radius"],inheritance:!1}]),u),[a,l]=M.useState(()=>{var m,g;const u=t("schema");if(u)try{const y=JSON.parse(u);if(!y.standardPropertyTypes||y.tokens&&y.tokens.length>0&&typeof((m=y.tokens[0].propertyTypes)==null?void 0:m[0])=="string")return console.log("[useSchema] Detected old schema format, clearing storage to load new data"),e("schema",""),null;if((g=y.standardPropertyTypes)==null?void 0:g.some(C=>{var T;return(C.id==="padding"||C.id==="margin"||C.id==="gap-spacing")&&((T=C.compatibleValueTypes)==null?void 0:T.includes("dimension"))}))return console.log("[useSchema] Detected old spacing property type mappings, clearing storage to load updated data"),e("schema",""),null;const I=L.getTaxonomyOrder(),S=L.getTaxonomies(),b=n(I,S),k={...y,taxonomyOrder:b,tokens:s(y.tokens||[]),...i(y)},A=md.validateData(k);return A.isValid?k:(console.error("Invalid schema in storage:",A.errors),r({title:"Schema Error",description:"Invalid schema found in storage",status:"error",duration:5e3,isClosable:!0}),null)}catch(y){return console.error("Failed to parse stored schema:",y),r({title:"Schema Error",description:"Failed to parse stored schema",status:"error",duration:5e3,isClosable:!0}),null}try{const y=L.getCollections(),v=L.getTokens(),I=L.getDimensions(),S=L.getPlatforms(),b=L.getThemes(),k=L.getTaxonomies(),A=L.getValueTypes(),C=L.getTaxonomyOrder(),T=L.getDimensionOrder();if(y.length>0||v.length>0){const P=n(C,k),_={version:"1.0.0",systemName:"Design System",systemId:"design-system",description:"A comprehensive design system with tokens, dimensions, and themes",tokenCollections:y,tokens:s(v),dimensions:I,platforms:S,themes:b,taxonomies:k,resolvedValueTypes:A,taxonomyOrder:P,dimensionOrder:T,versionHistory:[{version:"1.0.0",dimensions:I.map(G=>G.id),date:new Date().toISOString().slice(0,10)}]},R=md.validateData(_);return R.isValid?_:(console.error("Invalid schema from storage:",R.errors),r({title:"Schema Error",description:"Invalid schema found in storage",status:"error",duration:5e3,isClosable:!0}),null)}}catch(y){console.error("Failed to load schema from storage:",y),r({title:"Schema Error",description:"Failed to load schema from storage",status:"error",duration:5e3,isClosable:!0})}return null});return M.useEffect(()=>{(async()=>{if(!a)try{const m=t("schema");if(m)l(m);else{const g={systemName:"Design System",systemId:"design-system",version:"1.0.0",description:"A comprehensive design system",tokenCollections:[],tokens:[],dimensions:[],modes:[],platforms:[],themes:[],taxonomies:[],resolvedValueTypes:[],componentProperties:[],componentCategories:[],components:[],taxonomyOrder:[],dimensionOrder:[],versionHistory:[],namingRules:{prefix:"",suffix:"",delimiter:"_",capitalization:"none"}};l(g),e("schema",g)}}catch(m){console.error("[useSchema] Error loading schema:",m)}})()},[a,t,e]),M.useEffect(()=>{var u;if(a)try{const m=md.validateData(a);if(m.isValid)e("schema",JSON.stringify(a));else throw new Error(`Invalid schema structure: ${(u=m.errors)==null?void 0:u.join(", ")}`)}catch(m){console.error("Failed to save schema:",m),r({title:"Schema Error",description:"Failed to save schema",status:"error",duration:5e3,isClosable:!0})}},[a,e,r]),M.useEffect(()=>{console.debug("[useSchema] Current schema:",a)},[a]),{schema:a,updateSchema:u=>{var m;try{const g=md.validateData(u);if(g.isValid)l(u);else throw new Error(`Invalid schema structure: ${(m=g.errors)==null?void 0:m.join(", ")}`)}catch(g){console.error("Failed to update schema:",g),r({title:"Schema Error",description:"Failed to update schema",status:"error",duration:5e3,isClosable:!0})}},clearSchemaCache:()=>{console.log("[useSchema] Clearing schema cache"),e("schema",""),l(null)}}},MC=()=>{const[t,e]=M.useState("dashboard"),r=M.useCallback(n=>{e(n)},[]);return{currentView:t,navigateToView:r}};/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AC=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),PC=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,n)=>n?n.toUpperCase():r.toLowerCase()),Ey=t=>{const e=PC(t);return e.charAt(0).toUpperCase()+e.slice(1)},mb=(...t)=>t.filter((e,r,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===r).join(" ").trim(),NC=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var DC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RC=M.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:s="",children:i,iconNode:a,...l},c)=>M.createElement("svg",{ref:c,...DC,width:e,height:e,stroke:t,strokeWidth:n?Number(r)*24/Number(e):r,className:mb("lucide",s),...!i&&!NC(l)&&{"aria-hidden":"true"},...l},[...a.map(([d,u])=>M.createElement(d,u)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=(t,e)=>{const r=M.forwardRef(({className:n,...s},i)=>M.createElement(RC,{ref:i,iconNode:e,className:mb(`lucide-${AC(Ey(t))}`,`lucide-${t}`,n),...s}));return r.displayName=Ey(t),r};/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OC=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],My=vt("arrow-right",OC);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _C=[["circle",{cx:"9",cy:"9",r:"7",key:"p2h5vp"}],["circle",{cx:"15",cy:"15",r:"7",key:"19ennj"}]],FC=vt("blend",_C);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VC=[["path",{d:"M10 2v8l3-3 3 3V2",key:"sqw3rj"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],pb=vt("book-marked",VC);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $C=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],Ay=vt("bot",$C);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zC=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],LC=vt("box",zC);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BC=[["path",{d:"M2.97 12.92A2 2 0 0 0 2 14.63v3.24a2 2 0 0 0 .97 1.71l3 1.8a2 2 0 0 0 2.06 0L12 19v-5.5l-5-3-4.03 2.42Z",key:"lc1i9w"}],["path",{d:"m7 16.5-4.74-2.85",key:"1o9zyk"}],["path",{d:"m7 16.5 5-3",key:"va8pkn"}],["path",{d:"M7 16.5v5.17",key:"jnp8gn"}],["path",{d:"M12 13.5V19l3.97 2.38a2 2 0 0 0 2.06 0l3-1.8a2 2 0 0 0 .97-1.71v-3.24a2 2 0 0 0-.97-1.71L17 10.5l-5 3Z",key:"8zsnat"}],["path",{d:"m17 16.5-5-3",key:"8arw3v"}],["path",{d:"m17 16.5 4.74-2.85",key:"8rfmw"}],["path",{d:"M17 16.5v5.17",key:"k6z78m"}],["path",{d:"M7.97 4.42A2 2 0 0 0 7 6.13v4.37l5 3 5-3V6.13a2 2 0 0 0-.97-1.71l-3-1.8a2 2 0 0 0-2.06 0l-3 1.8Z",key:"1xygjf"}],["path",{d:"M12 8 7.26 5.15",key:"1vbdud"}],["path",{d:"m12 8 4.74-2.85",key:"3rx089"}],["path",{d:"M12 13.5V8",key:"1io7kd"}]],fb=vt("boxes",BC);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UC=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],GC=vt("calendar",UC);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HC=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],WC=vt("chart-pie",HC);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qC=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Fd=vt("check",qC);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JC=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],rm=vt("chevron-down",JC);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YC=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],KC=vt("chevron-left",YC);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZC=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],gb=vt("chevron-right",ZC);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XC=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],QC=vt("circle-alert",XC);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e6=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],t6=vt("circle-check-big",e6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r6=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Lf=vt("circle",r6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n6=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],Py=vt("clock",n6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s6=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],o6=vt("columns-2",s6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i6=[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],a6=vt("compass",i6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l6=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],c6=vt("copy",l6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d6=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5v14a9 3 0 0 0 18 0V5",key:"aqi0yr"}]],u6=vt("cylinder",d6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h6=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Ep=vt("database",h6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m6=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],xu=vt("download",m6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p6=[["path",{d:"m15 15 6 6",key:"1s409w"}],["path",{d:"m15 9 6-6",key:"ko1vev"}],["path",{d:"M21 16v5h-5",key:"1ck2sf"}],["path",{d:"M21 8V3h-5",key:"1qoq8a"}],["path",{d:"M3 16v5h5",key:"1t08am"}],["path",{d:"m3 21 6-6",key:"wwnumi"}],["path",{d:"M3 8V3h5",key:"1ln10m"}],["path",{d:"M9 9 3 3",key:"v551iv"}]],yb=vt("expand",p6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f6=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Bf=vt("external-link",f6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g6=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],y6=vt("eye-off",g6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x6=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],v6=vt("eye",x6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b6=[["path",{d:"M5 5.5A3.5 3.5 0 0 1 8.5 2H12v7H8.5A3.5 3.5 0 0 1 5 5.5z",key:"1340ok"}],["path",{d:"M12 2h3.5a3.5 3.5 0 1 1 0 7H12V2z",key:"1hz3m3"}],["path",{d:"M12 12.5a3.5 3.5 0 1 1 7 0 3.5 3.5 0 1 1-7 0z",key:"1oz8n2"}],["path",{d:"M5 19.5A3.5 3.5 0 0 1 8.5 16H12v3.5a3.5 3.5 0 1 1-7 0z",key:"1ff65i"}],["path",{d:"M5 12.5A3.5 3.5 0 0 1 8.5 9H12v7H8.5A3.5 3.5 0 0 1 5 12.5z",key:"pdip6e"}]],Uf=vt("figma",b6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S6=[["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}]],Mp=vt("file-code",S6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w6=[["path",{d:"M20 17a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3.9a2 2 0 0 1-1.69-.9l-.81-1.2a2 2 0 0 0-1.67-.9H8a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2Z",key:"4u7rpt"}],["path",{d:"M2 8v11a2 2 0 0 0 2 2h14",key:"1eicx1"}]],Ap=vt("folders",w6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C6=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],k6=vt("funnel",C6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I6=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],j6=vt("gauge",I6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T6=[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]],Gf=vt("git-branch",T6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E6=[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]],xb=vt("git-commit-horizontal",E6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M6=[["path",{d:"M12 3v6",key:"1holv5"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M12 15v6",key:"a9ows0"}]],A6=vt("git-commit-vertical",M6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P6=[["circle",{cx:"5",cy:"6",r:"3",key:"1qnov2"}],["path",{d:"M5 9v12",key:"ih889a"}],["circle",{cx:"19",cy:"18",r:"3",key:"1qljk2"}],["path",{d:"m15 9-3-3 3-3",key:"1lwv8l"}],["path",{d:"M12 6h5a2 2 0 0 1 2 2v7",key:"1yj91y"}]],N6=vt("git-pull-request-arrow",P6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D6=[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]],Pp=vt("github",D6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R6=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Np=vt("grip-vertical",R6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O6=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],_6=vt("history",O6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F6=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Ny=vt("info",F6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V6=[["path",{d:"M5 12h14",key:"1ays0h"}]],Yu=vt("minus",V6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $6=[["path",{d:"M18 8V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h8",key:"10dyio"}],["path",{d:"M10 19v-3.96 3.15",key:"1irgej"}],["path",{d:"M7 19h5",key:"qswx4l"}],["rect",{width:"6",height:"10",x:"16",y:"12",rx:"2",key:"1egngj"}]],vb=vt("monitor-smartphone",$6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z6=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],bb=vt("monitor",z6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L6=[["path",{d:"m18 8 4 4-4 4",key:"1ak13k"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}]],Sb=vt("move-horizontal",L6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B6=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m8 18 4 4 4-4",key:"bh5tu3"}],["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}]],wb=vt("move-vertical",B6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U6=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],Ha=vt("palette",U6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G6=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]],H6=vt("panels-top-left",G6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W6=[["path",{d:"M8 21s-4-3-4-9 4-9 4-9",key:"uto9ud"}],["path",{d:"M16 3s4 3 4 9-4 9-4 9",key:"4w2vsq"}]],q6=vt("parentheses",W6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J6=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],Y6=vt("pen-tool",J6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K6=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}],["path",{d:"m15 5 3 3",key:"1w25hb"}]],Z6=vt("pencil-line",K6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X6=[["path",{d:"M13 7 8.7 2.7a2.41 2.41 0 0 0-3.4 0L2.7 5.3a2.41 2.41 0 0 0 0 3.4L7 13",key:"orapub"}],["path",{d:"m8 6 2-2",key:"115y1s"}],["path",{d:"m18 16 2-2",key:"ee94s4"}],["path",{d:"m17 11 4.3 4.3c.94.94.94 2.46 0 3.4l-2.6 2.6c-.94.94-2.46.94-3.4 0L11 17",key:"cfq27r"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],vu=vt("pencil-ruler",X6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q6=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],Dy=vt("play",Q6);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ek=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],to=vt("plus",ek);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tk=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]],rk=vt("redo-2",tk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nk=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Hf=vt("refresh-cw",nk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sk=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],vc=vt("rotate-ccw",sk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ok=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],Wf=vt("ruler",ok);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ik=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Cb=vt("save",ik);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ak=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],kb=vt("search",ak);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lk=[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],Ib=vt("settings-2",lk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ck=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],jb=vt("settings",ck);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dk=[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]],uk=vt("shapes",dk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hk=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],mk=vt("share-2",hk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pk=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}]],fk=vt("sparkle",pk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gk=[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]],yk=vt("split",gk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xk=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 17c2 0 2.8-1 2.8-2.8V10c0-2 1-3.3 3.2-3",key:"m1af9g"}],["path",{d:"M9 11.2h5.7",key:"3zgcl2"}]],Xi=vt("square-function",xk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vk=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],qf=vt("square-pen",vk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bk=[["path",{d:"M21 11a8 8 0 0 0-8-8",key:"1lxwo5"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1dv2y5"}]],Tb=vt("square-round-corner",bk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sk=[["path",{d:"M4 10c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2",key:"4i38lg"}],["path",{d:"M10 16c-1.1 0-2-.9-2-2v-4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2",key:"mlte4a"}],["rect",{width:"8",height:"8",x:"14",y:"14",rx:"2",key:"1fa9i4"}]],Eb=vt("square-stack",Sk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wk=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Ck=vt("square",wk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kk=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Ik=vt("star",kk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jk=[["line",{x1:"6",x2:"6",y1:"4",y2:"20",key:"fy8qot"}],["polygon",{points:"10,4 20,12 10,20",key:"1mc1pf"}]],Tk=vt("step-forward",jk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ek=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],Dp=vt("tag",Ek);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mk=[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]],Ak=vt("test-tube",Mk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pk=[["path",{d:"M12 20h-1a2 2 0 0 1-2-2 2 2 0 0 1-2 2H6",key:"1528k5"}],["path",{d:"M13 8h7a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-7",key:"13ksps"}],["path",{d:"M5 16H4a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h1",key:"1n9rhb"}],["path",{d:"M6 4h1a2 2 0 0 1 2 2 2 2 0 0 1 2-2h1",key:"1mj8rg"}],["path",{d:"M9 6v12",key:"velyjx"}]],Nk=vt("text-cursor-input",Pk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dk=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],Mb=vt("timer",Dk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rk=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],Eo=vt("trash-2",Rk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ok=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ro=vt("triangle-alert",Ok);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _k=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],Jf=vt("type",_k);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fk=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],Vk=vt("undo-2",Fk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $k=[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]],zk=vt("unlink",$k);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lk=[["path",{d:"M8 21s-4-3-4-9 4-9 4-9",key:"uto9ud"}],["path",{d:"M16 3s4 3 4 9-4 9-4 9",key:"4w2vsq"}],["line",{x1:"15",x2:"9",y1:"9",y2:"15",key:"f7djnv"}],["line",{x1:"9",x2:"15",y1:"9",y2:"15",key:"1shsy8"}]],bu=vt("variable",Lk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bk=[["circle",{cx:"12",cy:"4.5",r:"2.5",key:"r5ysbb"}],["path",{d:"m10.2 6.3-3.9 3.9",key:"1nzqf6"}],["circle",{cx:"4.5",cy:"12",r:"2.5",key:"jydg6v"}],["path",{d:"M7 12h10",key:"b7w52i"}],["circle",{cx:"19.5",cy:"12",r:"2.5",key:"1piiel"}],["path",{d:"m13.8 17.7 3.9-3.9",key:"1wyg1y"}],["circle",{cx:"12",cy:"19.5",r:"2.5",key:"13o1pw"}]],Uk=vt("waypoints",Bk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gk=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ab=vt("x",Gk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hk=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Wk=vt("zoom-in",Hk);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qk=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Jk=vt("zoom-out",qk),Pb=({size:t=40,color:e="inherit"})=>o.jsx("span",{style:{display:"inline-block",color:e},children:o.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-label":"Logo",children:o.jsx("path",{d:"M10.4902 1.35589C11.4183 0.820116 12.5621 0.820141 13.4902 1.35589L20.4492 5.37444C21.3774 5.9103 21.9491 6.90039 21.9492 7.9721V16.0082C21.9492 17.08 21.3774 18.07 20.4492 18.6059L13.5 22.6186V15.6987C14.9656 15.1052 15.9998 13.669 16 11.9907C16 9.78154 14.2091 7.99065 12 7.99065C9.79088 7.99065 8.00002 9.78154 8 11.9907C8.00017 13.669 9.03444 15.1052 10.5 15.6987V22.6293C10.4968 22.6275 10.4934 22.6263 10.4902 22.6244L3.53125 18.6059C2.60305 18.07 2.03125 17.08 2.03125 16.0082V7.9721C2.03133 6.90039 2.60311 5.9103 3.53125 5.37444L10.4902 1.35589Z",fill:"currentColor"})})}),Yf=({size:t=24})=>o.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[o.jsx("path",{d:"M21 16V8C20.9996 7.64927 20.9071 7.30481 20.7315 7.00116C20.556 6.69752 20.3037 6.44536 20 6.27L13 2.27C12.696 2.09446 12.3511 2.00205 12 2.00205C11.6489 2.00205 11.304 2.09446 11 2.27L4 6.27C3.69626 6.44536 3.44398 6.69752 3.26846 7.00116C3.09294 7.30481 3.00036 7.64927 3 8V16C3.00036 16.3507 3.09294 16.6952 3.26846 16.9988C3.44398 17.3025 3.69626 17.5546 4 17.73L11 21.73C11.304 21.9055 11.6489 21.998 12 21.998C12.3511 21.998 12.696 21.9055 13 21.73L20 17.73C20.3037 17.5546 20.556 17.3025 20.7315 16.9988C20.9071 16.6952 20.9996 16.3507 21 16Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsx("circle",{cx:"12",cy:"12",r:"3.5",stroke:"currentColor",strokeWidth:"2"}),o.jsx("line",{x1:"3.03381",y1:"6.55748",x2:"9.05547",y2:"10.468",stroke:"currentColor",strokeWidth:"2"}),o.jsx("line",{y1:"-1",x2:"7.18",y2:"-1",transform:"matrix(-0.838671 0.544639 0.544639 0.838671 21.5108 7.39615)",stroke:"currentColor",strokeWidth:"2"}),o.jsx("line",{x1:"12",y1:"16.1429",x2:"12",y2:"21.6525",stroke:"currentColor",strokeWidth:"2"})]}),Yk=[{id:"dashboard",label:"Dashboard",icon:j6},{id:"system",label:"System",icon:Uk},{id:"foundations",label:"Foundations",icon:uk},{id:"tokens",label:"Tokens",icon:Yf},{id:"components",label:"Components",icon:fb},{id:"themes",label:"Themes",icon:Ha},{id:"platforms",label:"Platforms",icon:vb},{id:"figma-settings",label:"Figma",icon:Uf},{id:"analysis",label:"Analysis",icon:WC},{id:"schemas",label:"Schemas",icon:Mp}],Kk=({currentView:t,onNavigate:e})=>{const[r,n]=M.useState(!1),{colorMode:s}=Vt(),i=s==="dark"?"gray.800":"white",a=s==="dark"?"gray.700":"gray.200",l=(c,d=!1)=>{const u=t===c.id,m=c.icon;if(c.children&&!d)return r?null:o.jsx(E,{fontSize:"xs",fontWeight:"bold",color:"gray.500",textTransform:"uppercase",letterSpacing:"wider",mt:4,mb:2,px:2,children:c.label},c.id);const g=o.jsxs(z,{display:"flex",alignItems:"center",p:2,borderRadius:"md",bg:u?"gray.600":"transparent",color:u?"white":"inherit",_hover:{bg:u?"gray.800":s==="dark"?"gray.700":"gray.100"},cursor:"pointer",role:"menuitem","aria-current":u?"page":void 0,tabIndex:0,textDecoration:"none",onClick:()=>e(c.id),children:[m&&o.jsx(m,{size:20}),!r&&o.jsx(E,{ml:3,fontSize:"sm",children:c.label})]},c.id);return r?o.jsx(Cn,{label:c.label,placement:"right",children:g},c.id):g};return o.jsx(z,{as:"nav",position:"relative",w:r?"64px":"220px",h:"100vh",bg:i,borderRight:"1px",borderColor:a,transition:"width 0.2s",role:"navigation","aria-label":"Main navigation",children:o.jsxs(ce,{spacing:0,align:"stretch",h:"full",children:[o.jsxs(z,{px:4,py:3,borderBottom:"1px",borderColor:a,display:"flex",gap:2,justifyContent:"center",alignItems:"center",children:[o.jsx(Pb,{size:28,color:s==="dark"?"white":"black"}),!r&&o.jsxs(E,{fontSize:"sm",lineHeight:"1",fontWeight:"bold",children:["Design System",o.jsx("br",{}),"Foundry"]})]}),o.jsx(ce,{spacing:1,align:"stretch",p:4,flex:1,children:Yk.map(c=>c.children?o.jsxs(z,{children:[l(c),o.jsx(ce,{spacing:1,align:"stretch",ml:0,mt:1,children:c.children.map(d=>l(d,!0))},`${c.id}-children`)]},c.id):l(c))}),o.jsx(z,{px:4,py:2,borderBottom:"1px",borderColor:a,children:o.jsx(Oe,{"aria-label":r?"Expand sidebar":"Collapse sidebar",size:"sm",leftIcon:r?o.jsx(gb,{size:16}):o.jsx(KC,{size:16}),onClick:()=>n(!r),variant:"ghost",w:"full",gap:1,justifyContent:"flex-start",children:!r&&"Collapse"})})]})})},Zk=t=>{switch(t){case"token":return Yf;case"theme":return Ha;case"dimension":return Eb;case"mode":return jb;case"resolvedValueType":return vu;case"taxonomy":return Dp;case"term":return Dp;case"algorithm":return Xi;case"collection":return Ap;case"platform":return vb;case"platformExtensionFile":return Mp;case"repository":return pb;case"figmaConfiguration":return Uf;case"componentProperty":return Ib;case"componentCategory":return Ap;case"component":return fb;default:return Mp}},Xk=t=>{switch(t){case"added":return to;case"removed":return Yu;case"modified":return qf}},ur=(t,e=50)=>{if(t==null)return"null";if(typeof t=="string")return t.length>e?`${t.substring(0,e)}...`:t;if(typeof t=="object"){const r=JSON.stringify(t);return r.length>e?`${r.substring(0,e)}...`:r}return String(t)},Qk=(t,e)=>{var i,a,l;const r=[],n=new Map,s=new Map;t==null||t.forEach((c,d)=>{var u;if(typeof c=="object"&&c!==null){const m=((u=c.modeIds)==null?void 0:u.join(","))||`index-${d}`;n.set(m,c)}}),e==null||e.forEach((c,d)=>{var u;if(typeof c=="object"&&c!==null){const m=((u=c.modeIds)==null?void 0:u.join(","))||`index-${d}`;s.set(m,c)}});for(const[c,d]of s){const u=n.get(c);u?JSON.stringify(u.value)!==JSON.stringify(d.value)&&r.push({field:"valuesByMode",oldValue:u.value,newValue:d.value,context:`Modified for modes: ${((a=d.modeIds)==null?void 0:a.join(", "))||"global"}`}):r.push({field:"valuesByMode",newValue:d.value,context:`Added for modes: ${((i=d.modeIds)==null?void 0:i.join(", "))||"global"}`})}for(const[c,d]of n)s.has(c)||r.push({field:"valuesByMode",oldValue:d.value,context:`Removed for modes: ${((l=d.modeIds)==null?void 0:l.join(", "))||"global"}`});return r},eI=(t,e)=>{const r=[],n=new Map,s=new Map;t==null||t.forEach(i=>{typeof i=="object"&&i!==null&&n.set(i.platformId,i)}),e==null||e.forEach(i=>{typeof i=="object"&&i!==null&&s.set(i.platformId,i)});for(const[i,a]of s){const l=n.get(i);l?l.value!==a.value&&r.push({field:"platformOverrides",oldValue:l.value,newValue:a.value,context:`Modified for platform: ${i}`}):r.push({field:"platformOverrides",newValue:a.value,context:`Added for platform: ${i}`})}for(const[i,a]of n)s.has(i)||r.push({field:"platformOverrides",oldValue:a.value,context:`Removed for platform: ${i}`});return r},Ry=(t,e,r="id")=>{const n=[],s=new Map,i=new Map;t==null||t.forEach(a=>{typeof a=="object"&&a!==null&&s.set(a[r],a)}),e==null||e.forEach(a=>{typeof a=="object"&&a!==null&&i.set(a[r],a)});for(const[a,l]of i)if(!s.get(a)){const d=l;n.push({field:"array",newValue:d.name||d.displayName||a,context:`Added ${a}`})}for(const[a,l]of s)if(!i.has(a)){const c=l;n.push({field:"array",oldValue:c.name||c.displayName||a,context:`Removed ${a}`})}return n},Nb=(t,e)=>{var Ct,Qt,Zt,at;const r=[];if(!t||!e)return r;const n=t.linkedRepositories||[],s=e.linkedRepositories||[],i=new Map,a=new Map;n.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&i.set(Ae.id,Ae)}}),s.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&a.set(Ae.id,Ae)}});for(const[Q,Ae]of a)if(!i.has(Q)){const oe=Ae;r.push({type:"added",entityType:"repository",entityId:Q,entityName:`${oe.type||"unknown"} repository`,changes:[{field:"repository",newValue:`Added ${oe.type||"unknown"} repository: ${oe.repositoryUri||Q}`}]})}for(const[Q,Ae]of i)if(!a.has(Q)){const oe=Ae;r.push({type:"removed",entityType:"repository",entityId:Q,entityName:`${oe.type||"unknown"} repository`,changes:[{field:"repository",oldValue:`Removed ${oe.type||"unknown"} repository: ${oe.repositoryUri||Q}`}]})}const l=Object.values(t.platformExtensions||{}),c=Object.values(e.platformExtensions||{}),d=new Map,u=new Map;l.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.platformId&&d.set(Ae.platformId,Ae)}}),c.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.platformId&&u.set(Ae.platformId,Ae)}});for(const[Q]of u)d.has(Q)||r.push({type:"added",entityType:"platformExtension",entityId:Q,entityName:`Platform Extension: ${Q}`,changes:[{field:"extension",newValue:`Added platform extension for: ${Q}`}]});for(const[Q]of d)u.has(Q)||r.push({type:"removed",entityType:"platformExtension",entityId:Q,entityName:`Platform Extension: ${Q}`,changes:[{field:"extension",oldValue:`Removed platform extension for: ${Q}`}]});const m=t.tokens||[],g=e.tokens||[],y=new Map,v=new Map;m.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&y.set(Ae.id,Ae)}}),g.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&v.set(Ae.id,Ae)}});for(const[Q,Ae]of v)if(!y.has(Q)){const oe=Ae;r.push({type:"added",entityType:"token",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"token",newValue:`Added token: ${oe.displayName||Q} (${oe.resolvedValueTypeId||"unknown"})`}]})}for(const[Q,Ae]of y)if(!v.has(Q)){const oe=Ae;r.push({type:"removed",entityType:"token",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"token",oldValue:`Removed token: ${oe.displayName||Q}`}]})}for(const[Q,Ae]of v){const oe=y.get(Q);if(oe){const Ne=[],st=Ae,tt=oe;["displayName","description","tokenTier","status","themeable","private"].forEach(et=>{tt[et]!==st[et]&&Ne.push({field:et,oldValue:ur(tt[et]),newValue:ur(st[et])})});const We=Qk(tt.valuesByMode||[],st.valuesByMode||[]);Ne.push(...We);const lt=tt.valuesByMode||[],Et=st.valuesByMode||[];if(lt.length>0||Et.length>0)for(let et=0;et<Math.max(lt.length,Et.length);et++){const pt=lt[et],Wt=Et[et];if(pt!=null&&pt.platformOverrides||Wt!=null&&Wt.platformOverrides){const In=eI((pt==null?void 0:pt.platformOverrides)||[],(Wt==null?void 0:Wt.platformOverrides)||[]);Ne.push(...In)}}Ne.length>0&&r.push({type:"modified",entityType:"token",entityId:Q,entityName:st.displayName||Q,changes:Ne})}}const I=t.themes||[],S=e.themes||[],b=new Map,k=new Map;I.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&b.set(Ae.id,Ae)}}),S.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&k.set(Ae.id,Ae)}});for(const[Q,Ae]of k)if(b.has(Q)){const oe=b.get(Q),Ne=[],st=oe,tt=Ae;["displayName","description","isDefault"].forEach(Ie=>{st[Ie]!==tt[Ie]&&Ne.push({field:Ie,oldValue:ur(st[Ie]),newValue:ur(tt[Ie])})}),Ne.length>0&&r.push({type:"modified",entityType:"theme",entityId:Q,entityName:tt.displayName||Q,changes:Ne})}else{const oe=Ae;r.push({type:"added",entityType:"theme",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"theme",newValue:`Added theme: ${oe.displayName||Q}`}]})}for(const[Q,Ae]of b)if(!k.has(Q)){const oe=Ae;r.push({type:"removed",entityType:"theme",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"theme",oldValue:`Removed theme: ${oe.displayName||Q}`}]})}const A=t.dimensions||[],C=e.dimensions||[],T=new Map,P=new Map;A.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&T.set(Ae.id,Ae)}}),C.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&P.set(Ae.id,Ae)}});for(const[Q,Ae]of P)if(T.has(Q)){const oe=T.get(Q),Ne=[],st=oe,tt=Ae;["displayName","description","required","defaultMode"].forEach(We=>{st[We]!==tt[We]&&Ne.push({field:We,oldValue:ur(st[We]),newValue:ur(tt[We])})});const Ie=Ry(st.modes||[],tt.modes||[]);Ne.push(...Ie),Ne.length>0&&r.push({type:"modified",entityType:"dimension",entityId:Q,entityName:tt.displayName||Q,changes:Ne})}else{const oe=Ae;r.push({type:"added",entityType:"dimension",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"dimension",newValue:`Added dimension: ${oe.displayName||Q}`}]})}for(const[Q,Ae]of T)if(!P.has(Q)){const oe=Ae;r.push({type:"removed",entityType:"dimension",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"dimension",oldValue:`Removed dimension: ${oe.displayName||Q}`}]})}const _=t.resolvedValueTypes||[],R=e.resolvedValueTypes||[],G=new Map,ne=new Map;_.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&G.set(Ae.id,Ae)}}),R.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&ne.set(Ae.id,Ae)}});for(const[Q,Ae]of ne)if(G.has(Q)){const oe=G.get(Q),Ne=[],st=oe,tt=Ae;["displayName","description","type"].forEach(Ie=>{st[Ie]!==tt[Ie]&&Ne.push({field:Ie,oldValue:ur(st[Ie]),newValue:ur(tt[Ie])})}),Ne.length>0&&r.push({type:"modified",entityType:"resolvedValueType",entityId:Q,entityName:tt.displayName||Q,changes:Ne})}else{const oe=Ae;r.push({type:"added",entityType:"resolvedValueType",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"resolvedValueType",newValue:`Added value type: ${oe.displayName||Q}`}]})}for(const[Q,Ae]of G)if(!ne.has(Q)){const oe=Ae;r.push({type:"removed",entityType:"resolvedValueType",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"resolvedValueType",oldValue:`Removed value type: ${oe.displayName||Q}`}]})}const he=t.taxonomies||[],te=e.taxonomies||[],K=new Map,O=new Map;he.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&K.set(Ae.id,Ae)}}),te.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&O.set(Ae.id,Ae)}});for(const[Q,Ae]of O)if(K.has(Q)){const oe=K.get(Q),Ne=[],st=oe,tt=Ae;["name","description"].forEach(We=>{st[We]!==tt[We]&&Ne.push({field:We,oldValue:ur(st[We]),newValue:ur(tt[We])})});const Ie=Ry(st.terms||[],tt.terms||[]);Ne.push(...Ie),Ne.length>0&&r.push({type:"modified",entityType:"taxonomy",entityId:Q,entityName:tt.name||Q,changes:Ne})}else{const oe=Ae;r.push({type:"added",entityType:"taxonomy",entityId:Q,entityName:oe.name||Q,changes:[{field:"taxonomy",newValue:`Added taxonomy: ${oe.name||Q}`}]})}for(const[Q,Ae]of K)if(!O.has(Q)){const oe=Ae;r.push({type:"removed",entityType:"taxonomy",entityId:Q,entityName:oe.name||Q,changes:[{field:"taxonomy",oldValue:`Removed taxonomy: ${oe.name||Q}`}]})}const Z=t.algorithms||[],ie=e.algorithms||[],ge=new Map,xe=new Map;Z.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&ge.set(Ae.id,Ae)}}),ie.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&xe.set(Ae.id,Ae)}});for(const[Q,Ae]of xe)if(ge.has(Q)){const oe=ge.get(Q),Ne=[],st=oe,tt=Ae;["name","description","resolvedValueTypeId"].forEach(Ie=>{st[Ie]!==tt[Ie]&&Ne.push({field:Ie,oldValue:ur(st[Ie]),newValue:ur(tt[Ie])})}),Ne.length>0&&r.push({type:"modified",entityType:"algorithm",entityId:Q,entityName:tt.name||Q,changes:Ne})}else{const oe=Ae;r.push({type:"added",entityType:"algorithm",entityId:Q,entityName:oe.name||Q,changes:[{field:"algorithm",newValue:`Added algorithm: ${oe.name||Q}`}]})}for(const[Q,Ae]of ge)if(!xe.has(Q)){const oe=Ae;r.push({type:"removed",entityType:"algorithm",entityId:Q,entityName:oe.name||Q,changes:[{field:"algorithm",oldValue:`Removed algorithm: ${oe.name||Q}`}]})}const $=t.componentProperties||[],B=e.componentProperties||[],U=new Map,X=new Map;$.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&U.set(Ae.id,Ae)}}),B.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&X.set(Ae.id,Ae)}});for(const[Q,Ae]of X)if(U.has(Q)){const oe=U.get(Q),Ne=[],st=oe,tt=Ae;if(["displayName","description","type","default"].forEach(Ie=>{st[Ie]!==tt[Ie]&&Ne.push({field:Ie,oldValue:ur(st[Ie]),newValue:ur(tt[Ie])})}),tt.type==="list"){const Ie=st.options||[],We=tt.options||[],lt=new Map,Et=new Map;Ie.forEach(et=>{if(typeof et=="object"&&et!==null){const pt=et;pt.id&&lt.set(pt.id,pt)}}),We.forEach(et=>{if(typeof et=="object"&&et!==null){const pt=et;pt.id&&Et.set(pt.id,pt)}});for(const[et,pt]of Et)if(lt.has(et)){const In=lt.get(et),Mn=pt;["displayName","description"].forEach(An=>{In[An]!==Mn[An]&&Ne.push({field:`options.${An}`,oldValue:ur(In[An]),newValue:ur(Mn[An]),context:`Option: ${Mn.displayName||et}`})})}else{const Wt=pt;Ne.push({field:"options",newValue:`Added option: ${Wt.displayName||et}`,context:"Component property option"})}for(const[et,pt]of lt)if(!Et.has(et)){const Wt=pt;Ne.push({field:"options",oldValue:`Removed option: ${Wt.displayName||et}`,context:"Component property option"})}}Ne.length>0&&r.push({type:"modified",entityType:"componentProperty",entityId:Q,entityName:tt.displayName||Q,changes:Ne})}else{const oe=Ae;r.push({type:"added",entityType:"componentProperty",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"componentProperty",newValue:`Added component property: ${oe.displayName||Q} (${oe.type||"unknown"})`}]})}for(const[Q,Ae]of U)if(!X.has(Q)){const oe=Ae;r.push({type:"removed",entityType:"componentProperty",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"componentProperty",oldValue:`Removed component property: ${oe.displayName||Q}`}]})}const ee=t.componentCategories||[],be=e.componentCategories||[],Se=new Map,Me=new Map;ee.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&Se.set(Ae.id,Ae)}}),be.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&Me.set(Ae.id,Ae)}});for(const[Q,Ae]of Me)if(!Se.has(Q)){const oe=Ae;r.push({type:"added",entityType:"componentCategory",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"componentCategory",newValue:`Added component category: ${oe.displayName||Q}`}]})}for(const[Q,Ae]of Se)if(!Me.has(Q)){const oe=Ae;r.push({type:"removed",entityType:"componentCategory",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"componentCategory",oldValue:`Removed component category: ${oe.displayName||Q}`}]})}const se=t.components||[],de=e.components||[],fe=new Map,_e=new Map;se.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&fe.set(Ae.id,Ae)}}),de.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&_e.set(Ae.id,Ae)}});for(const[Q,Ae]of _e)if(fe.has(Q)){const oe=fe.get(Q),Ne=[],st=oe,tt=Ae;["displayName","description","componentCategoryId"].forEach(lt=>{st[lt]!==tt[lt]&&Ne.push({field:lt,oldValue:ur(st[lt]),newValue:ur(tt[lt])})});const Ie=st.componentProperties||[],We=tt.componentProperties||[];Ie.length!==We.length&&Ne.push({field:"componentProperties",oldValue:`${Ie.length} properties`,newValue:`${We.length} properties`}),Ne.length>0&&r.push({type:"modified",entityType:"component",entityId:Q,entityName:tt.displayName||Q,changes:Ne})}else{const oe=Ae;r.push({type:"added",entityType:"component",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"component",newValue:`Added component: ${oe.displayName||Q} (Category: ${oe.componentCategoryId||"unknown"})`}]})}for(const[Q,Ae]of fe)if(!_e.has(Q)){const oe=Ae;r.push({type:"removed",entityType:"component",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"component",oldValue:`Removed component: ${oe.displayName||Q}`}]})}const Y=t.platformExtensions||{},Ce=e.platformExtensions||{},ue=Object.keys(Y),Ee=Object.keys(Ce);for(const Q of Ee)if(ue.includes(Q)){const Ae=Y[Q],oe=Ce[Q],Ne=[],st=Ae.metadata||{},tt=oe.metadata||{};["name","description","maintainer","lastUpdated"].forEach(Be=>{st[Be]!==tt[Be]&&Ne.push({field:`metadata.${Be}`,oldValue:ur(st[Be]),newValue:ur(tt[Be])})}),Ae.version!==oe.version&&Ne.push({field:"version",oldValue:ur(Ae.version),newValue:ur(oe.version)});const Ie=Ae.syntaxPatterns||{},We=oe.syntaxPatterns||{};["prefix","suffix","delimiter","capitalization","formatString"].forEach(Be=>{Ie[Be]!==We[Be]&&Ne.push({field:`syntaxPatterns.${Be}`,oldValue:ur(Ie[Be]),newValue:ur(We[Be])})});const lt=Ae.valueFormatters||{},Et=oe.valueFormatters||{};["color","dimension","numberPrecision"].forEach(Be=>{lt[Be]!==Et[Be]&&Ne.push({field:`valueFormatters.${Be}`,oldValue:ur(lt[Be]),newValue:ur(Et[Be])})});const et=Ae.algorithmVariableOverrides||[],pt=oe.algorithmVariableOverrides||[];et.length!==pt.length&&Ne.push({field:"algorithmVariableOverrides",oldValue:`${et.length} overrides`,newValue:`${pt.length} overrides`});const Wt=Ae.tokenOverrides||[],In=oe.tokenOverrides||[];Wt.length!==In.length&&Ne.push({field:"tokenOverrides",oldValue:`${Wt.length} overrides`,newValue:`${In.length} overrides`});const Mn=Ae.omittedModes||[],An=oe.omittedModes||[];JSON.stringify(Mn.sort())!==JSON.stringify(An.sort())&&Ne.push({field:"omittedModes",oldValue:Mn.length>0?Mn.join(", "):"none",newValue:An.length>0?An.join(", "):"none"});const ts=Ae.omittedDimensions||[],jn=oe.omittedDimensions||[];if(JSON.stringify(ts.sort())!==JSON.stringify(jn.sort())&&Ne.push({field:"omittedDimensions",oldValue:ts.length>0?ts.join(", "):"none",newValue:jn.length>0?jn.join(", "):"none"}),Ne.length>0){const w=(oe.metadata||{}).name||oe.platformId||Q;r.push({type:"modified",entityType:"platformExtension",entityId:Q,entityName:w,changes:Ne})}}else{const Ae=Ce[Q],oe=((Ct=Ae.metadata)==null?void 0:Ct.name)||Ae.platformId||Q;r.push({type:"added",entityType:"platformExtension",entityId:Q,entityName:oe,changes:[{field:"platformExtension",newValue:`Added platform extension: ${oe}`}]})}for(const Q of ue)if(!Ee.includes(Q)){const Ae=Y[Q],oe=((Qt=Ae.metadata)==null?void 0:Qt.name)||Ae.platformId||Q;r.push({type:"removed",entityType:"platformExtension",entityId:Q,entityName:oe,changes:[{field:"platformExtension",oldValue:`Removed platform extension: ${oe}`}]})}const ze=t.platformExtensionFiles||{},De=e.platformExtensionFiles||{},Ke=Object.keys(ze),ve=Object.keys(De);for(const Q of ve)if(Ke.includes(Q)){const Ae=ze[Q],oe=De[Q],Ne=[],st=Ae.metadata||{},tt=oe.metadata||{};["name","description","maintainer","lastUpdated"].forEach(et=>{st[et]!==tt[et]&&Ne.push({field:`metadata.${et}`,oldValue:ur(st[et]),newValue:ur(tt[et])})}),Ae.version!==oe.version&&Ne.push({field:"version",oldValue:ur(Ae.version),newValue:ur(oe.version)});const Ie=Ae.syntaxPatterns||{},We=oe.syntaxPatterns||{};["prefix","suffix","delimiter","capitalization","formatString"].forEach(et=>{Ie[et]!==We[et]&&Ne.push({field:`syntaxPatterns.${et}`,oldValue:ur(Ie[et]),newValue:ur(We[et])})});const lt=Ae.valueFormatters||{},Et=oe.valueFormatters||{};if(["color","dimension","numberPrecision"].forEach(et=>{lt[et]!==Et[et]&&Ne.push({field:`valueFormatters.${et}`,oldValue:ur(lt[et]),newValue:ur(Et[et])})}),Ne.length>0){const pt=(oe.metadata||{}).name||oe.platformId||Q;r.push({type:"modified",entityType:"platformExtensionFile",entityId:Q,entityName:pt,changes:Ne})}}else{const Ae=De[Q],oe=((Zt=Ae.metadata)==null?void 0:Zt.name)||Ae.platformId||Q;r.push({type:"added",entityType:"platformExtensionFile",entityId:Q,entityName:oe,changes:[{field:"platformExtensionFile",newValue:`Added platform extension file: ${oe}`}]})}for(const Q of Ke)if(!ve.includes(Q)){const Ae=ze[Q],oe=((at=Ae.metadata)==null?void 0:at.name)||Ae.platformId||Q;r.push({type:"removed",entityType:"platformExtensionFile",entityId:Q,entityName:oe,changes:[{field:"platformExtensionFile",oldValue:`Removed platform extension file: ${oe}`}]})}const Te=t.platforms||[],je=e.platforms||[],Fe=new Map,Ue=new Map;Te.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&Fe.set(Ae.id,Ae)}}),je.forEach(Q=>{if(typeof Q=="object"&&Q!==null){const Ae=Q;Ae.id&&Ue.set(Ae.id,Ae)}});for(const[Q,Ae]of Ue)if(Fe.has(Q)){const oe=Fe.get(Q),Ne=[],st=oe,tt=Ae;["displayName","description"].forEach(Wt=>{st[Wt]!==tt[Wt]&&Ne.push({field:Wt,oldValue:ur(st[Wt]),newValue:ur(tt[Wt])})});const Ie=st.syntaxPatterns||{},We=tt.syntaxPatterns||{};["prefix","suffix","delimiter","capitalization","formatString"].forEach(Wt=>{Ie[Wt]!==We[Wt]&&Ne.push({field:`syntaxPatterns.${Wt}`,oldValue:ur(Ie[Wt]),newValue:ur(We[Wt])})});const lt=st.valueFormatters||{},Et=tt.valueFormatters||{};["color","dimension","numberPrecision"].forEach(Wt=>{lt[Wt]!==Et[Wt]&&Ne.push({field:`valueFormatters.${Wt}`,oldValue:ur(lt[Wt]),newValue:ur(Et[Wt])})});const et=st.extensionSource,pt=tt.extensionSource;!et&&pt?Ne.push({field:"extensionSource",newValue:`Linked to extension: ${pt.repositoryUri||"unknown"} - ${pt.filePath||"unknown"}`}):et&&!pt?Ne.push({field:"extensionSource",oldValue:`Unlinked from extension: ${et.repositoryUri||"unknown"} - ${et.filePath||"unknown"}`}):et&&pt&&(et.repositoryUri!==pt.repositoryUri||et.filePath!==pt.filePath)&&Ne.push({field:"extensionSource",oldValue:`${et.repositoryUri||"unknown"} - ${et.filePath||"unknown"}`,newValue:`${pt.repositoryUri||"unknown"} - ${pt.filePath||"unknown"}`}),Ne.length>0&&r.push({type:"modified",entityType:"platform",entityId:Q,entityName:tt.displayName||Q,changes:Ne})}else{const oe=Ae;r.push({type:"added",entityType:"platform",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"platform",newValue:`Added platform: ${oe.displayName||Q}`}]})}for(const[Q,Ae]of Fe)if(!Ue.has(Q)){const oe=Ae;r.push({type:"removed",entityType:"platform",entityId:Q,entityName:oe.displayName||Q,changes:[{field:"platform",oldValue:`Removed platform: ${oe.displayName||Q}`}]})}const Je=t.taxonomyOrder||[],ut=e.taxonomyOrder||[];JSON.stringify(Je)!==JSON.stringify(ut)&&r.push({type:"modified",entityType:"taxonomy",entityId:"taxonomyOrder",entityName:"Taxonomy Order",changes:[{field:"taxonomyOrder",oldValue:Je.length>0?Je.join(", "):"none",newValue:ut.length>0?ut.join(", "):"none",context:"Taxonomy ordering for code syntax generation"}]});const Ze=t.dimensionOrder||[],At=e.dimensionOrder||[];JSON.stringify(Ze)!==JSON.stringify(At)&&r.push({type:"modified",entityType:"dimension",entityId:"dimensionOrder",entityName:"Dimension Order",changes:[{field:"dimensionOrder",oldValue:Ze.length>0?Ze.join(", "):"none",newValue:At.length>0?At.join(", "):"none",context:"Dimension ordering for token structure generation"}]});const gr=t.figmaConfiguration||{},vr=e.figmaConfiguration||{};gr.fileKey!==vr.fileKey&&r.push({type:"modified",entityType:"figmaConfiguration",entityId:"figmaConfiguration",entityName:"Figma Configuration",changes:[{field:"fileKey",oldValue:ur(gr.fileKey),newValue:ur(vr.fileKey),context:"Figma file key for publishing"}]});const yr=gr.syntaxPatterns||{},gt=vr.syntaxPatterns||{};return["prefix","suffix","delimiter","capitalization","formatString"].forEach(Q=>{yr[Q]!==gt[Q]&&r.push({type:"modified",entityType:"figmaConfiguration",entityId:"figmaConfiguration",entityName:"Figma Configuration",changes:[{field:`syntaxPatterns.${Q}`,oldValue:ur(yr[Q]),newValue:ur(gt[Q]),context:"Figma token naming patterns"}]})}),go.getPendingOverrides().forEach(Q=>{r.push({type:"modified",entityType:"token",entityId:Q.tokenId,entityName:`Token ${Q.tokenId} (${Q.sourceType})`,changes:[{field:"override",oldValue:"Original value",newValue:"Override value",context:`${Q.sourceType} override for ${Q.sourceId}`}]})}),r},Db=t=>{const{previousData:e,currentData:r}=t,{colorMode:n}=Vt(),[s,i]=M.useState([]);if(M.useEffect(()=>{const l=()=>{console.log("[ChangeLog] Updating changes...");const d=L.getSourceSnapshot(),u=L.getLocalEdits();if(console.log("[ChangeLog] Data sources:",{hasSourceSnapshot:!!d,hasLocalEdits:!!u,sourceSnapshotType:d?typeof d:"null",localEditsType:u?typeof u:"null"}),!d||!u){console.log("[ChangeLog] Missing data, clearing changes"),i([]);return}const m=d,g=u;console.log("[ChangeLog] Calling detectChanges with:",{previousDataKeys:Object.keys(m),currentDataKeys:Object.keys(g)});const y=Nb(m,g);console.log("[ChangeLog] Detected changes:",y.length),i(y)};l();const c=()=>{console.log("[ChangeLog] Received local-edits-changed event"),l()};return window.addEventListener("token-model:local-edits-changed",c),()=>{window.removeEventListener("token-model:local-edits-changed",c)}},[]),s.length===0)return o.jsx(z,{p:4,textAlign:"center",children:o.jsx(E,{color:"gray.500",children:"No changes detected"})});const a=s.reduce((l,c)=>(l[c.entityType]||(l[c.entityType]=[]),l[c.entityType].push(c),l),{});return o.jsxs(z,{children:[o.jsxs(E,{fontSize:"md",fontWeight:"bold",mb:4,children:["Changes (",s.length," changes)"]}),o.jsx(Nv,{allowMultiple:!0,children:Object.entries(a).map(([l,c])=>{const d=Zk(l),u=l.charAt(0).toUpperCase()+l.slice(1);return o.jsxs(Dv,{children:[o.jsxs(Rv,{children:[o.jsxs(le,{flex:"1",justify:"flex-start",children:[o.jsx(d,{size:16}),o.jsx(E,{fontWeight:"medium",children:u}),o.jsx(wt,{colorScheme:"blue",ml:"auto",children:c.length})]}),o.jsx(Ov,{})]}),o.jsx(_v,{children:o.jsx(ce,{spacing:3,align:"stretch",children:c.map((m,g)=>{const y=Xk(m.type),v=m.type==="added"?"green":m.type==="removed"?"red":"orange";return o.jsxs(z,{p:3,border:"1px",borderColor:n==="dark"?"gray.600":"gray.200",borderRadius:"md",bg:n==="dark"?"gray.700":"gray.50",children:[o.jsxs(le,{spacing:2,mb:2,children:[o.jsx(y,{size:16,color:v==="green"?"#22c55e":v==="red"?"#ef4444":"#f97316"}),o.jsx(wt,{colorScheme:v,size:"sm",children:m.type.toUpperCase()}),o.jsx(E,{fontWeight:"medium",fontSize:"sm",children:m.entityName})]}),o.jsx(ce,{spacing:1,align:"stretch",children:m.changes.map((I,S)=>o.jsxs(z,{pl:4,children:[I.context&&o.jsx(E,{fontSize:"xs",color:"gray.500",mb:1,children:I.context}),I.oldValue!==void 0&&I.oldValue!==null&&o.jsxs(E,{fontSize:"sm",color:"red.500",children:[o.jsx(E,{as:"span",fontWeight:"medium",children:"-"})," ",String(ur(I.oldValue))]}),I.newValue!==void 0&&I.newValue!==null&&o.jsxs(E,{fontSize:"sm",color:"green.500",children:[o.jsx(E,{as:"span",fontWeight:"medium",children:"+"})," ",String(ur(I.newValue))]})]},S))})]},`${m.entityId}-${g}`)})})})]},l)})})]})};class Rp{static async searchRepositories(e,r=1){const n=`search:${e}:${r}`,s=this.cache.get(n);if(s&&Date.now()-s.timestamp<this.CACHE_DURATION)return console.log(`[GitHubSearchService] Returning cached search results for: ${e}`),{results:s.data,totalCount:s.data.length,hasNextPage:!1};console.log(`[GitHubSearchService] Searching GitHub for: ${e} (page: ${r})`);try{let i=null;try{i=await Yt.getValidAccessToken(),console.log("[GitHubSearchService] Using authenticated search (includes private repositories)")}catch{console.log("[GitHubSearchService] No valid access token, using public API (public repositories only)")}const a=10,l=`https://api.github.com/search/repositories?q=${encodeURIComponent(e)}&page=${r}&per_page=${a}&sort=updated&order=desc`,c={Accept:"application/vnd.github.v3+json"};i&&(c.Authorization=`token ${i}`);const d=await fetch(l,{headers:c});if(!d.ok)throw new Error(`GitHub API error: ${d.status} ${d.statusText}`);const u=await d.json(),m=u.items;console.log(`[GitHubSearchService] Found ${m.length} repositories`);const g=[];for(const y of m)try{const v=await this.findSchemaFiles(y.full_name,y.default_branch,i||void 0);if(v.length>0){const I=await this.checkPermissions(y.full_name,i||void 0);g.push({repository:y,schemaFiles:v,permissions:I})}}catch(v){console.warn(`[GitHubSearchService] Error processing repository ${y.full_name}:`,v)}return this.cache.set(n,{data:g,timestamp:Date.now()}),{results:g,totalCount:u.total_count,hasNextPage:r*a<u.total_count}}catch(i){throw console.error("[GitHubSearchService] Search failed:",i),i}}static async searchByUrl(e){try{const r=e.match(/github\.com\/([^/]+\/[^/]+)/);if(!r)throw new Error("Invalid GitHub repository URL");const n=r[1];console.log(`[GitHubSearchService] Searching by URL: ${n}`);let s=null;try{s=await Yt.getValidAccessToken(),console.log("[GitHubSearchService] Using authenticated URL search")}catch{console.log("[GitHubSearchService] No valid access token, using public API for URL search")}const i={Accept:"application/vnd.github.v3+json"};s&&(i.Authorization=`token ${s}`);const a=await fetch(`https://api.github.com/repos/${n}`,{headers:i});if(!a.ok)throw a.status===404?new Error("Repository not found"):new Error(`GitHub API error: ${a.status} ${a.statusText}`);const l=await a.json(),c=await this.findSchemaFiles(n,l.default_branch,s||void 0),d=await this.checkPermissions(n,s||void 0);return{repository:l,schemaFiles:c,permissions:d}}catch(r){throw console.error("[GitHubSearchService] URL search failed:",r),r}}static async findSchemaFiles(e,r,n){console.log(`[GitHubSearchService] Scanning repository ${e} for schema files`);try{let s=n,i=!1;if(s)i=!0;else try{s=await Yt.getValidAccessToken(),i=!0}catch{console.log("[GitHubSearchService] No access token available, using public API for repository scan"),i=!1}const a=i?await this.getAllJsonFiles(e,r,s):await this.getAllPublicJsonFiles(e,r);console.log(`[GitHubSearchService] Found ${a.length} JSON files in ${e}`);const l=[];for(const c of a)try{const d=i?await xt.getFileContent(e,c.path,r):await xt.getPublicFileContent(e,c.path,r);this.identifySchemaFile(d.content)==="schema"&&l.push({path:c.path,name:c.name,size:c.size,lastModified:c.lastModified||new Date().toISOString(),repository:e,branch:r})}catch(d){console.warn(`[GitHubSearchService] Error checking file ${c.path}:`,d)}return console.log(`[GitHubSearchService] Found ${l.length} schema files in ${e}`),l}catch(s){throw console.error(`[GitHubSearchService] Error scanning repository ${e}:`,s),s}}static async checkPermissions(e,r){try{let n=r;if(!n)try{n=await Yt.getValidAccessToken()}catch{return{canEdit:!1,canView:!0,reason:"Public repository - sign in for edit access"}}const s=await xt.hasWriteAccessToRepository(e);return{canEdit:s,canView:!0,reason:s?"You have write access":"View-only access"}}catch(n){return console.warn(`[GitHubSearchService] Error checking permissions for ${e}:`,n),{canEdit:!1,canView:!0,reason:"Permission check failed"}}}static async getAllJsonFiles(e,r,n,s=""){const i=`https://api.github.com/repos/${e}/contents/${s}?ref=${r}`,a=await fetch(i,{headers:{Authorization:`token ${n}`,Accept:"application/vnd.github.v3+json"}});if(!a.ok)throw new Error(`Failed to fetch directory contents: ${a.statusText}`);const l=await a.json(),c=[];for(const d of l)if(d.type==="file"&&d.name.endsWith(".json"))c.push({path:d.path,name:d.name,size:d.size,lastModified:d.updated_at});else if(d.type==="dir"){const u=await this.getAllJsonFiles(e,r,n,d.path);c.push(...u)}return c}static async getAllPublicJsonFiles(e,r,n=""){const s=`https://api.github.com/repos/${e}/contents/${n}?ref=${r}`,i=await fetch(s,{headers:{Accept:"application/vnd.github.v3+json"}});if(!i.ok)throw new Error(`Failed to fetch directory contents: ${i.statusText}`);const a=await i.json(),l=[];for(const c of a)if(c.type==="file"&&c.name.endsWith(".json"))l.push({path:c.path,name:c.name,size:c.size,lastModified:c.updated_at});else if(c.type==="dir"){const d=await this.getAllPublicJsonFiles(e,r,c.path);l.push(...d)}return l}static identifySchemaFile(e){try{const r=JSON.parse(e),n=r.systemName&&r.systemId&&r.tokenCollections&&r.dimensions&&r.tokens&&r.platforms&&r.version&&r.versionHistory&&r.componentCategories&&r.components,s=!r.platformId,i=!r.themeId;return n&&s&&i?(console.log("[GitHubSearchService] File identified as schema-compliant:",{hasSystemName:!!r.systemName,hasSystemId:!!r.systemId,hasTokenCollections:!!r.tokenCollections,hasDimensions:!!r.dimensions,hasTokens:!!r.tokens,hasPlatforms:!!r.platforms,hasVersion:!!r.version,hasVersionHistory:!!r.versionHistory,hasComponentCategories:!!r.componentCategories,hasComponents:!!r.components,hasThemes:!!r.themes}),"schema"):(console.log("[GitHubSearchService] File NOT identified as schema-compliant:",{hasRequiredProperties:n,isNotPlatformExtension:s,isNotThemeOverride:i,hasSystemName:!!r.systemName,hasSystemId:!!r.systemId,hasTokenCollections:!!r.tokenCollections,hasDimensions:!!r.dimensions,hasTokens:!!r.tokens,hasPlatforms:!!r.platforms,hasVersion:!!r.version,hasVersionHistory:!!r.versionHistory,hasComponentCategories:!!r.componentCategories,hasComponents:!!r.components,hasThemes:!!r.themes}),"unknown")}catch(r){return console.warn("[GitHubSearchService] JSON parse error in identifySchemaFile:",r instanceof Error?r.message:"Unknown error"),"unknown"}}static clearCache(){this.cache.clear(),console.log("[GitHubSearchService] Cache cleared")}static getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}}rt(Rp,"cache",new Map),rt(Rp,"CACHE_DURATION",5*60*1e3);const Rb=({isOpen:t,onClose:e,onDesignSystemSelected:r})=>{const[n,s]=M.useState(""),[i,a]=M.useState(null),[l,c]=M.useState(!1),[d,u]=M.useState(null),[m,g]=M.useState(null),y=Hr(),{colorMode:v}=Vt(),I=v==="dark"?"gray.800":"white",S=v==="dark"?"gray.700":"gray.200";M.useEffect(()=>{t&&(s(""),a(null),u(null),g(null))},[t]);const b=async()=>{if(!n.trim()){u("Please enter a GitHub repository URL");return}c(!0),u(null);try{const T=await Rp.searchByUrl(n);T?a(T):(u("This repository does not have Design System Foundry compliant data"),a(null))}catch(T){console.error("URL load failed:",T),u(T instanceof Error?T.message:"Failed to load repository"),a(null)}finally{c(!1)}},k=()=>{m&&(r(m.repo,m.file.path),e(),y({title:"Design System Loaded",description:`Successfully loaded ${m.file.name} from ${m.repo}`,status:"success",duration:3e3,isClosable:!0}))},A=T=>{if(T===0)return"0 B";const P=1024,_=["B","KB","MB","GB"],R=Math.floor(Math.log(T)/Math.log(P));return parseFloat((T/Math.pow(P,R)).toFixed(1))+" "+_[R]},C=T=>new Date(T).toLocaleDateString();return o.jsxs(Zr,{isOpen:t,onClose:e,size:"xl",scrollBehavior:"inside",children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:"Load Design System from URL"}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:2,children:"Enter GitHub Repository URL"}),o.jsxs(le,{children:[o.jsx(yt,{placeholder:"https://github.com/owner/repository",value:n,onChange:T=>s(T.target.value),onKeyPress:T=>T.key==="Enter"&&b(),bg:I}),o.jsx(Oe,{onClick:b,isLoading:l,loadingText:"Loading",children:"Load"})]}),o.jsx(E,{fontSize:"xs",color:"gray.500",mt:1,children:"Paste a GitHub repository URL to find design system files"})]}),d&&o.jsxs(zt,{status:"error",children:[o.jsx(Lt,{}),o.jsxs(z,{children:[o.jsx(oo,{children:"Load Error"}),o.jsx(tn,{children:d})]})]}),i&&o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",color:"gray.500",mb:3,children:"Found design system files"}),o.jsxs(z,{border:"1px",borderColor:S,borderRadius:"md",p:4,bg:I,children:[o.jsxs(le,{justify:"space-between",mb:3,children:[o.jsxs(le,{children:[o.jsx(dc,{size:"sm",src:i.repository.owner.avatar_url,name:i.repository.owner.login}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",children:i.repository.full_name}),o.jsx(E,{fontSize:"xs",color:"gray.500",children:i.repository.description||"No description"})]})]}),o.jsxs(le,{spacing:2,children:[o.jsx(wt,{colorScheme:i.permissions.canEdit?"green":"gray",variant:"subtle",fontSize:"xs",children:i.permissions.canEdit?"Can Edit":"View Only"}),o.jsx(Fv,{href:i.repository.html_url,isExternal:!0,children:o.jsx(Bt,{"aria-label":"View repository",icon:o.jsx(Bf,{size:14}),size:"xs",variant:"ghost"})})]})]}),o.jsxs(le,{spacing:4,mb:3,fontSize:"xs",color:"gray.500",children:[o.jsxs(le,{spacing:1,children:[o.jsx(Ik,{size:12}),o.jsx(E,{children:i.repository.stargazers_count})]}),o.jsxs(le,{spacing:1,children:[o.jsx(Gf,{size:12}),o.jsx(E,{children:i.repository.forks_count})]}),o.jsxs(le,{spacing:1,children:[o.jsx(GC,{size:12}),o.jsx(E,{children:C(i.repository.updated_at)})]})]}),o.jsx(on,{mb:3}),o.jsx(E,{fontSize:"sm",fontWeight:"semibold",mb:2,children:"Design System Files:"}),o.jsx(ce,{spacing:2,align:"stretch",children:i.schemaFiles.map(T=>o.jsx(z,{border:"1px",borderColor:(m==null?void 0:m.repo)===i.repository.full_name&&(m==null?void 0:m.file.path)===T.path?"blue.300":S,borderRadius:"md",p:3,cursor:"pointer",onClick:()=>g({repo:i.repository.full_name,file:T}),_hover:{bg:v==="dark"?"gray.700":"gray.50"},children:o.jsxs(le,{justify:"space-between",children:[o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",children:T.name}),o.jsxs(E,{fontSize:"xs",color:"gray.500",children:[T.path," â€¢ ",A(T.size)]})]}),o.jsx(E,{fontSize:"xs",color:"gray.500",children:C(T.lastModified)})]})},T.path))})]})]}),l&&o.jsxs(z,{textAlign:"center",py:8,children:[o.jsx(kn,{size:"lg"}),o.jsx(E,{mt:2,children:"Loading repository..."})]})]})}),o.jsx(rn,{children:o.jsxs(le,{spacing:3,children:[o.jsx(Oe,{variant:"ghost",onClick:e,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:k,isDisabled:!m,children:"Load Design System"})]})})]})]})},ya=class ya{constructor(){}static getInstance(){return ya.instance||(ya.instance=new ya),ya.instance}transformForTarget(e,r,n){console.log("[SchemaTransformer] Transforming data for schema:",r);let s,i;switch(r){case"platform-extension":s=this.transformToPlatformExtension(e,n),i=this.validatePlatformExtension(s);break;case"theme-override":s=this.transformToThemeOverride(e,n),i=this.validateThemeOverride(s);break;case"schema":default:s=this.transformToCoreSchema(e),i=this.validateCoreSchema(s);break}return{data:s,schemaType:r,validationResult:i}}transformToPlatformExtension(e,r){if(console.log("[SchemaTransformer] Transforming to platform extension schema"),!(r!=null&&r.sourceId))throw new Error("Platform source context required for platform extension transformation");const n=e.platforms.find(i=>i.id===r.sourceId);if(!n)throw new Error(`Platform with ID ${r.sourceId} not found in data`);return{systemId:e.systemId||"design-system",platformId:r.sourceId,version:n.version||"1.0.0",status:n.status||"active",figmaPlatformMapping:n.figmaPlatformMapping||null,figmaFileKey:n.figmaFileKey||`platform-${r.sourceId}`,fileColorProfile:n.fileColorProfile||"srgb",syntaxPatterns:n.syntaxPatterns||{},valueFormatters:n.valueFormatters||{},algorithmVariableOverrides:n.algorithmVariableOverrides||[],tokenOverrides:this.transformTokensForPlatform(e.tokens,r.sourceId),omittedModes:n.omittedModes||[],omittedDimensions:n.omittedDimensions||[],packageUri:n.packageUri||"",documentationUri:n.documentationUri||"",componentImplementations:n.componentImplementations||[]}}transformToThemeOverride(e,r){if(console.log("[SchemaTransformer] Transforming to theme override schema"),!(r!=null&&r.sourceId))throw new Error("Theme source context required for theme override transformation");const n=e.themes.find(i=>i.id===r.sourceId);if(!n)throw new Error(`Theme with ID ${r.sourceId} not found in data`);return{systemId:e.systemId||"design-system",themeId:r.sourceId,figmaFileKey:n.figmaFileKey||`theme-${r.sourceId}`,fileColorProfile:n.fileColorProfile||"srgb",tokenOverrides:this.transformTokensForTheme(e.tokens,r.sourceId)}}transformToCoreSchema(e){return console.log("[SchemaTransformer] Transforming to core schema"),{systemId:e.systemId||"design-system",systemName:e.systemName||"Design System",version:e.version||"1.0.0",tokenCollections:e.collections||[],dimensions:e.dimensions||[],tokens:e.tokens||[],platforms:e.platforms||[],themes:e.themes||[],taxonomies:e.taxonomies||[],resolvedValueTypes:e.resolvedValueTypes||[],componentProperties:e.componentProperties||[],componentCategories:e.componentCategories||[],components:e.components||[],taxonomyOrder:e.taxonomyOrder||[],versionHistory:e.versionHistory||[]}}transformTokensForPlatform(e,r){return e.filter(n=>!n.omit||!n.omit[r]).map(n=>{var s;return{id:n.id,displayName:n.displayName,description:n.description,themeable:n.themeable,private:n.private,status:n.status,tokenTier:n.tokenTier,resolvedValueTypeId:n.resolvedValueTypeId,generatedByAlgorithm:n.generatedByAlgorithm,algorithmId:n.algorithmId,taxonomies:n.taxonomies||[],propertyTypes:n.propertyTypes||[],valuesByMode:n.valuesByMode||[],omit:((s=n.omit)==null?void 0:s[r])||!1}})}transformTokensForTheme(e,r){return e.filter(n=>{var s;return(s=n.valuesByMode)==null?void 0:s.some(i=>{var a;return(a=i.platformOverrides)==null?void 0:a.some(l=>l.platformId===r)})}).map(n=>({tokenId:n.id,valuesByMode:n.valuesByMode.filter(s=>{var i;return(i=s.platformOverrides)==null?void 0:i.some(a=>a.platformId===r)}).map(s=>{var i;return{modeIds:s.modeIds,value:s.value,platformOverrides:((i=s.platformOverrides)==null?void 0:i.filter(a=>a.platformId===r))||[],metadata:s.metadata}})}))}validatePlatformExtension(e){const r=[],n=[];return e.systemId||r.push("systemId is required"),e.platformId||r.push("platformId is required"),e.version||r.push("version is required"),e.figmaFileKey||r.push("figmaFileKey is required"),e.figmaFileKey&&!/^[a-zA-Z0-9-_]+$/.test(e.figmaFileKey)&&r.push("figmaFileKey must match pattern ^[a-zA-Z0-9-_]+$"),e.status&&!["active","deprecated"].includes(e.status)&&r.push('status must be either "active" or "deprecated"'),e.figmaPlatformMapping&&!["WEB","iOS","ANDROID"].includes(e.figmaPlatformMapping)&&r.push("figmaPlatformMapping must be one of: WEB, iOS, ANDROID"),e.fileColorProfile&&!["srgb","display-p3"].includes(e.fileColorProfile)&&r.push('fileColorProfile must be either "srgb" or "display-p3"'),e.tokenOverrides&&!Array.isArray(e.tokenOverrides)&&r.push("tokenOverrides must be an array"),{isValid:r.length===0,errors:r,warnings:n}}validateThemeOverride(e){const r=[],n=[];return e.systemId||r.push("systemId is required"),e.themeId||r.push("themeId is required"),e.figmaFileKey&&!/^[a-zA-Z0-9-_]+$/.test(e.figmaFileKey)&&r.push("figmaFileKey must match pattern ^[a-zA-Z0-9-_]+$"),e.fileColorProfile&&!["srgb","display-p3"].includes(e.fileColorProfile)&&r.push('fileColorProfile must be either "srgb" or "display-p3"'),(!e.tokenOverrides||!Array.isArray(e.tokenOverrides))&&r.push("tokenOverrides is required and must be an array"),{isValid:r.length===0,errors:r,warnings:n}}validateCoreSchema(e){const r=[],n=[];return e.systemId||r.push("systemId is required"),e.systemName||r.push("systemName is required"),Array.isArray(e.tokenCollections)||r.push("tokenCollections must be an array"),Array.isArray(e.dimensions)||r.push("dimensions must be an array"),Array.isArray(e.tokens)||r.push("tokens must be an array"),Array.isArray(e.platforms)||r.push("platforms must be an array"),Array.isArray(e.themes)||r.push("themes must be an array"),Array.isArray(e.taxonomies)||r.push("taxonomies must be an array"),Array.isArray(e.resolvedValueTypes)||r.push("resolvedValueTypes must be an array"),{isValid:r.length===0,errors:r,warnings:n}}validateForSchema(e,r){switch(r){case"platform-extension":return this.validatePlatformExtension(e);case"theme-override":return this.validateThemeOverride(e);case"schema":default:return this.validateCoreSchema(e)}}};rt(ya,"instance");let Op=ya;const xa=class xa{constructor(){rt(this,"repositoryContextService");this.repositoryContextService=ki.getInstance()}static getInstance(){return xa.instance||(xa.instance=new xa),xa.instance}getCurrentRepositoryInfo(){const e=this.repositoryContextService.getCurrentSourceContext();return console.log("[GitHubRepositoryService] Getting repository info from RepositoryContextService:",e),(e==null?void 0:e.repositoryInfo)||null}getCurrentSourceContext(){return this.repositoryContextService.getCurrentSourceContext()}isPlatformExtension(){const e=this.getCurrentSourceContext();return(e==null?void 0:e.sourceType)==="platform-extension"}isThemeOverride(){const e=this.getCurrentSourceContext();return(e==null?void 0:e.sourceType)==="theme-override"}isCoreData(){const e=this.getCurrentSourceContext();return(e==null?void 0:e.sourceType)==="core"}getCurrentSourceType(){const e=this.getCurrentSourceContext();return(e==null?void 0:e.sourceType)||"core"}getCurrentSchemaType(){const e=this.getCurrentSourceContext();return(e==null?void 0:e.schemaType)||"schema"}};rt(xa,"instance");let _p=xa;class nm{static async saveToGitHub(e={}){try{console.log("[GitHubSaveService] Starting save with options:",e);let r=null;if(e.sourceContext?(r=e.sourceContext,console.log("[GitHubSaveService] Using provided source context:",r)):(r=ri.getInstance().getContext(),r||(r=this.createSourceContextFromDataSource(e.dataSourceContext)),console.log("[GitHubSaveService] Using source context from manager:",r)),!r)throw new Error("No source context available. Please load a file from GitHub first.");if(!r.repositoryInfo)throw new Error("Invalid source context: missing repository information.");const s=Un.getInstance().getCurrentSnapshot(),i=Op.getInstance(),a=r.sourceId&&r.sourceName?{sourceId:r.sourceId,sourceName:r.sourceName}:void 0,l=i.transformForTarget(s,r.schemaType,a);if(console.log("[GitHubSaveService] Data transformed for schema:",r.schemaType),!l.validationResult.isValid){const g=`Schema validation failed: ${l.validationResult.errors.join(", ")}`;return console.error("[GitHubSaveService] Validation failed:",g),{success:!1,message:g,validationResult:l.validationResult}}const c=JSON.stringify(l.data,null,2),u=new Blob([c]).size/(1024*1024);if(u>=1)throw new Error(`File size (${u.toFixed(2)}MB) exceeds GitHub's 1MB limit. Please reduce the data size.`);u>=.9&&console.warn(`File size (${u.toFixed(2)}MB) is approaching GitHub's 1MB limit.`);const m=e.message||`Update ${r.repositoryInfo.filePath} - ${new Date().toLocaleString()}`;return e.createPullRequest&&e.targetBranch?await this.createPullRequestWithChanges({fullName:r.repositoryInfo.fullName,branch:r.repositoryInfo.branch,filePath:r.repositoryInfo.filePath,fileType:r.repositoryInfo.fileType},c,m,e.targetBranch,e.prTitle,e.prDescription):(await xt.createFile(r.repositoryInfo.fullName,r.repositoryInfo.filePath,c,m,r.repositoryInfo.branch),console.log("[GitHubSaveService] Direct save completed"),{success:!0,message:"Data saved successfully",branchName:r.repositoryInfo.branch,repositoryFullName:r.repositoryInfo.fullName,filePath:r.repositoryInfo.filePath,validationResult:l.validationResult})}catch(r){const n=r instanceof Error?r.message:"Unknown error during save";return console.error("[GitHubSaveService] Save failed:",n),{success:!1,message:n}}}static async createPullRequestWithChanges(e,r,n,s,i,a){const l=Date.now(),c=`update-${e.filePath.replace(/[^a-zA-Z0-9]/g,"-")}-${l}`;await xt.createBranch(e.fullName,e.branch,c),await xt.createFile(e.fullName,e.filePath,r,c,n);const d=`Update ${e.filePath}`,u=this.generatePullRequestDescription(e.fileType),m=await xt.createPullRequest(e.fullName,i||d,a||u,c,s);return Un.getInstance().resetBaselineToCurrent(),{success:!0,message:`Successfully created pull request #${m.number}`,pullRequestUrl:m.html_url}}static createSourceContextFromDataSource(e){var d,u;const n=_p.getInstance().getCurrentSourceContext();if(n)return console.log("[GitHubSaveService] Using centralized service for source context:",n),n;if(!e)return null;let s="core",i="schema",a=null,l=null,c=e.repositories.core;return e.currentPlatform&&e.currentPlatform!=="none"?(s="platform-extension",i="platform-extension",a=e.currentPlatform,l=((d=e.availablePlatforms.find(m=>m.id===a))==null?void 0:d.displayName)||null,c=e.repositories.platforms[a]):e.currentTheme&&e.currentTheme!=="none"&&(s="theme-override",i="theme-override",a=e.currentTheme,l=((u=e.availableThemes.find(m=>m.id===a))==null?void 0:u.displayName)||null,c=e.repositories.themes[a]),c?{sourceType:s,sourceId:a,sourceName:l,repositoryInfo:{fullName:c.fullName,branch:c.branch,filePath:c.filePath,fileType:c.fileType},schemaType:i}:null}static getCurrentDataForFileType(e,r){const n=Un.getInstance();switch(e){case"core":{const s=L.getRootData(),i=n.getCurrentSnapshot(),a=Array.from(Object.values(i.platformExtensions));return{tokenCollections:L.getCollections(),dimensions:L.getDimensions(),tokens:L.getTokens(),platforms:L.getPlatforms(),themes:L.getThemes(),taxonomies:L.getTaxonomies(),resolvedValueTypes:L.getValueTypes(),componentProperties:L.getComponentProperties(),componentCategories:L.getComponentCategories(),components:L.getComponents(),taxonomyOrder:L.getTaxonomyOrder(),versionHistory:s.versionHistory||[],systemName:s.systemName||"Design System",systemId:s.systemId||"design-system",description:s.description||"A comprehensive design system with tokens, dimensions, and themes",version:s.version||"1.0.0",figmaConfiguration:i.figmaConfiguration,platformExtensions:a}}case"platform-extension":{if(!r)throw new Error("Platform ID required for platform extension save");return n.getStorageDataForSource("platform-extension",r)}case"theme-override":{if(!r)throw new Error("Theme ID required for theme override save");return n.getStorageDataForSource("theme-override",r)}default:throw new Error(`Unsupported source type: ${e}`)}}static generatePullRequestDescription(e){const r=new Date().toISOString();let n=`## Changes Made

`;return n+=`- **File Type**: ${e==="schema"?"Core Data":"Theme Override"}
`,n+=`- **Timestamp**: ${r}
`,n+=`- **Generated By**: Token Model Manager

`,n+=`## Summary

`,n+="This pull request contains updates to the design system data. ",n+=`Please review the changes and ensure they align with the design system requirements.

`,n+=`## Change Log

`,n+=`- Data updated via Token Model Manager interface
`,n+=`- All changes validated against schema constraints
`,n+=`- File size verified within GitHub limits

`,n+=`## Next Steps

`,n+=`1. Review the changes in this pull request
`,n+=`2. Test the updated design system data
`,n+=`3. Merge if changes are approved
`,n}static hasUnsavedChanges(){return xt.getSelectedRepositoryInfo()!==null}static getFileSizeWarning(e){const r=JSON.stringify(e,null,2),s=new Blob([r]).size/(1024*1024);return s>=1?{warning:!1,error:!0,sizeMB:s,message:`File size (${s.toFixed(2)}MB) exceeds GitHub's 1MB limit`}:s>=.9?{warning:!0,error:!1,sizeMB:s,message:`File size (${s.toFixed(2)}MB) is approaching GitHub's 1MB limit`}:{warning:!1,error:!1,sizeMB:s}}}const tI=({isOpen:t,onClose:e,saveMode:r,onSuccess:n,currentBranch:s="main",isEditMode:i=!1,dataSourceContext:a})=>{const[l,c]=M.useState(""),[d,u]=M.useState(""),[m,g]=M.useState(""),[y,v]=M.useState(""),[I,S]=M.useState([]),[b,k]=M.useState(!1),[A,C]=M.useState(null),T=Hr(),P=()=>{const ie=ki.getInstance().getRepositoryInfo();return console.log("[GitHubSaveDialog] getRepositoryInfo - Using unified service:",ie),ie};M.useEffect(()=>{t&&(c(""),u(""),g(""),v(""),C(null),_(),R(),G())},[t,r]);const _=async()=>{try{const Z=P();if(!Z){console.error("No repository information available"),T({title:"Error",description:"No repository information available. Please ensure you have a valid repository connection.",status:"error",duration:5e3,isClosable:!0});return}const ie=await xt.getBranches(Z.fullName);S(ie);const ge=ie.find(xe=>xe.name==="main"||xe.name==="master")||ie[0];ge&&v(ge.name)}catch(Z){console.error("Failed to load branches:",Z),T({title:"Error",description:"Failed to load repository branches.",status:"error",duration:5e3,isClosable:!0})}},R=()=>{const Z=P();if(!Z)return;const ie=new Date().toLocaleString();c(`Update ${Z.filePath} - ${ie}`),u(`Update ${Z.filePath}`),g(`Update design system data in ${Z.filePath}

- Changes made via Token Model Manager
- Timestamp: ${ie}
- File type: ${Z.fileType==="schema"?"Core Data":Z.fileType==="platform-extension"?"Platform Extension":"Theme Override"}`)},G=()=>{const Z=P();if(!Z)return;const ie=nm.getCurrentDataForFileType(Z.fileType==="schema"?"core":Z.fileType==="platform-extension"?"platform-extension":"theme-override"),ge=nm.getFileSizeWarning(ie);C(ge)},ne=async()=>{k(!0);try{const ie=ki.getInstance().getCurrentSourceContext(),ge={message:l,createPullRequest:r==="pullRequest",targetBranch:r==="pullRequest"?y:void 0,prTitle:r==="pullRequest"?d:void 0,prDescription:r==="pullRequest"?m:void 0,dataSourceContext:a,sourceContext:ie||void 0},xe=await nm.saveToGitHub(ge);xe.success?(T({title:"Success",description:xe.message,status:"success",duration:5e3,isClosable:!0}),xe.pullRequestUrl&&window.open(xe.pullRequestUrl,"_blank"),n==null||n(xe),e()):T({title:"Error",description:xe.message,status:"error",duration:5e3,isClosable:!0})}catch(Z){console.error("Save failed:",Z),T({title:"Error",description:"Failed to save to GitHub.",status:"error",duration:5e3,isClosable:!0})}finally{k(!1)}},he=()=>{k(!1),c(""),u(""),g(""),v(""),C(null),e()},K=ki.getInstance().getCurrentSourceContext();console.log("[GitHubSaveDialog] Current source context:",K),console.log("[GitHubSaveDialog] dataSourceContext prop:",a);const O=P();return console.log("[GitHubSaveDialog] Final repository info for display:",O),o.jsxs(Zr,{isOpen:t,onClose:he,size:"xl",scrollBehavior:"inside",children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:r==="direct"?"Save to GitHub":"Create Pull Request"}),o.jsx(Or,{children:o.jsxs(ce,{spacing:6,align:"stretch",children:[O&&o.jsxs(z,{p:4,bg:"gray.50",borderRadius:"md",children:[o.jsxs(E,{fontWeight:"bold",children:["Repository: ",O.fullName]}),o.jsxs(E,{fontWeight:"medium",color:i?"blue.600":"gray.700",children:["Branch: ",s," ",i&&"(Editing)"]}),o.jsxs(E,{children:["File: ",O.filePath]}),o.jsxs(E,{children:["Type: ",O.fileType==="schema"?"Core Data":O.fileType==="platform-extension"?"Platform Extension":"Theme Override"]}),i&&o.jsx(E,{fontSize:"sm",color:"blue.600",mt:2,children:"ðŸ’¡ You're editing on a feature branch. Changes will be saved to this branch."})]}),A&&(A.warning||A.error)&&o.jsxs(zt,{status:A.error?"error":"warning",children:[o.jsx(Lt,{}),o.jsxs(z,{children:[o.jsx(oo,{children:"File Size Warning"}),o.jsx(tn,{children:A.message})]})]}),o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Commit Message"}),o.jsx(yt,{value:l,onChange:Z=>c(Z.target.value),placeholder:"Describe your changes..."})]}),r==="pullRequest"&&o.jsxs(o.Fragment,{children:[o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Target Branch"}),o.jsx(Kt,{value:y,onChange:Z=>v(Z.target.value),placeholder:"Select target branch",children:I.map(Z=>o.jsxs("option",{value:Z.name,children:[Z.name," ",Z.name===(O==null?void 0:O.branch)&&"(Current)"]},Z.name))})]}),o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Pull Request Title"}),o.jsx(yt,{value:d,onChange:Z=>u(Z.target.value),placeholder:"Pull request title..."})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Pull Request Description"}),o.jsx(Hu,{value:m,onChange:Z=>g(Z.target.value),placeholder:"Describe the changes in this pull request...",rows:6})]})]})]})}),o.jsx(rn,{children:o.jsxs(le,{spacing:3,children:[o.jsx(Oe,{variant:"ghost",onClick:he,isDisabled:b,children:"Cancel"}),o.jsx(Oe,{colorScheme:r==="direct"?"blue":"green",onClick:ne,isLoading:b,loadingText:r==="direct"?"Saving...":"Creating PR...",isDisabled:!l||r==="pullRequest"&&(!y||!d),children:r==="direct"?"Save to GitHub":"Create Pull Request"})]})})]})]})},rI=({availablePlatforms:t,currentPlatform:e,permissions:r,onPlatformChange:n})=>{const{colorMode:s}=Vt();if(t.length===0)return null;const i=a=>{const l=a.target.value;n(l==="none"?null:l)};return o.jsxs(le,{spacing:2,alignItems:"center",children:[o.jsx(bb,{size:16}),o.jsx(E,{fontSize:"sm",fontWeight:"medium",color:"gray.600",children:"Platform:"}),o.jsxs(Kt,{size:"sm",value:e||"none",onChange:i,minW:"150px",maxW:"200px",bg:s==="dark"?"gray.700":"white",borderColor:s==="dark"?"gray.600":"gray.300",children:[o.jsx("option",{value:"none",children:"None (Core Data)"}),t.map(a=>o.jsx("option",{value:a.id,children:a.displayName},a.id))]})]})},nI=({availableThemes:t,currentTheme:e,permissions:r,onThemeChange:n})=>{const{colorMode:s}=Vt();if(t.length===0)return null;const i=a=>{const l=a.target.value;n(l==="none"?null:l)};return o.jsxs(le,{spacing:2,alignItems:"center",children:[o.jsx(Ha,{size:16}),o.jsx(E,{fontSize:"sm",fontWeight:"medium",color:"gray.600",children:"Theme:"}),o.jsxs(Kt,{size:"sm",value:e||"none",onChange:i,minW:"150px",maxW:"200px",bg:s==="dark"?"gray.700":"white",borderColor:s==="dark"?"gray.600":"gray.300",children:[o.jsx("option",{value:"none",children:"None (Core Data)"}),t.map(a=>o.jsx("option",{value:a.id,children:a.displayName},a.id))]})]})},sI=t=>{if(!t||t.trim()==="")return{isValid:!1,error:"Branch name cannot be empty"};const e=t.trim();if(e.length>255)return{isValid:!1,error:"Branch name cannot exceed 255 characters"};if(/[~^:?*[\\]/.test(e))return{isValid:!1,error:"Branch name cannot contain ~, ^, :, ?, *, [, or \\"};if(e.includes(".."))return{isValid:!1,error:"Branch name cannot contain consecutive dots (..)"};if(e.startsWith("-")||e.startsWith("."))return{isValid:!1,error:"Branch name cannot start with - or ."};if(e.endsWith("/")||e.endsWith("."))return{isValid:!1,error:"Branch name cannot end with / or ."};for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);if(s>=0&&s<=31||s===127)return{isValid:!1,error:"Branch name cannot contain control characters"}}return e.includes(" ")?{isValid:!1,error:"Branch name cannot contain spaces"}:{isValid:!0}},Oy=t=>{const r=new Date().toISOString().replace(/T/,"-").replace(/\..+/,"").replace(/:/g,"-");return`${t}/design-update-${r}`},Ks=t=>["main","master","trunk"].includes(t.toLowerCase()),oI=({isOpen:t,onClose:e,onBranchCreated:r,currentBranch:n,repositoryFullName:s,githubUser:i,editMode:a=!1,sourceContext:l})=>{console.log("[BranchCreationDialog] Props:",{currentBranch:n,repositoryFullName:s,isOpen:t});const[c,d]=M.useState(""),[u,m]=M.useState(!1),[g,y]=M.useState(null),[v,I]=M.useState(null),[S,b]=M.useState(!1),k=Hr();M.useEffect(()=>{if(t&&i&&!S){const P=Oy(i.login);d(P),y(null),I(null),b(!0)}},[t,i,S]),M.useEffect(()=>{t||b(!1)},[t]),M.useEffect(()=>{if(c){const P=sI(c);P.isValid?(y(null),A(c)):y(P.error||"Invalid branch name")}else y(null),I(null)},[c,s]);const A=async P=>{console.log("[BranchCreationDialog] Checking branch existence:",{repositoryFullName:s,branchName:P});try{const _=await xt.branchExists(s,P);I(_?`Branch "${P}" already exists`:null)}catch(_){console.warn("Failed to check branch existence:",_),I(null)}},C=async()=>{if(!(!i||!c.trim())){if(!s){k({title:"No Repository Selected",description:"Please select a repository before creating a branch.",status:"error",duration:3e3,isClosable:!0});return}m(!0);try{await xt.createBranch(s,n,c),k({title:"Branch Created",description:`Successfully created branch "${c}"`,status:"success",duration:3e3,isClosable:!0});let P;if(l)P={fullName:s,filePath:l.sourceType==="core"?"schema.json":l.sourceType==="platform-extension"?"platform-extension.json":"theme-override.json",fileType:l.sourceType==="core"?"schema":l.sourceType==="platform-extension"?"platform-extension":"theme-override"};else{const _=s.toLowerCase().includes("platform"),R=s.toLowerCase().includes("theme");P={fullName:s,filePath:_?"platform-extension.json":R?"theme-override.json":"schema.json",fileType:_?"platform-extension":R?"theme-override":"schema"}}console.log("[BranchCreationDialog] Created repositoryInfo:",P),r(c,a,P),e()}catch(P){console.error("Failed to create branch:",P);let _="Failed to create branch";P instanceof Error&&(P.message.includes("422")?_="Branch already exists or invalid branch name":P.message.includes("403")?_="You do not have permission to create branches in this repository":P.message.includes("404")?_="Base branch not found or you do not have access to the repository":P.message.includes("Failed to get base branch info")?_=`Base branch "${n}" not found in repository "${s}"`:_=P.message),k({title:"Branch Creation Failed",description:_,status:"error",duration:5e3,isClosable:!0})}finally{m(!1)}}},T=c.trim()&&!g&&!v;return o.jsxs(Zr,{isOpen:t,onClose:e,isCentered:!0,children:[o.jsx(Dr,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:"Create New Branch"}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["You're creating a new branch from ",o.jsx("strong",{children:n})]}),l&&o.jsx(z,{p:3,bg:"blue.50",borderRadius:"md",border:"1px solid",borderColor:"blue.200",children:o.jsxs(ce,{spacing:2,align:"stretch",children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",color:"blue.800",children:"Source Context"}),o.jsxs(E,{fontSize:"sm",color:"blue.700",children:[o.jsx("strong",{children:"Repository:"})," ",s]}),l.sourceType==="core"&&o.jsxs(E,{fontSize:"sm",color:"blue.700",children:[o.jsx("strong",{children:"Editing:"})," Core Design System"]}),l.sourceType==="platform-extension"&&l.platformName&&o.jsxs(E,{fontSize:"sm",color:"blue.700",children:[o.jsx("strong",{children:"Editing:"})," Platform Extension - ",l.platformName]}),l.sourceType==="theme-override"&&l.themeName&&o.jsxs(E,{fontSize:"sm",color:"blue.700",children:[o.jsx("strong",{children:"Editing:"})," Theme Override - ",l.themeName]}),l.sourceType==="theme-override"&&l.platformName&&o.jsxs(E,{fontSize:"sm",color:"blue.700",children:[o.jsx("strong",{children:"Platform:"})," ",l.platformName," (read-only)"]})]})}),o.jsxs(Ye,{isInvalid:!!g||!!v,children:[o.jsx(Qe,{children:"Branch Name"}),o.jsx(yt,{value:c,onChange:P=>d(P.target.value),placeholder:i?Oy(i.login):"Enter branch name",isDisabled:u}),g&&o.jsx(Jd,{children:g}),v&&o.jsx(Jd,{children:v})]}),o.jsx(E,{fontSize:"xs",color:"gray.500",children:"Branch names cannot contain spaces, special characters, or start/end with certain characters."})]})}),o.jsxs(rn,{children:[o.jsx(Oe,{variant:"ghost",mr:3,onClick:e,isDisabled:u,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:C,isLoading:u,isDisabled:!T,children:"Create Branch"})]})]})]})},_y=({isOpen:t,onClose:e,onBranchSelected:r,currentBranch:n,repositoryFullName:s,githubUser:i,editMode:a=!1,sourceContext:l})=>{const[c,d]=M.useState([]),[u,m]=M.useState(""),[g,y]=M.useState(!1),[v,I]=M.useState(!1),[S,b]=M.useState(!1),k=Hr();M.useEffect(()=>{t&&s&&A()},[t,s]),M.useEffect(()=>{t&&(m(""),b(!1))},[t]);const A=async()=>{if(s){I(!0);try{const G=(await xc.loadBranchesForRepository(s,!1)).filter(ne=>ne!==n).sort();d(G)}catch(R){console.error("Failed to load branches:",R),k({title:"Failed to Load Branches",description:"Could not load branches from the repository.",status:"error",duration:3e3,isClosable:!0})}finally{I(!1)}}},C=R=>{R==="create-new"?b(!0):m(R)},T=()=>{var R,G,ne,he;if(!u){k({title:"No Branch Selected",description:"Please select a branch to edit.",status:"warning",duration:3e3,isClosable:!0});return}y(!0);try{const K=xr.getInstance().getCurrentContext();let O="schema.json";if((l==null?void 0:l.sourceType)==="platform-extension"&&l.sourceId){const ie=K.repositories.platforms[l.sourceId];if(ie)O=ie.filePath;else{const ge=L.getCoreData(),xe=(R=ge==null?void 0:ge.platforms)==null?void 0:R.find($=>$.id===l.sourceId);(G=xe==null?void 0:xe.extensionSource)!=null&&G.filePath&&(O=xe.extensionSource.filePath)}}else if((l==null?void 0:l.sourceType)==="theme-override"&&l.sourceId){const ie=K.repositories.themes[l.sourceId];if(ie)O=ie.filePath;else{const ge=L.getCoreData(),xe=(ne=ge==null?void 0:ge.themes)==null?void 0:ne.find($=>$.id===l.sourceId);(he=xe==null?void 0:xe.overrideSource)!=null&&he.filePath&&(O=xe.overrideSource.filePath)}}else(l==null?void 0:l.sourceType)==="core"&&(O="schema.json");const Z={fullName:s,filePath:O,fileType:(l==null?void 0:l.sourceType)==="core"?"schema":(l==null?void 0:l.sourceType)==="platform-extension"?"platform-extension":(l==null?void 0:l.sourceType)==="theme-override"?"theme-override":"schema"};console.log("[BranchSelectionDialog] handleSelectBranch calling onBranchSelected with:",{selectedBranch:u,editMode:a,repositoryInfo:Z}),r(u,a,Z),e()}catch(te){console.error("Failed to select branch:",te),k({title:"Failed to Select Branch",description:"Could not switch to the selected branch.",status:"error",duration:3e3,isClosable:!0})}finally{y(!1)}},P=(R,G,ne)=>{console.log("[BranchSelectionDialog] handleBranchCreated called with:",{branchName:R,editMode:G,repositoryInfo:ne}),b(!1),r(R,G,ne),e()},_=()=>{b(!1)};return S?o.jsx(oI,{isOpen:S,onClose:_,onBranchCreated:P,currentBranch:n,repositoryFullName:s,githubUser:i,editMode:a,sourceContext:l}):o.jsxs(Zr,{isOpen:t,onClose:e,isCentered:!0,children:[o.jsx(Dr,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:a?"Select Branch to Edit":"Switch Branch"}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["You're currently on ",o.jsx("strong",{children:n}),". ",a?"Select a branch to edit or create a new one.":"Select a branch to view."]}),l&&o.jsx(z,{p:3,bg:"blue.50",borderRadius:"md",border:"1px solid",borderColor:"blue.200",children:o.jsxs(ce,{spacing:2,align:"stretch",children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",color:"blue.800",children:"Source Context"}),o.jsxs(E,{fontSize:"sm",color:"blue.700",children:[o.jsx("strong",{children:"Repository:"})," ",s]}),l.sourceType==="core"&&o.jsxs(E,{fontSize:"sm",color:"blue.700",children:[o.jsx("strong",{children:"Editing:"})," Core Design System"]}),l.sourceType==="platform-extension"&&l.platformName&&o.jsxs(E,{fontSize:"sm",color:"blue.700",children:[o.jsx("strong",{children:"Editing:"})," Platform Extension - ",l.platformName]}),l.sourceType==="theme-override"&&l.themeName&&o.jsxs(E,{fontSize:"sm",color:"blue.700",children:[o.jsx("strong",{children:"Editing:"})," Theme Override - ",l.themeName]}),l.sourceType==="theme-override"&&l.platformName&&o.jsxs(E,{fontSize:"sm",color:"blue.700",children:[o.jsx("strong",{children:"Platform:"})," ",l.platformName," (read-only)"]})]})}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Branch"}),v?o.jsxs(z,{p:4,textAlign:"center",children:[o.jsx(kn,{size:"sm",mr:2}),o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Loading branches..."})]}):o.jsxs(Kt,{value:u,onChange:R=>C(R.target.value),placeholder:"Select a branch",isDisabled:g,children:[c.map(R=>o.jsx("option",{value:R,children:R},R)),i&&a&&o.jsx("option",{value:"create-new",style:{fontWeight:"bold",color:"#3182ce"},children:"+ Create new branch"})]})]}),c.length===0&&!v&&o.jsx(E,{fontSize:"sm",color:"gray.500",children:i&&a?"No other branches found. You can create a new branch to start editing.":"No other branches found in this repository."})]})}),o.jsxs(rn,{children:[o.jsx(Oe,{variant:"ghost",mr:3,onClick:e,isDisabled:g,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:T,isLoading:g,isDisabled:!u||v,children:a?"Select":"Switch"})]})]})]})},Ob=({hasChanges:t=!1,changeCount:e=0,currentData:r,baselineData:n,onResetData:s,onExportData:i,isGitHubConnected:a=!1,githubUser:l,selectedRepoInfo:c,onGitHubConnect:d,onGitHubDisconnect:u,onFileSelected:m,onRefreshData:g,isURLBasedAccess:y=!1,urlRepoInfo:v=null,dataSourceContext:I,onPlatformChange:S,onThemeChange:b,isEditMode:k=!1,currentBranch:A="main",onBranchCreated:C,onEnterEditMode:T,onExitEditMode:P,editContext:_,onSaveChanges:R,onDiscardChanges:G,pendingOverrides:ne=[]})=>{var ts,jn;const{colorMode:he}=Vt(),te=he==="dark"?"gray.700":"gray.200",K=he==="dark"?"gray.800":"white",{isOpen:O,onOpen:Z,onClose:ie}=nc(),[ge,xe]=M.useState(!1),[$,B]=M.useState(!1),[U,X]=M.useState(!1),[ee,be]=M.useState("direct"),[Se,Me]=M.useState(!1),[se,de]=M.useState(!1),[fe,_e]=M.useState(!1),[Y,Ce]=M.useState(null),[ue,Ee]=M.useState(!1),[ze,De]=M.useState("view"),Ke=Hr(),[ve,Te]=M.useState(!1),[je,Fe]=M.useState(null),Ue=ti.getInstance(),Je=ni.getInstance(),ut=Ue.getChangeCount(),Ze=Je.getCurrentSourceContext(),gr=xr.getInstance().getCurrentContext(),vr=()=>{const Be=new URLSearchParams(window.location.search),w=Be.get("platform"),N=Be.get("theme");return{currentPlatform:w,currentTheme:N}},{currentPlatform:yr,currentTheme:gt}=vr();M.useEffect(()=>{const Be=w=>{Fe(w.detail),Te(!0)};return window.addEventListener("token-model:source-switch-warning",Be),()=>{window.removeEventListener("token-model:source-switch-warning",Be)}},[]);const Dt=()=>{je&&(je.onConfirm(),Te(!1),Fe(null))},Ct=()=>{je&&(je.onCancel(),Te(!1),Fe(null))};M.useEffect(()=>{a&&de(!1),Yt.hasStaleOAuthState()||de(!1)},[a]);const Qt=()=>{var yn,kt,sr,Re;const Be=L.getCoreData(),w=(Be==null?void 0:Be.systemName)||"Design System";let N=w,Le="";const ae=ki.getInstance().getCurrentSourceContext(),er=new URLSearchParams(window.location.search),it=er.get("repo"),Ar=er.get("branch")||"main";if(it){const Ge=L.getMergedData();if(Ge&&Ge.tokens&&Ge.tokens.length>0&&Ge.tokenCollections&&Ge.tokenCollections.length>0)N=w,k?Le=`(${A}) - Editing`:Zt()?Le=`(${A}) - Edit Access`:Le=`(${A}) - View Only`;else{const[bt,pe]=it.split("/");N=`${bt}/${pe}`,Le=`(${Ar}) - Loading Failed`}return{title:N,subtitle:Le}}if(ae){if(N=w,(yn=ae.editMode)!=null&&yn.isActive){const Ge=ae.editMode.targetRepository;Ge?(N=`${w} - ${Ge.fullName}@${Ge.branch}`,Le="Editing"):(N=w,Le="Editing")}else{const Ge=Je.getAvailablePlatforms(),q=Je.getAvailableThemes(),bt=ae.sourceType==="platform-extension"&&ae.sourceId?(kt=Ge.find(qe=>qe.id===ae.sourceId))==null?void 0:kt.displayName:null,pe=ae.sourceType==="theme-override"&&ae.sourceId?(sr=q.find(qe=>qe.id===ae.sourceId))==null?void 0:sr.displayName:null;let me="";if(ae.repositoryInfo){const qe=ae.repositoryInfo.fullName.split("/")[1],nt=ae.repositoryInfo.branch||A;me=`(${qe} - ${nt})`}else me=`(${A})`;bt&&pe?Le=`${bt} + ${pe} ${me}`:bt?Le=`${bt} ${me}`:pe?Le=`${pe} ${me}`:Le=`Core Data ${me}`,((Re=ae.editMode)==null?void 0:Re.isActive)||l&&Zt()?Le+=" - Edit Access":Le+=" - View Only"}return{title:N,subtitle:Le}}if(c){if(c.fileType==="schema")N=w;else if(c.fileType==="theme-override"){const Ge=L.getCoreData(),bt=((Ge==null?void 0:Ge.themes)||[])[0],pe=(bt==null?void 0:bt.displayName)||"Default Theme";N=`${w}: ${pe}`}Le=`(${c.branch})`}else{const Ge=L.getMergedData(),q=L.getCoreData();if(Ge&&Ge.tokenCollections&&Ge.tokenCollections.length>0)N=w;else if(q&&q.themes&&q.themes.length>0){const bt=q.themes[0],pe=(bt==null?void 0:bt.displayName)||"Default Theme";N=`${w}: ${pe}`}}return{title:N,subtitle:Le}},Zt=()=>{var Le;if(console.log("[Header] hasDataSourceEditPermissions - Starting permission check"),console.log("[Header] hasDataSourceEditPermissions - GitHub user:",l),!l)return console.log("[Header] hasDataSourceEditPermissions - No GitHub user, returning false"),!1;const Be=Je.getCurrentSourceContext();if(console.log("[Header] hasDataSourceEditPermissions - Source context:",Be),!Be)return console.log("[Header] hasDataSourceEditPermissions - No source context, returning false"),!1;if((Le=Be.editMode)!=null&&Le.isActive)return console.log("[Header] hasDataSourceEditPermissions - Already in edit mode, returning true"),!0;const N=xr.getInstance().getCurrentEditPermissions();return console.log("[Header] hasDataSourceEditPermissions - Final permission result:",N),N},{title:at,subtitle:Q}=Qt(),Ae=()=>{Z()},oe=async()=>{de(!0);try{await new Promise(Be=>setTimeout(Be,100)),d&&await d()}catch(Be){console.error("GitHub connection error:",Be),de(!1),Ke({title:"GitHub Connection Failed",description:Be instanceof Error?Be.message:"Failed to connect to GitHub. Please try again.",status:"error",duration:5e3,isClosable:!0})}},Ne=()=>{u&&u(),xe(!1),B(!1),de(!1),X(!1)},st=async()=>{if(c)try{let Be;try{Be=await xt.getFileContent(c.fullName,c.filePath,c.branch)}catch{console.log("[Header] Authenticated file reload failed, trying public API"),Be=await xt.getPublicFileContent(c.fullName,c.filePath,c.branch)}const w=JSON.parse(Be.content);m&&m(w,c.fileType)}catch{Ke({title:"Reload Failed",description:"Failed to reload file from GitHub.",status:"error",duration:5e3,isClosable:!0})}},tt=()=>{r&&(Gn.setBaselineData(r),Gn.updateLastGitHubSync()),window.dispatchEvent(new CustomEvent(Dn)),P&&P()},Ie=()=>{be("direct"),B(!0)},We=()=>{be("pullRequest"),B(!0)},lt=async()=>{g?await g():st()},Et=()=>{i&&(i(),Ke({title:"Data Exported",description:"Data has been exported successfully.",status:"success",duration:3e3,isClosable:!0}))},et=()=>{const Be=new URLSearchParams(window.location.search),w=Be.get("repo"),N=Be.get("path")||"schema.json",Le=Be.get("branch")||"main",V=Be.get("platform"),ae=Be.get("theme");if(w){const er=window.location.origin,it=new URLSearchParams;return it.set("repo",w),it.set("path",N),it.set("branch",Le),V&&it.set("platform",V),ae&&it.set("theme",ae),`${er}?${it.toString()}`}else if(c){const er=window.location.origin,it=new URLSearchParams;return it.set("repo",c.fullName),it.set("path",c.filePath),it.set("branch",c.branch),(Ze==null?void 0:Ze.sourceType)==="platform"&&Ze.sourceId&&it.set("platform",Ze.sourceId),(Ze==null?void 0:Ze.sourceType)==="theme"&&Ze.sourceId&&it.set("theme",Ze.sourceId),`${er}?${it.toString()}`}return null},pt=async()=>{const Be=et();if(!Be){Ke({title:"Cannot Share",description:"No repository information available to share.",status:"warning",duration:3e3,isClosable:!0});return}try{await navigator.clipboard.writeText(Be),Ke({title:"URL Copied",description:"Repository URL has been copied to clipboard.",status:"success",duration:3e3,isClosable:!0})}catch(w){console.error("Copy failed:",w),Ke({title:"Copy Failed",description:"Failed to copy the repository URL to clipboard.",status:"error",duration:3e3,isClosable:!0})}},Wt=()=>{let Be=null;if(Ze)if(Ze.sourceType==="platform"&&Ze.sourceId){const w=Ze.sourceRepository;Be={fullName:w.fullName,branch:w.branch,filePath:w.filePath,fileType:"platform-extension"}}else if(Ze.sourceType==="theme"&&Ze.sourceId){const w=Ze.sourceRepository;Be={fullName:w.fullName,branch:w.branch,filePath:w.filePath,fileType:"theme-override"}}else{const w=Ze.coreRepository;Be={fullName:w.fullName,branch:w.branch,filePath:w.filePath,fileType:"schema"}}else Be=c||null;if(!(Be!=null&&Be.fullName)){Ke({title:"No Repository Selected",description:"Please select a platform or theme, or ensure you have a valid repository connection.",status:"warning",duration:3e3,isClosable:!0});return}Ks(A)?(Ce(Be),_e(!0)):T?T():(console.warn("[Header] onEnterEditMode handler not provided"),Ke({title:"Edit Mode Not Available",description:"Edit mode handler is not configured.",status:"warning",duration:3e3,isClosable:!0}))},In=(Be,w,N)=>{console.log("[Header] handleBranchSelected called with:",{branchName:Be,editMode:w,repositoryInfo:N}),C?C(Be,w,N):w&&T?T():w&&!T&&(console.warn("[Header] Edit mode requested but onEnterEditMode handler not provided"),Ke({title:"Edit Mode Not Available",description:"Edit mode handler is not configured.",status:"warning",duration:3e3,isClosable:!0})),_e(!1)},Mn=()=>{let Be=null;if(Ze)if(Ze.sourceType==="platform"&&Ze.sourceId){const w=Ze.sourceRepository;Be={fullName:w.fullName,branch:w.branch,filePath:w.filePath,fileType:"platform-extension"}}else if(Ze.sourceType==="theme"&&Ze.sourceId){const w=Ze.sourceRepository;Be={fullName:w.fullName,branch:w.branch,filePath:w.filePath,fileType:"theme-override"}}else{const w=Ze.coreRepository;Be={fullName:w.fullName,branch:w.branch,filePath:w.filePath,fileType:"schema"}}else if(y||v){const w=new URLSearchParams(window.location.search),N=w.get("repo"),Le=w.get("path")||"schema.json",V=w.get("branch")||"main";N&&(Be={fullName:N,branch:V,filePath:Le,fileType:"schema"})}else Be=c||null;if(!(Be!=null&&Be.fullName)){Ke({title:"No Repository Selected",description:"Please select a platform or theme, or ensure you have a valid repository connection.",status:"warning",duration:3e3,isClosable:!0});return}Ce(Be),De("view"),Ee(!0)},An=Be=>{if(g){const w=new URL(window.location.href);if(w.searchParams.set("branch",Be),window.history.replaceState({},"",w.toString()),C){const Le=ni.getInstance().getCurrentSourceContext();let V;Le&&(Le.sourceType==="platform"&&Le.sourceRepository?V={fullName:Le.sourceRepository.fullName,filePath:Le.sourceRepository.filePath,fileType:"platform-extension"}:Le.sourceType==="theme"&&Le.sourceRepository?V={fullName:Le.sourceRepository.fullName,filePath:Le.sourceRepository.filePath,fileType:"theme-override"}:Le.sourceType==="core"&&Le.coreRepository&&(V={fullName:Le.coreRepository.fullName,filePath:Le.coreRepository.filePath,fileType:"schema"})),C(Be,!1,V)}else g(!0);Ke({title:"Branch Switched",description:`Now viewing branch "${Be}"`,status:"success",duration:3e3,isClosable:!0})}Ee(!1)};return o.jsxs(o.Fragment,{children:[o.jsxs(z,{as:"header",borderBottom:"1px",borderColor:te,bg:K,px:4,py:3,display:"flex",alignItems:"center",justifyContent:"space-between",children:[o.jsxs(le,{spacing:2,alignItems:"baseline",children:[c&&o.jsx(Pp,{style:{alignSelf:"center"},size:16}),o.jsx(E,{fontSize:"md",fontWeight:"bold",children:at}),o.jsx(E,{fontSize:"xs",children:Q})]}),o.jsxs(le,{spacing:2,children:[k?o.jsx(o.Fragment,{children:o.jsxs(le,{spacing:2,children:[o.jsx(Oe,{size:"sm",variant:"outline",onClick:P,children:"Cancel"}),o.jsx(Oe,{size:"sm",colorScheme:"blue",onClick:R||Ie,leftIcon:o.jsx(A6,{size:16}),children:"Save"}),o.jsx(Oe,{size:"sm",colorScheme:"green",onClick:We,leftIcon:o.jsx(N6,{size:16}),children:"Submit for Review"}),o.jsxs(z,{position:"relative",children:[o.jsx(Cn,{label:"History",placement:"bottom",children:o.jsx(Bt,{"aria-label":"History",icon:o.jsx(_6,{size:16}),variant:"ghost",size:"sm",onClick:Ae})}),ut>0&&o.jsx(wt,{position:"absolute",top:"-1",right:"-1",colorScheme:"red",variant:"solid",fontSize:"xs",borderRadius:"full",minW:"20px",h:"20px",display:"flex",alignItems:"center",justifyContent:"center",children:ut})]})]})}):o.jsxs(o.Fragment,{children:[o.jsxs(le,{spacing:4,children:[o.jsx(rI,{availablePlatforms:Je.getAvailablePlatforms(),currentPlatform:yr,permissions:((ts=gr==null?void 0:gr.permissions)==null?void 0:ts.platforms)||{},onPlatformChange:S||(()=>{})}),o.jsx(nI,{availableThemes:Je.getAvailableThemes(),currentTheme:gt,permissions:((jn=gr==null?void 0:gr.permissions)==null?void 0:jn.themes)||{},onThemeChange:b||(()=>{})})]}),l&&Zt()&&o.jsx(le,{spacing:2,children:o.jsx(Oe,{size:"sm",colorScheme:"green",onClick:Wt,children:"Edit"})}),o.jsx(le,{spacing:2,children:o.jsxs(Xo,{placement:"bottom-end",isOpen:Se,onClose:()=>Me(!1),children:[o.jsx(Qo,{children:o.jsx(Bt,{"aria-label":"Source Data Management",icon:o.jsx(Ep,{size:16}),size:"sm",variant:"ghost",onClick:()=>Me(!0)})}),o.jsxs(Ai,{p:0,w:"auto",minW:"200px",children:[o.jsx(Yd,{}),o.jsx(Pi,{p:2,children:o.jsxs(ce,{spacing:0,align:"stretch",children:[o.jsx(Oe,{variant:"ghost",size:"sm",justifyContent:"flex-start",borderRadius:0,leftIcon:o.jsx(pb,{size:16}),onClick:()=>{xe(!0),Me(!1)},children:"Load design system from URL"}),o.jsx(Oe,{variant:"ghost",size:"sm",justifyContent:"flex-start",borderRadius:0,leftIcon:o.jsx(Gf,{size:16}),onClick:()=>{Mn(),Me(!1)},children:"Switch branch"}),o.jsx(Oe,{variant:"ghost",size:"sm",justifyContent:"flex-start",borderRadius:0,leftIcon:o.jsx(Hf,{size:16}),onClick:()=>{lt(),Me(!1)},children:"Refresh (pull) data"})]})})]})]})}),(i||s||y)&&o.jsx(le,{spacing:2,children:i&&o.jsx(Cn,{label:"Export Data",children:o.jsx(Bt,{"aria-label":"Export Data",icon:o.jsx(xu,{size:16}),size:"sm",variant:"ghost",onClick:Et})})}),(y||new URLSearchParams(window.location.search).get("repo")!==null)&&o.jsx(le,{spacing:2,children:o.jsx(Cn,{label:"Copy Repository URL",children:o.jsx(Bt,{"aria-label":"Copy Repository URL",icon:o.jsx(mk,{size:16}),size:"sm",variant:"ghost",onClick:pt})})})]}),l?o.jsxs(Xo,{placement:"bottom-end",isOpen:U,onClose:()=>X(!1),children:[o.jsx(Qo,{children:o.jsx(Bt,{"aria-label":"User Menu",icon:o.jsx(dc,{size:"xs",src:l.avatar_url}),size:"sm",variant:"ghost",onClick:()=>X(!0)})}),o.jsxs(Ai,{p:0,w:"auto",minW:"200px",children:[o.jsx(Yd,{}),o.jsx(Pi,{p:2,children:o.jsxs(ce,{spacing:0,align:"stretch",children:[o.jsx(le,{p:2,mb:2,w:"full",justifyContent:"space-between",alignItems:"center",children:o.jsxs(ce,{spacing:0,align:"flex-start",children:[o.jsx(dc,{size:"lg",src:l.avatar_url,mb:2}),o.jsx(E,{fontSize:"sm",fontWeight:"bold",children:l.login}),o.jsx(E,{fontSize:"xs",color:"gray.500",children:l.email})]})}),o.jsx(on,{mb:2}),o.jsx(Oe,{variant:"ghost",size:"sm",justifyContent:"flex-start",borderRadius:0,onClick:()=>{window.open(`https://github.com/${l.login}`,"_blank"),X(!1)},children:"View Profile"}),c&&o.jsx(Oe,{variant:"ghost",size:"sm",justifyContent:"flex-start",borderRadius:0,onClick:()=>{window.open(`https://github.com/${c.fullName}/pulls?q=author:${l.login}`,"_blank"),X(!1)},children:"My Pull Requests"}),o.jsx(Oe,{variant:"ghost",size:"sm",justifyContent:"flex-start",borderRadius:0,colorScheme:"red",onClick:()=>{Ne(),X(!1)},children:"Sign out"})]})})]})]}):o.jsx(Oe,{size:"sm",variant:"outline",onClick:oe,isLoading:se,isDisabled:se,leftIcon:se?o.jsx(kn,{size:"sm"}):o.jsx(Pp,{size:16}),children:"Sign in"})]})]}),o.jsx(uc,{isOpen:ve,onClose:Ct,leastDestructiveRef:nr.useRef(null),children:o.jsx(Dr,{children:o.jsxs(hc,{children:[o.jsx(Rr,{fontSize:"lg",fontWeight:"bold",children:"Unsaved Changes"}),o.jsxs(Or,{children:["You have ",je==null?void 0:je.changeCount," unsaved changes. Switching sources will reset to main branch and discard changes. Continue?"]}),o.jsxs(rn,{children:[o.jsx(Oe,{onClick:Ct,children:"Stay Here"}),o.jsx(Oe,{colorScheme:"red",onClick:Dt,ml:3,children:"Continue"})]})]})})}),o.jsx(Rb,{isOpen:ge,onClose:()=>xe(!1),onDesignSystemSelected:(Be,w)=>{const N=new URL(window.location.href);N.searchParams.set("repo",Be),N.searchParams.set("path",w),N.searchParams.set("branch","main"),window.location.href=N.toString()}}),o.jsx(_y,{isOpen:fe,onClose:()=>_e(!1),onBranchSelected:In,currentBranch:A,repositoryFullName:(()=>{var Be,w,N;return Ze?Ze.sourceType==="platform"&&Ze.sourceId?((Be=Ze.sourceRepository)==null?void 0:Be.fullName)||"":Ze.sourceType==="theme"&&Ze.sourceId?((w=Ze.sourceRepository)==null?void 0:w.fullName)||"":((N=Ze.coreRepository)==null?void 0:N.fullName)||"":(Y==null?void 0:Y.fullName)||(c==null?void 0:c.fullName)||""})(),githubUser:l||null,editMode:!0,sourceContext:(()=>{var Ar,yn;if(Ze){let kt,sr="Core Design System",Re,Ge;if(Ze.sourceType==="platform"&&Ze.sourceId)if(kt="platform-extension",I){const q=I.availablePlatforms.find(bt=>bt.id===Ze.sourceId);sr=(q==null?void 0:q.displayName)||Ze.sourceId,Re=sr}else sr=Ze.sourceId,Re=Ze.sourceId;else if(Ze.sourceType==="theme"&&Ze.sourceId)if(kt="theme-override",I){const q=I.availableThemes.find(bt=>bt.id===Ze.sourceId);sr=(q==null?void 0:q.displayName)||Ze.sourceId,Ge=sr}else sr=Ze.sourceId,Ge=Ze.sourceId;else kt="core",sr="Core Design System";return{sourceType:kt,sourceId:Ze.sourceId,sourceName:sr,platformName:Re,themeName:Ge}}if(!I)return;const{currentPlatform:Be,currentTheme:w,availablePlatforms:N,availableThemes:Le}=I,V=Be&&Be!=="none"?((Ar=N.find(kt=>kt.id===Be))==null?void 0:Ar.displayName)||Be:void 0,ae=w&&w!=="none"?((yn=Le.find(kt=>kt.id===w))==null?void 0:yn.displayName)||w:void 0;let er="core",it="Core Design System";return Be&&Be!=="none"?(er="platform-extension",it=V||Be):w&&w!=="none"&&(er="theme-override",it=ae||w),{sourceType:er,sourceId:Be!=="none"?Be:w!=="none"?w:null,sourceName:it,platformName:V,themeName:ae}})()}),o.jsx(_y,{isOpen:ue,onClose:()=>Ee(!1),onBranchSelected:An,currentBranch:A,repositoryFullName:(()=>{var Be,w,N;return Ze?Ze.sourceType==="platform"&&Ze.sourceId?((Be=Ze.sourceRepository)==null?void 0:Be.fullName)||"":Ze.sourceType==="theme"&&Ze.sourceId?((w=Ze.sourceRepository)==null?void 0:w.fullName)||"":((N=Ze.coreRepository)==null?void 0:N.fullName)||"":(Y==null?void 0:Y.fullName)||(c==null?void 0:c.fullName)||""})(),githubUser:l||null,editMode:!1,sourceContext:(()=>{var Ar,yn;if(Ze){let kt,sr="Core Design System",Re,Ge;if(Ze.sourceType==="platform"&&Ze.sourceId)if(kt="platform-extension",I){const q=I.availablePlatforms.find(bt=>bt.id===Ze.sourceId);sr=(q==null?void 0:q.displayName)||Ze.sourceId,Re=sr}else sr=Ze.sourceId,Re=Ze.sourceId;else if(Ze.sourceType==="theme"&&Ze.sourceId)if(kt="theme-override",I){const q=I.availableThemes.find(bt=>bt.id===Ze.sourceId);sr=(q==null?void 0:q.displayName)||Ze.sourceId,Ge=sr}else sr=Ze.sourceId,Ge=Ze.sourceId;else kt="core",sr="Core Design System";return{sourceType:kt,sourceId:Ze.sourceId,sourceName:sr,platformName:Re,themeName:Ge}}if(!I)return;const{currentPlatform:Be,currentTheme:w,availablePlatforms:N,availableThemes:Le}=I,V=Be&&Be!=="none"?((Ar=N.find(kt=>kt.id===Be))==null?void 0:Ar.displayName)||Be:void 0,ae=w&&w!=="none"?((yn=Le.find(kt=>kt.id===w))==null?void 0:yn.displayName)||w:void 0;let er="core",it="Core Design System";return Be&&Be!=="none"?(er="platform-extension",it=V||Be):w&&w!=="none"&&(er="theme-override",it=ae||w),{sourceType:er,sourceId:Be!=="none"?Be:w!=="none"?w:null,sourceName:it,platformName:V,themeName:ae}})()}),o.jsx(tI,{isOpen:$,onClose:()=>{B(!1),be("direct")},saveMode:ee,onSuccess:tt,currentBranch:A,isEditMode:k,dataSourceContext:I}),o.jsxs(Zr,{isOpen:O,onClose:ie,size:"xl",scrollBehavior:"inside",closeOnOverlayClick:!0,closeOnEsc:!0,isCentered:!0,children:[o.jsx(Dr,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:"Change History"}),o.jsx(Hn,{}),o.jsx(Or,{pb:6,children:o.jsx(Db,{currentData:r,previousData:n})})]})]})]})};M.memo(Ob);var _b={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Fy=nr.createContext&&nr.createContext(_b),Ii=function(){return Ii=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},Ii.apply(this,arguments)},iI=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r};function Fb(t){return t&&t.map(function(e,r){return nr.createElement(e.tag,Ii({key:r},e.attr),Fb(e.child))})}function Fn(t){return function(e){return nr.createElement(aI,Ii({attr:Ii({},t.attr)},e),Fb(t.child))}}function aI(t){var e=function(r){var n=t.attr,s=t.size,i=t.title,a=iI(t,["attr","size","title"]),l=s||r.size||"1em",c;return r.className&&(c=r.className),t.className&&(c=(c?c+" ":"")+t.className),nr.createElement("svg",Ii({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,n,a,{className:c,style:Ii(Ii({color:t.color||r.color},r.style),t.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),i&&nr.createElement("title",null,i),t.children)};return Fy!==void 0?nr.createElement(Fy.Consumer,null,function(r){return e(r)}):e(_b)}function Fp(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"}},{tag:"path",attr:{d:"M12 9v4"}},{tag:"path",attr:{d:"M12 17h.01"}}]})(t)}function lI(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{width:"18",height:"10",x:"3",y:"11",rx:"2"}},{tag:"circle",attr:{cx:"12",cy:"5",r:"2"}},{tag:"path",attr:{d:"M12 7v4"}},{tag:"line",attr:{x1:"8",x2:"8",y1:"16",y2:"16"}},{tag:"line",attr:{x1:"16",x2:"16",y1:"16",y2:"16"}}]})(t)}function cI(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}},{tag:"polyline",attr:{points:"22 4 12 14.01 9 11.01"}}]})(t)}function Kf(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",x2:"12",y1:"2",y2:"22"}},{tag:"path",attr:{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"}}]})(t)}function dI(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}},{tag:"polyline",attr:{points:"15 3 21 3 21 9"}},{tag:"line",attr:{x1:"10",x2:"21",y1:"14",y2:"3"}}]})(t)}function uI(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24"}},{tag:"path",attr:{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"}},{tag:"path",attr:{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"}},{tag:"line",attr:{x1:"2",x2:"22",y1:"2",y2:"22"}}]})(t)}function hI(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"}},{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}}]})(t)}function Vb(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}},{tag:"polyline",attr:{points:"14 2 14 8 20 8"}},{tag:"line",attr:{x1:"16",x2:"8",y1:"13",y2:"13"}},{tag:"line",attr:{x1:"16",x2:"8",y1:"17",y2:"17"}},{tag:"line",attr:{x1:"10",x2:"8",y1:"9",y2:"9"}}]})(t)}function $b(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"6",x2:"6",y1:"3",y2:"15"}},{tag:"circle",attr:{cx:"18",cy:"6",r:"3"}},{tag:"circle",attr:{cx:"6",cy:"18",r:"3"}},{tag:"path",attr:{d:"M18 9a9 9 0 0 1-9 9"}}]})(t)}function zb(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"9",cy:"12",r:"1"}},{tag:"circle",attr:{cx:"9",cy:"5",r:"1"}},{tag:"circle",attr:{cx:"9",cy:"19",r:"1"}},{tag:"circle",attr:{cx:"15",cy:"12",r:"1"}},{tag:"circle",attr:{cx:"15",cy:"5",r:"1"}},{tag:"circle",attr:{cx:"15",cy:"19",r:"1"}}]})(t)}function mI(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"path",attr:{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}},{tag:"path",attr:{d:"M12 17h.01"}}]})(t)}function pI(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"path",attr:{d:"M12 16v-4"}},{tag:"path",attr:{d:"M12 8h.01"}}]})(t)}function fI(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"7.5",cy:"15.5",r:"5.5"}},{tag:"path",attr:{d:"m21 2-9.6 9.6"}},{tag:"path",attr:{d:"m15.5 7.5 3 3L22 7l-3-3"}}]})(t)}function Lb(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(t)}function ys(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}},{tag:"path",attr:{d:"m15 5 4 4"}}]})(t)}function xs(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 12h14"}},{tag:"path",attr:{d:"M12 5v14"}}]})(t)}function gI(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}},{tag:"path",attr:{d:"M21 3v5h-5"}},{tag:"path",attr:{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}},{tag:"path",attr:{d:"M8 16H3v5"}}]})(t)}function yI(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"m22 2-7 20-4-9-9-4Z"}},{tag:"path",attr:{d:"M22 2 11 13"}}]})(t)}function As(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 6h18"}},{tag:"path",attr:{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}},{tag:"path",attr:{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}},{tag:"line",attr:{x1:"10",x2:"10",y1:"11",y2:"17"}},{tag:"line",attr:{x1:"14",x2:"14",y1:"11",y2:"17"}}]})(t)}function xI(t){return Fn({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"22 7 13.5 15.5 8.5 10.5 2 17"}},{tag:"polyline",attr:{points:"16 7 22 7 22 13"}}]})(t)}const Bb=()=>{const t=M.useContext(Wv);if(!t)throw new Error("useGeminiAI must be used within GeminiAIProvider");return t},vI=({message:t,showCost:e=!1})=>{const{colorMode:r}=Vt(),n=t.type==="user",s=a=>a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),i=a=>{if(n)return[a];const l=[];let c="",d=0;for(;d<a.length;){if(a.slice(d,d+2)==="**"&&d+2<a.length){c&&(l.push(c),c="");const u=a.indexOf("**",d+2);if(u!==-1){const m=a.slice(d+2,u);l.push(o.jsx(E,{as:"span",fontWeight:"bold",children:m},`bold-${l.length}`)),d=u+2;continue}}if(a[d]==="*"&&d+1<a.length){c&&(l.push(c),c="");const u=a.indexOf("*",d+1);if(u!==-1&&u!==d+1){const m=a.slice(d+1,u);l.push(o.jsx(E,{as:"span",fontStyle:"italic",children:m},`italic-${l.length}`)),d=u+1;continue}}if(a[d]==="`"&&d+1<a.length){c&&(l.push(c),c="");const u=a.indexOf("`",d+1);if(u!==-1){const m=a.slice(d+1,u);l.push(o.jsx(Nt,{fontSize:"xs",px:1,py:.5,borderRadius:"sm",bg:r==="dark"?"gray.600":"gray.100",color:r==="dark"?"gray.100":"gray.800",children:m},`code-${l.length}`)),d=u+1;continue}}if(a[d]==="["&&d+1<a.length){c&&(l.push(c),c="");const u=a.indexOf("]",d+1);if(u!==-1&&a[u+1]==="("){const m=u+2,g=a.indexOf(")",m);if(g!==-1){const y=a.slice(d+1,u),v=a.slice(m,g);l.push(o.jsx(Fv,{href:v,isExternal:!0,color:"blue.500",textDecoration:"underline",children:y},`link-${l.length}`)),d=g+1;continue}}}if(a[d]===`
`){c&&(l.push(c),c=""),l.push(o.jsx("br",{},`br-${l.length}`)),d++;continue}c+=a[d],d++}return c&&l.push(c),l};return o.jsx(z,{alignSelf:n?"flex-end":"flex-start",maxWidth:"80%",children:o.jsxs(ce,{align:n?"flex-end":"flex-start",spacing:1,children:[o.jsx(z,{bg:n?r==="dark"?"blue.600":"blue.500":r==="dark"?"gray.700":"white",color:n?"white":"inherit",px:4,py:3,borderRadius:"lg",borderWidth:n?0:1,borderColor:r==="dark"?"gray.600":"gray.200",boxShadow:"sm",children:o.jsx(E,{fontSize:"sm",whiteSpace:"pre-wrap",children:i(t.content)})}),o.jsxs(le,{spacing:2,px:2,children:[o.jsx(E,{fontSize:"xs",color:"gray.500",children:s(t.timestamp)}),e&&t.cost!==void 0&&o.jsxs(le,{spacing:1,children:[o.jsx(Kf,{size:12}),o.jsxs(E,{fontSize:"xs",color:"gray.500",children:["$",t.cost.toFixed(4)]})]}),o.jsx(wt,{size:"sm",variant:"subtle",colorScheme:n?"blue":"gray",children:n?"You":"AI"})]})]})})},bI=({suggestions:t,onSelect:e,disabled:r=!1})=>{const{colorMode:n}=Vt();return o.jsx(Ra,{spacing:2,children:t.map((s,i)=>o.jsx(Tw,{children:o.jsx(Oe,{size:"sm",variant:"outline",colorScheme:"blue",onClick:()=>e(s),disabled:r,maxWidth:"300px",textAlign:"left",whiteSpace:"normal",height:"auto",py:2,px:3,fontSize:"sm",bg:n==="dark"?"gray.700":"white",borderColor:n==="dark"?"gray.600":"gray.200",_hover:{bg:n==="dark"?"gray.600":"gray.50"},children:s})},i))})},SI=({costStats:t})=>{const{colorMode:e}=Vt(),{budgetStatus:r,monthlyQueries:n,averageCostPerQuery:s}=t,{currentUsage:i,budget:a,remaining:l,percentageUsed:c,isOverBudget:d}=r,u=()=>d?"red":c>=80?"orange":c>=60?"yellow":"green",m=()=>d?"Budget Exceeded":c>=80?"Budget Warning":c>=60?"Budget Notice":"Budget Healthy";return o.jsx(z,{children:o.jsxs(ce,{spacing:3,align:"stretch",children:[o.jsxs(z,{children:[o.jsxs(le,{justify:"space-between",mb:2,children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",children:"Monthly Budget Usage"}),o.jsx(wt,{colorScheme:u(),variant:"subtle",size:"sm",children:m()})]}),o.jsx(sc,{value:Math.min(c,100),colorScheme:u(),size:"sm",borderRadius:"md",mb:2}),o.jsxs(le,{justify:"space-between",fontSize:"xs",color:"gray.500",children:[o.jsxs(E,{children:["$",i.toFixed(4)," used"]}),o.jsxs(E,{children:["$",l.toFixed(2)," remaining"]})]})]}),o.jsxs(le,{justify:"space-between",fontSize:"sm",children:[o.jsxs(le,{spacing:1,children:[o.jsx(xI,{size:14}),o.jsx(E,{children:"Queries this month:"}),o.jsx(E,{fontWeight:"medium",children:n})]}),o.jsxs(le,{spacing:1,children:[o.jsx(Kf,{size:14}),o.jsx(E,{children:"Avg cost per query:"}),o.jsxs(E,{fontWeight:"medium",children:["$",s.toFixed(4)]})]})]}),c>=80&&o.jsxs(le,{spacing:2,p:2,bg:e==="dark"?"orange.900":"orange.50",borderRadius:"md",borderWidth:1,borderColor:e==="dark"?"orange.700":"orange.200",children:[o.jsx(Fp,{size:16,color:"orange"}),o.jsx(E,{fontSize:"sm",color:e==="dark"?"orange.200":"orange.800",children:d?"Monthly budget exceeded. AI features are disabled until next month.":"Approaching monthly budget limit. Consider reducing usage."})]})]})})},wI=["What tokens are available in my design system?","How do I create a new component?","What are the current dimensions and modes?","How do I organize tokens with taxonomies?","What platforms does my design system support?","Explain the relationship between dimensions and modes","How do aliases work in this design system?","What resolved value types are supported?"],CI=({suggestions:t=wI,maxHeight:e="600px",showCostInfo:r=!0})=>{const{conversation:n,askQuestion:s,isLoading:i,costStats:a,isAvailable:l}=Bb(),[c,d]=M.useState(""),{colorMode:u}=Vt(),m=M.useRef(null);M.useEffect(()=>{var v;(v=m.current)==null||v.scrollIntoView({behavior:"smooth"})},[n]);const g=async v=>{v.preventDefault(),!(!c.trim()||i||!l)&&(await s(c.trim()),d(""))},y=async v=>{i||!l||await s(v)};return o.jsxs(z,{children:[o.jsxs(le,{justify:"space-between",mb:4,p:2,bg:u==="dark"?"gray.700":"gray.100",borderRadius:"md",children:[o.jsxs(le,{spacing:2,children:[o.jsx(wt,{colorScheme:l?"green":"red",variant:"subtle",children:l?"AI Available":"AI Disabled"}),i&&o.jsxs(le,{spacing:1,children:[o.jsx(kn,{size:"xs"}),o.jsx(E,{fontSize:"sm",children:"Processing..."})]})]}),r&&o.jsxs(le,{spacing:2,children:[o.jsx(Kf,{size:16}),o.jsxs(E,{fontSize:"sm",fontWeight:"medium",children:["$",a.monthlyCost.toFixed(4)," / $",a.budgetStatus.budget.toFixed(2)]})]})]}),o.jsxs(ce,{spacing:4,maxHeight:e,overflowY:"auto",align:"stretch",mb:4,p:2,borderWidth:1,borderRadius:"md",borderColor:u==="dark"?"gray.600":"gray.200",bg:u==="dark"?"gray.800":"gray.50",children:[n.length===0?o.jsxs(z,{textAlign:"center",py:8,children:[o.jsx(E,{color:"gray.500",fontSize:"sm",children:"Start a conversation about your design system"}),o.jsx(E,{color:"gray.400",fontSize:"xs",mt:2,children:"Ask about tokens, components, dimensions, or any design system concepts"})]}):n.map((v,I)=>o.jsx(vI,{message:v,showCost:v.type==="assistant"&&v.cost!==void 0},I)),i&&o.jsxs(le,{spacing:2,p:3,bg:u==="dark"?"gray.700":"white",borderRadius:"md",children:[o.jsx(kn,{size:"sm"}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:"AI is thinking..."})]}),o.jsx("div",{ref:m})]}),o.jsx("form",{onSubmit:g,children:o.jsxs(le,{spacing:2,children:[o.jsx(yt,{value:c,onChange:v=>d(v.target.value),placeholder:l?"Ask about your design system...":"AI is currently disabled",disabled:i||!l,size:"md",borderRadius:"md"}),o.jsx(Oe,{type:"submit",isLoading:i,disabled:!c.trim()||!l,colorScheme:"blue",size:"md",borderRadius:"md",children:o.jsx(yI,{size:16})})]})}),n.length===0&&o.jsxs(z,{mt:4,children:[o.jsx(E,{fontSize:"sm",color:"gray.500",mb:2,children:"Try asking about:"}),o.jsx(bI,{suggestions:t,onSelect:y,disabled:i||!l})]}),r&&o.jsxs(z,{mt:4,children:[o.jsx(on,{mb:3}),o.jsx(SI,{costStats:a})]})]})},kI=()=>{const{isAvailable:t,costStats:e}=Bb(),{colorMode:r}=Vt(),{budgetStatus:n}=e,{percentageUsed:s,isOverBudget:i}=n,a=()=>i?"red":s>=80?"orange":"green",l=()=>i?"Budget Exceeded":s>=80?"Budget Warning":"Available",c=()=>i||s>=80?Fp:cI;return o.jsx(z,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[!t&&o.jsxs(zt,{status:"error",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(z,{children:[o.jsx(oo,{children:"AI Assistant Disabled"}),o.jsx(tn,{children:"Monthly budget has been exceeded. AI features will be available again next month."})]})]}),s>=80&&t&&o.jsxs(zt,{status:"warning",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(z,{children:[o.jsx(oo,{children:"Budget Warning"}),o.jsxs(tn,{children:["You've used ",s.toFixed(1),"% of your monthly budget. Consider reducing usage to avoid exceeding the limit."]})]})]}),o.jsx(z,{p:4,borderWidth:1,borderRadius:"md",bg:r==="dark"?"gray.700":"gray.50",borderColor:r==="dark"?"gray.600":"gray.200",children:o.jsxs(le,{justify:"space-between",align:"center",children:[o.jsxs(le,{spacing:3,children:[o.jsx(lI,{size:20}),o.jsxs(ce,{align:"start",spacing:0,children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",children:"AI Assistant Status"}),o.jsx(E,{fontSize:"xs",color:"gray.500",children:"Powered by Google Gemini"})]})]}),o.jsxs(le,{spacing:4,children:[o.jsxs(ce,{align:"end",spacing:0,children:[o.jsx(E,{fontSize:"xs",color:"gray.500",children:"Monthly Usage"}),o.jsxs(E,{fontSize:"sm",fontWeight:"medium",children:["$",e.monthlyCost.toFixed(4)," / $",e.budgetStatus.budget.toFixed(2)]})]}),o.jsx(wt,{colorScheme:a(),variant:"subtle",size:"sm",children:o.jsxs(le,{spacing:1,children:[nr.createElement(c(),{size:12}),o.jsx(E,{children:l()})]})})]})]})})]})})},II=()=>{const{colorMode:t}=Vt(),e=[{title:"What can I ask about?",content:"You can ask about any aspect of your design system including tokens, components, dimensions, modes, taxonomies, and platform support. The AI understands design system concepts and can help you navigate and understand your data."},{title:"How does cost tracking work?",content:"Each query costs approximately $0.001 per 1,000 tokens. Your monthly budget is $5.00, which allows for hundreds of queries. Cost tracking is automatic and you'll receive warnings when approaching your limit."},{title:"What are the core concepts?",content:"The AI understands 5 core design system concepts: 1) Resolved Value Types (color, font, gap, shadow), 2) Dimensions (groups of modes), 3) Modes (specific options within dimensions), 4) Token Collections (categorization groups), and 5) Aliases (token references)."},{title:"Is my data secure?",content:"Yes, your design system data is processed locally and only sent to Google's Gemini API for AI processing. No data is stored permanently on external servers. All communication is encrypted and follows Google's privacy standards."},{title:"What if I exceed my budget?",content:"If you exceed your $5 monthly budget, AI features will be disabled until the next month. You can continue using all other features of the application normally. Budget resets occur on the 1st of each month."}];return o.jsx(z,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(le,{spacing:2,children:[o.jsx(mI,{size:20}),o.jsx(E,{fontSize:"lg",fontWeight:"medium",children:"Help & Information"})]}),o.jsx(z,{borderWidth:1,borderRadius:"md",bg:t==="dark"?"gray.800":"white",borderColor:t==="dark"?"gray.600":"gray.200",overflow:"hidden",children:o.jsx(Nv,{allowMultiple:!0,children:e.map((r,n)=>o.jsxs(Dv,{children:[o.jsxs(Rv,{py:4,px:4,children:[o.jsx(z,{flex:"1",textAlign:"left",children:o.jsx(E,{fontSize:"sm",fontWeight:"medium",children:r.title})}),o.jsx(Ov,{})]}),o.jsx(_v,{pb:4,px:4,children:o.jsx(E,{fontSize:"sm",color:"gray.600",lineHeight:"1.6",children:r.content})})]},n))})}),o.jsxs(z,{p:4,borderWidth:1,borderRadius:"md",bg:t==="dark"?"blue.900":"blue.50",borderColor:t==="dark"?"blue.700":"blue.200",children:[o.jsxs(le,{spacing:2,mb:2,children:[o.jsx(pI,{size:16}),o.jsx(E,{fontSize:"sm",fontWeight:"medium",color:t==="dark"?"blue.200":"blue.800",children:"Quick Tips"})]}),o.jsxs(ce,{align:"start",spacing:1,children:[o.jsx(E,{fontSize:"xs",color:t==="dark"?"blue.300":"blue.700",children:"â€¢ Be specific in your questions for better responses"}),o.jsx(E,{fontSize:"xs",color:t==="dark"?"blue.300":"blue.700",children:'â€¢ Ask about relationships between concepts (e.g., "How do dimensions relate to modes?")'}),o.jsx(E,{fontSize:"xs",color:t==="dark"?"blue.300":"blue.700",children:"â€¢ Use the suggestion buttons to get started with common questions"}),o.jsx(E,{fontSize:"xs",color:t==="dark"?"blue.300":"blue.700",children:"â€¢ Monitor your usage in the cost display to stay within budget"})]})]})]})})},jI=({onKeyConfigured:t})=>{const[e,r]=M.useState(""),[n,s]=M.useState(!1),[i,a]=M.useState(!1),{colorMode:l}=Vt(),c=Hr();M.useEffect(()=>{localStorage.getItem("gemini-api-key")&&(a(!0),t==null||t())},[t]);const d=()=>{if(!e.trim()){c({title:"API Key Required",description:"Please enter your Gemini API key",status:"error",duration:3e3,isClosable:!0});return}e.startsWith("AIza")||c({title:"Invalid API Key",description:'Gemini API keys typically start with "AIza"',status:"warning",duration:5e3,isClosable:!0}),localStorage.setItem("gemini-api-key",e.trim()),a(!0),c({title:"API Key Saved",description:"Your Gemini API key has been configured successfully",status:"success",duration:3e3,isClosable:!0}),t==null||t()},u=()=>{localStorage.removeItem("gemini-api-key"),a(!1),r(""),c({title:"API Key Removed",description:"Your Gemini API key has been removed",status:"info",duration:3e3,isClosable:!0})};return i?o.jsx(z,{p:4,borderWidth:1,borderRadius:"md",bg:l==="dark"?"green.900":"green.50",borderColor:l==="dark"?"green.700":"green.200",children:o.jsxs(zt,{status:"success",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(z,{flex:"1",children:[o.jsx(oo,{children:"API Key Configured"}),o.jsx(tn,{children:"Your Gemini API key is configured and ready to use."})]}),o.jsx(Oe,{size:"sm",colorScheme:"red",variant:"outline",onClick:u,children:"Remove Key"})]})}):o.jsx(z,{p:4,borderWidth:1,borderRadius:"md",bg:l==="dark"?"blue.900":"blue.50",borderColor:l==="dark"?"blue.700":"blue.200",children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(le,{spacing:2,children:[o.jsx(fI,{size:20}),o.jsx(E,{fontSize:"lg",fontWeight:"medium",children:"Configure Gemini API Key"})]}),o.jsxs(E,{fontSize:"sm",color:l==="dark"?"blue.200":"blue.800",children:["To use the AI Assistant, you need to configure your Gemini API key. Get your key from"," ",o.jsx("a",{href:"https://makersuite.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"underline"},children:"Google AI Studio"}),"."]}),o.jsxs(ce,{spacing:3,align:"stretch",children:[o.jsxs(le,{children:[o.jsx(yt,{type:n?"text":"password",placeholder:"Enter your Gemini API key",value:e,onChange:m=>r(m.target.value),size:"md"}),o.jsx(Oe,{size:"md",variant:"outline",onClick:()=>s(!n),children:n?o.jsx(uI,{size:16}):o.jsx(hI,{size:16})})]}),o.jsx(Oe,{colorScheme:"blue",onClick:d,isDisabled:!e.trim(),children:"Save API Key"})]}),o.jsxs(zt,{status:"info",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(z,{children:[o.jsx(oo,{children:"Security Note"}),o.jsx(tn,{children:"Your API key is stored locally in your browser and is not shared with anyone. You can remove it at any time."})]})]})]})})},TI=["What tokens are available?","What dimensions and modes exist?","List component categories"],EI=({isOpen:t,onToggle:e})=>{const[r,n]=M.useState(!1),[s,i]=M.useState(!1),[a,l]=M.useState(!1),[c,d]=M.useState(!1),{colorMode:u}=Vt(),m=t!==void 0?t:r,g=S=>{t!==void 0?e==null||e(S):n(S)},y=u==="dark"?"gray.800":"white",v=u==="dark"?"gray.700":"gray.200",I=()=>{g(!m)};return M.useEffect(()=>{const S=localStorage.getItem("gemini-api-key");i(!!S)},[]),o.jsxs(z,{position:"relative",h:"100%",w:m?"400px":"64px",bg:y,borderLeft:"1px",borderColor:v,transition:"width 0.2s",display:"flex",flexDirection:"column",children:[o.jsx(z,{px:4,py:3,borderBottom:"1px",borderColor:v,display:"flex",alignItems:"center",justifyContent:"space-between",children:m?o.jsxs(o.Fragment,{children:[o.jsxs(le,{spacing:2,children:[o.jsx(Ay,{size:20}),o.jsx(E,{fontSize:"sm",fontWeight:"bold",children:"AI Assistant"})]}),o.jsx(le,{spacing:2,children:o.jsx(Oe,{size:"sm",variant:"ghost",onClick:I,leftIcon:o.jsx(gb,{size:16}),children:"Collapse"})})]}):o.jsx(Cn,{label:"AI Assistant",placement:"left",children:o.jsx(Bt,{"aria-label":"Open AI Assistant",icon:o.jsx(Ay,{size:20}),size:"sm",variant:"ghost",onClick:I,w:"full"})})}),m&&o.jsxs(ce,{spacing:3,align:"stretch",p:4,flex:1,overflowY:"auto",children:[!s&&o.jsx(jI,{onKeyConfigured:()=>i(!0)}),o.jsxs(le,{spacing:2,justifyContent:"flex-end",children:[o.jsx(Oe,{size:"xs",variant:"ghost",onClick:()=>d(S=>!S),children:c?"Hide details":"Show details"}),o.jsx(Oe,{size:"xs",variant:"ghost",onClick:()=>l(S=>!S),children:a?"Hide help":"Help"})]}),o.jsx(Gm,{in:c,animateOpacity:!0,children:o.jsx(kI,{})}),o.jsx(CI,{suggestions:TI,maxHeight:"100%",showCostInfo:!1}),o.jsx(Gm,{in:a,animateOpacity:!0,children:o.jsx(II,{})})]})]})},Dn="token-model:data-change",MI=({onResetData:t,onExportData:e,isGitHubConnected:r=!1,githubUser:n,selectedRepoInfo:s,onGitHubConnect:i,onGitHubDisconnect:a,onFileSelected:l,onRefreshData:c,currentView:d,onNavigate:u,children:m,isViewOnlyMode:g=!1,urlRepoInfo:y=null,dataSourceContext:v,onPlatformChange:I,onThemeChange:S,isEditMode:b=!1,currentBranch:k="main",editModeBranch:A=null,onBranchCreated:C,onEnterEditMode:T,onExitEditMode:P,editContext:_,onSaveChanges:R,onDiscardChanges:G,pendingOverrides:ne=[]})=>{const{colorMode:he}=Vt(),[te,K]=M.useState(!1),[O,Z]=M.useState(0),[ie,ge]=M.useState(null),[xe,$]=M.useState(null),B=M.useRef({}),U=M.useRef(!1),X=M.useRef(null),ee=M.useCallback(()=>({tokens:L.getTokens(),collections:L.getCollections(),dimensions:L.getDimensions(),themes:L.getThemes(),resolvedValueTypes:L.getValueTypes(),componentProperties:L.getComponentProperties(),componentCategories:L.getComponentCategories(),components:L.getComponents(),taxonomies:L.getTaxonomies(),algorithms:L.getAlgorithms(),platforms:L.getPlatforms()}),[]),be=M.useCallback((se,de)=>{if(!de)return!0;if(!se)return!1;const fe=["tokens","collections","dimensions","themes","resolvedValueTypes","componentProperties","componentCategories","components"];for(const _e of fe){const Y=se[_e],Ce=de[_e];if(!Y&&Ce||Y&&!Ce)return!0;if(Y&&Ce){if(Math.abs(Y.length-Ce.length)>5)return!0;const ue=new Set(Y.map(Te=>{const je=Te;return je==null?void 0:je.id}).filter(Boolean)),Ee=new Set(Ce.map(Te=>{const je=Te;return je==null?void 0:je.id}).filter(Boolean)),ze=ue.size-Array.from(ue).filter(Te=>Ee.has(Te)).length,De=Ee.size-Array.from(Ee).filter(Te=>ue.has(Te)).length,Ke=ze+De,ve=Math.max(ue.size,Ee.size);if(ve>0&&Ke/ve>.5)return!0}}return!1},[]),Se=M.useCallback(()=>{if(!U.current){const fe=ee();ge(fe),$(fe),B.current=fe,U.current=!0,X.current=fe,K(!1),Z(0);return}const se=ee();if(be(se,X.current)){ge(se),$(se),B.current=se,X.current=se,K(!1),Z(0);return}ge(se);const de=Gn.getChangeCount();de>0?(K(!0),Z(de)):(K(!1),Z(0))},[ee,be]),Me=M.useCallback(()=>{const se=ee();ge(se),$(se),B.current=se,X.current=se,K(!1),Z(0)},[ee]);return M.useEffect(()=>{Se()},[]),M.useEffect(()=>{const se=()=>{const de=ee();be(de,X.current)?Me():Se()};return window.addEventListener(Dn,se),()=>window.removeEventListener(Dn,se)},[Se,Me,ee,be]),M.useEffect(()=>{const se=Un.getInstance(),de=fe=>{const _e={tokenCollections:fe.collections,dimensions:fe.dimensions,tokens:fe.tokens,platforms:fe.platforms,themes:fe.themes,taxonomies:fe.taxonomies,resolvedValueTypes:fe.resolvedValueTypes,algorithms:fe.algorithms,taxonomyOrder:fe.taxonomyOrder,dimensionOrder:fe.dimensionOrder,componentProperties:fe.componentProperties,componentCategories:fe.componentCategories,components:fe.components};$(_e),B.current=_e,X.current=_e,K(!1),Z(0)};return se.setCallbacks({onBaselineUpdated:de}),()=>{se.setCallbacks({onBaselineUpdated:void 0})}},[]),M.useEffect(()=>{const se=()=>{Se()};return window.addEventListener("storage",se),()=>window.removeEventListener("storage",se)},[Se]),o.jsxs(vi,{h:"100vh",overflow:"hidden",children:[o.jsx(Kk,{currentView:d,onNavigate:u}),o.jsxs(vi,{flex:"1",direction:"column",overflow:"hidden",children:[o.jsx(Ob,{hasChanges:te,changeCount:O,currentData:ie,baselineData:xe,onResetData:t,onExportData:e,isGitHubConnected:r,githubUser:n,selectedRepoInfo:s,onGitHubConnect:i,onGitHubDisconnect:a,onFileSelected:l,onRefreshData:c,isURLBasedAccess:g,urlRepoInfo:y,dataSourceContext:v,onPlatformChange:I,onThemeChange:S,isEditMode:b,currentBranch:k,onBranchCreated:C,onEnterEditMode:T,onExitEditMode:P,editContext:_,onSaveChanges:R,onDiscardChanges:G,pendingOverrides:ne}),o.jsxs(vi,{flex:"1",overflow:"hidden",children:[o.jsx(z,{flex:"1",overflow:"auto",bg:he==="dark"?"gray.900":"gray.50",children:m}),o.jsx(EI,{})]})]})]})},AI=({isGitHubConnected:t=!1,githubUser:e,selectedRepoInfo:r,onGitHubConnect:n,onGitHubDisconnect:s})=>{const{colorMode:i}=Vt(),a=Hr(),[l,c]=M.useState(!1),[d,u]=M.useState(!1),[m,g]=M.useState(!1),y=async()=>{u(!0);try{await new Promise(A=>setTimeout(A,100)),n&&await n()}catch(A){console.error("GitHub connection error:",A),u(!1),a({title:"GitHub Connection Failed",description:A instanceof Error?A.message:"Failed to connect to GitHub. Please try again.",status:"error",duration:5e3,isClosable:!0})}},v=()=>{s&&s(),c(!1),u(!1),g(!1)},I=(A,C)=>{const T=new URL(window.location.href);T.searchParams.set("repo",A),T.searchParams.set("path",C),T.searchParams.set("branch","main"),window.location.href=T.toString()},S=i==="dark"?"gray.900":"gray.50",b=i==="dark"?"gray.800":"white",k=i==="dark"?"gray.700":"gray.200";return console.log("============================="),console.log(`Signed in? ${t}`),console.log(`User ${e}`),o.jsxs(ce,{width:"100%",align:"stretch",gap:0,children:[o.jsx(z,{as:"header",borderBottom:"1px",borderColor:k,bg:S,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",children:o.jsxs(le,{spacing:2,alignItems:"center",align:"stretch",width:"100%",justifyContent:"space-between",children:[o.jsx(z,{px:4,py:3,display:"flex",gap:2,justifyContent:"center",alignItems:"center",children:o.jsx(Pb,{size:28,color:i==="dark"?"white":"black"})}),e?o.jsxs(Xo,{placement:"bottom-end",isOpen:m,onClose:()=>g(!1),children:[o.jsx(Qo,{children:o.jsx(Bt,{"aria-label":"User Menu",icon:o.jsx(dc,{size:"xs",src:e.avatar_url}),size:"sm",variant:"ghost",onClick:()=>g(!0)})}),o.jsxs(Ai,{p:0,w:"auto",minW:"200px",children:[o.jsx(Yd,{}),o.jsx(Pi,{p:2,children:o.jsxs(ce,{spacing:0,align:"stretch",children:[o.jsx(le,{p:2,mb:2,w:"full",justifyContent:"space-between",alignItems:"center",children:o.jsxs(ce,{spacing:0,align:"flex-start",children:[o.jsx(dc,{size:"lg",src:e.avatar_url,mb:2}),o.jsx(E,{fontSize:"sm",fontWeight:"bold",children:e.login}),o.jsx(E,{fontSize:"xs",color:"gray.500",children:e.email})]})}),o.jsx(on,{mb:2}),o.jsx(Oe,{variant:"ghost",size:"sm",justifyContent:"flex-start",borderRadius:0,onClick:()=>{window.open(`https://github.com/${e.login}`,"_blank"),g(!1)},children:"View Profile"}),r&&o.jsx(Oe,{variant:"ghost",size:"sm",justifyContent:"flex-start",borderRadius:0,onClick:()=>{window.open(`https://github.com/${r.fullName}/pulls?q=author:${e.login}`,"_blank"),g(!1)},children:"My Pull Requests"}),o.jsx(Oe,{variant:"ghost",size:"sm",justifyContent:"flex-start",borderRadius:0,colorScheme:"red",onClick:()=>{v(),g(!1)},children:"Sign out"})]})})]})]}):o.jsx(Oe,{size:"sm",variant:"outline",onClick:y,isLoading:d,isDisabled:d,leftIcon:d?o.jsx(kn,{size:"sm"}):o.jsx(Pp,{size:16}),children:"Sign in"})]})}),o.jsxs(z,{minH:"100vh",bg:S,display:"flex",alignItems:"flex-start",justifyContent:"center",p:4,pt:64,children:[o.jsxs(ce,{spacing:8,w:"full",children:[o.jsxs(ce,{spacing:4,textAlign:"center",mb:8,children:[o.jsx(Tt,{size:"2xl",fontWeight:900,color:i==="dark"?"white":"gray.800",mb:4,children:"Design System Foundry"}),o.jsx(E,{fontSize:16,color:i==="dark"?"gray.300":"gray.600",children:"Sophisticated design data management system for design system professionals."})]}),o.jsx(ce,{spacing:6,maxW:"lg",w:"full",children:o.jsxs(Zn,{w:"full",bg:b,children:[o.jsx(ss,{pb:2,children:o.jsx(Tt,{size:"md",children:"Load from GitHub"})}),o.jsx(Xn,{pt:0,children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontSize:"sm",color:"gray.500",children:"Enter a GitHub repository URL to load its design system"}),o.jsx(Oe,{leftIcon:o.jsx(Bf,{size:16}),onClick:()=>c(!0),colorScheme:"green",children:"Load Design System"})]})})]})})]}),o.jsx(Rb,{isOpen:l,onClose:()=>c(!1),onDesignSystemSelected:I})]})]})},va=class va{constructor(){}static getInstance(){return va.instance||(va.instance=new va),va.instance}static updateURLWithContext(e){console.log("[URLStateManager] Updating URL with context:",e);try{const r=new URL(window.location.href);r.searchParams.set("repo",e.fullName),r.searchParams.set("branch",e.branch),r.searchParams.set("path",e.filePath);const s=xr.getInstance().getCurrentContext();s.currentPlatform&&s.currentPlatform!=="none"?r.searchParams.set("platform",s.currentPlatform):r.searchParams.delete("platform"),s.currentTheme&&s.currentTheme!=="none"?r.searchParams.set("theme",s.currentTheme):r.searchParams.delete("theme"),window.history.replaceState({},"",r.toString()),console.log("[URLStateManager] URL updated successfully")}catch(r){console.error("[URLStateManager] Error updating URL:",r)}}static loadContextFromURL(){console.log("[URLStateManager] Loading context from URL");try{const e=new URLSearchParams(window.location.search),r=e.get("repo"),n=e.get("branch"),s=e.get("path");if(!r||!n||!s)return console.log("[URLStateManager] Missing required URL parameters"),null;const i={fullName:r,branch:n,filePath:s,fileType:this.determineFileType(s)};return console.log("[URLStateManager] Loaded context from URL:",i),i}catch(e){return console.error("[URLStateManager] Error loading context from URL:",e),null}}static updateURLWithEditMode(e,r){console.log("[URLStateManager] Updating URL with edit mode:",{isEditMode:e,editBranch:r});try{const n=new URL(window.location.href);e&&r&&n.searchParams.set("branch",r),window.history.replaceState({},"",n.toString()),console.log("[URLStateManager] URL updated with edit mode (branch only)")}catch(n){console.error("[URLStateManager] Error updating URL with edit mode:",n)}}static syncURLWithCurrentState(){console.log("[URLStateManager] Syncing URL with current state");try{const e=Sn.getInstance(),r=e.getCurrentRepositoryContext(),n=e.getCurrentEditMode();r&&this.updateURLWithContext(r),n.isActive&&this.updateURLWithEditMode(!0,n.branch),console.log("[URLStateManager] URL synced with current state")}catch(e){console.error("[URLStateManager] Error syncing URL with current state:",e)}}static getCurrentURLParams(){try{const e=new URLSearchParams(window.location.search);return{repo:e.get("repo"),branch:e.get("branch"),path:e.get("path"),platform:e.get("platform"),theme:e.get("theme")}}catch(e){return console.error("[URLStateManager] Error getting URL parameters:",e),{repo:null,branch:null,path:null,platform:null,theme:null}}}static hasURLChanged(){try{const e=this.loadContextFromURL(),n=Sn.getInstance().getCurrentRepositoryContext();return!e&&!n?!1:!e||!n?!0:e.fullName!==n.fullName||e.branch!==n.branch||e.filePath!==n.filePath||e.fileType!==n.fileType}catch(e){return console.error("[URLStateManager] Error checking if URL changed:",e),!1}}static resetURLToMainBranch(){console.log("[URLStateManager] Resetting URL to main branch");try{const e=new URL(window.location.href);e.searchParams.set("branch","main"),window.history.replaceState({},"",e.toString()),console.log("[URLStateManager] URL reset to main branch")}catch(e){console.error("[URLStateManager] Error resetting URL to main branch:",e)}}static updateURLWithPlatformTheme(e,r){console.log("[URLStateManager] Updating URL with platform/theme:",{platform:e,theme:r});try{const n=new URL(window.location.href);e&&e!=="none"?n.searchParams.set("platform",e):n.searchParams.delete("platform"),r&&r!=="none"?n.searchParams.set("theme",r):n.searchParams.delete("theme"),window.history.replaceState({},"",n.toString()),console.log("[URLStateManager] URL updated with platform/theme")}catch(n){console.error("[URLStateManager] Error updating URL with platform/theme:",n)}}static determineFileType(e){const r=e.toLowerCase();return r.includes("platform-extension")||r.includes("platform_extension")?"platform-extension":r.includes("theme-override")||r.includes("theme_override")?"theme-override":"schema"}static getCleanURL(){try{return new URL(window.location.href).toString()}catch(e){return console.error("[URLStateManager] Error getting clean URL:",e),window.location.href}}static navigateToURL(e,r=!0){console.log("[URLStateManager] Navigating to URL:",e);try{r?window.history.replaceState({},"",e):window.history.pushState({},"",e),console.log("[URLStateManager] Navigation completed")}catch(n){console.error("[URLStateManager] Error navigating to URL:",n)}}static addURLChangeListener(e){const r=()=>{console.log("[URLStateManager] URL changed via browser navigation"),e()};return window.addEventListener("popstate",r),()=>{window.removeEventListener("popstate",r)}}};rt(va,"instance");let Su=va;const Vy=()=>{const t=Zw(),e=Hr(),[r,n]=M.useState("loading"),[s,i]=M.useState(""),a=M.useRef(!1);M.useEffect(()=>{(async()=>{if(!a.current){a.current=!0;try{const u=new URLSearchParams(window.location.search),m=u.get("code"),g=u.get("state"),y=u.get("error");if(y)throw new Error(`GitHub authorization error: ${y}`);if(!m||!g){if(Yt.isAuthenticated()){n("success"),t("/");return}throw new Error("Missing authorization code or state parameter")}const v=await Yt.handleCallback(m,g);n("success"),window.dispatchEvent(new CustomEvent("github:oauth-complete",{detail:{user:v}}));const I=new URLSearchParams(window.location.search),S=I.get("repo"),b=I.get("path"),k=I.get("branch")||"main",A=I.get("platform"),C=I.get("theme");if(S&&b){console.log("[GitHubCallback] URL parameters detected, checking permissions and loading data");try{const{GitHubApiService:T}=await ir(async()=>{const{GitHubApiService:_}=await Promise.resolve().then(()=>fo);return{GitHubApiService:_}},void 0);if(await T.hasWriteAccessToRepository(S)){console.log("[GitHubCallback] User has write access, loading with read/write UX");const _=await T.getFileContent(S,b,k),R=JSON.parse(_.content),G=b.includes("theme")?"theme-override":"schema",{DataManager:ne}=await ir(async()=>{const{DataManager:O}=await Promise.resolve().then(()=>oc);return{DataManager:O}},void 0);await ne.getInstance().loadFromGitHub(R,G),Gn.updateLastGitHubSync(),window.dispatchEvent(new CustomEvent("github:file-loaded")),window.dispatchEvent(new CustomEvent("token-model:data-change"));const te=xr.getInstance();(A||C)&&(console.log("[GitHubCallback] Initializing data source context from URL parameters:",{platform:A,theme:C}),te.initializeFromURL(),Su.updateURLWithPlatformTheme(A||null,C||null)),window.dispatchEvent(new CustomEvent("github:permissions-checked",{detail:{hasWriteAccess:!0,repoInfo:{fullName:S,branch:k,filePath:b,fileType:G}}})),e({title:"Signed in with Write Access",description:`Successfully signed in as ${v.login} with write access to ${S}`,status:"success",duration:5e3,isClosable:!0});const K=localStorage.getItem("github_oauth_original_url_context");if(K)try{const O=JSON.parse(K),Z=new URL(window.location.origin);O.repo&&Z.searchParams.set("repo",O.repo),O.branch&&Z.searchParams.set("branch",O.branch),O.path&&Z.searchParams.set("path",O.path),O.platform&&Z.searchParams.set("platform",O.platform),O.theme&&Z.searchParams.set("theme",O.theme),console.log("[GitHubCallback] Restoring original URL context:",O),localStorage.removeItem("github_oauth_original_url_context"),window.location.href=Z.toString();return}catch(O){console.error("[GitHubCallback] Error restoring URL context:",O)}t("/")}else{console.log("[GitHubCallback] User has view-only access, loading with view-only UX");const _=await T.getFileContent(S,b,k),R=JSON.parse(_.content),G=b.includes("theme")?"theme-override":"schema",{DataManager:ne}=await ir(async()=>{const{DataManager:O}=await Promise.resolve().then(()=>oc);return{DataManager:O}},void 0);await ne.getInstance().loadFromGitHub(R,G),Gn.updateLastGitHubSync(),window.dispatchEvent(new CustomEvent("github:file-loaded")),window.dispatchEvent(new CustomEvent("token-model:data-change"));const te=xr.getInstance();(A||C)&&(console.log("[GitHubCallback] Initializing data source context from URL parameters (view-only):",{platform:A,theme:C}),te.initializeFromURL(),Su.updateURLWithPlatformTheme(A||null,C||null)),window.dispatchEvent(new CustomEvent("github:permissions-checked",{detail:{hasWriteAccess:!1,repoInfo:{fullName:S,branch:k,filePath:b,fileType:G}}})),e({title:"Signed in with View-Only Access",description:`Successfully signed in as ${v.login} with view-only access to ${S}`,status:"info",duration:5e3,isClosable:!0});const K=localStorage.getItem("github_oauth_original_url_context");if(K)try{const O=JSON.parse(K),Z=new URL(window.location.origin);O.repo&&Z.searchParams.set("repo",O.repo),O.branch&&Z.searchParams.set("branch",O.branch),O.path&&Z.searchParams.set("path",O.path),O.platform&&Z.searchParams.set("platform",O.platform),O.theme&&Z.searchParams.set("theme",O.theme),console.log("[GitHubCallback] Restoring original URL context (view-only):",O),localStorage.removeItem("github_oauth_original_url_context"),window.location.href=Z.toString();return}catch(O){console.error("[GitHubCallback] Error restoring URL context (view-only):",O)}t("/")}}catch(T){console.error("[GitHubCallback] Error checking permissions or loading data:",T),e({title:"Signed in with View-Only Access",description:`Successfully signed in as ${v.login}. Assuming view-only access due to error: ${T instanceof Error?T.message:"Unknown error"}`,status:"warning",duration:5e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("github:permissions-checked",{detail:{hasWriteAccess:!1,repoInfo:{fullName:S,branch:k,filePath:b,fileType:b.includes("theme")?"theme-override":"schema"}}}));const P=localStorage.getItem("github_oauth_original_url_context");if(P)try{const _=JSON.parse(P),R=new URL(window.location.origin);_.repo&&R.searchParams.set("repo",_.repo),_.branch&&R.searchParams.set("branch",_.branch),_.path&&R.searchParams.set("path",_.path),_.platform&&R.searchParams.set("platform",_.platform),_.theme&&R.searchParams.set("theme",_.theme),console.log("[GitHubCallback] Restoring original URL context (error fallback):",_),localStorage.removeItem("github_oauth_original_url_context"),window.location.href=R.toString();return}catch(_){console.error("[GitHubCallback] Error restoring URL context (error fallback):",_)}t("/")}}else console.log("[GitHubCallback] No URL parameters, showing repository selector"),e({title:"Signed in",description:`Successfully signed in as ${v.login}`,status:"success",duration:5e3,isClosable:!0}),t("/")}catch(u){console.error("GitHub callback error:",u),i(u instanceof Error?u.message:"Unknown error occurred"),n("error"),a.current=!1}}})()},[t,e]);const l=async()=>{Yt.logout(),Yt.clearOAuthState(),await Yt.initiateAuth()},c=async()=>{Yt.logout(),Yt.clearOAuthState(),localStorage.removeItem("github_selected_repo"),await Yt.initiateAuth()};return r==="loading"?o.jsx(z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column",children:o.jsxs(ce,{spacing:4,children:[o.jsx(kn,{size:"xl"}),o.jsx(E,{children:"Connecting to GitHub..."})]})}):r==="error"?o.jsx(z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column",p:8,children:o.jsxs(ce,{spacing:6,maxW:"md",children:[o.jsxs(zt,{status:"error",children:[o.jsx(Lt,{}),o.jsxs(z,{children:[o.jsx(oo,{children:"GitHub Connection Failed"}),o.jsx(tn,{children:s})]})]}),o.jsxs(ce,{spacing:3,children:[o.jsx(Oe,{colorScheme:"blue",onClick:l,children:"Retry GitHub Connection"}),o.jsx(Oe,{variant:"outline",onClick:c,children:"Clear All & Retry"}),Yt.isAuthenticated()&&o.jsx(Oe,{variant:"outline",onClick:()=>t("/"),children:"Go to App"}),o.jsx(Oe,{variant:"ghost",onClick:()=>t("/"),children:"Return to App"})]})]})}):o.jsx(z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column",p:8,children:o.jsxs(ce,{spacing:6,maxW:"md",children:[o.jsxs(zt,{status:"success",children:[o.jsx(Lt,{}),o.jsxs(z,{children:[o.jsx(oo,{children:"GitHub Connected Successfully"}),o.jsx(tn,{children:"Please select a repository and file to load."})]})]}),o.jsx(kn,{size:"md"})]})})},PI=({isLoading:t,children:e,minDisplayTime:r=600})=>{const{colorMode:n}=Vt(),[s,i]=M.useState(!1),[a,l]=M.useState(!0),[c,d]=M.useState(null);return M.useEffect(()=>{if(t)l(!1),i(!0),d(Date.now());else if(c){const u=Date.now()-c,m=Math.max(0,r-u);if(m>0){const g=setTimeout(()=>{i(!1),l(!0),d(null)},m);return()=>clearTimeout(g)}else i(!1),l(!0),d(null)}else l(!0)},[t,r,c]),o.jsxs(z,{position:"relative",w:"full",h:"full",children:[s&&o.jsx(z,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:n==="dark"?"gray.800":"white",zIndex:10,opacity:s?1:0,transition:"opacity 0.3s ease-in-out",children:o.jsx(Ew,{isIndeterminate:!0,size:"100px",thickness:"4px",color:"blue.500"})}),o.jsx(z,{opacity:a?1:0,transition:"opacity 0.3s ease-in-out",w:"full",h:"full",children:e})]})},ba=class ba{constructor(){rt(this,"cache",new Map);rt(this,"CACHE_DURATION",5*60*1e3)}static getInstance(){return ba.instance||(ba.instance=new ba),ba.instance}async getCachedThemeAnalytics(e,r){const n=e.map(c=>{const d=c.overrideSource?`${c.overrideSource.repositoryUri}:${c.overrideSource.filePath}`:"no-override";return`${c.id}:${d}`}).join("|"),s=r.length.toString(),i=`theme-analytics-${e.length}-${s}-${n}`,a=this.cache.get(i);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return a.data;const l=await this.calculateThemeAnalytics(e,r);return this.cache.set(i,{data:l,timestamp:Date.now()}),l}async calculateThemeAnalytics(e,r){var l;const n=[];let s=0,i=0;const a=r.filter(c=>c.themeable).length;for(const c of e){if(!c.overrideSource){n.push({themeId:c.id,themeName:c.displayName,tokenOverridesCount:0,percentOfThemeableTokens:0,hasError:!1});continue}try{const d=await ml.getThemeOverrideData(c.overrideSource.repositoryUri,c.overrideSource.filePath,"main",c.id);if(d.data&&(d.source==="github"||d.source==="cache")){const u=((l=d.data.tokenOverrides)==null?void 0:l.length)||0;u>0&&(i++,s+=u);const m=a>0?u/a*100:0;n.push({themeId:c.id,themeName:c.displayName,version:d.data.version,tokenOverridesCount:u,percentOfThemeableTokens:m,hasError:!1})}else n.push({themeId:c.id,themeName:c.displayName,tokenOverridesCount:0,percentOfThemeableTokens:0,hasError:!0,errorType:"file-not-found",errorMessage:"Theme override file not found"})}catch(d){console.error(`Error loading theme override data for ${c.displayName}:`,d);let u="file-not-found",m="Unknown error occurred";d instanceof Error&&(d.message.includes("404")||d.message.includes("not found")?(u="file-not-found",m="Theme override file not found"):d.message.includes("403")||d.message.includes("private")?(u="private-repository",m="Private repository - sign in with GitHub to access"):d.message.includes("validation")?(u="validation-error",m="Theme override data validation failed"):m=d.message),n.push({themeId:c.id,themeName:c.displayName,tokenOverridesCount:0,percentOfThemeableTokens:0,hasError:!0,errorType:u,errorMessage:m})}}return{totalThemes:e.length,themesWithOverrides:i,totalTokenOverrides:s,themeableTokensInCore:a,themeAnalytics:n}}clearCache(){this.cache.clear()}clearCacheForThemes(e){for(const[r]of this.cache)e.some(n=>r.includes(n))&&this.cache.delete(r)}};rt(ba,"instance");let Vp=ba;const Sa=class Sa{constructor(){rt(this,"cache",new Map);rt(this,"CACHE_DURATION",5*60*1e3)}static getInstance(){return Sa.instance||(Sa.instance=new Sa),Sa.instance}async getCachedGitHubAnalytics(e,r){let n=null,s;if(e.editMode.isActive){const{editMode:l}=e;if(l.targetRepository)if(n={fullName:l.targetRepository.fullName,branch:l.targetRepository.branch},l.sourceType==="platform-extension"&&l.sourceId){const c=e.availablePlatforms.find(d=>d.id===l.sourceId);s=`${r} - ${(c==null?void 0:c.displayName)||l.sourceId}`}else if(l.sourceType==="theme-override"&&l.sourceId){const c=e.availableThemes.find(d=>d.id===l.sourceId);s=`${r} - ${(c==null?void 0:c.displayName)||l.sourceId}`}else s=`${r} (core)`;else return null}else if(e.currentPlatform&&e.currentPlatform!=="none"){const l=e.availablePlatforms.find(d=>d.id===e.currentPlatform),c=e.repositories.platforms[e.currentPlatform];if(c)n={fullName:c.fullName,branch:c.branch},s=`${r} - ${(l==null?void 0:l.displayName)||e.currentPlatform}`;else return null}else if(e.currentTheme&&e.currentTheme!=="none"){const l=e.availableThemes.find(d=>d.id===e.currentTheme),c=e.repositories.themes[e.currentTheme];if(c)n={fullName:c.fullName,branch:c.branch},s=`${r} - ${(l==null?void 0:l.displayName)||e.currentTheme}`;else return null}else{const l=e.repositories.core;if(l)n={fullName:l.fullName,branch:l.branch},s=`${r} (core)`;else return null}if(!n)return null;const i=`github-analytics-${n.fullName}-${n.branch}`,a=this.cache.get(i);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return{...a.data,sourceName:s};try{const l=await this.fetchGitHubAnalytics(n);return this.cache.set(i,{data:{...l,sourceName:s},timestamp:Date.now()}),{...l,sourceName:s}}catch(l){return console.error("Failed to fetch GitHub analytics:",l),null}}async fetchGitHubAnalytics(e){const[r,n]=await Promise.all([this.fetchReleases(e.fullName),this.fetchCommits(e.fullName,e.branch)]);return{releases:r,commits:n,repositoryUrl:`https://github.com/${e.fullName}`}}async fetchReleases(e){try{const r=await fetch(`https://api.github.com/repos/${e}/releases?per_page=10&page=1`);if(!r.ok){if(r.status===404)return[];throw new Error(`Failed to fetch releases: ${r.status} ${r.statusText}`)}return(await r.json()).map(s=>({id:s.id,name:s.name||s.tag_name,tag_name:s.tag_name,published_at:s.published_at,html_url:s.html_url,body:s.body}))}catch(r){return console.error("Error fetching releases:",r),[]}}async fetchCommits(e,r){try{const n=await fetch(`https://api.github.com/repos/${e}/commits?sha=${r}&per_page=10&page=1`);if(!n.ok){if(n.status===404)return[];throw new Error(`Failed to fetch commits: ${n.status} ${n.statusText}`)}return(await n.json()).map(i=>({sha:i.sha,commit:{message:i.commit.message,author:{name:i.commit.author.name,email:i.commit.author.email,date:i.commit.author.date}},html_url:i.html_url}))}catch(n){return console.error("Error fetching commits:",n),[]}}clearCache(){this.cache.clear()}clearCacheForRepository(e){for(const[r]of this.cache)r.includes(e)&&this.cache.delete(r)}};rt(Sa,"instance");let wu=Sa;function NI(t){const e=t.length,r=t.filter(a=>a.private).length,n=e-r,s=t.filter(a=>a.themeable).length,i=e-s;return{total:e,privateCount:r,publicCount:n,privatePercent:e?r/e*100:0,publicPercent:e?n/e*100:0,themeableCount:s,nonThemeableCount:i,themeablePercent:e?s/e*100:0,nonThemeablePercent:e?i/e*100:0}}async function DI(t){console.log("[DashboardStats] getPlatformExtensionStats called with platforms:",{count:t.length,platforms:t.map(e=>({id:e.id,displayName:e.displayName}))});try{const e=eu.getInstance();console.log("[DashboardStats] Calling getCachedPlatformExtensionAnalytics...");const r=await e.getCachedPlatformExtensionAnalytics(t);return console.log("[DashboardStats] getCachedPlatformExtensionAnalytics returned:",{totalPlatforms:r.totalPlatforms,platformsWithExtensions:r.platformsWithExtensions,platformAnalyticsCount:r.platformAnalytics.length,platformAnalytics:r.platformAnalytics.map(n=>({platformId:n.platformId,platformName:n.platformName,hasError:n.hasError,errorType:n.errorType}))}),r}catch(e){return console.error("[DashboardStats] Failed to get platform extension stats:",e),{totalPlatforms:t.length,platformsWithExtensions:0,totalTokenOverrides:0,totalAlgorithmOverrides:0,totalOmittedModes:0,totalOmittedDimensions:0,platformAnalytics:[]}}}async function RI(t,e){try{return await Vp.getInstance().getCachedThemeAnalytics(t,e)}catch(r){return console.error("Failed to get theme stats:",r),{totalThemes:t.length,themesWithOverrides:0,totalTokenOverrides:0,themeableTokensInCore:e.filter(n=>n.themeable).length,themeAnalytics:[]}}}async function OI(t,e){try{const n=await wu.getInstance().getCachedGitHubAnalytics(t,e);if(!n||n.releases.length===0)return{version:"No releases found",date:"N/A",sourceName:(n==null?void 0:n.sourceName)||"Unknown",repositoryUrl:(n==null?void 0:n.repositoryUrl)||"#"};const s=n.releases[0];return{version:s.name,date:new Date(s.published_at).toLocaleDateString(),sourceName:n.sourceName,repositoryUrl:n.repositoryUrl,releaseUrl:s.html_url}}catch(r){return console.error("Failed to get latest release:",r),{version:"Error loading releases",date:"N/A",sourceName:"Unknown",repositoryUrl:"#"}}}async function _I(t,e){try{const n=await wu.getInstance().getCachedGitHubAnalytics(t,e);return!n||n.commits.length===0?{commits:[],sourceName:(n==null?void 0:n.sourceName)||"Unknown",repositoryUrl:(n==null?void 0:n.repositoryUrl)||"#"}:{commits:n.commits.map((i,a)=>({id:a+1,sha:i.sha.substring(0,7),message:i.commit.message.split(`
`)[0],date:new Date(i.commit.author.date).toLocaleDateString(),author:i.commit.author.name,commitUrl:i.html_url})),sourceName:n.sourceName,repositoryUrl:n.repositoryUrl}}catch(r){return console.error("Failed to get recent activity:",r),{commits:[],sourceName:"Unknown",repositoryUrl:"#"}}}const $y=({tokens:t,platforms:e,themes:r,componentCategories:n,componentProperties:s,components:i,githubUser:a,dataSourceContext:l})=>{var be,Se,Me;const{colorMode:c}=Vt(),d=L.getCoreData(),u=M.useMemo(()=>((d==null?void 0:d.platforms)||[]).map(de=>de.id).sort().join(","),[d==null?void 0:d.platforms]),m=M.useMemo(()=>e.map(se=>se.id).sort().join(","),[e]),g=M.useMemo(()=>{const se=(d==null?void 0:d.platforms)||[],de=se.length>0?se:e;return console.log("[DashboardView] useMemo platformsForAnalytics recalculated:",{platformsFromCoreLength:se.length,propsPlatformsLength:e.length,resultLength:de.length,resultPlatforms:de.map(fe=>({id:fe.id,displayName:fe.displayName})),coreDataExists:!!d,coreDataPlatformsExists:!!(d!=null&&d.platforms),corePlatformsKey:u,propsPlatformsKey:m}),de},[u,m,(be=d==null?void 0:d.platforms)==null?void 0:be.length,e.length]),[y,v]=M.useState(null),[I,S]=M.useState(!1),[b,k]=M.useState(null),[A,C]=M.useState(null),[T,P]=M.useState(!1),[_,R]=M.useState(null),[G,ne]=M.useState(null),[he,te]=M.useState(null),[K,O]=M.useState(!1),[Z,ie]=M.useState(null),ge=NI(t),xe={counts:{categories:n.length,properties:s.length,components:i.length},validation:{errorCount:0},recentChanges:{lastModified:new Date().toISOString()}},$={boolean:s.filter(se=>se.type==="boolean").length,list:s.filter(se=>se.type==="list").length},B=n.map(se=>({categoryName:se.displayName,count:i.filter(de=>de.componentCategoryId===se.id).length}));M.useEffect(()=>{var de;console.log("[DashboardView] Platform analytics useEffect triggered:",{platformsForAnalyticsLength:g.length,platformsForAnalytics:g.map(fe=>({id:fe.id,displayName:fe.displayName})),coreDataPlatformsLength:((de=d==null?void 0:d.platforms)==null?void 0:de.length)||0,propsPlatformsLength:e.length}),(async()=>{if(g.length===0){console.log("[DashboardView] No platforms for analytics, skipping load");return}console.log("[DashboardView] Starting platform extension stats load..."),S(!0),k(null);try{console.log("[DashboardView] Waiting 100ms before loading stats..."),await new Promise(_e=>setTimeout(_e,100)),console.log("[DashboardView] Calling getPlatformExtensionStats...");const fe=await DI(g);console.log("[DashboardView] Platform extension stats loaded successfully:",{totalPlatforms:fe.totalPlatforms,platformsWithExtensions:fe.platformsWithExtensions,platformAnalyticsCount:fe.platformAnalytics.length}),v(fe)}catch(fe){console.error("[DashboardView] Failed to load platform extension stats:",fe),k(fe instanceof Error?fe.message:"Failed to load platform extension stats")}finally{console.log("[DashboardView] Setting loadingPlatformStats to false"),S(!1)}})()},[g]),M.useEffect(()=>{(async()=>{if(r.length!==0){P(!0),R(null);try{await new Promise(fe=>setTimeout(fe,100));const de=await RI(r,t);C(de)}catch(de){R(de instanceof Error?de.message:"Failed to load theme analytics")}finally{P(!1)}}})()},[r,t]),M.useEffect(()=>{(async()=>{if(l){O(!0),ie(null);try{await new Promise(Y=>setTimeout(Y,100));const de=(d==null?void 0:d.systemName)||"Design System",[fe,_e]=await Promise.all([OI(l,de),_I(l,de)]);ne(fe),te(_e)}catch(de){ie(de instanceof Error?de.message:"Failed to load GitHub analytics")}finally{O(!1)}}})()},[l,d]);const U=()=>a&&a.name?`Welcome, ${a.name.split(" ")[0]}`:"Dashboard",[X,ee]=nr.useState("");return nr.useEffect(()=>{if(y!=null&&y.platformAnalytics){const se=y.platformAnalytics.find(de=>de.hasError);ee(se?`${se.platformName}: ${se.errorMessage||"File or repository is not found"}`:"")}},[y]),o.jsxs(z,{p:0,borderWidth:0,borderRadius:"md",bg:c==="dark"?"gray.900":"gray.50",children:[o.jsxs(z,{p:8,children:[o.jsx(Tt,{size:"xl",mb:8,children:U()}),b&&o.jsxs(zt,{status:"error",mb:4,children:[o.jsx(Lt,{}),b]}),_&&o.jsxs(zt,{status:"error",mb:4,children:[o.jsx(Lt,{}),_]}),((Se=y==null?void 0:y.platformAnalytics)==null?void 0:Se.some(se=>se.errorType==="private-repository"))&&o.jsxs(zt,{status:"info",mb:4,children:[o.jsx(Lt,{}),o.jsxs(z,{children:[o.jsx(oo,{children:"Private Repositories Detected"}),o.jsx(tn,{children:"Some platform extensions are in private repositories. Sign in with GitHub to access them."})]})]}),((Me=A==null?void 0:A.themeAnalytics)==null?void 0:Me.some(se=>se.errorType==="private-repository"))&&o.jsxs(zt,{status:"info",mb:4,children:[o.jsx(Lt,{}),o.jsxs(z,{children:[o.jsx(oo,{children:"Private Theme Repositories Detected"}),o.jsx(tn,{children:"Some theme overrides are in private repositories. Sign in with GitHub to access them."})]})]}),o.jsxs(Qs,{minChildWidth:"550px",spacing:8,mb:8,children:[o.jsxs(z,{p:6,borderWidth:1,borderRadius:"md",bg:"chakra-body-bg",children:[o.jsx(Tt,{size:"md",mb:4,children:"Tokens"}),o.jsxs(Qs,{columns:2,spacing:4,mb:4,children:[o.jsxs(un,{children:[o.jsx(hn,{children:"Total"}),o.jsx(mn,{children:ge.total})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Private"}),o.jsx(mn,{children:ge.privateCount}),o.jsxs(rs,{children:[ge.privatePercent.toFixed(1),"%"]})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Public"}),o.jsx(mn,{children:ge.publicCount}),o.jsxs(rs,{children:[ge.publicPercent.toFixed(1),"%"]})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Themeable"}),o.jsx(mn,{children:ge.themeableCount}),o.jsxs(rs,{children:[ge.themeablePercent.toFixed(1),"%"]})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Not Themeable"}),o.jsx(mn,{children:ge.nonThemeableCount}),o.jsxs(rs,{children:[ge.nonThemeablePercent.toFixed(1),"%"]})]})]})]}),o.jsxs(z,{p:6,borderWidth:1,borderRadius:"md",bg:"chakra-body-bg",children:[o.jsx(Tt,{size:"md",mb:4,children:"Platforms"}),I?o.jsxs(ce,{spacing:4,children:[o.jsx(kn,{}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:"Loading platform extension analytics..."}),o.jsx(E,{fontSize:"xs",color:"gray.400",children:"This may take a moment for external repositories"})]}):y?o.jsxs(ce,{align:"start",spacing:4,children:[o.jsxs(Qs,{columns:2,spacing:4,width:"100%",children:[o.jsxs(un,{children:[o.jsx(hn,{children:"Platforms with Extensions"}),o.jsx(mn,{children:y.platformsWithExtensions}),o.jsxs(rs,{children:["of ",y.totalPlatforms," total"]})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Total Token Overrides"}),o.jsx(mn,{children:y.totalTokenOverrides})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Algorithm Overrides"}),o.jsx(mn,{children:y.totalAlgorithmOverrides})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Omitted Items"}),o.jsx(mn,{children:y.totalOmittedModes+y.totalOmittedDimensions}),o.jsxs(rs,{children:["Modes: ",y.totalOmittedModes,", Dimensions: ",y.totalOmittedDimensions]})]})]}),y.platformAnalytics.length>0&&o.jsxs(o.Fragment,{children:[o.jsx(on,{}),o.jsx(E,{fontSize:"sm",fontWeight:"bold",children:"Platform Details"}),o.jsxs(ho,{size:"sm",variant:"simple",width:"100%",children:[o.jsx(jo,{children:o.jsxs(Nn,{children:[o.jsx(br,{children:"Platform"}),o.jsx(br,{children:"Version"}),o.jsx(br,{isNumeric:!0,children:"Token Overrides"}),o.jsx(br,{isNumeric:!0,children:"Algorithm Overrides"}),o.jsx(br,{isNumeric:!0,children:"Omitted"}),o.jsx(br,{children:"Status"})]})}),o.jsx(mo,{children:y.platformAnalytics.map(se=>o.jsxs(Nn,{children:[o.jsx(fr,{children:o.jsxs(le,{spacing:2,children:[o.jsx(E,{children:se.platformName}),se.hasError&&o.jsx(Cn,{label:se.errorType==="private-repository"?"Private repository - sign in with GitHub to access":se.errorMessage||"File or repository is not found","aria-label":`Error for ${se.platformName}: ${se.errorType==="private-repository"?"Private repository - sign in with GitHub to access":se.errorMessage||"File or repository is not found"}`,hasArrow:!0,placement:"top",children:o.jsx(E,{as:"span",color:se.errorType==="private-repository"?"orange.500":"red.500",fontWeight:"bold","aria-live":"polite","aria-label":`Error: ${se.errorType==="private-repository"?"Private repository - sign in with GitHub to access":se.errorMessage||"File or repository is not found"}`,tabIndex:0,ml:1,children:o.jsx(Ro,{size:14})})})]})}),o.jsx(fr,{children:se.hasError?"-":se.version||"N/A"}),o.jsx(fr,{isNumeric:!0,children:se.hasError?"-":se.tokenOverridesCount}),o.jsx(fr,{isNumeric:!0,children:se.hasError?"-":se.algorithmVariableOverridesCount}),o.jsx(fr,{isNumeric:!0,children:se.hasError?"-":se.omittedModesCount+se.omittedDimensionsCount}),o.jsx(fr,{children:se.hasError?o.jsx(Yn,{colorScheme:se.errorType==="private-repository"?"orange":"red",size:"sm",children:se.errorType==="private-repository"?"Private":"Not found"}):o.jsx(Yn,{colorScheme:"green",size:"sm",children:"OK"})})]},se.platformId))})]})]})]}):o.jsxs(ce,{spacing:2,children:[o.jsx(E,{fontSize:"sm",color:"gray.500",children:"No platform extension data available"}),o.jsx(E,{fontSize:"xs",color:"gray.400",children:"Platform extensions are loaded from external repositories"})]})]}),o.jsxs(z,{p:6,borderWidth:1,borderRadius:"md",bg:"chakra-body-bg",children:[o.jsx(Tt,{size:"md",mb:4,children:"Themes"}),T?o.jsxs(ce,{spacing:4,children:[o.jsx(kn,{}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:"Loading theme analytics..."}),o.jsx(E,{fontSize:"xs",color:"gray.400",children:"This may take a moment for external repositories"})]}):A?o.jsxs(ce,{align:"start",spacing:4,children:[o.jsxs(Qs,{columns:2,spacing:4,width:"100%",children:[o.jsxs(un,{children:[o.jsx(hn,{children:"Total Themes"}),o.jsx(mn,{children:A.totalThemes})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Themes with Overrides"}),o.jsx(mn,{children:A.themesWithOverrides}),o.jsxs(rs,{children:["of ",A.totalThemes," total"]})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Total Token Overrides"}),o.jsx(mn,{children:A.totalTokenOverrides})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Themeable Tokens in Core"}),o.jsx(mn,{children:A.themeableTokensInCore}),o.jsx(rs,{children:"Available for override"})]})]}),A.themeAnalytics.length>0&&o.jsxs(o.Fragment,{children:[o.jsx(on,{}),o.jsx(E,{fontSize:"sm",fontWeight:"bold",children:"Theme Details"}),o.jsxs(ho,{size:"sm",variant:"simple",width:"100%",children:[o.jsx(jo,{children:o.jsxs(Nn,{children:[o.jsx(br,{children:"Theme"}),o.jsx(br,{children:"Version"}),o.jsx(br,{isNumeric:!0,children:"Token Overrides"}),o.jsx(br,{isNumeric:!0,children:"% of Themeable"}),o.jsx(br,{children:"Status"})]})}),o.jsx(mo,{children:A.themeAnalytics.map(se=>o.jsxs(Nn,{children:[o.jsx(fr,{children:o.jsxs(le,{spacing:2,children:[o.jsx(E,{children:se.themeName}),se.hasError&&o.jsx(Cn,{label:se.errorType==="private-repository"?"Private repository - sign in with GitHub to access":se.errorMessage||"Theme override file not found","aria-label":`Error for ${se.themeName}: ${se.errorType==="private-repository"?"Private repository - sign in with GitHub to access":se.errorMessage||"Theme override file not found"}`,hasArrow:!0,placement:"top",children:o.jsx(E,{as:"span",color:se.errorType==="private-repository"?"orange.500":"red.500",fontWeight:"bold","aria-live":"polite","aria-label":`Error: ${se.errorType==="private-repository"?"Private repository - sign in with GitHub to access":se.errorMessage||"Theme override file not found"}`,tabIndex:0,ml:1,children:o.jsx(Ro,{size:14})})})]})}),o.jsx(fr,{children:se.hasError?"-":se.version||"N/A"}),o.jsx(fr,{isNumeric:!0,children:se.hasError?"-":se.tokenOverridesCount}),o.jsxs(fr,{isNumeric:!0,children:[se.hasError?"-":se.percentOfThemeableTokens.toFixed(1),"%"]}),o.jsx(fr,{children:se.hasError?o.jsx(Yn,{colorScheme:se.errorType==="private-repository"?"orange":"red",size:"sm",children:se.errorType==="private-repository"?"Private":"Not found"}):o.jsx(Yn,{colorScheme:"green",size:"sm",children:"OK"})})]},se.themeId))})]})]})]}):o.jsxs(ce,{spacing:2,children:[o.jsx(E,{fontSize:"sm",color:"gray.500",children:"No theme analytics data available"}),o.jsx(E,{fontSize:"xs",color:"gray.400",children:"Theme overrides are loaded from external repositories"})]})]}),o.jsxs(z,{p:6,borderWidth:1,borderRadius:"md",bg:"chakra-body-bg",children:[o.jsx(Tt,{size:"md",mb:4,children:"Component Registry"}),o.jsxs(Qs,{columns:2,spacing:4,mb:4,children:[o.jsxs(un,{children:[o.jsx(hn,{children:"Categories"}),o.jsx(mn,{children:xe.counts.categories})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Properties"}),o.jsx(mn,{children:xe.counts.properties}),o.jsxs(rs,{children:[$.boolean," boolean, ",$.list," list"]})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Components"}),o.jsx(mn,{children:xe.counts.components})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Status"}),o.jsx(mn,{children:o.jsx(Yn,{colorScheme:"green",size:"sm",children:"Valid"})}),xe.validation.errorCount>0]})]}),B.length>0&&o.jsxs(o.Fragment,{children:[o.jsx(on,{my:4}),o.jsx(Tt,{size:"sm",mb:2,children:"Components by Category"}),o.jsxs(ho,{size:"sm",variant:"simple",children:[o.jsx(jo,{children:o.jsxs(Nn,{children:[o.jsx(br,{children:"Category"}),o.jsx(br,{isNumeric:!0,children:"Components"})]})}),o.jsx(mo,{children:B.map(se=>o.jsxs(Nn,{children:[o.jsx(fr,{children:se.categoryName}),o.jsx(fr,{isNumeric:!0,children:se.count})]},se.categoryName))})]})]})]}),o.jsxs(z,{p:6,borderWidth:1,borderRadius:"md",bg:"chakra-body-bg",children:[o.jsx(Tt,{size:"md",mb:4,children:"Releases"}),K?o.jsxs(ce,{spacing:4,children:[o.jsx(kn,{}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:"Loading GitHub releases..."})]}):Z?o.jsxs(zt,{status:"error",children:[o.jsx(Lt,{}),Z]}):G?o.jsxs(ce,{align:"start",spacing:4,children:[o.jsxs(le,{spacing:2,align:"center",children:[o.jsxs(E,{fontSize:"sm",fontWeight:"medium",color:"gray.600",children:["Source: ",G.sourceName]}),o.jsx(Oe,{size:"xs",variant:"ghost",onClick:()=>window.open(G.repositoryUrl,"_blank"),children:"View Repository"})]}),o.jsxs(ce,{align:"start",spacing:2,children:[o.jsxs(E,{children:[o.jsx("b",{children:"Latest Version:"})," ",G.version]}),o.jsxs(E,{children:[o.jsx("b",{children:"Date:"})," ",G.date]}),G.releaseUrl&&o.jsx(Oe,{size:"sm",variant:"outline",onClick:()=>window.open(G.releaseUrl,"_blank"),children:"View Release"})]})]}):o.jsx(E,{fontSize:"sm",color:"gray.500",children:"No release data available"})]}),o.jsxs(z,{p:6,borderWidth:1,borderRadius:"md",bg:"chakra-body-bg",children:[o.jsx(Tt,{size:"md",mb:4,children:"Latest Activity"}),K?o.jsxs(ce,{spacing:4,children:[o.jsx(kn,{}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:"Loading GitHub activity..."})]}):Z?o.jsxs(zt,{status:"error",children:[o.jsx(Lt,{}),Z]}):he?o.jsxs(ce,{align:"start",spacing:4,children:[o.jsxs(le,{spacing:2,align:"center",children:[o.jsxs(E,{fontSize:"sm",fontWeight:"medium",color:"gray.600",children:["Source: ",he.sourceName]}),o.jsx(Oe,{size:"xs",variant:"ghost",onClick:()=>window.open(he.repositoryUrl,"_blank"),children:"View Repository"})]}),he.commits.length>0?o.jsx(ce,{align:"start",spacing:2,width:"100%",children:he.commits.map(se=>o.jsxs(le,{spacing:4,width:"100%",justify:"space-between",children:[o.jsxs(ce,{align:"start",spacing:1,flex:1,children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",children:se.message}),o.jsxs(le,{spacing:2,children:[o.jsxs(E,{fontSize:"xs",color:"gray.500",children:[se.author," â€¢ ",se.date]}),o.jsx(E,{fontSize:"xs",color:"gray.400",fontFamily:"mono",children:se.sha})]})]}),o.jsx(Oe,{size:"xs",variant:"ghost",onClick:()=>window.open(se.commitUrl,"_blank"),children:"View"})]},se.id))}):o.jsx(E,{fontSize:"sm",color:"gray.500",children:"No recent commits found"})]}):o.jsx(E,{fontSize:"sm",color:"gray.500",children:"No activity data available"})]})]})]}),(y==null?void 0:y.platformAnalytics.some(se=>se.hasError))&&o.jsx(z,{position:"absolute",width:0,height:0,overflow:"hidden","aria-live":"polite",children:y.platformAnalytics.filter(se=>se.hasError).map(se=>o.jsx("span",{children:`Error for ${se.platformName}: ${se.errorMessage||"File or repository is not found"}`},se.platformId))}),o.jsx("div",{"aria-live":"polite",style:{position:"absolute",left:"-9999px",height:"1px",width:"1px",overflow:"hidden"},children:X})]})},Ws=(t,e,r,n,s)=>r?o.jsx(Cn,{label:`${n} token generated by algorithm`,placement:"top",hasArrow:!0,color:s,children:o.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[t,o.jsx("span",{className:"badgeIcon",style:{position:"absolute",top:"-8px",right:"-8px",display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx(fk,{size:e/2,strokeWidth:3.5,color:s})})]})}):t,Ku=(t,e=24,r="currentColor",n=!1,s)=>{if(!t)return o.jsx(vu,{size:e});const i=s||t;switch(t){case"COLOR":return Ws(o.jsx(Ha,{color:r,size:e}),e,n,i,r);case"DIMENSION":return Ws(o.jsx(Wf,{color:r,size:e}),e,n,i,r);case"SPACING":return Ws(o.jsx(yb,{color:r,size:e}),e,n,i,r);case"FONT_FAMILY":case"FONT_WEIGHT":case"FONT_SIZE":return Ws(o.jsx(Jf,{color:r,size:e}),e,n,i,r);case"LINE_HEIGHT":return Ws(o.jsx(wb,{color:r,size:e}),e,n,i,r);case"LETTER_SPACING":return Ws(o.jsx(Sb,{color:r,size:e}),e,n,i,r);case"DURATION":return Ws(o.jsx(Mb,{color:r,size:e}),e,n,i,r);case"CUBIC_BEZIER":return Ws(o.jsx(Lf,{color:r,size:e}),e,n,i,r);case"BLUR":return Ws(o.jsx(Yu,{color:r,size:e}),e,n,i,r);case"SPREAD":return Ws(o.jsx(to,{color:r,size:e}),e,n,i,r);case"RADIUS":return Ws(o.jsx(Tb,{color:r,size:e}),e,n,i,r);default:return Ws(o.jsx(vu,{color:r,size:e}),e,n,i,r)}},FI=({source:t,platformName:e,themeName:r,size:n="sm",showIcon:s=!0})=>{const{colorMode:i}=Vt(),l=(()=>{switch(t){case"platform":return{icon:bb,colorScheme:"blue",label:"Platform",tooltip:e?`From ${e} platform`:"Platform override"};case"theme":return{icon:Ha,colorScheme:"purple",label:"Theme",tooltip:r?`From ${r} theme`:"Theme override"};case"merged":return{icon:Ep,colorScheme:"green",label:"Merged",tooltip:"Combined from multiple sources"};default:return{icon:Ep,colorScheme:"gray",label:"Core",tooltip:"From core data"}}})();return o.jsx(Cn,{label:l.tooltip,placement:"top",children:o.jsxs(wt,{colorScheme:l.colorScheme,variant:"subtle",size:n,fontSize:n==="sm"?"xs":"sm",px:2,py:1,borderRadius:"md",bg:i==="dark"?`${l.colorScheme}.900`:`${l.colorScheme}.50`,color:i==="dark"?`${l.colorScheme}.100`:`${l.colorScheme}.700`,borderWidth:1,borderColor:i==="dark"?`${l.colorScheme}.700`:`${l.colorScheme}.200`,display:"inline-flex",alignItems:"center",gap:1,children:[s&&o.jsx(l.icon,{size:n==="sm"?12:14}),l.label]})})},$p=({displayName:t,resolvedValueTypeId:e,resolvedValueTypes:r,value:n,isPill:s=!1,onClick:i,source:a,platformName:l,themeName:c,showSourceBadge:d=!1})=>{const m=r.find(v=>v.id===e);if(!m)throw new Error(`Unknown value type: ${e}`);const{colorMode:g}=Vt(),y=g==="dark"?"gray.800":"gray.100";return o.jsx(z,{onClick:i,width:"100%",textAlign:"left",borderRadius:"md",py:1,px:2,bg:s?y:"transparent",borderWidth:s?"1px":"0",borderColor:"chakra-border-color",children:o.jsxs(le,{width:"100%",flexGrow:1,justifyContent:"space-between",children:[o.jsxs(le,{gap:2,width:"100%",justifyContent:"flex-start",flexGrow:0,children:[m.type==="COLOR"&&o.jsx("div",{style:{display:"flex",flexGrow:0,flexShrink:0,width:14,height:14,borderRadius:"2px",backgroundColor:String(n)}}),m.type!=="COLOR"&&o.jsx("div",{style:{display:"flex",flexGrow:0,flexShrink:0,width:14,height:14},children:Ku(m.type,16)}),o.jsx(E,{className:"kode-mono",children:t}),d&&a&&o.jsx(FI,{source:a,platformName:l,themeName:c,size:"sm",showIcon:!1})]}),o.jsx(E,{color:"gray.500",fontSize:"xs",pl:2,children:String(n)})]})})},VI=({resolvedValueType:t,rawValue:e,formattedValue:r})=>{let n;switch(t){case"COLOR":n=o.jsx(E,{children:r});break;case"DIMENSION":case"SPACING":case"FONT_SIZE":case"LINE_HEIGHT":case"LETTER_SPACING":case"DURATION":case"BLUR":case"SPREAD":case"RADIUS":n=`${typeof e=="number"?e:Number(e)}px`;break;case"FONT_WEIGHT":n=typeof e=="number"?e.toString():String(e);break;case"FONT_FAMILY":case"CUBIC_BEZIER":n=typeof e=="string"?e:String(e);break;default:n=r}const{colorMode:i}=Vt(),a=i==="dark"?"gray.800":"gray.100";return o.jsx(z,{width:"100%",textAlign:"left",borderRadius:"md",py:1,px:2,bg:a,borderWidth:"1px",borderColor:"chakra-border-color",children:o.jsxs(le,{width:"100%",justifyContent:"flex-start",gap:2,children:[t==="COLOR"&&o.jsx("div",{style:{display:"flex",flexGrow:0,flexShrink:0,width:14,height:14,borderRadius:"2px",backgroundColor:String(e)}}),t!=="COLOR"&&o.jsx("div",{style:{display:"flex",flexGrow:0,flexShrink:0,width:14,height:14},children:Ku(t,16,"var(--chakra-colors-gray-400)")}),typeof n=="string"?o.jsx(E,{children:n}):n]})})};function $I(t,e){console.debug("[getValueTypeFromId] Input:",{resolvedValueTypeId:t,availableTypes:e.map(n=>({id:n.id,type:n.type}))});const r=e.find(n=>n.id===t);return console.debug("[getValueTypeFromId] Found value type:",r),r==null?void 0:r.type}function zI(t,e){console.debug("[getDefaultValueForType] Input:",{resolvedValueTypeId:t,availableTypes:e.map(s=>({id:s.id,type:s.type}))});const r=e.find(s=>s.id===t);if(console.debug("[getDefaultValueForType] Found value type:",r),!r)throw console.error("[getDefaultValueForType] Error: Unknown value type",{requestedId:t,availableIds:e.map(s=>s.id)}),new Error(`Unknown value type: ${t}`);console.debug("[getDefaultValueForType] Determining default value for type:",r.type);let n;switch(r.type){case"COLOR":n={value:"#000000"};break;case"DIMENSION":case"SPACING":case"FONT_SIZE":case"LINE_HEIGHT":case"LETTER_SPACING":case"BLUR":case"SPREAD":case"RADIUS":n={value:0};break;case"FONT_WEIGHT":n={value:400};break;case"FONT_FAMILY":n={value:"system-ui"};break;case"DURATION":n={value:0};break;case"CUBIC_BEZIER":n={value:"cubic-bezier(0.4, 0, 0.2, 1)"};break;default:r.type==="LINE_HEIGHT"?n={value:1.5}:n={value:""}}return console.debug("[getDefaultValueForType] Generated default value:",n),n}function LI(t,e,r){const n=r.find(i=>i.id===e);if(!n)return String(t);let s;if(typeof t=="string")s=t;else if(typeof t=="object"&&t)if("value"in t)s=t.value;else return"tokenId"in t?`alias:${t.tokenId}`:String(t);else return String(t);switch(n.type){case"COLOR":return typeof s=="string"?s:String(s);case"DIMENSION":case"SPACING":case"FONT_SIZE":case"LINE_HEIGHT":case"LETTER_SPACING":case"DURATION":case"BLUR":case"SPREAD":case"RADIUS":return`${typeof s=="number"?s:Number(s)}px`;case"FONT_WEIGHT":return typeof s=="number"?s.toString():String(s);case"FONT_FAMILY":case"CUBIC_BEZIER":return typeof s=="string"?s:String(s);default:return typeof s=="string"?s:String(s)}}const no=({title:t,description:e,headerComponent:r,children:n,maxWidth:s="container.xl",padding:i=12})=>o.jsx(zc,{maxW:s,p:i,children:o.jsxs(ce,{spacing:8,align:"stretch",children:[o.jsxs(z,{children:[o.jsxs(le,{spacing:4,align:"center",mb:2,justify:"space-between",width:"100%",children:[o.jsx(Tt,{size:"lg",children:t}),r]}),e&&o.jsx(E,{fontSize:"sm",color:"gray.600",mt:2,children:e})]}),n]})});function BI({tokens:t,collections:e,resolvedValueTypes:r,taxonomies:n,modes:s,dimensions:i,renderAddTokenButton:a,onEditToken:l,canEdit:c=!1,dataSourceContext:d,dimensionOrder:u=[]}){const[m,g]=M.useState("PRIMITIVE"),{colorMode:y}=Vt(),[v,I]=M.useState([]),[S,b]=M.useState([]),[k,A]=M.useState([]),[C,T]=M.useState([]),[P,_]=M.useState([]),[R,G]=M.useState(""),[ne,he]=M.useState(!1),[te,K]=M.useState(()=>{const de={};return i.forEach(fe=>{fe.defaultMode&&fe.modes.find(Y=>Y.id===fe.defaultMode)&&(de[fe.id]=fe.defaultMode)}),de}),[O,Z]=M.useState({tokenTier:!1,propertyTypes:!1,taxonomies:!1,private:!1,themeable:!0,status:!0,collection:!1,generatedByAlgorithm:!1,algorithm:!1}),ie=()=>{I([]),b([]),A([]),T([]),_([]),G(""),he(!1)},ge=Array.from(new Set(t.map(de=>de.status||"experimental"))).sort(),xe=t.filter(de=>{var Ke;const fe=de.displayName.toLowerCase().includes(R.toLowerCase())||((Ke=de.description)==null?void 0:Ke.toLowerCase().includes(R.toLowerCase())),_e=R?!0:de.tokenTier===m,Y=v.length===0||v.some(ve=>{const Te=e.find(je=>je.id===ve);return Te?!!(de.tokenCollectionId===ve||!de.tokenCollectionId&&Te.resolvedValueTypeIds.includes(de.resolvedValueTypeId)):!1}),Ce=S.length===0||S.includes(de.resolvedValueTypeId??""),ue=k.length===0||k.includes(de.status||"experimental"),Ee=C.length===0||C.includes(de.private),ze=P.length===0||P.includes(de.themeable),De=!ne||(()=>{var je;if(!(d!=null&&d.editMode.isActive))return!0;const{sourceType:ve,sourceId:Te}=d.editMode;return ve==="platform-extension"&&Te?(je=de.valuesByMode)==null?void 0:je.some(Ue=>{var Je;return(Je=Ue.platformOverrides)==null?void 0:Je.some(ut=>ut.platformId===Te)}):ve==="theme-override"&&Te?de.themeable===!0:!0})();return fe&&_e&&Y&&Ce&&ue&&Ee&&ze&&De}),$=de=>{const fe=r.find(_e=>_e.id===de);return(fe==null?void 0:fe.type)||de},B=de=>{const fe=r.find(_e=>_e.id===de);return(fe==null?void 0:fe.displayName)||de},U=de=>{var Ce;if(!((Ce=de.valuesByMode)!=null&&Ce.length))return"-";const fe=de.valuesByMode.filter(ue=>{if(Object.keys(te).length===0||ue.modeIds.length===0)return!0;const Ee=new Map;ue.modeIds.forEach(ze=>{const De=i.find(Ke=>Ke.modes.some(ve=>ve.id===ze));De&&(Ee.has(De.id)||Ee.set(De.id,[]),Ee.get(De.id).push(ze))});for(const[ze,De]of Object.entries(te)){const Ke=Ee.get(ze);if(Ke&&De!==""&&!Ke.includes(De))return!1}return!0});if(fe.length===0)return"-";const _e=ue=>{const Ee=i.find(ze=>ze.modes.some(De=>De.id===ue));if(Ee){const ze=Ee.modes.find(De=>De.id===ue);if(ze)return{dimension:Ee,mode:ze}}return null},Y=ue=>{if(ue.length===0)return null;const Ee=ue.map(Te=>_e(Te)).filter(Boolean);if(Ee.length===0)return null;const ze=new Set;if(Object.entries(te).forEach(([Te,je])=>{je===""&&ze.add(Te)}),ze.size===0)return null;const De=Ee.filter(Te=>ze.has(Te.dimension.id));return De.length===0?null:De.sort((Te,je)=>{const Fe=u.indexOf(Te.dimension.id),Ue=u.indexOf(je.dimension.id);return Fe!==-1&&Ue!==-1?Fe-Ue:Fe!==-1?-1:Ue!==-1?1:Te.dimension.displayName.localeCompare(je.dimension.displayName)}).map(Te=>Te.mode.name).join(" + ")};return fe.map(ue=>{var je,Fe;const Ee=ue.value;if(!Ee)return null;const ze=r.find(Ue=>Ue.id===de.resolvedValueTypeId);if(!ze)return console.warn("No resolved value type found for token:",{tokenId:de.id,resolvedValueTypeId:de.resolvedValueTypeId}),"-";let De;const Ke=Ue=>{if(!Ue||typeof Ue!="object")return null;const Je=Ue;return"tokenId"in Je&&typeof Je.tokenId=="string"?Je.tokenId:"value"in Je&&Je.value&&typeof Je.value=="object"?Ke(Je.value):null},ve=Ke(Ee);if(ve){const Ue=t.find(Je=>Je.id===ve);if(Ue){const Je=(Fe=(je=Ue.valuesByMode)==null?void 0:je[0])==null?void 0:Fe.value;if(Je&&"value"in Je){const ut=typeof Je.value=="object"&&Je.value!==null&&"value"in Je.value?Je.value.value:Je.value;De=o.jsx($p,{displayName:Ue.displayName,resolvedValueTypeId:Ue.resolvedValueTypeId,resolvedValueTypes:r,value:ut,isPill:!0})}else De=Ue.displayName}else De=ve}else if(typeof Ee=="object"&&Ee!==null&&"value"in Ee){const Ue=typeof Ee.value=="object"&&Ee.value!==null&&"value"in Ee.value?Ee.value.value:Ee.value,Je=LI(Ue,de.resolvedValueTypeId,r);De=o.jsx(VI,{resolvedValueType:ze.type||"UNKNOWN",rawValue:Ue,formattedValue:Je})}else De=String(Ee);const Te=Y(ue.modeIds);return o.jsx(z,{children:Te?o.jsxs(le,{spacing:2,align:"center",children:[o.jsxs(E,{fontSize:"sm",fontWeight:"medium",color:"gray.600",minW:"fit-content",children:[Te,":"]}),De]}):De},ue.modeIds.join(","))})},X=de=>{var fe;return(fe=de.taxonomies)!=null&&fe.length?de.taxonomies.map(_e=>{const Y=n.find(ue=>ue.id===_e.taxonomyId),Ce=Y==null?void 0:Y.terms.find(ue=>ue.id===_e.termId);return`${(Y==null?void 0:Y.name)||_e.taxonomyId}: ${(Ce==null?void 0:Ce.name)||_e.termId}`}).join(`
`):"-"},ee=de=>!de.generatedByAlgorithm||!de.algorithmId?"-":de.algorithmId,be=de=>{l&&l(de)},Se=de=>{Z(fe=>({...fe,[de]:!fe[de]}))},Me=y==="dark"?"purple.800":"orange.100",se=y==="dark"?"gray.700":"gray.200";return o.jsxs(no,{title:"Tokens",headerComponent:o.jsxs(le,{spacing:4,width:"auto",justify:"space-between",children:[(d==null?void 0:d.editMode.isActive)&&d.editMode.sourceType!=="core"&&o.jsxs(Ye,{display:"flex",alignItems:"center",width:"auto",children:[o.jsx(Qe,{htmlFor:"source-specific-data-only",mb:"0",fontSize:"sm",children:"Source-specific data only"}),o.jsx(hl,{id:"source-specific-data-only",isChecked:ne,onChange:de=>he(de.target.checked),size:"sm"})]}),o.jsxs(Ef,{width:"300px",children:[o.jsx(Vv,{pointerEvents:"none",children:o.jsx(kb,{size:16})}),o.jsx(yt,{placeholder:"Search tokens...",value:R,onChange:de=>G(de.target.value)}),R&&o.jsx($v,{children:o.jsx(Bt,{"aria-label":"Clear search",icon:o.jsx(Ab,{size:14}),size:"sm",variant:"ghost",onClick:()=>G("")})})]})]}),maxWidth:"100%",children:[i.length>0&&o.jsx(z,{children:o.jsx(le,{spacing:4,align:"flex-end",children:i.map(de=>o.jsxs(Ye,{width:"auto",children:[o.jsx(Qe,{htmlFor:`dimension-${de.id}`,mb:"0",fontSize:"sm",children:de.displayName}),o.jsxs(Kt,{id:`dimension-${de.id}`,value:te[de.id]||"",onChange:fe=>K(_e=>({..._e,[de.id]:fe.target.value})),size:"sm",width:"150px",children:[o.jsx("option",{value:"",children:"All modes"}),de.modes.map(fe=>o.jsx("option",{value:fe.id,children:fe.name},fe.id))]})]},de.id))})}),o.jsx(Es,{onChange:de=>{g(["PRIMITIVE","SEMANTIC","COMPONENT"][de])},mb:4,variant:R?"unstyled":"line",opacity:R?.5:1,children:o.jsxs(Ms,{children:[o.jsx(pr,{isDisabled:!!R,children:"Primitive"}),o.jsx(pr,{isDisabled:!!R,children:"Semantic"}),o.jsx(pr,{isDisabled:!!R,children:"Component"})]})}),o.jsxs(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:y==="dark"?"gray.900":"white",children:[o.jsxs(vi,{gap:2,mb:4,justify:"space-between",width:"100%",children:[a,o.jsxs(le,{spacing:4,children:[o.jsxs(Xo,{placement:"bottom-end",children:[o.jsx(Qo,{children:o.jsx(Oe,{leftIcon:o.jsx(k6,{size:16}),size:"sm",variant:"outline",children:"Filters"})}),o.jsx(Ai,{width:"200px",children:o.jsx(Pi,{children:o.jsxs(ce,{align:"start",spacing:4,children:[o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"Collection"}),o.jsx(ce,{align:"start",spacing:1,children:e.map(de=>o.jsx(sn,{isChecked:v.includes(de.id),onChange:fe=>{I(_e=>fe.target.checked?[..._e,de.id]:_e.filter(Y=>Y!==de.id))},children:de.name},de.id))})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"Type"}),o.jsx(ce,{align:"start",spacing:1,children:r.map(de=>o.jsx(sn,{isChecked:S.includes(de.id),onChange:fe=>{b(_e=>fe.target.checked?[..._e,de.id]:_e.filter(Y=>Y!==de.id))},children:de.displayName},de.id))})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"Status"}),o.jsx(ce,{align:"start",spacing:1,children:ge.map(de=>o.jsx(sn,{isChecked:k.includes(de),onChange:fe=>{A(_e=>fe.target.checked?[..._e,de]:_e.filter(Y=>Y!==de))},children:de},de))})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"Private"}),o.jsxs(ce,{align:"start",spacing:1,children:[o.jsx(sn,{isChecked:C.includes(!0),onChange:de=>{T(fe=>de.target.checked?[...fe,!0]:fe.filter(_e=>_e!==!0))},children:"Yes"}),o.jsx(sn,{isChecked:C.includes(!1),onChange:de=>{T(fe=>de.target.checked?[...fe,!1]:fe.filter(_e=>_e!==!1))},children:"No"})]})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"Themeable"}),o.jsxs(ce,{align:"start",spacing:1,children:[o.jsx(sn,{isChecked:P.includes(!0),onChange:de=>{_(fe=>de.target.checked?[...fe,!0]:fe.filter(_e=>_e!==!0))},children:"Yes"}),o.jsx(sn,{isChecked:P.includes(!1),onChange:de=>{_(fe=>de.target.checked?[...fe,!1]:fe.filter(_e=>_e!==!1))},children:"No"})]})]}),o.jsx(Oe,{size:"sm",variant:"ghost",onClick:ie,width:"100%",children:"Clear filters"})]})})})]}),o.jsxs(Xo,{placement:"bottom-end",children:[o.jsx(Qo,{children:o.jsx(Oe,{leftIcon:o.jsx(o6,{size:16}),size:"sm",variant:"outline",children:"Columns"})}),o.jsx(Ai,{width:"200px",children:o.jsx(Pi,{children:o.jsxs(ce,{align:"start",spacing:2,children:[o.jsx(sn,{isChecked:O.collection,onChange:()=>Se("collection"),children:"Collection"}),o.jsx(sn,{isChecked:O.status,onChange:()=>Se("status"),children:"Status"}),o.jsx(sn,{isChecked:O.themeable,onChange:()=>Se("themeable"),children:"Themeable"}),o.jsx(sn,{isChecked:O.private,onChange:()=>Se("private"),children:"Private"}),o.jsx(sn,{isChecked:O.taxonomies,onChange:()=>Se("taxonomies"),children:"Taxonomies"}),o.jsx(sn,{isChecked:O.tokenTier,onChange:()=>Se("tokenTier"),children:"Token Tier"}),o.jsx(sn,{isChecked:O.propertyTypes,onChange:()=>Se("propertyTypes"),children:"Property Types"}),o.jsx(sn,{isChecked:O.generatedByAlgorithm,onChange:()=>Se("generatedByAlgorithm"),children:"Generated By Algorithm"}),o.jsx(sn,{isChecked:O.algorithm,onChange:()=>Se("algorithm"),children:"Algorithm"})]})})})]})]})]}),xe.length===0?o.jsx(Wu,{p:8,children:o.jsxs(ce,{spacing:4,children:[o.jsx(z,{color:"gray.400",children:o.jsx(On,{as:Yf,size:48})}),o.jsxs(ce,{spacing:2,children:[o.jsx(E,{fontSize:"lg",fontWeight:"medium",children:t.length===0?"No tokens found":"No matching tokens"}),o.jsx(E,{color:"gray.500",textAlign:"center",children:t.length===0?"Get started by adding your first token":"Try adjusting your filters or search term"})]}),t.length===0&&a&&o.jsx(z,{mt:2,children:a})]})}):o.jsxs(ho,{variant:"simple",children:[o.jsx(jo,{children:o.jsxs(Nn,{children:[o.jsx(br,{children:"Type"}),o.jsx(br,{children:"Name"}),O.collection&&o.jsx(br,{children:"Collection"}),o.jsx(br,{children:"Value"}),O.status&&o.jsx(br,{children:"Status"}),O.themeable&&o.jsx(br,{children:"Themeable"}),O.private&&o.jsx(br,{children:"Private"}),O.taxonomies&&o.jsx(br,{children:"Taxonomies"}),O.tokenTier&&o.jsx(br,{children:"Token Tier"}),O.propertyTypes&&o.jsx(br,{children:"Property Types"}),O.generatedByAlgorithm&&o.jsx(br,{children:"Generated By Algorithm"}),O.algorithm&&o.jsx(br,{children:"Algorithm"}),o.jsx(br,{children:"Actions"})]})}),o.jsx(mo,{children:xe.map(de=>{var fe,_e;return o.jsxs(Nn,{children:[o.jsx(fr,{children:o.jsx(le,{spacing:2,backgroundColor:de.generatedByAlgorithm?Me:se,borderRadius:"md",p:2,width:"fit-content",children:Ku($(de.resolvedValueTypeId),20,"currentColor",de.generatedByAlgorithm,B(de.resolvedValueTypeId))})}),o.jsxs(fr,{children:[o.jsx(E,{fontWeight:"medium",children:de.displayName}),de.description&&o.jsx(E,{fontSize:"sm",color:"gray.500",children:de.description})]}),O.collection&&o.jsx(fr,{children:((fe=e.find(Y=>Y.id===de.tokenCollectionId))==null?void 0:fe.name)||de.tokenCollectionId}),o.jsx(fr,{children:o.jsx(ce,{align:"start",spacing:1,children:U(de)})}),O.status&&o.jsx(fr,{children:o.jsx(wt,{colorScheme:de.status==="stable"?"green":de.status==="deprecated"?"red":"yellow",children:de.status||"experimental"})}),O.themeable&&o.jsx(fr,{children:de.themeable?"Yes":"No"}),O.private&&o.jsx(fr,{children:de.private?"Yes":"No"}),O.taxonomies&&o.jsx(fr,{children:X(de).split(`
`).map((Y,Ce)=>o.jsx(E,{fontSize:"sm",children:Y},Ce))}),O.tokenTier&&o.jsx(fr,{children:o.jsx(wt,{colorScheme:"blue",children:de.tokenTier})}),O.propertyTypes&&o.jsx(fr,{children:(_e=de.propertyTypes)==null?void 0:_e.map((Y,Ce)=>o.jsx(wt,{mr:1,mb:1,colorScheme:"purple",children:Y.displayName},Ce))}),O.generatedByAlgorithm&&o.jsx(fr,{children:de.generatedByAlgorithm?"Yes":"No"}),O.algorithm&&o.jsx(fr,{children:ee(de)}),o.jsx(fr,{children:o.jsx(le,{spacing:2,children:c&&l&&o.jsx(Bt,{"aria-label":"Edit token",icon:o.jsx(qf,{size:16}),size:"sm",variant:"ghost",onClick:()=>be(de)})})})]},de.id)})})]})]})]})}const zp=({variable:t,onVariableChange:e,dimensions:r})=>{const[n,s]=M.useState(null);M.useEffect(()=>{if(t.dimensionId){const c=r.find(d=>d.id===t.dimensionId);s(c||null)}},[t.dimensionId,r]);const i=c=>{const d={...t,modeBased:c,dimensionId:c?t.dimensionId:void 0,valuesByMode:c?t.valuesByMode||[]:void 0};e(d)},a=c=>{const d=r.find(m=>m.id===c);s(d||null);const u={...t,dimensionId:c,valuesByMode:d?t.valuesByMode||[]:void 0};e(u)},l=(c,d)=>{const u=t.valuesByMode||[],m=u.findIndex(I=>I.modeIds.includes(c));let g;switch(t.type){case"number":g=d===""?0:Number(d);break;case"boolean":g=d==="true"||d==="1";break;default:g=d}let y;m>=0?(y=[...u],y[m]={...y[m],value:g}):y=[...u,{modeIds:[c],value:g}];const v={...t,valuesByMode:y};e(v)};return o.jsx(z,{p:4,borderWidth:1,borderRadius:"md",bg:"gray.50",children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{fontWeight:"bold",children:"Mode-Based Variable Settings"}),o.jsx(hl,{isChecked:t.modeBased||!1,onChange:c=>i(c.target.checked)})]}),t.modeBased&&o.jsxs(o.Fragment,{children:[o.jsx(on,{}),o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Dimension"}),o.jsx(Kt,{value:t.dimensionId||"",onChange:c=>a(c.target.value),placeholder:"Select a dimension",children:r.map(c=>o.jsxs("option",{value:c.id,children:[c.displayName," (",c.modes.length," modes)"]},c.id))})]}),n&&o.jsxs(z,{children:[o.jsxs(E,{fontWeight:"medium",mb:3,children:["Mode-Specific Values for â€œ",n.displayName,"â€"]}),o.jsx(ce,{spacing:3,align:"stretch",children:n.modes.map(c=>o.jsxs(le,{spacing:3,children:[o.jsx(wt,{colorScheme:"blue",minW:"80px",children:c.name}),o.jsx(Ye,{children:o.jsx(yt,{placeholder:`Value for ${c.name}`,value:(()=>{var u,m;const d=(m=(u=t.valuesByMode)==null?void 0:u.find(g=>g.modeIds.includes(c.id)))==null?void 0:m.value;return d==null?"":String(d)})(),onChange:d=>l(c.id,d.target.value),size:"sm"})})]},c.id))}),n.modes.length===0&&o.jsx(E,{fontSize:"sm",color:"gray.500",children:"No modes available for this dimension"})]})]})]})})};function wn(t){let e;return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?e=crypto.randomUUID():e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const n=Math.random()*16|0;return(r==="x"?n:n&3|8).toString(16)}),`${t}Id-${e}`}function ji(t){return`${t}-${crypto.randomUUID()}`}const UI=({open:t,onClose:e,onSave:r,variable:n,isNew:s=!1,dimensions:i})=>{const a=Hr(),l=/^[a-zA-Z_][a-zA-Z0-9_]*$/,[c,d]=M.useState({id:"",name:"",type:"number",defaultValue:"",description:"",modeBased:!1,valuesByMode:[],dimensionId:void 0}),u=c.name?l.test(c.name):!0;M.useEffect(()=>{d(n?{...n,id:n.id||ji("system-variable")}:{id:ji("system-variable"),name:"",type:"number",defaultValue:"",description:"",modeBased:!1,valuesByMode:[],dimensionId:void 0})},[n]);const m=()=>{var y;if(!((y=c.name)!=null&&y.trim())){a({title:"Error",description:"Please enter a variable name",status:"error",duration:3e3,isClosable:!0});return}if(!u){a({title:"Error",description:"Variable name must start with a letter or underscore and contain only letters, numbers, and underscores.",status:"error",duration:3e3,isClosable:!0});return}if(!c.type){a({title:"Error",description:"Please select a variable type",status:"error",duration:3e3,isClosable:!0});return}if(c.modeBased&&!c.dimensionId){a({title:"Error",description:"Please select a dimension for mode-based variable",status:"error",duration:3e3,isClosable:!0});return}r(c),e()},g=y=>{d(y)};return o.jsxs(Zr,{isOpen:t,onClose:e,size:"xl",children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:s?"Create New System Variable":"Edit System Variable"}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(le,{spacing:4,children:[o.jsxs(Ye,{isRequired:!0,isInvalid:!!c.name&&!u,children:[o.jsx(Qe,{children:"Variable Name"}),o.jsx(yt,{placeholder:"Variable Name",value:c.name,onChange:y=>d(v=>({...v,name:y.target.value}))}),!u&&c.name&&o.jsx(E,{fontSize:"xs",color:"red.500",children:"Variable names must start with a letter or underscore and contain only letters, numbers, and underscores."})]}),o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Type"}),o.jsxs(Kt,{value:c.type,onChange:y=>d(v=>({...v,type:y.target.value})),children:[o.jsx("option",{value:"number",children:"Number"}),o.jsx("option",{value:"string",children:"String"}),o.jsx("option",{value:"boolean",children:"Boolean"}),o.jsx("option",{value:"color",children:"Color"})]})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Default Value"}),o.jsx(yt,{placeholder:"Default Value (optional)",value:c.defaultValue||"",onChange:y=>d(v=>({...v,defaultValue:y.target.value}))})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(yt,{placeholder:"Description (optional)",value:c.description||"",onChange:y=>d(v=>({...v,description:y.target.value}))})]}),o.jsx(zp,{variable:c,onVariableChange:g,dimensions:i})]})}),o.jsx(rn,{children:o.jsxs(le,{spacing:3,children:[o.jsx(Oe,{variant:"ghost",onClick:e,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:m,isDisabled:!u,children:s?"Create Variable":"Save Changes"})]})})]})]})};class Kn{static normalizeSystemVariable(e){return{id:e.id||ji("system-variable"),name:e.name||"",type:e.type||"string",defaultValue:e.defaultValue||"",description:e.description||"",modeBased:e.modeBased||!1,valuesByMode:e.valuesByMode||[],dimensionId:e.dimensionId}}static getSystemVariables(){try{const e=new Map,r=L.getAlgorithmFile();if(r&&r.config&&typeof r.config=="object"){const s=r.config;s.systemVariables&&Array.isArray(s.systemVariables)&&s.systemVariables.forEach(i=>{if(i.id&&typeof i.id=="string"){const a=this.normalizeSystemVariable(i);e.set(i.id,a)}})}return this.getUserSystemVariables().forEach(s=>{s.id&&e.set(s.id,s)}),Array.from(e.values())}catch(e){return console.error("Error loading system variables:",e),[]}}static getUserSystemVariables(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading user system variables:",e),[]}}static saveSystemVariable(e){try{const r=L.getAlgorithmFile();if(r&&r.config&&typeof r.config=="object"){const i=r.config;if(i.systemVariables&&Array.isArray(i.systemVariables)){const a=i.systemVariables.findIndex(l=>l.id===e.id);if(a>=0){const l={...e},c={...r,config:{...i,systemVariables:i.systemVariables.map((d,u)=>u===a?l:d)}};return L.setAlgorithmFile(c),!0}}}const n=this.getUserSystemVariables();e.id||(e.id=ji("system-variable"));const s=n.findIndex(i=>i.id===e.id);return s>=0?n[s]={...e}:n.push({...e}),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n)),!0}catch(r){return console.error("Error saving system variable:",r),!1}}static updateSystemVariable(e){return this.saveSystemVariable(e)}static deleteSystemVariable(e){try{const r=L.getAlgorithmFile();if(r&&r.config&&typeof r.config=="object"){const i=r.config;if(i.systemVariables&&Array.isArray(i.systemVariables)){const a=i.systemVariables.findIndex(l=>l.id===e);if(a>=0){const l={...r,config:{...i,systemVariables:i.systemVariables.filter((c,d)=>d!==a)}};return L.setAlgorithmFile(l),!0}}}const n=this.getUserSystemVariables(),s=n.filter(i=>i.id!==e);return s.length===n.length?!1:(localStorage.setItem(this.STORAGE_KEY,JSON.stringify(s)),!0)}catch(r){return console.error("Error deleting system variable:",r),!1}}static getSystemVariableByName(e){return this.getSystemVariables().find(n=>n.name===e)}static systemVariableExists(e){return this.getSystemVariableByName(e)!==void 0}static exportToConfig(){const e=this.getSystemVariables(),r={};return e.forEach(n=>{n.defaultValue!==void 0&&(r[n.name]=this.parseValue(n.defaultValue,n.type))}),r}static importFromConfig(e){const r=[];for(const[s,i]of Object.entries(e))(typeof i=="string"||typeof i=="number"||typeof i=="boolean")&&r.push({id:`system-${s}`,name:s,type:this.inferType(i),defaultValue:String(i),description:`System variable: ${s}`,modeBased:!1,valuesByMode:[],dimensionId:void 0});const n=L.getAlgorithmFile();if(n){const s=n.config&&typeof n.config=="object"?n.config:{},i={...n,config:{...s,systemVariables:r}};L.setAlgorithmFile(i)}else{const s={schemaVersion:"5.0.0",profile:"basic",metadata:{name:"Algorithm Collection",description:"Algorithm collection",version:"1.0.0",author:"Design System Manager"},config:{systemVariables:r},algorithms:[],execution:{order:[],parallel:!1,onError:"stop"},integration:{targetSchema:"https://designsystem.org/schemas/tokens/v1.0.0",outputFormat:"design-tokens",mergeStrategy:"merge",validation:!0},examples:[]};L.setAlgorithmFile(s)}}static inferType(e){return typeof e=="number"?"number":typeof e=="boolean"?"boolean":typeof e=="string"&&(e.startsWith("#")||e.startsWith("rgb")||e.startsWith("hsl"))?"color":"string"}static parseValue(e,r){if(!e)return"";switch(r){case"number":return Number(e);case"boolean":return e.toLowerCase()==="true";case"color":case"string":default:return e}}static getSystemVariableById(e){return this.getSystemVariables().find(n=>n.id===e)}static getVariableNameById(e){const r=this.getSystemVariableById(e);return r==null?void 0:r.name}static getVariableIdByName(e){const r=this.getSystemVariableByName(e);return r==null?void 0:r.id}}rt(Kn,"STORAGE_KEY","systemVariables");function GI({dimensions:t,canEdit:e=!1}){const{colorMode:r}=Vt(),[n,s]=M.useState(!1),[i,a]=M.useState(null),[l,c]=M.useState(!1),[d,u]=M.useState([]),m=Hr();M.useEffect(()=>{const k=Kn.getSystemVariables();u(k)},[]);const g=()=>{a(null),c(!0),s(!0)},y=k=>{a(k),c(!1),s(!0)},v=k=>{if(Kn.saveSystemVariable(k)){const C=Kn.getSystemVariables();u(C),m({title:l?"System variable created":"System variable updated",status:"success",duration:2e3})}else m({title:"Error",description:"Failed to save system variable",status:"error",duration:3e3,isClosable:!0});s(!1)},I=()=>{s(!1)},S=k=>{if(Kn.deleteSystemVariable(k)){const C=Kn.getSystemVariables();u(C),m({title:"System variable deleted",status:"info",duration:2e3})}else m({title:"Error",description:"Failed to delete system variable",status:"error",duration:3e3,isClosable:!0})},b=(k,A)=>{if(!A)return k;const C=t.find(P=>P.id===A);if(!C)return k;const T=C.modes.find(P=>P.id===k);return T?T.name:k};return o.jsxs(z,{children:[o.jsx(E,{fontSize:"2xl",fontWeight:"bold",mb:2,children:"System Variables"}),o.jsx(E,{fontSize:"sm",color:"gray.600",mb:6,children:"System variables define global values that can be referenced by algorithms and tokens throughout the design system."}),o.jsxs(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:r==="dark"?"gray.900":"white",children:[e&&o.jsx(Oe,{size:"sm",onClick:g,colorScheme:"blue",mb:4,leftIcon:o.jsx(xs,{}),children:"Add System Variable"}),d.length===0?o.jsx(z,{textAlign:"center",py:8,children:o.jsx(E,{color:"gray.500",children:e?"No system variables found. Click 'Add System Variable' to create your first variable.":"No system variables found in this repository."})}):o.jsx(ce,{align:"stretch",spacing:3,children:d.map(k=>o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:r==="dark"?"gray.800":"gray.50",borderColor:r==="dark"?"gray.600":"gray.200",children:o.jsxs(le,{justify:"space-between",align:"center",children:[o.jsxs(z,{children:[o.jsx(E,{fontSize:"lg",fontWeight:"medium",children:k.name}),o.jsx(E,{fontSize:"sm",color:"gray.600",children:k.description}),o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["Value: ",k.defaultValue," | Type: ",k.type]}),k.modeBased&&o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Mode-based variable"}),k.modeBased&&k.valuesByMode&&k.valuesByMode.length>0&&o.jsxs(z,{mt:2,children:[o.jsx(E,{fontSize:"xs",color:"gray.500",mb:1,children:"Mode Values:"}),o.jsx(le,{spacing:2,wrap:"wrap",children:k.valuesByMode.map((A,C)=>o.jsxs(wt,{size:"sm",colorScheme:"purple",variant:"outline",children:[A.modeIds.map(T=>b(T,k.dimensionId)).join(", "),": ",A.value]},A.modeIds.join("-")||C))})]})]}),e&&o.jsxs(le,{children:[o.jsx(Bt,{"aria-label":"Edit system variable",icon:o.jsx(ys,{}),size:"sm",onClick:()=>y(k)}),o.jsx(Bt,{"aria-label":"Delete system variable",icon:o.jsx(As,{}),size:"sm",colorScheme:"red",onClick:()=>S(k.id)})]})]})},k.id))})]}),e&&o.jsx(UI,{open:n,onClose:I,onSave:v,variable:i,isNew:l,dimensions:t})]})}function cs(t){return`Minified Redux error #${t}; visit https://redux.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var HI=typeof Symbol=="function"&&Symbol.observable||"@@observable",zy=HI,Ly=()=>Math.random().toString(36).substring(7).split("").join("."),WI={INIT:`@@redux/INIT${Ly()}`,REPLACE:`@@redux/REPLACE${Ly()}`},By=WI;function qI(t){if(typeof t!="object"||t===null)return!1;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e||Object.getPrototypeOf(t)===null}function Ub(t,e,r){if(typeof t!="function")throw new Error(cs(2));if(typeof e=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(cs(0));if(typeof e=="function"&&typeof r>"u"&&(r=e,e=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(cs(1));return r(Ub)(t,e)}let n=t,s=e,i=new Map,a=i,l=0,c=!1;function d(){a===i&&(a=new Map,i.forEach((S,b)=>{a.set(b,S)}))}function u(){if(c)throw new Error(cs(3));return s}function m(S){if(typeof S!="function")throw new Error(cs(4));if(c)throw new Error(cs(5));let b=!0;d();const k=l++;return a.set(k,S),function(){if(b){if(c)throw new Error(cs(6));b=!1,d(),a.delete(k),i=null}}}function g(S){if(!qI(S))throw new Error(cs(7));if(typeof S.type>"u")throw new Error(cs(8));if(typeof S.type!="string")throw new Error(cs(17));if(c)throw new Error(cs(9));try{c=!0,s=n(s,S)}finally{c=!1}return(i=a).forEach(k=>{k()}),S}function y(S){if(typeof S!="function")throw new Error(cs(10));n=S,g({type:By.REPLACE})}function v(){const S=m;return{subscribe(b){if(typeof b!="object"||b===null)throw new Error(cs(11));function k(){const C=b;C.next&&C.next(u())}return k(),{unsubscribe:S(k)}},[zy](){return this}}}return g({type:By.INIT}),{dispatch:g,subscribe:m,getState:u,replaceReducer:y,[zy]:v}}function Uy(t,e){return function(...r){return e(t.apply(this,r))}}function Gy(t,e){if(typeof t=="function")return Uy(t,e);if(typeof t!="object"||t===null)throw new Error(cs(16));const r={};for(const n in t){const s=t[n];typeof s=="function"&&(r[n]=Uy(s,e))}return r}function Gb(...t){return t.length===0?e=>e:t.length===1?t[0]:t.reduce((e,r)=>(...n)=>e(r(...n)))}function JI(...t){return e=>(r,n)=>{const s=e(r,n);let i=()=>{throw new Error(cs(15))};const a={getState:s.getState,dispatch:(c,...d)=>i(c,...d)},l=t.map(c=>c(a));return i=Gb(...l)(s.dispatch),{...s,dispatch:i}}}var YI={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lc=M;function KI(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ZI=typeof Object.is=="function"?Object.is:KI,XI=Lc.useSyncExternalStore,QI=Lc.useRef,e7=Lc.useEffect,t7=Lc.useMemo,r7=Lc.useDebugValue;YI.useSyncExternalStoreWithSelector=function(t,e,r,n,s){var i=QI(null);if(i.current===null){var a={hasValue:!1,value:null};i.current=a}else a=i.current;i=t7(function(){function c(y){if(!d){if(d=!0,u=y,y=n(y),s!==void 0&&a.hasValue){var v=a.value;if(s(v,y))return m=v}return m=y}if(v=m,ZI(u,y))return v;var I=n(y);return s!==void 0&&s(v,I)?(u=y,v):(u=y,m=I)}var d=!1,u,m,g=r===void 0?null:r;return[function(){return c(e())},g===null?void 0:function(){return c(g())}]},[e,r,n,s]);var l=XI(t,i[0],i[1]);return e7(function(){a.hasValue=!0,a.value=l},[l]),r7(l),l};var n7=M.version.startsWith("19"),s7=Symbol.for(n7?"react.transitional.element":"react.element"),o7=Symbol.for("react.portal"),i7=Symbol.for("react.fragment"),a7=Symbol.for("react.strict_mode"),l7=Symbol.for("react.profiler"),c7=Symbol.for("react.consumer"),d7=Symbol.for("react.context"),Hb=Symbol.for("react.forward_ref"),u7=Symbol.for("react.suspense"),h7=Symbol.for("react.suspense_list"),Zf=Symbol.for("react.memo"),m7=Symbol.for("react.lazy"),p7=Hb,f7=Zf;function g7(t){if(typeof t=="object"&&t!==null){const{$$typeof:e}=t;switch(e){case s7:switch(t=t.type,t){case i7:case l7:case a7:case u7:case h7:return t;default:switch(t=t&&t.$$typeof,t){case d7:case Hb:case m7:case Zf:return t;case c7:return t;default:return e}}case o7:return e}}}function y7(t){return g7(t)===Zf}function x7(t,e,r,n,{areStatesEqual:s,areOwnPropsEqual:i,areStatePropsEqual:a}){let l=!1,c,d,u,m,g;function y(k,A){return c=k,d=A,u=t(c,d),m=e(n,d),g=r(u,m,d),l=!0,g}function v(){return u=t(c,d),e.dependsOnOwnProps&&(m=e(n,d)),g=r(u,m,d),g}function I(){return t.dependsOnOwnProps&&(u=t(c,d)),e.dependsOnOwnProps&&(m=e(n,d)),g=r(u,m,d),g}function S(){const k=t(c,d),A=!a(k,u);return u=k,A&&(g=r(u,m,d)),g}function b(k,A){const C=!i(A,d),T=!s(k,c,A,d);return c=k,d=A,C&&T?v():C?I():T?S():g}return function(A,C){return l?b(A,C):y(A,C)}}function v7(t,{initMapStateToProps:e,initMapDispatchToProps:r,initMergeProps:n,...s}){const i=e(t,s),a=r(t,s),l=n(t,s);return x7(i,a,l,t,s)}function b7(t,e){const r={};for(const n in t){const s=t[n];typeof s=="function"&&(r[n]=(...i)=>e(s(...i)))}return r}function Lp(t){return function(r){const n=t(r);function s(){return n}return s.dependsOnOwnProps=!1,s}}function Hy(t){return t.dependsOnOwnProps?!!t.dependsOnOwnProps:t.length!==1}function Wb(t,e){return function(n,{displayName:s}){const i=function(l,c){return i.dependsOnOwnProps?i.mapToProps(l,c):i.mapToProps(l,void 0)};return i.dependsOnOwnProps=!0,i.mapToProps=function(l,c){i.mapToProps=t,i.dependsOnOwnProps=Hy(t);let d=i(l,c);return typeof d=="function"&&(i.mapToProps=d,i.dependsOnOwnProps=Hy(d),d=i(l,c)),d},i}}function Xf(t,e){return(r,n)=>{throw new Error(`Invalid value of type ${typeof t} for ${e} argument when connecting component ${n.wrappedComponentName}.`)}}function S7(t){return t&&typeof t=="object"?Lp(e=>b7(t,e)):t?typeof t=="function"?Wb(t):Xf(t,"mapDispatchToProps"):Lp(e=>({dispatch:e}))}function w7(t){return t?typeof t=="function"?Wb(t):Xf(t,"mapStateToProps"):Lp(()=>({}))}function C7(t,e,r){return{...r,...t,...e}}function k7(t){return function(r,{displayName:n,areMergedPropsEqual:s}){let i=!1,a;return function(c,d,u){const m=t(c,d,u);return i?s(m,a)||(a=m):(i=!0,a=m),a}}}function I7(t){return t?typeof t=="function"?k7(t):Xf(t,"mergeProps"):()=>C7}function j7(t){t()}function T7(){let t=null,e=null;return{clear(){t=null,e=null},notify(){j7(()=>{let r=t;for(;r;)r.callback(),r=r.next})},get(){const r=[];let n=t;for(;n;)r.push(n),n=n.next;return r},subscribe(r){let n=!0;const s=e={callback:r,next:null,prev:e};return s.prev?s.prev.next=s:t=s,function(){!n||t===null||(n=!1,s.next?s.next.prev=s.prev:e=s.prev,s.prev?s.prev.next=s.next:t=s.next)}}}}var Wy={notify(){},get:()=>[]};function qb(t,e){let r,n=Wy,s=0,i=!1;function a(I){u();const S=n.subscribe(I);let b=!1;return()=>{b||(b=!0,S(),m())}}function l(){n.notify()}function c(){v.onStateChange&&v.onStateChange()}function d(){return i}function u(){s++,r||(r=e?e.addNestedSub(c):t.subscribe(c),n=T7())}function m(){s--,r&&s===0&&(r(),r=void 0,n.clear(),n=Wy)}function g(){i||(i=!0,u())}function y(){i&&(i=!1,m())}const v={addNestedSub:a,notifyNestedSubs:l,handleChangeWrapper:c,isSubscribed:d,trySubscribe:g,tryUnsubscribe:y,getListeners:()=>n};return v}var E7=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",M7=E7(),A7=()=>typeof navigator<"u"&&navigator.product==="ReactNative",P7=A7(),N7=()=>M7||P7?M.useLayoutEffect:M.useEffect,Cu=N7();function qy(t,e){return t===e?t!==0||e!==0||1/t===1/e:t!==t&&e!==e}function sm(t,e){if(qy(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let s=0;s<r.length;s++)if(!Object.prototype.hasOwnProperty.call(e,r[s])||!qy(t[r[s]],e[r[s]]))return!1;return!0}var D7={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},R7={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},O7={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Jb={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},_7={[p7]:O7,[f7]:Jb};function Jy(t){return y7(t)?Jb:_7[t.$$typeof]||D7}var F7=Object.defineProperty,V7=Object.getOwnPropertyNames,Yy=Object.getOwnPropertySymbols,$7=Object.getOwnPropertyDescriptor,z7=Object.getPrototypeOf,Ky=Object.prototype;function Bp(t,e){if(typeof e!="string"){if(Ky){const i=z7(e);i&&i!==Ky&&Bp(t,i)}let r=V7(e);Yy&&(r=r.concat(Yy(e)));const n=Jy(t),s=Jy(e);for(let i=0;i<r.length;++i){const a=r[i];if(!R7[a]&&!(s&&s[a])&&!(n&&n[a])){const l=$7(e,a);try{F7(t,a,l)}catch{}}}}return t}var om=Symbol.for("react-redux-context"),im=typeof globalThis<"u"?globalThis:{};function L7(){if(!M.createContext)return{};const t=im[om]??(im[om]=new Map);let e=t.get(M.createContext);return e||(e=M.createContext(null),t.set(M.createContext,e)),e}var Yb=L7(),B7=[null,null];function U7(t,e,r){Cu(()=>t(...e),r)}function G7(t,e,r,n,s,i){t.current=n,r.current=!1,s.current&&(s.current=null,i())}function H7(t,e,r,n,s,i,a,l,c,d,u){if(!t)return()=>{};let m=!1,g=null;const y=()=>{if(m||!l.current)return;const I=e.getState();let S,b;try{S=n(I,s.current)}catch(k){b=k,g=k}b||(g=null),S===i.current?a.current||d():(i.current=S,c.current=S,a.current=!0,u())};return r.onStateChange=y,r.trySubscribe(),y(),()=>{if(m=!0,r.tryUnsubscribe(),r.onStateChange=null,g)throw g}}function W7(t,e){return t===e}function q7(t,e,r,{pure:n,areStatesEqual:s=W7,areOwnPropsEqual:i=sm,areStatePropsEqual:a=sm,areMergedPropsEqual:l=sm,forwardRef:c=!1,context:d=Yb}={}){const u=d,m=w7(t),g=S7(e),y=I7(r),v=!!t;return S=>{const b=S.displayName||S.name||"Component",k=`Connect(${b})`,A={shouldHandleStateChanges:v,displayName:k,wrappedComponentName:b,WrappedComponent:S,initMapStateToProps:m,initMapDispatchToProps:g,initMergeProps:y,areStatesEqual:s,areStatePropsEqual:a,areOwnPropsEqual:i,areMergedPropsEqual:l};function C(_){const[R,G,ne]=M.useMemo(()=>{const{reactReduxForwardedRef:Ce,...ue}=_;return[_.context,Ce,ue]},[_]),he=M.useMemo(()=>{let Ce=u;return R!=null&&R.Consumer,Ce},[R,u]),te=M.useContext(he),K=!!_.store&&!!_.store.getState&&!!_.store.dispatch,O=!!te&&!!te.store,Z=K?_.store:te.store,ie=O?te.getServerState:Z.getState,ge=M.useMemo(()=>v7(Z.dispatch,A),[Z]),[xe,$]=M.useMemo(()=>{if(!v)return B7;const Ce=qb(Z,K?void 0:te.subscription),ue=Ce.notifyNestedSubs.bind(Ce);return[Ce,ue]},[Z,K,te]),B=M.useMemo(()=>K?te:{...te,subscription:xe},[K,te,xe]),U=M.useRef(void 0),X=M.useRef(ne),ee=M.useRef(void 0),be=M.useRef(!1),Se=M.useRef(!1),Me=M.useRef(void 0);Cu(()=>(Se.current=!0,()=>{Se.current=!1}),[]);const se=M.useMemo(()=>()=>ee.current&&ne===X.current?ee.current:ge(Z.getState(),ne),[Z,ne]),de=M.useMemo(()=>ue=>xe?H7(v,Z,xe,ge,X,U,be,Se,ee,$,ue):()=>{},[xe]);U7(G7,[X,U,be,ne,ee,$]);let fe;try{fe=M.useSyncExternalStore(de,se,ie?()=>ge(ie(),ne):se)}catch(Ce){throw Me.current&&(Ce.message+=`
The error may be correlated with this previous error:
${Me.current.stack}

`),Ce}Cu(()=>{Me.current=void 0,ee.current=void 0,U.current=fe});const _e=M.useMemo(()=>M.createElement(S,{...fe,ref:G}),[G,S,fe]);return M.useMemo(()=>v?M.createElement(he.Provider,{value:B},_e):_e,[he,_e,B])}const P=M.memo(C);if(P.WrappedComponent=S,P.displayName=C.displayName=k,c){const R=M.forwardRef(function(ne,he){return M.createElement(P,{...ne,reactReduxForwardedRef:he})});return R.displayName=k,R.WrappedComponent=S,Bp(R,S)}return Bp(P,S)}}var Kb=q7;function J7(t){const{children:e,context:r,serverState:n,store:s}=t,i=M.useMemo(()=>{const c=qb(s);return{store:s,subscription:c,getServerState:n?()=>n:void 0}},[s,n]),a=M.useMemo(()=>s.getState(),[s]);Cu(()=>{const{subscription:c}=i;return c.onStateChange=c.notifyNestedSubs,c.trySubscribe(),a!==s.getState()&&c.notifyNestedSubs(),()=>{c.tryUnsubscribe(),c.onStateChange=void 0}},[i,a]);const l=r||Yb;return M.createElement(l.Provider,{value:i},e)}var Y7=J7,bc=function(e){var r=[],n=null,s=function(){for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];r=l,!n&&(n=requestAnimationFrame(function(){n=null,e.apply(void 0,r)}))};return s.cancel=function(){n&&(cancelAnimationFrame(n),n=null)},s};function Zb(t,e){}Zb.bind(null,"warn");Zb.bind(null,"error");function Ti(){}function K7(t,e){return{...t,...e}}function ro(t,e,r){const n=e.map(s=>{const i=K7(r,s.options);return t.addEventListener(s.eventName,s.fn,i),function(){t.removeEventListener(s.eventName,s.fn,i)}});return function(){n.forEach(i=>{i()})}}const Z7="Invariant failed";class ku extends Error{}ku.prototype.toString=function(){return this.message};function St(t,e){throw new ku(Z7)}class X7 extends nr.Component{constructor(...e){super(...e),this.callbacks=null,this.unbind=Ti,this.onWindowError=r=>{const n=this.getCallbacks();n.isDragging()&&n.tryAbort(),r.error instanceof ku&&r.preventDefault()},this.getCallbacks=()=>{if(!this.callbacks)throw new Error("Unable to find AppCallbacks in <ErrorBoundary/>");return this.callbacks},this.setCallbacks=r=>{this.callbacks=r}}componentDidMount(){this.unbind=ro(window,[{eventName:"error",fn:this.onWindowError}])}componentDidCatch(e){if(e instanceof ku){this.setState({});return}throw e}componentWillUnmount(){this.unbind()}render(){return this.props.children(this.setCallbacks)}}const Q7=`
  Press space bar to start a drag.
  When dragging you can use the arrow keys to move the item around and escape to cancel.
  Some screen readers may require you to be in focus mode or to use your pass through key
`,Iu=t=>t+1,ej=t=>`
  You have lifted an item in position ${Iu(t.source.index)}
`,Xb=(t,e)=>{const r=t.droppableId===e.droppableId,n=Iu(t.index),s=Iu(e.index);return r?`
      You have moved the item from position ${n}
      to position ${s}
    `:`
    You have moved the item from position ${n}
    in list ${t.droppableId}
    to list ${e.droppableId}
    in position ${s}
  `},Qb=(t,e,r)=>e.droppableId===r.droppableId?`
      The item ${t}
      has been combined with ${r.draggableId}`:`
      The item ${t}
      in list ${e.droppableId}
      has been combined with ${r.draggableId}
      in list ${r.droppableId}
    `,tj=t=>{const e=t.destination;if(e)return Xb(t.source,e);const r=t.combine;return r?Qb(t.draggableId,t.source,r):"You are over an area that cannot be dropped on"},Zy=t=>`
  The item has returned to its starting position
  of ${Iu(t.index)}
`,rj=t=>{if(t.reason==="CANCEL")return`
      Movement cancelled.
      ${Zy(t.source)}
    `;const e=t.destination,r=t.combine;return e?`
      You have dropped the item.
      ${Xb(t.source,e)}
    `:r?`
      You have dropped the item.
      ${Qb(t.draggableId,t.source,r)}
    `:`
    The item has been dropped while not over a drop area.
    ${Zy(t.source)}
  `},Vd={dragHandleUsageInstructions:Q7,onDragStart:ej,onDragUpdate:tj,onDragEnd:rj};function nj(t,e){return!!(t===e||Number.isNaN(t)&&Number.isNaN(e))}function e2(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!nj(t[r],e[r]))return!1;return!0}function Vr(t,e){const r=M.useState(()=>({inputs:e,result:t()}))[0],n=M.useRef(!0),s=M.useRef(r),a=n.current||!!(e&&s.current.inputs&&e2(e,s.current.inputs))?s.current:{inputs:e,result:t()};return M.useEffect(()=>{n.current=!1,s.current=a},[a]),a.result}function Jt(t,e){return Vr(()=>t,e)}const qn={x:0,y:0},Qn=(t,e)=>({x:t.x+e.x,y:t.y+e.y}),Rs=(t,e)=>({x:t.x-e.x,y:t.y-e.y}),Ei=(t,e)=>t.x===e.x&&t.y===e.y,Ml=t=>({x:t.x!==0?-t.x:0,y:t.y!==0?-t.y:0}),za=(t,e,r=0)=>t==="x"?{x:e,y:r}:{x:r,y:e},Sc=(t,e)=>Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2),Xy=(t,e)=>Math.min(...e.map(r=>Sc(t,r))),t2=t=>e=>({x:t(e.x),y:t(e.y)});var sj=(t,e)=>{const r=Ga({top:Math.max(e.top,t.top),right:Math.min(e.right,t.right),bottom:Math.min(e.bottom,t.bottom),left:Math.max(e.left,t.left)});return r.width<=0||r.height<=0?null:r};const Bc=(t,e)=>({top:t.top+e.y,left:t.left+e.x,bottom:t.bottom+e.y,right:t.right+e.x}),Qy=t=>[{x:t.left,y:t.top},{x:t.right,y:t.top},{x:t.left,y:t.bottom},{x:t.right,y:t.bottom}],oj={top:0,right:0,bottom:0,left:0},ij=(t,e)=>e?Bc(t,e.scroll.diff.displacement):t,aj=(t,e,r)=>r&&r.increasedBy?{...t,[e.end]:t[e.end]+r.increasedBy[e.line]}:t,lj=(t,e)=>e&&e.shouldClipSubject?sj(e.pageMarginBox,t):Ga(t);var xl=({page:t,withPlaceholder:e,axis:r,frame:n})=>{const s=ij(t.marginBox,n),i=aj(s,r,e),a=lj(i,n);return{page:t,withPlaceholder:e,active:a}},Qf=(t,e)=>{t.frame||St();const r=t.frame,n=Rs(e,r.scroll.initial),s=Ml(n),i={...r,scroll:{initial:r.scroll.initial,current:e,diff:{value:n,displacement:s},max:r.scroll.max}},a=xl({page:t.subject.page,withPlaceholder:t.subject.withPlaceholder,axis:t.axis,frame:i});return{...t,frame:i,subject:a}};function Wn(t,e=e2){let r=null;function n(...s){if(r&&r.lastThis===this&&e(s,r.lastArgs))return r.lastResult;const i=t.apply(this,s);return r={lastResult:i,lastArgs:s,lastThis:this},i}return n.clear=function(){r=null},n}const r2=Wn(t=>t.reduce((e,r)=>(e[r.descriptor.id]=r,e),{})),n2=Wn(t=>t.reduce((e,r)=>(e[r.descriptor.id]=r,e),{})),Zu=Wn(t=>Object.values(t)),cj=Wn(t=>Object.values(t));var Al=Wn((t,e)=>cj(e).filter(n=>t===n.descriptor.droppableId).sort((n,s)=>n.descriptor.index-s.descriptor.index));function e0(t){return t.at&&t.at.type==="REORDER"?t.at.destination:null}function Xu(t){return t.at&&t.at.type==="COMBINE"?t.at.combine:null}var Qu=Wn((t,e)=>e.filter(r=>r.descriptor.id!==t.descriptor.id)),dj=({isMovingForward:t,draggable:e,destination:r,insideDestination:n,previousImpact:s})=>{if(!r.isCombineEnabled||!e0(s))return null;function a(y){const v={type:"COMBINE",combine:{draggableId:y,droppableId:r.descriptor.id}};return{...s,at:v}}const l=s.displaced.all,c=l.length?l[0]:null;if(t)return c?a(c):null;const d=Qu(e,n);if(!c){if(!d.length)return null;const y=d[d.length-1];return a(y.descriptor.id)}const u=d.findIndex(y=>y.descriptor.id===c);u===-1&&St();const m=u-1;if(m<0)return null;const g=d[m];return a(g.descriptor.id)},Pl=(t,e)=>t.descriptor.droppableId===e.descriptor.id;const s2={point:qn,value:0},wc={invisible:{},visible:{},all:[]},uj={displaced:wc,displacedBy:s2,at:null};var so=(t,e)=>r=>t<=r&&r<=e,o2=t=>{const e=so(t.top,t.bottom),r=so(t.left,t.right);return n=>{if(e(n.top)&&e(n.bottom)&&r(n.left)&&r(n.right))return!0;const i=e(n.top)||e(n.bottom),a=r(n.left)||r(n.right);if(i&&a)return!0;const c=n.top<t.top&&n.bottom>t.bottom,d=n.left<t.left&&n.right>t.right;return c&&d?!0:c&&a||d&&i}},hj=t=>{const e=so(t.top,t.bottom),r=so(t.left,t.right);return n=>e(n.top)&&e(n.bottom)&&r(n.left)&&r(n.right)};const t0={direction:"vertical",line:"y",crossAxisLine:"x",start:"top",end:"bottom",size:"height",crossAxisStart:"left",crossAxisEnd:"right",crossAxisSize:"width"},i2={direction:"horizontal",line:"x",crossAxisLine:"y",start:"left",end:"right",size:"width",crossAxisStart:"top",crossAxisEnd:"bottom",crossAxisSize:"height"};var mj=t=>e=>{const r=so(e.top,e.bottom),n=so(e.left,e.right);return s=>t===t0?r(s.top)&&r(s.bottom):n(s.left)&&n(s.right)};const pj=(t,e)=>{const r=e.frame?e.frame.scroll.diff.displacement:qn;return Bc(t,r)},fj=(t,e,r)=>e.subject.active?r(e.subject.active)(t):!1,gj=(t,e,r)=>r(e)(t),r0=({target:t,destination:e,viewport:r,withDroppableDisplacement:n,isVisibleThroughFrameFn:s})=>{const i=n?pj(t,e):t;return fj(i,e,s)&&gj(i,r,s)},yj=t=>r0({...t,isVisibleThroughFrameFn:o2}),a2=t=>r0({...t,isVisibleThroughFrameFn:hj}),xj=t=>r0({...t,isVisibleThroughFrameFn:mj(t.destination.axis)}),vj=(t,e,r)=>{if(typeof r=="boolean")return r;if(!e)return!0;const{invisible:n,visible:s}=e;if(n[t])return!1;const i=s[t];return i?i.shouldAnimate:!0};function bj(t,e){const r=t.page.marginBox,n={top:e.point.y,right:0,bottom:0,left:e.point.x};return Ga(Lv(r,n))}function Cc({afterDragging:t,destination:e,displacedBy:r,viewport:n,forceShouldAnimate:s,last:i}){return t.reduce(function(l,c){const d=bj(c,r),u=c.descriptor.id;if(l.all.push(u),!yj({target:d,destination:e,viewport:n,withDroppableDisplacement:!0}))return l.invisible[c.descriptor.id]=!0,l;const g=vj(u,i,s),y={draggableId:u,shouldAnimate:g};return l.visible[u]=y,l},{all:[],visible:{},invisible:{}})}function Sj(t,e){if(!t.length)return 0;const r=t[t.length-1].descriptor.index;return e.inHomeList?r:r+1}function ex({insideDestination:t,inHomeList:e,displacedBy:r,destination:n}){const s=Sj(t,{inHomeList:e});return{displaced:wc,displacedBy:r,at:{type:"REORDER",destination:{droppableId:n.descriptor.id,index:s}}}}function ju({draggable:t,insideDestination:e,destination:r,viewport:n,displacedBy:s,last:i,index:a,forceShouldAnimate:l}){const c=Pl(t,r);if(a==null)return ex({insideDestination:e,inHomeList:c,displacedBy:s,destination:r});const d=e.find(v=>v.descriptor.index===a);if(!d)return ex({insideDestination:e,inHomeList:c,displacedBy:s,destination:r});const u=Qu(t,e),m=e.indexOf(d),g=u.slice(m);return{displaced:Cc({afterDragging:g,destination:r,displacedBy:s,last:i,viewport:n.frame,forceShouldAnimate:l}),displacedBy:s,at:{type:"REORDER",destination:{droppableId:r.descriptor.id,index:a}}}}function Oi(t,e){return!!e.effected[t]}var wj=({isMovingForward:t,destination:e,draggables:r,combine:n,afterCritical:s})=>{if(!e.isCombineEnabled)return null;const i=n.draggableId,l=r[i].descriptor.index;return Oi(i,s)?t?l:l-1:t?l+1:l},Cj=({isMovingForward:t,isInHomeList:e,insideDestination:r,location:n})=>{if(!r.length)return null;const s=n.index,i=t?s+1:s-1,a=r[0].descriptor.index,l=r[r.length-1].descriptor.index,c=e?l:l+1;return i<a||i>c?null:i},kj=({isMovingForward:t,isInHomeList:e,draggable:r,draggables:n,destination:s,insideDestination:i,previousImpact:a,viewport:l,afterCritical:c})=>{const d=a.at;if(d||St(),d.type==="REORDER"){const m=Cj({isMovingForward:t,isInHomeList:e,location:d.destination,insideDestination:i});return m==null?null:ju({draggable:r,insideDestination:i,destination:s,viewport:l,last:a.displaced,displacedBy:a.displacedBy,index:m})}const u=wj({isMovingForward:t,destination:s,displaced:a.displaced,draggables:n,combine:d.combine,afterCritical:c});return u==null?null:ju({draggable:r,insideDestination:i,destination:s,viewport:l,last:a.displaced,displacedBy:a.displacedBy,index:u})},Ij=({displaced:t,afterCritical:e,combineWith:r,displacedBy:n})=>{const s=!!(t.visible[r]||t.invisible[r]);return Oi(r,e)?s?qn:Ml(n.point):s?n.point:qn},jj=({afterCritical:t,impact:e,draggables:r})=>{const n=Xu(e);n||St();const s=n.draggableId,i=r[s].page.borderBox.center,a=Ij({displaced:e.displaced,afterCritical:t,combineWith:s,displacedBy:e.displacedBy});return Qn(i,a)};const l2=(t,e)=>e.margin[t.start]+e.borderBox[t.size]/2,Tj=(t,e)=>e.margin[t.end]+e.borderBox[t.size]/2,n0=(t,e,r)=>e[t.crossAxisStart]+r.margin[t.crossAxisStart]+r.borderBox[t.crossAxisSize]/2,tx=({axis:t,moveRelativeTo:e,isMoving:r})=>za(t.line,e.marginBox[t.end]+l2(t,r),n0(t,e.marginBox,r)),rx=({axis:t,moveRelativeTo:e,isMoving:r})=>za(t.line,e.marginBox[t.start]-Tj(t,r),n0(t,e.marginBox,r)),Ej=({axis:t,moveInto:e,isMoving:r})=>za(t.line,e.contentBox[t.start]+l2(t,r),n0(t,e.contentBox,r));var Mj=({impact:t,draggable:e,draggables:r,droppable:n,afterCritical:s})=>{const i=Al(n.descriptor.id,r),a=e.page,l=n.axis;if(!i.length)return Ej({axis:l,moveInto:n.page,isMoving:a});const{displaced:c,displacedBy:d}=t,u=c.all[0];if(u){const g=r[u];if(Oi(u,s))return rx({axis:l,moveRelativeTo:g.page,isMoving:a});const y=Hm(g.page,d.point);return rx({axis:l,moveRelativeTo:y,isMoving:a})}const m=i[i.length-1];if(m.descriptor.id===e.descriptor.id)return a.borderBox.center;if(Oi(m.descriptor.id,s)){const g=Hm(m.page,Ml(s.displacedBy.point));return tx({axis:l,moveRelativeTo:g,isMoving:a})}return tx({axis:l,moveRelativeTo:m.page,isMoving:a})},Up=(t,e)=>{const r=t.frame;return r?Qn(e,r.scroll.diff.displacement):e};const Aj=({impact:t,draggable:e,droppable:r,draggables:n,afterCritical:s})=>{const i=e.page.borderBox.center,a=t.at;return!r||!a?i:a.type==="REORDER"?Mj({impact:t,draggable:e,draggables:n,droppable:r,afterCritical:s}):jj({impact:t,draggables:n,afterCritical:s})};var eh=t=>{const e=Aj(t),r=t.droppable;return r?Up(r,e):e},c2=(t,e)=>{const r=Rs(e,t.scroll.initial),n=Ml(r);return{frame:Ga({top:e.y,bottom:e.y+t.frame.height,left:e.x,right:e.x+t.frame.width}),scroll:{initial:t.scroll.initial,max:t.scroll.max,current:e,diff:{value:r,displacement:n}}}};function nx(t,e){return t.map(r=>e[r])}function Pj(t,e){for(let r=0;r<e.length;r++){const n=e[r].visible[t];if(n)return n}return null}var Nj=({impact:t,viewport:e,destination:r,draggables:n,maxScrollChange:s})=>{const i=c2(e,Qn(e.scroll.current,s)),a=r.frame?Qf(r,Qn(r.frame.scroll.current,s)):r,l=t.displaced,c=Cc({afterDragging:nx(l.all,n),destination:r,displacedBy:t.displacedBy,viewport:i.frame,last:l,forceShouldAnimate:!1}),d=Cc({afterDragging:nx(l.all,n),destination:a,displacedBy:t.displacedBy,viewport:e.frame,last:l,forceShouldAnimate:!1}),u={},m={},g=[l,c,d];return l.all.forEach(v=>{const I=Pj(v,g);if(I){m[v]=I;return}u[v]=!0}),{...t,displaced:{all:l.all,invisible:u,visible:m}}},Dj=(t,e)=>Qn(t.scroll.diff.displacement,e),s0=({pageBorderBoxCenter:t,draggable:e,viewport:r})=>{const n=Dj(r,t),s=Rs(n,e.page.borderBox.center);return Qn(e.client.borderBox.center,s)},d2=({draggable:t,destination:e,newPageBorderBoxCenter:r,viewport:n,withDroppableDisplacement:s,onlyOnMainAxis:i=!1})=>{const a=Rs(r,t.page.borderBox.center),c={target:Bc(t.page.borderBox,a),destination:e,withDroppableDisplacement:s,viewport:n};return i?xj(c):a2(c)},Rj=({isMovingForward:t,draggable:e,destination:r,draggables:n,previousImpact:s,viewport:i,previousPageBorderBoxCenter:a,previousClientSelection:l,afterCritical:c})=>{if(!r.isEnabled)return null;const d=Al(r.descriptor.id,n),u=Pl(e,r),m=dj({isMovingForward:t,draggable:e,destination:r,insideDestination:d,previousImpact:s})||kj({isMovingForward:t,isInHomeList:u,draggable:e,draggables:n,destination:r,insideDestination:d,previousImpact:s,viewport:i,afterCritical:c});if(!m)return null;const g=eh({impact:m,draggable:e,droppable:r,draggables:n,afterCritical:c});if(d2({draggable:e,destination:r,newPageBorderBoxCenter:g,viewport:i.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0}))return{clientSelection:s0({pageBorderBoxCenter:g,draggable:e,viewport:i}),impact:m,scrollJumpRequest:null};const v=Rs(g,a),I=Nj({impact:m,viewport:i,destination:r,draggables:n,maxScrollChange:v});return{clientSelection:l,impact:I,scrollJumpRequest:v}};const as=t=>{const e=t.subject.active;return e||St(),e};var Oj=({isMovingForward:t,pageBorderBoxCenter:e,source:r,droppables:n,viewport:s})=>{const i=r.subject.active;if(!i)return null;const a=r.axis,l=so(i[a.start],i[a.end]),c=Zu(n).filter(u=>u!==r).filter(u=>u.isEnabled).filter(u=>!!u.subject.active).filter(u=>o2(s.frame)(as(u))).filter(u=>{const m=as(u);return t?i[a.crossAxisEnd]<m[a.crossAxisEnd]:m[a.crossAxisStart]<i[a.crossAxisStart]}).filter(u=>{const m=as(u),g=so(m[a.start],m[a.end]);return l(m[a.start])||l(m[a.end])||g(i[a.start])||g(i[a.end])}).sort((u,m)=>{const g=as(u)[a.crossAxisStart],y=as(m)[a.crossAxisStart];return t?g-y:y-g}).filter((u,m,g)=>as(u)[a.crossAxisStart]===as(g[0])[a.crossAxisStart]);if(!c.length)return null;if(c.length===1)return c[0];const d=c.filter(u=>so(as(u)[a.start],as(u)[a.end])(e[a.line]));return d.length===1?d[0]:d.length>1?d.sort((u,m)=>as(u)[a.start]-as(m)[a.start])[0]:c.sort((u,m)=>{const g=Xy(e,Qy(as(u))),y=Xy(e,Qy(as(m)));return g!==y?g-y:as(u)[a.start]-as(m)[a.start]})[0]};const sx=(t,e)=>{const r=t.page.borderBox.center;return Oi(t.descriptor.id,e)?Rs(r,e.displacedBy.point):r},_j=(t,e)=>{const r=t.page.borderBox;return Oi(t.descriptor.id,e)?Bc(r,Ml(e.displacedBy.point)):r};var Fj=({pageBorderBoxCenter:t,viewport:e,destination:r,insideDestination:n,afterCritical:s})=>n.filter(a=>a2({target:_j(a,s),destination:r,viewport:e.frame,withDroppableDisplacement:!0})).sort((a,l)=>{const c=Sc(t,Up(r,sx(a,s))),d=Sc(t,Up(r,sx(l,s)));return c<d?-1:d<c?1:a.descriptor.index-l.descriptor.index})[0]||null,Uc=Wn(function(e,r){const n=r[e.line];return{value:n,point:za(e.line,n)}});const Vj=(t,e,r)=>{const n=t.axis;if(t.descriptor.mode==="virtual")return za(n.line,e[n.line]);const s=t.subject.page.contentBox[n.size],c=Al(t.descriptor.id,r).reduce((d,u)=>d+u.client.marginBox[n.size],0)+e[n.line]-s;return c<=0?null:za(n.line,c)},u2=(t,e)=>({...t,scroll:{...t.scroll,max:e}}),h2=(t,e,r)=>{const n=t.frame;Pl(e,t)&&St(),t.subject.withPlaceholder&&St();const s=Uc(t.axis,e.displaceBy).point,i=Vj(t,s,r),a={placeholderSize:s,increasedBy:i,oldFrameMaxScroll:t.frame?t.frame.scroll.max:null};if(!n){const u=xl({page:t.subject.page,withPlaceholder:a,axis:t.axis,frame:t.frame});return{...t,subject:u}}const l=i?Qn(n.scroll.max,i):n.scroll.max,c=u2(n,l),d=xl({page:t.subject.page,withPlaceholder:a,axis:t.axis,frame:c});return{...t,subject:d,frame:c}},$j=t=>{const e=t.subject.withPlaceholder;e||St();const r=t.frame;if(!r){const a=xl({page:t.subject.page,axis:t.axis,frame:null,withPlaceholder:null});return{...t,subject:a}}const n=e.oldFrameMaxScroll;n||St();const s=u2(r,n),i=xl({page:t.subject.page,axis:t.axis,frame:s,withPlaceholder:null});return{...t,subject:i,frame:s}};var zj=({previousPageBorderBoxCenter:t,moveRelativeTo:e,insideDestination:r,draggable:n,draggables:s,destination:i,viewport:a,afterCritical:l})=>{if(!e){if(r.length)return null;const m={displaced:wc,displacedBy:s2,at:{type:"REORDER",destination:{droppableId:i.descriptor.id,index:0}}},g=eh({impact:m,draggable:n,droppable:i,draggables:s,afterCritical:l}),y=Pl(n,i)?i:h2(i,n,s);return d2({draggable:n,destination:y,newPageBorderBoxCenter:g,viewport:a.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0})?m:null}const c=t[i.axis.line]<=e.page.borderBox.center[i.axis.line],d=(()=>{const m=e.descriptor.index;return e.descriptor.id===n.descriptor.id||c?m:m+1})(),u=Uc(i.axis,n.displaceBy);return ju({draggable:n,insideDestination:r,destination:i,viewport:a,displacedBy:u,last:wc,index:d})},Lj=({isMovingForward:t,previousPageBorderBoxCenter:e,draggable:r,isOver:n,draggables:s,droppables:i,viewport:a,afterCritical:l})=>{const c=Oj({isMovingForward:t,pageBorderBoxCenter:e,source:n,droppables:i,viewport:a});if(!c)return null;const d=Al(c.descriptor.id,s),u=Fj({pageBorderBoxCenter:e,viewport:a,destination:c,insideDestination:d,afterCritical:l}),m=zj({previousPageBorderBoxCenter:e,destination:c,draggable:r,draggables:s,moveRelativeTo:u,insideDestination:d,viewport:a,afterCritical:l});if(!m)return null;const g=eh({impact:m,draggable:r,droppable:c,draggables:s,afterCritical:l});return{clientSelection:s0({pageBorderBoxCenter:g,draggable:r,viewport:a}),impact:m,scrollJumpRequest:null}},Fs=t=>{const e=t.at;return e?e.type==="REORDER"?e.destination.droppableId:e.combine.droppableId:null};const Bj=(t,e)=>{const r=Fs(t);return r?e[r]:null};var Uj=({state:t,type:e})=>{const r=Bj(t.impact,t.dimensions.droppables),n=!!r,s=t.dimensions.droppables[t.critical.droppable.id],i=r||s,a=i.axis.direction,l=a==="vertical"&&(e==="MOVE_UP"||e==="MOVE_DOWN")||a==="horizontal"&&(e==="MOVE_LEFT"||e==="MOVE_RIGHT");if(l&&!n)return null;const c=e==="MOVE_DOWN"||e==="MOVE_RIGHT",d=t.dimensions.draggables[t.critical.draggable.id],u=t.current.page.borderBoxCenter,{draggables:m,droppables:g}=t.dimensions;return l?Rj({isMovingForward:c,previousPageBorderBoxCenter:u,draggable:d,destination:i,draggables:m,viewport:t.viewport,previousClientSelection:t.current.client.selection,previousImpact:t.impact,afterCritical:t.afterCritical}):Lj({isMovingForward:c,previousPageBorderBoxCenter:u,draggable:d,isOver:i,draggables:m,droppables:g,viewport:t.viewport,afterCritical:t.afterCritical})};function Zi(t){return t.phase==="DRAGGING"||t.phase==="COLLECTING"}function m2(t){const e=so(t.top,t.bottom),r=so(t.left,t.right);return function(s){return e(s.y)&&r(s.x)}}function Gj(t,e){return t.left<e.right&&t.right>e.left&&t.top<e.bottom&&t.bottom>e.top}function Hj({pageBorderBox:t,draggable:e,candidates:r}){const n=e.page.borderBox.center,s=r.map(i=>{const a=i.axis,l=za(i.axis.line,t.center[a.line],i.page.borderBox.center[a.crossAxisLine]);return{id:i.descriptor.id,distance:Sc(n,l)}}).sort((i,a)=>a.distance-i.distance);return s[0]?s[0].id:null}function Wj({pageBorderBox:t,draggable:e,droppables:r}){const n=Zu(r).filter(s=>{if(!s.isEnabled)return!1;const i=s.subject.active;if(!i||!Gj(t,i))return!1;if(m2(i)(t.center))return!0;const a=s.axis,l=i.center[a.crossAxisLine],c=t[a.crossAxisStart],d=t[a.crossAxisEnd],u=so(i[a.crossAxisStart],i[a.crossAxisEnd]),m=u(c),g=u(d);return!m&&!g?!0:m?c<l:d>l});return n.length?n.length===1?n[0].descriptor.id:Hj({pageBorderBox:t,draggable:e,candidates:n}):null}const p2=(t,e)=>Ga(Bc(t,e));var qj=(t,e)=>{const r=t.frame;return r?p2(e,r.scroll.diff.value):e};function f2({displaced:t,id:e}){return!!(t.visible[e]||t.invisible[e])}function Jj({draggable:t,closest:e,inHomeList:r}){return e?r&&e.descriptor.index>t.descriptor.index?e.descriptor.index-1:e.descriptor.index:null}var Yj=({pageBorderBoxWithDroppableScroll:t,draggable:e,destination:r,insideDestination:n,last:s,viewport:i,afterCritical:a})=>{const l=r.axis,c=Uc(r.axis,e.displaceBy),d=c.value,u=t[l.start],m=t[l.end],y=Qu(e,n).find(I=>{const S=I.descriptor.id,b=I.page.borderBox.center[l.line],k=Oi(S,a),A=f2({displaced:s,id:S});return k?A?m<=b:u<b-d:A?m<=b+d:u<b})||null,v=Jj({draggable:e,closest:y,inHomeList:Pl(e,r)});return ju({draggable:e,insideDestination:n,destination:r,viewport:i,last:s,displacedBy:c,index:v})};const Kj=4;var Zj=({draggable:t,pageBorderBoxWithDroppableScroll:e,previousImpact:r,destination:n,insideDestination:s,afterCritical:i})=>{if(!n.isCombineEnabled)return null;const a=n.axis,l=Uc(n.axis,t.displaceBy),c=l.value,d=e[a.start],u=e[a.end],g=Qu(t,s).find(v=>{const I=v.descriptor.id,S=v.page.borderBox,k=S[a.size]/Kj,A=Oi(I,i),C=f2({displaced:r.displaced,id:I});return A?C?u>S[a.start]+k&&u<S[a.end]-k:d>S[a.start]-c+k&&d<S[a.end]-c-k:C?u>S[a.start]+c+k&&u<S[a.end]+c-k:d>S[a.start]+k&&d<S[a.end]-k});return g?{displacedBy:l,displaced:r.displaced,at:{type:"COMBINE",combine:{draggableId:g.descriptor.id,droppableId:n.descriptor.id}}}:null},g2=({pageOffset:t,draggable:e,draggables:r,droppables:n,previousImpact:s,viewport:i,afterCritical:a})=>{const l=p2(e.page.borderBox,t),c=Wj({pageBorderBox:l,draggable:e,droppables:n});if(!c)return uj;const d=n[c],u=Al(d.descriptor.id,r),m=qj(d,l);return Zj({pageBorderBoxWithDroppableScroll:m,draggable:e,previousImpact:s,destination:d,insideDestination:u,afterCritical:a})||Yj({pageBorderBoxWithDroppableScroll:m,draggable:e,destination:d,insideDestination:u,last:s.displaced,viewport:i,afterCritical:a})},o0=(t,e)=>({...t,[e.descriptor.id]:e});const Xj=({previousImpact:t,impact:e,droppables:r})=>{const n=Fs(t),s=Fs(e);if(!n||n===s)return r;const i=r[n];if(!i.subject.withPlaceholder)return r;const a=$j(i);return o0(r,a)};var Qj=({draggable:t,draggables:e,droppables:r,previousImpact:n,impact:s})=>{const i=Xj({previousImpact:n,impact:s,droppables:r}),a=Fs(s);if(!a)return i;const l=r[a];if(Pl(t,l)||l.subject.withPlaceholder)return i;const c=h2(l,t,e);return o0(i,c)},ic=({state:t,clientSelection:e,dimensions:r,viewport:n,impact:s,scrollJumpRequest:i})=>{const a=n||t.viewport,l=r||t.dimensions,c=e||t.current.client.selection,d=Rs(c,t.initial.client.selection),u={offset:d,selection:c,borderBoxCenter:Qn(t.initial.client.borderBoxCenter,d)},m={selection:Qn(u.selection,a.scroll.current),borderBoxCenter:Qn(u.borderBoxCenter,a.scroll.current),offset:Qn(u.offset,a.scroll.diff.value)},g={client:u,page:m};if(t.phase==="COLLECTING")return{...t,dimensions:l,viewport:a,current:g};const y=l.draggables[t.critical.draggable.id],v=s||g2({pageOffset:m.offset,draggable:y,draggables:l.draggables,droppables:l.droppables,previousImpact:t.impact,viewport:a,afterCritical:t.afterCritical}),I=Qj({draggable:y,impact:v,previousImpact:t.impact,draggables:l.draggables,droppables:l.droppables});return{...t,current:g,dimensions:{draggables:l.draggables,droppables:I},impact:v,viewport:a,scrollJumpRequest:i||null,forceShouldAnimate:i?!1:null}};function e8(t,e){return t.map(r=>e[r])}var y2=({impact:t,viewport:e,draggables:r,destination:n,forceShouldAnimate:s})=>{const i=t.displaced,a=e8(i.all,r),l=Cc({afterDragging:a,destination:n,displacedBy:t.displacedBy,viewport:e.frame,forceShouldAnimate:s,last:i});return{...t,displaced:l}},x2=({impact:t,draggable:e,droppable:r,draggables:n,viewport:s,afterCritical:i})=>{const a=eh({impact:t,draggable:e,draggables:n,droppable:r,afterCritical:i});return s0({pageBorderBoxCenter:a,draggable:e,viewport:s})},v2=({state:t,dimensions:e,viewport:r})=>{t.movementMode!=="SNAP"&&St();const n=t.impact,s=r||t.viewport,i=e||t.dimensions,{draggables:a,droppables:l}=i,c=a[t.critical.draggable.id],d=Fs(n);d||St();const u=l[d],m=y2({impact:n,viewport:s,destination:u,draggables:a}),g=x2({impact:m,draggable:c,droppable:u,draggables:a,viewport:s,afterCritical:t.afterCritical});return ic({impact:m,clientSelection:g,state:t,dimensions:i,viewport:s})},t8=t=>({index:t.index,droppableId:t.droppableId}),b2=({draggable:t,home:e,draggables:r,viewport:n})=>{const s=Uc(e.axis,t.displaceBy),i=Al(e.descriptor.id,r),a=i.indexOf(t);a===-1&&St();const l=i.slice(a+1),c=l.reduce((g,y)=>(g[y.descriptor.id]=!0,g),{}),d={inVirtualList:e.descriptor.mode==="virtual",displacedBy:s,effected:c};return{impact:{displaced:Cc({afterDragging:l,destination:e,displacedBy:s,last:null,viewport:n.frame,forceShouldAnimate:!1}),displacedBy:s,at:{type:"REORDER",destination:t8(t.descriptor)}},afterCritical:d}},r8=(t,e)=>({draggables:t.draggables,droppables:o0(t.droppables,e)}),n8=({draggable:t,offset:e,initialWindowScroll:r})=>{const n=Hm(t.client,e),s=Kd(n,r);return{...t,placeholder:{...t.placeholder,client:n},client:n,page:s}},s8=t=>{const e=t.frame;return e||St(),e},o8=({additions:t,updatedDroppables:e,viewport:r})=>{const n=r.scroll.diff.value;return t.map(s=>{const i=s.descriptor.droppableId,a=e[i],c=s8(a).scroll.diff.value,d=Qn(n,c);return n8({draggable:s,offset:d,initialWindowScroll:r.scroll.initial})})},i8=({state:t,published:e})=>{const r=e.modified.map(b=>{const k=t.dimensions.droppables[b.droppableId];return Qf(k,b.scroll)}),n={...t.dimensions.droppables,...r2(r)},s=n2(o8({additions:e.additions,updatedDroppables:n,viewport:t.viewport})),i={...t.dimensions.draggables,...s};e.removals.forEach(b=>{delete i[b]});const a={droppables:n,draggables:i},l=Fs(t.impact),c=l?a.droppables[l]:null,d=a.draggables[t.critical.draggable.id],u=a.droppables[t.critical.droppable.id],{impact:m,afterCritical:g}=b2({draggable:d,home:u,draggables:i,viewport:t.viewport}),y=c&&c.isCombineEnabled?t.impact:m,v=g2({pageOffset:t.current.page.offset,draggable:a.draggables[t.critical.draggable.id],draggables:a.draggables,droppables:a.droppables,previousImpact:y,viewport:t.viewport,afterCritical:g}),I={...t,phase:"DRAGGING",impact:v,onLiftImpact:m,dimensions:a,afterCritical:g,forceShouldAnimate:!1};return t.phase==="COLLECTING"?I:{...I,phase:"DROP_PENDING",reason:t.reason,isWaiting:!1}};const Gp=t=>t.movementMode==="SNAP",am=(t,e,r)=>{const n=r8(t.dimensions,e);return!Gp(t)||r?ic({state:t,dimensions:n}):v2({state:t,dimensions:n})};function lm(t){return t.isDragging&&t.movementMode==="SNAP"?{...t,scrollJumpRequest:null}:t}const ox={phase:"IDLE",completed:null,shouldFlush:!1};var a8=(t=ox,e)=>{if(e.type==="FLUSH")return{...ox,shouldFlush:!0};if(e.type==="INITIAL_PUBLISH"){t.phase!=="IDLE"&&St();const{critical:r,clientSelection:n,viewport:s,dimensions:i,movementMode:a}=e.payload,l=i.draggables[r.draggable.id],c=i.droppables[r.droppable.id],d={selection:n,borderBoxCenter:l.client.borderBox.center,offset:qn},u={client:d,page:{selection:Qn(d.selection,s.scroll.initial),borderBoxCenter:Qn(d.selection,s.scroll.initial),offset:Qn(d.selection,s.scroll.diff.value)}},m=Zu(i.droppables).every(I=>!I.isFixedOnPage),{impact:g,afterCritical:y}=b2({draggable:l,home:c,draggables:i.draggables,viewport:s});return{phase:"DRAGGING",isDragging:!0,critical:r,movementMode:a,dimensions:i,initial:u,current:u,isWindowScrollAllowed:m,impact:g,afterCritical:y,onLiftImpact:g,viewport:s,scrollJumpRequest:null,forceShouldAnimate:null}}if(e.type==="COLLECTION_STARTING")return t.phase==="COLLECTING"||t.phase==="DROP_PENDING"?t:(t.phase!=="DRAGGING"&&St(),{...t,phase:"COLLECTING"});if(e.type==="PUBLISH_WHILE_DRAGGING")return t.phase==="COLLECTING"||t.phase==="DROP_PENDING"||St(),i8({state:t,published:e.payload});if(e.type==="MOVE"){if(t.phase==="DROP_PENDING")return t;Zi(t)||St();const{client:r}=e.payload;return Ei(r,t.current.client.selection)?t:ic({state:t,clientSelection:r,impact:Gp(t)?t.impact:null})}if(e.type==="UPDATE_DROPPABLE_SCROLL"){if(t.phase==="DROP_PENDING"||t.phase==="COLLECTING")return lm(t);Zi(t)||St();const{id:r,newScroll:n}=e.payload,s=t.dimensions.droppables[r];if(!s)return t;const i=Qf(s,n);return am(t,i,!1)}if(e.type==="UPDATE_DROPPABLE_IS_ENABLED"){if(t.phase==="DROP_PENDING")return t;Zi(t)||St();const{id:r,isEnabled:n}=e.payload,s=t.dimensions.droppables[r];s||St(),s.isEnabled===n&&St();const i={...s,isEnabled:n};return am(t,i,!0)}if(e.type==="UPDATE_DROPPABLE_IS_COMBINE_ENABLED"){if(t.phase==="DROP_PENDING")return t;Zi(t)||St();const{id:r,isCombineEnabled:n}=e.payload,s=t.dimensions.droppables[r];s||St(),s.isCombineEnabled===n&&St();const i={...s,isCombineEnabled:n};return am(t,i,!0)}if(e.type==="MOVE_BY_WINDOW_SCROLL"){if(t.phase==="DROP_PENDING"||t.phase==="DROP_ANIMATING")return t;Zi(t)||St(),t.isWindowScrollAllowed||St();const r=e.payload.newScroll;if(Ei(t.viewport.scroll.current,r))return lm(t);const n=c2(t.viewport,r);return Gp(t)?v2({state:t,viewport:n}):ic({state:t,viewport:n})}if(e.type==="UPDATE_VIEWPORT_MAX_SCROLL"){if(!Zi(t))return t;const r=e.payload.maxScroll;if(Ei(r,t.viewport.scroll.max))return t;const n={...t.viewport,scroll:{...t.viewport.scroll,max:r}};return{...t,viewport:n}}if(e.type==="MOVE_UP"||e.type==="MOVE_DOWN"||e.type==="MOVE_LEFT"||e.type==="MOVE_RIGHT"){if(t.phase==="COLLECTING"||t.phase==="DROP_PENDING")return t;t.phase!=="DRAGGING"&&St();const r=Uj({state:t,type:e.type});return r?ic({state:t,impact:r.impact,clientSelection:r.clientSelection,scrollJumpRequest:r.scrollJumpRequest}):t}if(e.type==="DROP_PENDING"){const r=e.payload.reason;return t.phase!=="COLLECTING"&&St(),{...t,phase:"DROP_PENDING",isWaiting:!0,reason:r}}if(e.type==="DROP_ANIMATE"){const{completed:r,dropDuration:n,newHomeClientOffset:s}=e.payload;return t.phase==="DRAGGING"||t.phase==="DROP_PENDING"||St(),{phase:"DROP_ANIMATING",completed:r,dropDuration:n,newHomeClientOffset:s,dimensions:t.dimensions}}if(e.type==="DROP_COMPLETE"){const{completed:r}=e.payload;return{phase:"IDLE",completed:r,shouldFlush:!1}}return t};function Kr(t,e){return t instanceof Object&&"type"in t&&t.type===e}const l8=t=>({type:"BEFORE_INITIAL_CAPTURE",payload:t}),c8=t=>({type:"LIFT",payload:t}),d8=t=>({type:"INITIAL_PUBLISH",payload:t}),u8=t=>({type:"PUBLISH_WHILE_DRAGGING",payload:t}),h8=()=>({type:"COLLECTION_STARTING",payload:null}),m8=t=>({type:"UPDATE_DROPPABLE_SCROLL",payload:t}),p8=t=>({type:"UPDATE_DROPPABLE_IS_ENABLED",payload:t}),f8=t=>({type:"UPDATE_DROPPABLE_IS_COMBINE_ENABLED",payload:t}),S2=t=>({type:"MOVE",payload:t}),g8=t=>({type:"MOVE_BY_WINDOW_SCROLL",payload:t}),y8=t=>({type:"UPDATE_VIEWPORT_MAX_SCROLL",payload:t}),x8=()=>({type:"MOVE_UP",payload:null}),v8=()=>({type:"MOVE_DOWN",payload:null}),b8=()=>({type:"MOVE_RIGHT",payload:null}),S8=()=>({type:"MOVE_LEFT",payload:null}),i0=()=>({type:"FLUSH",payload:null}),w8=t=>({type:"DROP_ANIMATE",payload:t}),a0=t=>({type:"DROP_COMPLETE",payload:t}),w2=t=>({type:"DROP",payload:t}),C8=t=>({type:"DROP_PENDING",payload:t}),C2=()=>({type:"DROP_ANIMATION_FINISHED",payload:null});var k8=t=>({getState:e,dispatch:r})=>n=>s=>{if(!Kr(s,"LIFT")){n(s);return}const{id:i,clientSelection:a,movementMode:l}=s.payload,c=e();c.phase==="DROP_ANIMATING"&&r(a0({completed:c.completed})),e().phase!=="IDLE"&&St(),r(i0()),r(l8({draggableId:i,movementMode:l}));const u={draggableId:i,scrollOptions:{shouldPublishImmediately:l==="SNAP"}},{critical:m,dimensions:g,viewport:y}=t.startPublishing(u);r(d8({critical:m,dimensions:g,clientSelection:a,movementMode:l,viewport:y}))},I8=t=>()=>e=>r=>{Kr(r,"INITIAL_PUBLISH")&&t.dragging(),Kr(r,"DROP_ANIMATE")&&t.dropping(r.payload.completed.result.reason),(Kr(r,"FLUSH")||Kr(r,"DROP_COMPLETE"))&&t.resting(),e(r)};const l0={outOfTheWay:"cubic-bezier(0.2, 0, 0, 1)",drop:"cubic-bezier(.2,1,.1,1)"},kc={opacity:{drop:0,combining:.7},scale:{drop:.75}},k2={outOfTheWay:.2,minDropTime:.33,maxDropTime:.55},Ki=`${k2.outOfTheWay}s ${l0.outOfTheWay}`,ac={fluid:`opacity ${Ki}`,snap:`transform ${Ki}, opacity ${Ki}`,drop:t=>{const e=`${t}s ${l0.drop}`;return`transform ${e}, opacity ${e}`},outOfTheWay:`transform ${Ki}`,placeholder:`height ${Ki}, width ${Ki}, margin ${Ki}`},ix=t=>Ei(t,qn)?void 0:`translate(${t.x}px, ${t.y}px)`,Hp={moveTo:ix,drop:(t,e)=>{const r=ix(t);if(r)return e?`${r} scale(${kc.scale.drop})`:r}},{minDropTime:Wp,maxDropTime:I2}=k2,j8=I2-Wp,ax=1500,T8=.6;var E8=({current:t,destination:e,reason:r})=>{const n=Sc(t,e);if(n<=0)return Wp;if(n>=ax)return I2;const s=n/ax,i=Wp+j8*s,a=r==="CANCEL"?i*T8:i;return Number(a.toFixed(2))},M8=({impact:t,draggable:e,dimensions:r,viewport:n,afterCritical:s})=>{const{draggables:i,droppables:a}=r,l=Fs(t),c=l?a[l]:null,d=a[e.descriptor.droppableId],u=x2({impact:t,draggable:e,draggables:i,afterCritical:s,droppable:c||d,viewport:n});return Rs(u,e.client.borderBox.center)},A8=({draggables:t,reason:e,lastImpact:r,home:n,viewport:s,onLiftImpact:i})=>!r.at||e!=="DROP"?{impact:y2({draggables:t,impact:i,destination:n,viewport:s,forceShouldAnimate:!0}),didDropInsideDroppable:!1}:r.at.type==="REORDER"?{impact:r,didDropInsideDroppable:!0}:{impact:{...r,displaced:wc},didDropInsideDroppable:!0};const P8=({getState:t,dispatch:e})=>r=>n=>{if(!Kr(n,"DROP")){r(n);return}const s=t(),i=n.payload.reason;if(s.phase==="COLLECTING"){e(C8({reason:i}));return}if(s.phase==="IDLE")return;s.phase==="DROP_PENDING"&&s.isWaiting&&St(),s.phase==="DRAGGING"||s.phase==="DROP_PENDING"||St();const l=s.critical,c=s.dimensions,d=c.draggables[s.critical.draggable.id],{impact:u,didDropInsideDroppable:m}=A8({reason:i,lastImpact:s.impact,afterCritical:s.afterCritical,onLiftImpact:s.onLiftImpact,home:s.dimensions.droppables[s.critical.droppable.id],viewport:s.viewport,draggables:s.dimensions.draggables}),g=m?e0(u):null,y=m?Xu(u):null,v={index:l.draggable.index,droppableId:l.droppable.id},I={draggableId:d.descriptor.id,type:d.descriptor.type,source:v,reason:i,mode:s.movementMode,destination:g,combine:y},S=M8({impact:u,draggable:d,dimensions:c,viewport:s.viewport,afterCritical:s.afterCritical}),b={critical:s.critical,afterCritical:s.afterCritical,result:I,impact:u};if(!(!Ei(s.current.client.offset,S)||!!I.combine)){e(a0({completed:b}));return}const A=E8({current:s.current.client.offset,destination:S,reason:i});e(w8({newHomeClientOffset:S,dropDuration:A,completed:b}))};var j2=()=>({x:window.pageXOffset,y:window.pageYOffset});function N8(t){return{eventName:"scroll",options:{passive:!0,capture:!1},fn:e=>{e.target!==window&&e.target!==window.document||t()}}}function D8({onWindowScroll:t}){function e(){t(j2())}const r=bc(e),n=N8(r);let s=Ti;function i(){return s!==Ti}function a(){i()&&St(),s=ro(window,[n])}function l(){i()||St(),r.cancel(),s(),s=Ti}return{start:a,stop:l,isActive:i}}const R8=t=>Kr(t,"DROP_COMPLETE")||Kr(t,"DROP_ANIMATE")||Kr(t,"FLUSH"),O8=t=>{const e=D8({onWindowScroll:r=>{t.dispatch(g8({newScroll:r}))}});return r=>n=>{!e.isActive()&&Kr(n,"INITIAL_PUBLISH")&&e.start(),e.isActive()&&R8(n)&&e.stop(),r(n)}};var _8=t=>{let e=!1,r=!1;const n=setTimeout(()=>{r=!0}),s=i=>{e||r||(e=!0,t(i),clearTimeout(n))};return s.wasCalled=()=>e,s},F8=()=>{const t=[],e=s=>{const i=t.findIndex(l=>l.timerId===s);i===-1&&St();const[a]=t.splice(i,1);a.callback()};return{add:s=>{const i=setTimeout(()=>e(i)),a={timerId:i,callback:s};t.push(a)},flush:()=>{if(!t.length)return;const s=[...t];t.length=0,s.forEach(i=>{clearTimeout(i.timerId),i.callback()})}}};const V8=(t,e)=>t==null&&e==null?!0:t==null||e==null?!1:t.droppableId===e.droppableId&&t.index===e.index,$8=(t,e)=>t==null&&e==null?!0:t==null||e==null?!1:t.draggableId===e.draggableId&&t.droppableId===e.droppableId,z8=(t,e)=>{if(t===e)return!0;const r=t.draggable.id===e.draggable.id&&t.draggable.droppableId===e.draggable.droppableId&&t.draggable.type===e.draggable.type&&t.draggable.index===e.draggable.index,n=t.droppable.id===e.droppable.id&&t.droppable.type===e.droppable.type;return r&&n},Ul=(t,e)=>{e()},pd=(t,e)=>({draggableId:t.draggable.id,type:t.droppable.type,source:{droppableId:t.droppable.id,index:t.draggable.index},mode:e});function cm(t,e,r,n){if(!t){r(n(e));return}const s=_8(r);t(e,{announce:s}),s.wasCalled()||r(n(e))}var L8=(t,e)=>{const r=F8();let n=null;const s=(m,g)=>{n&&St(),Ul("onBeforeCapture",()=>{const y=t().onBeforeCapture;y&&y({draggableId:m,mode:g})})},i=(m,g)=>{n&&St(),Ul("onBeforeDragStart",()=>{const y=t().onBeforeDragStart;y&&y(pd(m,g))})},a=(m,g)=>{n&&St();const y=pd(m,g);n={mode:g,lastCritical:m,lastLocation:y.source,lastCombine:null},r.add(()=>{Ul("onDragStart",()=>cm(t().onDragStart,y,e,Vd.onDragStart))})},l=(m,g)=>{const y=e0(g),v=Xu(g);n||St();const I=!z8(m,n.lastCritical);I&&(n.lastCritical=m);const S=!V8(n.lastLocation,y);S&&(n.lastLocation=y);const b=!$8(n.lastCombine,v);if(b&&(n.lastCombine=v),!I&&!S&&!b)return;const k={...pd(m,n.mode),combine:v,destination:y};r.add(()=>{Ul("onDragUpdate",()=>cm(t().onDragUpdate,k,e,Vd.onDragUpdate))})},c=()=>{n||St(),r.flush()},d=m=>{n||St(),n=null,Ul("onDragEnd",()=>cm(t().onDragEnd,m,e,Vd.onDragEnd))};return{beforeCapture:s,beforeStart:i,start:a,update:l,flush:c,drop:d,abort:()=>{if(!n)return;const m={...pd(n.lastCritical,n.mode),combine:null,destination:null,reason:"CANCEL"};d(m)}}},B8=(t,e)=>{const r=L8(t,e);return n=>s=>i=>{if(Kr(i,"BEFORE_INITIAL_CAPTURE")){r.beforeCapture(i.payload.draggableId,i.payload.movementMode);return}if(Kr(i,"INITIAL_PUBLISH")){const l=i.payload.critical;r.beforeStart(l,i.payload.movementMode),s(i),r.start(l,i.payload.movementMode);return}if(Kr(i,"DROP_COMPLETE")){const l=i.payload.completed.result;r.flush(),s(i),r.drop(l);return}if(s(i),Kr(i,"FLUSH")){r.abort();return}const a=n.getState();a.phase==="DRAGGING"&&r.update(a.critical,a.impact)}};const U8=t=>e=>r=>{if(!Kr(r,"DROP_ANIMATION_FINISHED")){e(r);return}const n=t.getState();n.phase!=="DROP_ANIMATING"&&St(),t.dispatch(a0({completed:n.completed}))},G8=t=>{let e=null,r=null;function n(){r&&(cancelAnimationFrame(r),r=null),e&&(e(),e=null)}return s=>i=>{if((Kr(i,"FLUSH")||Kr(i,"DROP_COMPLETE")||Kr(i,"DROP_ANIMATION_FINISHED"))&&n(),s(i),!Kr(i,"DROP_ANIMATE"))return;const a={eventName:"scroll",options:{capture:!0,passive:!1,once:!0},fn:function(){t.getState().phase==="DROP_ANIMATING"&&t.dispatch(C2())}};r=requestAnimationFrame(()=>{r=null,e=ro(window,[a])})}};var H8=t=>()=>e=>r=>{(Kr(r,"DROP_COMPLETE")||Kr(r,"FLUSH")||Kr(r,"DROP_ANIMATE"))&&t.stopPublishing(),e(r)},W8=t=>{let e=!1;return()=>r=>n=>{if(Kr(n,"INITIAL_PUBLISH")){e=!0,t.tryRecordFocus(n.payload.critical.draggable.id),r(n),t.tryRestoreFocusRecorded();return}if(r(n),!!e){if(Kr(n,"FLUSH")){e=!1,t.tryRestoreFocusRecorded();return}if(Kr(n,"DROP_COMPLETE")){e=!1;const s=n.payload.completed.result;s.combine&&t.tryShiftRecord(s.draggableId,s.combine.draggableId),t.tryRestoreFocusRecorded()}}}};const q8=t=>Kr(t,"DROP_COMPLETE")||Kr(t,"DROP_ANIMATE")||Kr(t,"FLUSH");var J8=t=>e=>r=>n=>{if(q8(n)){t.stop(),r(n);return}if(Kr(n,"INITIAL_PUBLISH")){r(n);const s=e.getState();s.phase!=="DRAGGING"&&St(),t.start(s);return}r(n),t.scroll(e.getState())};const Y8=t=>e=>r=>{if(e(r),!Kr(r,"PUBLISH_WHILE_DRAGGING"))return;const n=t.getState();n.phase==="DROP_PENDING"&&(n.isWaiting||t.dispatch(w2({reason:n.reason})))},K8=Gb;var Z8=({dimensionMarshal:t,focusMarshal:e,styleMarshal:r,getResponders:n,announce:s,autoScroller:i})=>Ub(a8,K8(JI(I8(r),H8(t),k8(t),P8,U8,G8,Y8,J8(i),O8,W8(e),B8(n,s))));const dm=()=>({additions:{},removals:{},modified:{}});function X8({registry:t,callbacks:e}){let r=dm(),n=null;const s=()=>{n||(e.collectionStarting(),n=requestAnimationFrame(()=>{n=null;const{additions:c,removals:d,modified:u}=r,m=Object.keys(c).map(v=>t.draggable.getById(v).getDimension(qn)).sort((v,I)=>v.descriptor.index-I.descriptor.index),g=Object.keys(u).map(v=>{const S=t.droppable.getById(v).callbacks.getScrollWhileDragging();return{droppableId:v,scroll:S}}),y={additions:m,removals:Object.keys(d),modified:g};r=dm(),e.publish(y)}))};return{add:c=>{const d=c.descriptor.id;r.additions[d]=c,r.modified[c.descriptor.droppableId]=!0,r.removals[d]&&delete r.removals[d],s()},remove:c=>{const d=c.descriptor;r.removals[d.id]=!0,r.modified[d.droppableId]=!0,r.additions[d.id]&&delete r.additions[d.id],s()},stop:()=>{n&&(cancelAnimationFrame(n),n=null,r=dm())}}}var T2=({scrollHeight:t,scrollWidth:e,height:r,width:n})=>{const s=Rs({x:e,y:t},{x:n,y:r});return{x:Math.max(0,s.x),y:Math.max(0,s.y)}},E2=()=>{const t=document.documentElement;return t||St(),t},M2=()=>{const t=E2();return T2({scrollHeight:t.scrollHeight,scrollWidth:t.scrollWidth,width:t.clientWidth,height:t.clientHeight})},Q8=()=>{const t=j2(),e=M2(),r=t.y,n=t.x,s=E2(),i=s.clientWidth,a=s.clientHeight,l=n+i,c=r+a;return{frame:Ga({top:r,left:n,right:l,bottom:c}),scroll:{initial:t,current:t,max:e,diff:{value:qn,displacement:qn}}}},eT=({critical:t,scrollOptions:e,registry:r})=>{const n=Q8(),s=n.scroll.current,i=t.droppable,a=r.droppable.getAllByType(i.type).map(u=>u.callbacks.getDimensionAndWatchScroll(s,e)),l=r.draggable.getAllByType(t.draggable.type).map(u=>u.getDimension(s));return{dimensions:{draggables:n2(l),droppables:r2(a)},critical:t,viewport:n}};function lx(t,e,r){return!(r.descriptor.id===e.id||r.descriptor.type!==e.type||t.droppable.getById(r.descriptor.droppableId).descriptor.mode!=="virtual")}var tT=(t,e)=>{let r=null;const n=X8({callbacks:{publish:e.publishWhileDragging,collectionStarting:e.collectionStarting},registry:t}),s=(g,y)=>{t.droppable.exists(g)||St(),r&&e.updateDroppableIsEnabled({id:g,isEnabled:y})},i=(g,y)=>{r&&(t.droppable.exists(g)||St(),e.updateDroppableIsCombineEnabled({id:g,isCombineEnabled:y}))},a=(g,y)=>{r&&(t.droppable.exists(g)||St(),e.updateDroppableScroll({id:g,newScroll:y}))},l=(g,y)=>{r&&t.droppable.getById(g).callbacks.scroll(y)},c=()=>{if(!r)return;n.stop();const g=r.critical.droppable;t.droppable.getAllByType(g.type).forEach(y=>y.callbacks.dragStopped()),r.unsubscribe(),r=null},d=g=>{r||St();const y=r.critical.draggable;g.type==="ADDITION"&&lx(t,y,g.value)&&n.add(g.value),g.type==="REMOVAL"&&lx(t,y,g.value)&&n.remove(g.value)};return{updateDroppableIsEnabled:s,updateDroppableIsCombineEnabled:i,scrollDroppable:l,updateDroppableScroll:a,startPublishing:g=>{r&&St();const y=t.draggable.getById(g.draggableId),v=t.droppable.getById(y.descriptor.droppableId),I={draggable:y.descriptor,droppable:v.descriptor},S=t.subscribe(d);return r={critical:I,unsubscribe:S},eT({critical:I,registry:t,scrollOptions:g.scrollOptions})},stopPublishing:c}},A2=(t,e)=>t.phase==="IDLE"?!0:t.phase!=="DROP_ANIMATING"||t.completed.result.draggableId===e?!1:t.completed.result.reason==="DROP",rT=t=>{window.scrollBy(t.x,t.y)};const nT=Wn(t=>Zu(t).filter(e=>!(!e.isEnabled||!e.frame))),sT=(t,e)=>nT(e).find(n=>(n.frame||St(),m2(n.frame.pageMarginBox)(t)))||null;var oT=({center:t,destination:e,droppables:r})=>{if(e){const s=r[e];return s.frame?s:null}return sT(t,r)};const Ic={startFromPercentage:.25,maxScrollAtPercentage:.05,maxPixelScroll:28,ease:t=>t**2,durationDampening:{stopDampeningAt:1200,accelerateAt:360},disabled:!1};var iT=(t,e,r=()=>Ic)=>{const n=r(),s=t[e.size]*n.startFromPercentage,i=t[e.size]*n.maxScrollAtPercentage;return{startScrollingFrom:s,maxScrollValueAt:i}},P2=({startOfRange:t,endOfRange:e,current:r})=>{const n=e-t;return n===0?0:(r-t)/n},c0=1,aT=(t,e,r=()=>Ic)=>{const n=r();if(t>e.startScrollingFrom)return 0;if(t<=e.maxScrollValueAt)return n.maxPixelScroll;if(t===e.startScrollingFrom)return c0;const i=1-P2({startOfRange:e.maxScrollValueAt,endOfRange:e.startScrollingFrom,current:t}),a=n.maxPixelScroll*n.ease(i);return Math.ceil(a)},lT=(t,e,r)=>{const n=r(),s=n.durationDampening.accelerateAt,i=n.durationDampening.stopDampeningAt,a=e,l=i,d=Date.now()-a;if(d>=i)return t;if(d<s)return c0;const u=P2({startOfRange:s,endOfRange:l,current:d}),m=t*n.ease(u);return Math.ceil(m)},cx=({distanceToEdge:t,thresholds:e,dragStartTime:r,shouldUseTimeDampening:n,getAutoScrollerOptions:s})=>{const i=aT(t,e,s);return i===0?0:n?Math.max(lT(i,r,s),c0):i},dx=({container:t,distanceToEdges:e,dragStartTime:r,axis:n,shouldUseTimeDampening:s,getAutoScrollerOptions:i})=>{const a=iT(t,n,i);return e[n.end]<e[n.start]?cx({distanceToEdge:e[n.end],thresholds:a,dragStartTime:r,shouldUseTimeDampening:s,getAutoScrollerOptions:i}):-1*cx({distanceToEdge:e[n.start],thresholds:a,dragStartTime:r,shouldUseTimeDampening:s,getAutoScrollerOptions:i})},cT=({container:t,subject:e,proposedScroll:r})=>{const n=e.height>t.height,s=e.width>t.width;return!s&&!n?r:s&&n?null:{x:s?0:r.x,y:n?0:r.y}};const dT=t2(t=>t===0?0:t);var N2=({dragStartTime:t,container:e,subject:r,center:n,shouldUseTimeDampening:s,getAutoScrollerOptions:i})=>{const a={top:n.y-e.top,right:e.right-n.x,bottom:e.bottom-n.y,left:n.x-e.left},l=dx({container:e,distanceToEdges:a,dragStartTime:t,axis:t0,shouldUseTimeDampening:s,getAutoScrollerOptions:i}),c=dx({container:e,distanceToEdges:a,dragStartTime:t,axis:i2,shouldUseTimeDampening:s,getAutoScrollerOptions:i}),d=dT({x:c,y:l});if(Ei(d,qn))return null;const u=cT({container:e,subject:r,proposedScroll:d});return u?Ei(u,qn)?null:u:null};const uT=t2(t=>t===0?0:t>0?1:-1),d0=(()=>{const t=(e,r)=>e<0?e:e>r?e-r:0;return({current:e,max:r,change:n})=>{const s=Qn(e,n),i={x:t(s.x,r.x),y:t(s.y,r.y)};return Ei(i,qn)?null:i}})(),D2=({max:t,current:e,change:r})=>{const n={x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)},s=uT(r),i=d0({max:n,current:e,change:s});return!i||s.x!==0&&i.x===0||s.y!==0&&i.y===0},u0=(t,e)=>D2({current:t.scroll.current,max:t.scroll.max,change:e}),hT=(t,e)=>{if(!u0(t,e))return null;const r=t.scroll.max,n=t.scroll.current;return d0({current:n,max:r,change:e})},h0=(t,e)=>{const r=t.frame;return r?D2({current:r.scroll.current,max:r.scroll.max,change:e}):!1},mT=(t,e)=>{const r=t.frame;return!r||!h0(t,e)?null:d0({current:r.scroll.current,max:r.scroll.max,change:e})};var pT=({viewport:t,subject:e,center:r,dragStartTime:n,shouldUseTimeDampening:s,getAutoScrollerOptions:i})=>{const a=N2({dragStartTime:n,container:t.frame,subject:e,center:r,shouldUseTimeDampening:s,getAutoScrollerOptions:i});return a&&u0(t,a)?a:null},fT=({droppable:t,subject:e,center:r,dragStartTime:n,shouldUseTimeDampening:s,getAutoScrollerOptions:i})=>{const a=t.frame;if(!a)return null;const l=N2({dragStartTime:n,container:a.pageMarginBox,subject:e,center:r,shouldUseTimeDampening:s,getAutoScrollerOptions:i});return l&&h0(t,l)?l:null},ux=({state:t,dragStartTime:e,shouldUseTimeDampening:r,scrollWindow:n,scrollDroppable:s,getAutoScrollerOptions:i})=>{const a=t.current.page.borderBoxCenter,c=t.dimensions.draggables[t.critical.draggable.id].page.marginBox;if(t.isWindowScrollAllowed){const m=t.viewport,g=pT({dragStartTime:e,viewport:m,subject:c,center:a,shouldUseTimeDampening:r,getAutoScrollerOptions:i});if(g){n(g);return}}const d=oT({center:a,destination:Fs(t.impact),droppables:t.dimensions.droppables});if(!d)return;const u=fT({dragStartTime:e,droppable:d,subject:c,center:a,shouldUseTimeDampening:r,getAutoScrollerOptions:i});u&&s(d.descriptor.id,u)},gT=({scrollWindow:t,scrollDroppable:e,getAutoScrollerOptions:r=()=>Ic})=>{const n=bc(t),s=bc(e);let i=null;const a=d=>{i||St();const{shouldUseTimeDampening:u,dragStartTime:m}=i;ux({state:d,scrollWindow:n,scrollDroppable:s,dragStartTime:m,shouldUseTimeDampening:u,getAutoScrollerOptions:r})};return{start:d=>{i&&St();const u=Date.now();let m=!1;const g=()=>{m=!0};ux({state:d,dragStartTime:0,shouldUseTimeDampening:!1,scrollWindow:g,scrollDroppable:g,getAutoScrollerOptions:r}),i={dragStartTime:u,shouldUseTimeDampening:m},m&&a(d)},stop:()=>{i&&(n.cancel(),s.cancel(),i=null)},scroll:a}},yT=({move:t,scrollDroppable:e,scrollWindow:r})=>{const n=(l,c)=>{const d=Qn(l.current.client.selection,c);t({client:d})},s=(l,c)=>{if(!h0(l,c))return c;const d=mT(l,c);if(!d)return e(l.descriptor.id,c),null;const u=Rs(c,d);return e(l.descriptor.id,u),Rs(c,u)},i=(l,c,d)=>{if(!l||!u0(c,d))return d;const u=hT(c,d);if(!u)return r(d),null;const m=Rs(d,u);return r(m),Rs(d,m)};return l=>{const c=l.scrollJumpRequest;if(!c)return;const d=Fs(l.impact);d||St();const u=s(l.dimensions.droppables[d],c);if(!u)return;const m=l.viewport,g=i(l.isWindowScrollAllowed,m,u);g&&n(l,g)}},xT=({scrollDroppable:t,scrollWindow:e,move:r,getAutoScrollerOptions:n})=>{const s=gT({scrollWindow:e,scrollDroppable:t,getAutoScrollerOptions:n}),i=yT({move:r,scrollWindow:e,scrollDroppable:t});return{scroll:c=>{if(!(n().disabled||c.phase!=="DRAGGING")){if(c.movementMode==="FLUID"){s.scroll(c);return}c.scrollJumpRequest&&i(c)}},start:s.start,stop:s.stop}};const vl="data-rfd",bl=(()=>{const t=`${vl}-drag-handle`;return{base:t,draggableId:`${t}-draggable-id`,contextId:`${t}-context-id`}})(),qp=(()=>{const t=`${vl}-draggable`;return{base:t,contextId:`${t}-context-id`,id:`${t}-id`}})(),vT=(()=>{const t=`${vl}-droppable`;return{base:t,contextId:`${t}-context-id`,id:`${t}-id`}})(),hx={contextId:`${vl}-scroll-container-context-id`},bT=t=>e=>`[${e}="${t}"]`,Gl=(t,e)=>t.map(r=>{const n=r.styles[e];return n?`${r.selector} { ${n} }`:""}).join(" "),ST="pointer-events: none;";var wT=t=>{const e=bT(t),r=(()=>{const l=`
      cursor: -webkit-grab;
      cursor: grab;
    `;return{selector:e(bl.contextId),styles:{always:`
          -webkit-touch-callout: none;
          -webkit-tap-highlight-color: rgba(0,0,0,0);
          touch-action: manipulation;
        `,resting:l,dragging:ST,dropAnimating:l}}})(),n=(()=>{const l=`
      transition: ${ac.outOfTheWay};
    `;return{selector:e(qp.contextId),styles:{dragging:l,dropAnimating:l,userCancel:l}}})(),s={selector:e(vT.contextId),styles:{always:"overflow-anchor: none;"}},a=[n,r,s,{selector:"body",styles:{dragging:`
        cursor: grabbing;
        cursor: -webkit-grabbing;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        overflow-anchor: none;
      `}}];return{always:Gl(a,"always"),resting:Gl(a,"resting"),dragging:Gl(a,"dragging"),dropAnimating:Gl(a,"dropAnimating"),userCancel:Gl(a,"userCancel")}};const Vs=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?M.useLayoutEffect:M.useEffect,um=()=>{const t=document.querySelector("head");return t||St(),t},mx=t=>{const e=document.createElement("style");return t&&e.setAttribute("nonce",t),e.type="text/css",e};function CT(t,e){const r=Vr(()=>wT(t),[t]),n=M.useRef(null),s=M.useRef(null),i=Jt(Wn(m=>{const g=s.current;g||St(),g.textContent=m}),[]),a=Jt(m=>{const g=n.current;g||St(),g.textContent=m},[]);Vs(()=>{!n.current&&!s.current||St();const m=mx(e),g=mx(e);return n.current=m,s.current=g,m.setAttribute(`${vl}-always`,t),g.setAttribute(`${vl}-dynamic`,t),um().appendChild(m),um().appendChild(g),a(r.always),i(r.resting),()=>{const y=v=>{const I=v.current;I||St(),um().removeChild(I),v.current=null};y(n),y(s)}},[e,a,i,r.always,r.resting,t]);const l=Jt(()=>i(r.dragging),[i,r.dragging]),c=Jt(m=>{if(m==="DROP"){i(r.dropAnimating);return}i(r.userCancel)},[i,r.dropAnimating,r.userCancel]),d=Jt(()=>{s.current&&i(r.resting)},[i,r.resting]);return Vr(()=>({dragging:l,dropping:c,resting:d}),[l,c,d])}function R2(t,e){return Array.from(t.querySelectorAll(e))}var O2=t=>t&&t.ownerDocument&&t.ownerDocument.defaultView?t.ownerDocument.defaultView:window;function th(t){return t instanceof O2(t).HTMLElement}function kT(t,e){const r=`[${bl.contextId}="${t}"]`,n=R2(document,r);if(!n.length)return null;const s=n.find(i=>i.getAttribute(bl.draggableId)===e);return!s||!th(s)?null:s}function IT(t){const e=M.useRef({}),r=M.useRef(null),n=M.useRef(null),s=M.useRef(!1),i=Jt(function(g,y){const v={id:g,focus:y};return e.current[g]=v,function(){const S=e.current;S[g]!==v&&delete S[g]}},[]),a=Jt(function(g){const y=kT(t,g);y&&y!==document.activeElement&&y.focus()},[t]),l=Jt(function(g,y){r.current===g&&(r.current=y)},[]),c=Jt(function(){n.current||s.current&&(n.current=requestAnimationFrame(()=>{n.current=null;const g=r.current;g&&a(g)}))},[a]),d=Jt(function(g){r.current=null;const y=document.activeElement;y&&y.getAttribute(bl.draggableId)===g&&(r.current=g)},[]);return Vs(()=>(s.current=!0,function(){s.current=!1;const g=n.current;g&&cancelAnimationFrame(g)}),[]),Vr(()=>({register:i,tryRecordFocus:d,tryRestoreFocusRecorded:c,tryShiftRecord:l}),[i,d,c,l])}function jT(){const t={draggables:{},droppables:{}},e=[];function r(m){return e.push(m),function(){const y=e.indexOf(m);y!==-1&&e.splice(y,1)}}function n(m){e.length&&e.forEach(g=>g(m))}function s(m){return t.draggables[m]||null}function i(m){const g=s(m);return g||St(),g}const a={register:m=>{t.draggables[m.descriptor.id]=m,n({type:"ADDITION",value:m})},update:(m,g)=>{const y=t.draggables[g.descriptor.id];y&&y.uniqueId===m.uniqueId&&(delete t.draggables[g.descriptor.id],t.draggables[m.descriptor.id]=m)},unregister:m=>{const g=m.descriptor.id,y=s(g);y&&m.uniqueId===y.uniqueId&&(delete t.draggables[g],t.droppables[m.descriptor.droppableId]&&n({type:"REMOVAL",value:m}))},getById:i,findById:s,exists:m=>!!s(m),getAllByType:m=>Object.values(t.draggables).filter(g=>g.descriptor.type===m)};function l(m){return t.droppables[m]||null}function c(m){const g=l(m);return g||St(),g}const d={register:m=>{t.droppables[m.descriptor.id]=m},unregister:m=>{const g=l(m.descriptor.id);g&&m.uniqueId===g.uniqueId&&delete t.droppables[m.descriptor.id]},getById:c,findById:l,exists:m=>!!l(m),getAllByType:m=>Object.values(t.droppables).filter(g=>g.descriptor.type===m)};function u(){t.draggables={},t.droppables={},e.length=0}return{draggable:a,droppable:d,subscribe:r,clean:u}}function TT(){const t=Vr(jT,[]);return M.useEffect(()=>function(){t.clean()},[t]),t}var m0=nr.createContext(null),Tu=()=>{const t=document.body;return t||St(),t};const ET={position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0",padding:"0",overflow:"hidden",clip:"rect(0 0 0 0)","clip-path":"inset(100%)"},MT=t=>`rfd-announcement-${t}`;function AT(t){const e=Vr(()=>MT(t),[t]),r=M.useRef(null);return M.useEffect(function(){const i=document.createElement("div");return r.current=i,i.id=e,i.setAttribute("aria-live","assertive"),i.setAttribute("aria-atomic","true"),Mf(i.style,ET),Tu().appendChild(i),function(){setTimeout(function(){const c=Tu();c.contains(i)&&c.removeChild(i),i===r.current&&(r.current=null)})}},[e]),Jt(s=>{const i=r.current;if(i){i.textContent=s;return}},[])}const PT={separator:"::"};function p0(t,e=PT){const r=nr.useId();return Vr(()=>`${t}${e.separator}${r}`,[e.separator,t,r])}function NT({contextId:t,uniqueId:e}){return`rfd-hidden-text-${t}-${e}`}function DT({contextId:t,text:e}){const r=p0("hidden-text",{separator:"-"}),n=Vr(()=>NT({contextId:t,uniqueId:r}),[r,t]);return M.useEffect(function(){const i=document.createElement("div");return i.id=n,i.textContent=e,i.style.display="none",Tu().appendChild(i),function(){const l=Tu();l.contains(i)&&l.removeChild(i)}},[n,e]),n}var rh=nr.createContext(null);function _2(t){const e=M.useRef(t);return M.useEffect(()=>{e.current=t}),e}function RT(){let t=null;function e(){return!!t}function r(a){return a===t}function n(a){t&&St();const l={abandon:a};return t=l,l}function s(){t||St(),t=null}function i(){t&&(t.abandon(),s())}return{isClaimed:e,isActive:r,claim:n,release:s,tryAbandon:i}}function jc(t){return t.phase==="IDLE"||t.phase==="DROP_ANIMATING"?!1:t.isDragging}const OT=9,_T=13,f0=27,F2=32,FT=33,VT=34,$T=35,zT=36,LT=37,BT=38,UT=39,GT=40,HT={[_T]:!0,[OT]:!0};var V2=t=>{HT[t.keyCode]&&t.preventDefault()};const nh=(()=>{const t="visibilitychange";return typeof document>"u"?t:[t,`ms${t}`,`webkit${t}`,`moz${t}`,`o${t}`].find(n=>`on${n}`in document)||t})(),$2=0,px=5;function WT(t,e){return Math.abs(e.x-t.x)>=px||Math.abs(e.y-t.y)>=px}const fx={type:"IDLE"};function qT({cancel:t,completed:e,getPhase:r,setPhase:n}){return[{eventName:"mousemove",fn:s=>{const{button:i,clientX:a,clientY:l}=s;if(i!==$2)return;const c={x:a,y:l},d=r();if(d.type==="DRAGGING"){s.preventDefault(),d.actions.move(c);return}d.type!=="PENDING"&&St();const u=d.point;if(!WT(u,c))return;s.preventDefault();const m=d.actions.fluidLift(c);n({type:"DRAGGING",actions:m})}},{eventName:"mouseup",fn:s=>{const i=r();if(i.type!=="DRAGGING"){t();return}s.preventDefault(),i.actions.drop({shouldBlockNextClick:!0}),e()}},{eventName:"mousedown",fn:s=>{r().type==="DRAGGING"&&s.preventDefault(),t()}},{eventName:"keydown",fn:s=>{if(r().type==="PENDING"){t();return}if(s.keyCode===f0){s.preventDefault(),t();return}V2(s)}},{eventName:"resize",fn:t},{eventName:"scroll",options:{passive:!0,capture:!1},fn:()=>{r().type==="PENDING"&&t()}},{eventName:"webkitmouseforcedown",fn:s=>{const i=r();if(i.type==="IDLE"&&St(),i.actions.shouldRespectForcePress()){t();return}s.preventDefault()}},{eventName:nh,fn:t}]}function JT(t){const e=M.useRef(fx),r=M.useRef(Ti),n=Vr(()=>({eventName:"mousedown",fn:function(m){if(m.defaultPrevented||m.button!==$2||m.ctrlKey||m.metaKey||m.shiftKey||m.altKey)return;const g=t.findClosestDraggableId(m);if(!g)return;const y=t.tryGetLock(g,a,{sourceEvent:m});if(!y)return;m.preventDefault();const v={x:m.clientX,y:m.clientY};r.current(),d(y,v)}}),[t]),s=Vr(()=>({eventName:"webkitmouseforcewillbegin",fn:u=>{if(u.defaultPrevented)return;const m=t.findClosestDraggableId(u);if(!m)return;const g=t.findOptionsForDraggable(m);g&&(g.shouldRespectForcePress||t.canGetLock(m)&&u.preventDefault())}}),[t]),i=Jt(function(){const m={passive:!1,capture:!0};r.current=ro(window,[s,n],m)},[s,n]),a=Jt(()=>{e.current.type!=="IDLE"&&(e.current=fx,r.current(),i())},[i]),l=Jt(()=>{const u=e.current;a(),u.type==="DRAGGING"&&u.actions.cancel({shouldBlockNextClick:!0}),u.type==="PENDING"&&u.actions.abort()},[a]),c=Jt(function(){const m={capture:!0,passive:!1},g=qT({cancel:l,completed:a,getPhase:()=>e.current,setPhase:y=>{e.current=y}});r.current=ro(window,g,m)},[l,a]),d=Jt(function(m,g){e.current.type!=="IDLE"&&St(),e.current={type:"PENDING",point:g,actions:m},c()},[c]);Vs(function(){return i(),function(){r.current()}},[i])}function YT(){}const KT={[VT]:!0,[FT]:!0,[zT]:!0,[$T]:!0};function ZT(t,e){function r(){e(),t.cancel()}function n(){e(),t.drop()}return[{eventName:"keydown",fn:s=>{if(s.keyCode===f0){s.preventDefault(),r();return}if(s.keyCode===F2){s.preventDefault(),n();return}if(s.keyCode===GT){s.preventDefault(),t.moveDown();return}if(s.keyCode===BT){s.preventDefault(),t.moveUp();return}if(s.keyCode===UT){s.preventDefault(),t.moveRight();return}if(s.keyCode===LT){s.preventDefault(),t.moveLeft();return}if(KT[s.keyCode]){s.preventDefault();return}V2(s)}},{eventName:"mousedown",fn:r},{eventName:"mouseup",fn:r},{eventName:"click",fn:r},{eventName:"touchstart",fn:r},{eventName:"resize",fn:r},{eventName:"wheel",fn:r,options:{passive:!0}},{eventName:nh,fn:r}]}function XT(t){const e=M.useRef(YT),r=Vr(()=>({eventName:"keydown",fn:function(i){if(i.defaultPrevented||i.keyCode!==F2)return;const a=t.findClosestDraggableId(i);if(!a)return;const l=t.tryGetLock(a,u,{sourceEvent:i});if(!l)return;i.preventDefault();let c=!0;const d=l.snapLift();e.current();function u(){c||St(),c=!1,e.current(),n()}e.current=ro(window,ZT(d,u),{capture:!0,passive:!1})}}),[t]),n=Jt(function(){const i={passive:!1,capture:!0};e.current=ro(window,[r],i)},[r]);Vs(function(){return n(),function(){e.current()}},[n])}const hm={type:"IDLE"},QT=120,e9=.15;function t9({cancel:t,getPhase:e}){return[{eventName:"orientationchange",fn:t},{eventName:"resize",fn:t},{eventName:"contextmenu",fn:r=>{r.preventDefault()}},{eventName:"keydown",fn:r=>{if(e().type!=="DRAGGING"){t();return}r.keyCode===f0&&r.preventDefault(),t()}},{eventName:nh,fn:t}]}function r9({cancel:t,completed:e,getPhase:r}){return[{eventName:"touchmove",options:{capture:!1},fn:n=>{const s=r();if(s.type!=="DRAGGING"){t();return}s.hasMoved=!0;const{clientX:i,clientY:a}=n.touches[0],l={x:i,y:a};n.preventDefault(),s.actions.move(l)}},{eventName:"touchend",fn:n=>{const s=r();if(s.type!=="DRAGGING"){t();return}n.preventDefault(),s.actions.drop({shouldBlockNextClick:!0}),e()}},{eventName:"touchcancel",fn:n=>{if(r().type!=="DRAGGING"){t();return}n.preventDefault(),t()}},{eventName:"touchforcechange",fn:n=>{const s=r();s.type==="IDLE"&&St();const i=n.touches[0];if(!i||!(i.force>=e9))return;const l=s.actions.shouldRespectForcePress();if(s.type==="PENDING"){l&&t();return}if(l){if(s.hasMoved){n.preventDefault();return}t();return}n.preventDefault()}},{eventName:nh,fn:t}]}function n9(t){const e=M.useRef(hm),r=M.useRef(Ti),n=Jt(function(){return e.current},[]),s=Jt(function(y){e.current=y},[]),i=Vr(()=>({eventName:"touchstart",fn:function(y){if(y.defaultPrevented)return;const v=t.findClosestDraggableId(y);if(!v)return;const I=t.tryGetLock(v,l,{sourceEvent:y});if(!I)return;const S=y.touches[0],{clientX:b,clientY:k}=S,A={x:b,y:k};r.current(),m(I,A)}}),[t]),a=Jt(function(){const y={capture:!0,passive:!1};r.current=ro(window,[i],y)},[i]),l=Jt(()=>{const g=e.current;g.type!=="IDLE"&&(g.type==="PENDING"&&clearTimeout(g.longPressTimerId),s(hm),r.current(),a())},[a,s]),c=Jt(()=>{const g=e.current;l(),g.type==="DRAGGING"&&g.actions.cancel({shouldBlockNextClick:!0}),g.type==="PENDING"&&g.actions.abort()},[l]),d=Jt(function(){const y={capture:!0,passive:!1},v={cancel:c,completed:l,getPhase:n},I=ro(window,r9(v),y),S=ro(window,t9(v),y);r.current=function(){I(),S()}},[c,n,l]),u=Jt(function(){const y=n();y.type!=="PENDING"&&St();const v=y.actions.fluidLift(y.point);s({type:"DRAGGING",actions:v,hasMoved:!1})},[n,s]),m=Jt(function(y,v){n().type!=="IDLE"&&St();const I=setTimeout(u,QT);s({type:"PENDING",point:v,actions:y,longPressTimerId:I}),d()},[d,n,s,u]);Vs(function(){return a(),function(){r.current();const v=n();v.type==="PENDING"&&(clearTimeout(v.longPressTimerId),s(hm))}},[n,a,s]),Vs(function(){return ro(window,[{eventName:"touchmove",fn:()=>{},options:{capture:!1,passive:!1}}])},[])}const s9=["input","button","textarea","select","option","optgroup","video","audio"];function z2(t,e){if(e==null)return!1;if(s9.includes(e.tagName.toLowerCase()))return!0;const n=e.getAttribute("contenteditable");return n==="true"||n===""?!0:e===t?!1:z2(t,e.parentElement)}function o9(t,e){const r=e.target;return th(r)?z2(t,r):!1}var i9=t=>Ga(t.getBoundingClientRect()).center;function a9(t){return t instanceof O2(t).Element}const l9=(()=>{const t="matches";return typeof document>"u"?t:[t,"msMatchesSelector","webkitMatchesSelector"].find(n=>n in Element.prototype)||t})();function L2(t,e){return t==null?null:t[l9](e)?t:L2(t.parentElement,e)}function c9(t,e){return t.closest?t.closest(e):L2(t,e)}function d9(t){return`[${bl.contextId}="${t}"]`}function u9(t,e){const r=e.target;if(!a9(r))return null;const n=d9(t),s=c9(r,n);return!s||!th(s)?null:s}function h9(t,e){const r=u9(t,e);return r?r.getAttribute(bl.draggableId):null}function m9(t,e){const r=`[${qp.contextId}="${t}"]`,s=R2(document,r).find(i=>i.getAttribute(qp.id)===e);return!s||!th(s)?null:s}function p9(t){t.preventDefault()}function fd({expected:t,phase:e,isLockActive:r,shouldWarn:n}){return!(!r()||t!==e)}function B2({lockAPI:t,store:e,registry:r,draggableId:n}){if(t.isClaimed())return!1;const s=r.draggable.findById(n);return!(!s||!s.options.isEnabled||!A2(e.getState(),n))}function f9({lockAPI:t,contextId:e,store:r,registry:n,draggableId:s,forceSensorStop:i,sourceEvent:a}){if(!B2({lockAPI:t,store:r,registry:n,draggableId:s}))return null;const c=n.draggable.getById(s),d=m9(e,c.descriptor.id);if(!d||a&&!c.options.canDragInteractiveElements&&o9(d,a))return null;const u=t.claim(i||Ti);let m="PRE_DRAG";function g(){return c.options.shouldRespectForcePress}function y(){return t.isActive(u)}function v(T,P){fd({expected:T,phase:m,isLockActive:y,shouldWarn:!0})&&r.dispatch(P())}const I=v.bind(null,"DRAGGING");function S(T){function P(){t.release(),m="COMPLETED"}m!=="PRE_DRAG"&&(P(),St()),r.dispatch(c8(T.liftActionArgs)),m="DRAGGING";function _(R,G={shouldBlockNextClick:!1}){if(T.cleanup(),G.shouldBlockNextClick){const ne=ro(window,[{eventName:"click",fn:p9,options:{once:!0,passive:!1,capture:!0}}]);setTimeout(ne)}P(),r.dispatch(w2({reason:R}))}return{isActive:()=>fd({expected:"DRAGGING",phase:m,isLockActive:y,shouldWarn:!1}),shouldRespectForcePress:g,drop:R=>_("DROP",R),cancel:R=>_("CANCEL",R),...T.actions}}function b(T){const P=bc(R=>{I(()=>S2({client:R}))});return{...S({liftActionArgs:{id:s,clientSelection:T,movementMode:"FLUID"},cleanup:()=>P.cancel(),actions:{move:P}}),move:P}}function k(){const T={moveUp:()=>I(x8),moveRight:()=>I(b8),moveDown:()=>I(v8),moveLeft:()=>I(S8)};return S({liftActionArgs:{id:s,clientSelection:i9(d),movementMode:"SNAP"},cleanup:Ti,actions:T})}function A(){fd({expected:"PRE_DRAG",phase:m,isLockActive:y,shouldWarn:!0})&&t.release()}return{isActive:()=>fd({expected:"PRE_DRAG",phase:m,isLockActive:y,shouldWarn:!1}),shouldRespectForcePress:g,fluidLift:b,snapLift:k,abort:A}}const g9=[JT,XT,n9];function y9({contextId:t,store:e,registry:r,customSensors:n,enableDefaultSensors:s}){const i=[...s?g9:[],...n||[]],a=M.useState(()=>RT())[0],l=Jt(function(S,b){jc(S)&&!jc(b)&&a.tryAbandon()},[a]);Vs(function(){let S=e.getState();return e.subscribe(()=>{const k=e.getState();l(S,k),S=k})},[a,e,l]),Vs(()=>a.tryAbandon,[a.tryAbandon]);const c=Jt(I=>B2({lockAPI:a,registry:r,store:e,draggableId:I}),[a,r,e]),d=Jt((I,S,b)=>f9({lockAPI:a,registry:r,contextId:t,store:e,draggableId:I,forceSensorStop:S||null,sourceEvent:b&&b.sourceEvent?b.sourceEvent:null}),[t,a,r,e]),u=Jt(I=>h9(t,I),[t]),m=Jt(I=>{const S=r.draggable.findById(I);return S?S.options:null},[r.draggable]),g=Jt(function(){a.isClaimed()&&(a.tryAbandon(),e.getState().phase!=="IDLE"&&e.dispatch(i0()))},[a,e]),y=Jt(()=>a.isClaimed(),[a]),v=Vr(()=>({canGetLock:c,tryGetLock:d,findClosestDraggableId:u,findOptionsForDraggable:m,tryReleaseLock:g,isLockClaimed:y}),[c,d,u,m,g,y]);for(let I=0;I<i.length;I++)i[I](v)}const x9=t=>({onBeforeCapture:e=>{const r=()=>{t.onBeforeCapture&&t.onBeforeCapture(e)};Pf.flushSync(r)},onBeforeDragStart:t.onBeforeDragStart,onDragStart:t.onDragStart,onDragEnd:t.onDragEnd,onDragUpdate:t.onDragUpdate}),v9=t=>({...Ic,...t.autoScrollerOptions,durationDampening:{...Ic.durationDampening,...t.autoScrollerOptions}});function Hl(t){return t.current||St(),t.current}function b9(t){const{contextId:e,setCallbacks:r,sensors:n,nonce:s,dragHandleUsageInstructions:i}=t,a=M.useRef(null),l=_2(t),c=Jt(()=>x9(l.current),[l]),d=Jt(()=>v9(l.current),[l]),u=AT(e),m=DT({contextId:e,text:i}),g=CT(e,s),y=Jt(ne=>{Hl(a).dispatch(ne)},[]),v=Vr(()=>Gy({publishWhileDragging:u8,updateDroppableScroll:m8,updateDroppableIsEnabled:p8,updateDroppableIsCombineEnabled:f8,collectionStarting:h8},y),[y]),I=TT(),S=Vr(()=>tT(I,v),[I,v]),b=Vr(()=>xT({scrollWindow:rT,scrollDroppable:S.scrollDroppable,getAutoScrollerOptions:d,...Gy({move:S2},y)}),[S.scrollDroppable,y,d]),k=IT(e),A=Vr(()=>Z8({announce:u,autoScroller:b,dimensionMarshal:S,focusMarshal:k,getResponders:c,styleMarshal:g}),[u,b,S,k,c,g]);a.current=A;const C=Jt(()=>{const ne=Hl(a);ne.getState().phase!=="IDLE"&&ne.dispatch(i0())},[]),T=Jt(()=>{const ne=Hl(a).getState();return ne.phase==="DROP_ANIMATING"?!0:ne.phase==="IDLE"?!1:ne.isDragging},[]),P=Vr(()=>({isDragging:T,tryAbort:C}),[T,C]);r(P);const _=Jt(ne=>A2(Hl(a).getState(),ne),[]),R=Jt(()=>Zi(Hl(a).getState()),[]),G=Vr(()=>({marshal:S,focus:k,contextId:e,canLift:_,isMovementAllowed:R,dragHandleUsageInstructionsId:m,registry:I}),[e,S,m,k,_,R,I]);return y9({contextId:e,store:A,registry:I,customSensors:n||null,enableDefaultSensors:t.enableDefaultSensors!==!1}),M.useEffect(()=>C,[C]),nr.createElement(rh.Provider,{value:G},nr.createElement(Y7,{context:m0,store:A},t.children))}function S9(){return nr.useId()}function sh(t){const e=S9(),r=t.dragHandleUsageInstructions||Vd.dragHandleUsageInstructions;return nr.createElement(X7,null,n=>nr.createElement(b9,{nonce:t.nonce,contextId:e,setCallbacks:n,dragHandleUsageInstructions:r,enableDefaultSensors:t.enableDefaultSensors,sensors:t.sensors,onBeforeCapture:t.onBeforeCapture,onBeforeDragStart:t.onBeforeDragStart,onDragStart:t.onDragStart,onDragUpdate:t.onDragUpdate,onDragEnd:t.onDragEnd,autoScrollerOptions:t.autoScrollerOptions},t.children))}const gx={dragging:5e3,dropAnimating:4500},w9=(t,e)=>e?ac.drop(e.duration):t?ac.snap:ac.fluid,C9=(t,e)=>{if(t)return e?kc.opacity.drop:kc.opacity.combining},k9=t=>t.forceShouldAnimate!=null?t.forceShouldAnimate:t.mode==="SNAP";function I9(t){const r=t.dimension.client,{offset:n,combineWith:s,dropping:i}=t,a=!!s,l=k9(t),c=!!i,d=c?Hp.drop(n,a):Hp.moveTo(n);return{position:"fixed",top:r.marginBox.top,left:r.marginBox.left,boxSizing:"border-box",width:r.borderBox.width,height:r.borderBox.height,transition:w9(l,i),transform:d,opacity:C9(a,c),zIndex:c?gx.dropAnimating:gx.dragging,pointerEvents:"none"}}function j9(t){return{transform:Hp.moveTo(t.offset),transition:t.shouldAnimateDisplacement?void 0:"none"}}function T9(t){return t.type==="DRAGGING"?I9(t):j9(t)}function E9(t,e,r=qn){const n=window.getComputedStyle(e),s=e.getBoundingClientRect(),i=Aw(s,n),a=Kd(i,r),l={client:i,tagName:e.tagName.toLowerCase(),display:n.display},c={x:i.marginBox.width,y:i.marginBox.height};return{descriptor:t,placeholder:l,displaceBy:c,client:i,page:a}}function M9(t){const e=p0("draggable"),{descriptor:r,registry:n,getDraggableRef:s,canDragInteractiveElements:i,shouldRespectForcePress:a,isEnabled:l}=t,c=Vr(()=>({canDragInteractiveElements:i,shouldRespectForcePress:a,isEnabled:l}),[i,l,a]),d=Jt(y=>{const v=s();return v||St(),E9(r,v,y)},[r,s]),u=Vr(()=>({uniqueId:e,descriptor:r,options:c,getDimension:d}),[r,d,c,e]),m=M.useRef(u),g=M.useRef(!0);Vs(()=>(n.draggable.register(m.current),()=>n.draggable.unregister(m.current)),[n.draggable]),Vs(()=>{if(g.current){g.current=!1;return}const y=m.current;m.current=u,n.draggable.update(u,y)},[u,n.draggable])}var g0=nr.createContext(null);function Eu(t){const e=M.useContext(t);return e||St(),e}function A9(t){t.preventDefault()}const P9=t=>{const e=M.useRef(null),r=Jt((P=null)=>{e.current=P},[]),n=Jt(()=>e.current,[]),{contextId:s,dragHandleUsageInstructionsId:i,registry:a}=Eu(rh),{type:l,droppableId:c}=Eu(g0),d=Vr(()=>({id:t.draggableId,index:t.index,type:l,droppableId:c}),[t.draggableId,t.index,l,c]),{children:u,draggableId:m,isEnabled:g,shouldRespectForcePress:y,canDragInteractiveElements:v,isClone:I,mapped:S,dropAnimationFinished:b}=t;if(!I){const P=Vr(()=>({descriptor:d,registry:a,getDraggableRef:n,canDragInteractiveElements:v,shouldRespectForcePress:y,isEnabled:g}),[d,a,n,v,y,g]);M9(P)}const k=Vr(()=>g?{tabIndex:0,role:"button","aria-describedby":i,"data-rfd-drag-handle-draggable-id":m,"data-rfd-drag-handle-context-id":s,draggable:!1,onDragStart:A9}:null,[s,i,m,g]),A=Jt(P=>{S.type==="DRAGGING"&&S.dropping&&P.propertyName==="transform"&&Pf.flushSync(b)},[b,S]),C=Vr(()=>{const P=T9(S),_=S.type==="DRAGGING"&&S.dropping?A:void 0;return{innerRef:r,draggableProps:{"data-rfd-draggable-context-id":s,"data-rfd-draggable-id":m,style:P,onTransitionEnd:_},dragHandleProps:k}},[s,k,m,S,A,r]),T=Vr(()=>({draggableId:d.id,type:d.type,source:{index:d.index,droppableId:d.droppableId}}),[d.droppableId,d.id,d.index,d.type]);return nr.createElement(nr.Fragment,null,u(C,S.snapshot,T))};var U2=(t,e)=>t===e,G2=t=>{const{combine:e,destination:r}=t;return r?r.droppableId:e?e.droppableId:null};const N9=t=>t.combine?t.combine.draggableId:null,D9=t=>t.at&&t.at.type==="COMBINE"?t.at.combine.draggableId:null;function R9(){const t=Wn((s,i)=>({x:s,y:i})),e=Wn((s,i,a=null,l=null,c=null)=>({isDragging:!0,isClone:i,isDropAnimating:!!c,dropAnimation:c,mode:s,draggingOver:a,combineWith:l,combineTargetFor:null})),r=Wn((s,i,a,l,c=null,d=null,u=null)=>({mapped:{type:"DRAGGING",dropping:null,draggingOver:c,combineWith:d,mode:i,offset:s,dimension:a,forceShouldAnimate:u,snapshot:e(i,l,c,d,null)}}));return(s,i)=>{if(jc(s)){if(s.critical.draggable.id!==i.draggableId)return null;const a=s.current.client.offset,l=s.dimensions.draggables[i.draggableId],c=Fs(s.impact),d=D9(s.impact),u=s.forceShouldAnimate;return r(t(a.x,a.y),s.movementMode,l,i.isClone,c,d,u)}if(s.phase==="DROP_ANIMATING"){const a=s.completed;if(a.result.draggableId!==i.draggableId)return null;const l=i.isClone,c=s.dimensions.draggables[i.draggableId],d=a.result,u=d.mode,m=G2(d),g=N9(d),v={duration:s.dropDuration,curve:l0.drop,moveTo:s.newHomeClientOffset,opacity:g?kc.opacity.drop:null,scale:g?kc.scale.drop:null};return{mapped:{type:"DRAGGING",offset:s.newHomeClientOffset,dimension:c,dropping:v,draggingOver:m,combineWith:g,mode:u,forceShouldAnimate:null,snapshot:e(u,l,m,g,v)}}}return null}}function H2(t=null){return{isDragging:!1,isDropAnimating:!1,isClone:!1,dropAnimation:null,mode:null,draggingOver:null,combineTargetFor:t,combineWith:null}}const O9={mapped:{type:"SECONDARY",offset:qn,combineTargetFor:null,shouldAnimateDisplacement:!0,snapshot:H2(null)}};function _9(){const t=Wn((a,l)=>({x:a,y:l})),e=Wn(H2),r=Wn((a,l=null,c)=>({mapped:{type:"SECONDARY",offset:a,combineTargetFor:l,shouldAnimateDisplacement:c,snapshot:e(l)}})),n=a=>a?r(qn,a,!0):null,s=(a,l,c,d)=>{const u=c.displaced.visible[a],m=!!(d.inVirtualList&&d.effected[a]),g=Xu(c),y=g&&g.draggableId===a?l:null;if(!u){if(!m)return n(y);if(c.displaced.invisible[a])return null;const S=Ml(d.displacedBy.point),b=t(S.x,S.y);return r(b,y,!0)}if(m)return n(y);const v=c.displacedBy.point,I=t(v.x,v.y);return r(I,y,u.shouldAnimate)};return(a,l)=>{if(jc(a))return a.critical.draggable.id===l.draggableId?null:s(l.draggableId,a.critical.draggable.id,a.impact,a.afterCritical);if(a.phase==="DROP_ANIMATING"){const c=a.completed;return c.result.draggableId===l.draggableId?null:s(l.draggableId,c.result.draggableId,c.impact,c.afterCritical)}return null}}const F9=()=>{const t=R9(),e=_9();return(n,s)=>t(n,s)||e(n,s)||O9},V9={dropAnimationFinished:C2},$9=Kb(F9,V9,null,{context:m0,areStatePropsEqual:U2})(P9);function W2(t){return Eu(g0).isUsingCloneFor===t.draggableId&&!t.isClone?null:nr.createElement($9,t)}function Tc(t){const e=typeof t.isDragDisabled=="boolean"?!t.isDragDisabled:!0,r=!!t.disableInteractiveElementBlocking,n=!!t.shouldRespectForcePress;return nr.createElement(W2,Mf({},t,{isClone:!1,isEnabled:e,canDragInteractiveElements:r,shouldRespectForcePress:n}))}const q2=t=>e=>t===e,z9=q2("scroll"),L9=q2("auto"),yx=(t,e)=>e(t.overflowX)||e(t.overflowY),B9=t=>{const e=window.getComputedStyle(t),r={overflowX:e.overflowX,overflowY:e.overflowY};return yx(r,z9)||yx(r,L9)},U9=()=>!1,J2=t=>t==null?null:t===document.body?U9()?t:null:t===document.documentElement?null:B9(t)?t:J2(t.parentElement);var Jp=t=>({x:t.scrollLeft,y:t.scrollTop});const Y2=t=>t?window.getComputedStyle(t).position==="fixed"?!0:Y2(t.parentElement):!1;var G9=t=>{const e=J2(t),r=Y2(t);return{closestScrollable:e,isFixedOnPage:r}},H9=({descriptor:t,isEnabled:e,isCombineEnabled:r,isFixedOnPage:n,direction:s,client:i,page:a,closest:l})=>{const c=(()=>{if(!l)return null;const{scrollSize:g,client:y}=l,v=T2({scrollHeight:g.scrollHeight,scrollWidth:g.scrollWidth,height:y.paddingBox.height,width:y.paddingBox.width});return{pageMarginBox:l.page.marginBox,frameClient:y,scrollSize:g,shouldClipSubject:l.shouldClipSubject,scroll:{initial:l.scroll,current:l.scroll,max:v,diff:{value:qn,displacement:qn}}}})(),d=s==="vertical"?t0:i2,u=xl({page:a,withPlaceholder:null,axis:d,frame:c});return{descriptor:t,isCombineEnabled:r,isFixedOnPage:n,axis:d,isEnabled:e,client:i,page:a,frame:c,subject:u}};const W9=(t,e)=>{const r=zv(t);if(!e||t!==e)return r;const n=r.paddingBox.top-e.scrollTop,s=r.paddingBox.left-e.scrollLeft,i=n+e.scrollHeight,a=s+e.scrollWidth,c=Lv({top:n,right:a,bottom:i,left:s},r.border);return Mw({borderBox:c,margin:r.margin,border:r.border,padding:r.padding})};var q9=({ref:t,descriptor:e,env:r,windowScroll:n,direction:s,isDropDisabled:i,isCombineEnabled:a,shouldClipSubject:l})=>{const c=r.closestScrollable,d=W9(t,c),u=Kd(d,n),m=(()=>{if(!c)return null;const y=zv(c),v={scrollHeight:c.scrollHeight,scrollWidth:c.scrollWidth};return{client:y,page:Kd(y,n),scroll:Jp(c),scrollSize:v,shouldClipSubject:l}})();return H9({descriptor:e,isEnabled:!i,isCombineEnabled:a,isFixedOnPage:r.isFixedOnPage,direction:s,client:d,page:u,closest:m})};const J9={passive:!1},Y9={passive:!0};var xx=t=>t.shouldPublishImmediately?J9:Y9;const gd=t=>t&&t.env.closestScrollable||null;function K9(t){const e=M.useRef(null),r=Eu(rh),n=p0("droppable"),{registry:s,marshal:i}=r,a=_2(t),l=Vr(()=>({id:t.droppableId,type:t.type,mode:t.mode}),[t.droppableId,t.mode,t.type]),c=M.useRef(l),d=Vr(()=>Wn((C,T)=>{e.current||St();const P={x:C,y:T};i.updateDroppableScroll(l.id,P)}),[l.id,i]),u=Jt(()=>{const C=e.current;return!C||!C.env.closestScrollable?qn:Jp(C.env.closestScrollable)},[]),m=Jt(()=>{const C=u();d(C.x,C.y)},[u,d]),g=Vr(()=>bc(m),[m]),y=Jt(()=>{const C=e.current,T=gd(C);if(C&&T||St(),C.scrollOptions.shouldPublishImmediately){m();return}g()},[g,m]),v=Jt((C,T)=>{e.current&&St();const P=a.current,_=P.getDroppableRef();_||St();const R=G9(_),G={ref:_,descriptor:l,env:R,scrollOptions:T};e.current=G;const ne=q9({ref:_,descriptor:l,env:R,windowScroll:C,direction:P.direction,isDropDisabled:P.isDropDisabled,isCombineEnabled:P.isCombineEnabled,shouldClipSubject:!P.ignoreContainerClipping}),he=R.closestScrollable;return he&&(he.setAttribute(hx.contextId,r.contextId),he.addEventListener("scroll",y,xx(G.scrollOptions))),ne},[r.contextId,l,y,a]),I=Jt(()=>{const C=e.current,T=gd(C);return C&&T||St(),Jp(T)},[]),S=Jt(()=>{const C=e.current;C||St();const T=gd(C);e.current=null,T&&(g.cancel(),T.removeAttribute(hx.contextId),T.removeEventListener("scroll",y,xx(C.scrollOptions)))},[y,g]),b=Jt(C=>{const T=e.current;T||St();const P=gd(T);P||St(),P.scrollTop+=C.y,P.scrollLeft+=C.x},[]),k=Vr(()=>({getDimensionAndWatchScroll:v,getScrollWhileDragging:I,dragStopped:S,scroll:b}),[S,v,I,b]),A=Vr(()=>({uniqueId:n,descriptor:l,callbacks:k}),[k,l,n]);Vs(()=>(c.current=A.descriptor,s.droppable.register(A),()=>{e.current&&S(),s.droppable.unregister(A)}),[k,l,S,A,i,s.droppable]),Vs(()=>{e.current&&i.updateDroppableIsEnabled(c.current.id,!t.isDropDisabled)},[t.isDropDisabled,i]),Vs(()=>{e.current&&i.updateDroppableIsCombineEnabled(c.current.id,t.isCombineEnabled)},[t.isCombineEnabled,i])}function mm(){}const vx={width:0,height:0,margin:oj},Z9=({isAnimatingOpenOnMount:t,placeholder:e,animate:r})=>t||r==="close"?vx:{height:e.client.borderBox.height,width:e.client.borderBox.width,margin:e.client.margin},X9=({isAnimatingOpenOnMount:t,placeholder:e,animate:r})=>{const n=Z9({isAnimatingOpenOnMount:t,placeholder:e,animate:r});return{display:e.display,boxSizing:"border-box",width:n.width,height:n.height,marginTop:n.margin.top,marginRight:n.margin.right,marginBottom:n.margin.bottom,marginLeft:n.margin.left,flexShrink:"0",flexGrow:"0",pointerEvents:"none",transition:r!=="none"?ac.placeholder:null}},Q9=t=>{const e=M.useRef(null),r=Jt(()=>{e.current&&(clearTimeout(e.current),e.current=null)},[]),{animate:n,onTransitionEnd:s,onClose:i,contextId:a}=t,[l,c]=M.useState(t.animate==="open");M.useEffect(()=>l?n!=="open"?(r(),c(!1),mm):e.current?mm:(e.current=setTimeout(()=>{e.current=null,c(!1)}),r):mm,[n,l,r]);const d=Jt(m=>{m.propertyName==="height"&&(s(),n==="close"&&i())},[n,i,s]),u=X9({isAnimatingOpenOnMount:l,animate:t.animate,placeholder:t.placeholder});return nr.createElement(t.placeholder.tagName,{style:u,"data-rfd-placeholder-context-id":a,onTransitionEnd:d,ref:t.innerRef})};var eE=nr.memo(Q9);class tE extends nr.PureComponent{constructor(...e){super(...e),this.state={isVisible:!!this.props.on,data:this.props.on,animate:this.props.shouldAnimate&&this.props.on?"open":"none"},this.onClose=()=>{this.state.animate==="close"&&this.setState({isVisible:!1})}}static getDerivedStateFromProps(e,r){return e.shouldAnimate?e.on?{isVisible:!0,data:e.on,animate:"open"}:r.isVisible?{isVisible:!0,data:r.data,animate:"close"}:{isVisible:!1,animate:"close",data:null}:{isVisible:!!e.on,data:e.on,animate:"none"}}render(){if(!this.state.isVisible)return null;const e={onClose:this.onClose,data:this.state.data,animate:this.state.animate};return this.props.children(e)}}const rE=t=>{const e=M.useContext(rh);e||St();const{contextId:r,isMovementAllowed:n}=e,s=M.useRef(null),i=M.useRef(null),{children:a,droppableId:l,type:c,mode:d,direction:u,ignoreContainerClipping:m,isDropDisabled:g,isCombineEnabled:y,snapshot:v,useClone:I,updateViewportMaxScroll:S,getContainerForClone:b}=t,k=Jt(()=>s.current,[]),A=Jt((he=null)=>{s.current=he},[]);Jt(()=>i.current,[]);const C=Jt((he=null)=>{i.current=he},[]),T=Jt(()=>{n()&&S({maxScroll:M2()})},[n,S]);K9({droppableId:l,type:c,mode:d,direction:u,isDropDisabled:g,isCombineEnabled:y,ignoreContainerClipping:m,getDroppableRef:k});const P=Vr(()=>nr.createElement(tE,{on:t.placeholder,shouldAnimate:t.shouldAnimatePlaceholder},({onClose:he,data:te,animate:K})=>nr.createElement(eE,{placeholder:te,onClose:he,innerRef:C,animate:K,contextId:r,onTransitionEnd:T})),[r,T,t.placeholder,t.shouldAnimatePlaceholder,C]),_=Vr(()=>({innerRef:A,placeholder:P,droppableProps:{"data-rfd-droppable-id":l,"data-rfd-droppable-context-id":r}}),[r,l,P,A]),R=I?I.dragging.draggableId:null,G=Vr(()=>({droppableId:l,type:c,isUsingCloneFor:R}),[l,R,c]);function ne(){if(!I)return null;const{dragging:he,render:te}=I,K=nr.createElement(W2,{draggableId:he.draggableId,index:he.source.index,isClone:!0,isEnabled:!0,shouldRespectForcePress:!1,canDragInteractiveElements:!0},(O,Z)=>te(O,Z,he));return Yw.createPortal(K,b())}return nr.createElement(g0.Provider,{value:G},a(_,v),ne())};function nE(){return document.body||St(),document.body}const bx={mode:"standard",type:"DEFAULT",direction:"vertical",isDropDisabled:!1,isCombineEnabled:!1,ignoreContainerClipping:!1,renderClone:null,getContainerForClone:nE},K2=t=>{let e={...t},r;for(r in bx)t[r]===void 0&&(e={...e,[r]:bx[r]});return e},pm=(t,e)=>t===e.droppable.type,Sx=(t,e)=>e.draggables[t.draggable.id],sE=()=>{const t={placeholder:null,shouldAnimatePlaceholder:!0,snapshot:{isDraggingOver:!1,draggingOverWith:null,draggingFromThisWith:null,isUsingPlaceholder:!1},useClone:null},e={...t,shouldAnimatePlaceholder:!1},r=Wn(i=>({draggableId:i.id,type:i.type,source:{index:i.index,droppableId:i.droppableId}})),n=Wn((i,a,l,c,d,u)=>{const m=d.descriptor.id;if(d.descriptor.droppableId===i){const v=u?{render:u,dragging:r(d.descriptor)}:null,I={isDraggingOver:l,draggingOverWith:l?m:null,draggingFromThisWith:m,isUsingPlaceholder:!0};return{placeholder:d.placeholder,shouldAnimatePlaceholder:!1,snapshot:I,useClone:v}}if(!a)return e;if(!c)return t;const y={isDraggingOver:l,draggingOverWith:m,draggingFromThisWith:null,isUsingPlaceholder:!0};return{placeholder:d.placeholder,shouldAnimatePlaceholder:!0,snapshot:y,useClone:null}});return(i,a)=>{const l=K2(a),c=l.droppableId,d=l.type,u=!l.isDropDisabled,m=l.renderClone;if(jc(i)){const g=i.critical;if(!pm(d,g))return e;const y=Sx(g,i.dimensions),v=Fs(i.impact)===c;return n(c,u,v,v,y,m)}if(i.phase==="DROP_ANIMATING"){const g=i.completed;if(!pm(d,g.critical))return e;const y=Sx(g.critical,i.dimensions);return n(c,u,G2(g.result)===c,Fs(g.impact)===c,y,m)}if(i.phase==="IDLE"&&i.completed&&!i.shouldFlush){const g=i.completed;if(!pm(d,g.critical))return e;const y=Fs(g.impact)===c,v=!!(g.impact.at&&g.impact.at.type==="COMBINE"),I=g.critical.droppable.id===c;return y?v?t:e:I?t:e}return e}},oE={updateViewportMaxScroll:y8},oh=Kb(sE,oE,(t,e,r)=>({...K2(r),...t,...e}),{context:m0,areStatePropsEqual:U2})(rE);var iE=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,7,9,32,4,318,1,80,3,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,68,8,2,0,3,0,2,3,2,4,2,0,15,1,83,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,7,19,58,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,343,9,54,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,10,5350,0,7,14,11465,27,2343,9,87,9,39,4,60,6,26,9,535,9,470,0,2,54,8,3,82,0,12,1,19628,1,4178,9,519,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,245,1,2,9,726,6,110,6,6,9,4759,9,787719,239],Z2=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,4,51,13,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,39,27,10,22,251,41,7,1,17,2,60,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,31,9,2,0,3,0,2,37,2,0,26,0,2,0,45,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,200,32,32,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,26,3994,6,582,6842,29,1763,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,433,44,212,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,42,9,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,229,29,3,0,496,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],aE="â€Œâ€Â·Ì€-Í¯Î‡Òƒ-Ò‡Ö‘-Ö½Ö¿××‚×„×…×‡Ø-ØšÙ‹-Ù©Ù°Û–-ÛœÛŸ-Û¤Û§Û¨Ûª-Û­Û°-Û¹Ü‘Ü°-ÝŠÞ¦-Þ°ß€-ß‰ß«-ß³ß½à –-à ™à ›-à £à ¥-à §à ©-à ­à¡™-à¡›à¢—-à¢Ÿà£Š-à£¡à££-à¤ƒà¤º-à¤¼à¤¾-à¥à¥‘-à¥—à¥¢à¥£à¥¦-à¥¯à¦-à¦ƒà¦¼à¦¾-à§„à§‡à§ˆà§‹-à§à§—à§¢à§£à§¦-à§¯à§¾à¨-à¨ƒà¨¼à¨¾-à©‚à©‡à©ˆà©‹-à©à©‘à©¦-à©±à©µàª-àªƒàª¼àª¾-à«…à«‡-à«‰à«‹-à«à«¢à«£à«¦-à«¯à«º-à«¿à¬-à¬ƒà¬¼à¬¾-à­„à­‡à­ˆà­‹-à­à­•-à­—à­¢à­£à­¦-à­¯à®‚à®¾-à¯‚à¯†-à¯ˆà¯Š-à¯à¯—à¯¦-à¯¯à°€-à°„à°¼à°¾-à±„à±†-à±ˆà±Š-à±à±•à±–à±¢à±£à±¦-à±¯à²-à²ƒà²¼à²¾-à³„à³†-à³ˆà³Š-à³à³•à³–à³¢à³£à³¦-à³¯à³³à´€-à´ƒà´»à´¼à´¾-àµ„àµ†-àµˆàµŠ-àµàµ—àµ¢àµ£àµ¦-àµ¯à¶-à¶ƒà·Šà·-à·”à·–à·˜-à·Ÿà·¦-à·¯à·²à·³à¸±à¸´-à¸ºà¹‡-à¹Žà¹-à¹™àº±àº´-àº¼à»ˆ-à»Žà»-à»™à¼˜à¼™à¼ -à¼©à¼µà¼·à¼¹à¼¾à¼¿à½±-à¾„à¾†à¾‡à¾-à¾—à¾™-à¾¼à¿†á€«-á€¾á€-á‰á–-á™áž-á á¢-á¤á§-á­á±-á´á‚‚-á‚á‚-á‚á-áŸá©-á±áœ’-áœ•áœ²-áœ´á’á“á²á³áž´-áŸ“áŸáŸ -áŸ©á ‹-á á -á ™á¢©á¤ -á¤«á¤°-á¤»á¥†-á¥á§-á§šá¨—-á¨›á©•-á©žá© -á©¼á©¿-áª‰áª-áª™áª°-áª½áª¿-á«Žá¬€-á¬„á¬´-á­„á­-á­™á­«-á­³á®€-á®‚á®¡-á®­á®°-á®¹á¯¦-á¯³á°¤-á°·á±€-á±‰á±-á±™á³-á³’á³”-á³¨á³­á³´á³·-á³¹á·€-á·¿â€Œâ€â€¿â€â”âƒ-âƒœâƒ¡âƒ¥-âƒ°â³¯-â³±âµ¿â· -â·¿ã€ª-ã€¯ã‚™ã‚šãƒ»ê˜ -ê˜©ê™¯ê™´-ê™½êšžêšŸê›°ê›±ê ‚ê †ê ‹ê £-ê §ê ¬ê¢€ê¢ê¢´-ê£…ê£-ê£™ê£ -ê£±ê£¿-ê¤‰ê¤¦-ê¤­ê¥‡-ê¥“ê¦€-ê¦ƒê¦³-ê§€ê§-ê§™ê§¥ê§°-ê§¹ê¨©-ê¨¶ê©ƒê©Œê©ê©-ê©™ê©»-ê©½êª°êª²-êª´êª·êª¸êª¾êª¿ê«ê««-ê«¯ê«µê«¶ê¯£-ê¯ªê¯¬ê¯­ê¯°-ê¯¹ï¬žï¸€-ï¸ï¸ -ï¸¯ï¸³ï¸´ï¹-ï¹ï¼-ï¼™ï¼¿ï½¥",X2="ÂªÂµÂºÃ€-Ã–Ã˜-Ã¶Ã¸-ËË†-Ë‘Ë -Ë¤Ë¬Ë®Í°-Í´Í¶Í·Íº-Í½Í¿Î†Îˆ-ÎŠÎŒÎŽ-Î¡Î£-ÏµÏ·-ÒÒŠ-Ô¯Ô±-Õ–Õ™Õ -Öˆ×-×ª×¯-×²Ø -ÙŠÙ®Ù¯Ù±-Û“Û•Û¥Û¦Û®Û¯Ûº-Û¼Û¿ÜÜ’-Ü¯Ý-Þ¥Þ±ßŠ-ßªß´ßµßºà €-à •à šà ¤à ¨à¡€-à¡˜à¡ -à¡ªà¡°-à¢‡à¢‰-à¢Žà¢ -à£‰à¤„-à¤¹à¤½à¥à¥˜-à¥¡à¥±-à¦€à¦…-à¦Œà¦à¦à¦“-à¦¨à¦ª-à¦°à¦²à¦¶-à¦¹à¦½à§Žà§œà§à§Ÿ-à§¡à§°à§±à§¼à¨…-à¨Šà¨à¨à¨“-à¨¨à¨ª-à¨°à¨²à¨³à¨µà¨¶à¨¸à¨¹à©™-à©œà©žà©²-à©´àª…-àªàª-àª‘àª“-àª¨àªª-àª°àª²àª³àªµ-àª¹àª½à«à« à«¡à«¹à¬…-à¬Œà¬à¬à¬“-à¬¨à¬ª-à¬°à¬²à¬³à¬µ-à¬¹à¬½à­œà­à­Ÿ-à­¡à­±à®ƒà®…-à®Šà®Ž-à®à®’-à®•à®™à®šà®œà®žà®Ÿà®£à®¤à®¨-à®ªà®®-à®¹à¯à°…-à°Œà°Ž-à°à°’-à°¨à°ª-à°¹à°½à±˜-à±šà±à± à±¡à²€à²…-à²Œà²Ž-à²à²’-à²¨à²ª-à²³à²µ-à²¹à²½à³à³žà³ à³¡à³±à³²à´„-à´Œà´Ž-à´à´’-à´ºà´½àµŽàµ”-àµ–àµŸ-àµ¡àµº-àµ¿à¶…-à¶–à¶š-à¶±à¶³-à¶»à¶½à·€-à·†à¸-à¸°à¸²à¸³à¹€-à¹†àºàº‚àº„àº†-àºŠàºŒ-àº£àº¥àº§-àº°àº²àº³àº½à»€-à»„à»†à»œ-à»Ÿà¼€à½€-à½‡à½‰-à½¬à¾ˆ-à¾Œá€€-á€ªá€¿á-á•áš-áá¡á¥á¦á®-á°áµ-á‚á‚Žá‚ -áƒ…áƒ‡áƒáƒ-áƒºáƒ¼-á‰ˆá‰Š-á‰á‰-á‰–á‰˜á‰š-á‰á‰ -áŠˆáŠŠ-áŠáŠ-áŠ°áŠ²-áŠµáŠ¸-áŠ¾á‹€á‹‚-á‹…á‹ˆ-á‹–á‹˜-áŒáŒ’-áŒ•áŒ˜-ášáŽ€-áŽáŽ -áµá¸-á½á-á™¬á™¯-á™¿áš-áššáš -á›ªá›®-á›¸áœ€-áœ‘áœŸ-áœ±á€-á‘á -á¬á®-á°áž€-áž³áŸ—áŸœá  -á¡¸á¢€-á¢¨á¢ªá¢°-á£µá¤€-á¤žá¥-á¥­á¥°-á¥´á¦€-á¦«á¦°-á§‰á¨€-á¨–á¨ -á©”áª§á¬…-á¬³á­…-á­Œá®ƒ-á® á®®á®¯á®º-á¯¥á°€-á°£á±-á±á±š-á±½á²€-á²Šá²-á²ºá²½-á²¿á³©-á³¬á³®-á³³á³µá³¶á³ºá´€-á¶¿á¸€-á¼•á¼˜-á¼á¼ -á½…á½ˆ-á½á½-á½—á½™á½›á½á½Ÿ-á½½á¾€-á¾´á¾¶-á¾¼á¾¾á¿‚-á¿„á¿†-á¿Œá¿-á¿“á¿–-á¿›á¿ -á¿¬á¿²-á¿´á¿¶-á¿¼â±â¿â‚-â‚œâ„‚â„‡â„Š-â„“â„•â„˜-â„â„¤â„¦â„¨â„ª-â„¹â„¼-â„¿â……-â…‰â…Žâ… -â†ˆâ°€-â³¤â³«-â³®â³²â³³â´€-â´¥â´§â´­â´°-âµ§âµ¯â¶€-â¶–â¶ -â¶¦â¶¨-â¶®â¶°-â¶¶â¶¸-â¶¾â·€-â·†â·ˆ-â·Žâ·-â·–â·˜-â·žã€…-ã€‡ã€¡-ã€©ã€±-ã€µã€¸-ã€¼ã-ã‚–ã‚›-ã‚Ÿã‚¡-ãƒºãƒ¼-ãƒ¿ã„…-ã„¯ã„±-ã†Žã† -ã†¿ã‡°-ã‡¿ã€-ä¶¿ä¸€-ê’Œê“-ê“½ê”€-ê˜Œê˜-ê˜Ÿê˜ªê˜«ê™€-ê™®ê™¿-êšêš -ê›¯êœ—-êœŸêœ¢-êžˆêž‹-êŸêŸêŸ‘êŸ“êŸ•-êŸœêŸ²-ê ê ƒ-ê …ê ‡-ê Šê Œ-ê ¢ê¡€-ê¡³ê¢‚-ê¢³ê£²-ê£·ê£»ê£½ê£¾ê¤Š-ê¤¥ê¤°-ê¥†ê¥ -ê¥¼ê¦„-ê¦²ê§ê§ -ê§¤ê§¦-ê§¯ê§º-ê§¾ê¨€-ê¨¨ê©€-ê©‚ê©„-ê©‹ê© -ê©¶ê©ºê©¾-êª¯êª±êªµêª¶êª¹-êª½ê«€ê«‚ê«›-ê«ê« -ê«ªê«²-ê«´ê¬-ê¬†ê¬‰-ê¬Žê¬‘-ê¬–ê¬ -ê¬¦ê¬¨-ê¬®ê¬°-ê­šê­œ-ê­©ê­°-ê¯¢ê°€-íž£íž°-íŸ†íŸ‹-íŸ»ï¤€-ï©­ï©°-ï«™ï¬€-ï¬†ï¬“-ï¬—ï¬ï¬Ÿ-ï¬¨ï¬ª-ï¬¶ï¬¸-ï¬¼ï¬¾ï­€ï­ï­ƒï­„ï­†-ï®±ï¯“-ï´½ïµ-ï¶ï¶’-ï·‡ï·°-ï·»ï¹°-ï¹´ï¹¶-ï»¼ï¼¡-ï¼ºï½-ï½šï½¦-ï¾¾ï¿‚-ï¿‡ï¿Š-ï¿ï¿’-ï¿—ï¿š-ï¿œ",fm={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},gm="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",lE={5:gm,"5module":gm+" export import",6:gm+" const class extends export import super"},cE=/^in(stanceof)?$/,dE=new RegExp("["+X2+"]"),uE=new RegExp("["+X2+aE+"]");function Yp(t,e){for(var r=65536,n=0;n<e.length;n+=2){if(r+=e[n],r>t)return!1;if(r+=e[n+1],r>=t)return!0}return!1}function Oo(t,e){return t<65?t===36:t<91?!0:t<97?t===95:t<123?!0:t<=65535?t>=170&&dE.test(String.fromCharCode(t)):e===!1?!1:Yp(t,Z2)}function _i(t,e){return t<48?t===36:t<58?!0:t<65?!1:t<91?!0:t<97?t===95:t<123?!0:t<=65535?t>=170&&uE.test(String.fromCharCode(t)):e===!1?!1:Yp(t,Z2)||Yp(t,iE)}var Br=function(e,r){r===void 0&&(r={}),this.label=e,this.keyword=r.keyword,this.beforeExpr=!!r.beforeExpr,this.startsExpr=!!r.startsExpr,this.isLoop=!!r.isLoop,this.isAssign=!!r.isAssign,this.prefix=!!r.prefix,this.postfix=!!r.postfix,this.binop=r.binop||null,this.updateContext=null};function qs(t,e){return new Br(t,{beforeExpr:!0,binop:e})}var Js={beforeExpr:!0},ws={startsExpr:!0},y0={};function Nr(t,e){return e===void 0&&(e={}),e.keyword=t,y0[t]=new Br(t,e)}var W={num:new Br("num",ws),regexp:new Br("regexp",ws),string:new Br("string",ws),name:new Br("name",ws),privateId:new Br("privateId",ws),eof:new Br("eof"),bracketL:new Br("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Br("]"),braceL:new Br("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Br("}"),parenL:new Br("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Br(")"),comma:new Br(",",Js),semi:new Br(";",Js),colon:new Br(":",Js),dot:new Br("."),question:new Br("?",Js),questionDot:new Br("?."),arrow:new Br("=>",Js),template:new Br("template"),invalidTemplate:new Br("invalidTemplate"),ellipsis:new Br("...",Js),backQuote:new Br("`",ws),dollarBraceL:new Br("${",{beforeExpr:!0,startsExpr:!0}),eq:new Br("=",{beforeExpr:!0,isAssign:!0}),assign:new Br("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Br("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Br("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:qs("||",1),logicalAND:qs("&&",2),bitwiseOR:qs("|",3),bitwiseXOR:qs("^",4),bitwiseAND:qs("&",5),equality:qs("==/!=/===/!==",6),relational:qs("</>/<=/>=",7),bitShift:qs("<</>>/>>>",8),plusMin:new Br("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:qs("%",10),star:qs("*",10),slash:qs("/",10),starstar:new Br("**",{beforeExpr:!0}),coalesce:qs("??",1),_break:Nr("break"),_case:Nr("case",Js),_catch:Nr("catch"),_continue:Nr("continue"),_debugger:Nr("debugger"),_default:Nr("default",Js),_do:Nr("do",{isLoop:!0,beforeExpr:!0}),_else:Nr("else",Js),_finally:Nr("finally"),_for:Nr("for",{isLoop:!0}),_function:Nr("function",ws),_if:Nr("if"),_return:Nr("return",Js),_switch:Nr("switch"),_throw:Nr("throw",Js),_try:Nr("try"),_var:Nr("var"),_const:Nr("const"),_while:Nr("while",{isLoop:!0}),_with:Nr("with"),_new:Nr("new",{beforeExpr:!0,startsExpr:!0}),_this:Nr("this",ws),_super:Nr("super",ws),_class:Nr("class",ws),_extends:Nr("extends",Js),_export:Nr("export"),_import:Nr("import",ws),_null:Nr("null",ws),_true:Nr("true",ws),_false:Nr("false",ws),_in:Nr("in",{beforeExpr:!0,binop:7}),_instanceof:Nr("instanceof",{beforeExpr:!0,binop:7}),_typeof:Nr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Nr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Nr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Ts=/\r\n?|\n|\u2028|\u2029/,hE=new RegExp(Ts.source,"g");function Nl(t){return t===10||t===13||t===8232||t===8233}function Q2(t,e,r){r===void 0&&(r=t.length);for(var n=e;n<r;n++){var s=t.charCodeAt(n);if(Nl(s))return n<r-1&&s===13&&t.charCodeAt(n+1)===10?n+2:n+1}return-1}var eS=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,ns=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,tS=Object.prototype,mE=tS.hasOwnProperty,pE=tS.toString,Dl=Object.hasOwn||function(t,e){return mE.call(t,e)},wx=Array.isArray||function(t){return pE.call(t)==="[object Array]"},Cx=Object.create(null);function bi(t){return Cx[t]||(Cx[t]=new RegExp("^(?:"+t.replace(/ /g,"|")+")$"))}function si(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode((t>>10)+55296,(t&1023)+56320))}var fE=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,Ec=function(e,r){this.line=e,this.column=r};Ec.prototype.offset=function(e){return new Ec(this.line,this.column+e)};var ih=function(e,r,n){this.start=r,this.end=n,e.sourceFile!==null&&(this.source=e.sourceFile)};function rS(t,e){for(var r=1,n=0;;){var s=Q2(t,n,e);if(s<0)return new Ec(r,e-n);++r,n=s}}var Kp={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},kx=!1;function gE(t){var e={};for(var r in Kp)e[r]=t&&Dl(t,r)?t[r]:Kp[r];if(e.ecmaVersion==="latest"?e.ecmaVersion=1e8:e.ecmaVersion==null?(!kx&&typeof console=="object"&&console.warn&&(kx=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),e.ecmaVersion=11):e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),e.allowReserved==null&&(e.allowReserved=e.ecmaVersion<5),(!t||t.allowHashBang==null)&&(e.allowHashBang=e.ecmaVersion>=14),wx(e.onToken)){var n=e.onToken;e.onToken=function(s){return n.push(s)}}return wx(e.onComment)&&(e.onComment=yE(e,e.onComment)),e}function yE(t,e){return function(r,n,s,i,a,l){var c={type:r?"Block":"Line",value:n,start:s,end:i};t.locations&&(c.loc=new ih(this,a,l)),t.ranges&&(c.range=[s,i]),e.push(c)}}var Mc=1,Rl=2,x0=4,nS=8,v0=16,sS=32,ah=64,oS=128,Wa=256,Gc=512,lh=Mc|Rl|Wa;function b0(t,e){return Rl|(t?x0:0)|(e?nS:0)}var Mu=0,S0=1,li=2,iS=3,aS=4,lS=5,Ln=function(e,r,n){this.options=e=gE(e),this.sourceFile=e.sourceFile,this.keywords=bi(lE[e.ecmaVersion>=6?6:e.sourceType==="module"?"5module":5]);var s="";e.allowReserved!==!0&&(s=fm[e.ecmaVersion>=6?6:e.ecmaVersion===5?5:3],e.sourceType==="module"&&(s+=" await")),this.reservedWords=bi(s);var i=(s?s+" ":"")+fm.strict;this.reservedWordsStrict=bi(i),this.reservedWordsStrictBind=bi(i+" "+fm.strictBind),this.input=String(r),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf(`
`,n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Ts).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=W.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=e.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&e.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Mc),this.regexpState=null,this.privateNameStack=[]},Fo={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};Ln.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)};Fo.inFunction.get=function(){return(this.currentVarScope().flags&Rl)>0};Fo.inGenerator.get=function(){return(this.currentVarScope().flags&nS)>0};Fo.inAsync.get=function(){return(this.currentVarScope().flags&x0)>0};Fo.canAwait.get=function(){for(var t=this.scopeStack.length-1;t>=0;t--){var e=this.scopeStack[t],r=e.flags;if(r&(Wa|Gc))return!1;if(r&Rl)return(r&x0)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction};Fo.allowSuper.get=function(){var t=this.currentThisScope(),e=t.flags;return(e&ah)>0||this.options.allowSuperOutsideMethod};Fo.allowDirectSuper.get=function(){return(this.currentThisScope().flags&oS)>0};Fo.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())};Fo.allowNewDotTarget.get=function(){for(var t=this.scopeStack.length-1;t>=0;t--){var e=this.scopeStack[t],r=e.flags;if(r&(Wa|Gc)||r&Rl&&!(r&v0))return!0}return!1};Fo.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&Wa)>0};Ln.extend=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];for(var n=this,s=0;s<e.length;s++)n=e[s](n);return n};Ln.parse=function(e,r){return new this(r,e).parse()};Ln.parseExpressionAt=function(e,r,n){var s=new this(n,e,r);return s.nextToken(),s.parseExpression()};Ln.tokenizer=function(e,r){return new this(r,e)};Object.defineProperties(Ln.prototype,Fo);var vs=Ln.prototype,xE=/^(?:'((?:\\[^]|[^'\\])*?)'|"((?:\\[^]|[^"\\])*?)")/;vs.strictDirective=function(t){if(this.options.ecmaVersion<5)return!1;for(;;){ns.lastIndex=t,t+=ns.exec(this.input)[0].length;var e=xE.exec(this.input.slice(t));if(!e)return!1;if((e[1]||e[2])==="use strict"){ns.lastIndex=t+e[0].length;var r=ns.exec(this.input),n=r.index+r[0].length,s=this.input.charAt(n);return s===";"||s==="}"||Ts.test(r[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(s)||s==="!"&&this.input.charAt(n+1)==="=")}t+=e[0].length,ns.lastIndex=t,t+=ns.exec(this.input)[0].length,this.input[t]===";"&&t++}};vs.eat=function(t){return this.type===t?(this.next(),!0):!1};vs.isContextual=function(t){return this.type===W.name&&this.value===t&&!this.containsEsc};vs.eatContextual=function(t){return this.isContextual(t)?(this.next(),!0):!1};vs.expectContextual=function(t){this.eatContextual(t)||this.unexpected()};vs.canInsertSemicolon=function(){return this.type===W.eof||this.type===W.braceR||Ts.test(this.input.slice(this.lastTokEnd,this.start))};vs.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0};vs.semicolon=function(){!this.eat(W.semi)&&!this.insertSemicolon()&&this.unexpected()};vs.afterTrailingComma=function(t,e){if(this.type===t)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0};vs.expect=function(t){this.eat(t)||this.unexpected()};vs.unexpected=function(t){this.raise(t??this.start,"Unexpected token")};var ch=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};vs.checkPatternErrors=function(t,e){if(t){t.trailingComma>-1&&this.raiseRecoverable(t.trailingComma,"Comma is not permitted after the rest element");var r=e?t.parenthesizedAssign:t.parenthesizedBind;r>-1&&this.raiseRecoverable(r,e?"Assigning to rvalue":"Parenthesized pattern")}};vs.checkExpressionErrors=function(t,e){if(!t)return!1;var r=t.shorthandAssign,n=t.doubleProto;if(!e)return r>=0||n>=0;r>=0&&this.raise(r,"Shorthand property assignments are valid only in destructuring patterns"),n>=0&&this.raiseRecoverable(n,"Redefinition of __proto__ property")};vs.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")};vs.isSimpleAssignTarget=function(t){return t.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(t.expression):t.type==="Identifier"||t.type==="MemberExpression"};var $t=Ln.prototype;$t.parseTopLevel=function(t){var e=Object.create(null);for(t.body||(t.body=[]);this.type!==W.eof;){var r=this.parseStatement(null,!0,e);t.body.push(r)}if(this.inModule)for(var n=0,s=Object.keys(this.undefinedExports);n<s.length;n+=1){var i=s[n];this.raiseRecoverable(this.undefinedExports[i].start,"Export '"+i+"' is not defined")}return this.adaptDirectivePrologue(t.body),this.next(),t.sourceType=this.options.sourceType,this.finishNode(t,"Program")};var w0={kind:"loop"},vE={kind:"switch"};$t.isLet=function(t){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;ns.lastIndex=this.pos;var e=ns.exec(this.input),r=this.pos+e[0].length,n=this.input.charCodeAt(r);if(n===91||n===92)return!0;if(t)return!1;if(n===123||n>55295&&n<56320)return!0;if(Oo(n,!0)){for(var s=r+1;_i(n=this.input.charCodeAt(s),!0);)++s;if(n===92||n>55295&&n<56320)return!0;var i=this.input.slice(r,s);if(!cE.test(i))return!0}return!1};$t.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;ns.lastIndex=this.pos;var t=ns.exec(this.input),e=this.pos+t[0].length,r;return!Ts.test(this.input.slice(this.pos,e))&&this.input.slice(e,e+8)==="function"&&(e+8===this.input.length||!(_i(r=this.input.charCodeAt(e+8))||r>55295&&r<56320))};$t.isUsingKeyword=function(t,e){if(this.options.ecmaVersion<17||!this.isContextual(t?"await":"using"))return!1;ns.lastIndex=this.pos;var r=ns.exec(this.input),n=this.pos+r[0].length;if(Ts.test(this.input.slice(this.pos,n)))return!1;if(t){var s=n+5,i;if(this.input.slice(n,s)!=="using"||s===this.input.length||_i(i=this.input.charCodeAt(s))||i>55295&&i<56320)return!1;ns.lastIndex=s;var a=ns.exec(this.input);if(a&&Ts.test(this.input.slice(s,s+a[0].length)))return!1}if(e){var l=n+2,c;if(this.input.slice(n,l)==="of"&&(l===this.input.length||!_i(c=this.input.charCodeAt(l))&&!(c>55295&&c<56320)))return!1}var d=this.input.charCodeAt(n);return Oo(d,!0)||d===92};$t.isAwaitUsing=function(t){return this.isUsingKeyword(!0,t)};$t.isUsing=function(t){return this.isUsingKeyword(!1,t)};$t.parseStatement=function(t,e,r){var n=this.type,s=this.startNode(),i;switch(this.isLet(t)&&(n=W._var,i="let"),n){case W._break:case W._continue:return this.parseBreakContinueStatement(s,n.keyword);case W._debugger:return this.parseDebuggerStatement(s);case W._do:return this.parseDoStatement(s);case W._for:return this.parseForStatement(s);case W._function:return t&&(this.strict||t!=="if"&&t!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(s,!1,!t);case W._class:return t&&this.unexpected(),this.parseClass(s,!0);case W._if:return this.parseIfStatement(s);case W._return:return this.parseReturnStatement(s);case W._switch:return this.parseSwitchStatement(s);case W._throw:return this.parseThrowStatement(s);case W._try:return this.parseTryStatement(s);case W._const:case W._var:return i=i||this.value,t&&i!=="var"&&this.unexpected(),this.parseVarStatement(s,i);case W._while:return this.parseWhileStatement(s);case W._with:return this.parseWithStatement(s);case W.braceL:return this.parseBlock(!0,s);case W.semi:return this.parseEmptyStatement(s);case W._export:case W._import:if(this.options.ecmaVersion>10&&n===W._import){ns.lastIndex=this.pos;var a=ns.exec(this.input),l=this.pos+a[0].length,c=this.input.charCodeAt(l);if(c===40||c===46)return this.parseExpressionStatement(s,this.parseExpression())}return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),n===W._import?this.parseImport(s):this.parseExport(s,r);default:if(this.isAsyncFunction())return t&&this.unexpected(),this.next(),this.parseFunctionStatement(s,!0,!t);var d=this.isAwaitUsing(!1)?"await using":this.isUsing(!1)?"using":null;if(d)return e&&this.options.sourceType==="script"&&this.raise(this.start,"Using declaration cannot appear in the top level when source type is `script`"),d==="await using"&&(this.canAwait||this.raise(this.start,"Await using cannot appear outside of async function"),this.next()),this.next(),this.parseVar(s,!1,d),this.semicolon(),this.finishNode(s,"VariableDeclaration");var u=this.value,m=this.parseExpression();return n===W.name&&m.type==="Identifier"&&this.eat(W.colon)?this.parseLabeledStatement(s,u,m,t):this.parseExpressionStatement(s,m)}};$t.parseBreakContinueStatement=function(t,e){var r=e==="break";this.next(),this.eat(W.semi)||this.insertSemicolon()?t.label=null:this.type!==W.name?this.unexpected():(t.label=this.parseIdent(),this.semicolon());for(var n=0;n<this.labels.length;++n){var s=this.labels[n];if((t.label==null||s.name===t.label.name)&&(s.kind!=null&&(r||s.kind==="loop")||t.label&&r))break}return n===this.labels.length&&this.raise(t.start,"Unsyntactic "+e),this.finishNode(t,r?"BreakStatement":"ContinueStatement")};$t.parseDebuggerStatement=function(t){return this.next(),this.semicolon(),this.finishNode(t,"DebuggerStatement")};$t.parseDoStatement=function(t){return this.next(),this.labels.push(w0),t.body=this.parseStatement("do"),this.labels.pop(),this.expect(W._while),t.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(W.semi):this.semicolon(),this.finishNode(t,"DoWhileStatement")};$t.parseForStatement=function(t){this.next();var e=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(w0),this.enterScope(0),this.expect(W.parenL),this.type===W.semi)return e>-1&&this.unexpected(e),this.parseFor(t,null);var r=this.isLet();if(this.type===W._var||this.type===W._const||r){var n=this.startNode(),s=r?"let":this.value;return this.next(),this.parseVar(n,!0,s),this.finishNode(n,"VariableDeclaration"),this.parseForAfterInit(t,n,e)}var i=this.isContextual("let"),a=!1,l=this.isUsing(!0)?"using":this.isAwaitUsing(!0)?"await using":null;if(l){var c=this.startNode();return this.next(),l==="await using"&&this.next(),this.parseVar(c,!0,l),this.finishNode(c,"VariableDeclaration"),this.parseForAfterInit(t,c,e)}var d=this.containsEsc,u=new ch,m=this.start,g=e>-1?this.parseExprSubscripts(u,"await"):this.parseExpression(!0,u);return this.type===W._in||(a=this.options.ecmaVersion>=6&&this.isContextual("of"))?(e>-1?(this.type===W._in&&this.unexpected(e),t.await=!0):a&&this.options.ecmaVersion>=8&&(g.start===m&&!d&&g.type==="Identifier"&&g.name==="async"?this.unexpected():this.options.ecmaVersion>=9&&(t.await=!1)),i&&a&&this.raise(g.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(g,!1,u),this.checkLValPattern(g),this.parseForIn(t,g)):(this.checkExpressionErrors(u,!0),e>-1&&this.unexpected(e),this.parseFor(t,g))};$t.parseForAfterInit=function(t,e,r){return(this.type===W._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&e.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===W._in?r>-1&&this.unexpected(r):t.await=r>-1),this.parseForIn(t,e)):(r>-1&&this.unexpected(r),this.parseFor(t,e))};$t.parseFunctionStatement=function(t,e,r){return this.next(),this.parseFunction(t,lc|(r?0:Zp),!1,e)};$t.parseIfStatement=function(t){return this.next(),t.test=this.parseParenExpression(),t.consequent=this.parseStatement("if"),t.alternate=this.eat(W._else)?this.parseStatement("if"):null,this.finishNode(t,"IfStatement")};$t.parseReturnStatement=function(t){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(W.semi)||this.insertSemicolon()?t.argument=null:(t.argument=this.parseExpression(),this.semicolon()),this.finishNode(t,"ReturnStatement")};$t.parseSwitchStatement=function(t){this.next(),t.discriminant=this.parseParenExpression(),t.cases=[],this.expect(W.braceL),this.labels.push(vE),this.enterScope(0);for(var e,r=!1;this.type!==W.braceR;)if(this.type===W._case||this.type===W._default){var n=this.type===W._case;e&&this.finishNode(e,"SwitchCase"),t.cases.push(e=this.startNode()),e.consequent=[],this.next(),n?e.test=this.parseExpression():(r&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),r=!0,e.test=null),this.expect(W.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(null));return this.exitScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(t,"SwitchStatement")};$t.parseThrowStatement=function(t){return this.next(),Ts.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),t.argument=this.parseExpression(),this.semicolon(),this.finishNode(t,"ThrowStatement")};var bE=[];$t.parseCatchClauseParam=function(){var t=this.parseBindingAtom(),e=t.type==="Identifier";return this.enterScope(e?sS:0),this.checkLValPattern(t,e?aS:li),this.expect(W.parenR),t};$t.parseTryStatement=function(t){if(this.next(),t.block=this.parseBlock(),t.handler=null,this.type===W._catch){var e=this.startNode();this.next(),this.eat(W.parenL)?e.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterScope(0)),e.body=this.parseBlock(!1),this.exitScope(),t.handler=this.finishNode(e,"CatchClause")}return t.finalizer=this.eat(W._finally)?this.parseBlock():null,!t.handler&&!t.finalizer&&this.raise(t.start,"Missing catch or finally clause"),this.finishNode(t,"TryStatement")};$t.parseVarStatement=function(t,e,r){return this.next(),this.parseVar(t,!1,e,r),this.semicolon(),this.finishNode(t,"VariableDeclaration")};$t.parseWhileStatement=function(t){return this.next(),t.test=this.parseParenExpression(),this.labels.push(w0),t.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(t,"WhileStatement")};$t.parseWithStatement=function(t){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),t.object=this.parseParenExpression(),t.body=this.parseStatement("with"),this.finishNode(t,"WithStatement")};$t.parseEmptyStatement=function(t){return this.next(),this.finishNode(t,"EmptyStatement")};$t.parseLabeledStatement=function(t,e,r,n){for(var s=0,i=this.labels;s<i.length;s+=1){var a=i[s];a.name===e&&this.raise(r.start,"Label '"+e+"' is already declared")}for(var l=this.type.isLoop?"loop":this.type===W._switch?"switch":null,c=this.labels.length-1;c>=0;c--){var d=this.labels[c];if(d.statementStart===t.start)d.statementStart=this.start,d.kind=l;else break}return this.labels.push({name:e,kind:l,statementStart:this.start}),t.body=this.parseStatement(n?n.indexOf("label")===-1?n+"label":n:"label"),this.labels.pop(),t.label=r,this.finishNode(t,"LabeledStatement")};$t.parseExpressionStatement=function(t,e){return t.expression=e,this.semicolon(),this.finishNode(t,"ExpressionStatement")};$t.parseBlock=function(t,e,r){for(t===void 0&&(t=!0),e===void 0&&(e=this.startNode()),e.body=[],this.expect(W.braceL),t&&this.enterScope(0);this.type!==W.braceR;){var n=this.parseStatement(null);e.body.push(n)}return r&&(this.strict=!1),this.next(),t&&this.exitScope(),this.finishNode(e,"BlockStatement")};$t.parseFor=function(t,e){return t.init=e,this.expect(W.semi),t.test=this.type===W.semi?null:this.parseExpression(),this.expect(W.semi),t.update=this.type===W.parenR?null:this.parseExpression(),this.expect(W.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,"ForStatement")};$t.parseForIn=function(t,e){var r=this.type===W._in;return this.next(),e.type==="VariableDeclaration"&&e.declarations[0].init!=null&&(!r||this.options.ecmaVersion<8||this.strict||e.kind!=="var"||e.declarations[0].id.type!=="Identifier")&&this.raise(e.start,(r?"for-in":"for-of")+" loop variable declaration may not have an initializer"),t.left=e,t.right=r?this.parseExpression():this.parseMaybeAssign(),this.expect(W.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,r?"ForInStatement":"ForOfStatement")};$t.parseVar=function(t,e,r,n){for(t.declarations=[],t.kind=r;;){var s=this.startNode();if(this.parseVarId(s,r),this.eat(W.eq)?s.init=this.parseMaybeAssign(e):!n&&r==="const"&&!(this.type===W._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():!n&&(r==="using"||r==="await using")&&this.options.ecmaVersion>=17&&this.type!==W._in&&!this.isContextual("of")?this.raise(this.lastTokEnd,"Missing initializer in "+r+" declaration"):!n&&s.id.type!=="Identifier"&&!(e&&(this.type===W._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):s.init=null,t.declarations.push(this.finishNode(s,"VariableDeclarator")),!this.eat(W.comma))break}return t};$t.parseVarId=function(t,e){t.id=e==="using"||e==="await using"?this.parseIdent():this.parseBindingAtom(),this.checkLValPattern(t.id,e==="var"?S0:li,!1)};var lc=1,Zp=2,cS=4;$t.parseFunction=function(t,e,r,n,s){this.initFunction(t),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!n)&&(this.type===W.star&&e&Zp&&this.unexpected(),t.generator=this.eat(W.star)),this.options.ecmaVersion>=8&&(t.async=!!n),e&lc&&(t.id=e&cS&&this.type!==W.name?null:this.parseIdent(),t.id&&!(e&Zp)&&this.checkLValSimple(t.id,this.strict||t.generator||t.async?this.treatFunctionsAsVar?S0:li:iS));var i=this.yieldPos,a=this.awaitPos,l=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(b0(t.async,t.generator)),e&lc||(t.id=this.type===W.name?this.parseIdent():null),this.parseFunctionParams(t),this.parseFunctionBody(t,r,!1,s),this.yieldPos=i,this.awaitPos=a,this.awaitIdentPos=l,this.finishNode(t,e&lc?"FunctionDeclaration":"FunctionExpression")};$t.parseFunctionParams=function(t){this.expect(W.parenL),t.params=this.parseBindingList(W.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()};$t.parseClass=function(t,e){this.next();var r=this.strict;this.strict=!0,this.parseClassId(t,e),this.parseClassSuper(t);var n=this.enterClassBody(),s=this.startNode(),i=!1;for(s.body=[],this.expect(W.braceL);this.type!==W.braceR;){var a=this.parseClassElement(t.superClass!==null);a&&(s.body.push(a),a.type==="MethodDefinition"&&a.kind==="constructor"?(i&&this.raiseRecoverable(a.start,"Duplicate constructor in the same class"),i=!0):a.key&&a.key.type==="PrivateIdentifier"&&SE(n,a)&&this.raiseRecoverable(a.key.start,"Identifier '#"+a.key.name+"' has already been declared"))}return this.strict=r,this.next(),t.body=this.finishNode(s,"ClassBody"),this.exitClassBody(),this.finishNode(t,e?"ClassDeclaration":"ClassExpression")};$t.parseClassElement=function(t){if(this.eat(W.semi))return null;var e=this.options.ecmaVersion,r=this.startNode(),n="",s=!1,i=!1,a="method",l=!1;if(this.eatContextual("static")){if(e>=13&&this.eat(W.braceL))return this.parseClassStaticBlock(r),r;this.isClassElementNameStart()||this.type===W.star?l=!0:n="static"}if(r.static=l,!n&&e>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===W.star)&&!this.canInsertSemicolon()?i=!0:n="async"),!n&&(e>=9||!i)&&this.eat(W.star)&&(s=!0),!n&&!i&&!s){var c=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?a=c:n=c)}if(n?(r.computed=!1,r.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),r.key.name=n,this.finishNode(r.key,"Identifier")):this.parseClassElementName(r),e<13||this.type===W.parenL||a!=="method"||s||i){var d=!r.static&&Au(r,"constructor"),u=d&&t;d&&a!=="method"&&this.raise(r.key.start,"Constructor can't have get/set modifier"),r.kind=d?"constructor":a,this.parseClassMethod(r,s,i,u)}else this.parseClassField(r);return r};$t.isClassElementNameStart=function(){return this.type===W.name||this.type===W.privateId||this.type===W.num||this.type===W.string||this.type===W.bracketL||this.type.keyword};$t.parseClassElementName=function(t){this.type===W.privateId?(this.value==="constructor"&&this.raise(this.start,"Classes can't have an element named '#constructor'"),t.computed=!1,t.key=this.parsePrivateIdent()):this.parsePropertyName(t)};$t.parseClassMethod=function(t,e,r,n){var s=t.key;t.kind==="constructor"?(e&&this.raise(s.start,"Constructor can't be a generator"),r&&this.raise(s.start,"Constructor can't be an async method")):t.static&&Au(t,"prototype")&&this.raise(s.start,"Classes may not have a static property named prototype");var i=t.value=this.parseMethod(e,r,n);return t.kind==="get"&&i.params.length!==0&&this.raiseRecoverable(i.start,"getter should have no params"),t.kind==="set"&&i.params.length!==1&&this.raiseRecoverable(i.start,"setter should have exactly one param"),t.kind==="set"&&i.params[0].type==="RestElement"&&this.raiseRecoverable(i.params[0].start,"Setter cannot use rest params"),this.finishNode(t,"MethodDefinition")};$t.parseClassField=function(t){return Au(t,"constructor")?this.raise(t.key.start,"Classes can't have a field named 'constructor'"):t.static&&Au(t,"prototype")&&this.raise(t.key.start,"Classes can't have a static field named 'prototype'"),this.eat(W.eq)?(this.enterScope(Gc|ah),t.value=this.parseMaybeAssign(),this.exitScope()):t.value=null,this.semicolon(),this.finishNode(t,"PropertyDefinition")};$t.parseClassStaticBlock=function(t){t.body=[];var e=this.labels;for(this.labels=[],this.enterScope(Wa|ah);this.type!==W.braceR;){var r=this.parseStatement(null);t.body.push(r)}return this.next(),this.exitScope(),this.labels=e,this.finishNode(t,"StaticBlock")};$t.parseClassId=function(t,e){this.type===W.name?(t.id=this.parseIdent(),e&&this.checkLValSimple(t.id,li,!1)):(e===!0&&this.unexpected(),t.id=null)};$t.parseClassSuper=function(t){t.superClass=this.eat(W._extends)?this.parseExprSubscripts(null,!1):null};$t.enterClassBody=function(){var t={declared:Object.create(null),used:[]};return this.privateNameStack.push(t),t.declared};$t.exitClassBody=function(){var t=this.privateNameStack.pop(),e=t.declared,r=t.used;if(this.options.checkPrivateFields)for(var n=this.privateNameStack.length,s=n===0?null:this.privateNameStack[n-1],i=0;i<r.length;++i){var a=r[i];Dl(e,a.name)||(s?s.used.push(a):this.raiseRecoverable(a.start,"Private field '#"+a.name+"' must be declared in an enclosing class"))}};function SE(t,e){var r=e.key.name,n=t[r],s="true";return e.type==="MethodDefinition"&&(e.kind==="get"||e.kind==="set")&&(s=(e.static?"s":"i")+e.kind),n==="iget"&&s==="iset"||n==="iset"&&s==="iget"||n==="sget"&&s==="sset"||n==="sset"&&s==="sget"?(t[r]="true",!1):n?!0:(t[r]=s,!1)}function Au(t,e){var r=t.computed,n=t.key;return!r&&(n.type==="Identifier"&&n.name===e||n.type==="Literal"&&n.value===e)}$t.parseExportAllDeclaration=function(t,e){return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(t.exported=this.parseModuleExportName(),this.checkExport(e,t.exported,this.lastTokStart)):t.exported=null),this.expectContextual("from"),this.type!==W.string&&this.unexpected(),t.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(t.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(t,"ExportAllDeclaration")};$t.parseExport=function(t,e){if(this.next(),this.eat(W.star))return this.parseExportAllDeclaration(t,e);if(this.eat(W._default))return this.checkExport(e,"default",this.lastTokStart),t.declaration=this.parseExportDefaultDeclaration(),this.finishNode(t,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())t.declaration=this.parseExportDeclaration(t),t.declaration.type==="VariableDeclaration"?this.checkVariableExport(e,t.declaration.declarations):this.checkExport(e,t.declaration.id,t.declaration.id.start),t.specifiers=[],t.source=null,this.options.ecmaVersion>=16&&(t.attributes=[]);else{if(t.declaration=null,t.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==W.string&&this.unexpected(),t.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(t.attributes=this.parseWithClause());else{for(var r=0,n=t.specifiers;r<n.length;r+=1){var s=n[r];this.checkUnreserved(s.local),this.checkLocalExport(s.local),s.local.type==="Literal"&&this.raise(s.local.start,"A string literal cannot be used as an exported binding without `from`.")}t.source=null,this.options.ecmaVersion>=16&&(t.attributes=[])}this.semicolon()}return this.finishNode(t,"ExportNamedDeclaration")};$t.parseExportDeclaration=function(t){return this.parseStatement(null)};$t.parseExportDefaultDeclaration=function(){var t;if(this.type===W._function||(t=this.isAsyncFunction())){var e=this.startNode();return this.next(),t&&this.next(),this.parseFunction(e,lc|cS,!1,t)}else if(this.type===W._class){var r=this.startNode();return this.parseClass(r,"nullableID")}else{var n=this.parseMaybeAssign();return this.semicolon(),n}};$t.checkExport=function(t,e,r){t&&(typeof e!="string"&&(e=e.type==="Identifier"?e.name:e.value),Dl(t,e)&&this.raiseRecoverable(r,"Duplicate export '"+e+"'"),t[e]=!0)};$t.checkPatternExport=function(t,e){var r=e.type;if(r==="Identifier")this.checkExport(t,e,e.start);else if(r==="ObjectPattern")for(var n=0,s=e.properties;n<s.length;n+=1){var i=s[n];this.checkPatternExport(t,i)}else if(r==="ArrayPattern")for(var a=0,l=e.elements;a<l.length;a+=1){var c=l[a];c&&this.checkPatternExport(t,c)}else r==="Property"?this.checkPatternExport(t,e.value):r==="AssignmentPattern"?this.checkPatternExport(t,e.left):r==="RestElement"&&this.checkPatternExport(t,e.argument)};$t.checkVariableExport=function(t,e){if(t)for(var r=0,n=e;r<n.length;r+=1){var s=n[r];this.checkPatternExport(t,s.id)}};$t.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()};$t.parseExportSpecifier=function(t){var e=this.startNode();return e.local=this.parseModuleExportName(),e.exported=this.eatContextual("as")?this.parseModuleExportName():e.local,this.checkExport(t,e.exported,e.exported.start),this.finishNode(e,"ExportSpecifier")};$t.parseExportSpecifiers=function(t){var e=[],r=!0;for(this.expect(W.braceL);!this.eat(W.braceR);){if(r)r=!1;else if(this.expect(W.comma),this.afterTrailingComma(W.braceR))break;e.push(this.parseExportSpecifier(t))}return e};$t.parseImport=function(t){return this.next(),this.type===W.string?(t.specifiers=bE,t.source=this.parseExprAtom()):(t.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),t.source=this.type===W.string?this.parseExprAtom():this.unexpected()),this.options.ecmaVersion>=16&&(t.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(t,"ImportDeclaration")};$t.parseImportSpecifier=function(){var t=this.startNode();return t.imported=this.parseModuleExportName(),this.eatContextual("as")?t.local=this.parseIdent():(this.checkUnreserved(t.imported),t.local=t.imported),this.checkLValSimple(t.local,li),this.finishNode(t,"ImportSpecifier")};$t.parseImportDefaultSpecifier=function(){var t=this.startNode();return t.local=this.parseIdent(),this.checkLValSimple(t.local,li),this.finishNode(t,"ImportDefaultSpecifier")};$t.parseImportNamespaceSpecifier=function(){var t=this.startNode();return this.next(),this.expectContextual("as"),t.local=this.parseIdent(),this.checkLValSimple(t.local,li),this.finishNode(t,"ImportNamespaceSpecifier")};$t.parseImportSpecifiers=function(){var t=[],e=!0;if(this.type===W.name&&(t.push(this.parseImportDefaultSpecifier()),!this.eat(W.comma)))return t;if(this.type===W.star)return t.push(this.parseImportNamespaceSpecifier()),t;for(this.expect(W.braceL);!this.eat(W.braceR);){if(e)e=!1;else if(this.expect(W.comma),this.afterTrailingComma(W.braceR))break;t.push(this.parseImportSpecifier())}return t};$t.parseWithClause=function(){var t=[];if(!this.eat(W._with))return t;this.expect(W.braceL);for(var e={},r=!0;!this.eat(W.braceR);){if(r)r=!1;else if(this.expect(W.comma),this.afterTrailingComma(W.braceR))break;var n=this.parseImportAttribute(),s=n.key.type==="Identifier"?n.key.name:n.key.value;Dl(e,s)&&this.raiseRecoverable(n.key.start,"Duplicate attribute key '"+s+"'"),e[s]=!0,t.push(n)}return t};$t.parseImportAttribute=function(){var t=this.startNode();return t.key=this.type===W.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never"),this.expect(W.colon),this.type!==W.string&&this.unexpected(),t.value=this.parseExprAtom(),this.finishNode(t,"ImportAttribute")};$t.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===W.string){var t=this.parseLiteral(this.value);return fE.test(t.value)&&this.raise(t.start,"An export name cannot include a lone surrogate."),t}return this.parseIdent(!0)};$t.adaptDirectivePrologue=function(t){for(var e=0;e<t.length&&this.isDirectiveCandidate(t[e]);++e)t[e].directive=t[e].expression.raw.slice(1,-1)};$t.isDirectiveCandidate=function(t){return this.options.ecmaVersion>=5&&t.type==="ExpressionStatement"&&t.expression.type==="Literal"&&typeof t.expression.value=="string"&&(this.input[t.start]==='"'||this.input[t.start]==="'")};var ao=Ln.prototype;ao.toAssignable=function(t,e,r){if(this.options.ecmaVersion>=6&&t)switch(t.type){case"Identifier":this.inAsync&&t.name==="await"&&this.raise(t.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":t.type="ObjectPattern",r&&this.checkPatternErrors(r,!0);for(var n=0,s=t.properties;n<s.length;n+=1){var i=s[n];this.toAssignable(i,e),i.type==="RestElement"&&(i.argument.type==="ArrayPattern"||i.argument.type==="ObjectPattern")&&this.raise(i.argument.start,"Unexpected token")}break;case"Property":t.kind!=="init"&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,e);break;case"ArrayExpression":t.type="ArrayPattern",r&&this.checkPatternErrors(r,!0),this.toAssignableList(t.elements,e);break;case"SpreadElement":t.type="RestElement",this.toAssignable(t.argument,e),t.argument.type==="AssignmentPattern"&&this.raise(t.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":t.operator!=="="&&this.raise(t.left.end,"Only '=' operator can be used for specifying default value."),t.type="AssignmentPattern",delete t.operator,this.toAssignable(t.left,e);break;case"ParenthesizedExpression":this.toAssignable(t.expression,e,r);break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!e)break;default:this.raise(t.start,"Assigning to rvalue")}else r&&this.checkPatternErrors(r,!0);return t};ao.toAssignableList=function(t,e){for(var r=t.length,n=0;n<r;n++){var s=t[n];s&&this.toAssignable(s,e)}if(r){var i=t[r-1];this.options.ecmaVersion===6&&e&&i&&i.type==="RestElement"&&i.argument.type!=="Identifier"&&this.unexpected(i.argument.start)}return t};ao.parseSpread=function(t){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,t),this.finishNode(e,"SpreadElement")};ao.parseRestBinding=function(){var t=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==W.name&&this.unexpected(),t.argument=this.parseBindingAtom(),this.finishNode(t,"RestElement")};ao.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case W.bracketL:var t=this.startNode();return this.next(),t.elements=this.parseBindingList(W.bracketR,!0,!0),this.finishNode(t,"ArrayPattern");case W.braceL:return this.parseObj(!0)}return this.parseIdent()};ao.parseBindingList=function(t,e,r,n){for(var s=[],i=!0;!this.eat(t);)if(i?i=!1:this.expect(W.comma),e&&this.type===W.comma)s.push(null);else{if(r&&this.afterTrailingComma(t))break;if(this.type===W.ellipsis){var a=this.parseRestBinding();this.parseBindingListItem(a),s.push(a),this.type===W.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.expect(t);break}else s.push(this.parseAssignableListItem(n))}return s};ao.parseAssignableListItem=function(t){var e=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(e),e};ao.parseBindingListItem=function(t){return t};ao.parseMaybeDefault=function(t,e,r){if(r=r||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(W.eq))return r;var n=this.startNodeAt(t,e);return n.left=r,n.right=this.parseMaybeAssign(),this.finishNode(n,"AssignmentPattern")};ao.checkLValSimple=function(t,e,r){e===void 0&&(e=Mu);var n=e!==Mu;switch(t.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(t.name)&&this.raiseRecoverable(t.start,(n?"Binding ":"Assigning to ")+t.name+" in strict mode"),n&&(e===li&&t.name==="let"&&this.raiseRecoverable(t.start,"let is disallowed as a lexically bound name"),r&&(Dl(r,t.name)&&this.raiseRecoverable(t.start,"Argument name clash"),r[t.name]=!0),e!==lS&&this.declareName(t.name,e,t.start));break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":n&&this.raiseRecoverable(t.start,"Binding member expression");break;case"ParenthesizedExpression":return n&&this.raiseRecoverable(t.start,"Binding parenthesized expression"),this.checkLValSimple(t.expression,e,r);default:this.raise(t.start,(n?"Binding":"Assigning to")+" rvalue")}};ao.checkLValPattern=function(t,e,r){switch(e===void 0&&(e=Mu),t.type){case"ObjectPattern":for(var n=0,s=t.properties;n<s.length;n+=1){var i=s[n];this.checkLValInnerPattern(i,e,r)}break;case"ArrayPattern":for(var a=0,l=t.elements;a<l.length;a+=1){var c=l[a];c&&this.checkLValInnerPattern(c,e,r)}break;default:this.checkLValSimple(t,e,r)}};ao.checkLValInnerPattern=function(t,e,r){switch(e===void 0&&(e=Mu),t.type){case"Property":this.checkLValInnerPattern(t.value,e,r);break;case"AssignmentPattern":this.checkLValPattern(t.left,e,r);break;case"RestElement":this.checkLValPattern(t.argument,e,r);break;default:this.checkLValPattern(t,e,r)}};var lo=function(e,r,n,s,i){this.token=e,this.isExpr=!!r,this.preserveSpace=!!n,this.override=s,this.generator=!!i},fn={b_stat:new lo("{",!1),b_expr:new lo("{",!0),b_tmpl:new lo("${",!1),p_stat:new lo("(",!1),p_expr:new lo("(",!0),q_tmpl:new lo("`",!0,!0,function(t){return t.tryReadTemplateToken()}),f_stat:new lo("function",!1),f_expr:new lo("function",!0),f_expr_gen:new lo("function",!0,!1,null,!0),f_gen:new lo("function",!1,!1,null,!0)},Ol=Ln.prototype;Ol.initialContext=function(){return[fn.b_stat]};Ol.curContext=function(){return this.context[this.context.length-1]};Ol.braceIsBlock=function(t){var e=this.curContext();return e===fn.f_expr||e===fn.f_stat?!0:t===W.colon&&(e===fn.b_stat||e===fn.b_expr)?!e.isExpr:t===W._return||t===W.name&&this.exprAllowed?Ts.test(this.input.slice(this.lastTokEnd,this.start)):t===W._else||t===W.semi||t===W.eof||t===W.parenR||t===W.arrow?!0:t===W.braceL?e===fn.b_stat:t===W._var||t===W._const||t===W.name?!1:!this.exprAllowed};Ol.inGeneratorContext=function(){for(var t=this.context.length-1;t>=1;t--){var e=this.context[t];if(e.token==="function")return e.generator}return!1};Ol.updateContext=function(t){var e,r=this.type;r.keyword&&t===W.dot?this.exprAllowed=!1:(e=r.updateContext)?e.call(this,t):this.exprAllowed=r.beforeExpr};Ol.overrideContext=function(t){this.curContext()!==t&&(this.context[this.context.length-1]=t)};W.parenR.updateContext=W.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var t=this.context.pop();t===fn.b_stat&&this.curContext().token==="function"&&(t=this.context.pop()),this.exprAllowed=!t.isExpr};W.braceL.updateContext=function(t){this.context.push(this.braceIsBlock(t)?fn.b_stat:fn.b_expr),this.exprAllowed=!0};W.dollarBraceL.updateContext=function(){this.context.push(fn.b_tmpl),this.exprAllowed=!0};W.parenL.updateContext=function(t){var e=t===W._if||t===W._for||t===W._with||t===W._while;this.context.push(e?fn.p_stat:fn.p_expr),this.exprAllowed=!0};W.incDec.updateContext=function(){};W._function.updateContext=W._class.updateContext=function(t){t.beforeExpr&&t!==W._else&&!(t===W.semi&&this.curContext()!==fn.p_stat)&&!(t===W._return&&Ts.test(this.input.slice(this.lastTokEnd,this.start)))&&!((t===W.colon||t===W.braceL)&&this.curContext()===fn.b_stat)?this.context.push(fn.f_expr):this.context.push(fn.f_stat),this.exprAllowed=!1};W.colon.updateContext=function(){this.curContext().token==="function"&&this.context.pop(),this.exprAllowed=!0};W.backQuote.updateContext=function(){this.curContext()===fn.q_tmpl?this.context.pop():this.context.push(fn.q_tmpl),this.exprAllowed=!1};W.star.updateContext=function(t){if(t===W._function){var e=this.context.length-1;this.context[e]===fn.f_expr?this.context[e]=fn.f_expr_gen:this.context[e]=fn.f_gen}this.exprAllowed=!0};W.name.updateContext=function(t){var e=!1;this.options.ecmaVersion>=6&&t!==W.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var mr=Ln.prototype;mr.checkPropClash=function(t,e,r){if(!(this.options.ecmaVersion>=9&&t.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(t.computed||t.method||t.shorthand))){var n=t.key,s;switch(n.type){case"Identifier":s=n.name;break;case"Literal":s=String(n.value);break;default:return}var i=t.kind;if(this.options.ecmaVersion>=6){s==="__proto__"&&i==="init"&&(e.proto&&(r?r.doubleProto<0&&(r.doubleProto=n.start):this.raiseRecoverable(n.start,"Redefinition of __proto__ property")),e.proto=!0);return}s="$"+s;var a=e[s];if(a){var l;i==="init"?l=this.strict&&a.init||a.get||a.set:l=a.init||a[i],l&&this.raiseRecoverable(n.start,"Redefinition of property")}else a=e[s]={init:!1,get:!1,set:!1};a[i]=!0}};mr.parseExpression=function(t,e){var r=this.start,n=this.startLoc,s=this.parseMaybeAssign(t,e);if(this.type===W.comma){var i=this.startNodeAt(r,n);for(i.expressions=[s];this.eat(W.comma);)i.expressions.push(this.parseMaybeAssign(t,e));return this.finishNode(i,"SequenceExpression")}return s};mr.parseMaybeAssign=function(t,e,r){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(t);this.exprAllowed=!1}var n=!1,s=-1,i=-1,a=-1;e?(s=e.parenthesizedAssign,i=e.trailingComma,a=e.doubleProto,e.parenthesizedAssign=e.trailingComma=-1):(e=new ch,n=!0);var l=this.start,c=this.startLoc;(this.type===W.parenL||this.type===W.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=t==="await");var d=this.parseMaybeConditional(t,e);if(r&&(d=r.call(this,d,l,c)),this.type.isAssign){var u=this.startNodeAt(l,c);return u.operator=this.value,this.type===W.eq&&(d=this.toAssignable(d,!1,e)),n||(e.parenthesizedAssign=e.trailingComma=e.doubleProto=-1),e.shorthandAssign>=d.start&&(e.shorthandAssign=-1),this.type===W.eq?this.checkLValPattern(d):this.checkLValSimple(d),u.left=d,this.next(),u.right=this.parseMaybeAssign(t),a>-1&&(e.doubleProto=a),this.finishNode(u,"AssignmentExpression")}else n&&this.checkExpressionErrors(e,!0);return s>-1&&(e.parenthesizedAssign=s),i>-1&&(e.trailingComma=i),d};mr.parseMaybeConditional=function(t,e){var r=this.start,n=this.startLoc,s=this.parseExprOps(t,e);if(this.checkExpressionErrors(e))return s;if(this.eat(W.question)){var i=this.startNodeAt(r,n);return i.test=s,i.consequent=this.parseMaybeAssign(),this.expect(W.colon),i.alternate=this.parseMaybeAssign(t),this.finishNode(i,"ConditionalExpression")}return s};mr.parseExprOps=function(t,e){var r=this.start,n=this.startLoc,s=this.parseMaybeUnary(e,!1,!1,t);return this.checkExpressionErrors(e)||s.start===r&&s.type==="ArrowFunctionExpression"?s:this.parseExprOp(s,r,n,-1,t)};mr.parseExprOp=function(t,e,r,n,s){var i=this.type.binop;if(i!=null&&(!s||this.type!==W._in)&&i>n){var a=this.type===W.logicalOR||this.type===W.logicalAND,l=this.type===W.coalesce;l&&(i=W.logicalAND.binop);var c=this.value;this.next();var d=this.start,u=this.startLoc,m=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,s),d,u,i,s),g=this.buildBinary(e,r,t,m,c,a||l);return(a&&this.type===W.coalesce||l&&(this.type===W.logicalOR||this.type===W.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(g,e,r,n,s)}return t};mr.buildBinary=function(t,e,r,n,s,i){n.type==="PrivateIdentifier"&&this.raise(n.start,"Private identifier can only be left side of binary expression");var a=this.startNodeAt(t,e);return a.left=r,a.operator=s,a.right=n,this.finishNode(a,i?"LogicalExpression":"BinaryExpression")};mr.parseMaybeUnary=function(t,e,r,n){var s=this.start,i=this.startLoc,a;if(this.isContextual("await")&&this.canAwait)a=this.parseAwait(n),e=!0;else if(this.type.prefix){var l=this.startNode(),c=this.type===W.incDec;l.operator=this.value,l.prefix=!0,this.next(),l.argument=this.parseMaybeUnary(null,!0,c,n),this.checkExpressionErrors(t,!0),c?this.checkLValSimple(l.argument):this.strict&&l.operator==="delete"&&dS(l.argument)?this.raiseRecoverable(l.start,"Deleting local variable in strict mode"):l.operator==="delete"&&Xp(l.argument)?this.raiseRecoverable(l.start,"Private fields can not be deleted"):e=!0,a=this.finishNode(l,c?"UpdateExpression":"UnaryExpression")}else if(!e&&this.type===W.privateId)(n||this.privateNameStack.length===0)&&this.options.checkPrivateFields&&this.unexpected(),a=this.parsePrivateIdent(),this.type!==W._in&&this.unexpected();else{if(a=this.parseExprSubscripts(t,n),this.checkExpressionErrors(t))return a;for(;this.type.postfix&&!this.canInsertSemicolon();){var d=this.startNodeAt(s,i);d.operator=this.value,d.prefix=!1,d.argument=a,this.checkLValSimple(a),this.next(),a=this.finishNode(d,"UpdateExpression")}}if(!r&&this.eat(W.starstar))if(e)this.unexpected(this.lastTokStart);else return this.buildBinary(s,i,a,this.parseMaybeUnary(null,!1,!1,n),"**",!1);else return a};function dS(t){return t.type==="Identifier"||t.type==="ParenthesizedExpression"&&dS(t.expression)}function Xp(t){return t.type==="MemberExpression"&&t.property.type==="PrivateIdentifier"||t.type==="ChainExpression"&&Xp(t.expression)||t.type==="ParenthesizedExpression"&&Xp(t.expression)}mr.parseExprSubscripts=function(t,e){var r=this.start,n=this.startLoc,s=this.parseExprAtom(t,e);if(s.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return s;var i=this.parseSubscripts(s,r,n,!1,e);return t&&i.type==="MemberExpression"&&(t.parenthesizedAssign>=i.start&&(t.parenthesizedAssign=-1),t.parenthesizedBind>=i.start&&(t.parenthesizedBind=-1),t.trailingComma>=i.start&&(t.trailingComma=-1)),i};mr.parseSubscripts=function(t,e,r,n,s){for(var i=this.options.ecmaVersion>=8&&t.type==="Identifier"&&t.name==="async"&&this.lastTokEnd===t.end&&!this.canInsertSemicolon()&&t.end-t.start===5&&this.potentialArrowAt===t.start,a=!1;;){var l=this.parseSubscript(t,e,r,n,i,a,s);if(l.optional&&(a=!0),l===t||l.type==="ArrowFunctionExpression"){if(a){var c=this.startNodeAt(e,r);c.expression=l,l=this.finishNode(c,"ChainExpression")}return l}t=l}};mr.shouldParseAsyncArrow=function(){return!this.canInsertSemicolon()&&this.eat(W.arrow)};mr.parseSubscriptAsyncArrow=function(t,e,r,n){return this.parseArrowExpression(this.startNodeAt(t,e),r,!0,n)};mr.parseSubscript=function(t,e,r,n,s,i,a){var l=this.options.ecmaVersion>=11,c=l&&this.eat(W.questionDot);n&&c&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var d=this.eat(W.bracketL);if(d||c&&this.type!==W.parenL&&this.type!==W.backQuote||this.eat(W.dot)){var u=this.startNodeAt(e,r);u.object=t,d?(u.property=this.parseExpression(),this.expect(W.bracketR)):this.type===W.privateId&&t.type!=="Super"?u.property=this.parsePrivateIdent():u.property=this.parseIdent(this.options.allowReserved!=="never"),u.computed=!!d,l&&(u.optional=c),t=this.finishNode(u,"MemberExpression")}else if(!n&&this.eat(W.parenL)){var m=new ch,g=this.yieldPos,y=this.awaitPos,v=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var I=this.parseExprList(W.parenR,this.options.ecmaVersion>=8,!1,m);if(s&&!c&&this.shouldParseAsyncArrow())return this.checkPatternErrors(m,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=g,this.awaitPos=y,this.awaitIdentPos=v,this.parseSubscriptAsyncArrow(e,r,I,a);this.checkExpressionErrors(m,!0),this.yieldPos=g||this.yieldPos,this.awaitPos=y||this.awaitPos,this.awaitIdentPos=v||this.awaitIdentPos;var S=this.startNodeAt(e,r);S.callee=t,S.arguments=I,l&&(S.optional=c),t=this.finishNode(S,"CallExpression")}else if(this.type===W.backQuote){(c||i)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var b=this.startNodeAt(e,r);b.tag=t,b.quasi=this.parseTemplate({isTagged:!0}),t=this.finishNode(b,"TaggedTemplateExpression")}return t};mr.parseExprAtom=function(t,e,r){this.type===W.slash&&this.readRegexp();var n,s=this.potentialArrowAt===this.start;switch(this.type){case W._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),n=this.startNode(),this.next(),this.type===W.parenL&&!this.allowDirectSuper&&this.raise(n.start,"super() call outside constructor of a subclass"),this.type!==W.dot&&this.type!==W.bracketL&&this.type!==W.parenL&&this.unexpected(),this.finishNode(n,"Super");case W._this:return n=this.startNode(),this.next(),this.finishNode(n,"ThisExpression");case W.name:var i=this.start,a=this.startLoc,l=this.containsEsc,c=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!l&&c.name==="async"&&!this.canInsertSemicolon()&&this.eat(W._function))return this.overrideContext(fn.f_expr),this.parseFunction(this.startNodeAt(i,a),0,!1,!0,e);if(s&&!this.canInsertSemicolon()){if(this.eat(W.arrow))return this.parseArrowExpression(this.startNodeAt(i,a),[c],!1,e);if(this.options.ecmaVersion>=8&&c.name==="async"&&this.type===W.name&&!l&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return c=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(W.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(i,a),[c],!0,e)}return c;case W.regexp:var d=this.value;return n=this.parseLiteral(d.value),n.regex={pattern:d.pattern,flags:d.flags},n;case W.num:case W.string:return this.parseLiteral(this.value);case W._null:case W._true:case W._false:return n=this.startNode(),n.value=this.type===W._null?null:this.type===W._true,n.raw=this.type.keyword,this.next(),this.finishNode(n,"Literal");case W.parenL:var u=this.start,m=this.parseParenAndDistinguishExpression(s,e);return t&&(t.parenthesizedAssign<0&&!this.isSimpleAssignTarget(m)&&(t.parenthesizedAssign=u),t.parenthesizedBind<0&&(t.parenthesizedBind=u)),m;case W.bracketL:return n=this.startNode(),this.next(),n.elements=this.parseExprList(W.bracketR,!0,!0,t),this.finishNode(n,"ArrayExpression");case W.braceL:return this.overrideContext(fn.b_expr),this.parseObj(!1,t);case W._function:return n=this.startNode(),this.next(),this.parseFunction(n,0);case W._class:return this.parseClass(this.startNode(),!1);case W._new:return this.parseNew();case W.backQuote:return this.parseTemplate();case W._import:return this.options.ecmaVersion>=11?this.parseExprImport(r):this.unexpected();default:return this.parseExprAtomDefault()}};mr.parseExprAtomDefault=function(){this.unexpected()};mr.parseExprImport=function(t){var e=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),this.next(),this.type===W.parenL&&!t)return this.parseDynamicImport(e);if(this.type===W.dot){var r=this.startNodeAt(e.start,e.loc&&e.loc.start);return r.name="import",e.meta=this.finishNode(r,"Identifier"),this.parseImportMeta(e)}else this.unexpected()};mr.parseDynamicImport=function(t){if(this.next(),t.source=this.parseMaybeAssign(),this.options.ecmaVersion>=16)this.eat(W.parenR)?t.options=null:(this.expect(W.comma),this.afterTrailingComma(W.parenR)?t.options=null:(t.options=this.parseMaybeAssign(),this.eat(W.parenR)||(this.expect(W.comma),this.afterTrailingComma(W.parenR)||this.unexpected())));else if(!this.eat(W.parenR)){var e=this.start;this.eat(W.comma)&&this.eat(W.parenR)?this.raiseRecoverable(e,"Trailing comma is not allowed in import()"):this.unexpected(e)}return this.finishNode(t,"ImportExpression")};mr.parseImportMeta=function(t){this.next();var e=this.containsEsc;return t.property=this.parseIdent(!0),t.property.name!=="meta"&&this.raiseRecoverable(t.property.start,"The only valid meta property for import is 'import.meta'"),e&&this.raiseRecoverable(t.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(t.start,"Cannot use 'import.meta' outside a module"),this.finishNode(t,"MetaProperty")};mr.parseLiteral=function(t){var e=this.startNode();return e.value=t,e.raw=this.input.slice(this.start,this.end),e.raw.charCodeAt(e.raw.length-1)===110&&(e.bigint=e.value!=null?e.value.toString():e.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(e,"Literal")};mr.parseParenExpression=function(){this.expect(W.parenL);var t=this.parseExpression();return this.expect(W.parenR),t};mr.shouldParseArrow=function(t){return!this.canInsertSemicolon()};mr.parseParenAndDistinguishExpression=function(t,e){var r=this.start,n=this.startLoc,s,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a=this.start,l=this.startLoc,c=[],d=!0,u=!1,m=new ch,g=this.yieldPos,y=this.awaitPos,v;for(this.yieldPos=0,this.awaitPos=0;this.type!==W.parenR;)if(d?d=!1:this.expect(W.comma),i&&this.afterTrailingComma(W.parenR,!0)){u=!0;break}else if(this.type===W.ellipsis){v=this.start,c.push(this.parseParenItem(this.parseRestBinding())),this.type===W.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element");break}else c.push(this.parseMaybeAssign(!1,m,this.parseParenItem));var I=this.lastTokEnd,S=this.lastTokEndLoc;if(this.expect(W.parenR),t&&this.shouldParseArrow(c)&&this.eat(W.arrow))return this.checkPatternErrors(m,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=g,this.awaitPos=y,this.parseParenArrowList(r,n,c,e);(!c.length||u)&&this.unexpected(this.lastTokStart),v&&this.unexpected(v),this.checkExpressionErrors(m,!0),this.yieldPos=g||this.yieldPos,this.awaitPos=y||this.awaitPos,c.length>1?(s=this.startNodeAt(a,l),s.expressions=c,this.finishNodeAt(s,"SequenceExpression",I,S)):s=c[0]}else s=this.parseParenExpression();if(this.options.preserveParens){var b=this.startNodeAt(r,n);return b.expression=s,this.finishNode(b,"ParenthesizedExpression")}else return s};mr.parseParenItem=function(t){return t};mr.parseParenArrowList=function(t,e,r,n){return this.parseArrowExpression(this.startNodeAt(t,e),r,!1,n)};var wE=[];mr.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var t=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===W.dot){var e=this.startNodeAt(t.start,t.loc&&t.loc.start);e.name="new",t.meta=this.finishNode(e,"Identifier"),this.next();var r=this.containsEsc;return t.property=this.parseIdent(!0),t.property.name!=="target"&&this.raiseRecoverable(t.property.start,"The only valid meta property for new is 'new.target'"),r&&this.raiseRecoverable(t.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(t.start,"'new.target' can only be used in functions and class static block"),this.finishNode(t,"MetaProperty")}var n=this.start,s=this.startLoc;return t.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),n,s,!0,!1),this.eat(W.parenL)?t.arguments=this.parseExprList(W.parenR,this.options.ecmaVersion>=8,!1):t.arguments=wE,this.finishNode(t,"NewExpression")};mr.parseTemplateElement=function(t){var e=t.isTagged,r=this.startNode();return this.type===W.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),r.value={raw:this.value.replace(/\r\n?/g,`
`),cooked:null}):r.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),r.tail=this.type===W.backQuote,this.finishNode(r,"TemplateElement")};mr.parseTemplate=function(t){t===void 0&&(t={});var e=t.isTagged;e===void 0&&(e=!1);var r=this.startNode();this.next(),r.expressions=[];var n=this.parseTemplateElement({isTagged:e});for(r.quasis=[n];!n.tail;)this.type===W.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(W.dollarBraceL),r.expressions.push(this.parseExpression()),this.expect(W.braceR),r.quasis.push(n=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(r,"TemplateLiteral")};mr.isAsyncProp=function(t){return!t.computed&&t.key.type==="Identifier"&&t.key.name==="async"&&(this.type===W.name||this.type===W.num||this.type===W.string||this.type===W.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===W.star)&&!Ts.test(this.input.slice(this.lastTokEnd,this.start))};mr.parseObj=function(t,e){var r=this.startNode(),n=!0,s={};for(r.properties=[],this.next();!this.eat(W.braceR);){if(n)n=!1;else if(this.expect(W.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(W.braceR))break;var i=this.parseProperty(t,e);t||this.checkPropClash(i,s,e),r.properties.push(i)}return this.finishNode(r,t?"ObjectPattern":"ObjectExpression")};mr.parseProperty=function(t,e){var r=this.startNode(),n,s,i,a;if(this.options.ecmaVersion>=9&&this.eat(W.ellipsis))return t?(r.argument=this.parseIdent(!1),this.type===W.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.finishNode(r,"RestElement")):(r.argument=this.parseMaybeAssign(!1,e),this.type===W.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(r,"SpreadElement"));this.options.ecmaVersion>=6&&(r.method=!1,r.shorthand=!1,(t||e)&&(i=this.start,a=this.startLoc),t||(n=this.eat(W.star)));var l=this.containsEsc;return this.parsePropertyName(r),!t&&!l&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(r)?(s=!0,n=this.options.ecmaVersion>=9&&this.eat(W.star),this.parsePropertyName(r)):s=!1,this.parsePropertyValue(r,t,n,s,i,a,e,l),this.finishNode(r,"Property")};mr.parseGetterSetter=function(t){var e=t.key.name;this.parsePropertyName(t),t.value=this.parseMethod(!1),t.kind=e;var r=t.kind==="get"?0:1;if(t.value.params.length!==r){var n=t.value.start;t.kind==="get"?this.raiseRecoverable(n,"getter should have no params"):this.raiseRecoverable(n,"setter should have exactly one param")}else t.kind==="set"&&t.value.params[0].type==="RestElement"&&this.raiseRecoverable(t.value.params[0].start,"Setter cannot use rest params")};mr.parsePropertyValue=function(t,e,r,n,s,i,a,l){(r||n)&&this.type===W.colon&&this.unexpected(),this.eat(W.colon)?(t.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),t.kind="init"):this.options.ecmaVersion>=6&&this.type===W.parenL?(e&&this.unexpected(),t.method=!0,t.value=this.parseMethod(r,n),t.kind="init"):!e&&!l&&this.options.ecmaVersion>=5&&!t.computed&&t.key.type==="Identifier"&&(t.key.name==="get"||t.key.name==="set")&&this.type!==W.comma&&this.type!==W.braceR&&this.type!==W.eq?((r||n)&&this.unexpected(),this.parseGetterSetter(t)):this.options.ecmaVersion>=6&&!t.computed&&t.key.type==="Identifier"?((r||n)&&this.unexpected(),this.checkUnreserved(t.key),t.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=s),e?t.value=this.parseMaybeDefault(s,i,this.copyNode(t.key)):this.type===W.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),t.value=this.parseMaybeDefault(s,i,this.copyNode(t.key))):t.value=this.copyNode(t.key),t.kind="init",t.shorthand=!0):this.unexpected()};mr.parsePropertyName=function(t){if(this.options.ecmaVersion>=6){if(this.eat(W.bracketL))return t.computed=!0,t.key=this.parseMaybeAssign(),this.expect(W.bracketR),t.key;t.computed=!1}return t.key=this.type===W.num||this.type===W.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")};mr.initFunction=function(t){t.id=null,this.options.ecmaVersion>=6&&(t.generator=t.expression=!1),this.options.ecmaVersion>=8&&(t.async=!1)};mr.parseMethod=function(t,e,r){var n=this.startNode(),s=this.yieldPos,i=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=t),this.options.ecmaVersion>=8&&(n.async=!!e),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(b0(e,n.generator)|ah|(r?oS:0)),this.expect(W.parenL),n.params=this.parseBindingList(W.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(n,!1,!0,!1),this.yieldPos=s,this.awaitPos=i,this.awaitIdentPos=a,this.finishNode(n,"FunctionExpression")};mr.parseArrowExpression=function(t,e,r,n){var s=this.yieldPos,i=this.awaitPos,a=this.awaitIdentPos;return this.enterScope(b0(r,!1)|v0),this.initFunction(t),this.options.ecmaVersion>=8&&(t.async=!!r),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,t.params=this.toAssignableList(e,!0),this.parseFunctionBody(t,!0,!1,n),this.yieldPos=s,this.awaitPos=i,this.awaitIdentPos=a,this.finishNode(t,"ArrowFunctionExpression")};mr.parseFunctionBody=function(t,e,r,n){var s=e&&this.type!==W.braceL,i=this.strict,a=!1;if(s)t.body=this.parseMaybeAssign(n),t.expression=!0,this.checkParams(t,!1);else{var l=this.options.ecmaVersion>=7&&!this.isSimpleParamList(t.params);(!i||l)&&(a=this.strictDirective(this.end),a&&l&&this.raiseRecoverable(t.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var c=this.labels;this.labels=[],a&&(this.strict=!0),this.checkParams(t,!i&&!a&&!e&&!r&&this.isSimpleParamList(t.params)),this.strict&&t.id&&this.checkLValSimple(t.id,lS),t.body=this.parseBlock(!1,void 0,a&&!i),t.expression=!1,this.adaptDirectivePrologue(t.body.body),this.labels=c}this.exitScope()};mr.isSimpleParamList=function(t){for(var e=0,r=t;e<r.length;e+=1){var n=r[e];if(n.type!=="Identifier")return!1}return!0};mr.checkParams=function(t,e){for(var r=Object.create(null),n=0,s=t.params;n<s.length;n+=1){var i=s[n];this.checkLValInnerPattern(i,S0,e?null:r)}};mr.parseExprList=function(t,e,r,n){for(var s=[],i=!0;!this.eat(t);){if(i)i=!1;else if(this.expect(W.comma),e&&this.afterTrailingComma(t))break;var a=void 0;r&&this.type===W.comma?a=null:this.type===W.ellipsis?(a=this.parseSpread(n),n&&this.type===W.comma&&n.trailingComma<0&&(n.trailingComma=this.start)):a=this.parseMaybeAssign(!1,n),s.push(a)}return s};mr.checkUnreserved=function(t){var e=t.start,r=t.end,n=t.name;if(this.inGenerator&&n==="yield"&&this.raiseRecoverable(e,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&n==="await"&&this.raiseRecoverable(e,"Cannot use 'await' as identifier inside an async function"),!(this.currentThisScope().flags&lh)&&n==="arguments"&&this.raiseRecoverable(e,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(n==="arguments"||n==="await")&&this.raise(e,"Cannot use "+n+" in class static initialization block"),this.keywords.test(n)&&this.raise(e,"Unexpected keyword '"+n+"'"),!(this.options.ecmaVersion<6&&this.input.slice(e,r).indexOf("\\")!==-1)){var s=this.strict?this.reservedWordsStrict:this.reservedWords;s.test(n)&&(!this.inAsync&&n==="await"&&this.raiseRecoverable(e,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+n+"' is reserved"))}};mr.parseIdent=function(t){var e=this.parseIdentNode();return this.next(!!t),this.finishNode(e,"Identifier"),t||(this.checkUnreserved(e),e.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=e.start)),e};mr.parseIdentNode=function(){var t=this.startNode();return this.type===W.name?t.name=this.value:this.type.keyword?(t.name=this.type.keyword,(t.name==="class"||t.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop(),this.type=W.name):this.unexpected(),t};mr.parsePrivateIdent=function(){var t=this.startNode();return this.type===W.privateId?t.name=this.value:this.unexpected(),this.next(),this.finishNode(t,"PrivateIdentifier"),this.options.checkPrivateFields&&(this.privateNameStack.length===0?this.raise(t.start,"Private field '#"+t.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(t)),t};mr.parseYield=function(t){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type===W.semi||this.canInsertSemicolon()||this.type!==W.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(W.star),e.argument=this.parseMaybeAssign(t)),this.finishNode(e,"YieldExpression")};mr.parseAwait=function(t){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0,!1,t),this.finishNode(e,"AwaitExpression")};var Pu=Ln.prototype;Pu.raise=function(t,e){var r=rS(this.input,t);e+=" ("+r.line+":"+r.column+")",this.sourceFile&&(e+=" in "+this.sourceFile);var n=new SyntaxError(e);throw n.pos=t,n.loc=r,n.raisedAt=this.pos,n};Pu.raiseRecoverable=Pu.raise;Pu.curPosition=function(){if(this.options.locations)return new Ec(this.curLine,this.pos-this.lineStart)};var Bi=Ln.prototype,CE=function(e){this.flags=e,this.var=[],this.lexical=[],this.functions=[]};Bi.enterScope=function(t){this.scopeStack.push(new CE(t))};Bi.exitScope=function(){this.scopeStack.pop()};Bi.treatFunctionsAsVarInScope=function(t){return t.flags&Rl||!this.inModule&&t.flags&Mc};Bi.declareName=function(t,e,r){var n=!1;if(e===li){var s=this.currentScope();n=s.lexical.indexOf(t)>-1||s.functions.indexOf(t)>-1||s.var.indexOf(t)>-1,s.lexical.push(t),this.inModule&&s.flags&Mc&&delete this.undefinedExports[t]}else if(e===aS){var i=this.currentScope();i.lexical.push(t)}else if(e===iS){var a=this.currentScope();this.treatFunctionsAsVar?n=a.lexical.indexOf(t)>-1:n=a.lexical.indexOf(t)>-1||a.var.indexOf(t)>-1,a.functions.push(t)}else for(var l=this.scopeStack.length-1;l>=0;--l){var c=this.scopeStack[l];if(c.lexical.indexOf(t)>-1&&!(c.flags&sS&&c.lexical[0]===t)||!this.treatFunctionsAsVarInScope(c)&&c.functions.indexOf(t)>-1){n=!0;break}if(c.var.push(t),this.inModule&&c.flags&Mc&&delete this.undefinedExports[t],c.flags&lh)break}n&&this.raiseRecoverable(r,"Identifier '"+t+"' has already been declared")};Bi.checkLocalExport=function(t){this.scopeStack[0].lexical.indexOf(t.name)===-1&&this.scopeStack[0].var.indexOf(t.name)===-1&&(this.undefinedExports[t.name]=t)};Bi.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]};Bi.currentVarScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(e.flags&(lh|Gc|Wa))return e}};Bi.currentThisScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(e.flags&(lh|Gc|Wa)&&!(e.flags&v0))return e}};var dh=function(e,r,n){this.type="",this.start=r,this.end=0,e.options.locations&&(this.loc=new ih(e,n)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[r,0])},Hc=Ln.prototype;Hc.startNode=function(){return new dh(this,this.start,this.startLoc)};Hc.startNodeAt=function(t,e){return new dh(this,t,e)};function uS(t,e,r,n){return t.type=e,t.end=r,this.options.locations&&(t.loc.end=n),this.options.ranges&&(t.range[1]=r),t}Hc.finishNode=function(t,e){return uS.call(this,t,e,this.lastTokEnd,this.lastTokEndLoc)};Hc.finishNodeAt=function(t,e,r,n){return uS.call(this,t,e,r,n)};Hc.copyNode=function(t){var e=new dh(this,t.start,this.startLoc);for(var r in t)e[r]=t[r];return e};var kE="Gara Garay Gukh Gurung_Khema Hrkt Katakana_Or_Hiragana Kawi Kirat_Rai Krai Nag_Mundari Nagm Ol_Onal Onao Sunu Sunuwar Todhri Todr Tulu_Tigalari Tutg Unknown Zzzz",hS="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",mS=hS+" Extended_Pictographic",pS=mS,fS=pS+" EBase EComp EMod EPres ExtPict",gS=fS,IE=gS,jE={9:hS,10:mS,11:pS,12:fS,13:gS,14:IE},TE="Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji",EE={9:"",10:"",11:"",12:"",13:"",14:TE},Ix="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",yS="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",xS=yS+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",vS=xS+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",bS=vS+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",SS=bS+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",ME=SS+" "+kE,AE={9:yS,10:xS,11:vS,12:bS,13:SS,14:ME},wS={};function PE(t){var e=wS[t]={binary:bi(jE[t]+" "+Ix),binaryOfStrings:bi(EE[t]),nonBinary:{General_Category:bi(Ix),Script:bi(AE[t])}};e.nonBinary.Script_Extensions=e.nonBinary.Script,e.nonBinary.gc=e.nonBinary.General_Category,e.nonBinary.sc=e.nonBinary.Script,e.nonBinary.scx=e.nonBinary.Script_Extensions}for(var ym=0,jx=[9,10,11,12,13,14];ym<jx.length;ym+=1){var NE=jx[ym];PE(NE)}var Ft=Ln.prototype,Nu=function(e,r){this.parent=e,this.base=r||this};Nu.prototype.separatedFrom=function(e){for(var r=this;r;r=r.parent)for(var n=e;n;n=n.parent)if(r.base===n.base&&r!==n)return!0;return!1};Nu.prototype.sibling=function(){return new Nu(this.parent,this.base)};var Vo=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":"")+(e.options.ecmaVersion>=13?"d":"")+(e.options.ecmaVersion>=15?"v":""),this.unicodeProperties=wS[e.options.ecmaVersion>=14?14:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=Object.create(null),this.backReferenceNames=[],this.branchID=null};Vo.prototype.reset=function(e,r,n){var s=n.indexOf("v")!==-1,i=n.indexOf("u")!==-1;this.start=e|0,this.source=r+"",this.flags=n,s&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=i&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=i&&this.parser.options.ecmaVersion>=9)};Vo.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)};Vo.prototype.at=function(e,r){r===void 0&&(r=!1);var n=this.source,s=n.length;if(e>=s)return-1;var i=n.charCodeAt(e);if(!(r||this.switchU)||i<=55295||i>=57344||e+1>=s)return i;var a=n.charCodeAt(e+1);return a>=56320&&a<=57343?(i<<10)+a-56613888:i};Vo.prototype.nextIndex=function(e,r){r===void 0&&(r=!1);var n=this.source,s=n.length;if(e>=s)return s;var i=n.charCodeAt(e),a;return!(r||this.switchU)||i<=55295||i>=57344||e+1>=s||(a=n.charCodeAt(e+1))<56320||a>57343?e+1:e+2};Vo.prototype.current=function(e){return e===void 0&&(e=!1),this.at(this.pos,e)};Vo.prototype.lookahead=function(e){return e===void 0&&(e=!1),this.at(this.nextIndex(this.pos,e),e)};Vo.prototype.advance=function(e){e===void 0&&(e=!1),this.pos=this.nextIndex(this.pos,e)};Vo.prototype.eat=function(e,r){return r===void 0&&(r=!1),this.current(r)===e?(this.advance(r),!0):!1};Vo.prototype.eatChars=function(e,r){r===void 0&&(r=!1);for(var n=this.pos,s=0,i=e;s<i.length;s+=1){var a=i[s],l=this.at(n,r);if(l===-1||l!==a)return!1;n=this.nextIndex(n,r)}return this.pos=n,!0};Ft.validateRegExpFlags=function(t){for(var e=t.validFlags,r=t.flags,n=!1,s=!1,i=0;i<r.length;i++){var a=r.charAt(i);e.indexOf(a)===-1&&this.raise(t.start,"Invalid regular expression flag"),r.indexOf(a,i+1)>-1&&this.raise(t.start,"Duplicate regular expression flag"),a==="u"&&(n=!0),a==="v"&&(s=!0)}this.options.ecmaVersion>=15&&n&&s&&this.raise(t.start,"Invalid regular expression flag")};function DE(t){for(var e in t)return!0;return!1}Ft.validateRegExpPattern=function(t){this.regexp_pattern(t),!t.switchN&&this.options.ecmaVersion>=9&&DE(t.groupNames)&&(t.switchN=!0,this.regexp_pattern(t))};Ft.regexp_pattern=function(t){t.pos=0,t.lastIntValue=0,t.lastStringValue="",t.lastAssertionIsQuantifiable=!1,t.numCapturingParens=0,t.maxBackReference=0,t.groupNames=Object.create(null),t.backReferenceNames.length=0,t.branchID=null,this.regexp_disjunction(t),t.pos!==t.source.length&&(t.eat(41)&&t.raise("Unmatched ')'"),(t.eat(93)||t.eat(125))&&t.raise("Lone quantifier brackets")),t.maxBackReference>t.numCapturingParens&&t.raise("Invalid escape");for(var e=0,r=t.backReferenceNames;e<r.length;e+=1){var n=r[e];t.groupNames[n]||t.raise("Invalid named capture referenced")}};Ft.regexp_disjunction=function(t){var e=this.options.ecmaVersion>=16;for(e&&(t.branchID=new Nu(t.branchID,null)),this.regexp_alternative(t);t.eat(124);)e&&(t.branchID=t.branchID.sibling()),this.regexp_alternative(t);e&&(t.branchID=t.branchID.parent),this.regexp_eatQuantifier(t,!0)&&t.raise("Nothing to repeat"),t.eat(123)&&t.raise("Lone quantifier brackets")};Ft.regexp_alternative=function(t){for(;t.pos<t.source.length&&this.regexp_eatTerm(t););};Ft.regexp_eatTerm=function(t){return this.regexp_eatAssertion(t)?(t.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(t)&&t.switchU&&t.raise("Invalid quantifier"),!0):(t.switchU?this.regexp_eatAtom(t):this.regexp_eatExtendedAtom(t))?(this.regexp_eatQuantifier(t),!0):!1};Ft.regexp_eatAssertion=function(t){var e=t.pos;if(t.lastAssertionIsQuantifiable=!1,t.eat(94)||t.eat(36))return!0;if(t.eat(92)){if(t.eat(66)||t.eat(98))return!0;t.pos=e}if(t.eat(40)&&t.eat(63)){var r=!1;if(this.options.ecmaVersion>=9&&(r=t.eat(60)),t.eat(61)||t.eat(33))return this.regexp_disjunction(t),t.eat(41)||t.raise("Unterminated group"),t.lastAssertionIsQuantifiable=!r,!0}return t.pos=e,!1};Ft.regexp_eatQuantifier=function(t,e){return e===void 0&&(e=!1),this.regexp_eatQuantifierPrefix(t,e)?(t.eat(63),!0):!1};Ft.regexp_eatQuantifierPrefix=function(t,e){return t.eat(42)||t.eat(43)||t.eat(63)||this.regexp_eatBracedQuantifier(t,e)};Ft.regexp_eatBracedQuantifier=function(t,e){var r=t.pos;if(t.eat(123)){var n=0,s=-1;if(this.regexp_eatDecimalDigits(t)&&(n=t.lastIntValue,t.eat(44)&&this.regexp_eatDecimalDigits(t)&&(s=t.lastIntValue),t.eat(125)))return s!==-1&&s<n&&!e&&t.raise("numbers out of order in {} quantifier"),!0;t.switchU&&!e&&t.raise("Incomplete quantifier"),t.pos=r}return!1};Ft.regexp_eatAtom=function(t){return this.regexp_eatPatternCharacters(t)||t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)};Ft.regexp_eatReverseSolidusAtomEscape=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatAtomEscape(t))return!0;t.pos=e}return!1};Ft.regexp_eatUncapturingGroup=function(t){var e=t.pos;if(t.eat(40)){if(t.eat(63)){if(this.options.ecmaVersion>=16){var r=this.regexp_eatModifiers(t),n=t.eat(45);if(r||n){for(var s=0;s<r.length;s++){var i=r.charAt(s);r.indexOf(i,s+1)>-1&&t.raise("Duplicate regular expression modifiers")}if(n){var a=this.regexp_eatModifiers(t);!r&&!a&&t.current()===58&&t.raise("Invalid regular expression modifiers");for(var l=0;l<a.length;l++){var c=a.charAt(l);(a.indexOf(c,l+1)>-1||r.indexOf(c)>-1)&&t.raise("Duplicate regular expression modifiers")}}}}if(t.eat(58)){if(this.regexp_disjunction(t),t.eat(41))return!0;t.raise("Unterminated group")}}t.pos=e}return!1};Ft.regexp_eatCapturingGroup=function(t){if(t.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(t):t.current()===63&&t.raise("Invalid group"),this.regexp_disjunction(t),t.eat(41))return t.numCapturingParens+=1,!0;t.raise("Unterminated group")}return!1};Ft.regexp_eatModifiers=function(t){for(var e="",r=0;(r=t.current())!==-1&&RE(r);)e+=si(r),t.advance();return e};function RE(t){return t===105||t===109||t===115}Ft.regexp_eatExtendedAtom=function(t){return t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)||this.regexp_eatInvalidBracedQuantifier(t)||this.regexp_eatExtendedPatternCharacter(t)};Ft.regexp_eatInvalidBracedQuantifier=function(t){return this.regexp_eatBracedQuantifier(t,!0)&&t.raise("Nothing to repeat"),!1};Ft.regexp_eatSyntaxCharacter=function(t){var e=t.current();return CS(e)?(t.lastIntValue=e,t.advance(),!0):!1};function CS(t){return t===36||t>=40&&t<=43||t===46||t===63||t>=91&&t<=94||t>=123&&t<=125}Ft.regexp_eatPatternCharacters=function(t){for(var e=t.pos,r=0;(r=t.current())!==-1&&!CS(r);)t.advance();return t.pos!==e};Ft.regexp_eatExtendedPatternCharacter=function(t){var e=t.current();return e!==-1&&e!==36&&!(e>=40&&e<=43)&&e!==46&&e!==63&&e!==91&&e!==94&&e!==124?(t.advance(),!0):!1};Ft.regexp_groupSpecifier=function(t){if(t.eat(63)){this.regexp_eatGroupName(t)||t.raise("Invalid group");var e=this.options.ecmaVersion>=16,r=t.groupNames[t.lastStringValue];if(r)if(e)for(var n=0,s=r;n<s.length;n+=1){var i=s[n];i.separatedFrom(t.branchID)||t.raise("Duplicate capture group name")}else t.raise("Duplicate capture group name");e?(r||(t.groupNames[t.lastStringValue]=[])).push(t.branchID):t.groupNames[t.lastStringValue]=!0}};Ft.regexp_eatGroupName=function(t){if(t.lastStringValue="",t.eat(60)){if(this.regexp_eatRegExpIdentifierName(t)&&t.eat(62))return!0;t.raise("Invalid capture group name")}return!1};Ft.regexp_eatRegExpIdentifierName=function(t){if(t.lastStringValue="",this.regexp_eatRegExpIdentifierStart(t)){for(t.lastStringValue+=si(t.lastIntValue);this.regexp_eatRegExpIdentifierPart(t);)t.lastStringValue+=si(t.lastIntValue);return!0}return!1};Ft.regexp_eatRegExpIdentifierStart=function(t){var e=t.pos,r=this.options.ecmaVersion>=11,n=t.current(r);return t.advance(r),n===92&&this.regexp_eatRegExpUnicodeEscapeSequence(t,r)&&(n=t.lastIntValue),OE(n)?(t.lastIntValue=n,!0):(t.pos=e,!1)};function OE(t){return Oo(t,!0)||t===36||t===95}Ft.regexp_eatRegExpIdentifierPart=function(t){var e=t.pos,r=this.options.ecmaVersion>=11,n=t.current(r);return t.advance(r),n===92&&this.regexp_eatRegExpUnicodeEscapeSequence(t,r)&&(n=t.lastIntValue),_E(n)?(t.lastIntValue=n,!0):(t.pos=e,!1)};function _E(t){return _i(t,!0)||t===36||t===95||t===8204||t===8205}Ft.regexp_eatAtomEscape=function(t){return this.regexp_eatBackReference(t)||this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)||t.switchN&&this.regexp_eatKGroupName(t)?!0:(t.switchU&&(t.current()===99&&t.raise("Invalid unicode escape"),t.raise("Invalid escape")),!1)};Ft.regexp_eatBackReference=function(t){var e=t.pos;if(this.regexp_eatDecimalEscape(t)){var r=t.lastIntValue;if(t.switchU)return r>t.maxBackReference&&(t.maxBackReference=r),!0;if(r<=t.numCapturingParens)return!0;t.pos=e}return!1};Ft.regexp_eatKGroupName=function(t){if(t.eat(107)){if(this.regexp_eatGroupName(t))return t.backReferenceNames.push(t.lastStringValue),!0;t.raise("Invalid named reference")}return!1};Ft.regexp_eatCharacterEscape=function(t){return this.regexp_eatControlEscape(t)||this.regexp_eatCControlLetter(t)||this.regexp_eatZero(t)||this.regexp_eatHexEscapeSequence(t)||this.regexp_eatRegExpUnicodeEscapeSequence(t,!1)||!t.switchU&&this.regexp_eatLegacyOctalEscapeSequence(t)||this.regexp_eatIdentityEscape(t)};Ft.regexp_eatCControlLetter=function(t){var e=t.pos;if(t.eat(99)){if(this.regexp_eatControlLetter(t))return!0;t.pos=e}return!1};Ft.regexp_eatZero=function(t){return t.current()===48&&!uh(t.lookahead())?(t.lastIntValue=0,t.advance(),!0):!1};Ft.regexp_eatControlEscape=function(t){var e=t.current();return e===116?(t.lastIntValue=9,t.advance(),!0):e===110?(t.lastIntValue=10,t.advance(),!0):e===118?(t.lastIntValue=11,t.advance(),!0):e===102?(t.lastIntValue=12,t.advance(),!0):e===114?(t.lastIntValue=13,t.advance(),!0):!1};Ft.regexp_eatControlLetter=function(t){var e=t.current();return kS(e)?(t.lastIntValue=e%32,t.advance(),!0):!1};function kS(t){return t>=65&&t<=90||t>=97&&t<=122}Ft.regexp_eatRegExpUnicodeEscapeSequence=function(t,e){e===void 0&&(e=!1);var r=t.pos,n=e||t.switchU;if(t.eat(117)){if(this.regexp_eatFixedHexDigits(t,4)){var s=t.lastIntValue;if(n&&s>=55296&&s<=56319){var i=t.pos;if(t.eat(92)&&t.eat(117)&&this.regexp_eatFixedHexDigits(t,4)){var a=t.lastIntValue;if(a>=56320&&a<=57343)return t.lastIntValue=(s-55296)*1024+(a-56320)+65536,!0}t.pos=i,t.lastIntValue=s}return!0}if(n&&t.eat(123)&&this.regexp_eatHexDigits(t)&&t.eat(125)&&FE(t.lastIntValue))return!0;n&&t.raise("Invalid unicode escape"),t.pos=r}return!1};function FE(t){return t>=0&&t<=1114111}Ft.regexp_eatIdentityEscape=function(t){if(t.switchU)return this.regexp_eatSyntaxCharacter(t)?!0:t.eat(47)?(t.lastIntValue=47,!0):!1;var e=t.current();return e!==99&&(!t.switchN||e!==107)?(t.lastIntValue=e,t.advance(),!0):!1};Ft.regexp_eatDecimalEscape=function(t){t.lastIntValue=0;var e=t.current();if(e>=49&&e<=57){do t.lastIntValue=10*t.lastIntValue+(e-48),t.advance();while((e=t.current())>=48&&e<=57);return!0}return!1};var IS=0,oi=1,eo=2;Ft.regexp_eatCharacterClassEscape=function(t){var e=t.current();if(VE(e))return t.lastIntValue=-1,t.advance(),oi;var r=!1;if(t.switchU&&this.options.ecmaVersion>=9&&((r=e===80)||e===112)){t.lastIntValue=-1,t.advance();var n;if(t.eat(123)&&(n=this.regexp_eatUnicodePropertyValueExpression(t))&&t.eat(125))return r&&n===eo&&t.raise("Invalid property name"),n;t.raise("Invalid property name")}return IS};function VE(t){return t===100||t===68||t===115||t===83||t===119||t===87}Ft.regexp_eatUnicodePropertyValueExpression=function(t){var e=t.pos;if(this.regexp_eatUnicodePropertyName(t)&&t.eat(61)){var r=t.lastStringValue;if(this.regexp_eatUnicodePropertyValue(t)){var n=t.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(t,r,n),oi}}if(t.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(t)){var s=t.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(t,s)}return IS};Ft.regexp_validateUnicodePropertyNameAndValue=function(t,e,r){Dl(t.unicodeProperties.nonBinary,e)||t.raise("Invalid property name"),t.unicodeProperties.nonBinary[e].test(r)||t.raise("Invalid property value")};Ft.regexp_validateUnicodePropertyNameOrValue=function(t,e){if(t.unicodeProperties.binary.test(e))return oi;if(t.switchV&&t.unicodeProperties.binaryOfStrings.test(e))return eo;t.raise("Invalid property name")};Ft.regexp_eatUnicodePropertyName=function(t){var e=0;for(t.lastStringValue="";jS(e=t.current());)t.lastStringValue+=si(e),t.advance();return t.lastStringValue!==""};function jS(t){return kS(t)||t===95}Ft.regexp_eatUnicodePropertyValue=function(t){var e=0;for(t.lastStringValue="";$E(e=t.current());)t.lastStringValue+=si(e),t.advance();return t.lastStringValue!==""};function $E(t){return jS(t)||uh(t)}Ft.regexp_eatLoneUnicodePropertyNameOrValue=function(t){return this.regexp_eatUnicodePropertyValue(t)};Ft.regexp_eatCharacterClass=function(t){if(t.eat(91)){var e=t.eat(94),r=this.regexp_classContents(t);return t.eat(93)||t.raise("Unterminated character class"),e&&r===eo&&t.raise("Negated character class may contain strings"),!0}return!1};Ft.regexp_classContents=function(t){return t.current()===93?oi:t.switchV?this.regexp_classSetExpression(t):(this.regexp_nonEmptyClassRanges(t),oi)};Ft.regexp_nonEmptyClassRanges=function(t){for(;this.regexp_eatClassAtom(t);){var e=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassAtom(t)){var r=t.lastIntValue;t.switchU&&(e===-1||r===-1)&&t.raise("Invalid character class"),e!==-1&&r!==-1&&e>r&&t.raise("Range out of order in character class")}}};Ft.regexp_eatClassAtom=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatClassEscape(t))return!0;if(t.switchU){var r=t.current();(r===99||MS(r))&&t.raise("Invalid class escape"),t.raise("Invalid escape")}t.pos=e}var n=t.current();return n!==93?(t.lastIntValue=n,t.advance(),!0):!1};Ft.regexp_eatClassEscape=function(t){var e=t.pos;if(t.eat(98))return t.lastIntValue=8,!0;if(t.switchU&&t.eat(45))return t.lastIntValue=45,!0;if(!t.switchU&&t.eat(99)){if(this.regexp_eatClassControlLetter(t))return!0;t.pos=e}return this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)};Ft.regexp_classSetExpression=function(t){var e=oi,r;if(!this.regexp_eatClassSetRange(t))if(r=this.regexp_eatClassSetOperand(t)){r===eo&&(e=eo);for(var n=t.pos;t.eatChars([38,38]);){if(t.current()!==38&&(r=this.regexp_eatClassSetOperand(t))){r!==eo&&(e=oi);continue}t.raise("Invalid character in character class")}if(n!==t.pos)return e;for(;t.eatChars([45,45]);)this.regexp_eatClassSetOperand(t)||t.raise("Invalid character in character class");if(n!==t.pos)return e}else t.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(t)){if(r=this.regexp_eatClassSetOperand(t),!r)return e;r===eo&&(e=eo)}};Ft.regexp_eatClassSetRange=function(t){var e=t.pos;if(this.regexp_eatClassSetCharacter(t)){var r=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassSetCharacter(t)){var n=t.lastIntValue;return r!==-1&&n!==-1&&r>n&&t.raise("Range out of order in character class"),!0}t.pos=e}return!1};Ft.regexp_eatClassSetOperand=function(t){return this.regexp_eatClassSetCharacter(t)?oi:this.regexp_eatClassStringDisjunction(t)||this.regexp_eatNestedClass(t)};Ft.regexp_eatNestedClass=function(t){var e=t.pos;if(t.eat(91)){var r=t.eat(94),n=this.regexp_classContents(t);if(t.eat(93))return r&&n===eo&&t.raise("Negated character class may contain strings"),n;t.pos=e}if(t.eat(92)){var s=this.regexp_eatCharacterClassEscape(t);if(s)return s;t.pos=e}return null};Ft.regexp_eatClassStringDisjunction=function(t){var e=t.pos;if(t.eatChars([92,113])){if(t.eat(123)){var r=this.regexp_classStringDisjunctionContents(t);if(t.eat(125))return r}else t.raise("Invalid escape");t.pos=e}return null};Ft.regexp_classStringDisjunctionContents=function(t){for(var e=this.regexp_classString(t);t.eat(124);)this.regexp_classString(t)===eo&&(e=eo);return e};Ft.regexp_classString=function(t){for(var e=0;this.regexp_eatClassSetCharacter(t);)e++;return e===1?oi:eo};Ft.regexp_eatClassSetCharacter=function(t){var e=t.pos;if(t.eat(92))return this.regexp_eatCharacterEscape(t)||this.regexp_eatClassSetReservedPunctuator(t)?!0:t.eat(98)?(t.lastIntValue=8,!0):(t.pos=e,!1);var r=t.current();return r<0||r===t.lookahead()&&zE(r)||LE(r)?!1:(t.advance(),t.lastIntValue=r,!0)};function zE(t){return t===33||t>=35&&t<=38||t>=42&&t<=44||t===46||t>=58&&t<=64||t===94||t===96||t===126}function LE(t){return t===40||t===41||t===45||t===47||t>=91&&t<=93||t>=123&&t<=125}Ft.regexp_eatClassSetReservedPunctuator=function(t){var e=t.current();return BE(e)?(t.lastIntValue=e,t.advance(),!0):!1};function BE(t){return t===33||t===35||t===37||t===38||t===44||t===45||t>=58&&t<=62||t===64||t===96||t===126}Ft.regexp_eatClassControlLetter=function(t){var e=t.current();return uh(e)||e===95?(t.lastIntValue=e%32,t.advance(),!0):!1};Ft.regexp_eatHexEscapeSequence=function(t){var e=t.pos;if(t.eat(120)){if(this.regexp_eatFixedHexDigits(t,2))return!0;t.switchU&&t.raise("Invalid escape"),t.pos=e}return!1};Ft.regexp_eatDecimalDigits=function(t){var e=t.pos,r=0;for(t.lastIntValue=0;uh(r=t.current());)t.lastIntValue=10*t.lastIntValue+(r-48),t.advance();return t.pos!==e};function uh(t){return t>=48&&t<=57}Ft.regexp_eatHexDigits=function(t){var e=t.pos,r=0;for(t.lastIntValue=0;TS(r=t.current());)t.lastIntValue=16*t.lastIntValue+ES(r),t.advance();return t.pos!==e};function TS(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}function ES(t){return t>=65&&t<=70?10+(t-65):t>=97&&t<=102?10+(t-97):t-48}Ft.regexp_eatLegacyOctalEscapeSequence=function(t){if(this.regexp_eatOctalDigit(t)){var e=t.lastIntValue;if(this.regexp_eatOctalDigit(t)){var r=t.lastIntValue;e<=3&&this.regexp_eatOctalDigit(t)?t.lastIntValue=e*64+r*8+t.lastIntValue:t.lastIntValue=e*8+r}else t.lastIntValue=e;return!0}return!1};Ft.regexp_eatOctalDigit=function(t){var e=t.current();return MS(e)?(t.lastIntValue=e-48,t.advance(),!0):(t.lastIntValue=0,!1)};function MS(t){return t>=48&&t<=55}Ft.regexp_eatFixedHexDigits=function(t,e){var r=t.pos;t.lastIntValue=0;for(var n=0;n<e;++n){var s=t.current();if(!TS(s))return t.pos=r,!1;t.lastIntValue=16*t.lastIntValue+ES(s),t.advance()}return!0};var C0=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new ih(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},Mr=Ln.prototype;Mr.next=function(t){!t&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new C0(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()};Mr.getToken=function(){return this.next(),new C0(this)};typeof Symbol<"u"&&(Mr[Symbol.iterator]=function(){var t=this;return{next:function(){var e=t.getToken();return{done:e.type===W.eof,value:e}}}});Mr.nextToken=function(){var t=this.curContext();if((!t||!t.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(W.eof);if(t.override)return t.override(this);this.readToken(this.fullCharCodeAtPos())};Mr.readToken=function(t){return Oo(t,this.options.ecmaVersion>=6)||t===92?this.readWord():this.getTokenFromCode(t)};Mr.fullCharCodeAtPos=function(){var t=this.input.charCodeAt(this.pos);if(t<=55295||t>=56320)return t;var e=this.input.charCodeAt(this.pos+1);return e<=56319||e>=57344?t:(t<<10)+e-56613888};Mr.skipBlockComment=function(){var t=this.options.onComment&&this.curPosition(),e=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(r===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations)for(var n=void 0,s=e;(n=Q2(this.input,s,this.pos))>-1;)++this.curLine,s=this.lineStart=n;this.options.onComment&&this.options.onComment(!0,this.input.slice(e+2,r),e,this.pos,t,this.curPosition())};Mr.skipLineComment=function(t){for(var e=this.pos,r=this.options.onComment&&this.curPosition(),n=this.input.charCodeAt(this.pos+=t);this.pos<this.input.length&&!Nl(n);)n=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+t,this.pos),e,this.pos,r,this.curPosition())};Mr.skipSpace=function(){e:for(;this.pos<this.input.length;){var t=this.input.charCodeAt(this.pos);switch(t){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(t>8&&t<14||t>=5760&&eS.test(String.fromCharCode(t)))++this.pos;else break e}}};Mr.finishToken=function(t,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var r=this.type;this.type=t,this.value=e,this.updateContext(r)};Mr.readToken_dot=function(){var t=this.input.charCodeAt(this.pos+1);if(t>=48&&t<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&t===46&&e===46?(this.pos+=3,this.finishToken(W.ellipsis)):(++this.pos,this.finishToken(W.dot))};Mr.readToken_slash=function(){var t=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):t===61?this.finishOp(W.assign,2):this.finishOp(W.slash,1)};Mr.readToken_mult_modulo_exp=function(t){var e=this.input.charCodeAt(this.pos+1),r=1,n=t===42?W.star:W.modulo;return this.options.ecmaVersion>=7&&t===42&&e===42&&(++r,n=W.starstar,e=this.input.charCodeAt(this.pos+2)),e===61?this.finishOp(W.assign,r+1):this.finishOp(n,r)};Mr.readToken_pipe_amp=function(t){var e=this.input.charCodeAt(this.pos+1);if(e===t){if(this.options.ecmaVersion>=12){var r=this.input.charCodeAt(this.pos+2);if(r===61)return this.finishOp(W.assign,3)}return this.finishOp(t===124?W.logicalOR:W.logicalAND,2)}return e===61?this.finishOp(W.assign,2):this.finishOp(t===124?W.bitwiseOR:W.bitwiseAND,1)};Mr.readToken_caret=function(){var t=this.input.charCodeAt(this.pos+1);return t===61?this.finishOp(W.assign,2):this.finishOp(W.bitwiseXOR,1)};Mr.readToken_plus_min=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?e===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Ts.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(W.incDec,2):e===61?this.finishOp(W.assign,2):this.finishOp(W.plusMin,1)};Mr.readToken_lt_gt=function(t){var e=this.input.charCodeAt(this.pos+1),r=1;return e===t?(r=t===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+r)===61?this.finishOp(W.assign,r+1):this.finishOp(W.bitShift,r)):e===33&&t===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(e===61&&(r=2),this.finishOp(W.relational,r))};Mr.readToken_eq_excl=function(t){var e=this.input.charCodeAt(this.pos+1);return e===61?this.finishOp(W.equality,this.input.charCodeAt(this.pos+2)===61?3:2):t===61&&e===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(W.arrow)):this.finishOp(t===61?W.eq:W.prefix,1)};Mr.readToken_question=function(){var t=this.options.ecmaVersion;if(t>=11){var e=this.input.charCodeAt(this.pos+1);if(e===46){var r=this.input.charCodeAt(this.pos+2);if(r<48||r>57)return this.finishOp(W.questionDot,2)}if(e===63){if(t>=12){var n=this.input.charCodeAt(this.pos+2);if(n===61)return this.finishOp(W.assign,3)}return this.finishOp(W.coalesce,2)}}return this.finishOp(W.question,1)};Mr.readToken_numberSign=function(){var t=this.options.ecmaVersion,e=35;if(t>=13&&(++this.pos,e=this.fullCharCodeAtPos(),Oo(e,!0)||e===92))return this.finishToken(W.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+si(e)+"'")};Mr.getTokenFromCode=function(t){switch(t){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(W.parenL);case 41:return++this.pos,this.finishToken(W.parenR);case 59:return++this.pos,this.finishToken(W.semi);case 44:return++this.pos,this.finishToken(W.comma);case 91:return++this.pos,this.finishToken(W.bracketL);case 93:return++this.pos,this.finishToken(W.bracketR);case 123:return++this.pos,this.finishToken(W.braceL);case 125:return++this.pos,this.finishToken(W.braceR);case 58:return++this.pos,this.finishToken(W.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(W.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(e===120||e===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(e===111||e===79)return this.readRadixNumber(8);if(e===98||e===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(t);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(t);case 124:case 38:return this.readToken_pipe_amp(t);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(t);case 60:case 62:return this.readToken_lt_gt(t);case 61:case 33:return this.readToken_eq_excl(t);case 63:return this.readToken_question();case 126:return this.finishOp(W.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+si(t)+"'")};Mr.finishOp=function(t,e){var r=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(t,r)};Mr.readRegexp=function(){for(var t,e,r=this.pos;;){this.pos>=this.input.length&&this.raise(r,"Unterminated regular expression");var n=this.input.charAt(this.pos);if(Ts.test(n)&&this.raise(r,"Unterminated regular expression"),t)t=!1;else{if(n==="[")e=!0;else if(n==="]"&&e)e=!1;else if(n==="/"&&!e)break;t=n==="\\"}++this.pos}var s=this.input.slice(r,this.pos);++this.pos;var i=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(i);var l=this.regexpState||(this.regexpState=new Vo(this));l.reset(r,s,a),this.validateRegExpFlags(l),this.validateRegExpPattern(l);var c=null;try{c=new RegExp(s,a)}catch{}return this.finishToken(W.regexp,{pattern:s,flags:a,value:c})};Mr.readInt=function(t,e,r){for(var n=this.options.ecmaVersion>=12&&e===void 0,s=r&&this.input.charCodeAt(this.pos)===48,i=this.pos,a=0,l=0,c=0,d=e??1/0;c<d;++c,++this.pos){var u=this.input.charCodeAt(this.pos),m=void 0;if(n&&u===95){s&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),l===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),c===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),l=u;continue}if(u>=97?m=u-97+10:u>=65?m=u-65+10:u>=48&&u<=57?m=u-48:m=1/0,m>=t)break;l=u,a=a*t+m}return n&&l===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===i||e!=null&&this.pos-i!==e?null:a};function UE(t,e){return e?parseInt(t,8):parseFloat(t.replace(/_/g,""))}function AS(t){return typeof BigInt!="function"?null:BigInt(t.replace(/_/g,""))}Mr.readRadixNumber=function(t){var e=this.pos;this.pos+=2;var r=this.readInt(t);return r==null&&this.raise(this.start+2,"Expected number in radix "+t),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(r=AS(this.input.slice(e,this.pos)),++this.pos):Oo(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(W.num,r)};Mr.readNumber=function(t){var e=this.pos;!t&&this.readInt(10,void 0,!0)===null&&this.raise(e,"Invalid number");var r=this.pos-e>=2&&this.input.charCodeAt(e)===48;r&&this.strict&&this.raise(e,"Invalid number");var n=this.input.charCodeAt(this.pos);if(!r&&!t&&this.options.ecmaVersion>=11&&n===110){var s=AS(this.input.slice(e,this.pos));return++this.pos,Oo(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(W.num,s)}r&&/[89]/.test(this.input.slice(e,this.pos))&&(r=!1),n===46&&!r&&(++this.pos,this.readInt(10),n=this.input.charCodeAt(this.pos)),(n===69||n===101)&&!r&&(n=this.input.charCodeAt(++this.pos),(n===43||n===45)&&++this.pos,this.readInt(10)===null&&this.raise(e,"Invalid number")),Oo(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var i=UE(this.input.slice(e,this.pos),r);return this.finishToken(W.num,i)};Mr.readCodePoint=function(){var t=this.input.charCodeAt(this.pos),e;if(t===123){this.options.ecmaVersion<6&&this.unexpected();var r=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(r,"Code point out of bounds")}else e=this.readHexChar(4);return e};Mr.readString=function(t){for(var e="",r=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var n=this.input.charCodeAt(this.pos);if(n===t)break;n===92?(e+=this.input.slice(r,this.pos),e+=this.readEscapedChar(!1),r=this.pos):n===8232||n===8233?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(Nl(n)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(r,this.pos++),this.finishToken(W.string,e)};var PS={};Mr.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(t){if(t===PS)this.readInvalidTemplateToken();else throw t}this.inTemplateElement=!1};Mr.invalidStringToken=function(t,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw PS;this.raise(t,e)};Mr.readTmplToken=function(){for(var t="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var r=this.input.charCodeAt(this.pos);if(r===96||r===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===W.template||this.type===W.invalidTemplate)?r===36?(this.pos+=2,this.finishToken(W.dollarBraceL)):(++this.pos,this.finishToken(W.backQuote)):(t+=this.input.slice(e,this.pos),this.finishToken(W.template,t));if(r===92)t+=this.input.slice(e,this.pos),t+=this.readEscapedChar(!0),e=this.pos;else if(Nl(r)){switch(t+=this.input.slice(e,this.pos),++this.pos,r){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:t+=`
`;break;default:t+=String.fromCharCode(r);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}};Mr.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(W.invalidTemplate,this.input.slice(this.start,this.pos));case"\r":this.input[this.pos+1]===`
`&&++this.pos;case`
`:case"\u2028":case"\u2029":++this.curLine,this.lineStart=this.pos+1;break}this.raise(this.start,"Unterminated template")};Mr.readEscapedChar=function(t){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return si(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),t){var r=this.pos-1;this.invalidStringToken(r,"Invalid escape sequence in template string")}default:if(e>=48&&e<=55){var n=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],s=parseInt(n,8);return s>255&&(n=n.slice(0,-1),s=parseInt(n,8)),this.pos+=n.length-1,e=this.input.charCodeAt(this.pos),(n!=="0"||e===56||e===57)&&(this.strict||t)&&this.invalidStringToken(this.pos-1-n.length,t?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(s)}return Nl(e)?(this.options.locations&&(this.lineStart=this.pos,++this.curLine),""):String.fromCharCode(e)}};Mr.readHexChar=function(t){var e=this.pos,r=this.readInt(16,t);return r===null&&this.invalidStringToken(e,"Bad character escape sequence"),r};Mr.readWord1=function(){this.containsEsc=!1;for(var t="",e=!0,r=this.pos,n=this.options.ecmaVersion>=6;this.pos<this.input.length;){var s=this.fullCharCodeAtPos();if(_i(s,n))this.pos+=s<=65535?1:2;else if(s===92){this.containsEsc=!0,t+=this.input.slice(r,this.pos);var i=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(e?Oo:_i)(a,n)||this.invalidStringToken(i,"Invalid Unicode escape"),t+=si(a),r=this.pos}else break;e=!1}return t+this.input.slice(r,this.pos)};Mr.readWord=function(){var t=this.readWord1(),e=W.name;return this.keywords.test(t)&&(e=y0[t]),this.finishToken(e,t)};var GE="8.15.0";Ln.acorn={Parser:Ln,version:GE,defaultOptions:Kp,Position:Ec,SourceLocation:ih,getLineInfo:rS,Node:dh,TokenType:Br,tokTypes:W,keywordTypes:y0,TokContext:lo,tokContexts:fn,isIdentifierChar:_i,isIdentifierStart:Oo,Token:C0,isNewLine:Nl,lineBreak:Ts,lineBreakG:hE,nonASCIIwhitespace:eS};function HE(t,e){return Ln.parse(t,e)}class Is{static parseExpression(e){try{const r=HE(e,{ecmaVersion:2020,sourceType:"module",allowReturnOutsideFunction:!0,allowAwaitOutsideFunction:!0}),n=this.convertAcornNode(r.body[0]);return n.metadata={astVersion:this.AST_VERSION,validationErrors:[],complexity:this.calculateComplexity(n)},n}catch(r){return{type:"literal",value:e,metadata:{astVersion:this.AST_VERSION,validationErrors:[r instanceof Error?r.message:String(r)],complexity:"low"}}}}static generateJavaScript(e){var r;switch(e.type){case"binary":{if(!e.left||!e.right||!e.operator)throw new Error("Invalid binary operation: missing left, right, or operator");return`(${this.generateJavaScript(e.left)} ${e.operator} ${this.generateJavaScript(e.right)})`}case"unary":{if(!e.operand||!e.operator)throw new Error("Invalid unary operation: missing operand or operator");return`${e.operator}${this.generateJavaScript(e.operand)}`}case"variable":{if(!e.variableName)throw new Error("Invalid variable: missing variable name");return e.variableName}case"literal":{if(e.value===void 0)throw new Error("Invalid literal: missing value");return typeof e.value=="string"?`"${e.value}"`:String(e.value)}case"function":{if(!e.functionName)throw new Error("Invalid function call: missing function name");const n=((r=e.arguments)==null?void 0:r.map(s=>this.generateJavaScript(s)).join(", "))||"";return`${e.functionName}(${n})`}case"assignment":{if(!e.variableName||!e.expression)throw new Error("Invalid assignment: missing variable name or expression");return`${e.variableName} = ${this.generateJavaScript(e.expression)}`}case"group":{if(!e.body)throw new Error("Invalid group: missing body expression");return`(${this.generateJavaScript(e.body)})`}default:throw new Error(`Unsupported AST node type: ${e.type}`)}}static validateAST(e){const r=[];try{if(!e||typeof e!="object")return r.push("Invalid AST structure: AST must be an object"),r;e.type||r.push("Missing required field: type"),this.validateNode(e,r),this.checkCommonIssues(e,r)}catch(n){r.push(`Validation error: ${n instanceof Error?n.message:"Unknown error"}`)}return r}static validateNode(e,r){if(e)switch(e.type){case"binary":(!e.left||!e.right||!e.operator)&&r.push("Invalid binary expression: missing left, right, or operator"),this.validateNode(e.left,r),this.validateNode(e.right,r);break;case"unary":(!e.operand||!e.operator)&&r.push("Invalid unary expression: missing operand or operator"),this.validateNode(e.operand,r);break;case"function":e.functionName||r.push("Invalid function call: missing function name"),e.arguments&&e.arguments.forEach(n=>{this.validateNode(n,r)});break;case"variable":e.variableName||r.push("Invalid variable: missing variable name");break;case"literal":e.value===void 0&&r.push("Invalid literal: missing value");break;case"assignment":e.variableName||r.push("Invalid assignment: missing variable name"),e.expression||r.push("Invalid assignment: missing expression"),e.expression&&this.validateNode(e.expression,r);break;case"group":e.body||r.push("Invalid group: missing body expression"),e.body&&this.validateNode(e.body,r);break}}static checkCommonIssues(e,r){var n;if(e.type==="binary"&&e.operator==="/"&&((n=e.right)==null?void 0:n.type)==="literal"&&e.right.value===0&&r.push("Warning: Division by zero detected"),e.type==="variable"&&e.variableName&&!["n","base","exponent","value","value1","value2"].includes(e.variableName)&&!e.variableName.startsWith("system_")&&r.push(`Warning: Variable '${e.variableName}' may be undefined`),e.type==="binary"||e.type==="function"){const s=this.calculateComplexityScore(e);s>5&&r.push(`Warning: Complex expression detected (complexity: ${s}). Consider breaking into smaller parts.`)}e.left&&this.checkCommonIssues(e.left,r),e.right&&this.checkCommonIssues(e.right,r),e.operand&&this.checkCommonIssues(e.operand,r),e.expression&&this.checkCommonIssues(e.expression,r),e.body&&this.checkCommonIssues(e.body,r),e.arguments&&e.arguments.forEach(s=>{this.checkCommonIssues(s,r)})}static convertAcornNode(e){switch(e.type){case"ExpressionStatement":return this.convertAcornNode(e.expression);case"BinaryExpression":{const r=e;return{type:"binary",operator:r.operator,left:this.convertAcornNode(r.left),right:this.convertAcornNode(r.right)}}case"UnaryExpression":{const r=e;return{type:"unary",operator:r.operator,operand:this.convertAcornNode(r.argument)}}case"Identifier":return{type:"variable",variableName:e.name};case"Literal":{const r=e;return{type:"literal",value:r.value===null?void 0:r.value}}case"CallExpression":{const r=e;return{type:"function",functionName:this.getFunctionName(r.callee),arguments:r.arguments.map(n=>this.convertAcornNode(n))}}case"AssignmentExpression":{const r=e;return{type:"assignment",variableName:r.left.name,expression:this.convertAcornNode(r.right)}}case"ParenthesizedExpression":{const r=e;return{type:"group",body:this.convertAcornNode(r.expression)}}case"MemberExpression":{const r=e;return r.object.name==="Math"&&r.property.type==="Identifier"?{type:"function",functionName:`Math.${r.property.name}`,arguments:[]}:{type:"literal",value:this.generateMemberExpression(r)}}default:return{type:"literal",value:this.generateCodeFromNode(e)}}}static getFunctionName(e){if(e.type==="Identifier")return e.name;if(e.type==="MemberExpression"){const r=e;return`${this.getFunctionName(r.object)}.${r.property.name}`}return"unknown"}static generateMemberExpression(e){return e.object.type==="Identifier"&&e.property.type==="Identifier"?`${e.object.name}.${e.property.name}`:"unknown"}static generateCodeFromNode(e){return JSON.stringify(e)}static calculateComplexity(e){const r=this.calculateComplexityScore(e);return r<=3?"low":r<=8?"medium":"high"}static calculateComplexityScore(e){let r=1;switch(e.type){case"binary":r+=this.calculateComplexityScore(e.left),r+=this.calculateComplexityScore(e.right);break;case"unary":r+=this.calculateComplexityScore(e.operand);break;case"function":r+=2,e.arguments&&e.arguments.forEach(n=>{r+=this.calculateComplexityScore(n)});break;case"group":e.body&&(r+=this.calculateComplexityScore(e.body));break;case"assignment":e.expression&&(r+=this.calculateComplexityScore(e.expression));break}return r}static extractVariables(e){const r=[],n=s=>{switch(s.type==="variable"&&s.variableName&&r.push(s.variableName),s.type){case"binary":s.left&&n(s.left),s.right&&n(s.right);break;case"unary":s.operand&&n(s.operand);break;case"function":s.arguments&&s.arguments.forEach(i=>n(i));break;case"assignment":s.expression&&n(s.expression);break;case"group":s.body&&n(s.body);break}};return n(e),[...new Set(r)]}static optimizeExpression(e){if(!e)return e;try{const r=this.cloneAST(e);return this.constantFolding(r),this.removeRedundantOperations(r),this.simplifyExpressions(r),r}catch(r){return console.warn("Expression optimization failed:",r),e}}static constantFolding(e){var r;if(e)switch(e.type){case"binary":if(e.left&&e.right&&(this.constantFolding(e.left),this.constantFolding(e.right),e.left.type==="literal"&&e.right.type==="literal")){const n=Number(e.left.value),s=Number(e.right.value);if(!isNaN(n)&&!isNaN(s)){let i;switch(e.operator){case"+":i=n+s;break;case"-":i=n-s;break;case"*":i=n*s;break;case"/":i=s!==0?n/s:NaN;break;case"^":i=Math.pow(n,s);break;default:return}isNaN(i)||(e.type="literal",e.value=i,delete e.left,delete e.right,delete e.operator)}}break;case"unary":if(e.operand&&(this.constantFolding(e.operand),e.operand.type==="literal")){const n=Number(e.operand.value);if(!isNaN(n)){let s;switch(e.operator){case"-":s=-n;break;case"!":s=n?0:1;break;default:return}e.type="literal",e.value=s,delete e.operand,delete e.operator}}break;case"function":if(e.arguments&&(e.arguments.forEach(n=>this.constantFolding(n)),(r=e.functionName)!=null&&r.startsWith("Math.")&&e.arguments.length>0&&e.arguments.every(s=>s.type==="literal"))){const s=e.arguments.map(i=>Number(i.value));if(s.every(i=>!isNaN(i))){let i;switch(e.functionName){case"Math.abs":i=Math.abs(s[0]);break;case"Math.round":i=Math.round(s[0]);break;case"Math.floor":i=Math.floor(s[0]);break;case"Math.ceil":i=Math.ceil(s[0]);break;case"Math.sqrt":i=Math.sqrt(s[0]);break;case"Math.pow":i=Math.pow(s[0],s[1]);break;case"Math.min":i=Math.min(...s);break;case"Math.max":i=Math.max(...s);break;default:return}isNaN(i)||(e.type="literal",e.value=i,delete e.functionName,delete e.arguments)}}break;case"group":e.body&&this.constantFolding(e.body);break;case"assignment":e.expression&&this.constantFolding(e.expression);break}}static removeRedundantOperations(e){if(e)switch(e.type){case"binary":if(e.left&&e.right){if(this.removeRedundantOperations(e.left),this.removeRedundantOperations(e.right),e.operator==="+"&&e.right.type==="literal"&&e.right.value===0){this.replaceNode(e,e.left);return}if(e.operator==="+"&&e.left.type==="literal"&&e.left.value===0){this.replaceNode(e,e.right);return}if(e.operator==="*"&&e.right.type==="literal"&&e.right.value===1){this.replaceNode(e,e.left);return}if(e.operator==="*"&&e.left.type==="literal"&&e.left.value===1){this.replaceNode(e,e.right);return}if(e.operator==="^"&&e.right.type==="literal"&&e.right.value===1){this.replaceNode(e,e.left);return}if(e.operator==="^"&&e.right.type==="literal"&&e.right.value===0){e.type="literal",e.value=1,delete e.left,delete e.right,delete e.operator;return}}break;case"unary":if(e.operand&&(this.removeRedundantOperations(e.operand),e.operator==="-"&&e.operand.type==="unary"&&e.operand.operator==="-")){this.replaceNode(e,e.operand.operand);return}break;case"group":if(e.body&&(this.removeRedundantOperations(e.body),e.body.type==="literal"||e.body.type==="variable")){this.replaceNode(e,e.body);return}break;case"function":e.arguments&&e.arguments.forEach(r=>this.removeRedundantOperations(r));break;case"assignment":e.expression&&this.removeRedundantOperations(e.expression);break}}static simplifyExpressions(e){if(e)switch(e.type){case"binary":e.left&&e.right&&(this.simplifyExpressions(e.left),this.simplifyExpressions(e.right),e.operator==="+"&&e.left.type==="variable"&&e.right.type==="variable"&&e.left.variableName===e.right.variableName&&(e.operator="*",e.left={type:"literal",value:2}));break;case"unary":e.operand&&this.simplifyExpressions(e.operand);break;case"group":e.body&&this.simplifyExpressions(e.body);break;case"function":e.arguments&&e.arguments.forEach(r=>this.simplifyExpressions(r));break;case"assignment":e.expression&&this.simplifyExpressions(e.expression);break}}static cloneAST(e){if(!e)return e;const r={type:e.type};return e.operator&&(r.operator=e.operator),e.value!==void 0&&(r.value=e.value),e.variableName&&(r.variableName=e.variableName),e.functionName&&(r.functionName=e.functionName),e.expression&&(r.expression=this.cloneAST(e.expression)),e.body&&(r.body=this.cloneAST(e.body)),e.left&&(r.left=this.cloneAST(e.left)),e.right&&(r.right=this.cloneAST(e.right)),e.operand&&(r.operand=this.cloneAST(e.operand)),e.arguments&&(r.arguments=e.arguments.map(n=>this.cloneAST(n))),e.metadata&&(r.metadata={...e.metadata}),r}static replaceNode(e,r){Object.assign(e,r)}static generateCode(e){var r;if(!e)return"";try{switch(e.type){case"literal":return String(e.value);case"variable":return e.variableName||"";case"binary":{const n=this.generateCode(e.left),s=this.generateCode(e.right);return`${n} ${e.operator} ${s}`}case"unary":{const n=this.generateCode(e.operand);return`${e.operator}${n}`}case"function":{const n=((r=e.arguments)==null?void 0:r.map(s=>this.generateCode(s)).join(", "))||"";return`${e.functionName}(${n})`}case"group":return`(${this.generateCode(e.body)})`;case"assignment":{const n=this.generateCode(e.expression);return`${e.variableName} = ${n}`}default:return""}}catch(n){return console.warn("Code generation failed:",n),""}}}rt(Is,"AST_VERSION","1.0.0");class gi{static getAllVariableMappings(e){const r=Kn.getSystemVariables(),n=e.map(i=>({id:i.id,name:i.name,type:"algorithm"})),s=r.map(i=>({id:i.id,name:i.name,type:"system"}));return[...n,...s]}static getVariableNameById(e,r){const n=r.find(s=>s.id===e);return n?n.name:Kn.getVariableNameById(e)}static getVariableIdByName(e,r){const n=r.find(s=>s.name===e);return n?n.id:Kn.getVariableIdByName(e)}static convertFormulaToIds(e,r){const n=this.getAllVariableMappings(r);return e.replace(/\b([a-zA-Z_][a-zA-Z0-9_]*)\b/g,(s,i)=>{if(["Math","Array","Object","String","Number","Boolean","Date","RegExp","Function","undefined","null","true","false","NaN","Infinity"].includes(i)||/^\d+(\.\d+)?$/.test(i))return s;const l=n.find(c=>c.name===i);return l?l.id:s})}static convertFormulaToNames(e,r){const n=this.getAllVariableMappings(r);return e.replace(/\b([a-zA-Z0-9-_]+)\b/g,(s,i)=>{if(["Math","Array","Object","String","Number","Boolean","Date","RegExp","Function","undefined","null","true","false","NaN","Infinity"].includes(i)||/^\d+(\.\d+)?$/.test(i))return s;const l=n.find(c=>c.id===i);return l?l.name:s})}static convertLatexToIds(e,r){const n=this.getAllVariableMappings(r);return e.replace(/\{([a-zA-Z_][a-zA-Z0-9_]*)\}/g,(s,i)=>{const a=n.find(l=>l.name===i);return a?`{${a.id}}`:s})}static convertLatexToNames(e,r){const n=this.getAllVariableMappings(r);return e.replace(/\{([a-zA-Z0-9-_]+)\}/g,(s,i)=>{const a=n.find(l=>l.id===i);return a?`{${a.name}}`:s})}static convertASTToIds(e,r){if(!e||typeof e!="object")return e;const n=this.getAllVariableMappings(r);if(e.type==="variable"&&e.variableName){const i=n.find(a=>a.name===e.variableName);if(i)return{...e,variableName:i.id}}const s={...e};return s.left&&(s.left=this.convertASTToIds(s.left,r)),s.right&&(s.right=this.convertASTToIds(s.right,r)),s.operand&&(s.operand=this.convertASTToIds(s.operand,r)),s.arguments&&Array.isArray(s.arguments)&&(s.arguments=s.arguments.map(i=>this.convertASTToIds(i,r))),s.expression&&(s.expression=this.convertASTToIds(s.expression,r)),s.body&&(s.body=this.convertASTToIds(s.body,r)),s}static convertASTToNames(e,r){if(!e||typeof e!="object")return e;const n=this.getAllVariableMappings(r);if(e.type==="variable"&&e.variableName){const i=n.find(a=>a.id===e.variableName);if(i)return{...e,variableName:i.name}}const s={...e};return s.left&&(s.left=this.convertASTToNames(s.left,r)),s.right&&(s.right=this.convertASTToNames(s.right,r)),s.operand&&(s.operand=this.convertASTToNames(s.operand,r)),s.arguments&&Array.isArray(s.arguments)&&(s.arguments=s.arguments.map(i=>this.convertASTToNames(i,r))),s.expression&&(s.expression=this.convertASTToNames(s.expression,r)),s.body&&(s.body=this.convertASTToNames(s.body,r)),s}static createEvaluationContext(e,r=[]){const n={};return e.forEach(s=>{n[s.name]=this.parseVariableValue(s.defaultValue||"",s.type)}),r.forEach(s=>{n[s.name]=this.parseVariableValue(s.defaultValue||"",s.type)}),n}static parseVariableValue(e,r){switch(r){case"number":return parseFloat(e)||0;case"boolean":return e==="true"||e==="1";case"string":default:return e}}}const Tx=[{id:"+",label:"Add (+)",symbol:"+",latex:"+"},{id:"-",label:"Subtract (-)",symbol:"-",latex:"-"},{id:"Ã—",label:"Multiply (Ã—)",symbol:"*",latex:"\\times"},{id:"/",label:"Divide (Ã·)",symbol:"/",latex:"\\div"},{id:"^",label:"Power (^)",symbol:"^",latex:"^"},{id:"%",label:"Modulo (%)",symbol:"%",latex:"\\bmod"},{id:"=",label:"Equals (=)",symbol:"=",latex:"="}],Ex=[{id:"=",label:"Equals (=)",symbol:"=",latex:"="},{id:">",label:"Greater Than (>)",symbol:">",latex:">"},{id:"<",label:"Less Than (<)",symbol:"<",latex:"<"},{id:">=",label:"Greater Than or Equal (â‰¥)",symbol:">=",latex:"\\geq"},{id:"<=",label:"Less Than or Equal (â‰¤)",symbol:"<=",latex:"\\leq"},{id:"!=",label:"Not Equal (â‰ )",symbol:"!=",latex:"\\neq"}];function xm(t){if(!t||t.trim()==="")return"";try{let e=t;return e=e.replace(/Math\.pow\(([^,]+),\s*([^)]+)\)/g,"$1^{$2}"),e=e.replace(/Math\.sqrt\(([^)]+)\)/g,"\\sqrt{$1}"),e=e.replace(/Math\.abs\(([^)]+)\)/g,"|$1|"),e=e.replace(/Math\.floor\(([^)]+)\)/g,"\\lfloor $1 \\rfloor"),e=e.replace(/Math\.ceil\(([^)]+)\)/g,"\\lceil $1 \\rceil"),e=e.replace(/Math\.round\(([^)]+)\)/g,"\\text{round}($1)"),e=e.replace(/Math\.min\(([^)]+)\)/g,"\\min($1)"),e=e.replace(/Math\.max\(([^)]+)\)/g,"\\max($1)"),e=e.replace(/\*/g,"\\cdot "),e=e.replace(/\//g,"\\div "),e=e.replace(/==/g,"="),e=e.replace(/!=/g,"\\neq "),e=e.replace(/>=/g,"\\geq "),e=e.replace(/<=/g,"\\leq "),e=e.replace(/&&/g,"\\land "),e=e.replace(/\|\|/g,"\\lor "),e=e.replace(/!/g,"\\neg "),e=e.replace(/\[([^\]]+)\]/g,"[$1]"),e=e.replace(/(\d+)\.\.(\d+)/g,"[$1, $1+1, ..., $2]"),e=e.replace(/\s+/g," ").trim(),e}catch(e){return console.warn("LaTeX conversion error:",e),t}}const WE=({block:t,index:e,onDelete:r,colorMode:n,isGroupDropTarget:s,onClick:i})=>{const a=(c,d)=>{const u=n==="dark";return c.startsWith("Math.")?{bg:u?"purple.800":"purple.100",color:u?"purple.200":"purple.800",border:u?"purple.600":"purple.300"}:["+","-","*","/","^","==","!=",">","<",">=","<=","&&","||","!"].includes(c)?{bg:u?"orange.800":"orange.100",color:u?"orange.200":"orange.800",border:u?"orange.600":"orange.300"}:/^\d+(\.\d+)?$/.test(c)?{bg:u?"green.800":"green.100",color:u?"green.200":"green.800",border:u?"green.600":"green.300"}:d==="variable"?{bg:u?"blue.800":"blue.100",color:u?"blue.200":"blue.800",border:u?"blue.600":"blue.300"}:d==="array"||d==="range"?{bg:u?"teal.800":"teal.100",color:u?"teal.200":"teal.800",border:u?"teal.600":"teal.300"}:{bg:u?"gray.700":"white",color:u?"gray.200":"gray.800",border:u?"gray.600":"gray.200"}},l=a(t.content,t.type);return t.type==="group"?o.jsx(Tc,{draggableId:t.id,index:e,children:(c,d)=>{var u;return o.jsxs(z,{ref:c.innerRef,...c.draggableProps,p:2,bg:n==="dark"?"gray.700":"white",borderRadius:"md",boxShadow:d.isDragging?"md":"sm",borderWidth:1,borderColor:n==="dark"?"gray.600":"gray.200",children:[o.jsxs(le,{spacing:2,mb:2,children:[o.jsx(z,{...c.dragHandleProps,cursor:"grab",children:o.jsx(Np,{size:16})}),o.jsx(wt,{colorScheme:"green",children:"Group"}),o.jsx(Bt,{"aria-label":"Delete group",icon:o.jsx(Eo,{size:16}),size:"xs",colorScheme:"red",onClick:m=>{m.stopPropagation(),r(t.id)}})]}),o.jsx(z,{p:2,bg:s?"blue.100":n==="dark"?"gray.800":"gray.50",borderRadius:"md",minH:"50px",children:o.jsx(le,{spacing:2,wrap:"wrap",children:(u=t.children)==null?void 0:u.map(m=>{const g=a(m.content,m.type);return o.jsx(z,{p:1,bg:g.bg,color:g.color,borderRadius:"sm",borderWidth:1,borderColor:g.border,cursor:i&&(m.type==="variable"||m.type==="operator")?"pointer":"default",onClick:()=>i&&i(m),_hover:i&&(m.type==="variable"||m.type==="operator")?{opacity:.8,transform:"scale(1.05)"}:{},children:o.jsx(wt,{size:"sm",colorScheme:m.type==="variable"?"blue":m.type==="operator"?"purple":m.type==="value"?"gray":"green",bg:"transparent",color:"inherit",children:m.content})},m.id)})})})]})}}):o.jsx(Tc,{draggableId:t.id,index:e,children:(c,d)=>o.jsxs(le,{ref:c.innerRef,...c.draggableProps,...c.dragHandleProps,p:2,bg:l.bg,color:l.color,borderRadius:"md",boxShadow:d.isDragging?"md":"sm",borderWidth:1,borderColor:l.border,cursor:i&&(t.type==="variable"||t.type==="operator")?"pointer":"default",onClick:()=>i&&i(t),_hover:i&&(t.type==="variable"||t.type==="operator")?{opacity:.8,transform:"scale(1.02)"}:{},children:[o.jsx(z,{cursor:"grab",children:o.jsx(Np,{size:16})}),o.jsx(wt,{colorScheme:t.type==="variable"?"blue":t.type==="operator"?"purple":t.type==="value"?"gray":t.type==="array"?"orange":t.type==="range"?"teal":"green",children:t.type==="array"&&t.arrayValues?`[${t.arrayValues.join(", ")}]`:t.type==="range"&&t.rangeStart!==void 0?`${t.rangeStart}..${t.rangeEnd} (${t.rangeStep})`:t.content}),o.jsx(Bt,{"aria-label":"Delete block",icon:o.jsx(Eo,{size:16}),size:"xs",colorScheme:"red",onClick:u=>{u.stopPropagation(),r(t.id)}})]})})},Mx=({variables:t,value:e,onChange:r,mode:n="formula"})=>{const{colorMode:s}=Vt(),[i,a]=M.useState(()=>{if(!e)return[];const oe=gi.convertFormulaToNames(e,t),Ne=vm(oe);return console.log("FormulaEditor: Parsed blocks for expression:",oe,Ne),Ne}),{isOpen:l,onOpen:c,onClose:d}=nc(),{isOpen:u,onOpen:m,onClose:g}=nc(),{isOpen:y,onOpen:v,onClose:I}=nc(),[S,b]=M.useState(null),[k,A]=M.useState(""),[C,T]=M.useState(""),[P,_]=M.useState(""),[R,G]=M.useState("0"),[ne,he]=M.useState("10"),[te,K]=M.useState("1"),[O,Z]=M.useState([]),[ie,ge]=M.useState(null),[xe,$]=M.useState(null),[B,U]=M.useState([]),[X,ee]=M.useState("low"),[be,Se]=M.useState(!1),[Me,se]=M.useState([]),[de,fe]=M.useState(0),[_e,Y]=M.useState(null),Ce=[...t,...O];M.useEffect(()=>{const oe=()=>{const st=Kn.getSystemVariables(),tt=[{id:"system_n",name:"n",type:"number",defaultValue:"0"},...st];Z(tt)};oe();const Ne=()=>{oe()};return window.addEventListener("focus",Ne),()=>{window.removeEventListener("focus",Ne)}},[]);const ue=n==="formula"?Tx:Ex,Ee=ue.map(oe=>o.jsx(ds,{onClick:()=>je(oe.id),children:oe.label},oe.id)),ze=oe=>{if(oe.length===0)return"Formula is empty. Add variables, values, or operators.";const Ne=oe.some(pt=>pt.type==="operator"),st=oe.filter(pt=>pt.type==="variable"||pt.type==="value").length,tt=oe.filter(pt=>pt.type==="operator").length;if(Ne&&tt>st)return`Formula has ${tt} operators but only ${st} values. Consider adding more values or variables.`;if(Ne&&st<2)return"Formula has operators but needs at least 2 values or variables to be valid.";const Ie=oe.filter(pt=>pt.type==="variable").map(pt=>pt.content),We=O.map(pt=>pt.name),lt=t.map(pt=>pt.name),Et=Ie.filter(pt=>!We.includes(pt)&&!lt.includes(pt));if(Et.length>0)return`Undefined variables detected: ${Et.join(", ")}. Make sure all variables are defined in the Variables tab.`;const et=Ie.filter(pt=>We.includes(pt));return et.length>0?`Using system variables: ${et.join(", ")}. These will be automatically available during execution.`:""},De=oe=>{if(!oe.destination){T("");return}const{source:Ne,destination:st}=oe,tt=Array.from(i),[Ie]=tt.splice(Ne.index,1),We=tt[st.index];if(We&&We.type==="group"){We.children=We.children||[],We.children.push(Ie),a(tt),T("");return}tt.splice(st.index,0,Ie),a(tt),T("")},Ke=()=>{T("")},ve=oe=>{if(!oe.destination){T("");return}const Ne=i[oe.destination.index];Ne&&Ne.type==="group"?T(Ne.id):T("")},Te=oe=>{const Ne={id:`var_${Date.now()}`,type:"variable",content:oe.name};a(st=>[...st,Ne])},je=oe=>{const st=(n==="formula"?Tx:Ex).find(Ie=>Ie.id===oe);if(!st)return;const tt={id:`op_${Date.now()}`,type:"operator",content:st.symbol};a(Ie=>[...Ie,tt])},Fe=()=>{const oe={id:`group_${Date.now()}`,type:"group",content:"()",children:[]};a(Ne=>[...Ne,oe])},Ue=()=>{b({id:`value_${Date.now()}`,type:"value",content:"",value:""}),c()},Je=()=>{_(""),m()},ut=()=>{G("0"),he("10"),K("1"),v()},Ze=oe=>{if(!S)return;const Ne={...S,content:String(oe),value:oe};a(st=>[...st,Ne]),d()},At=()=>{const oe=P.split(",").map(Ne=>Ne.trim()).filter(Ne=>Ne!=="").map(Ne=>Number(Ne)).filter(Ne=>!isNaN(Ne));if(oe.length>0){const Ne={id:`array_${Date.now()}`,type:"array",content:`[${oe.join(", ")}]`,arrayValues:oe};a(st=>[...st,Ne]),g()}},gr=()=>{const oe=Number(R),Ne=Number(ne),st=Number(te);if(!isNaN(oe)&&!isNaN(Ne)&&!isNaN(st)&&st>0){const tt={id:`range_${Date.now()}`,type:"range",content:`${oe}..${Ne} (step ${st})`,rangeStart:oe,rangeEnd:Ne,rangeStep:st};a(Ie=>[...Ie,tt]),I()}},vr=oe=>{const Ne=st=>st.filter(tt=>tt.id===oe?!1:(tt.children&&(tt.children=Ne(tt.children)),!0));a(st=>Ne(st))},yr=oe=>{oe.type==="variable"?(ge(oe.id),$("variable")):oe.type==="operator"&&(ge(oe.id),$("operator"))},gt=oe=>{ie&&(a(Ne=>Ne.map(st=>st.id===ie?{...st,content:oe.name}:st)),ge(null),$(null))},Dt=oe=>{if(ie){const Ne=i.map(st=>st.id===ie?{...st,content:oe}:st);a(Ne),ge(null),$(null)}},Ct=oe=>{const Ne=[];return Ce.forEach(Ie=>{Ie.name.toLowerCase().includes(oe.toLowerCase())&&Ne.push({id:Ie.id,label:Ie.name,type:"variable"})}),[{id:"+",label:"Addition (+)",type:"operator"},{id:"-",label:"Subtraction (-)",type:"operator"},{id:"*",label:"Multiplication (*)",type:"operator"},{id:"/",label:"Division (/)",type:"operator"},{id:"^",label:"Power (^)",type:"operator"},{id:"Math.sqrt",label:"Square Root (Math.sqrt)",type:"operator"},{id:"Math.abs",label:"Absolute Value (Math.abs)",type:"operator"},{id:"Math.round",label:"Round (Math.round)",type:"operator"},{id:"Math.min",label:"Minimum (Math.min)",type:"operator"},{id:"Math.max",label:"Maximum (Math.max)",type:"operator"}].forEach(Ie=>{Ie.label.toLowerCase().includes(oe.toLowerCase())&&Ne.push(Ie)}),[{id:"pow",label:"Power (a^b)",type:"template"},{id:"sqrt",label:"Square Root",type:"template"},{id:"abs",label:"Absolute Value",type:"template"},{id:"round",label:"Round to Integer",type:"template"},{id:"min",label:"Minimum of Values",type:"template"},{id:"max",label:"Maximum of Values",type:"template"}].forEach(Ie=>{Ie.label.toLowerCase().includes(oe.toLowerCase())&&Ne.push(Ie)}),Ne.slice(0,8)},Qt=oe=>{if(oe.length>=2){const Ne=Ct(oe);se(Ne),Se(Ne.length>0),fe(0)}else Se(!1)},Zt=oe=>{if(oe.type==="variable"){const Ne=Ce.find(st=>st.id===oe.id);Ne&&Te(Ne)}else oe.type==="operator"?je(oe.id):oe.type==="template"&&at(oe.id);Se(!1)},at=oe=>{const Ne=[];switch(oe){case"pow":Ne.push({id:`var_${Date.now()}_1`,type:"variable",content:"base"},{id:`op_${Date.now()}_1`,type:"operator",content:"^"},{id:`var_${Date.now()}_2`,type:"variable",content:"exponent"});break;case"sqrt":Ne.push({id:`op_${Date.now()}_1`,type:"operator",content:"Math.sqrt"},{id:`group_${Date.now()}_1`,type:"group",content:"()",children:[{id:`var_${Date.now()}_1`,type:"variable",content:"value"}]});break;case"abs":Ne.push({id:`op_${Date.now()}_1`,type:"operator",content:"Math.abs"},{id:`group_${Date.now()}_1`,type:"group",content:"()",children:[{id:`var_${Date.now()}_1`,type:"variable",content:"value"}]});break;case"round":Ne.push({id:`op_${Date.now()}_1`,type:"operator",content:"Math.round"},{id:`group_${Date.now()}_1`,type:"group",content:"()",children:[{id:`var_${Date.now()}_1`,type:"variable",content:"value"}]});break;case"min":Ne.push({id:`op_${Date.now()}_1`,type:"operator",content:"Math.min"},{id:`group_${Date.now()}_1`,type:"group",content:"()",children:[{id:`var_${Date.now()}_1`,type:"variable",content:"value1"},{id:`op_${Date.now()}_2`,type:"operator",content:","},{id:`var_${Date.now()}_2`,type:"variable",content:"value2"}]});break;case"max":Ne.push({id:`op_${Date.now()}_1`,type:"operator",content:"Math.max"},{id:`group_${Date.now()}_1`,type:"group",content:"()",children:[{id:`var_${Date.now()}_1`,type:"variable",content:"value1"},{id:`op_${Date.now()}_2`,type:"operator",content:","},{id:`var_${Date.now()}_2`,type:"variable",content:"value2"}]});break}a([...i,...Ne])};M.useEffect(()=>{const oe=We=>{let lt="",Et=0;for(;Et<We.length;){const et=We[Et];switch(et.type){case"variable":lt+=et.content;break;case"operator":if(et.content==="^"){const pt=lt.trim();if(Et++,Et<We.length){const Wt=oe([We[Et]]),In=/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(pt),Mn=/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(Wt);In||Mn?lt=`Math.pow(${pt}, ${Wt})`:lt+=` ^ ${Wt}`}}else lt+=` ${et.content} `;break;case"group":lt+=`(${et.children?oe(et.children):""})`;break;case"value":lt+=et.content;break;case"array":et.arrayValues&&(lt+=`[${et.arrayValues.join(", ")}]`);break;case"range":if(et.rangeStart!==void 0&&et.rangeEnd!==void 0&&et.rangeStep!==void 0){const pt=[];for(let Wt=et.rangeStart;Wt<=et.rangeEnd;Wt+=et.rangeStep)pt.push(Wt);lt+=`[${pt.join(", ")}]`}break;default:lt+=""}Et++}return lt.trim()};if(i.length===0){if(e&&e.trim()!==""){const We=xm(e),lt=Is.parseExpression(e);console.log("FormulaEditor: Converting JavaScript to LaTeX for empty blocks:",{javascript:e,latex:We,ast:lt}),r(e,We,lt)}A("");return}const Ne=oe(i),st=xm(Ne);let tt;try{tt=Is.parseExpression(Ne),U([]),ee(Is.calculateComplexity(tt))}catch(We){console.error("AST generation error:",We),tt={type:"literal",value:Ne,metadata:{astVersion:"1.0.0",validationErrors:[We instanceof Error?We.message:"Unknown error"],complexity:"low"}},U([We instanceof Error?We.message:"Unknown error"]),ee("low")}const Ie=ze(i);A(Ie),Ne!==e&&r(Ne,st,tt)},[i,r,t,n,e]);const Q=oe=>{let Ne="",st=0;for(;st<oe.length;){const tt=oe[st];switch(tt.type){case"variable":Ne+=tt.content;break;case"operator":if(tt.content==="^"){const Ie=Ne.trim();if(st++,st<oe.length){const We=Q([oe[st]]),lt=/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(Ie),Et=/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(We);lt||Et?Ne=`Math.pow(${Ie}, ${We})`:Ne+=` ^ ${We}`}}else Ne+=` ${tt.content} `;break;case"group":Ne+=`(${tt.children?Q(tt.children):""})`;break;case"value":Ne+=tt.content;break;case"array":tt.arrayValues&&(Ne+=`[${tt.arrayValues.join(", ")}]`);break;case"range":if(tt.rangeStart!==void 0&&tt.rangeEnd!==void 0&&tt.rangeStep!==void 0){const Ie=[];for(let We=tt.rangeStart;We<=tt.rangeEnd;We+=tt.rangeStep)Ie.push(We);Ne+=`[${Ie.join(", ")}]`}break;default:Ne+=""}st++}return Ne.trim()};M.useEffect(()=>{if(e){const oe=gi.convertFormulaToNames(e,t),Ne=vm(oe);a(Ne)}else a([])},[e,t]),M.useEffect(()=>{if(i.length>0){const oe=Q(i),Ne=xm(oe);let st;try{st=Is.parseExpression(oe),U([]),ee(Is.calculateComplexity(st))}catch(tt){console.error("AST generation error:",tt),st={type:"literal",value:oe,metadata:{astVersion:"1.0.0",validationErrors:[tt instanceof Error?tt.message:"Unknown error"],complexity:"low"}},U([tt instanceof Error?tt.message:"Unknown error"]),ee("low")}r(oe,Ne,st)}else r("","",{type:"literal",value:"",metadata:{astVersion:"1.0.0",validationErrors:[],complexity:"low"}})},[i,r,t]);const Ae=()=>{if(i.length!==0)try{const oe=Q(i),Ne=Is.parseExpression(oe),st=Is.optimizeExpression(Ne),tt=Is.generateCode(st),Ie=[],We=Is.calculateComplexity(Ne),lt=Is.calculateComplexity(st);if(lt!==We&&Ie.push(`Complexity reduced from ${We} to ${lt}`),oe!==tt&&Ie.push("Expression simplified"),st.type==="literal"&&Ne.type!=="literal"&&Ie.push("Constant expression evaluated"),Y({original:oe,optimized:tt,improvements:Ie}),Ie.length>0){const Et=vm(tt);a(Et)}}catch(oe){console.warn("Optimization failed:",oe),Y({original:Q(i),optimized:Q(i),improvements:["No optimizations found"]})}};return o.jsxs(z,{children:[o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(le,{spacing:2,wrap:"wrap",children:[o.jsxs(z,{position:"relative",flex:"1",maxW:"300px",children:[o.jsx(yt,{placeholder:"Type to search variables, operators, or templates...",size:"sm",onChange:oe=>Qt(oe.target.value),onKeyDown:oe=>{oe.key==="ArrowDown"?(oe.preventDefault(),fe(Ne=>Ne<Me.length-1?Ne+1:0)):oe.key==="ArrowUp"?(oe.preventDefault(),fe(Ne=>Ne>0?Ne-1:Me.length-1)):oe.key==="Enter"&&be&&Me.length>0?(oe.preventDefault(),Zt(Me[de])):oe.key==="Escape"&&Se(!1)}}),be&&Me.length>0&&o.jsx(z,{position:"absolute",top:"100%",left:0,right:0,bg:s==="dark"?"gray.800":"white",border:"1px solid",borderColor:s==="dark"?"gray.600":"gray.200",borderRadius:"md",boxShadow:"lg",zIndex:1e3,maxH:"200px",overflowY:"auto",children:Me.map((oe,Ne)=>o.jsx(z,{px:3,py:2,cursor:"pointer",bg:Ne===de?s==="dark"?"blue.600":"blue.100":"transparent",_hover:{bg:s==="dark"?"blue.600":"blue.100"},onClick:()=>Zt(oe),children:o.jsxs(le,{spacing:2,children:[o.jsx(z,{fontSize:"sm",fontWeight:"medium",children:oe.label}),o.jsx(wt,{size:"sm",colorScheme:oe.type==="variable"?"green":oe.type==="operator"?"blue":"purple",children:oe.type})]})},oe.id))})]}),o.jsxs(sl,{children:[o.jsxs(Od,{as:Oe,size:"sm",rightIcon:o.jsx(rm,{size:16}),leftIcon:o.jsx(bu,{size:16}),children:["Variable (",Ce.length,")"]}),o.jsxs(ol,{children:[O.length>0&&o.jsxs(o.Fragment,{children:[O.map(oe=>o.jsxs(ds,{onClick:()=>Te(oe),icon:o.jsx(to,{size:16}),children:[oe.name,oe.id==="system_n"&&o.jsx(wt,{ml:2,size:"sm",colorScheme:"green",children:"Built-in"}),oe.id!=="system_n"&&oe.id.startsWith("system-")&&o.jsx(wt,{ml:2,size:"sm",colorScheme:"blue",children:"System"})]},oe.id)),t.length>0&&o.jsx(on,{})]}),t.map(oe=>o.jsx(ds,{onClick:()=>Te(oe),icon:o.jsx(to,{size:16}),children:oe.name},oe.id))]})]}),o.jsxs(sl,{children:[o.jsx(Od,{as:Oe,rightIcon:o.jsx(rm,{size:16}),leftIcon:n==="formula"?o.jsx(Xi,{size:16}):o.jsx(yk,{size:16}),size:"sm",children:n==="formula"?"Math Operator":"Condition"}),o.jsx(ol,{children:Ee})]}),o.jsx(Oe,{"aria-label":"Add parentheses group",leftIcon:o.jsx(q6,{size:16}),size:"sm",onClick:Fe,children:"Parentheses"}),o.jsx(Oe,{"aria-label":"Add value",leftIcon:o.jsx(Nk,{size:16}),size:"sm",onClick:Ue,children:"Value"}),o.jsx(Oe,{"aria-label":"Add array",leftIcon:o.jsx(Xi,{size:16}),size:"sm",onClick:Je,children:"Array"}),o.jsx(Oe,{"aria-label":"Add range",leftIcon:o.jsx(Xi,{size:16}),size:"sm",onClick:ut,children:"Range"}),o.jsxs(sl,{children:[o.jsx(Od,{as:Oe,rightIcon:o.jsx(rm,{size:16}),leftIcon:o.jsx(Xi,{size:16}),size:"sm",children:"Templates"}),o.jsxs(ol,{children:[o.jsx(ds,{onClick:()=>at("pow"),children:"Power (a^b)"}),o.jsx(ds,{onClick:()=>at("sqrt"),children:"Square Root"}),o.jsx(ds,{onClick:()=>at("abs"),children:"Absolute Value"}),o.jsx(ds,{onClick:()=>at("round"),children:"Round to Integer"}),o.jsx(ds,{onClick:()=>at("min"),children:"Minimum of Values"}),o.jsx(ds,{onClick:()=>at("max"),children:"Maximum of Values"})]})]}),o.jsx(Oe,{"aria-label":"Optimize expression",leftIcon:o.jsx(Xi,{size:16}),size:"sm",onClick:Ae,colorScheme:"green",children:"Optimize"})]}),o.jsx(z,{p:4,bg:s==="dark"?"gray.800":"gray.50",borderRadius:"md",minH:"100px",children:o.jsx(sh,{onDragEnd:De,onDragStart:Ke,onDragUpdate:ve,children:o.jsx(oh,{droppableId:"formula-blocks",direction:"horizontal",children:oe=>o.jsxs(le,{ref:oe.innerRef,...oe.droppableProps,spacing:2,wrap:"wrap",minH:"60px",align:"start",children:[i.map((Ne,st)=>o.jsx(WE,{block:Ne,index:st,onDelete:vr,colorMode:s,isGroupDropTarget:C===Ne.id,onClick:yr},Ne.id)),oe.placeholder]})})})}),k&&o.jsxs(zt,{status:"warning",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsx(tn,{fontSize:"sm",children:k})]}),B.length>0&&o.jsxs(zt,{status:"error",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(ce,{align:"start",spacing:1,children:[o.jsx(oo,{fontSize:"sm",children:"Syntax Errors"}),o.jsx(tn,{fontSize:"sm",children:B.map((oe,Ne)=>o.jsxs(z,{color:"red.200",children:["â€¢ ",oe]},Ne))})]})]}),X!=="low"&&o.jsxs(zt,{status:X==="high"?"warning":"info",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(tn,{fontSize:"sm",children:["Formula complexity: ",o.jsx(wt,{colorScheme:X==="high"?"orange":"blue",children:X}),X==="high"&&" - Consider breaking into smaller expressions"]})]}),_e&&o.jsxs(zt,{status:"success",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(ce,{align:"start",spacing:2,children:[o.jsx(oo,{fontSize:"sm",children:"Optimization Applied"}),o.jsx(tn,{fontSize:"sm",children:o.jsxs(ce,{align:"start",spacing:1,children:[o.jsxs(z,{children:[o.jsx("strong",{children:"Original:"})," ",o.jsx("code",{children:_e.original})]}),o.jsxs(z,{children:[o.jsx("strong",{children:"Optimized:"})," ",o.jsx("code",{children:_e.optimized})]}),_e.improvements.length>0&&o.jsxs(z,{children:[o.jsx("strong",{children:"Improvements:"}),_e.improvements.map((oe,Ne)=>o.jsxs(z,{ml:2,color:"green.200",children:["â€¢ ",oe]},Ne))]})]})})]})]})]}),o.jsxs(Zr,{isOpen:l,onClose:d,children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:"Enter Value"}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,pb:4,children:[o.jsx(yt,{placeholder:"Enter a value",onChange:oe=>{S&&b({...S,content:oe.target.value,value:oe.target.value})}}),o.jsx(Oe,{leftIcon:o.jsx(Fd,{size:16}),colorScheme:"blue",onClick:()=>S&&Ze(S.value||""),children:"Add Value"})]})})]})]}),o.jsxs(Zr,{isOpen:u,onClose:g,children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:"Create Array"}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,pb:4,children:[o.jsx(yt,{placeholder:"Enter numbers separated by commas (e.g., 1, 2, 3, 4, 5)",value:P,onChange:oe=>_(oe.target.value)}),o.jsx(Oe,{leftIcon:o.jsx(Fd,{size:16}),colorScheme:"blue",onClick:At,children:"Create Array"})]})})]})]}),o.jsxs(Zr,{isOpen:y,onClose:I,children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:"Create Range"}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,pb:4,children:[o.jsxs(le,{spacing:2,children:[o.jsx(yt,{placeholder:"Start",value:R,onChange:oe=>G(oe.target.value)}),o.jsx(yt,{placeholder:"End",value:ne,onChange:oe=>he(oe.target.value)}),o.jsx(yt,{placeholder:"Step",value:te,onChange:oe=>K(oe.target.value)})]}),o.jsx(Oe,{leftIcon:o.jsx(Fd,{size:16}),colorScheme:"blue",onClick:gr,children:"Create Range"})]})})]})]}),o.jsx(sl,{isOpen:xe==="variable",onClose:()=>$(null),children:o.jsxs(ol,{children:[O.length>0&&o.jsxs(o.Fragment,{children:[O.map(oe=>o.jsxs(ds,{onClick:()=>gt(oe),icon:o.jsx(to,{size:16}),children:[oe.name,oe.id==="system_n"&&o.jsx(wt,{ml:2,size:"sm",colorScheme:"green",children:"Built-in"}),oe.id!=="system_n"&&oe.id.startsWith("system-")&&o.jsx(wt,{ml:2,size:"sm",colorScheme:"blue",children:"System"})]},oe.id)),t.length>0&&o.jsx(on,{})]}),t.map(oe=>o.jsx(ds,{onClick:()=>gt(oe),icon:o.jsx(to,{size:16}),children:oe.name},oe.id))]})}),o.jsx(sl,{isOpen:xe==="operator",onClose:()=>$(null),children:o.jsx(ol,{children:ue.map(oe=>o.jsx(ds,{onClick:()=>Dt(oe.id),children:oe.label},oe.id))})})]})};function vm(t){if(!t||t.trim()==="")return[];if(t.includes("Math.pow(")){let r=t;const n=t.match(/Math\.pow\(([^,]+),\s*([^)]+)\)/g);return n&&n.forEach(s=>{const i=s.match(/Math\.pow\(([^,]+),\s*([^)]+)\)/);if(i){const a=i[1].trim(),l=i[2].trim(),c=`${a} ^ ${l}`;r=r.replace(s,c)}}),$d(r)}if(/\[.*\]|\d+\.\.\d+/.test(t)){const r=JE(t);return[...$d(t),...r]}return $d(t)}function qE(t){const e=[];let r=0;for(;r<t.length;){const n=t[r];if(/\s/.test(n)){r++;continue}if(/\d/.test(n)){let s="";for(;r<t.length&&/\d|\./.test(t[r]);)s+=t[r],r++;e.push({type:"number",value:s,position:r-s.length});continue}if(/[+\-*/^=<>!&|]/.test(n)){let s=n;if(r++,r<t.length){const i=t[r];(n==="="&&i==="="||n==="!"&&i==="="||n==="<"&&i==="="||n===">"&&i==="="||n==="&"&&i==="&"||n==="|"&&i==="|")&&(s+=i,r++)}e.push({type:"operator",value:s,position:r-s.length});continue}if(n==="("||n===")"){e.push({type:"parenthesis",value:n,position:r}),r++;continue}if(/[a-zA-Z_]/.test(n)){let s="";for(;r<t.length&&/[a-zA-Z0-9_]/.test(t[r]);)s+=t[r],r++;e.push({type:"variable",value:s,position:r-s.length});continue}r++}return e}function $d(t){const e=qE(t),r=[];let n=0;for(;n<e.length;){const s=e[n];switch(s.type){case"variable":if(s.value==="Math"&&n+2<e.length&&e[n+1].value==="."&&e[n+2].type==="variable"){const i=e[n+2].value;r.push({id:`op_${Date.now()}_${Math.random()}`,type:"operator",content:`Math.${i}`}),n+=2}else r.push({id:`var_${Date.now()}_${Math.random()}`,type:"variable",content:s.value});break;case"number":r.push({id:`value_${Date.now()}_${Math.random()}`,type:"value",content:s.value,value:parseFloat(s.value)});break;case"operator":s.value==="^"?r.push({id:`op_${Date.now()}_${Math.random()}`,type:"operator",content:"^"}):r.push({id:`op_${Date.now()}_${Math.random()}`,type:"operator",content:s.value});break;case"parenthesis":if(s.value==="("){let i=1,a=n+1,l="";for(;a<e.length&&i>0;)e[a].value==="("&&i++,e[a].value===")"&&i--,i>0&&(l+=e[a].value),a++;if(i===0){const c=$d(l);r.push({id:`group_${Date.now()}_${Math.random()}`,type:"group",content:"()",children:c}),n=a-1}else r.push({id:`var_${Date.now()}_${Math.random()}`,type:"variable",content:s.value})}break}n++}return r}function JE(t){const e=[],r=/\[([^\]]+)\]/g;let n;for(;(n=r.exec(t))!==null;){const l=n[1].split(",").map(c=>c.trim()).map(c=>Number(c)).filter(c=>!isNaN(c));l.length>0&&e.push({id:`array_${Date.now()}_${Math.random()}`,type:"array",content:n[0],arrayValues:l})}const s=/(\d+)\.\.(\d+)(?::(\d+))?/g;let i;for(;(i=s.exec(t))!==null;){const a=Number(i[1]),l=Number(i[2]),c=i[3]?Number(i[3]):1;!isNaN(a)&&!isNaN(l)&&!isNaN(c)&&e.push({id:`range_${Date.now()}_${Math.random()}`,type:"range",content:`${a}..${l} (step ${c})`,rangeStart:a,rangeEnd:l,rangeStep:c})}return e}var Qp={exports:{}},bm={exports:{}},Ax;function YE(){return Ax||(Ax=1,function(t,e){(function(n,s){t.exports=s()})(typeof self<"u"?self:Gv,function(){return function(){var r={};(function(){r.d=function(p,h){for(var f in h)r.o(h,f)&&!r.o(p,f)&&Object.defineProperty(p,f,{enumerable:!0,get:h[f]})}})(),function(){r.o=function(p,h){return Object.prototype.hasOwnProperty.call(p,h)}}();var n={};r.d(n,{default:function(){return ww}});class s{constructor(h,f){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;let x="KaTeX parse error: "+h,j,D;const F=f&&f.loc;if(F&&F.start<=F.end){const re=F.lexer.input;j=F.start,D=F.end,j===re.length?x+=" at end of input: ":x+=" at position "+(j+1)+": ";const we=re.slice(j,D).replace(/[^]/g,"$&Ì²");let Pe;j>15?Pe="â€¦"+re.slice(j-15,j):Pe=re.slice(0,j);let Ve;D+15<re.length?Ve=re.slice(D,D+15)+"â€¦":Ve=re.slice(D),x+=Pe+we+Ve}const H=new Error(x);return H.name="ParseError",H.__proto__=s.prototype,H.position=j,j!=null&&D!=null&&(H.length=D-j),H.rawMessage=h,H}}s.prototype.__proto__=Error.prototype;var i=s;const a=function(p,h){return p.indexOf(h)!==-1},l=function(p,h){return p===void 0?h:p},c=/([A-Z])/g,d=function(p){return p.replace(c,"-$1").toLowerCase()},u={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},m=/[&><"']/g;function g(p){return String(p).replace(m,h=>u[h])}const y=function(p){return p.type==="ordgroup"||p.type==="color"?p.body.length===1?y(p.body[0]):p:p.type==="font"?y(p.body):p},v=function(p){const h=y(p);return h.type==="mathord"||h.type==="textord"||h.type==="atom"},I=function(p){if(!p)throw new Error("Expected non-null, but got "+String(p));return p};var b={contains:a,deflt:l,escape:g,hyphenate:d,getBaseElem:y,isCharacterBox:v,protocolFromUrl:function(p){const h=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(p);return h?h[2]!==":"||!/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(h[1])?null:h[1].toLowerCase():"_relative"}};const k={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:p=>"#"+p},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(p,h)=>(h.push(p),h)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:p=>Math.max(0,p),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:p=>Math.max(0,p),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:p=>Math.max(0,p),cli:"-e, --max-expand <n>",cliProcessor:p=>p==="Infinity"?1/0:parseInt(p)},globalGroup:{type:"boolean",cli:!1}};function A(p){if(p.default)return p.default;const h=p.type,f=Array.isArray(h)?h[0]:h;if(typeof f!="string")return f.enum[0];switch(f){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class C{constructor(h){this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,h=h||{};for(const f in k)if(k.hasOwnProperty(f)){const x=k[f];this[f]=h[f]!==void 0?x.processor?x.processor(h[f]):h[f]:A(x)}}reportNonstrict(h,f,x){let j=this.strict;if(typeof j=="function"&&(j=j(h,f,x)),!(!j||j==="ignore")){if(j===!0||j==="error")throw new i("LaTeX-incompatible input and strict mode is set to 'error': "+(f+" ["+h+"]"),x);j==="warn"?typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(f+" ["+h+"]")):typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+j+"': "+f+" ["+h+"]"))}}useStrictBehavior(h,f,x){let j=this.strict;if(typeof j=="function")try{j=j(h,f,x)}catch{j="error"}return!j||j==="ignore"?!1:j===!0||j==="error"?!0:j==="warn"?(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(f+" ["+h+"]")),!1):(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+j+"': "+f+" ["+h+"]")),!1)}isTrusted(h){if(h.url&&!h.protocol){const x=b.protocolFromUrl(h.url);if(x==null)return!1;h.protocol=x}return!!(typeof this.trust=="function"?this.trust(h):this.trust)}}class T{constructor(h,f,x){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=h,this.size=f,this.cramped=x}sup(){return O[Z[this.id]]}sub(){return O[ie[this.id]]}fracNum(){return O[ge[this.id]]}fracDen(){return O[xe[this.id]]}cramp(){return O[$[this.id]]}text(){return O[B[this.id]]}isTight(){return this.size>=2}}const P=0,_=1,R=2,G=3,ne=4,he=5,te=6,K=7,O=[new T(P,0,!1),new T(_,0,!0),new T(R,1,!1),new T(G,1,!0),new T(ne,2,!1),new T(he,2,!0),new T(te,3,!1),new T(K,3,!0)],Z=[ne,he,ne,he,te,K,te,K],ie=[he,he,he,he,K,K,K,K],ge=[R,G,ne,he,te,K,te,K],xe=[G,G,he,he,K,K,K,K],$=[_,_,G,G,he,he,K,K],B=[P,_,R,G,R,G,R,G];var U={DISPLAY:O[P],TEXT:O[R],SCRIPT:O[ne],SCRIPTSCRIPT:O[te]};const X=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];function ee(p){for(let h=0;h<X.length;h++){const f=X[h];for(let x=0;x<f.blocks.length;x++){const j=f.blocks[x];if(p>=j[0]&&p<=j[1])return f.name}}return null}const be=[];X.forEach(p=>p.blocks.forEach(h=>be.push(...h)));function Se(p){for(let h=0;h<be.length;h+=2)if(p>=be[h]&&p<=be[h+1])return!0;return!1}const Me=80,se=function(p,h){return"M95,"+(622+p+h)+`
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l`+p/2.075+" -"+p+`
c5.3,-9.3,12,-14,20,-14
H400000v`+(40+p)+`H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M`+(834+p)+" "+h+"h400000v"+(40+p)+"h-400000z"},de=function(p,h){return"M263,"+(601+p+h)+`c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l`+p/2.084+" -"+p+`
c4.7,-7.3,11,-11,19,-11
H40000v`+(40+p)+`H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M`+(1001+p)+" "+h+"h400000v"+(40+p)+"h-400000z"},fe=function(p,h){return"M983 "+(10+p+h)+`
l`+p/3.13+" -"+p+`
c4,-6.7,10,-10,18,-10 H400000v`+(40+p)+`
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M`+(1001+p)+" "+h+"h400000v"+(40+p)+"h-400000z"},_e=function(p,h){return"M424,"+(2398+p+h)+`
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l`+p/4.223+" -"+p+`c4,-6.7,10,-10,18,-10 H400000
v`+(40+p)+`H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M`+(1001+p)+" "+h+`
h400000v`+(40+p)+"h-400000z"},Y=function(p,h){return"M473,"+(2713+p+h)+`
c339.3,-1799.3,509.3,-2700,510,-2702 l`+p/5.298+" -"+p+`
c3.3,-7.3,9.3,-11,18,-11 H400000v`+(40+p)+`H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM`+(1001+p)+" "+h+"h400000v"+(40+p)+"H1017.7z"},Ce=function(p){const h=p/2;return"M400000 "+p+" H0 L"+h+" 0 l65 45 L145 "+(p-80)+" H400000z"},ue=function(p,h,f){const x=f-54-h-p;return"M702 "+(p+h)+"H400000"+(40+p)+`
H742v`+x+`l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1
h-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170
c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667
219 661 l218 661zM702 `+h+"H400000v"+(40+p)+"H742z"},Ee=function(p,h,f){h=1e3*h;let x="";switch(p){case"sqrtMain":x=se(h,Me);break;case"sqrtSize1":x=de(h,Me);break;case"sqrtSize2":x=fe(h,Me);break;case"sqrtSize3":x=_e(h,Me);break;case"sqrtSize4":x=Y(h,Me);break;case"sqrtTall":x=ue(h,Me,f)}return x},ze=function(p,h){switch(p){case"âŽœ":return"M291 0 H417 V"+h+" H291z M291 0 H417 V"+h+" H291z";case"âˆ£":return"M145 0 H188 V"+h+" H145z M145 0 H188 V"+h+" H145z";case"âˆ¥":return"M145 0 H188 V"+h+" H145z M145 0 H188 V"+h+" H145z"+("M367 0 H410 V"+h+" H367z M367 0 H410 V"+h+" H367z");case"âŽŸ":return"M457 0 H583 V"+h+" H457z M457 0 H583 V"+h+" H457z";case"âŽ¢":return"M319 0 H403 V"+h+" H319z M319 0 H403 V"+h+" H319z";case"âŽ¥":return"M263 0 H347 V"+h+" H263z M263 0 H347 V"+h+" H263z";case"âŽª":return"M384 0 H504 V"+h+" H384z M384 0 H504 V"+h+" H384z";case"â":return"M312 0 H355 V"+h+" H312z M312 0 H355 V"+h+" H312z";case"â€–":return"M257 0 H300 V"+h+" H257z M257 0 H300 V"+h+" H257z"+("M478 0 H521 V"+h+" H478z M478 0 H521 V"+h+" H478z");default:return""}},De={doubleleftarrow:`M262 157
l10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3
 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28
 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5
c2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5
 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87
-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7
-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z
m8 0v40h399730v-40zm0 194v40h399730v-40z`,doublerightarrow:`M399738 392l
-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5
 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88
-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68
-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18
-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782
c-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3
-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z`,leftarrow:`M400000 241H110l3-3c68.7-52.7 113.7-120
 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8
-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247
c-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208
 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3
 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202
 l-3-3h399890zM100 241v40h399900v-40z`,leftbrace:`M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z`,leftbraceunder:`M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z`,leftgroup:`M400000 80
H435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0
 435 0h399565z`,leftgroupunder:`M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z`,leftharpoon:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3
-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5
-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7
-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z`,leftharpoonplus:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5
 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3
-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7
-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z
m0 0v40h400000v-40z`,leftharpoondown:`M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333
 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5
 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667
-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z`,leftharpoondownplus:`M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12
 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7
-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0
v40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z`,lefthook:`M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5
-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3
-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21
 71.5 23h399859zM103 281v-40h399897v40z`,leftlinesegment:`M40 281 V428 H0 V94 H40 V241 H400000 v40z
M40 281 V428 H0 V94 H40 V241 H400000 v40z`,leftmapsto:`M40 281 V448H0V74H40V241H400000v40z
M40 281 V448H0V74H40V241H400000v40z`,leftToFrom:`M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23
-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8
c28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3
 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z`,longequal:`M0 50 h400000 v40H0z m0 194h40000v40H0z
M0 50 h400000 v40H0z m0 194h40000v40H0z`,midbrace:`M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z`,midbraceunder:`M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z`,oiintSize1:`M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6
-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z
m368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8
60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z`,oiintSize2:`M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8
-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z
m502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2
c0 110 84 276 504 276s502.4-166 502.4-276z`,oiiintSize1:`M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6
-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z
m525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0
85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z`,oiiintSize2:`M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8
-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z
m770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1
c0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z`,rightarrow:`M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z`,rightbrace:`M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z`,rightbraceunder:`M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z`,rightgroup:`M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0
 3-1 3-3v-38c-76-158-257-219-435-219H0z`,rightgroupunder:`M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z`,rightharpoon:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3
-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2
-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58
 69.2 92 94.5zm0 0v40h399900v-40z`,rightharpoonplus:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11
-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7
 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z
m0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z`,rightharpoondown:`M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8
 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5
-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95
-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z`,rightharpoondownplus:`M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8
 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3
 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3
-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z
m0-194v40h400000v-40zm0 0v40h400000v-40z`,righthook:`M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3
 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0
-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21
 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z`,rightlinesegment:`M399960 241 V94 h40 V428 h-40 V281 H0 v-40z
M399960 241 V94 h40 V428 h-40 V281 H0 v-40z`,rightToFrom:`M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23
 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32
-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142
-167z M100 147v40h399900v-40zM0 341v40h399900v-40z`,twoheadleftarrow:`M0 167c68 40
 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69
-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3
-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19
-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101
 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z`,twoheadrightarrow:`M400000 167
c-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3
 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42
 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333
-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70
 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z`,tilde1:`M200 55.538c-77 0-168 73.953-177 73.953-3 0-7
-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0
 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0
 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128
-68.267.847-113-73.952-191-73.952z`,tilde2:`M344 55.266c-142 0-300.638 81.316-311.5 86.418
-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9
 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114
c1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751
 181.476 676 181.476c-149 0-189-126.21-332-126.21z`,tilde3:`M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457
-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0
 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697
 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696
 -338 0-409-156.573-744-156.573z`,tilde4:`M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345
-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409
 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9
 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409
 -175.236-744-175.236z`,vec:`M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z`,widehat1:`M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z`,widehat2:`M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat3:`M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat4:`M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widecheck1:`M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,
-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z`,widecheck2:`M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck3:`M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck4:`M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,baraboveleftarrow:`M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202
c4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5
c-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130
s-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47
121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6
s2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11
c0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z
M100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z`,rightarrowabovebar:`M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32
-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0
13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39
-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5
-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z`,baraboveshortleftharpoon:`M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17
c2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21
c-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40
c-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z
M0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z`,rightharpoonaboveshortbar:`M0,241 l0,40c399126,0,399993,0,399993,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z`,shortbaraboveleftharpoon:`M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,
1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,
-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z
M93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z`,shortrightharpoonabovebar:`M53,241l0,40c398570,0,399437,0,399437,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z`},Ke=function(p,h){switch(p){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+h+` v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v`+h+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+h+` v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v`+h+" v1759 h84z";case"vert":return"M145 15 v585 v"+h+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-h+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+h+" v585 h43z";case"doublevert":return"M145 15 v585 v"+h+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-h+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+h+` v585 h43z
M367 15 v585 v`+h+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-h+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v`+h+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+h+` v1715 h263 v84 H319z
MM319 602 V0 H403 V602 v`+h+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+h+` v1799 H0 v-84 H319z
MM319 602 V0 H403 V602 v`+h+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+h+` v602 h84z
M403 1759 V0 H319 V1759 v`+h+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+h+` v602 h84z
M347 1759 V0 h-84 V1759 v`+h+" v602 h84z";case"lparen":return`M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,`+(h+84)+`c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-`+(h+92)+`c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z`;case"rparen":return`M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,`+(h+9)+`
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-`+(h+144)+`c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z`;default:throw new Error("Unknown stretchy delimiter.")}};class ve{constructor(h){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=h,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(h){return b.contains(this.classes,h)}toNode(){const h=document.createDocumentFragment();for(let f=0;f<this.children.length;f++)h.appendChild(this.children[f].toNode());return h}toMarkup(){let h="";for(let f=0;f<this.children.length;f++)h+=this.children[f].toMarkup();return h}toText(){const h=f=>f.toText();return this.children.map(h).join("")}}var Te={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}};const je={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},Fe={Ã…:"A",Ã:"D",Ãž:"o",Ã¥:"a",Ã°:"d",Ã¾:"o",Ð:"A",Ð‘:"B",Ð’:"B",Ð“:"F",Ð”:"A",Ð•:"E",Ð–:"K",Ð—:"3",Ð˜:"N",Ð™:"N",Ðš:"K",Ð›:"N",Ðœ:"M",Ð:"H",Ðž:"O",ÐŸ:"N",Ð :"P",Ð¡:"C",Ð¢:"T",Ð£:"y",Ð¤:"O",Ð¥:"X",Ð¦:"U",Ð§:"h",Ð¨:"W",Ð©:"W",Ðª:"B",Ð«:"X",Ð¬:"B",Ð­:"3",Ð®:"X",Ð¯:"R",Ð°:"a",Ð±:"b",Ð²:"a",Ð³:"r",Ð´:"y",Ðµ:"e",Ð¶:"m",Ð·:"e",Ð¸:"n",Ð¹:"n",Ðº:"n",Ð»:"n",Ð¼:"m",Ð½:"n",Ð¾:"o",Ð¿:"n",Ñ€:"p",Ñ:"c",Ñ‚:"o",Ñƒ:"y",Ñ„:"b",Ñ…:"x",Ñ†:"n",Ñ‡:"n",Ñˆ:"w",Ñ‰:"w",ÑŠ:"a",Ñ‹:"m",ÑŒ:"a",Ñ:"e",ÑŽ:"m",Ñ:"r"};function Ue(p,h){Te[p]=h}function Je(p,h,f){if(!Te[h])throw new Error("Font metrics not found for font: "+h+".");let x=p.charCodeAt(0),j=Te[h][x];if(!j&&p[0]in Fe&&(x=Fe[p[0]].charCodeAt(0),j=Te[h][x]),!j&&f==="text"&&Se(x)&&(j=Te[h][77]),j)return{depth:j[0],height:j[1],italic:j[2],skew:j[3],width:j[4]}}const ut={};function Ze(p){let h;if(p>=5?h=0:p>=3?h=1:h=2,!ut[h]){const f=ut[h]={cssEmPerMu:je.quad[h]/18};for(const x in je)je.hasOwnProperty(x)&&(f[x]=je[x][h])}return ut[h]}const At=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],gr=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],vr=function(p,h){return h.size<2?p:At[p-1][h.size-1]};class yr{constructor(h){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=h.style,this.color=h.color,this.size=h.size||yr.BASESIZE,this.textSize=h.textSize||this.size,this.phantom=!!h.phantom,this.font=h.font||"",this.fontFamily=h.fontFamily||"",this.fontWeight=h.fontWeight||"",this.fontShape=h.fontShape||"",this.sizeMultiplier=gr[this.size-1],this.maxSize=h.maxSize,this.minRuleThickness=h.minRuleThickness,this._fontMetrics=void 0}extend(h){const f={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(const x in h)h.hasOwnProperty(x)&&(f[x]=h[x]);return new yr(f)}havingStyle(h){return this.style===h?this:this.extend({style:h,size:vr(this.textSize,h)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(h){return this.size===h&&this.textSize===h?this:this.extend({style:this.style.text(),size:h,textSize:h,sizeMultiplier:gr[h-1]})}havingBaseStyle(h){h=h||this.style.text();const f=vr(yr.BASESIZE,h);return this.size===f&&this.textSize===yr.BASESIZE&&this.style===h?this:this.extend({style:h,size:f})}havingBaseSizing(){let h;switch(this.style.id){case 4:case 5:h=3;break;case 6:case 7:h=1;break;default:h=6}return this.extend({style:this.style.text(),size:h})}withColor(h){return this.extend({color:h})}withPhantom(){return this.extend({phantom:!0})}withFont(h){return this.extend({font:h})}withTextFontFamily(h){return this.extend({fontFamily:h,font:""})}withTextFontWeight(h){return this.extend({fontWeight:h,font:""})}withTextFontShape(h){return this.extend({fontShape:h,font:""})}sizingClasses(h){return h.size!==this.size?["sizing","reset-size"+h.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==yr.BASESIZE?["sizing","reset-size"+this.size,"size"+yr.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=Ze(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}yr.BASESIZE=6;var gt=yr;const Dt={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:803/800,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:803/800},Ct={ex:!0,em:!0,mu:!0},Qt=function(p){return typeof p!="string"&&(p=p.unit),p in Dt||p in Ct||p==="ex"},Zt=function(p,h){let f;if(p.unit in Dt)f=Dt[p.unit]/h.fontMetrics().ptPerEm/h.sizeMultiplier;else if(p.unit==="mu")f=h.fontMetrics().cssEmPerMu;else{let x;if(h.style.isTight()?x=h.havingStyle(h.style.text()):x=h,p.unit==="ex")f=x.fontMetrics().xHeight;else if(p.unit==="em")f=x.fontMetrics().quad;else throw new i("Invalid unit: '"+p.unit+"'");x!==h&&(f*=x.sizeMultiplier/h.sizeMultiplier)}return Math.min(p.number*f,h.maxSize)},at=function(p){return+p.toFixed(4)+"em"},Q=function(p){return p.filter(h=>h).join(" ")},Ae=function(p,h,f){if(this.classes=p||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=f||{},h){h.style.isTight()&&this.classes.push("mtight");const x=h.getColor();x&&(this.style.color=x)}},oe=function(p){const h=document.createElement(p);h.className=Q(this.classes);for(const f in this.style)this.style.hasOwnProperty(f)&&(h.style[f]=this.style[f]);for(const f in this.attributes)this.attributes.hasOwnProperty(f)&&h.setAttribute(f,this.attributes[f]);for(let f=0;f<this.children.length;f++)h.appendChild(this.children[f].toNode());return h},Ne=/[\s"'>/=\x00-\x1f]/,st=function(p){let h="<"+p;this.classes.length&&(h+=' class="'+b.escape(Q(this.classes))+'"');let f="";for(const x in this.style)this.style.hasOwnProperty(x)&&(f+=b.hyphenate(x)+":"+this.style[x]+";");f&&(h+=' style="'+b.escape(f)+'"');for(const x in this.attributes)if(this.attributes.hasOwnProperty(x)){if(Ne.test(x))throw new i("Invalid attribute name '"+x+"'");h+=" "+x+'="'+b.escape(this.attributes[x])+'"'}h+=">";for(let x=0;x<this.children.length;x++)h+=this.children[x].toMarkup();return h+="</"+p+">",h};class tt{constructor(h,f,x,j){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,Ae.call(this,h,x,j),this.children=f||[]}setAttribute(h,f){this.attributes[h]=f}hasClass(h){return b.contains(this.classes,h)}toNode(){return oe.call(this,"span")}toMarkup(){return st.call(this,"span")}}class Ie{constructor(h,f,x,j){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,Ae.call(this,f,j),this.children=x||[],this.setAttribute("href",h)}setAttribute(h,f){this.attributes[h]=f}hasClass(h){return b.contains(this.classes,h)}toNode(){return oe.call(this,"a")}toMarkup(){return st.call(this,"a")}}class We{constructor(h,f,x){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=f,this.src=h,this.classes=["mord"],this.style=x}hasClass(h){return b.contains(this.classes,h)}toNode(){const h=document.createElement("img");h.src=this.src,h.alt=this.alt,h.className="mord";for(const f in this.style)this.style.hasOwnProperty(f)&&(h.style[f]=this.style[f]);return h}toMarkup(){let h='<img src="'+b.escape(this.src)+'"'+(' alt="'+b.escape(this.alt)+'"'),f="";for(const x in this.style)this.style.hasOwnProperty(x)&&(f+=b.hyphenate(x)+":"+this.style[x]+";");return f&&(h+=' style="'+b.escape(f)+'"'),h+="'/>",h}}const lt={Ã®:"Ä±Ì‚",Ã¯:"Ä±Ìˆ",Ã­:"Ä±Ì",Ã¬:"Ä±Ì€"};class Et{constructor(h,f,x,j,D,F,H,re){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=h,this.height=f||0,this.depth=x||0,this.italic=j||0,this.skew=D||0,this.width=F||0,this.classes=H||[],this.style=re||{},this.maxFontSize=0;const we=ee(this.text.charCodeAt(0));we&&this.classes.push(we+"_fallback"),/[Ã®Ã¯Ã­Ã¬]/.test(this.text)&&(this.text=lt[this.text])}hasClass(h){return b.contains(this.classes,h)}toNode(){const h=document.createTextNode(this.text);let f=null;this.italic>0&&(f=document.createElement("span"),f.style.marginRight=at(this.italic)),this.classes.length>0&&(f=f||document.createElement("span"),f.className=Q(this.classes));for(const x in this.style)this.style.hasOwnProperty(x)&&(f=f||document.createElement("span"),f.style[x]=this.style[x]);return f?(f.appendChild(h),f):h}toMarkup(){let h=!1,f="<span";this.classes.length&&(h=!0,f+=' class="',f+=b.escape(Q(this.classes)),f+='"');let x="";this.italic>0&&(x+="margin-right:"+this.italic+"em;");for(const D in this.style)this.style.hasOwnProperty(D)&&(x+=b.hyphenate(D)+":"+this.style[D]+";");x&&(h=!0,f+=' style="'+b.escape(x)+'"');const j=b.escape(this.text);return h?(f+=">",f+=j,f+="</span>",f):j}}class et{constructor(h,f){this.children=void 0,this.attributes=void 0,this.children=h||[],this.attributes=f||{}}toNode(){const f=document.createElementNS("http://www.w3.org/2000/svg","svg");for(const x in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,x)&&f.setAttribute(x,this.attributes[x]);for(let x=0;x<this.children.length;x++)f.appendChild(this.children[x].toNode());return f}toMarkup(){let h='<svg xmlns="http://www.w3.org/2000/svg"';for(const f in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,f)&&(h+=" "+f+'="'+b.escape(this.attributes[f])+'"');h+=">";for(let f=0;f<this.children.length;f++)h+=this.children[f].toMarkup();return h+="</svg>",h}}class pt{constructor(h,f){this.pathName=void 0,this.alternate=void 0,this.pathName=h,this.alternate=f}toNode(){const f=document.createElementNS("http://www.w3.org/2000/svg","path");return this.alternate?f.setAttribute("d",this.alternate):f.setAttribute("d",De[this.pathName]),f}toMarkup(){return this.alternate?'<path d="'+b.escape(this.alternate)+'"/>':'<path d="'+b.escape(De[this.pathName])+'"/>'}}class Wt{constructor(h){this.attributes=void 0,this.attributes=h||{}}toNode(){const f=document.createElementNS("http://www.w3.org/2000/svg","line");for(const x in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,x)&&f.setAttribute(x,this.attributes[x]);return f}toMarkup(){let h="<line";for(const f in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,f)&&(h+=" "+f+'="'+b.escape(this.attributes[f])+'"');return h+="/>",h}}function In(p){if(p instanceof Et)return p;throw new Error("Expected symbolNode but got "+String(p)+".")}function Mn(p){if(p instanceof tt)return p;throw new Error("Expected span<HtmlDomNode> but got "+String(p)+".")}const An={bin:1,close:1,inner:1,open:1,punct:1,rel:1},ts={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},jn={math:{},text:{}};var Be=jn;function w(p,h,f,x,j,D){jn[p][j]={font:h,group:f,replace:x},D&&x&&(jn[p][x]=jn[p][j])}const N="math",Le="text",V="main",ae="ams",er="accent-token",it="bin",Ar="close",yn="inner",kt="mathord",sr="op-token",Re="open",Ge="punct",q="rel",bt="spacing",pe="textord";w(N,V,q,"â‰¡","\\equiv",!0),w(N,V,q,"â‰º","\\prec",!0),w(N,V,q,"â‰»","\\succ",!0),w(N,V,q,"âˆ¼","\\sim",!0),w(N,V,q,"âŠ¥","\\perp"),w(N,V,q,"âª¯","\\preceq",!0),w(N,V,q,"âª°","\\succeq",!0),w(N,V,q,"â‰ƒ","\\simeq",!0),w(N,V,q,"âˆ£","\\mid",!0),w(N,V,q,"â‰ª","\\ll",!0),w(N,V,q,"â‰«","\\gg",!0),w(N,V,q,"â‰","\\asymp",!0),w(N,V,q,"âˆ¥","\\parallel"),w(N,V,q,"â‹ˆ","\\bowtie",!0),w(N,V,q,"âŒ£","\\smile",!0),w(N,V,q,"âŠ‘","\\sqsubseteq",!0),w(N,V,q,"âŠ’","\\sqsupseteq",!0),w(N,V,q,"â‰","\\doteq",!0),w(N,V,q,"âŒ¢","\\frown",!0),w(N,V,q,"âˆ‹","\\ni",!0),w(N,V,q,"âˆ","\\propto",!0),w(N,V,q,"âŠ¢","\\vdash",!0),w(N,V,q,"âŠ£","\\dashv",!0),w(N,V,q,"âˆ‹","\\owns"),w(N,V,Ge,".","\\ldotp"),w(N,V,Ge,"â‹…","\\cdotp"),w(N,V,pe,"#","\\#"),w(Le,V,pe,"#","\\#"),w(N,V,pe,"&","\\&"),w(Le,V,pe,"&","\\&"),w(N,V,pe,"â„µ","\\aleph",!0),w(N,V,pe,"âˆ€","\\forall",!0),w(N,V,pe,"â„","\\hbar",!0),w(N,V,pe,"âˆƒ","\\exists",!0),w(N,V,pe,"âˆ‡","\\nabla",!0),w(N,V,pe,"â™­","\\flat",!0),w(N,V,pe,"â„“","\\ell",!0),w(N,V,pe,"â™®","\\natural",!0),w(N,V,pe,"â™£","\\clubsuit",!0),w(N,V,pe,"â„˜","\\wp",!0),w(N,V,pe,"â™¯","\\sharp",!0),w(N,V,pe,"â™¢","\\diamondsuit",!0),w(N,V,pe,"â„œ","\\Re",!0),w(N,V,pe,"â™¡","\\heartsuit",!0),w(N,V,pe,"â„‘","\\Im",!0),w(N,V,pe,"â™ ","\\spadesuit",!0),w(N,V,pe,"Â§","\\S",!0),w(Le,V,pe,"Â§","\\S"),w(N,V,pe,"Â¶","\\P",!0),w(Le,V,pe,"Â¶","\\P"),w(N,V,pe,"â€ ","\\dag"),w(Le,V,pe,"â€ ","\\dag"),w(Le,V,pe,"â€ ","\\textdagger"),w(N,V,pe,"â€¡","\\ddag"),w(Le,V,pe,"â€¡","\\ddag"),w(Le,V,pe,"â€¡","\\textdaggerdbl"),w(N,V,Ar,"âŽ±","\\rmoustache",!0),w(N,V,Re,"âŽ°","\\lmoustache",!0),w(N,V,Ar,"âŸ¯","\\rgroup",!0),w(N,V,Re,"âŸ®","\\lgroup",!0),w(N,V,it,"âˆ“","\\mp",!0),w(N,V,it,"âŠ–","\\ominus",!0),w(N,V,it,"âŠŽ","\\uplus",!0),w(N,V,it,"âŠ“","\\sqcap",!0),w(N,V,it,"âˆ—","\\ast"),w(N,V,it,"âŠ”","\\sqcup",!0),w(N,V,it,"â—¯","\\bigcirc",!0),w(N,V,it,"âˆ™","\\bullet",!0),w(N,V,it,"â€¡","\\ddagger"),w(N,V,it,"â‰€","\\wr",!0),w(N,V,it,"â¨¿","\\amalg"),w(N,V,it,"&","\\And"),w(N,V,q,"âŸµ","\\longleftarrow",!0),w(N,V,q,"â‡","\\Leftarrow",!0),w(N,V,q,"âŸ¸","\\Longleftarrow",!0),w(N,V,q,"âŸ¶","\\longrightarrow",!0),w(N,V,q,"â‡’","\\Rightarrow",!0),w(N,V,q,"âŸ¹","\\Longrightarrow",!0),w(N,V,q,"â†”","\\leftrightarrow",!0),w(N,V,q,"âŸ·","\\longleftrightarrow",!0),w(N,V,q,"â‡”","\\Leftrightarrow",!0),w(N,V,q,"âŸº","\\Longleftrightarrow",!0),w(N,V,q,"â†¦","\\mapsto",!0),w(N,V,q,"âŸ¼","\\longmapsto",!0),w(N,V,q,"â†—","\\nearrow",!0),w(N,V,q,"â†©","\\hookleftarrow",!0),w(N,V,q,"â†ª","\\hookrightarrow",!0),w(N,V,q,"â†˜","\\searrow",!0),w(N,V,q,"â†¼","\\leftharpoonup",!0),w(N,V,q,"â‡€","\\rightharpoonup",!0),w(N,V,q,"â†™","\\swarrow",!0),w(N,V,q,"â†½","\\leftharpoondown",!0),w(N,V,q,"â‡","\\rightharpoondown",!0),w(N,V,q,"â†–","\\nwarrow",!0),w(N,V,q,"â‡Œ","\\rightleftharpoons",!0),w(N,ae,q,"â‰®","\\nless",!0),w(N,ae,q,"î€","\\@nleqslant"),w(N,ae,q,"î€‘","\\@nleqq"),w(N,ae,q,"âª‡","\\lneq",!0),w(N,ae,q,"â‰¨","\\lneqq",!0),w(N,ae,q,"î€Œ","\\@lvertneqq"),w(N,ae,q,"â‹¦","\\lnsim",!0),w(N,ae,q,"âª‰","\\lnapprox",!0),w(N,ae,q,"âŠ€","\\nprec",!0),w(N,ae,q,"â‹ ","\\npreceq",!0),w(N,ae,q,"â‹¨","\\precnsim",!0),w(N,ae,q,"âª¹","\\precnapprox",!0),w(N,ae,q,"â‰","\\nsim",!0),w(N,ae,q,"î€†","\\@nshortmid"),w(N,ae,q,"âˆ¤","\\nmid",!0),w(N,ae,q,"âŠ¬","\\nvdash",!0),w(N,ae,q,"âŠ­","\\nvDash",!0),w(N,ae,q,"â‹ª","\\ntriangleleft"),w(N,ae,q,"â‹¬","\\ntrianglelefteq",!0),w(N,ae,q,"âŠŠ","\\subsetneq",!0),w(N,ae,q,"î€š","\\@varsubsetneq"),w(N,ae,q,"â«‹","\\subsetneqq",!0),w(N,ae,q,"î€—","\\@varsubsetneqq"),w(N,ae,q,"â‰¯","\\ngtr",!0),w(N,ae,q,"î€","\\@ngeqslant"),w(N,ae,q,"î€Ž","\\@ngeqq"),w(N,ae,q,"âªˆ","\\gneq",!0),w(N,ae,q,"â‰©","\\gneqq",!0),w(N,ae,q,"î€","\\@gvertneqq"),w(N,ae,q,"â‹§","\\gnsim",!0),w(N,ae,q,"âªŠ","\\gnapprox",!0),w(N,ae,q,"âŠ","\\nsucc",!0),w(N,ae,q,"â‹¡","\\nsucceq",!0),w(N,ae,q,"â‹©","\\succnsim",!0),w(N,ae,q,"âªº","\\succnapprox",!0),w(N,ae,q,"â‰†","\\ncong",!0),w(N,ae,q,"î€‡","\\@nshortparallel"),w(N,ae,q,"âˆ¦","\\nparallel",!0),w(N,ae,q,"âŠ¯","\\nVDash",!0),w(N,ae,q,"â‹«","\\ntriangleright"),w(N,ae,q,"â‹­","\\ntrianglerighteq",!0),w(N,ae,q,"î€˜","\\@nsupseteqq"),w(N,ae,q,"âŠ‹","\\supsetneq",!0),w(N,ae,q,"î€›","\\@varsupsetneq"),w(N,ae,q,"â«Œ","\\supsetneqq",!0),w(N,ae,q,"î€™","\\@varsupsetneqq"),w(N,ae,q,"âŠ®","\\nVdash",!0),w(N,ae,q,"âªµ","\\precneqq",!0),w(N,ae,q,"âª¶","\\succneqq",!0),w(N,ae,q,"î€–","\\@nsubseteqq"),w(N,ae,it,"âŠ´","\\unlhd"),w(N,ae,it,"âŠµ","\\unrhd"),w(N,ae,q,"â†š","\\nleftarrow",!0),w(N,ae,q,"â†›","\\nrightarrow",!0),w(N,ae,q,"â‡","\\nLeftarrow",!0),w(N,ae,q,"â‡","\\nRightarrow",!0),w(N,ae,q,"â†®","\\nleftrightarrow",!0),w(N,ae,q,"â‡Ž","\\nLeftrightarrow",!0),w(N,ae,q,"â–³","\\vartriangle"),w(N,ae,pe,"â„","\\hslash"),w(N,ae,pe,"â–½","\\triangledown"),w(N,ae,pe,"â—Š","\\lozenge"),w(N,ae,pe,"â“ˆ","\\circledS"),w(N,ae,pe,"Â®","\\circledR"),w(Le,ae,pe,"Â®","\\circledR"),w(N,ae,pe,"âˆ¡","\\measuredangle",!0),w(N,ae,pe,"âˆ„","\\nexists"),w(N,ae,pe,"â„§","\\mho"),w(N,ae,pe,"â„²","\\Finv",!0),w(N,ae,pe,"â…","\\Game",!0),w(N,ae,pe,"â€µ","\\backprime"),w(N,ae,pe,"â–²","\\blacktriangle"),w(N,ae,pe,"â–¼","\\blacktriangledown"),w(N,ae,pe,"â– ","\\blacksquare"),w(N,ae,pe,"â§«","\\blacklozenge"),w(N,ae,pe,"â˜…","\\bigstar"),w(N,ae,pe,"âˆ¢","\\sphericalangle",!0),w(N,ae,pe,"âˆ","\\complement",!0),w(N,ae,pe,"Ã°","\\eth",!0),w(Le,V,pe,"Ã°","Ã°"),w(N,ae,pe,"â•±","\\diagup"),w(N,ae,pe,"â•²","\\diagdown"),w(N,ae,pe,"â–¡","\\square"),w(N,ae,pe,"â–¡","\\Box"),w(N,ae,pe,"â—Š","\\Diamond"),w(N,ae,pe,"Â¥","\\yen",!0),w(Le,ae,pe,"Â¥","\\yen",!0),w(N,ae,pe,"âœ“","\\checkmark",!0),w(Le,ae,pe,"âœ“","\\checkmark"),w(N,ae,pe,"â„¶","\\beth",!0),w(N,ae,pe,"â„¸","\\daleth",!0),w(N,ae,pe,"â„·","\\gimel",!0),w(N,ae,pe,"Ï","\\digamma",!0),w(N,ae,pe,"Ï°","\\varkappa"),w(N,ae,Re,"â”Œ","\\@ulcorner",!0),w(N,ae,Ar,"â”","\\@urcorner",!0),w(N,ae,Re,"â””","\\@llcorner",!0),w(N,ae,Ar,"â”˜","\\@lrcorner",!0),w(N,ae,q,"â‰¦","\\leqq",!0),w(N,ae,q,"â©½","\\leqslant",!0),w(N,ae,q,"âª•","\\eqslantless",!0),w(N,ae,q,"â‰²","\\lesssim",!0),w(N,ae,q,"âª…","\\lessapprox",!0),w(N,ae,q,"â‰Š","\\approxeq",!0),w(N,ae,it,"â‹–","\\lessdot"),w(N,ae,q,"â‹˜","\\lll",!0),w(N,ae,q,"â‰¶","\\lessgtr",!0),w(N,ae,q,"â‹š","\\lesseqgtr",!0),w(N,ae,q,"âª‹","\\lesseqqgtr",!0),w(N,ae,q,"â‰‘","\\doteqdot"),w(N,ae,q,"â‰“","\\risingdotseq",!0),w(N,ae,q,"â‰’","\\fallingdotseq",!0),w(N,ae,q,"âˆ½","\\backsim",!0),w(N,ae,q,"â‹","\\backsimeq",!0),w(N,ae,q,"â«…","\\subseteqq",!0),w(N,ae,q,"â‹","\\Subset",!0),w(N,ae,q,"âŠ","\\sqsubset",!0),w(N,ae,q,"â‰¼","\\preccurlyeq",!0),w(N,ae,q,"â‹ž","\\curlyeqprec",!0),w(N,ae,q,"â‰¾","\\precsim",!0),w(N,ae,q,"âª·","\\precapprox",!0),w(N,ae,q,"âŠ²","\\vartriangleleft"),w(N,ae,q,"âŠ´","\\trianglelefteq"),w(N,ae,q,"âŠ¨","\\vDash",!0),w(N,ae,q,"âŠª","\\Vvdash",!0),w(N,ae,q,"âŒ£","\\smallsmile"),w(N,ae,q,"âŒ¢","\\smallfrown"),w(N,ae,q,"â‰","\\bumpeq",!0),w(N,ae,q,"â‰Ž","\\Bumpeq",!0),w(N,ae,q,"â‰§","\\geqq",!0),w(N,ae,q,"â©¾","\\geqslant",!0),w(N,ae,q,"âª–","\\eqslantgtr",!0),w(N,ae,q,"â‰³","\\gtrsim",!0),w(N,ae,q,"âª†","\\gtrapprox",!0),w(N,ae,it,"â‹—","\\gtrdot"),w(N,ae,q,"â‹™","\\ggg",!0),w(N,ae,q,"â‰·","\\gtrless",!0),w(N,ae,q,"â‹›","\\gtreqless",!0),w(N,ae,q,"âªŒ","\\gtreqqless",!0),w(N,ae,q,"â‰–","\\eqcirc",!0),w(N,ae,q,"â‰—","\\circeq",!0),w(N,ae,q,"â‰œ","\\triangleq",!0),w(N,ae,q,"âˆ¼","\\thicksim"),w(N,ae,q,"â‰ˆ","\\thickapprox"),w(N,ae,q,"â«†","\\supseteqq",!0),w(N,ae,q,"â‹‘","\\Supset",!0),w(N,ae,q,"âŠ","\\sqsupset",!0),w(N,ae,q,"â‰½","\\succcurlyeq",!0),w(N,ae,q,"â‹Ÿ","\\curlyeqsucc",!0),w(N,ae,q,"â‰¿","\\succsim",!0),w(N,ae,q,"âª¸","\\succapprox",!0),w(N,ae,q,"âŠ³","\\vartriangleright"),w(N,ae,q,"âŠµ","\\trianglerighteq"),w(N,ae,q,"âŠ©","\\Vdash",!0),w(N,ae,q,"âˆ£","\\shortmid"),w(N,ae,q,"âˆ¥","\\shortparallel"),w(N,ae,q,"â‰¬","\\between",!0),w(N,ae,q,"â‹”","\\pitchfork",!0),w(N,ae,q,"âˆ","\\varpropto"),w(N,ae,q,"â—€","\\blacktriangleleft"),w(N,ae,q,"âˆ´","\\therefore",!0),w(N,ae,q,"âˆ","\\backepsilon"),w(N,ae,q,"â–¶","\\blacktriangleright"),w(N,ae,q,"âˆµ","\\because",!0),w(N,ae,q,"â‹˜","\\llless"),w(N,ae,q,"â‹™","\\gggtr"),w(N,ae,it,"âŠ²","\\lhd"),w(N,ae,it,"âŠ³","\\rhd"),w(N,ae,q,"â‰‚","\\eqsim",!0),w(N,V,q,"â‹ˆ","\\Join"),w(N,ae,q,"â‰‘","\\Doteq",!0),w(N,ae,it,"âˆ”","\\dotplus",!0),w(N,ae,it,"âˆ–","\\smallsetminus"),w(N,ae,it,"â‹’","\\Cap",!0),w(N,ae,it,"â‹“","\\Cup",!0),w(N,ae,it,"â©ž","\\doublebarwedge",!0),w(N,ae,it,"âŠŸ","\\boxminus",!0),w(N,ae,it,"âŠž","\\boxplus",!0),w(N,ae,it,"â‹‡","\\divideontimes",!0),w(N,ae,it,"â‹‰","\\ltimes",!0),w(N,ae,it,"â‹Š","\\rtimes",!0),w(N,ae,it,"â‹‹","\\leftthreetimes",!0),w(N,ae,it,"â‹Œ","\\rightthreetimes",!0),w(N,ae,it,"â‹","\\curlywedge",!0),w(N,ae,it,"â‹Ž","\\curlyvee",!0),w(N,ae,it,"âŠ","\\circleddash",!0),w(N,ae,it,"âŠ›","\\circledast",!0),w(N,ae,it,"â‹…","\\centerdot"),w(N,ae,it,"âŠº","\\intercal",!0),w(N,ae,it,"â‹’","\\doublecap"),w(N,ae,it,"â‹“","\\doublecup"),w(N,ae,it,"âŠ ","\\boxtimes",!0),w(N,ae,q,"â‡¢","\\dashrightarrow",!0),w(N,ae,q,"â‡ ","\\dashleftarrow",!0),w(N,ae,q,"â‡‡","\\leftleftarrows",!0),w(N,ae,q,"â‡†","\\leftrightarrows",!0),w(N,ae,q,"â‡š","\\Lleftarrow",!0),w(N,ae,q,"â†ž","\\twoheadleftarrow",!0),w(N,ae,q,"â†¢","\\leftarrowtail",!0),w(N,ae,q,"â†«","\\looparrowleft",!0),w(N,ae,q,"â‡‹","\\leftrightharpoons",!0),w(N,ae,q,"â†¶","\\curvearrowleft",!0),w(N,ae,q,"â†º","\\circlearrowleft",!0),w(N,ae,q,"â†°","\\Lsh",!0),w(N,ae,q,"â‡ˆ","\\upuparrows",!0),w(N,ae,q,"â†¿","\\upharpoonleft",!0),w(N,ae,q,"â‡ƒ","\\downharpoonleft",!0),w(N,V,q,"âŠ¶","\\origof",!0),w(N,V,q,"âŠ·","\\imageof",!0),w(N,ae,q,"âŠ¸","\\multimap",!0),w(N,ae,q,"â†­","\\leftrightsquigarrow",!0),w(N,ae,q,"â‡‰","\\rightrightarrows",!0),w(N,ae,q,"â‡„","\\rightleftarrows",!0),w(N,ae,q,"â† ","\\twoheadrightarrow",!0),w(N,ae,q,"â†£","\\rightarrowtail",!0),w(N,ae,q,"â†¬","\\looparrowright",!0),w(N,ae,q,"â†·","\\curvearrowright",!0),w(N,ae,q,"â†»","\\circlearrowright",!0),w(N,ae,q,"â†±","\\Rsh",!0),w(N,ae,q,"â‡Š","\\downdownarrows",!0),w(N,ae,q,"â†¾","\\upharpoonright",!0),w(N,ae,q,"â‡‚","\\downharpoonright",!0),w(N,ae,q,"â‡","\\rightsquigarrow",!0),w(N,ae,q,"â‡","\\leadsto"),w(N,ae,q,"â‡›","\\Rrightarrow",!0),w(N,ae,q,"â†¾","\\restriction"),w(N,V,pe,"â€˜","`"),w(N,V,pe,"$","\\$"),w(Le,V,pe,"$","\\$"),w(Le,V,pe,"$","\\textdollar"),w(N,V,pe,"%","\\%"),w(Le,V,pe,"%","\\%"),w(N,V,pe,"_","\\_"),w(Le,V,pe,"_","\\_"),w(Le,V,pe,"_","\\textunderscore"),w(N,V,pe,"âˆ ","\\angle",!0),w(N,V,pe,"âˆž","\\infty",!0),w(N,V,pe,"â€²","\\prime"),w(N,V,pe,"â–³","\\triangle"),w(N,V,pe,"Î“","\\Gamma",!0),w(N,V,pe,"Î”","\\Delta",!0),w(N,V,pe,"Î˜","\\Theta",!0),w(N,V,pe,"Î›","\\Lambda",!0),w(N,V,pe,"Îž","\\Xi",!0),w(N,V,pe,"Î ","\\Pi",!0),w(N,V,pe,"Î£","\\Sigma",!0),w(N,V,pe,"Î¥","\\Upsilon",!0),w(N,V,pe,"Î¦","\\Phi",!0),w(N,V,pe,"Î¨","\\Psi",!0),w(N,V,pe,"Î©","\\Omega",!0),w(N,V,pe,"A","Î‘"),w(N,V,pe,"B","Î’"),w(N,V,pe,"E","Î•"),w(N,V,pe,"Z","Î–"),w(N,V,pe,"H","Î—"),w(N,V,pe,"I","Î™"),w(N,V,pe,"K","Îš"),w(N,V,pe,"M","Îœ"),w(N,V,pe,"N","Î"),w(N,V,pe,"O","ÎŸ"),w(N,V,pe,"P","Î¡"),w(N,V,pe,"T","Î¤"),w(N,V,pe,"X","Î§"),w(N,V,pe,"Â¬","\\neg",!0),w(N,V,pe,"Â¬","\\lnot"),w(N,V,pe,"âŠ¤","\\top"),w(N,V,pe,"âŠ¥","\\bot"),w(N,V,pe,"âˆ…","\\emptyset"),w(N,ae,pe,"âˆ…","\\varnothing"),w(N,V,kt,"Î±","\\alpha",!0),w(N,V,kt,"Î²","\\beta",!0),w(N,V,kt,"Î³","\\gamma",!0),w(N,V,kt,"Î´","\\delta",!0),w(N,V,kt,"Ïµ","\\epsilon",!0),w(N,V,kt,"Î¶","\\zeta",!0),w(N,V,kt,"Î·","\\eta",!0),w(N,V,kt,"Î¸","\\theta",!0),w(N,V,kt,"Î¹","\\iota",!0),w(N,V,kt,"Îº","\\kappa",!0),w(N,V,kt,"Î»","\\lambda",!0),w(N,V,kt,"Î¼","\\mu",!0),w(N,V,kt,"Î½","\\nu",!0),w(N,V,kt,"Î¾","\\xi",!0),w(N,V,kt,"Î¿","\\omicron",!0),w(N,V,kt,"Ï€","\\pi",!0),w(N,V,kt,"Ï","\\rho",!0),w(N,V,kt,"Ïƒ","\\sigma",!0),w(N,V,kt,"Ï„","\\tau",!0),w(N,V,kt,"Ï…","\\upsilon",!0),w(N,V,kt,"Ï•","\\phi",!0),w(N,V,kt,"Ï‡","\\chi",!0),w(N,V,kt,"Ïˆ","\\psi",!0),w(N,V,kt,"Ï‰","\\omega",!0),w(N,V,kt,"Îµ","\\varepsilon",!0),w(N,V,kt,"Ï‘","\\vartheta",!0),w(N,V,kt,"Ï–","\\varpi",!0),w(N,V,kt,"Ï±","\\varrho",!0),w(N,V,kt,"Ï‚","\\varsigma",!0),w(N,V,kt,"Ï†","\\varphi",!0),w(N,V,it,"âˆ—","*",!0),w(N,V,it,"+","+"),w(N,V,it,"âˆ’","-",!0),w(N,V,it,"â‹…","\\cdot",!0),w(N,V,it,"âˆ˜","\\circ",!0),w(N,V,it,"Ã·","\\div",!0),w(N,V,it,"Â±","\\pm",!0),w(N,V,it,"Ã—","\\times",!0),w(N,V,it,"âˆ©","\\cap",!0),w(N,V,it,"âˆª","\\cup",!0),w(N,V,it,"âˆ–","\\setminus",!0),w(N,V,it,"âˆ§","\\land"),w(N,V,it,"âˆ¨","\\lor"),w(N,V,it,"âˆ§","\\wedge",!0),w(N,V,it,"âˆ¨","\\vee",!0),w(N,V,pe,"âˆš","\\surd"),w(N,V,Re,"âŸ¨","\\langle",!0),w(N,V,Re,"âˆ£","\\lvert"),w(N,V,Re,"âˆ¥","\\lVert"),w(N,V,Ar,"?","?"),w(N,V,Ar,"!","!"),w(N,V,Ar,"âŸ©","\\rangle",!0),w(N,V,Ar,"âˆ£","\\rvert"),w(N,V,Ar,"âˆ¥","\\rVert"),w(N,V,q,"=","="),w(N,V,q,":",":"),w(N,V,q,"â‰ˆ","\\approx",!0),w(N,V,q,"â‰…","\\cong",!0),w(N,V,q,"â‰¥","\\ge"),w(N,V,q,"â‰¥","\\geq",!0),w(N,V,q,"â†","\\gets"),w(N,V,q,">","\\gt",!0),w(N,V,q,"âˆˆ","\\in",!0),w(N,V,q,"î€ ","\\@not"),w(N,V,q,"âŠ‚","\\subset",!0),w(N,V,q,"âŠƒ","\\supset",!0),w(N,V,q,"âŠ†","\\subseteq",!0),w(N,V,q,"âŠ‡","\\supseteq",!0),w(N,ae,q,"âŠˆ","\\nsubseteq",!0),w(N,ae,q,"âŠ‰","\\nsupseteq",!0),w(N,V,q,"âŠ¨","\\models"),w(N,V,q,"â†","\\leftarrow",!0),w(N,V,q,"â‰¤","\\le"),w(N,V,q,"â‰¤","\\leq",!0),w(N,V,q,"<","\\lt",!0),w(N,V,q,"â†’","\\rightarrow",!0),w(N,V,q,"â†’","\\to"),w(N,ae,q,"â‰±","\\ngeq",!0),w(N,ae,q,"â‰°","\\nleq",!0),w(N,V,bt,"Â ","\\ "),w(N,V,bt,"Â ","\\space"),w(N,V,bt,"Â ","\\nobreakspace"),w(Le,V,bt,"Â ","\\ "),w(Le,V,bt,"Â "," "),w(Le,V,bt,"Â ","\\space"),w(Le,V,bt,"Â ","\\nobreakspace"),w(N,V,bt,null,"\\nobreak"),w(N,V,bt,null,"\\allowbreak"),w(N,V,Ge,",",","),w(N,V,Ge,";",";"),w(N,ae,it,"âŠ¼","\\barwedge",!0),w(N,ae,it,"âŠ»","\\veebar",!0),w(N,V,it,"âŠ™","\\odot",!0),w(N,V,it,"âŠ•","\\oplus",!0),w(N,V,it,"âŠ—","\\otimes",!0),w(N,V,pe,"âˆ‚","\\partial",!0),w(N,V,it,"âŠ˜","\\oslash",!0),w(N,ae,it,"âŠš","\\circledcirc",!0),w(N,ae,it,"âŠ¡","\\boxdot",!0),w(N,V,it,"â–³","\\bigtriangleup"),w(N,V,it,"â–½","\\bigtriangledown"),w(N,V,it,"â€ ","\\dagger"),w(N,V,it,"â‹„","\\diamond"),w(N,V,it,"â‹†","\\star"),w(N,V,it,"â—ƒ","\\triangleleft"),w(N,V,it,"â–¹","\\triangleright"),w(N,V,Re,"{","\\{"),w(Le,V,pe,"{","\\{"),w(Le,V,pe,"{","\\textbraceleft"),w(N,V,Ar,"}","\\}"),w(Le,V,pe,"}","\\}"),w(Le,V,pe,"}","\\textbraceright"),w(N,V,Re,"{","\\lbrace"),w(N,V,Ar,"}","\\rbrace"),w(N,V,Re,"[","\\lbrack",!0),w(Le,V,pe,"[","\\lbrack",!0),w(N,V,Ar,"]","\\rbrack",!0),w(Le,V,pe,"]","\\rbrack",!0),w(N,V,Re,"(","\\lparen",!0),w(N,V,Ar,")","\\rparen",!0),w(Le,V,pe,"<","\\textless",!0),w(Le,V,pe,">","\\textgreater",!0),w(N,V,Re,"âŒŠ","\\lfloor",!0),w(N,V,Ar,"âŒ‹","\\rfloor",!0),w(N,V,Re,"âŒˆ","\\lceil",!0),w(N,V,Ar,"âŒ‰","\\rceil",!0),w(N,V,pe,"\\","\\backslash"),w(N,V,pe,"âˆ£","|"),w(N,V,pe,"âˆ£","\\vert"),w(Le,V,pe,"|","\\textbar",!0),w(N,V,pe,"âˆ¥","\\|"),w(N,V,pe,"âˆ¥","\\Vert"),w(Le,V,pe,"âˆ¥","\\textbardbl"),w(Le,V,pe,"~","\\textasciitilde"),w(Le,V,pe,"\\","\\textbackslash"),w(Le,V,pe,"^","\\textasciicircum"),w(N,V,q,"â†‘","\\uparrow",!0),w(N,V,q,"â‡‘","\\Uparrow",!0),w(N,V,q,"â†“","\\downarrow",!0),w(N,V,q,"â‡“","\\Downarrow",!0),w(N,V,q,"â†•","\\updownarrow",!0),w(N,V,q,"â‡•","\\Updownarrow",!0),w(N,V,sr,"âˆ","\\coprod"),w(N,V,sr,"â‹","\\bigvee"),w(N,V,sr,"â‹€","\\bigwedge"),w(N,V,sr,"â¨„","\\biguplus"),w(N,V,sr,"â‹‚","\\bigcap"),w(N,V,sr,"â‹ƒ","\\bigcup"),w(N,V,sr,"âˆ«","\\int"),w(N,V,sr,"âˆ«","\\intop"),w(N,V,sr,"âˆ¬","\\iint"),w(N,V,sr,"âˆ­","\\iiint"),w(N,V,sr,"âˆ","\\prod"),w(N,V,sr,"âˆ‘","\\sum"),w(N,V,sr,"â¨‚","\\bigotimes"),w(N,V,sr,"â¨","\\bigoplus"),w(N,V,sr,"â¨€","\\bigodot"),w(N,V,sr,"âˆ®","\\oint"),w(N,V,sr,"âˆ¯","\\oiint"),w(N,V,sr,"âˆ°","\\oiiint"),w(N,V,sr,"â¨†","\\bigsqcup"),w(N,V,sr,"âˆ«","\\smallint"),w(Le,V,yn,"â€¦","\\textellipsis"),w(N,V,yn,"â€¦","\\mathellipsis"),w(Le,V,yn,"â€¦","\\ldots",!0),w(N,V,yn,"â€¦","\\ldots",!0),w(N,V,yn,"â‹¯","\\@cdots",!0),w(N,V,yn,"â‹±","\\ddots",!0),w(N,V,pe,"â‹®","\\varvdots"),w(Le,V,pe,"â‹®","\\varvdots"),w(N,V,er,"ËŠ","\\acute"),w(N,V,er,"Ë‹","\\grave"),w(N,V,er,"Â¨","\\ddot"),w(N,V,er,"~","\\tilde"),w(N,V,er,"Ë‰","\\bar"),w(N,V,er,"Ë˜","\\breve"),w(N,V,er,"Ë‡","\\check"),w(N,V,er,"^","\\hat"),w(N,V,er,"âƒ—","\\vec"),w(N,V,er,"Ë™","\\dot"),w(N,V,er,"Ëš","\\mathring"),w(N,V,kt,"î„±","\\@imath"),w(N,V,kt,"îˆ·","\\@jmath"),w(N,V,pe,"Ä±","Ä±"),w(N,V,pe,"È·","È·"),w(Le,V,pe,"Ä±","\\i",!0),w(Le,V,pe,"È·","\\j",!0),w(Le,V,pe,"ÃŸ","\\ss",!0),w(Le,V,pe,"Ã¦","\\ae",!0),w(Le,V,pe,"Å“","\\oe",!0),w(Le,V,pe,"Ã¸","\\o",!0),w(Le,V,pe,"Ã†","\\AE",!0),w(Le,V,pe,"Å’","\\OE",!0),w(Le,V,pe,"Ã˜","\\O",!0),w(Le,V,er,"ËŠ","\\'"),w(Le,V,er,"Ë‹","\\`"),w(Le,V,er,"Ë†","\\^"),w(Le,V,er,"Ëœ","\\~"),w(Le,V,er,"Ë‰","\\="),w(Le,V,er,"Ë˜","\\u"),w(Le,V,er,"Ë™","\\."),w(Le,V,er,"Â¸","\\c"),w(Le,V,er,"Ëš","\\r"),w(Le,V,er,"Ë‡","\\v"),w(Le,V,er,"Â¨",'\\"'),w(Le,V,er,"Ë","\\H"),w(Le,V,er,"â—¯","\\textcircled");const me={"--":!0,"---":!0,"``":!0,"''":!0};w(Le,V,pe,"â€“","--",!0),w(Le,V,pe,"â€“","\\textendash"),w(Le,V,pe,"â€”","---",!0),w(Le,V,pe,"â€”","\\textemdash"),w(Le,V,pe,"â€˜","`",!0),w(Le,V,pe,"â€˜","\\textquoteleft"),w(Le,V,pe,"â€™","'",!0),w(Le,V,pe,"â€™","\\textquoteright"),w(Le,V,pe,"â€œ","``",!0),w(Le,V,pe,"â€œ","\\textquotedblleft"),w(Le,V,pe,"â€","''",!0),w(Le,V,pe,"â€","\\textquotedblright"),w(N,V,pe,"Â°","\\degree",!0),w(Le,V,pe,"Â°","\\degree"),w(Le,V,pe,"Â°","\\textdegree",!0),w(N,V,pe,"Â£","\\pounds"),w(N,V,pe,"Â£","\\mathsterling",!0),w(Le,V,pe,"Â£","\\pounds"),w(Le,V,pe,"Â£","\\textsterling",!0),w(N,ae,pe,"âœ ","\\maltese"),w(Le,ae,pe,"âœ ","\\maltese");const ke='0123456789/@."';for(let p=0;p<ke.length;p++){const h=ke.charAt(p);w(N,V,pe,h,h)}const qe='0123456789!@*()-=+";:?/.,';for(let p=0;p<qe.length;p++){const h=qe.charAt(p);w(Le,V,pe,h,h)}const nt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(let p=0;p<nt.length;p++){const h=nt.charAt(p);w(N,V,kt,h,h),w(Le,V,pe,h,h)}w(N,ae,pe,"C","â„‚"),w(Le,ae,pe,"C","â„‚"),w(N,ae,pe,"H","â„"),w(Le,ae,pe,"H","â„"),w(N,ae,pe,"N","â„•"),w(Le,ae,pe,"N","â„•"),w(N,ae,pe,"P","â„™"),w(Le,ae,pe,"P","â„™"),w(N,ae,pe,"Q","â„š"),w(Le,ae,pe,"Q","â„š"),w(N,ae,pe,"R","â„"),w(Le,ae,pe,"R","â„"),w(N,ae,pe,"Z","â„¤"),w(Le,ae,pe,"Z","â„¤"),w(N,V,kt,"h","â„Ž"),w(Le,V,kt,"h","â„Ž");let Xe="";for(let p=0;p<nt.length;p++){const h=nt.charAt(p);Xe=String.fromCharCode(55349,56320+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe),Xe=String.fromCharCode(55349,56372+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe),Xe=String.fromCharCode(55349,56424+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe),Xe=String.fromCharCode(55349,56580+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe),Xe=String.fromCharCode(55349,56684+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe),Xe=String.fromCharCode(55349,56736+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe),Xe=String.fromCharCode(55349,56788+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe),Xe=String.fromCharCode(55349,56840+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe),Xe=String.fromCharCode(55349,56944+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe),p<26&&(Xe=String.fromCharCode(55349,56632+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe),Xe=String.fromCharCode(55349,56476+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe))}Xe="ð•œ",w(N,V,kt,"k",Xe),w(Le,V,pe,"k",Xe);for(let p=0;p<10;p++){const h=p.toString();Xe=String.fromCharCode(55349,57294+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe),Xe=String.fromCharCode(55349,57314+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe),Xe=String.fromCharCode(55349,57324+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe),Xe=String.fromCharCode(55349,57334+p),w(N,V,kt,h,Xe),w(Le,V,pe,h,Xe)}const Mt="ÃÃžÃ¾";for(let p=0;p<Mt.length;p++){const h=Mt.charAt(p);w(N,V,kt,h,h),w(Le,V,pe,h,h)}const Xt=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],Ot=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],cr=function(p,h){const f=p.charCodeAt(0),x=p.charCodeAt(1),j=(f-55296)*1024+(x-56320)+65536,D=h==="math"?0:1;if(119808<=j&&j<120484){const F=Math.floor((j-119808)/26);return[Xt[F][2],Xt[F][D]]}else if(120782<=j&&j<=120831){const F=Math.floor((j-120782)/10);return[Ot[F][2],Ot[F][D]]}else{if(j===120485||j===120486)return[Xt[0][2],Xt[0][D]];if(120486<j&&j<120782)return["",""];throw new i("Unsupported character: "+p)}},kr=function(p,h,f){return Be[f][p]&&Be[f][p].replace&&(p=Be[f][p].replace),{value:p,metrics:Je(p,h,f)}},or=function(p,h,f,x,j){const D=kr(p,h,f),F=D.metrics;p=D.value;let H;if(F){let re=F.italic;(f==="text"||x&&x.font==="mathit")&&(re=0),H=new Et(p,F.height,F.depth,re,F.skew,F.width,j)}else typeof console<"u"&&console.warn("No character metrics "+("for '"+p+"' in style '"+h+"' and mode '"+f+"'")),H=new Et(p,0,0,0,0,0,j);if(x){H.maxFontSize=x.sizeMultiplier,x.style.isTight()&&H.classes.push("mtight");const re=x.getColor();re&&(H.style.color=re)}return H},xn=function(p,h,f,x){return x===void 0&&(x=[]),f.font==="boldsymbol"&&kr(p,"Main-Bold",h).metrics?or(p,"Main-Bold",h,f,x.concat(["mathbf"])):p==="\\"||Be[h][p].font==="main"?or(p,"Main-Regular",h,f,x):or(p,"AMS-Regular",h,f,x.concat(["amsrm"]))},dt=function(p,h,f,x,j){return j!=="textord"&&kr(p,"Math-BoldItalic",h).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}},tr=function(p,h,f){const x=p.mode,j=p.text,D=["mord"],F=x==="math"||x==="text"&&h.font,H=F?h.font:h.fontFamily;let re="",we="";if(j.charCodeAt(0)===55349&&([re,we]=cr(j,x)),re.length>0)return or(j,re,x,h,D.concat(we));if(H){let Pe,Ve;if(H==="boldsymbol"){const He=dt(j,x,h,D,f);Pe=He.fontName,Ve=[He.fontClass]}else F?(Pe=tg[H].fontName,Ve=[H]):(Pe=Xc(H,h.fontWeight,h.fontShape),Ve=[H,h.fontWeight,h.fontShape]);if(kr(j,Pe,x).metrics)return or(j,Pe,x,h,D.concat(Ve));if(me.hasOwnProperty(j)&&Pe.slice(0,10)==="Typewriter"){const He=[];for(let ct=0;ct<j.length;ct++)He.push(or(j[ct],Pe,x,h,D.concat(Ve)));return Jn(He)}}if(f==="mathord")return or(j,"Math-Italic",x,h,D.concat(["mathnormal"]));if(f==="textord"){const Pe=Be[x][j]&&Be[x][j].font;if(Pe==="ams"){const Ve=Xc("amsrm",h.fontWeight,h.fontShape);return or(j,Ve,x,h,D.concat("amsrm",h.fontWeight,h.fontShape))}else if(Pe==="main"||!Pe){const Ve=Xc("textrm",h.fontWeight,h.fontShape);return or(j,Ve,x,h,D.concat(h.fontWeight,h.fontShape))}else{const Ve=Xc(Pe,h.fontWeight,h.fontShape);return or(j,Ve,x,h,D.concat(Ve,h.fontWeight,h.fontShape))}}else throw new Error("unexpected type: "+f+" in makeOrd")},rr=(p,h)=>{if(Q(p.classes)!==Q(h.classes)||p.skew!==h.skew||p.maxFontSize!==h.maxFontSize)return!1;if(p.classes.length===1){const f=p.classes[0];if(f==="mbin"||f==="mord")return!1}for(const f in p.style)if(p.style.hasOwnProperty(f)&&p.style[f]!==h.style[f])return!1;for(const f in h.style)if(h.style.hasOwnProperty(f)&&p.style[f]!==h.style[f])return!1;return!0},_t=p=>{for(let h=0;h<p.length-1;h++){const f=p[h],x=p[h+1];f instanceof Et&&x instanceof Et&&rr(f,x)&&(f.text+=x.text,f.height=Math.max(f.height,x.height),f.depth=Math.max(f.depth,x.depth),f.italic=x.italic,p.splice(h+1,1),h--)}return p},ln=function(p){let h=0,f=0,x=0;for(let j=0;j<p.children.length;j++){const D=p.children[j];D.height>h&&(h=D.height),D.depth>f&&(f=D.depth),D.maxFontSize>x&&(x=D.maxFontSize)}p.height=h,p.depth=f,p.maxFontSize=x},dr=function(p,h,f,x){const j=new tt(p,h,f,x);return ln(j),j},xo=(p,h,f,x)=>new tt(p,h,f,x),Hi=function(p,h,f){const x=dr([p],[],h);return x.height=Math.max(f||h.fontMetrics().defaultRuleThickness,h.minRuleThickness),x.style.borderBottomWidth=at(x.height),x.maxFontSize=1,x},vo=function(p,h,f,x){const j=new Ie(p,h,f,x);return ln(j),j},Jn=function(p){const h=new ve(p);return ln(h),h},di=function(p,h){return p instanceof ve?dr([],[p],h):p},Wi=function(p){if(p.positionType==="individualShift"){const f=p.children,x=[f[0]],j=-f[0].shift-f[0].elem.depth;let D=j;for(let F=1;F<f.length;F++){const H=-f[F].shift-D-f[F].elem.depth,re=H-(f[F-1].elem.height+f[F-1].elem.depth);D=D+H,x.push({type:"kern",size:re}),x.push(f[F])}return{children:x,depth:j}}let h;if(p.positionType==="top"){let f=p.positionData;for(let x=0;x<p.children.length;x++){const j=p.children[x];f-=j.type==="kern"?j.size:j.elem.height+j.elem.depth}h=f}else if(p.positionType==="bottom")h=-p.positionData;else{const f=p.children[0];if(f.type!=="elem")throw new Error('First child must have type "elem".');if(p.positionType==="shift")h=-f.elem.depth-p.positionData;else if(p.positionType==="firstBaseline")h=-f.elem.depth;else throw new Error("Invalid positionType "+p.positionType+".")}return{children:p.children,depth:h}},wh=function(p,h){const{children:f,depth:x}=Wi(p);let j=0;for(let ct=0;ct<f.length;ct++){const Pt=f[ct];if(Pt.type==="elem"){const Ut=Pt.elem;j=Math.max(j,Ut.maxFontSize,Ut.height)}}j+=2;const D=dr(["pstrut"],[]);D.style.height=at(j);const F=[];let H=x,re=x,we=x;for(let ct=0;ct<f.length;ct++){const Pt=f[ct];if(Pt.type==="kern")we+=Pt.size;else{const Ut=Pt.elem,Pr=Pt.wrapperClasses||[],jr=Pt.wrapperStyle||{},_r=dr(Pr,[D,Ut],void 0,jr);_r.style.top=at(-j-we-Ut.depth),Pt.marginLeft&&(_r.style.marginLeft=Pt.marginLeft),Pt.marginRight&&(_r.style.marginRight=Pt.marginRight),F.push(_r),we+=Ut.height+Ut.depth}H=Math.min(H,we),re=Math.max(re,we)}const Pe=dr(["vlist"],F);Pe.style.height=at(re);let Ve;if(H<0){const ct=dr([],[]),Pt=dr(["vlist"],[ct]);Pt.style.height=at(-H);const Ut=dr(["vlist-s"],[new Et("â€‹")]);Ve=[dr(["vlist-r"],[Pe,Ut]),dr(["vlist-r"],[Pt])]}else Ve=[dr(["vlist-r"],[Pe])];const He=dr(["vlist-t"],Ve);return Ve.length===2&&He.classes.push("vlist-t2"),He.height=re,He.depth=-H,He},eg=(p,h)=>{const f=dr(["mspace"],[],h),x=Zt(p,h);return f.style.marginRight=at(x),f},Xc=function(p,h,f){let x="";switch(p){case"amsrm":x="AMS";break;case"textrm":x="Main";break;case"textsf":x="SansSerif";break;case"texttt":x="Typewriter";break;default:x=p}let j;return h==="textbf"&&f==="textit"?j="BoldItalic":h==="textbf"?j="Bold":h==="textit"?j="Italic":j="Regular",x+"-"+j},tg={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathsfit:{variant:"sans-serif-italic",fontName:"SansSerif-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},rg={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]};var $e={fontMap:tg,makeSymbol:or,mathsym:xn,makeSpan:dr,makeSvgSpan:xo,makeLineSpan:Hi,makeAnchor:vo,makeFragment:Jn,wrapFragment:di,makeVList:wh,makeOrd:tr,makeGlue:eg,staticSvg:function(p,h){const[f,x,j]=rg[p],D=new pt(f),F=new et([D],{width:at(x),height:at(j),style:"width:"+at(x),viewBox:"0 0 "+1e3*x+" "+1e3*j,preserveAspectRatio:"xMinYMin"}),H=xo(["overlay"],[F],h);return H.height=j,H.style.height=at(j),H.style.width=at(x),H},svgData:rg,tryCombineChars:_t};const vn={number:3,unit:"mu"},qi={number:4,unit:"mu"},Lo={number:5,unit:"mu"},E5={mord:{mop:vn,mbin:qi,mrel:Lo,minner:vn},mop:{mord:vn,mop:vn,mrel:Lo,minner:vn},mbin:{mord:qi,mop:qi,mopen:qi,minner:qi},mrel:{mord:Lo,mop:Lo,mopen:Lo,minner:Lo},mopen:{},mclose:{mop:vn,mbin:qi,mrel:Lo,minner:vn},mpunct:{mord:vn,mop:vn,mrel:Lo,mopen:vn,mclose:vn,mpunct:vn,minner:vn},minner:{mord:vn,mop:vn,mbin:qi,mrel:Lo,mopen:vn,mpunct:vn,minner:vn}},M5={mord:{mop:vn},mop:{mord:vn,mop:vn},mbin:{},mrel:{},mopen:{},mclose:{mop:vn},mpunct:{},minner:{mop:vn}},ng={},Qc={},ed={};function It(p){let{type:h,names:f,props:x,handler:j,htmlBuilder:D,mathmlBuilder:F}=p;const H={type:h,numArgs:x.numArgs,argTypes:x.argTypes,allowedInArgument:!!x.allowedInArgument,allowedInText:!!x.allowedInText,allowedInMath:x.allowedInMath===void 0?!0:x.allowedInMath,numOptionalArgs:x.numOptionalArgs||0,infix:!!x.infix,primitive:!!x.primitive,handler:j};for(let re=0;re<f.length;++re)ng[f[re]]=H;h&&(D&&(Qc[h]=D),F&&(ed[h]=F))}function Ji(p){let{type:h,htmlBuilder:f,mathmlBuilder:x}=p;It({type:h,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:f,mathmlBuilder:x})}const td=function(p){return p.type==="ordgroup"&&p.body.length===1?p.body[0]:p},Pn=function(p){return p.type==="ordgroup"?p.body:[p]},Bo=$e.makeSpan,A5=["leftmost","mbin","mopen","mrel","mop","mpunct"],P5=["rightmost","mrel","mclose","mpunct"],N5={display:U.DISPLAY,text:U.TEXT,script:U.SCRIPT,scriptscript:U.SCRIPTSCRIPT},D5={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},Vn=function(p,h,f,x){x===void 0&&(x=[null,null]);const j=[];for(let we=0;we<p.length;we++){const Pe=zr(p[we],h);if(Pe instanceof ve){const Ve=Pe.children;j.push(...Ve)}else j.push(Pe)}if($e.tryCombineChars(j),!f)return j;let D=h;if(p.length===1){const we=p[0];we.type==="sizing"?D=h.havingSize(we.size):we.type==="styling"&&(D=h.havingStyle(N5[we.style]))}const F=Bo([x[0]||"leftmost"],[],h),H=Bo([x[1]||"rightmost"],[],h),re=f==="root";return Ch(j,(we,Pe)=>{const Ve=Pe.classes[0],He=we.classes[0];Ve==="mbin"&&b.contains(P5,He)?Pe.classes[0]="mord":He==="mbin"&&b.contains(A5,Ve)&&(we.classes[0]="mord")},{node:F},H,re),Ch(j,(we,Pe)=>{const Ve=Ih(Pe),He=Ih(we),ct=Ve&&He?we.hasClass("mtight")?M5[Ve][He]:E5[Ve][He]:null;if(ct)return $e.makeGlue(ct,D)},{node:F},H,re),j},Ch=function(p,h,f,x,j){x&&p.push(x);let D=0;for(;D<p.length;D++){const F=p[D],H=sg(F);if(H){Ch(H.children,h,f,null,j);continue}const re=!F.hasClass("mspace");if(re){const we=h(F,f.node);we&&(f.insertAfter?f.insertAfter(we):(p.unshift(we),D++))}re?f.node=F:j&&F.hasClass("newline")&&(f.node=Bo(["leftmost"])),f.insertAfter=(we=>Pe=>{p.splice(we+1,0,Pe),D++})(D)}x&&p.pop()},sg=function(p){return p instanceof ve||p instanceof Ie||p instanceof tt&&p.hasClass("enclosing")?p:null},kh=function(p,h){const f=sg(p);if(f){const x=f.children;if(x.length){if(h==="right")return kh(x[x.length-1],"right");if(h==="left")return kh(x[0],"left")}}return p},Ih=function(p,h){return p?(h&&(p=kh(p,h)),D5[p.classes[0]]||null):null},Vl=function(p,h){const f=["nulldelimiter"].concat(p.baseSizingClasses());return Bo(h.concat(f))},zr=function(p,h,f){if(!p)return Bo();if(Qc[p.type]){let x=Qc[p.type](p,h);if(f&&h.size!==f.size){x=Bo(h.sizingClasses(f),[x],h);const j=h.sizeMultiplier/f.sizeMultiplier;x.height*=j,x.depth*=j}return x}else throw new i("Got group of unknown type: '"+p.type+"'")};function rd(p,h){const f=Bo(["base"],p,h),x=Bo(["strut"]);return x.style.height=at(f.height+f.depth),f.depth&&(x.style.verticalAlign=at(-f.depth)),f.children.unshift(x),f}function jh(p,h){let f=null;p.length===1&&p[0].type==="tag"&&(f=p[0].tag,p=p[0].body);const x=Vn(p,h,"root");let j;x.length===2&&x[1].hasClass("tag")&&(j=x.pop());const D=[];let F=[];for(let we=0;we<x.length;we++)if(F.push(x[we]),x[we].hasClass("mbin")||x[we].hasClass("mrel")||x[we].hasClass("allowbreak")){let Pe=!1;for(;we<x.length-1&&x[we+1].hasClass("mspace")&&!x[we+1].hasClass("newline");)we++,F.push(x[we]),x[we].hasClass("nobreak")&&(Pe=!0);Pe||(D.push(rd(F,h)),F=[])}else x[we].hasClass("newline")&&(F.pop(),F.length>0&&(D.push(rd(F,h)),F=[]),D.push(x[we]));F.length>0&&D.push(rd(F,h));let H;f?(H=rd(Vn(f,h,!0)),H.classes=["tag"],D.push(H)):j&&D.push(j);const re=Bo(["katex-html"],D);if(re.setAttribute("aria-hidden","true"),H){const we=H.children[0];we.style.height=at(re.height+re.depth),re.depth&&(we.style.verticalAlign=at(-re.depth))}return re}function og(p){return new ve(p)}class Ns{constructor(h,f,x){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=h,this.attributes={},this.children=f||[],this.classes=x||[]}setAttribute(h,f){this.attributes[h]=f}getAttribute(h){return this.attributes[h]}toNode(){const h=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(const f in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,f)&&h.setAttribute(f,this.attributes[f]);this.classes.length>0&&(h.className=Q(this.classes));for(let f=0;f<this.children.length;f++)if(this.children[f]instanceof bo&&this.children[f+1]instanceof bo){let x=this.children[f].toText()+this.children[++f].toText();for(;this.children[f+1]instanceof bo;)x+=this.children[++f].toText();h.appendChild(new bo(x).toNode())}else h.appendChild(this.children[f].toNode());return h}toMarkup(){let h="<"+this.type;for(const f in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,f)&&(h+=" "+f+'="',h+=b.escape(this.attributes[f]),h+='"');this.classes.length>0&&(h+=' class ="'+b.escape(Q(this.classes))+'"'),h+=">";for(let f=0;f<this.children.length;f++)h+=this.children[f].toMarkup();return h+="</"+this.type+">",h}toText(){return this.children.map(h=>h.toText()).join("")}}class bo{constructor(h){this.text=void 0,this.text=h}toNode(){return document.createTextNode(this.text)}toMarkup(){return b.escape(this.toText())}toText(){return this.text}}class R5{constructor(h){this.width=void 0,this.character=void 0,this.width=h,h>=.05555&&h<=.05556?this.character="â€Š":h>=.1666&&h<=.1667?this.character="â€‰":h>=.2222&&h<=.2223?this.character="â€…":h>=.2777&&h<=.2778?this.character="â€…â€Š":h>=-.05556&&h<=-.05555?this.character="â€Šâ£":h>=-.1667&&h<=-.1666?this.character="â€‰â£":h>=-.2223&&h<=-.2222?this.character="âŸâ£":h>=-.2778&&h<=-.2777?this.character="â€…â£":this.character=null}toNode(){if(this.character)return document.createTextNode(this.character);{const h=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return h.setAttribute("width",at(this.width)),h}}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+at(this.width)+'"/>'}toText(){return this.character?this.character:" "}}var ht={MathNode:Ns,TextNode:bo,SpaceNode:R5,newDocumentFragment:og};const Bs=function(p,h,f){return Be[h][p]&&Be[h][p].replace&&p.charCodeAt(0)!==55349&&!(me.hasOwnProperty(p)&&f&&(f.fontFamily&&f.fontFamily.slice(4,6)==="tt"||f.font&&f.font.slice(4,6)==="tt"))&&(p=Be[h][p].replace),new ht.TextNode(p)},Th=function(p){return p.length===1?p[0]:new ht.MathNode("mrow",p)},Eh=function(p,h){if(h.fontFamily==="texttt")return"monospace";if(h.fontFamily==="textsf")return h.fontShape==="textit"&&h.fontWeight==="textbf"?"sans-serif-bold-italic":h.fontShape==="textit"?"sans-serif-italic":h.fontWeight==="textbf"?"bold-sans-serif":"sans-serif";if(h.fontShape==="textit"&&h.fontWeight==="textbf")return"bold-italic";if(h.fontShape==="textit")return"italic";if(h.fontWeight==="textbf")return"bold";const f=h.font;if(!f||f==="mathnormal")return null;const x=p.mode;if(f==="mathit")return"italic";if(f==="boldsymbol")return p.type==="textord"?"bold":"bold-italic";if(f==="mathbf")return"bold";if(f==="mathbb")return"double-struck";if(f==="mathsfit")return"sans-serif-italic";if(f==="mathfrak")return"fraktur";if(f==="mathscr"||f==="mathcal")return"script";if(f==="mathsf")return"sans-serif";if(f==="mathtt")return"monospace";let j=p.text;if(b.contains(["\\imath","\\jmath"],j))return null;Be[x][j]&&Be[x][j].replace&&(j=Be[x][j].replace);const D=$e.fontMap[f].fontName;return Je(j,D,x)?$e.fontMap[f].variant:null};function Mh(p){if(!p)return!1;if(p.type==="mi"&&p.children.length===1){const h=p.children[0];return h instanceof bo&&h.text==="."}else if(p.type==="mo"&&p.children.length===1&&p.getAttribute("separator")==="true"&&p.getAttribute("lspace")==="0em"&&p.getAttribute("rspace")==="0em"){const h=p.children[0];return h instanceof bo&&h.text===","}else return!1}const Ss=function(p,h,f){if(p.length===1){const D=nn(p[0],h);return f&&D instanceof Ns&&D.type==="mo"&&(D.setAttribute("lspace","0em"),D.setAttribute("rspace","0em")),[D]}const x=[];let j;for(let D=0;D<p.length;D++){const F=nn(p[D],h);if(F instanceof Ns&&j instanceof Ns){if(F.type==="mtext"&&j.type==="mtext"&&F.getAttribute("mathvariant")===j.getAttribute("mathvariant")){j.children.push(...F.children);continue}else if(F.type==="mn"&&j.type==="mn"){j.children.push(...F.children);continue}else if(Mh(F)&&j.type==="mn"){j.children.push(...F.children);continue}else if(F.type==="mn"&&Mh(j))F.children=[...j.children,...F.children],x.pop();else if((F.type==="msup"||F.type==="msub")&&F.children.length>=1&&(j.type==="mn"||Mh(j))){const H=F.children[0];H instanceof Ns&&H.type==="mn"&&(H.children=[...j.children,...H.children],x.pop())}else if(j.type==="mi"&&j.children.length===1){const H=j.children[0];if(H instanceof bo&&H.text==="Ì¸"&&(F.type==="mo"||F.type==="mi"||F.type==="mn")){const re=F.children[0];re instanceof bo&&re.text.length>0&&(re.text=re.text.slice(0,1)+"Ì¸"+re.text.slice(1),x.pop())}}}x.push(F),j=F}return x},ui=function(p,h,f){return Th(Ss(p,h,f))},nn=function(p,h){if(!p)return new ht.MathNode("mrow");if(ed[p.type])return ed[p.type](p,h);throw new i("Got group of unknown type: '"+p.type+"'")};function ig(p,h,f,x,j){const D=Ss(p,f);let F;D.length===1&&D[0]instanceof Ns&&b.contains(["mrow","mtable"],D[0].type)?F=D[0]:F=new ht.MathNode("mrow",D);const H=new ht.MathNode("annotation",[new ht.TextNode(h)]);H.setAttribute("encoding","application/x-tex");const re=new ht.MathNode("semantics",[F,H]),we=new ht.MathNode("math",[re]);we.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),x&&we.setAttribute("display","block");const Pe=j?"katex":"katex-mathml";return $e.makeSpan([Pe],[we])}const ag=function(p){return new gt({style:p.displayMode?U.DISPLAY:U.TEXT,maxSize:p.maxSize,minRuleThickness:p.minRuleThickness})},lg=function(p,h){if(h.displayMode){const f=["katex-display"];h.leqno&&f.push("leqno"),h.fleqn&&f.push("fleqn"),p=$e.makeSpan(f,[p])}return p},O5=function(p,h,f){const x=ag(f);let j;if(f.output==="mathml")return ig(p,h,x,f.displayMode,!0);if(f.output==="html"){const D=jh(p,x);j=$e.makeSpan(["katex"],[D])}else{const D=ig(p,h,x,f.displayMode,!1),F=jh(p,x);j=$e.makeSpan(["katex"],[D,F])}return lg(j,f)},_5=function(p,h,f){const x=ag(f),j=jh(p,x),D=$e.makeSpan(["katex"],[j]);return lg(D,f)},F5={widehat:"^",widecheck:"Ë‡",widetilde:"~",utilde:"~",overleftarrow:"â†",underleftarrow:"â†",xleftarrow:"â†",overrightarrow:"â†’",underrightarrow:"â†’",xrightarrow:"â†’",underbrace:"âŸ",overbrace:"âž",overgroup:"â ",undergroup:"â¡",overleftrightarrow:"â†”",underleftrightarrow:"â†”",xleftrightarrow:"â†”",Overrightarrow:"â‡’",xRightarrow:"â‡’",overleftharpoon:"â†¼",xleftharpoonup:"â†¼",overrightharpoon:"â‡€",xrightharpoonup:"â‡€",xLeftarrow:"â‡",xLeftrightarrow:"â‡”",xhookleftarrow:"â†©",xhookrightarrow:"â†ª",xmapsto:"â†¦",xrightharpoondown:"â‡",xleftharpoondown:"â†½",xrightleftharpoons:"â‡Œ",xleftrightharpoons:"â‡‹",xtwoheadleftarrow:"â†ž",xtwoheadrightarrow:"â† ",xlongequal:"=",xtofrom:"â‡„",xrightleftarrows:"â‡„",xrightequilibrium:"â‡Œ",xleftequilibrium:"â‡‹","\\cdrightarrow":"â†’","\\cdleftarrow":"â†","\\cdlongequal":"="},V5=function(p){const h=new ht.MathNode("mo",[new ht.TextNode(F5[p.replace(/^\\/,"")])]);return h.setAttribute("stretchy","true"),h},$5={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},z5=function(p){return p.type==="ordgroup"?p.body.length:1};var Uo={encloseSpan:function(p,h,f,x,j){let D;const F=p.height+p.depth+f+x;if(/fbox|color|angl/.test(h)){if(D=$e.makeSpan(["stretchy",h],[],j),h==="fbox"){const H=j.color&&j.getColor();H&&(D.style.borderColor=H)}}else{const H=[];/^[bx]cancel$/.test(h)&&H.push(new Wt({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(h)&&H.push(new Wt({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));const re=new et(H,{width:"100%",height:at(F)});D=$e.makeSvgSpan([],[re],j)}return D.height=F,D.style.height=at(F),D},mathMLnode:V5,svgSpan:function(p,h){function f(){let F=4e5;const H=p.label.slice(1);if(b.contains(["widehat","widecheck","widetilde","utilde"],H)){const we=z5(p.base);let Pe,Ve,He;if(we>5)H==="widehat"||H==="widecheck"?(Pe=420,F=2364,He=.42,Ve=H+"4"):(Pe=312,F=2340,He=.34,Ve="tilde4");else{const Ut=[1,1,2,2,3,3][we];H==="widehat"||H==="widecheck"?(F=[0,1062,2364,2364,2364][Ut],Pe=[0,239,300,360,420][Ut],He=[0,.24,.3,.3,.36,.42][Ut],Ve=H+Ut):(F=[0,600,1033,2339,2340][Ut],Pe=[0,260,286,306,312][Ut],He=[0,.26,.286,.3,.306,.34][Ut],Ve="tilde"+Ut)}const ct=new pt(Ve),Pt=new et([ct],{width:"100%",height:at(He),viewBox:"0 0 "+F+" "+Pe,preserveAspectRatio:"none"});return{span:$e.makeSvgSpan([],[Pt],h),minWidth:0,height:He}}else{const re=[],we=$5[H],[Pe,Ve,He]=we,ct=He/1e3,Pt=Pe.length;let Ut,Pr;if(Pt===1){const jr=we[3];Ut=["hide-tail"],Pr=[jr]}else if(Pt===2)Ut=["halfarrow-left","halfarrow-right"],Pr=["xMinYMin","xMaxYMin"];else if(Pt===3)Ut=["brace-left","brace-center","brace-right"],Pr=["xMinYMin","xMidYMin","xMaxYMin"];else throw new Error(`Correct katexImagesData or update code here to support
                    `+Pt+" children.");for(let jr=0;jr<Pt;jr++){const _r=new pt(Pe[jr]),Wr=new et([_r],{width:"400em",height:at(ct),viewBox:"0 0 "+F+" "+He,preserveAspectRatio:Pr[jr]+" slice"}),an=$e.makeSvgSpan([Ut[jr]],[Wr],h);if(Pt===1)return{span:an,minWidth:Ve,height:ct};an.style.height=at(ct),re.push(an)}return{span:$e.makeSpan(["stretchy"],re,h),minWidth:Ve,height:ct}}}const{span:x,minWidth:j,height:D}=f();return x.height=D,x.style.height=at(D),j>0&&(x.style.minWidth=at(j)),x}};function Sr(p,h){if(!p||p.type!==h)throw new Error("Expected node of type "+h+", but got "+(p?"node of type "+p.type:String(p)));return p}function Ah(p){const h=nd(p);if(!h)throw new Error("Expected node of symbol group type, but got "+(p?"node of type "+p.type:String(p)));return h}function nd(p){return p&&(p.type==="atom"||ts.hasOwnProperty(p.type))?p:null}const Ph=(p,h)=>{let f,x,j;p&&p.type==="supsub"?(x=Sr(p.base,"accent"),f=x.base,p.base=f,j=Mn(zr(p,h)),p.base=x):(x=Sr(p,"accent"),f=x.base);const D=zr(f,h.havingCrampedStyle()),F=x.isShifty&&b.isCharacterBox(f);let H=0;if(F){const He=b.getBaseElem(f),ct=zr(He,h.havingCrampedStyle());H=In(ct).skew}const re=x.label==="\\c";let we=re?D.height+D.depth:Math.min(D.height,h.fontMetrics().xHeight),Pe;if(x.isStretchy)Pe=Uo.svgSpan(x,h),Pe=$e.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:D},{type:"elem",elem:Pe,wrapperClasses:["svg-align"],wrapperStyle:H>0?{width:"calc(100% - "+at(2*H)+")",marginLeft:at(2*H)}:void 0}]},h);else{let He,ct;x.label==="\\vec"?(He=$e.staticSvg("vec",h),ct=$e.svgData.vec[1]):(He=$e.makeOrd({mode:x.mode,text:x.label},h,"textord"),He=In(He),He.italic=0,ct=He.width,re&&(we+=He.depth)),Pe=$e.makeSpan(["accent-body"],[He]);const Pt=x.label==="\\textcircled";Pt&&(Pe.classes.push("accent-full"),we=D.height);let Ut=H;Pt||(Ut-=ct/2),Pe.style.left=at(Ut),x.label==="\\textcircled"&&(Pe.style.top=".2em"),Pe=$e.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:D},{type:"kern",size:-we},{type:"elem",elem:Pe}]},h)}const Ve=$e.makeSpan(["mord","accent"],[Pe],h);return j?(j.children[0]=Ve,j.height=Math.max(Ve.height,j.height),j.classes[0]="mord",j):Ve},cg=(p,h)=>{const f=p.isStretchy?Uo.mathMLnode(p.label):new ht.MathNode("mo",[Bs(p.label,p.mode)]),x=new ht.MathNode("mover",[nn(p.base,h),f]);return x.setAttribute("accent","true"),x},L5=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map(p=>"\\"+p).join("|"));It({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(p,h)=>{const f=td(h[0]),x=!L5.test(p.funcName),j=!x||p.funcName==="\\widehat"||p.funcName==="\\widetilde"||p.funcName==="\\widecheck";return{type:"accent",mode:p.parser.mode,label:p.funcName,isStretchy:x,isShifty:j,base:f}},htmlBuilder:Ph,mathmlBuilder:cg}),It({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(p,h)=>{const f=h[0];let x=p.parser.mode;return x==="math"&&(p.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+p.funcName+" works only in text mode"),x="text"),{type:"accent",mode:x,label:p.funcName,isStretchy:!1,isShifty:!0,base:f}},htmlBuilder:Ph,mathmlBuilder:cg}),It({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(p,h)=>{let{parser:f,funcName:x}=p;const j=h[0];return{type:"accentUnder",mode:f.mode,label:x,base:j}},htmlBuilder:(p,h)=>{const f=zr(p.base,h),x=Uo.svgSpan(p,h),j=p.label==="\\utilde"?.12:0,D=$e.makeVList({positionType:"top",positionData:f.height,children:[{type:"elem",elem:x,wrapperClasses:["svg-align"]},{type:"kern",size:j},{type:"elem",elem:f}]},h);return $e.makeSpan(["mord","accentunder"],[D],h)},mathmlBuilder:(p,h)=>{const f=Uo.mathMLnode(p.label),x=new ht.MathNode("munder",[nn(p.base,h),f]);return x.setAttribute("accentunder","true"),x}});const sd=p=>{const h=new ht.MathNode("mpadded",p?[p]:[]);return h.setAttribute("width","+0.6em"),h.setAttribute("lspace","0.3em"),h};It({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(p,h,f){let{parser:x,funcName:j}=p;return{type:"xArrow",mode:x.mode,label:j,body:h[0],below:f[0]}},htmlBuilder(p,h){const f=h.style;let x=h.havingStyle(f.sup());const j=$e.wrapFragment(zr(p.body,x,h),h),D=p.label.slice(0,2)==="\\x"?"x":"cd";j.classes.push(D+"-arrow-pad");let F;p.below&&(x=h.havingStyle(f.sub()),F=$e.wrapFragment(zr(p.below,x,h),h),F.classes.push(D+"-arrow-pad"));const H=Uo.svgSpan(p,h),re=-h.fontMetrics().axisHeight+.5*H.height;let we=-h.fontMetrics().axisHeight-.5*H.height-.111;(j.depth>.25||p.label==="\\xleftequilibrium")&&(we-=j.depth);let Pe;if(F){const Ve=-h.fontMetrics().axisHeight+F.height+.5*H.height+.111;Pe=$e.makeVList({positionType:"individualShift",children:[{type:"elem",elem:j,shift:we},{type:"elem",elem:H,shift:re},{type:"elem",elem:F,shift:Ve}]},h)}else Pe=$e.makeVList({positionType:"individualShift",children:[{type:"elem",elem:j,shift:we},{type:"elem",elem:H,shift:re}]},h);return Pe.children[0].children[0].children[1].classes.push("svg-align"),$e.makeSpan(["mrel","x-arrow"],[Pe],h)},mathmlBuilder(p,h){const f=Uo.mathMLnode(p.label);f.setAttribute("minsize",p.label.charAt(0)==="x"?"1.75em":"3.0em");let x;if(p.body){const j=sd(nn(p.body,h));if(p.below){const D=sd(nn(p.below,h));x=new ht.MathNode("munderover",[f,D,j])}else x=new ht.MathNode("mover",[f,j])}else if(p.below){const j=sd(nn(p.below,h));x=new ht.MathNode("munder",[f,j])}else x=sd(),x=new ht.MathNode("mover",[f,x]);return x}});const B5=$e.makeSpan;function dg(p,h){const f=Vn(p.body,h,!0);return B5([p.mclass],f,h)}function ug(p,h){let f;const x=Ss(p.body,h);return p.mclass==="minner"?f=new ht.MathNode("mpadded",x):p.mclass==="mord"?p.isCharacterBox?(f=x[0],f.type="mi"):f=new ht.MathNode("mi",x):(p.isCharacterBox?(f=x[0],f.type="mo"):f=new ht.MathNode("mo",x),p.mclass==="mbin"?(f.attributes.lspace="0.22em",f.attributes.rspace="0.22em"):p.mclass==="mpunct"?(f.attributes.lspace="0em",f.attributes.rspace="0.17em"):p.mclass==="mopen"||p.mclass==="mclose"?(f.attributes.lspace="0em",f.attributes.rspace="0em"):p.mclass==="minner"&&(f.attributes.lspace="0.0556em",f.attributes.width="+0.1111em")),f}It({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(p,h){let{parser:f,funcName:x}=p;const j=h[0];return{type:"mclass",mode:f.mode,mclass:"m"+x.slice(5),body:Pn(j),isCharacterBox:b.isCharacterBox(j)}},htmlBuilder:dg,mathmlBuilder:ug});const od=p=>{const h=p.type==="ordgroup"&&p.body.length?p.body[0]:p;return h.type==="atom"&&(h.family==="bin"||h.family==="rel")?"m"+h.family:"mord"};It({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(p,h){let{parser:f}=p;return{type:"mclass",mode:f.mode,mclass:od(h[0]),body:Pn(h[1]),isCharacterBox:b.isCharacterBox(h[1])}}}),It({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(p,h){let{parser:f,funcName:x}=p;const j=h[1],D=h[0];let F;x!=="\\stackrel"?F=od(j):F="mrel";const H={type:"op",mode:j.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:x!=="\\stackrel",body:Pn(j)},re={type:"supsub",mode:D.mode,base:H,sup:x==="\\underset"?null:D,sub:x==="\\underset"?D:null};return{type:"mclass",mode:f.mode,mclass:F,body:[re],isCharacterBox:b.isCharacterBox(re)}},htmlBuilder:dg,mathmlBuilder:ug}),It({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(p,h){let{parser:f}=p;return{type:"pmb",mode:f.mode,mclass:od(h[0]),body:Pn(h[0])}},htmlBuilder(p,h){const f=Vn(p.body,h,!0),x=$e.makeSpan([p.mclass],f,h);return x.style.textShadow="0.02em 0.01em 0.04px",x},mathmlBuilder(p,h){const f=Ss(p.body,h),x=new ht.MathNode("mstyle",f);return x.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),x}});const U5={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},hg=()=>({type:"styling",body:[],mode:"math",style:"display"}),mg=p=>p.type==="textord"&&p.text==="@",G5=(p,h)=>(p.type==="mathord"||p.type==="atom")&&p.text===h;function H5(p,h,f){const x=U5[p];switch(x){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return f.callFunction(x,[h[0]],[h[1]]);case"\\uparrow":case"\\downarrow":{const j=f.callFunction("\\\\cdleft",[h[0]],[]),D={type:"atom",text:x,mode:"math",family:"rel"},F=f.callFunction("\\Big",[D],[]),H=f.callFunction("\\\\cdright",[h[1]],[]),re={type:"ordgroup",mode:"math",body:[j,F,H]};return f.callFunction("\\\\cdparent",[re],[])}case"\\\\cdlongequal":return f.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{const j={type:"textord",text:"\\Vert",mode:"math"};return f.callFunction("\\Big",[j],[])}default:return{type:"textord",text:" ",mode:"math"}}}function W5(p){const h=[];for(p.gullet.beginGroup(),p.gullet.macros.set("\\cr","\\\\\\relax"),p.gullet.beginGroup();;){h.push(p.parseExpression(!1,"\\\\")),p.gullet.endGroup(),p.gullet.beginGroup();const D=p.fetch().text;if(D==="&"||D==="\\\\")p.consume();else if(D==="\\end"){h[h.length-1].length===0&&h.pop();break}else throw new i("Expected \\\\ or \\cr or \\end",p.nextToken)}let f=[];const x=[f];for(let D=0;D<h.length;D++){const F=h[D];let H=hg();for(let re=0;re<F.length;re++)if(!mg(F[re]))H.body.push(F[re]);else{f.push(H),re+=1;const we=Ah(F[re]).text,Pe=new Array(2);if(Pe[0]={type:"ordgroup",mode:"math",body:[]},Pe[1]={type:"ordgroup",mode:"math",body:[]},!("=|.".indexOf(we)>-1))if("<>AV".indexOf(we)>-1)for(let ct=0;ct<2;ct++){let Pt=!0;for(let Ut=re+1;Ut<F.length;Ut++){if(G5(F[Ut],we)){Pt=!1,re=Ut;break}if(mg(F[Ut]))throw new i("Missing a "+we+" character to complete a CD arrow.",F[Ut]);Pe[ct].body.push(F[Ut])}if(Pt)throw new i("Missing a "+we+" character to complete a CD arrow.",F[re])}else throw new i('Expected one of "<>AV=|." after @',F[re]);const He={type:"styling",body:[H5(we,Pe,p)],mode:"math",style:"display"};f.push(He),H=hg()}D%2===0?f.push(H):f.shift(),f=[],x.push(f)}p.gullet.endGroup(),p.gullet.endGroup();const j=new Array(x[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25});return{type:"array",mode:"math",body:x,arraystretch:1,addJot:!0,rowGaps:[null],cols:j,colSeparationType:"CD",hLinesBeforeRow:new Array(x.length+1).fill([])}}It({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(p,h){let{parser:f,funcName:x}=p;return{type:"cdlabel",mode:f.mode,side:x.slice(4),label:h[0]}},htmlBuilder(p,h){const f=h.havingStyle(h.style.sup()),x=$e.wrapFragment(zr(p.label,f,h),h);return x.classes.push("cd-label-"+p.side),x.style.bottom=at(.8-x.depth),x.height=0,x.depth=0,x},mathmlBuilder(p,h){let f=new ht.MathNode("mrow",[nn(p.label,h)]);return f=new ht.MathNode("mpadded",[f]),f.setAttribute("width","0"),p.side==="left"&&f.setAttribute("lspace","-1width"),f.setAttribute("voffset","0.7em"),f=new ht.MathNode("mstyle",[f]),f.setAttribute("displaystyle","false"),f.setAttribute("scriptlevel","1"),f}}),It({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(p,h){let{parser:f}=p;return{type:"cdlabelparent",mode:f.mode,fragment:h[0]}},htmlBuilder(p,h){const f=$e.wrapFragment(zr(p.fragment,h),h);return f.classes.push("cd-vert-arrow"),f},mathmlBuilder(p,h){return new ht.MathNode("mrow",[nn(p.fragment,h)])}}),It({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(p,h){let{parser:f}=p;const j=Sr(h[0],"ordgroup").body;let D="";for(let re=0;re<j.length;re++){const we=Sr(j[re],"textord");D+=we.text}let F=parseInt(D),H;if(isNaN(F))throw new i("\\@char has non-numeric argument "+D);if(F<0||F>=1114111)throw new i("\\@char with invalid code point "+D);return F<=65535?H=String.fromCharCode(F):(F-=65536,H=String.fromCharCode((F>>10)+55296,(F&1023)+56320)),{type:"textord",mode:f.mode,text:H}}});const pg=(p,h)=>{const f=Vn(p.body,h.withColor(p.color),!1);return $e.makeFragment(f)},fg=(p,h)=>{const f=Ss(p.body,h.withColor(p.color)),x=new ht.MathNode("mstyle",f);return x.setAttribute("mathcolor",p.color),x};It({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(p,h){let{parser:f}=p;const x=Sr(h[0],"color-token").color,j=h[1];return{type:"color",mode:f.mode,color:x,body:Pn(j)}},htmlBuilder:pg,mathmlBuilder:fg}),It({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(p,h){let{parser:f,breakOnTokenText:x}=p;const j=Sr(h[0],"color-token").color;f.gullet.macros.set("\\current@color",j);const D=f.parseExpression(!0,x);return{type:"color",mode:f.mode,color:j,body:D}},htmlBuilder:pg,mathmlBuilder:fg}),It({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(p,h,f){let{parser:x}=p;const j=x.gullet.future().text==="["?x.parseSizeGroup(!0):null,D=!x.settings.displayMode||!x.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:x.mode,newLine:D,size:j&&Sr(j,"size").value}},htmlBuilder(p,h){const f=$e.makeSpan(["mspace"],[],h);return p.newLine&&(f.classes.push("newline"),p.size&&(f.style.marginTop=at(Zt(p.size,h)))),f},mathmlBuilder(p,h){const f=new ht.MathNode("mspace");return p.newLine&&(f.setAttribute("linebreak","newline"),p.size&&f.setAttribute("height",at(Zt(p.size,h)))),f}});const Nh={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},gg=p=>{const h=p.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(h))throw new i("Expected a control sequence",p);return h},q5=p=>{let h=p.gullet.popToken();return h.text==="="&&(h=p.gullet.popToken(),h.text===" "&&(h=p.gullet.popToken())),h},yg=(p,h,f,x)=>{let j=p.gullet.macros.get(f.text);j==null&&(f.noexpand=!0,j={tokens:[f],numArgs:0,unexpandable:!p.gullet.isExpandable(f.text)}),p.gullet.macros.set(h,j,x)};It({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(p){let{parser:h,funcName:f}=p;h.consumeSpaces();const x=h.fetch();if(Nh[x.text])return(f==="\\global"||f==="\\\\globallong")&&(x.text=Nh[x.text]),Sr(h.parseFunction(),"internal");throw new i("Invalid token after macro prefix",x)}}),It({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(p){let{parser:h,funcName:f}=p,x=h.gullet.popToken();const j=x.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(j))throw new i("Expected a control sequence",x);let D=0,F;const H=[[]];for(;h.gullet.future().text!=="{";)if(x=h.gullet.popToken(),x.text==="#"){if(h.gullet.future().text==="{"){F=h.gullet.future(),H[D].push("{");break}if(x=h.gullet.popToken(),!/^[1-9]$/.test(x.text))throw new i('Invalid argument number "'+x.text+'"');if(parseInt(x.text)!==D+1)throw new i('Argument number "'+x.text+'" out of order');D++,H.push([])}else{if(x.text==="EOF")throw new i("Expected a macro definition");H[D].push(x.text)}let{tokens:re}=h.gullet.consumeArg();return F&&re.unshift(F),(f==="\\edef"||f==="\\xdef")&&(re=h.gullet.expandTokens(re),re.reverse()),h.gullet.macros.set(j,{tokens:re,numArgs:D,delimiters:H},f===Nh[f]),{type:"internal",mode:h.mode}}}),It({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(p){let{parser:h,funcName:f}=p;const x=gg(h.gullet.popToken());h.gullet.consumeSpaces();const j=q5(h);return yg(h,x,j,f==="\\\\globallet"),{type:"internal",mode:h.mode}}}),It({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(p){let{parser:h,funcName:f}=p;const x=gg(h.gullet.popToken()),j=h.gullet.popToken(),D=h.gullet.popToken();return yg(h,x,D,f==="\\\\globalfuture"),h.gullet.pushToken(D),h.gullet.pushToken(j),{type:"internal",mode:h.mode}}});const $l=function(p,h,f){const x=Be.math[p]&&Be.math[p].replace,j=Je(x||p,h,f);if(!j)throw new Error("Unsupported symbol "+p+" and font size "+h+".");return j},Dh=function(p,h,f,x){const j=f.havingBaseStyle(h),D=$e.makeSpan(x.concat(j.sizingClasses(f)),[p],f),F=j.sizeMultiplier/f.sizeMultiplier;return D.height*=F,D.depth*=F,D.maxFontSize=j.sizeMultiplier,D},xg=function(p,h,f){const x=h.havingBaseStyle(f),j=(1-h.sizeMultiplier/x.sizeMultiplier)*h.fontMetrics().axisHeight;p.classes.push("delimcenter"),p.style.top=at(j),p.height-=j,p.depth+=j},J5=function(p,h,f,x,j,D){const F=$e.makeSymbol(p,"Main-Regular",j,x),H=Dh(F,h,x,D);return f&&xg(H,x,h),H},Y5=function(p,h,f,x){return $e.makeSymbol(p,"Size"+h+"-Regular",f,x)},vg=function(p,h,f,x,j,D){const F=Y5(p,h,j,x),H=Dh($e.makeSpan(["delimsizing","size"+h],[F],x),U.TEXT,x,D);return f&&xg(H,x,U.TEXT),H},Rh=function(p,h,f){let x;return h==="Size1-Regular"?x="delim-size1":x="delim-size4",{type:"elem",elem:$e.makeSpan(["delimsizinginner",x],[$e.makeSpan([],[$e.makeSymbol(p,h,f)])])}},Oh=function(p,h,f){const x=Te["Size4-Regular"][p.charCodeAt(0)]?Te["Size4-Regular"][p.charCodeAt(0)][4]:Te["Size1-Regular"][p.charCodeAt(0)][4],j=new pt("inner",ze(p,Math.round(1e3*h))),D=new et([j],{width:at(x),height:at(h),style:"width:"+at(x),viewBox:"0 0 "+1e3*x+" "+Math.round(1e3*h),preserveAspectRatio:"xMinYMin"}),F=$e.makeSvgSpan([],[D],f);return F.height=h,F.style.height=at(h),F.style.width=at(x),{type:"elem",elem:F}},_h=.008,id={type:"kern",size:-1*_h},K5=["|","\\lvert","\\rvert","\\vert"],Z5=["\\|","\\lVert","\\rVert","\\Vert"],bg=function(p,h,f,x,j,D){let F,H,re,we,Pe="",Ve=0;F=re=we=p,H=null;let He="Size1-Regular";p==="\\uparrow"?re=we="â":p==="\\Uparrow"?re=we="â€–":p==="\\downarrow"?F=re="â":p==="\\Downarrow"?F=re="â€–":p==="\\updownarrow"?(F="\\uparrow",re="â",we="\\downarrow"):p==="\\Updownarrow"?(F="\\Uparrow",re="â€–",we="\\Downarrow"):b.contains(K5,p)?(re="âˆ£",Pe="vert",Ve=333):b.contains(Z5,p)?(re="âˆ¥",Pe="doublevert",Ve=556):p==="["||p==="\\lbrack"?(F="âŽ¡",re="âŽ¢",we="âŽ£",He="Size4-Regular",Pe="lbrack",Ve=667):p==="]"||p==="\\rbrack"?(F="âŽ¤",re="âŽ¥",we="âŽ¦",He="Size4-Regular",Pe="rbrack",Ve=667):p==="\\lfloor"||p==="âŒŠ"?(re=F="âŽ¢",we="âŽ£",He="Size4-Regular",Pe="lfloor",Ve=667):p==="\\lceil"||p==="âŒˆ"?(F="âŽ¡",re=we="âŽ¢",He="Size4-Regular",Pe="lceil",Ve=667):p==="\\rfloor"||p==="âŒ‹"?(re=F="âŽ¥",we="âŽ¦",He="Size4-Regular",Pe="rfloor",Ve=667):p==="\\rceil"||p==="âŒ‰"?(F="âŽ¤",re=we="âŽ¥",He="Size4-Regular",Pe="rceil",Ve=667):p==="("||p==="\\lparen"?(F="âŽ›",re="âŽœ",we="âŽ",He="Size4-Regular",Pe="lparen",Ve=875):p===")"||p==="\\rparen"?(F="âŽž",re="âŽŸ",we="âŽ ",He="Size4-Regular",Pe="rparen",Ve=875):p==="\\{"||p==="\\lbrace"?(F="âŽ§",H="âŽ¨",we="âŽ©",re="âŽª",He="Size4-Regular"):p==="\\}"||p==="\\rbrace"?(F="âŽ«",H="âŽ¬",we="âŽ­",re="âŽª",He="Size4-Regular"):p==="\\lgroup"||p==="âŸ®"?(F="âŽ§",we="âŽ©",re="âŽª",He="Size4-Regular"):p==="\\rgroup"||p==="âŸ¯"?(F="âŽ«",we="âŽ­",re="âŽª",He="Size4-Regular"):p==="\\lmoustache"||p==="âŽ°"?(F="âŽ§",we="âŽ­",re="âŽª",He="Size4-Regular"):(p==="\\rmoustache"||p==="âŽ±")&&(F="âŽ«",we="âŽ©",re="âŽª",He="Size4-Regular");const ct=$l(F,He,j),Pt=ct.height+ct.depth,Ut=$l(re,He,j),Pr=Ut.height+Ut.depth,jr=$l(we,He,j),_r=jr.height+jr.depth;let Wr=0,an=1;if(H!==null){const Tn=$l(H,He,j);Wr=Tn.height+Tn.depth,an=2}const is=Pt+_r+Wr,$n=Math.max(0,Math.ceil((h-is)/(an*Pr))),Gs=is+$n*an*Pr;let Ya=x.fontMetrics().axisHeight;f&&(Ya*=x.sizeMultiplier);const Lr=Gs/2-Ya,Qr=[];if(Pe.length>0){const Tn=Gs-Pt-_r,bn=Math.round(Gs*1e3),Hs=Ke(Pe,Math.round(Tn*1e3)),Cw=new pt(Pe,Hs),dy=(Ve/1e3).toFixed(3)+"em",uy=(bn/1e3).toFixed(3)+"em",kw=new et([Cw],{width:dy,height:uy,viewBox:"0 0 "+Ve+" "+bn}),ud=$e.makeSvgSpan([],[kw],x);ud.height=bn/1e3,ud.style.width=dy,ud.style.height=uy,Qr.push({type:"elem",elem:ud})}else{if(Qr.push(Rh(we,He,j)),Qr.push(id),H===null){const Tn=Gs-Pt-_r+2*_h;Qr.push(Oh(re,Tn,x))}else{const Tn=(Gs-Pt-_r-Wr)/2+2*_h;Qr.push(Oh(re,Tn,x)),Qr.push(id),Qr.push(Rh(H,He,j)),Qr.push(id),Qr.push(Oh(re,Tn,x))}Qr.push(id),Qr.push(Rh(F,He,j))}const cn=x.havingBaseStyle(U.TEXT),dn=$e.makeVList({positionType:"bottom",positionData:Lr,children:Qr},cn);return Dh($e.makeSpan(["delimsizing","mult"],[dn],cn),U.TEXT,x,D)},Fh=80,Vh=.08,$h=function(p,h,f,x,j){const D=Ee(p,x,f),F=new pt(p,D),H=new et([F],{width:"400em",height:at(h),viewBox:"0 0 400000 "+f,preserveAspectRatio:"xMinYMin slice"});return $e.makeSvgSpan(["hide-tail"],[H],j)},X5=function(p,h){const f=h.havingBaseSizing(),x=kg("\\surd",p*f.sizeMultiplier,Cg,f);let j=f.sizeMultiplier;const D=Math.max(0,h.minRuleThickness-h.fontMetrics().sqrtRuleThickness);let F,H=0,re=0,we=0,Pe;return x.type==="small"?(we=1e3+1e3*D+Fh,p<1?j=1:p<1.4&&(j=.7),H=(1+D+Vh)/j,re=(1+D)/j,F=$h("sqrtMain",H,we,D,h),F.style.minWidth="0.853em",Pe=.833/j):x.type==="large"?(we=(1e3+Fh)*zl[x.size],re=(zl[x.size]+D)/j,H=(zl[x.size]+D+Vh)/j,F=$h("sqrtSize"+x.size,H,we,D,h),F.style.minWidth="1.02em",Pe=1/j):(H=p+D+Vh,re=p+D,we=Math.floor(1e3*p+D)+Fh,F=$h("sqrtTall",H,we,D,h),F.style.minWidth="0.742em",Pe=1.056),F.height=re,F.style.height=at(H),{span:F,advanceWidth:Pe,ruleWidth:(h.fontMetrics().sqrtRuleThickness+D)*j}},Sg=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","âŒŠ","âŒ‹","\\lceil","\\rceil","âŒˆ","âŒ‰","\\surd"],Q5=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","âŸ®","âŸ¯","\\lmoustache","\\rmoustache","âŽ°","âŽ±"],wg=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],zl=[0,1.2,1.8,2.4,3],ew=function(p,h,f,x,j){if(p==="<"||p==="\\lt"||p==="âŸ¨"?p="\\langle":(p===">"||p==="\\gt"||p==="âŸ©")&&(p="\\rangle"),b.contains(Sg,p)||b.contains(wg,p))return vg(p,h,!1,f,x,j);if(b.contains(Q5,p))return bg(p,zl[h],!1,f,x,j);throw new i("Illegal delimiter: '"+p+"'")},tw=[{type:"small",style:U.SCRIPTSCRIPT},{type:"small",style:U.SCRIPT},{type:"small",style:U.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],rw=[{type:"small",style:U.SCRIPTSCRIPT},{type:"small",style:U.SCRIPT},{type:"small",style:U.TEXT},{type:"stack"}],Cg=[{type:"small",style:U.SCRIPTSCRIPT},{type:"small",style:U.SCRIPT},{type:"small",style:U.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],nw=function(p){if(p.type==="small")return"Main-Regular";if(p.type==="large")return"Size"+p.size+"-Regular";if(p.type==="stack")return"Size4-Regular";throw new Error("Add support for delim type '"+p.type+"' here.")},kg=function(p,h,f,x){const j=Math.min(2,3-x.style.size);for(let D=j;D<f.length&&f[D].type!=="stack";D++){const F=$l(p,nw(f[D]),"math");let H=F.height+F.depth;if(f[D].type==="small"){const re=x.havingBaseStyle(f[D].style);H*=re.sizeMultiplier}if(H>h)return f[D]}return f[f.length-1]},Ig=function(p,h,f,x,j,D){p==="<"||p==="\\lt"||p==="âŸ¨"?p="\\langle":(p===">"||p==="\\gt"||p==="âŸ©")&&(p="\\rangle");let F;b.contains(wg,p)?F=tw:b.contains(Sg,p)?F=Cg:F=rw;const H=kg(p,h,F,x);return H.type==="small"?J5(p,H.style,f,x,j,D):H.type==="large"?vg(p,H.size,f,x,j,D):bg(p,h,f,x,j,D)};var Go={sqrtImage:X5,sizedDelim:ew,sizeToMaxHeight:zl,customSizedDelim:Ig,leftRightDelim:function(p,h,f,x,j,D){const F=x.fontMetrics().axisHeight*x.sizeMultiplier,H=901,re=5/x.fontMetrics().ptPerEm,we=Math.max(h-F,f+F),Pe=Math.max(we/500*H,2*we-re);return Ig(p,Pe,!0,x,j,D)}};const jg={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},sw=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","âŒŠ","âŒ‹","\\lceil","\\rceil","âŒˆ","âŒ‰","<",">","\\langle","âŸ¨","\\rangle","âŸ©","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","âŸ®","âŸ¯","\\lmoustache","\\rmoustache","âŽ°","âŽ±","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function ad(p,h){const f=nd(p);if(f&&b.contains(sw,f.text))return f;throw f?new i("Invalid delimiter '"+f.text+"' after '"+h.funcName+"'",p):new i("Invalid delimiter type '"+p.type+"'",p)}It({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(p,h)=>{const f=ad(h[0],p);return{type:"delimsizing",mode:p.parser.mode,size:jg[p.funcName].size,mclass:jg[p.funcName].mclass,delim:f.text}},htmlBuilder:(p,h)=>p.delim==="."?$e.makeSpan([p.mclass]):Go.sizedDelim(p.delim,p.size,h,p.mode,[p.mclass]),mathmlBuilder:p=>{const h=[];p.delim!=="."&&h.push(Bs(p.delim,p.mode));const f=new ht.MathNode("mo",h);p.mclass==="mopen"||p.mclass==="mclose"?f.setAttribute("fence","true"):f.setAttribute("fence","false"),f.setAttribute("stretchy","true");const x=at(Go.sizeToMaxHeight[p.size]);return f.setAttribute("minsize",x),f.setAttribute("maxsize",x),f}});function Tg(p){if(!p.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}It({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(p,h)=>{const f=p.parser.gullet.macros.get("\\current@color");if(f&&typeof f!="string")throw new i("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:p.parser.mode,delim:ad(h[0],p).text,color:f}}}),It({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(p,h)=>{const f=ad(h[0],p),x=p.parser;++x.leftrightDepth;const j=x.parseExpression(!1);--x.leftrightDepth,x.expect("\\right",!1);const D=Sr(x.parseFunction(),"leftright-right");return{type:"leftright",mode:x.mode,body:j,left:f.text,right:D.delim,rightColor:D.color}},htmlBuilder:(p,h)=>{Tg(p);const f=Vn(p.body,h,!0,["mopen","mclose"]);let x=0,j=0,D=!1;for(let re=0;re<f.length;re++)f[re].isMiddle?D=!0:(x=Math.max(f[re].height,x),j=Math.max(f[re].depth,j));x*=h.sizeMultiplier,j*=h.sizeMultiplier;let F;if(p.left==="."?F=Vl(h,["mopen"]):F=Go.leftRightDelim(p.left,x,j,h,p.mode,["mopen"]),f.unshift(F),D)for(let re=1;re<f.length;re++){const Pe=f[re].isMiddle;Pe&&(f[re]=Go.leftRightDelim(Pe.delim,x,j,Pe.options,p.mode,[]))}let H;if(p.right===".")H=Vl(h,["mclose"]);else{const re=p.rightColor?h.withColor(p.rightColor):h;H=Go.leftRightDelim(p.right,x,j,re,p.mode,["mclose"])}return f.push(H),$e.makeSpan(["minner"],f,h)},mathmlBuilder:(p,h)=>{Tg(p);const f=Ss(p.body,h);if(p.left!=="."){const x=new ht.MathNode("mo",[Bs(p.left,p.mode)]);x.setAttribute("fence","true"),f.unshift(x)}if(p.right!=="."){const x=new ht.MathNode("mo",[Bs(p.right,p.mode)]);x.setAttribute("fence","true"),p.rightColor&&x.setAttribute("mathcolor",p.rightColor),f.push(x)}return Th(f)}}),It({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(p,h)=>{const f=ad(h[0],p);if(!p.parser.leftrightDepth)throw new i("\\middle without preceding \\left",f);return{type:"middle",mode:p.parser.mode,delim:f.text}},htmlBuilder:(p,h)=>{let f;if(p.delim===".")f=Vl(h,[]);else{f=Go.sizedDelim(p.delim,1,h,p.mode,[]);const x={delim:p.delim,options:h};f.isMiddle=x}return f},mathmlBuilder:(p,h)=>{const f=p.delim==="\\vert"||p.delim==="|"?Bs("|","text"):Bs(p.delim,p.mode),x=new ht.MathNode("mo",[f]);return x.setAttribute("fence","true"),x.setAttribute("lspace","0.05em"),x.setAttribute("rspace","0.05em"),x}});const zh=(p,h)=>{const f=$e.wrapFragment(zr(p.body,h),h),x=p.label.slice(1);let j=h.sizeMultiplier,D,F=0;const H=b.isCharacterBox(p.body);if(x==="sout")D=$e.makeSpan(["stretchy","sout"]),D.height=h.fontMetrics().defaultRuleThickness/j,F=-.5*h.fontMetrics().xHeight;else if(x==="phase"){const we=Zt({number:.6,unit:"pt"},h),Pe=Zt({number:.35,unit:"ex"},h),Ve=h.havingBaseSizing();j=j/Ve.sizeMultiplier;const He=f.height+f.depth+we+Pe;f.style.paddingLeft=at(He/2+we);const ct=Math.floor(1e3*He*j),Pt=Ce(ct),Ut=new et([new pt("phase",Pt)],{width:"400em",height:at(ct/1e3),viewBox:"0 0 400000 "+ct,preserveAspectRatio:"xMinYMin slice"});D=$e.makeSvgSpan(["hide-tail"],[Ut],h),D.style.height=at(He),F=f.depth+we+Pe}else{/cancel/.test(x)?H||f.classes.push("cancel-pad"):x==="angl"?f.classes.push("anglpad"):f.classes.push("boxpad");let we=0,Pe=0,Ve=0;/box/.test(x)?(Ve=Math.max(h.fontMetrics().fboxrule,h.minRuleThickness),we=h.fontMetrics().fboxsep+(x==="colorbox"?0:Ve),Pe=we):x==="angl"?(Ve=Math.max(h.fontMetrics().defaultRuleThickness,h.minRuleThickness),we=4*Ve,Pe=Math.max(0,.25-f.depth)):(we=H?.2:0,Pe=we),D=Uo.encloseSpan(f,x,we,Pe,h),/fbox|boxed|fcolorbox/.test(x)?(D.style.borderStyle="solid",D.style.borderWidth=at(Ve)):x==="angl"&&Ve!==.049&&(D.style.borderTopWidth=at(Ve),D.style.borderRightWidth=at(Ve)),F=f.depth+Pe,p.backgroundColor&&(D.style.backgroundColor=p.backgroundColor,p.borderColor&&(D.style.borderColor=p.borderColor))}let re;if(p.backgroundColor)re=$e.makeVList({positionType:"individualShift",children:[{type:"elem",elem:D,shift:F},{type:"elem",elem:f,shift:0}]},h);else{const we=/cancel|phase/.test(x)?["svg-align"]:[];re=$e.makeVList({positionType:"individualShift",children:[{type:"elem",elem:f,shift:0},{type:"elem",elem:D,shift:F,wrapperClasses:we}]},h)}return/cancel/.test(x)&&(re.height=f.height,re.depth=f.depth),/cancel/.test(x)&&!H?$e.makeSpan(["mord","cancel-lap"],[re],h):$e.makeSpan(["mord"],[re],h)},Lh=(p,h)=>{let f=0;const x=new ht.MathNode(p.label.indexOf("colorbox")>-1?"mpadded":"menclose",[nn(p.body,h)]);switch(p.label){case"\\cancel":x.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":x.setAttribute("notation","downdiagonalstrike");break;case"\\phase":x.setAttribute("notation","phasorangle");break;case"\\sout":x.setAttribute("notation","horizontalstrike");break;case"\\fbox":x.setAttribute("notation","box");break;case"\\angl":x.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(f=h.fontMetrics().fboxsep*h.fontMetrics().ptPerEm,x.setAttribute("width","+"+2*f+"pt"),x.setAttribute("height","+"+2*f+"pt"),x.setAttribute("lspace",f+"pt"),x.setAttribute("voffset",f+"pt"),p.label==="\\fcolorbox"){const j=Math.max(h.fontMetrics().fboxrule,h.minRuleThickness);x.setAttribute("style","border: "+j+"em solid "+String(p.borderColor))}break;case"\\xcancel":x.setAttribute("notation","updiagonalstrike downdiagonalstrike");break}return p.backgroundColor&&x.setAttribute("mathbackground",p.backgroundColor),x};It({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(p,h,f){let{parser:x,funcName:j}=p;const D=Sr(h[0],"color-token").color,F=h[1];return{type:"enclose",mode:x.mode,label:j,backgroundColor:D,body:F}},htmlBuilder:zh,mathmlBuilder:Lh}),It({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(p,h,f){let{parser:x,funcName:j}=p;const D=Sr(h[0],"color-token").color,F=Sr(h[1],"color-token").color,H=h[2];return{type:"enclose",mode:x.mode,label:j,backgroundColor:F,borderColor:D,body:H}},htmlBuilder:zh,mathmlBuilder:Lh}),It({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(p,h){let{parser:f}=p;return{type:"enclose",mode:f.mode,label:"\\fbox",body:h[0]}}}),It({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(p,h){let{parser:f,funcName:x}=p;const j=h[0];return{type:"enclose",mode:f.mode,label:x,body:j}},htmlBuilder:zh,mathmlBuilder:Lh}),It({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(p,h){let{parser:f}=p;return{type:"enclose",mode:f.mode,label:"\\angl",body:h[0]}}});const Eg={};function So(p){let{type:h,names:f,props:x,handler:j,htmlBuilder:D,mathmlBuilder:F}=p;const H={type:h,numArgs:x.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:j};for(let re=0;re<f.length;++re)Eg[f[re]]=H;D&&(Qc[h]=D),F&&(ed[h]=F)}const Mg={};function J(p,h){Mg[p]=h}class Ds{constructor(h,f,x){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=h,this.start=f,this.end=x}static range(h,f){return f?!h||!h.loc||!f.loc||h.loc.lexer!==f.loc.lexer?null:new Ds(h.loc.lexer,h.loc.start,f.loc.end):h&&h.loc}}class Us{constructor(h,f){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=h,this.loc=f}range(h,f){return new Us(f,Ds.range(this,h))}}function Ag(p){const h=[];p.consumeSpaces();let f=p.fetch().text;for(f==="\\relax"&&(p.consume(),p.consumeSpaces(),f=p.fetch().text);f==="\\hline"||f==="\\hdashline";)p.consume(),h.push(f==="\\hdashline"),p.consumeSpaces(),f=p.fetch().text;return h}const ld=p=>{if(!p.parser.settings.displayMode)throw new i("{"+p.envName+"} can be used only in display mode.")};function Bh(p){if(p.indexOf("ed")===-1)return p.indexOf("*")===-1}function hi(p,h,f){let{hskipBeforeAndAfter:x,addJot:j,cols:D,arraystretch:F,colSeparationType:H,autoTag:re,singleRow:we,emptySingleRow:Pe,maxNumCols:Ve,leqno:He}=h;if(p.gullet.beginGroup(),we||p.gullet.macros.set("\\cr","\\\\\\relax"),!F){const an=p.gullet.expandMacroAsText("\\arraystretch");if(an==null)F=1;else if(F=parseFloat(an),!F||F<0)throw new i("Invalid \\arraystretch: "+an)}p.gullet.beginGroup();let ct=[];const Pt=[ct],Ut=[],Pr=[],jr=re!=null?[]:void 0;function _r(){re&&p.gullet.macros.set("\\@eqnsw","1",!0)}function Wr(){jr&&(p.gullet.macros.get("\\df@tag")?(jr.push(p.subparse([new Us("\\df@tag")])),p.gullet.macros.set("\\df@tag",void 0,!0)):jr.push(!!re&&p.gullet.macros.get("\\@eqnsw")==="1"))}for(_r(),Pr.push(Ag(p));;){let an=p.parseExpression(!1,we?"\\end":"\\\\");p.gullet.endGroup(),p.gullet.beginGroup(),an={type:"ordgroup",mode:p.mode,body:an},f&&(an={type:"styling",mode:p.mode,style:f,body:[an]}),ct.push(an);const is=p.fetch().text;if(is==="&"){if(Ve&&ct.length===Ve){if(we||H)throw new i("Too many tab characters: &",p.nextToken);p.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}p.consume()}else if(is==="\\end"){Wr(),ct.length===1&&an.type==="styling"&&an.body[0].body.length===0&&(Pt.length>1||!Pe)&&Pt.pop(),Pr.length<Pt.length+1&&Pr.push([]);break}else if(is==="\\\\"){p.consume();let $n;p.gullet.future().text!==" "&&($n=p.parseSizeGroup(!0)),Ut.push($n?$n.value:null),Wr(),Pr.push(Ag(p)),ct=[],Pt.push(ct),_r()}else throw new i("Expected & or \\\\ or \\cr or \\end",p.nextToken)}return p.gullet.endGroup(),p.gullet.endGroup(),{type:"array",mode:p.mode,addJot:j,arraystretch:F,body:Pt,cols:D,rowGaps:Ut,hskipBeforeAndAfter:x,hLinesBeforeRow:Pr,colSeparationType:H,tags:jr,leqno:He}}function Uh(p){return p.slice(0,1)==="d"?"display":"text"}const wo=function(p,h){let f,x;const j=p.body.length,D=p.hLinesBeforeRow;let F=0,H=new Array(j);const re=[],we=Math.max(h.fontMetrics().arrayRuleWidth,h.minRuleThickness),Pe=1/h.fontMetrics().ptPerEm;let Ve=5*Pe;p.colSeparationType&&p.colSeparationType==="small"&&(Ve=.2778*(h.havingStyle(U.SCRIPT).sizeMultiplier/h.sizeMultiplier));const He=p.colSeparationType==="CD"?Zt({number:3,unit:"ex"},h):12*Pe,ct=3*Pe,Pt=p.arraystretch*He,Ut=.7*Pt,Pr=.3*Pt;let jr=0;function _r(Lr){for(let Qr=0;Qr<Lr.length;++Qr)Qr>0&&(jr+=.25),re.push({pos:jr,isDashed:Lr[Qr]})}for(_r(D[0]),f=0;f<p.body.length;++f){const Lr=p.body[f];let Qr=Ut,cn=Pr;F<Lr.length&&(F=Lr.length);const dn=new Array(Lr.length);for(x=0;x<Lr.length;++x){const Hs=zr(Lr[x],h);cn<Hs.depth&&(cn=Hs.depth),Qr<Hs.height&&(Qr=Hs.height),dn[x]=Hs}const Tn=p.rowGaps[f];let bn=0;Tn&&(bn=Zt(Tn,h),bn>0&&(bn+=Pr,cn<bn&&(cn=bn),bn=0)),p.addJot&&(cn+=ct),dn.height=Qr,dn.depth=cn,jr+=Qr,dn.pos=jr,jr+=cn+bn,H[f]=dn,_r(D[f+1])}const Wr=jr/2+h.fontMetrics().axisHeight,an=p.cols||[],is=[];let $n,Gs;const Ya=[];if(p.tags&&p.tags.some(Lr=>Lr))for(f=0;f<j;++f){const Lr=H[f],Qr=Lr.pos-Wr,cn=p.tags[f];let dn;cn===!0?dn=$e.makeSpan(["eqn-num"],[],h):cn===!1?dn=$e.makeSpan([],[],h):dn=$e.makeSpan([],Vn(cn,h,!0),h),dn.depth=Lr.depth,dn.height=Lr.height,Ya.push({type:"elem",elem:dn,shift:Qr})}for(x=0,Gs=0;x<F||Gs<an.length;++x,++Gs){let Lr=an[Gs]||{},Qr=!0;for(;Lr.type==="separator";){if(Qr||($n=$e.makeSpan(["arraycolsep"],[]),$n.style.width=at(h.fontMetrics().doubleRuleSep),is.push($n)),Lr.separator==="|"||Lr.separator===":"){const Tn=Lr.separator==="|"?"solid":"dashed",bn=$e.makeSpan(["vertical-separator"],[],h);bn.style.height=at(jr),bn.style.borderRightWidth=at(we),bn.style.borderRightStyle=Tn,bn.style.margin="0 "+at(-we/2);const Hs=jr-Wr;Hs&&(bn.style.verticalAlign=at(-Hs)),is.push(bn)}else throw new i("Invalid separator type: "+Lr.separator);Gs++,Lr=an[Gs]||{},Qr=!1}if(x>=F)continue;let cn;(x>0||p.hskipBeforeAndAfter)&&(cn=b.deflt(Lr.pregap,Ve),cn!==0&&($n=$e.makeSpan(["arraycolsep"],[]),$n.style.width=at(cn),is.push($n)));let dn=[];for(f=0;f<j;++f){const Tn=H[f],bn=Tn[x];if(!bn)continue;const Hs=Tn.pos-Wr;bn.depth=Tn.depth,bn.height=Tn.height,dn.push({type:"elem",elem:bn,shift:Hs})}dn=$e.makeVList({positionType:"individualShift",children:dn},h),dn=$e.makeSpan(["col-align-"+(Lr.align||"c")],[dn]),is.push(dn),(x<F-1||p.hskipBeforeAndAfter)&&(cn=b.deflt(Lr.postgap,Ve),cn!==0&&($n=$e.makeSpan(["arraycolsep"],[]),$n.style.width=at(cn),is.push($n)))}if(H=$e.makeSpan(["mtable"],is),re.length>0){const Lr=$e.makeLineSpan("hline",h,we),Qr=$e.makeLineSpan("hdashline",h,we),cn=[{type:"elem",elem:H,shift:0}];for(;re.length>0;){const dn=re.pop(),Tn=dn.pos-Wr;dn.isDashed?cn.push({type:"elem",elem:Qr,shift:Tn}):cn.push({type:"elem",elem:Lr,shift:Tn})}H=$e.makeVList({positionType:"individualShift",children:cn},h)}if(Ya.length===0)return $e.makeSpan(["mord"],[H],h);{let Lr=$e.makeVList({positionType:"individualShift",children:Ya},h);return Lr=$e.makeSpan(["tag"],[Lr],h),$e.makeFragment([H,Lr])}},ow={c:"center ",l:"left ",r:"right "},Co=function(p,h){const f=[],x=new ht.MathNode("mtd",[],["mtr-glue"]),j=new ht.MathNode("mtd",[],["mml-eqn-num"]);for(let Ve=0;Ve<p.body.length;Ve++){const He=p.body[Ve],ct=[];for(let Pt=0;Pt<He.length;Pt++)ct.push(new ht.MathNode("mtd",[nn(He[Pt],h)]));p.tags&&p.tags[Ve]&&(ct.unshift(x),ct.push(x),p.leqno?ct.unshift(j):ct.push(j)),f.push(new ht.MathNode("mtr",ct))}let D=new ht.MathNode("mtable",f);const F=p.arraystretch===.5?.1:.16+p.arraystretch-1+(p.addJot?.09:0);D.setAttribute("rowspacing",at(F));let H="",re="";if(p.cols&&p.cols.length>0){const Ve=p.cols;let He="",ct=!1,Pt=0,Ut=Ve.length;Ve[0].type==="separator"&&(H+="top ",Pt=1),Ve[Ve.length-1].type==="separator"&&(H+="bottom ",Ut-=1);for(let Pr=Pt;Pr<Ut;Pr++)Ve[Pr].type==="align"?(re+=ow[Ve[Pr].align],ct&&(He+="none "),ct=!0):Ve[Pr].type==="separator"&&ct&&(He+=Ve[Pr].separator==="|"?"solid ":"dashed ",ct=!1);D.setAttribute("columnalign",re.trim()),/[sd]/.test(He)&&D.setAttribute("columnlines",He.trim())}if(p.colSeparationType==="align"){const Ve=p.cols||[];let He="";for(let ct=1;ct<Ve.length;ct++)He+=ct%2?"0em ":"1em ";D.setAttribute("columnspacing",He.trim())}else p.colSeparationType==="alignat"||p.colSeparationType==="gather"?D.setAttribute("columnspacing","0em"):p.colSeparationType==="small"?D.setAttribute("columnspacing","0.2778em"):p.colSeparationType==="CD"?D.setAttribute("columnspacing","0.5em"):D.setAttribute("columnspacing","1em");let we="";const Pe=p.hLinesBeforeRow;H+=Pe[0].length>0?"left ":"",H+=Pe[Pe.length-1].length>0?"right ":"";for(let Ve=1;Ve<Pe.length-1;Ve++)we+=Pe[Ve].length===0?"none ":Pe[Ve][0]?"dashed ":"solid ";return/[sd]/.test(we)&&D.setAttribute("rowlines",we.trim()),H!==""&&(D=new ht.MathNode("menclose",[D]),D.setAttribute("notation",H.trim())),p.arraystretch&&p.arraystretch<1&&(D=new ht.MathNode("mstyle",[D]),D.setAttribute("scriptlevel","1")),D},Pg=function(p,h){p.envName.indexOf("ed")===-1&&ld(p);const f=[],x=p.envName.indexOf("at")>-1?"alignat":"align",j=p.envName==="split",D=hi(p.parser,{cols:f,addJot:!0,autoTag:j?void 0:Bh(p.envName),emptySingleRow:!0,colSeparationType:x,maxNumCols:j?2:void 0,leqno:p.parser.settings.leqno},"display");let F,H=0;const re={type:"ordgroup",mode:p.mode,body:[]};if(h[0]&&h[0].type==="ordgroup"){let Pe="";for(let Ve=0;Ve<h[0].body.length;Ve++){const He=Sr(h[0].body[Ve],"textord");Pe+=He.text}F=Number(Pe),H=F*2}const we=!H;D.body.forEach(function(Pe){for(let Ve=1;Ve<Pe.length;Ve+=2){const He=Sr(Pe[Ve],"styling");Sr(He.body[0],"ordgroup").body.unshift(re)}if(we)H<Pe.length&&(H=Pe.length);else{const Ve=Pe.length/2;if(F<Ve)throw new i("Too many math in a row: "+("expected "+F+", but got "+Ve),Pe[0])}});for(let Pe=0;Pe<H;++Pe){let Ve="r",He=0;Pe%2===1?Ve="l":Pe>0&&we&&(He=1),f[Pe]={type:"align",align:Ve,pregap:He,postgap:0}}return D.colSeparationType=we?"align":"alignat",D};So({type:"array",names:["array","darray"],props:{numArgs:1},handler(p,h){const j=(nd(h[0])?[h[0]]:Sr(h[0],"ordgroup").body).map(function(F){const re=Ah(F).text;if("lcr".indexOf(re)!==-1)return{type:"align",align:re};if(re==="|")return{type:"separator",separator:"|"};if(re===":")return{type:"separator",separator:":"};throw new i("Unknown column alignment: "+re,F)}),D={cols:j,hskipBeforeAndAfter:!0,maxNumCols:j.length};return hi(p.parser,D,Uh(p.envName))},htmlBuilder:wo,mathmlBuilder:Co}),So({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(p){const h={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[p.envName.replace("*","")];let f="c";const x={hskipBeforeAndAfter:!1,cols:[{type:"align",align:f}]};if(p.envName.charAt(p.envName.length-1)==="*"){const F=p.parser;if(F.consumeSpaces(),F.fetch().text==="["){if(F.consume(),F.consumeSpaces(),f=F.fetch().text,"lcr".indexOf(f)===-1)throw new i("Expected l or c or r",F.nextToken);F.consume(),F.consumeSpaces(),F.expect("]"),F.consume(),x.cols=[{type:"align",align:f}]}}const j=hi(p.parser,x,Uh(p.envName)),D=Math.max(0,...j.body.map(F=>F.length));return j.cols=new Array(D).fill({type:"align",align:f}),h?{type:"leftright",mode:p.mode,body:[j],left:h[0],right:h[1],rightColor:void 0}:j},htmlBuilder:wo,mathmlBuilder:Co}),So({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(p){const h={arraystretch:.5},f=hi(p.parser,h,"script");return f.colSeparationType="small",f},htmlBuilder:wo,mathmlBuilder:Co}),So({type:"array",names:["subarray"],props:{numArgs:1},handler(p,h){const j=(nd(h[0])?[h[0]]:Sr(h[0],"ordgroup").body).map(function(F){const re=Ah(F).text;if("lc".indexOf(re)!==-1)return{type:"align",align:re};throw new i("Unknown column alignment: "+re,F)});if(j.length>1)throw new i("{subarray} can contain only one column");let D={cols:j,hskipBeforeAndAfter:!1,arraystretch:.5};if(D=hi(p.parser,D,"script"),D.body.length>0&&D.body[0].length>1)throw new i("{subarray} can contain only one column");return D},htmlBuilder:wo,mathmlBuilder:Co}),So({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(p){const h={arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},f=hi(p.parser,h,Uh(p.envName));return{type:"leftright",mode:p.mode,body:[f],left:p.envName.indexOf("r")>-1?".":"\\{",right:p.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:wo,mathmlBuilder:Co}),So({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:Pg,htmlBuilder:wo,mathmlBuilder:Co}),So({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(p){b.contains(["gather","gather*"],p.envName)&&ld(p);const h={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:Bh(p.envName),emptySingleRow:!0,leqno:p.parser.settings.leqno};return hi(p.parser,h,"display")},htmlBuilder:wo,mathmlBuilder:Co}),So({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:Pg,htmlBuilder:wo,mathmlBuilder:Co}),So({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(p){ld(p);const h={autoTag:Bh(p.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:p.parser.settings.leqno};return hi(p.parser,h,"display")},htmlBuilder:wo,mathmlBuilder:Co}),So({type:"array",names:["CD"],props:{numArgs:0},handler(p){return ld(p),W5(p.parser)},htmlBuilder:wo,mathmlBuilder:Co}),J("\\nonumber","\\gdef\\@eqnsw{0}"),J("\\notag","\\nonumber"),It({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(p,h){throw new i(p.funcName+" valid only within array environment")}});var Ng=Eg;It({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(p,h){let{parser:f,funcName:x}=p;const j=h[0];if(j.type!=="ordgroup")throw new i("Invalid environment name",j);let D="";for(let F=0;F<j.body.length;++F)D+=Sr(j.body[F],"textord").text;if(x==="\\begin"){if(!Ng.hasOwnProperty(D))throw new i("No such environment: "+D,j);const F=Ng[D],{args:H,optArgs:re}=f.parseArguments("\\begin{"+D+"}",F),we={mode:f.mode,envName:D,parser:f},Pe=F.handler(we,H,re);f.expect("\\end",!1);const Ve=f.nextToken,He=Sr(f.parseFunction(),"environment");if(He.name!==D)throw new i("Mismatch: \\begin{"+D+"} matched by \\end{"+He.name+"}",Ve);return Pe}return{type:"environment",mode:f.mode,name:D,nameGroup:j}}});const Dg=(p,h)=>{const f=p.font,x=h.withFont(f);return zr(p.body,x)},Rg=(p,h)=>{const f=p.font,x=h.withFont(f);return nn(p.body,x)},Og={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};It({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathsfit","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(p,h)=>{let{parser:f,funcName:x}=p;const j=td(h[0]);let D=x;return D in Og&&(D=Og[D]),{type:"font",mode:f.mode,font:D.slice(1),body:j}},htmlBuilder:Dg,mathmlBuilder:Rg}),It({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(p,h)=>{let{parser:f}=p;const x=h[0],j=b.isCharacterBox(x);return{type:"mclass",mode:f.mode,mclass:od(x),body:[{type:"font",mode:f.mode,font:"boldsymbol",body:x}],isCharacterBox:j}}}),It({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(p,h)=>{let{parser:f,funcName:x,breakOnTokenText:j}=p;const{mode:D}=f,F=f.parseExpression(!0,j),H="math"+x.slice(1);return{type:"font",mode:D,font:H,body:{type:"ordgroup",mode:f.mode,body:F}}},htmlBuilder:Dg,mathmlBuilder:Rg});const _g=(p,h)=>{let f=h;return p==="display"?f=f.id>=U.SCRIPT.id?f.text():U.DISPLAY:p==="text"&&f.size===U.DISPLAY.size?f=U.TEXT:p==="script"?f=U.SCRIPT:p==="scriptscript"&&(f=U.SCRIPTSCRIPT),f},Gh=(p,h)=>{const f=_g(p.size,h.style),x=f.fracNum(),j=f.fracDen();let D;D=h.havingStyle(x);const F=zr(p.numer,D,h);if(p.continued){const _r=8.5/h.fontMetrics().ptPerEm,Wr=3.5/h.fontMetrics().ptPerEm;F.height=F.height<_r?_r:F.height,F.depth=F.depth<Wr?Wr:F.depth}D=h.havingStyle(j);const H=zr(p.denom,D,h);let re,we,Pe;p.hasBarLine?(p.barSize?(we=Zt(p.barSize,h),re=$e.makeLineSpan("frac-line",h,we)):re=$e.makeLineSpan("frac-line",h),we=re.height,Pe=re.height):(re=null,we=0,Pe=h.fontMetrics().defaultRuleThickness);let Ve,He,ct;f.size===U.DISPLAY.size||p.size==="display"?(Ve=h.fontMetrics().num1,we>0?He=3*Pe:He=7*Pe,ct=h.fontMetrics().denom1):(we>0?(Ve=h.fontMetrics().num2,He=Pe):(Ve=h.fontMetrics().num3,He=3*Pe),ct=h.fontMetrics().denom2);let Pt;if(re){const _r=h.fontMetrics().axisHeight;Ve-F.depth-(_r+.5*we)<He&&(Ve+=He-(Ve-F.depth-(_r+.5*we))),_r-.5*we-(H.height-ct)<He&&(ct+=He-(_r-.5*we-(H.height-ct)));const Wr=-(_r-.5*we);Pt=$e.makeVList({positionType:"individualShift",children:[{type:"elem",elem:H,shift:ct},{type:"elem",elem:re,shift:Wr},{type:"elem",elem:F,shift:-Ve}]},h)}else{const _r=Ve-F.depth-(H.height-ct);_r<He&&(Ve+=.5*(He-_r),ct+=.5*(He-_r)),Pt=$e.makeVList({positionType:"individualShift",children:[{type:"elem",elem:H,shift:ct},{type:"elem",elem:F,shift:-Ve}]},h)}D=h.havingStyle(f),Pt.height*=D.sizeMultiplier/h.sizeMultiplier,Pt.depth*=D.sizeMultiplier/h.sizeMultiplier;let Ut;f.size===U.DISPLAY.size?Ut=h.fontMetrics().delim1:f.size===U.SCRIPTSCRIPT.size?Ut=h.havingStyle(U.SCRIPT).fontMetrics().delim2:Ut=h.fontMetrics().delim2;let Pr,jr;return p.leftDelim==null?Pr=Vl(h,["mopen"]):Pr=Go.customSizedDelim(p.leftDelim,Ut,!0,h.havingStyle(f),p.mode,["mopen"]),p.continued?jr=$e.makeSpan([]):p.rightDelim==null?jr=Vl(h,["mclose"]):jr=Go.customSizedDelim(p.rightDelim,Ut,!0,h.havingStyle(f),p.mode,["mclose"]),$e.makeSpan(["mord"].concat(D.sizingClasses(h)),[Pr,$e.makeSpan(["mfrac"],[Pt]),jr],h)},Hh=(p,h)=>{let f=new ht.MathNode("mfrac",[nn(p.numer,h),nn(p.denom,h)]);if(!p.hasBarLine)f.setAttribute("linethickness","0px");else if(p.barSize){const j=Zt(p.barSize,h);f.setAttribute("linethickness",at(j))}const x=_g(p.size,h.style);if(x.size!==h.style.size){f=new ht.MathNode("mstyle",[f]);const j=x.size===U.DISPLAY.size?"true":"false";f.setAttribute("displaystyle",j),f.setAttribute("scriptlevel","0")}if(p.leftDelim!=null||p.rightDelim!=null){const j=[];if(p.leftDelim!=null){const D=new ht.MathNode("mo",[new ht.TextNode(p.leftDelim.replace("\\",""))]);D.setAttribute("fence","true"),j.push(D)}if(j.push(f),p.rightDelim!=null){const D=new ht.MathNode("mo",[new ht.TextNode(p.rightDelim.replace("\\",""))]);D.setAttribute("fence","true"),j.push(D)}return Th(j)}return f};It({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(p,h)=>{let{parser:f,funcName:x}=p;const j=h[0],D=h[1];let F,H=null,re=null,we="auto";switch(x){case"\\dfrac":case"\\frac":case"\\tfrac":F=!0;break;case"\\\\atopfrac":F=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":F=!1,H="(",re=")";break;case"\\\\bracefrac":F=!1,H="\\{",re="\\}";break;case"\\\\brackfrac":F=!1,H="[",re="]";break;default:throw new Error("Unrecognized genfrac command")}switch(x){case"\\dfrac":case"\\dbinom":we="display";break;case"\\tfrac":case"\\tbinom":we="text";break}return{type:"genfrac",mode:f.mode,continued:!1,numer:j,denom:D,hasBarLine:F,leftDelim:H,rightDelim:re,size:we,barSize:null}},htmlBuilder:Gh,mathmlBuilder:Hh}),It({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(p,h)=>{let{parser:f,funcName:x}=p;const j=h[0],D=h[1];return{type:"genfrac",mode:f.mode,continued:!0,numer:j,denom:D,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}}),It({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(p){let{parser:h,funcName:f,token:x}=p,j;switch(f){case"\\over":j="\\frac";break;case"\\choose":j="\\binom";break;case"\\atop":j="\\\\atopfrac";break;case"\\brace":j="\\\\bracefrac";break;case"\\brack":j="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:h.mode,replaceWith:j,token:x}}});const Fg=["display","text","script","scriptscript"],Vg=function(p){let h=null;return p.length>0&&(h=p,h=h==="."?null:h),h};It({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(p,h){let{parser:f}=p;const x=h[4],j=h[5],D=td(h[0]),F=D.type==="atom"&&D.family==="open"?Vg(D.text):null,H=td(h[1]),re=H.type==="atom"&&H.family==="close"?Vg(H.text):null,we=Sr(h[2],"size");let Pe,Ve=null;we.isBlank?Pe=!0:(Ve=we.value,Pe=Ve.number>0);let He="auto",ct=h[3];if(ct.type==="ordgroup"){if(ct.body.length>0){const Pt=Sr(ct.body[0],"textord");He=Fg[Number(Pt.text)]}}else ct=Sr(ct,"textord"),He=Fg[Number(ct.text)];return{type:"genfrac",mode:f.mode,numer:x,denom:j,continued:!1,hasBarLine:Pe,barSize:Ve,leftDelim:F,rightDelim:re,size:He}},htmlBuilder:Gh,mathmlBuilder:Hh}),It({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(p,h){let{parser:f,funcName:x,token:j}=p;return{type:"infix",mode:f.mode,replaceWith:"\\\\abovefrac",size:Sr(h[0],"size").value,token:j}}}),It({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(p,h)=>{let{parser:f,funcName:x}=p;const j=h[0],D=I(Sr(h[1],"infix").size),F=h[2],H=D.number>0;return{type:"genfrac",mode:f.mode,numer:j,denom:F,continued:!1,hasBarLine:H,barSize:D,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:Gh,mathmlBuilder:Hh});const $g=(p,h)=>{const f=h.style;let x,j;p.type==="supsub"?(x=p.sup?zr(p.sup,h.havingStyle(f.sup()),h):zr(p.sub,h.havingStyle(f.sub()),h),j=Sr(p.base,"horizBrace")):j=Sr(p,"horizBrace");const D=zr(j.base,h.havingBaseStyle(U.DISPLAY)),F=Uo.svgSpan(j,h);let H;if(j.isOver?(H=$e.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:D},{type:"kern",size:.1},{type:"elem",elem:F}]},h),H.children[0].children[0].children[1].classes.push("svg-align")):(H=$e.makeVList({positionType:"bottom",positionData:D.depth+.1+F.height,children:[{type:"elem",elem:F},{type:"kern",size:.1},{type:"elem",elem:D}]},h),H.children[0].children[0].children[0].classes.push("svg-align")),x){const re=$e.makeSpan(["mord",j.isOver?"mover":"munder"],[H],h);j.isOver?H=$e.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:re},{type:"kern",size:.2},{type:"elem",elem:x}]},h):H=$e.makeVList({positionType:"bottom",positionData:re.depth+.2+x.height+x.depth,children:[{type:"elem",elem:x},{type:"kern",size:.2},{type:"elem",elem:re}]},h)}return $e.makeSpan(["mord",j.isOver?"mover":"munder"],[H],h)};It({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(p,h){let{parser:f,funcName:x}=p;return{type:"horizBrace",mode:f.mode,label:x,isOver:/^\\over/.test(x),base:h[0]}},htmlBuilder:$g,mathmlBuilder:(p,h)=>{const f=Uo.mathMLnode(p.label);return new ht.MathNode(p.isOver?"mover":"munder",[nn(p.base,h),f])}}),It({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(p,h)=>{let{parser:f}=p;const x=h[1],j=Sr(h[0],"url").url;return f.settings.isTrusted({command:"\\href",url:j})?{type:"href",mode:f.mode,href:j,body:Pn(x)}:f.formatUnsupportedCmd("\\href")},htmlBuilder:(p,h)=>{const f=Vn(p.body,h,!1);return $e.makeAnchor(p.href,[],f,h)},mathmlBuilder:(p,h)=>{let f=ui(p.body,h);return f instanceof Ns||(f=new Ns("mrow",[f])),f.setAttribute("href",p.href),f}}),It({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(p,h)=>{let{parser:f}=p;const x=Sr(h[0],"url").url;if(!f.settings.isTrusted({command:"\\url",url:x}))return f.formatUnsupportedCmd("\\url");const j=[];for(let F=0;F<x.length;F++){let H=x[F];H==="~"&&(H="\\textasciitilde"),j.push({type:"textord",mode:"text",text:H})}const D={type:"text",mode:f.mode,font:"\\texttt",body:j};return{type:"href",mode:f.mode,href:x,body:Pn(D)}}}),It({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(p,h){let{parser:f}=p;return{type:"hbox",mode:f.mode,body:Pn(h[0])}},htmlBuilder(p,h){const f=Vn(p.body,h,!1);return $e.makeFragment(f)},mathmlBuilder(p,h){return new ht.MathNode("mrow",Ss(p.body,h))}}),It({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(p,h)=>{let{parser:f,funcName:x,token:j}=p;const D=Sr(h[0],"raw").string,F=h[1];f.settings.strict&&f.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");let H;const re={};switch(x){case"\\htmlClass":re.class=D,H={command:"\\htmlClass",class:D};break;case"\\htmlId":re.id=D,H={command:"\\htmlId",id:D};break;case"\\htmlStyle":re.style=D,H={command:"\\htmlStyle",style:D};break;case"\\htmlData":{const we=D.split(",");for(let Pe=0;Pe<we.length;Pe++){const Ve=we[Pe].split("=");if(Ve.length!==2)throw new i("Error parsing key-value for \\htmlData");re["data-"+Ve[0].trim()]=Ve[1].trim()}H={command:"\\htmlData",attributes:re};break}default:throw new Error("Unrecognized html command")}return f.settings.isTrusted(H)?{type:"html",mode:f.mode,attributes:re,body:Pn(F)}:f.formatUnsupportedCmd(x)},htmlBuilder:(p,h)=>{const f=Vn(p.body,h,!1),x=["enclosing"];p.attributes.class&&x.push(...p.attributes.class.trim().split(/\s+/));const j=$e.makeSpan(x,f,h);for(const D in p.attributes)D!=="class"&&p.attributes.hasOwnProperty(D)&&j.setAttribute(D,p.attributes[D]);return j},mathmlBuilder:(p,h)=>ui(p.body,h)}),It({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(p,h)=>{let{parser:f}=p;return{type:"htmlmathml",mode:f.mode,html:Pn(h[0]),mathml:Pn(h[1])}},htmlBuilder:(p,h)=>{const f=Vn(p.html,h,!1);return $e.makeFragment(f)},mathmlBuilder:(p,h)=>ui(p.mathml,h)});const Wh=function(p){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(p))return{number:+p,unit:"bp"};{const h=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(p);if(!h)throw new i("Invalid size: '"+p+"' in \\includegraphics");const f={number:+(h[1]+h[2]),unit:h[3]};if(!Qt(f))throw new i("Invalid unit: '"+f.unit+"' in \\includegraphics.");return f}};It({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(p,h,f)=>{let{parser:x}=p,j={number:0,unit:"em"},D={number:.9,unit:"em"},F={number:0,unit:"em"},H="";if(f[0]){const Pe=Sr(f[0],"raw").string.split(",");for(let Ve=0;Ve<Pe.length;Ve++){const He=Pe[Ve].split("=");if(He.length===2){const ct=He[1].trim();switch(He[0].trim()){case"alt":H=ct;break;case"width":j=Wh(ct);break;case"height":D=Wh(ct);break;case"totalheight":F=Wh(ct);break;default:throw new i("Invalid key: '"+He[0]+"' in \\includegraphics.")}}}}const re=Sr(h[0],"url").url;return H===""&&(H=re,H=H.replace(/^.*[\\/]/,""),H=H.substring(0,H.lastIndexOf("."))),x.settings.isTrusted({command:"\\includegraphics",url:re})?{type:"includegraphics",mode:x.mode,alt:H,width:j,height:D,totalheight:F,src:re}:x.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(p,h)=>{const f=Zt(p.height,h);let x=0;p.totalheight.number>0&&(x=Zt(p.totalheight,h)-f);let j=0;p.width.number>0&&(j=Zt(p.width,h));const D={height:at(f+x)};j>0&&(D.width=at(j)),x>0&&(D.verticalAlign=at(-x));const F=new We(p.src,p.alt,D);return F.height=f,F.depth=x,F},mathmlBuilder:(p,h)=>{const f=new ht.MathNode("mglyph",[]);f.setAttribute("alt",p.alt);const x=Zt(p.height,h);let j=0;if(p.totalheight.number>0&&(j=Zt(p.totalheight,h)-x,f.setAttribute("valign",at(-j))),f.setAttribute("height",at(x+j)),p.width.number>0){const D=Zt(p.width,h);f.setAttribute("width",at(D))}return f.setAttribute("src",p.src),f}}),It({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(p,h){let{parser:f,funcName:x}=p;const j=Sr(h[0],"size");if(f.settings.strict){const D=x[1]==="m",F=j.value.unit==="mu";D?(F||f.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+x+" supports only mu units, "+("not "+j.value.unit+" units")),f.mode!=="math"&&f.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+x+" works only in math mode")):F&&f.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+x+" doesn't support mu units")}return{type:"kern",mode:f.mode,dimension:j.value}},htmlBuilder(p,h){return $e.makeGlue(p.dimension,h)},mathmlBuilder(p,h){const f=Zt(p.dimension,h);return new ht.SpaceNode(f)}}),It({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(p,h)=>{let{parser:f,funcName:x}=p;const j=h[0];return{type:"lap",mode:f.mode,alignment:x.slice(5),body:j}},htmlBuilder:(p,h)=>{let f;p.alignment==="clap"?(f=$e.makeSpan([],[zr(p.body,h)]),f=$e.makeSpan(["inner"],[f],h)):f=$e.makeSpan(["inner"],[zr(p.body,h)]);const x=$e.makeSpan(["fix"],[]);let j=$e.makeSpan([p.alignment],[f,x],h);const D=$e.makeSpan(["strut"]);return D.style.height=at(j.height+j.depth),j.depth&&(D.style.verticalAlign=at(-j.depth)),j.children.unshift(D),j=$e.makeSpan(["thinbox"],[j],h),$e.makeSpan(["mord","vbox"],[j],h)},mathmlBuilder:(p,h)=>{const f=new ht.MathNode("mpadded",[nn(p.body,h)]);if(p.alignment!=="rlap"){const x=p.alignment==="llap"?"-1":"-0.5";f.setAttribute("lspace",x+"width")}return f.setAttribute("width","0px"),f}}),It({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(p,h){let{funcName:f,parser:x}=p;const j=x.mode;x.switchMode("math");const D=f==="\\("?"\\)":"$",F=x.parseExpression(!1,D);return x.expect(D),x.switchMode(j),{type:"styling",mode:x.mode,style:"text",body:F}}}),It({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(p,h){throw new i("Mismatched "+p.funcName)}});const zg=(p,h)=>{switch(h.style.size){case U.DISPLAY.size:return p.display;case U.TEXT.size:return p.text;case U.SCRIPT.size:return p.script;case U.SCRIPTSCRIPT.size:return p.scriptscript;default:return p.text}};It({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(p,h)=>{let{parser:f}=p;return{type:"mathchoice",mode:f.mode,display:Pn(h[0]),text:Pn(h[1]),script:Pn(h[2]),scriptscript:Pn(h[3])}},htmlBuilder:(p,h)=>{const f=zg(p,h),x=Vn(f,h,!1);return $e.makeFragment(x)},mathmlBuilder:(p,h)=>{const f=zg(p,h);return ui(f,h)}});const Lg=(p,h,f,x,j,D,F)=>{p=$e.makeSpan([],[p]);const H=f&&b.isCharacterBox(f);let re,we;if(h){const He=zr(h,x.havingStyle(j.sup()),x);we={elem:He,kern:Math.max(x.fontMetrics().bigOpSpacing1,x.fontMetrics().bigOpSpacing3-He.depth)}}if(f){const He=zr(f,x.havingStyle(j.sub()),x);re={elem:He,kern:Math.max(x.fontMetrics().bigOpSpacing2,x.fontMetrics().bigOpSpacing4-He.height)}}let Pe;if(we&&re){const He=x.fontMetrics().bigOpSpacing5+re.elem.height+re.elem.depth+re.kern+p.depth+F;Pe=$e.makeVList({positionType:"bottom",positionData:He,children:[{type:"kern",size:x.fontMetrics().bigOpSpacing5},{type:"elem",elem:re.elem,marginLeft:at(-D)},{type:"kern",size:re.kern},{type:"elem",elem:p},{type:"kern",size:we.kern},{type:"elem",elem:we.elem,marginLeft:at(D)},{type:"kern",size:x.fontMetrics().bigOpSpacing5}]},x)}else if(re){const He=p.height-F;Pe=$e.makeVList({positionType:"top",positionData:He,children:[{type:"kern",size:x.fontMetrics().bigOpSpacing5},{type:"elem",elem:re.elem,marginLeft:at(-D)},{type:"kern",size:re.kern},{type:"elem",elem:p}]},x)}else if(we){const He=p.depth+F;Pe=$e.makeVList({positionType:"bottom",positionData:He,children:[{type:"elem",elem:p},{type:"kern",size:we.kern},{type:"elem",elem:we.elem,marginLeft:at(D)},{type:"kern",size:x.fontMetrics().bigOpSpacing5}]},x)}else return p;const Ve=[Pe];if(re&&D!==0&&!H){const He=$e.makeSpan(["mspace"],[],x);He.style.marginRight=at(D),Ve.unshift(He)}return $e.makeSpan(["mop","op-limits"],Ve,x)},Bg=["\\smallint"],Ja=(p,h)=>{let f,x,j=!1,D;p.type==="supsub"?(f=p.sup,x=p.sub,D=Sr(p.base,"op"),j=!0):D=Sr(p,"op");const F=h.style;let H=!1;F.size===U.DISPLAY.size&&D.symbol&&!b.contains(Bg,D.name)&&(H=!0);let re;if(D.symbol){const Ve=H?"Size2-Regular":"Size1-Regular";let He="";if((D.name==="\\oiint"||D.name==="\\oiiint")&&(He=D.name.slice(1),D.name=He==="oiint"?"\\iint":"\\iiint"),re=$e.makeSymbol(D.name,Ve,"math",h,["mop","op-symbol",H?"large-op":"small-op"]),He.length>0){const ct=re.italic,Pt=$e.staticSvg(He+"Size"+(H?"2":"1"),h);re=$e.makeVList({positionType:"individualShift",children:[{type:"elem",elem:re,shift:0},{type:"elem",elem:Pt,shift:H?.08:0}]},h),D.name="\\"+He,re.classes.unshift("mop"),re.italic=ct}}else if(D.body){const Ve=Vn(D.body,h,!0);Ve.length===1&&Ve[0]instanceof Et?(re=Ve[0],re.classes[0]="mop"):re=$e.makeSpan(["mop"],Ve,h)}else{const Ve=[];for(let He=1;He<D.name.length;He++)Ve.push($e.mathsym(D.name[He],D.mode,h));re=$e.makeSpan(["mop"],Ve,h)}let we=0,Pe=0;return(re instanceof Et||D.name==="\\oiint"||D.name==="\\oiiint")&&!D.suppressBaseShift&&(we=(re.height-re.depth)/2-h.fontMetrics().axisHeight,Pe=re.italic),j?Lg(re,f,x,h,F,Pe,we):(we&&(re.style.position="relative",re.style.top=at(we)),re)},Ll=(p,h)=>{let f;if(p.symbol)f=new Ns("mo",[Bs(p.name,p.mode)]),b.contains(Bg,p.name)&&f.setAttribute("largeop","false");else if(p.body)f=new Ns("mo",Ss(p.body,h));else{f=new Ns("mi",[new bo(p.name.slice(1))]);const x=new Ns("mo",[Bs("â¡","text")]);p.parentIsSupSub?f=new Ns("mrow",[f,x]):f=og([f,x])}return f},iw={"âˆ":"\\prod","âˆ":"\\coprod","âˆ‘":"\\sum","â‹€":"\\bigwedge","â‹":"\\bigvee","â‹‚":"\\bigcap","â‹ƒ":"\\bigcup","â¨€":"\\bigodot","â¨":"\\bigoplus","â¨‚":"\\bigotimes","â¨„":"\\biguplus","â¨†":"\\bigsqcup"};It({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","âˆ","âˆ","âˆ‘","â‹€","â‹","â‹‚","â‹ƒ","â¨€","â¨","â¨‚","â¨„","â¨†"],props:{numArgs:0},handler:(p,h)=>{let{parser:f,funcName:x}=p,j=x;return j.length===1&&(j=iw[j]),{type:"op",mode:f.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:j}},htmlBuilder:Ja,mathmlBuilder:Ll}),It({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(p,h)=>{let{parser:f}=p;const x=h[0];return{type:"op",mode:f.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:Pn(x)}},htmlBuilder:Ja,mathmlBuilder:Ll});const aw={"âˆ«":"\\int","âˆ¬":"\\iint","âˆ­":"\\iiint","âˆ®":"\\oint","âˆ¯":"\\oiint","âˆ°":"\\oiiint"};It({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(p){let{parser:h,funcName:f}=p;return{type:"op",mode:h.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:f}},htmlBuilder:Ja,mathmlBuilder:Ll}),It({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(p){let{parser:h,funcName:f}=p;return{type:"op",mode:h.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:f}},htmlBuilder:Ja,mathmlBuilder:Ll}),It({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","âˆ«","âˆ¬","âˆ­","âˆ®","âˆ¯","âˆ°"],props:{numArgs:0},handler(p){let{parser:h,funcName:f}=p,x=f;return x.length===1&&(x=aw[x]),{type:"op",mode:h.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:x}},htmlBuilder:Ja,mathmlBuilder:Ll});const Ug=(p,h)=>{let f,x,j=!1,D;p.type==="supsub"?(f=p.sup,x=p.sub,D=Sr(p.base,"operatorname"),j=!0):D=Sr(p,"operatorname");let F;if(D.body.length>0){const H=D.body.map(we=>{const Pe=we.text;return typeof Pe=="string"?{type:"textord",mode:we.mode,text:Pe}:we}),re=Vn(H,h.withFont("mathrm"),!0);for(let we=0;we<re.length;we++){const Pe=re[we];Pe instanceof Et&&(Pe.text=Pe.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}F=$e.makeSpan(["mop"],re,h)}else F=$e.makeSpan(["mop"],[],h);return j?Lg(F,f,x,h,h.style,0,0):F};It({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(p,h)=>{let{parser:f,funcName:x}=p;const j=h[0];return{type:"operatorname",mode:f.mode,body:Pn(j),alwaysHandleSupSub:x==="\\operatornamewithlimits",limits:!1,parentIsSupSub:!1}},htmlBuilder:Ug,mathmlBuilder:(p,h)=>{let f=Ss(p.body,h.withFont("mathrm")),x=!0;for(let F=0;F<f.length;F++){const H=f[F];if(!(H instanceof ht.SpaceNode))if(H instanceof ht.MathNode)switch(H.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":{const re=H.children[0];H.children.length===1&&re instanceof ht.TextNode?re.text=re.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):x=!1;break}default:x=!1}else x=!1}if(x){const F=f.map(H=>H.toText()).join("");f=[new ht.TextNode(F)]}const j=new ht.MathNode("mi",f);j.setAttribute("mathvariant","normal");const D=new ht.MathNode("mo",[Bs("â¡","text")]);return p.parentIsSupSub?new ht.MathNode("mrow",[j,D]):ht.newDocumentFragment([j,D])}}),J("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@"),Ji({type:"ordgroup",htmlBuilder(p,h){return p.semisimple?$e.makeFragment(Vn(p.body,h,!1)):$e.makeSpan(["mord"],Vn(p.body,h,!0),h)},mathmlBuilder(p,h){return ui(p.body,h,!0)}}),It({type:"overline",names:["\\overline"],props:{numArgs:1},handler(p,h){let{parser:f}=p;const x=h[0];return{type:"overline",mode:f.mode,body:x}},htmlBuilder(p,h){const f=zr(p.body,h.havingCrampedStyle()),x=$e.makeLineSpan("overline-line",h),j=h.fontMetrics().defaultRuleThickness,D=$e.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:f},{type:"kern",size:3*j},{type:"elem",elem:x},{type:"kern",size:j}]},h);return $e.makeSpan(["mord","overline"],[D],h)},mathmlBuilder(p,h){const f=new ht.MathNode("mo",[new ht.TextNode("â€¾")]);f.setAttribute("stretchy","true");const x=new ht.MathNode("mover",[nn(p.body,h),f]);return x.setAttribute("accent","true"),x}}),It({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(p,h)=>{let{parser:f}=p;const x=h[0];return{type:"phantom",mode:f.mode,body:Pn(x)}},htmlBuilder:(p,h)=>{const f=Vn(p.body,h.withPhantom(),!1);return $e.makeFragment(f)},mathmlBuilder:(p,h)=>{const f=Ss(p.body,h);return new ht.MathNode("mphantom",f)}}),It({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(p,h)=>{let{parser:f}=p;const x=h[0];return{type:"hphantom",mode:f.mode,body:x}},htmlBuilder:(p,h)=>{let f=$e.makeSpan([],[zr(p.body,h.withPhantom())]);if(f.height=0,f.depth=0,f.children)for(let x=0;x<f.children.length;x++)f.children[x].height=0,f.children[x].depth=0;return f=$e.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:f}]},h),$e.makeSpan(["mord"],[f],h)},mathmlBuilder:(p,h)=>{const f=Ss(Pn(p.body),h),x=new ht.MathNode("mphantom",f),j=new ht.MathNode("mpadded",[x]);return j.setAttribute("height","0px"),j.setAttribute("depth","0px"),j}}),It({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(p,h)=>{let{parser:f}=p;const x=h[0];return{type:"vphantom",mode:f.mode,body:x}},htmlBuilder:(p,h)=>{const f=$e.makeSpan(["inner"],[zr(p.body,h.withPhantom())]),x=$e.makeSpan(["fix"],[]);return $e.makeSpan(["mord","rlap"],[f,x],h)},mathmlBuilder:(p,h)=>{const f=Ss(Pn(p.body),h),x=new ht.MathNode("mphantom",f),j=new ht.MathNode("mpadded",[x]);return j.setAttribute("width","0px"),j}}),It({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(p,h){let{parser:f}=p;const x=Sr(h[0],"size").value,j=h[1];return{type:"raisebox",mode:f.mode,dy:x,body:j}},htmlBuilder(p,h){const f=zr(p.body,h),x=Zt(p.dy,h);return $e.makeVList({positionType:"shift",positionData:-x,children:[{type:"elem",elem:f}]},h)},mathmlBuilder(p,h){const f=new ht.MathNode("mpadded",[nn(p.body,h)]),x=p.dy.number+p.dy.unit;return f.setAttribute("voffset",x),f}}),It({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0,allowedInArgument:!0},handler(p){let{parser:h}=p;return{type:"internal",mode:h.mode}}}),It({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["size","size","size"]},handler(p,h,f){let{parser:x}=p;const j=f[0],D=Sr(h[0],"size"),F=Sr(h[1],"size");return{type:"rule",mode:x.mode,shift:j&&Sr(j,"size").value,width:D.value,height:F.value}},htmlBuilder(p,h){const f=$e.makeSpan(["mord","rule"],[],h),x=Zt(p.width,h),j=Zt(p.height,h),D=p.shift?Zt(p.shift,h):0;return f.style.borderRightWidth=at(x),f.style.borderTopWidth=at(j),f.style.bottom=at(D),f.width=x,f.height=j+D,f.depth=-D,f.maxFontSize=j*1.125*h.sizeMultiplier,f},mathmlBuilder(p,h){const f=Zt(p.width,h),x=Zt(p.height,h),j=p.shift?Zt(p.shift,h):0,D=h.color&&h.getColor()||"black",F=new ht.MathNode("mspace");F.setAttribute("mathbackground",D),F.setAttribute("width",at(f)),F.setAttribute("height",at(x));const H=new ht.MathNode("mpadded",[F]);return j>=0?H.setAttribute("height",at(j)):(H.setAttribute("height",at(j)),H.setAttribute("depth",at(-j))),H.setAttribute("voffset",at(j)),H}});function Gg(p,h,f){const x=Vn(p,h,!1),j=h.sizeMultiplier/f.sizeMultiplier;for(let D=0;D<x.length;D++){const F=x[D].classes.indexOf("sizing");F<0?Array.prototype.push.apply(x[D].classes,h.sizingClasses(f)):x[D].classes[F+1]==="reset-size"+h.size&&(x[D].classes[F+1]="reset-size"+f.size),x[D].height*=j,x[D].depth*=j}return $e.makeFragment(x)}const Hg=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"];It({type:"sizing",names:Hg,props:{numArgs:0,allowedInText:!0},handler:(p,h)=>{let{breakOnTokenText:f,funcName:x,parser:j}=p;const D=j.parseExpression(!1,f);return{type:"sizing",mode:j.mode,size:Hg.indexOf(x)+1,body:D}},htmlBuilder:(p,h)=>{const f=h.havingSize(p.size);return Gg(p.body,f,h)},mathmlBuilder:(p,h)=>{const f=h.havingSize(p.size),x=Ss(p.body,f),j=new ht.MathNode("mstyle",x);return j.setAttribute("mathsize",at(f.sizeMultiplier)),j}}),It({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(p,h,f)=>{let{parser:x}=p,j=!1,D=!1;const F=f[0]&&Sr(f[0],"ordgroup");if(F){let re="";for(let we=0;we<F.body.length;++we)if(re=F.body[we].text,re==="t")j=!0;else if(re==="b")D=!0;else{j=!1,D=!1;break}}else j=!0,D=!0;const H=h[0];return{type:"smash",mode:x.mode,body:H,smashHeight:j,smashDepth:D}},htmlBuilder:(p,h)=>{const f=$e.makeSpan([],[zr(p.body,h)]);if(!p.smashHeight&&!p.smashDepth)return f;if(p.smashHeight&&(f.height=0,f.children))for(let j=0;j<f.children.length;j++)f.children[j].height=0;if(p.smashDepth&&(f.depth=0,f.children))for(let j=0;j<f.children.length;j++)f.children[j].depth=0;const x=$e.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:f}]},h);return $e.makeSpan(["mord"],[x],h)},mathmlBuilder:(p,h)=>{const f=new ht.MathNode("mpadded",[nn(p.body,h)]);return p.smashHeight&&f.setAttribute("height","0px"),p.smashDepth&&f.setAttribute("depth","0px"),f}}),It({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(p,h,f){let{parser:x}=p;const j=f[0],D=h[0];return{type:"sqrt",mode:x.mode,body:D,index:j}},htmlBuilder(p,h){let f=zr(p.body,h.havingCrampedStyle());f.height===0&&(f.height=h.fontMetrics().xHeight),f=$e.wrapFragment(f,h);const j=h.fontMetrics().defaultRuleThickness;let D=j;h.style.id<U.TEXT.id&&(D=h.fontMetrics().xHeight);let F=j+D/4;const H=f.height+f.depth+F+j,{span:re,ruleWidth:we,advanceWidth:Pe}=Go.sqrtImage(H,h),Ve=re.height-we;Ve>f.height+f.depth+F&&(F=(F+Ve-f.height-f.depth)/2);const He=re.height-f.height-F-we;f.style.paddingLeft=at(Pe);const ct=$e.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:f,wrapperClasses:["svg-align"]},{type:"kern",size:-(f.height+He)},{type:"elem",elem:re},{type:"kern",size:we}]},h);if(p.index){const Pt=h.havingStyle(U.SCRIPTSCRIPT),Ut=zr(p.index,Pt,h),Pr=.6*(ct.height-ct.depth),jr=$e.makeVList({positionType:"shift",positionData:-Pr,children:[{type:"elem",elem:Ut}]},h),_r=$e.makeSpan(["root"],[jr]);return $e.makeSpan(["mord","sqrt"],[_r,ct],h)}else return $e.makeSpan(["mord","sqrt"],[ct],h)},mathmlBuilder(p,h){const{body:f,index:x}=p;return x?new ht.MathNode("mroot",[nn(f,h),nn(x,h)]):new ht.MathNode("msqrt",[nn(f,h)])}});const Wg={display:U.DISPLAY,text:U.TEXT,script:U.SCRIPT,scriptscript:U.SCRIPTSCRIPT};It({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(p,h){let{breakOnTokenText:f,funcName:x,parser:j}=p;const D=j.parseExpression(!0,f),F=x.slice(1,x.length-5);return{type:"styling",mode:j.mode,style:F,body:D}},htmlBuilder(p,h){const f=Wg[p.style],x=h.havingStyle(f).withFont("");return Gg(p.body,x,h)},mathmlBuilder(p,h){const f=Wg[p.style],x=h.havingStyle(f),j=Ss(p.body,x),D=new ht.MathNode("mstyle",j),H={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]}[p.style];return D.setAttribute("scriptlevel",H[0]),D.setAttribute("displaystyle",H[1]),D}});const lw=function(p,h){const f=p.base;return f?f.type==="op"?f.limits&&(h.style.size===U.DISPLAY.size||f.alwaysHandleSupSub)?Ja:null:f.type==="operatorname"?f.alwaysHandleSupSub&&(h.style.size===U.DISPLAY.size||f.limits)?Ug:null:f.type==="accent"?b.isCharacterBox(f.base)?Ph:null:f.type==="horizBrace"&&!p.sub===f.isOver?$g:null:null};Ji({type:"supsub",htmlBuilder(p,h){const f=lw(p,h);if(f)return f(p,h);const{base:x,sup:j,sub:D}=p,F=zr(x,h);let H,re;const we=h.fontMetrics();let Pe=0,Ve=0;const He=x&&b.isCharacterBox(x);if(j){const Wr=h.havingStyle(h.style.sup());H=zr(j,Wr,h),He||(Pe=F.height-Wr.fontMetrics().supDrop*Wr.sizeMultiplier/h.sizeMultiplier)}if(D){const Wr=h.havingStyle(h.style.sub());re=zr(D,Wr,h),He||(Ve=F.depth+Wr.fontMetrics().subDrop*Wr.sizeMultiplier/h.sizeMultiplier)}let ct;h.style===U.DISPLAY?ct=we.sup1:h.style.cramped?ct=we.sup3:ct=we.sup2;const Pt=h.sizeMultiplier,Ut=at(.5/we.ptPerEm/Pt);let Pr=null;if(re){const Wr=p.base&&p.base.type==="op"&&p.base.name&&(p.base.name==="\\oiint"||p.base.name==="\\oiiint");(F instanceof Et||Wr)&&(Pr=at(-F.italic))}let jr;if(H&&re){Pe=Math.max(Pe,ct,H.depth+.25*we.xHeight),Ve=Math.max(Ve,we.sub2);const an=4*we.defaultRuleThickness;if(Pe-H.depth-(re.height-Ve)<an){Ve=an-(Pe-H.depth)+re.height;const $n=.8*we.xHeight-(Pe-H.depth);$n>0&&(Pe+=$n,Ve-=$n)}const is=[{type:"elem",elem:re,shift:Ve,marginRight:Ut,marginLeft:Pr},{type:"elem",elem:H,shift:-Pe,marginRight:Ut}];jr=$e.makeVList({positionType:"individualShift",children:is},h)}else if(re){Ve=Math.max(Ve,we.sub1,re.height-.8*we.xHeight);const Wr=[{type:"elem",elem:re,marginLeft:Pr,marginRight:Ut}];jr=$e.makeVList({positionType:"shift",positionData:Ve,children:Wr},h)}else if(H)Pe=Math.max(Pe,ct,H.depth+.25*we.xHeight),jr=$e.makeVList({positionType:"shift",positionData:-Pe,children:[{type:"elem",elem:H,marginRight:Ut}]},h);else throw new Error("supsub must have either sup or sub.");const _r=Ih(F,"right")||"mord";return $e.makeSpan([_r],[F,$e.makeSpan(["msupsub"],[jr])],h)},mathmlBuilder(p,h){let f=!1,x,j;p.base&&p.base.type==="horizBrace"&&(j=!!p.sup,j===p.base.isOver&&(f=!0,x=p.base.isOver)),p.base&&(p.base.type==="op"||p.base.type==="operatorname")&&(p.base.parentIsSupSub=!0);const D=[nn(p.base,h)];p.sub&&D.push(nn(p.sub,h)),p.sup&&D.push(nn(p.sup,h));let F;if(f)F=x?"mover":"munder";else if(p.sub)if(p.sup){const H=p.base;H&&H.type==="op"&&H.limits&&h.style===U.DISPLAY||H&&H.type==="operatorname"&&H.alwaysHandleSupSub&&(h.style===U.DISPLAY||H.limits)?F="munderover":F="msubsup"}else{const H=p.base;H&&H.type==="op"&&H.limits&&(h.style===U.DISPLAY||H.alwaysHandleSupSub)||H&&H.type==="operatorname"&&H.alwaysHandleSupSub&&(H.limits||h.style===U.DISPLAY)?F="munder":F="msub"}else{const H=p.base;H&&H.type==="op"&&H.limits&&(h.style===U.DISPLAY||H.alwaysHandleSupSub)||H&&H.type==="operatorname"&&H.alwaysHandleSupSub&&(H.limits||h.style===U.DISPLAY)?F="mover":F="msup"}return new ht.MathNode(F,D)}}),Ji({type:"atom",htmlBuilder(p,h){return $e.mathsym(p.text,p.mode,h,["m"+p.family])},mathmlBuilder(p,h){const f=new ht.MathNode("mo",[Bs(p.text,p.mode)]);if(p.family==="bin"){const x=Eh(p,h);x==="bold-italic"&&f.setAttribute("mathvariant",x)}else p.family==="punct"?f.setAttribute("separator","true"):(p.family==="open"||p.family==="close")&&f.setAttribute("stretchy","false");return f}});const qg={mi:"italic",mn:"normal",mtext:"normal"};Ji({type:"mathord",htmlBuilder(p,h){return $e.makeOrd(p,h,"mathord")},mathmlBuilder(p,h){const f=new ht.MathNode("mi",[Bs(p.text,p.mode,h)]),x=Eh(p,h)||"italic";return x!==qg[f.type]&&f.setAttribute("mathvariant",x),f}}),Ji({type:"textord",htmlBuilder(p,h){return $e.makeOrd(p,h,"textord")},mathmlBuilder(p,h){const f=Bs(p.text,p.mode,h),x=Eh(p,h)||"normal";let j;return p.mode==="text"?j=new ht.MathNode("mtext",[f]):/[0-9]/.test(p.text)?j=new ht.MathNode("mn",[f]):p.text==="\\prime"?j=new ht.MathNode("mo",[f]):j=new ht.MathNode("mi",[f]),x!==qg[j.type]&&j.setAttribute("mathvariant",x),j}});const qh={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},Jh={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};Ji({type:"spacing",htmlBuilder(p,h){if(Jh.hasOwnProperty(p.text)){const f=Jh[p.text].className||"";if(p.mode==="text"){const x=$e.makeOrd(p,h,"textord");return x.classes.push(f),x}else return $e.makeSpan(["mspace",f],[$e.mathsym(p.text,p.mode,h)],h)}else{if(qh.hasOwnProperty(p.text))return $e.makeSpan(["mspace",qh[p.text]],[],h);throw new i('Unknown type of space "'+p.text+'"')}},mathmlBuilder(p,h){let f;if(Jh.hasOwnProperty(p.text))f=new ht.MathNode("mtext",[new ht.TextNode("Â ")]);else{if(qh.hasOwnProperty(p.text))return new ht.MathNode("mspace");throw new i('Unknown type of space "'+p.text+'"')}return f}});const Jg=()=>{const p=new ht.MathNode("mtd",[]);return p.setAttribute("width","50%"),p};Ji({type:"tag",mathmlBuilder(p,h){const f=new ht.MathNode("mtable",[new ht.MathNode("mtr",[Jg(),new ht.MathNode("mtd",[ui(p.body,h)]),Jg(),new ht.MathNode("mtd",[ui(p.tag,h)])])]);return f.setAttribute("width","100%"),f}});const Yg={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},Kg={"\\textbf":"textbf","\\textmd":"textmd"},cw={"\\textit":"textit","\\textup":"textup"},Zg=(p,h)=>{const f=p.font;if(f){if(Yg[f])return h.withTextFontFamily(Yg[f]);if(Kg[f])return h.withTextFontWeight(Kg[f]);if(f==="\\emph")return h.fontShape==="textit"?h.withTextFontShape("textup"):h.withTextFontShape("textit")}else return h;return h.withTextFontShape(cw[f])};It({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup","\\emph"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(p,h){let{parser:f,funcName:x}=p;const j=h[0];return{type:"text",mode:f.mode,body:Pn(j),font:x}},htmlBuilder(p,h){const f=Zg(p,h),x=Vn(p.body,f,!0);return $e.makeSpan(["mord","text"],x,f)},mathmlBuilder(p,h){const f=Zg(p,h);return ui(p.body,f)}}),It({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(p,h){let{parser:f}=p;return{type:"underline",mode:f.mode,body:h[0]}},htmlBuilder(p,h){const f=zr(p.body,h),x=$e.makeLineSpan("underline-line",h),j=h.fontMetrics().defaultRuleThickness,D=$e.makeVList({positionType:"top",positionData:f.height,children:[{type:"kern",size:j},{type:"elem",elem:x},{type:"kern",size:3*j},{type:"elem",elem:f}]},h);return $e.makeSpan(["mord","underline"],[D],h)},mathmlBuilder(p,h){const f=new ht.MathNode("mo",[new ht.TextNode("â€¾")]);f.setAttribute("stretchy","true");const x=new ht.MathNode("munder",[nn(p.body,h),f]);return x.setAttribute("accentunder","true"),x}}),It({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(p,h){let{parser:f}=p;return{type:"vcenter",mode:f.mode,body:h[0]}},htmlBuilder(p,h){const f=zr(p.body,h),x=h.fontMetrics().axisHeight,j=.5*(f.height-x-(f.depth+x));return $e.makeVList({positionType:"shift",positionData:j,children:[{type:"elem",elem:f}]},h)},mathmlBuilder(p,h){return new ht.MathNode("mpadded",[nn(p.body,h)],["vcenter"])}}),It({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(p,h,f){throw new i("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(p,h){const f=Xg(p),x=[],j=h.havingStyle(h.style.text());for(let D=0;D<f.length;D++){let F=f[D];F==="~"&&(F="\\textasciitilde"),x.push($e.makeSymbol(F,"Typewriter-Regular",p.mode,j,["mord","texttt"]))}return $e.makeSpan(["mord","text"].concat(j.sizingClasses(h)),$e.tryCombineChars(x),j)},mathmlBuilder(p,h){const f=new ht.TextNode(Xg(p)),x=new ht.MathNode("mtext",[f]);return x.setAttribute("mathvariant","monospace"),x}});const Xg=p=>p.body.replace(/ /g,p.star?"â£":"Â ");var mi=ng;const Qg=`[ \r
	]`,dw="\\\\[a-zA-Z@]+",uw="\\\\[^\uD800-\uDFFF]",hw="("+dw+")"+Qg+"*",mw=`\\\\(
|[ \r	]+
?)[ \r	]*`,Yh="[Ì€-Í¯]",pw=new RegExp(Yh+"+$"),fw="("+Qg+"+)|"+(mw+"|")+"([!-\\[\\]-â€§â€ª-íŸ¿ï¤€-ï¿¿]"+(Yh+"*")+"|[\uD800-\uDBFF][\uDC00-\uDFFF]"+(Yh+"*")+"|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5"+("|"+hw)+("|"+uw+")");class ey{constructor(h,f){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=h,this.settings=f,this.tokenRegex=new RegExp(fw,"g"),this.catcodes={"%":14,"~":13}}setCatcode(h,f){this.catcodes[h]=f}lex(){const h=this.input,f=this.tokenRegex.lastIndex;if(f===h.length)return new Us("EOF",new Ds(this,f,f));const x=this.tokenRegex.exec(h);if(x===null||x.index!==f)throw new i("Unexpected character: '"+h[f]+"'",new Us(h[f],new Ds(this,f,f+1)));const j=x[6]||x[3]||(x[2]?"\\ ":" ");if(this.catcodes[j]===14){const D=h.indexOf(`
`,this.tokenRegex.lastIndex);return D===-1?(this.tokenRegex.lastIndex=h.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=D+1,this.lex()}return new Us(j,new Ds(this,f,this.tokenRegex.lastIndex))}}class gw{constructor(h,f){h===void 0&&(h={}),f===void 0&&(f={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=f,this.builtins=h,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(this.undefStack.length===0)throw new i("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");const h=this.undefStack.pop();for(const f in h)h.hasOwnProperty(f)&&(h[f]==null?delete this.current[f]:this.current[f]=h[f])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(h){return this.current.hasOwnProperty(h)||this.builtins.hasOwnProperty(h)}get(h){return this.current.hasOwnProperty(h)?this.current[h]:this.builtins[h]}set(h,f,x){if(x===void 0&&(x=!1),x){for(let j=0;j<this.undefStack.length;j++)delete this.undefStack[j][h];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][h]=f)}else{const j=this.undefStack[this.undefStack.length-1];j&&!j.hasOwnProperty(h)&&(j[h]=this.current[h])}f==null?delete this.current[h]:this.current[h]=f}}var yw=Mg;J("\\noexpand",function(p){const h=p.popToken();return p.isExpandable(h.text)&&(h.noexpand=!0,h.treatAsRelax=!0),{tokens:[h],numArgs:0}}),J("\\expandafter",function(p){const h=p.popToken();return p.expandOnce(!0),{tokens:[h],numArgs:0}}),J("\\@firstoftwo",function(p){return{tokens:p.consumeArgs(2)[0],numArgs:0}}),J("\\@secondoftwo",function(p){return{tokens:p.consumeArgs(2)[1],numArgs:0}}),J("\\@ifnextchar",function(p){const h=p.consumeArgs(3);p.consumeSpaces();const f=p.future();return h[0].length===1&&h[0][0].text===f.text?{tokens:h[1],numArgs:0}:{tokens:h[2],numArgs:0}}),J("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}"),J("\\TextOrMath",function(p){const h=p.consumeArgs(2);return p.mode==="text"?{tokens:h[0],numArgs:0}:{tokens:h[1],numArgs:0}});const ty={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};J("\\char",function(p){let h=p.popToken(),f,x="";if(h.text==="'")f=8,h=p.popToken();else if(h.text==='"')f=16,h=p.popToken();else if(h.text==="`")if(h=p.popToken(),h.text[0]==="\\")x=h.text.charCodeAt(1);else{if(h.text==="EOF")throw new i("\\char` missing argument");x=h.text.charCodeAt(0)}else f=10;if(f){if(x=ty[h.text],x==null||x>=f)throw new i("Invalid base-"+f+" digit "+h.text);let j;for(;(j=ty[p.future().text])!=null&&j<f;)x*=f,x+=j,p.popToken()}return"\\@char{"+x+"}"});const Kh=(p,h,f,x)=>{let j=p.consumeArg().tokens;if(j.length!==1)throw new i("\\newcommand's first argument must be a macro name");const D=j[0].text,F=p.isDefined(D);if(F&&!h)throw new i("\\newcommand{"+D+"} attempting to redefine "+(D+"; use \\renewcommand"));if(!F&&!f)throw new i("\\renewcommand{"+D+"} when command "+D+" does not yet exist; use \\newcommand");let H=0;if(j=p.consumeArg().tokens,j.length===1&&j[0].text==="["){let re="",we=p.expandNextToken();for(;we.text!=="]"&&we.text!=="EOF";)re+=we.text,we=p.expandNextToken();if(!re.match(/^\s*[0-9]+\s*$/))throw new i("Invalid number of arguments: "+re);H=parseInt(re),j=p.consumeArg().tokens}return F&&x||p.macros.set(D,{tokens:j,numArgs:H}),""};J("\\newcommand",p=>Kh(p,!1,!0,!1)),J("\\renewcommand",p=>Kh(p,!0,!1,!1)),J("\\providecommand",p=>Kh(p,!0,!0,!0)),J("\\message",p=>{const h=p.consumeArgs(1)[0];return console.log(h.reverse().map(f=>f.text).join("")),""}),J("\\errmessage",p=>{const h=p.consumeArgs(1)[0];return console.error(h.reverse().map(f=>f.text).join("")),""}),J("\\show",p=>{const h=p.popToken(),f=h.text;return console.log(h,p.macros.get(f),mi[f],Be.math[f],Be.text[f]),""}),J("\\bgroup","{"),J("\\egroup","}"),J("~","\\nobreakspace"),J("\\lq","`"),J("\\rq","'"),J("\\aa","\\r a"),J("\\AA","\\r A"),J("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`Â©}"),J("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}"),J("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`Â®}"),J("â„¬","\\mathscr{B}"),J("â„°","\\mathscr{E}"),J("â„±","\\mathscr{F}"),J("â„‹","\\mathscr{H}"),J("â„","\\mathscr{I}"),J("â„’","\\mathscr{L}"),J("â„³","\\mathscr{M}"),J("â„›","\\mathscr{R}"),J("â„­","\\mathfrak{C}"),J("â„Œ","\\mathfrak{H}"),J("â„¨","\\mathfrak{Z}"),J("\\Bbbk","\\Bbb{k}"),J("Â·","\\cdotp"),J("\\llap","\\mathllap{\\textrm{#1}}"),J("\\rlap","\\mathrlap{\\textrm{#1}}"),J("\\clap","\\mathclap{\\textrm{#1}}"),J("\\mathstrut","\\vphantom{(}"),J("\\underbar","\\underline{\\text{#1}}"),J("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}'),J("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`â‰ }}"),J("\\ne","\\neq"),J("â‰ ","\\neq"),J("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`âˆ‰}}"),J("âˆ‰","\\notin"),J("â‰˜","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`â‰˜}}"),J("â‰™","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`â‰˜}}"),J("â‰š","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`â‰š}}"),J("â‰›","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`â‰›}}"),J("â‰","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`â‰}}"),J("â‰ž","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`â‰ž}}"),J("â‰Ÿ","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`â‰Ÿ}}"),J("âŸ‚","\\perp"),J("â€¼","\\mathclose{!\\mkern-0.8mu!}"),J("âˆŒ","\\notni"),J("âŒœ","\\ulcorner"),J("âŒ","\\urcorner"),J("âŒž","\\llcorner"),J("âŒŸ","\\lrcorner"),J("Â©","\\copyright"),J("Â®","\\textregistered"),J("ï¸","\\textregistered"),J("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}'),J("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}'),J("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}'),J("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}'),J("\\vdots","{\\varvdots\\rule{0pt}{15pt}}"),J("â‹®","\\vdots"),J("\\varGamma","\\mathit{\\Gamma}"),J("\\varDelta","\\mathit{\\Delta}"),J("\\varTheta","\\mathit{\\Theta}"),J("\\varLambda","\\mathit{\\Lambda}"),J("\\varXi","\\mathit{\\Xi}"),J("\\varPi","\\mathit{\\Pi}"),J("\\varSigma","\\mathit{\\Sigma}"),J("\\varUpsilon","\\mathit{\\Upsilon}"),J("\\varPhi","\\mathit{\\Phi}"),J("\\varPsi","\\mathit{\\Psi}"),J("\\varOmega","\\mathit{\\Omega}"),J("\\substack","\\begin{subarray}{c}#1\\end{subarray}"),J("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax"),J("\\boxed","\\fbox{$\\displaystyle{#1}$}"),J("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;"),J("\\implies","\\DOTSB\\;\\Longrightarrow\\;"),J("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;"),J("\\dddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ...}}{#1}}"),J("\\ddddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ....}}{#1}}");const ry={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};J("\\dots",function(p){let h="\\dotso";const f=p.expandAfterFuture().text;return f in ry?h=ry[f]:(f.slice(0,4)==="\\not"||f in Be.math&&b.contains(["bin","rel"],Be.math[f].group))&&(h="\\dotsb"),h});const Zh={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};J("\\dotso",function(p){return p.future().text in Zh?"\\ldots\\,":"\\ldots"}),J("\\dotsc",function(p){const h=p.future().text;return h in Zh&&h!==","?"\\ldots\\,":"\\ldots"}),J("\\cdots",function(p){return p.future().text in Zh?"\\@cdots\\,":"\\@cdots"}),J("\\dotsb","\\cdots"),J("\\dotsm","\\cdots"),J("\\dotsi","\\!\\cdots"),J("\\dotsx","\\ldots\\,"),J("\\DOTSI","\\relax"),J("\\DOTSB","\\relax"),J("\\DOTSX","\\relax"),J("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax"),J("\\,","\\tmspace+{3mu}{.1667em}"),J("\\thinspace","\\,"),J("\\>","\\mskip{4mu}"),J("\\:","\\tmspace+{4mu}{.2222em}"),J("\\medspace","\\:"),J("\\;","\\tmspace+{5mu}{.2777em}"),J("\\thickspace","\\;"),J("\\!","\\tmspace-{3mu}{.1667em}"),J("\\negthinspace","\\!"),J("\\negmedspace","\\tmspace-{4mu}{.2222em}"),J("\\negthickspace","\\tmspace-{5mu}{.277em}"),J("\\enspace","\\kern.5em "),J("\\enskip","\\hskip.5em\\relax"),J("\\quad","\\hskip1em\\relax"),J("\\qquad","\\hskip2em\\relax"),J("\\tag","\\@ifstar\\tag@literal\\tag@paren"),J("\\tag@paren","\\tag@literal{({#1})}"),J("\\tag@literal",p=>{if(p.macros.get("\\df@tag"))throw new i("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"}),J("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}"),J("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)"),J("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}"),J("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1"),J("\\newline","\\\\\\relax"),J("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");const ny=at(Te["Main-Regular"][84][1]-.7*Te["Main-Regular"][65][1]);J("\\LaTeX","\\textrm{\\html@mathml{"+("L\\kern-.36em\\raisebox{"+ny+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{LaTeX}}"),J("\\KaTeX","\\textrm{\\html@mathml{"+("K\\kern-.17em\\raisebox{"+ny+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{KaTeX}}"),J("\\hspace","\\@ifstar\\@hspacer\\@hspace"),J("\\@hspace","\\hskip #1\\relax"),J("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax"),J("\\ordinarycolon",":"),J("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}"),J("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}'),J("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}'),J("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}'),J("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}'),J("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}'),J("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}'),J("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}'),J("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}'),J("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}'),J("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}'),J("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}'),J("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}'),J("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}'),J("âˆ·","\\dblcolon"),J("âˆ¹","\\eqcolon"),J("â‰”","\\coloneqq"),J("â‰•","\\eqqcolon"),J("â©´","\\Coloneqq"),J("\\ratio","\\vcentcolon"),J("\\coloncolon","\\dblcolon"),J("\\colonequals","\\coloneqq"),J("\\coloncolonequals","\\Coloneqq"),J("\\equalscolon","\\eqqcolon"),J("\\equalscoloncolon","\\Eqqcolon"),J("\\colonminus","\\coloneq"),J("\\coloncolonminus","\\Coloneq"),J("\\minuscolon","\\eqcolon"),J("\\minuscoloncolon","\\Eqcolon"),J("\\coloncolonapprox","\\Colonapprox"),J("\\coloncolonsim","\\Colonsim"),J("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}"),J("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}"),J("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}"),J("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}"),J("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`âˆŒ}}"),J("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}"),J("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}"),J("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}"),J("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}"),J("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}"),J("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}"),J("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}"),J("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}"),J("\\gvertneqq","\\html@mathml{\\@gvertneqq}{â‰©}"),J("\\lvertneqq","\\html@mathml{\\@lvertneqq}{â‰¨}"),J("\\ngeqq","\\html@mathml{\\@ngeqq}{â‰±}"),J("\\ngeqslant","\\html@mathml{\\@ngeqslant}{â‰±}"),J("\\nleqq","\\html@mathml{\\@nleqq}{â‰°}"),J("\\nleqslant","\\html@mathml{\\@nleqslant}{â‰°}"),J("\\nshortmid","\\html@mathml{\\@nshortmid}{âˆ¤}"),J("\\nshortparallel","\\html@mathml{\\@nshortparallel}{âˆ¦}"),J("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{âŠˆ}"),J("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{âŠ‰}"),J("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{âŠŠ}"),J("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{â«‹}"),J("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{âŠ‹}"),J("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{â«Œ}"),J("\\imath","\\html@mathml{\\@imath}{Ä±}"),J("\\jmath","\\html@mathml{\\@jmath}{È·}"),J("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`âŸ¦}}"),J("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`âŸ§}}"),J("âŸ¦","\\llbracket"),J("âŸ§","\\rrbracket"),J("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`â¦ƒ}}"),J("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`â¦„}}"),J("â¦ƒ","\\lBrace"),J("â¦„","\\rBrace"),J("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`â¦µ}}"),J("â¦µ","\\minuso"),J("\\darr","\\downarrow"),J("\\dArr","\\Downarrow"),J("\\Darr","\\Downarrow"),J("\\lang","\\langle"),J("\\rang","\\rangle"),J("\\uarr","\\uparrow"),J("\\uArr","\\Uparrow"),J("\\Uarr","\\Uparrow"),J("\\N","\\mathbb{N}"),J("\\R","\\mathbb{R}"),J("\\Z","\\mathbb{Z}"),J("\\alef","\\aleph"),J("\\alefsym","\\aleph"),J("\\Alpha","\\mathrm{A}"),J("\\Beta","\\mathrm{B}"),J("\\bull","\\bullet"),J("\\Chi","\\mathrm{X}"),J("\\clubs","\\clubsuit"),J("\\cnums","\\mathbb{C}"),J("\\Complex","\\mathbb{C}"),J("\\Dagger","\\ddagger"),J("\\diamonds","\\diamondsuit"),J("\\empty","\\emptyset"),J("\\Epsilon","\\mathrm{E}"),J("\\Eta","\\mathrm{H}"),J("\\exist","\\exists"),J("\\harr","\\leftrightarrow"),J("\\hArr","\\Leftrightarrow"),J("\\Harr","\\Leftrightarrow"),J("\\hearts","\\heartsuit"),J("\\image","\\Im"),J("\\infin","\\infty"),J("\\Iota","\\mathrm{I}"),J("\\isin","\\in"),J("\\Kappa","\\mathrm{K}"),J("\\larr","\\leftarrow"),J("\\lArr","\\Leftarrow"),J("\\Larr","\\Leftarrow"),J("\\lrarr","\\leftrightarrow"),J("\\lrArr","\\Leftrightarrow"),J("\\Lrarr","\\Leftrightarrow"),J("\\Mu","\\mathrm{M}"),J("\\natnums","\\mathbb{N}"),J("\\Nu","\\mathrm{N}"),J("\\Omicron","\\mathrm{O}"),J("\\plusmn","\\pm"),J("\\rarr","\\rightarrow"),J("\\rArr","\\Rightarrow"),J("\\Rarr","\\Rightarrow"),J("\\real","\\Re"),J("\\reals","\\mathbb{R}"),J("\\Reals","\\mathbb{R}"),J("\\Rho","\\mathrm{P}"),J("\\sdot","\\cdot"),J("\\sect","\\S"),J("\\spades","\\spadesuit"),J("\\sub","\\subset"),J("\\sube","\\subseteq"),J("\\supe","\\supseteq"),J("\\Tau","\\mathrm{T}"),J("\\thetasym","\\vartheta"),J("\\weierp","\\wp"),J("\\Zeta","\\mathrm{Z}"),J("\\argmin","\\DOTSB\\operatorname*{arg\\,min}"),J("\\argmax","\\DOTSB\\operatorname*{arg\\,max}"),J("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits"),J("\\bra","\\mathinner{\\langle{#1}|}"),J("\\ket","\\mathinner{|{#1}\\rangle}"),J("\\braket","\\mathinner{\\langle{#1}\\rangle}"),J("\\Bra","\\left\\langle#1\\right|"),J("\\Ket","\\left|#1\\right\\rangle");const sy=p=>h=>{const f=h.consumeArg().tokens,x=h.consumeArg().tokens,j=h.consumeArg().tokens,D=h.consumeArg().tokens,F=h.macros.get("|"),H=h.macros.get("\\|");h.macros.beginGroup();const re=Ve=>He=>{p&&(He.macros.set("|",F),j.length&&He.macros.set("\\|",H));let ct=Ve;return!Ve&&j.length&&He.future().text==="|"&&(He.popToken(),ct=!0),{tokens:ct?j:x,numArgs:0}};h.macros.set("|",re(!1)),j.length&&h.macros.set("\\|",re(!0));const we=h.consumeArg().tokens,Pe=h.expandTokens([...D,...we,...f]);return h.macros.endGroup(),{tokens:Pe.reverse(),numArgs:0}};J("\\bra@ket",sy(!1)),J("\\bra@set",sy(!0)),J("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}"),J("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}"),J("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}"),J("\\angln","{\\angl n}"),J("\\blue","\\textcolor{##6495ed}{#1}"),J("\\orange","\\textcolor{##ffa500}{#1}"),J("\\pink","\\textcolor{##ff00af}{#1}"),J("\\red","\\textcolor{##df0030}{#1}"),J("\\green","\\textcolor{##28ae7b}{#1}"),J("\\gray","\\textcolor{gray}{#1}"),J("\\purple","\\textcolor{##9d38bd}{#1}"),J("\\blueA","\\textcolor{##ccfaff}{#1}"),J("\\blueB","\\textcolor{##80f6ff}{#1}"),J("\\blueC","\\textcolor{##63d9ea}{#1}"),J("\\blueD","\\textcolor{##11accd}{#1}"),J("\\blueE","\\textcolor{##0c7f99}{#1}"),J("\\tealA","\\textcolor{##94fff5}{#1}"),J("\\tealB","\\textcolor{##26edd5}{#1}"),J("\\tealC","\\textcolor{##01d1c1}{#1}"),J("\\tealD","\\textcolor{##01a995}{#1}"),J("\\tealE","\\textcolor{##208170}{#1}"),J("\\greenA","\\textcolor{##b6ffb0}{#1}"),J("\\greenB","\\textcolor{##8af281}{#1}"),J("\\greenC","\\textcolor{##74cf70}{#1}"),J("\\greenD","\\textcolor{##1fab54}{#1}"),J("\\greenE","\\textcolor{##0d923f}{#1}"),J("\\goldA","\\textcolor{##ffd0a9}{#1}"),J("\\goldB","\\textcolor{##ffbb71}{#1}"),J("\\goldC","\\textcolor{##ff9c39}{#1}"),J("\\goldD","\\textcolor{##e07d10}{#1}"),J("\\goldE","\\textcolor{##a75a05}{#1}"),J("\\redA","\\textcolor{##fca9a9}{#1}"),J("\\redB","\\textcolor{##ff8482}{#1}"),J("\\redC","\\textcolor{##f9685d}{#1}"),J("\\redD","\\textcolor{##e84d39}{#1}"),J("\\redE","\\textcolor{##bc2612}{#1}"),J("\\maroonA","\\textcolor{##ffbde0}{#1}"),J("\\maroonB","\\textcolor{##ff92c6}{#1}"),J("\\maroonC","\\textcolor{##ed5fa6}{#1}"),J("\\maroonD","\\textcolor{##ca337c}{#1}"),J("\\maroonE","\\textcolor{##9e034e}{#1}"),J("\\purpleA","\\textcolor{##ddd7ff}{#1}"),J("\\purpleB","\\textcolor{##c6b9fc}{#1}"),J("\\purpleC","\\textcolor{##aa87ff}{#1}"),J("\\purpleD","\\textcolor{##7854ab}{#1}"),J("\\purpleE","\\textcolor{##543b78}{#1}"),J("\\mintA","\\textcolor{##f5f9e8}{#1}"),J("\\mintB","\\textcolor{##edf2df}{#1}"),J("\\mintC","\\textcolor{##e0e5cc}{#1}"),J("\\grayA","\\textcolor{##f6f7f7}{#1}"),J("\\grayB","\\textcolor{##f0f1f2}{#1}"),J("\\grayC","\\textcolor{##e3e5e6}{#1}"),J("\\grayD","\\textcolor{##d6d8da}{#1}"),J("\\grayE","\\textcolor{##babec2}{#1}"),J("\\grayF","\\textcolor{##888d93}{#1}"),J("\\grayG","\\textcolor{##626569}{#1}"),J("\\grayH","\\textcolor{##3b3e40}{#1}"),J("\\grayI","\\textcolor{##21242c}{#1}"),J("\\kaBlue","\\textcolor{##314453}{#1}"),J("\\kaGreen","\\textcolor{##71B307}{#1}");const oy={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class xw{constructor(h,f,x){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=f,this.expansionCount=0,this.feed(h),this.macros=new gw(yw,f.macros),this.mode=x,this.stack=[]}feed(h){this.lexer=new ey(h,this.settings)}switchMode(h){this.mode=h}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return this.stack.length===0&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(h){this.stack.push(h)}pushTokens(h){this.stack.push(...h)}scanArgument(h){let f,x,j;if(h){if(this.consumeSpaces(),this.future().text!=="[")return null;f=this.popToken(),{tokens:j,end:x}=this.consumeArg(["]"])}else({tokens:j,start:f,end:x}=this.consumeArg());return this.pushToken(new Us("EOF",x.loc)),this.pushTokens(j),f.range(x,"")}consumeSpaces(){for(;this.future().text===" ";)this.stack.pop()}consumeArg(h){const f=[],x=h&&h.length>0;x||this.consumeSpaces();const j=this.future();let D,F=0,H=0;do{if(D=this.popToken(),f.push(D),D.text==="{")++F;else if(D.text==="}"){if(--F,F===-1)throw new i("Extra }",D)}else if(D.text==="EOF")throw new i("Unexpected end of input in a macro argument, expected '"+(h&&x?h[H]:"}")+"'",D);if(h&&x)if((F===0||F===1&&h[H]==="{")&&D.text===h[H]){if(++H,H===h.length){f.splice(-H,H);break}}else H=0}while(F!==0||x);return j.text==="{"&&f[f.length-1].text==="}"&&(f.pop(),f.shift()),f.reverse(),{tokens:f,start:j,end:D}}consumeArgs(h,f){if(f){if(f.length!==h+1)throw new i("The length of delimiters doesn't match the number of args!");const j=f[0];for(let D=0;D<j.length;D++){const F=this.popToken();if(j[D]!==F.text)throw new i("Use of the macro doesn't match its definition",F)}}const x=[];for(let j=0;j<h;j++)x.push(this.consumeArg(f&&f[j+1]).tokens);return x}countExpansion(h){if(this.expansionCount+=h,this.expansionCount>this.settings.maxExpand)throw new i("Too many expansions: infinite loop or need to increase maxExpand setting")}expandOnce(h){const f=this.popToken(),x=f.text,j=f.noexpand?null:this._getExpansion(x);if(j==null||h&&j.unexpandable){if(h&&j==null&&x[0]==="\\"&&!this.isDefined(x))throw new i("Undefined control sequence: "+x);return this.pushToken(f),!1}this.countExpansion(1);let D=j.tokens;const F=this.consumeArgs(j.numArgs,j.delimiters);if(j.numArgs){D=D.slice();for(let H=D.length-1;H>=0;--H){let re=D[H];if(re.text==="#"){if(H===0)throw new i("Incomplete placeholder at end of macro body",re);if(re=D[--H],re.text==="#")D.splice(H+1,1);else if(/^[1-9]$/.test(re.text))D.splice(H,2,...F[+re.text-1]);else throw new i("Not a valid argument number",re)}}}return this.pushTokens(D),D.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(this.expandOnce()===!1){const h=this.stack.pop();return h.treatAsRelax&&(h.text="\\relax"),h}throw new Error}expandMacro(h){return this.macros.has(h)?this.expandTokens([new Us(h)]):void 0}expandTokens(h){const f=[],x=this.stack.length;for(this.pushTokens(h);this.stack.length>x;)if(this.expandOnce(!0)===!1){const j=this.stack.pop();j.treatAsRelax&&(j.noexpand=!1,j.treatAsRelax=!1),f.push(j)}return this.countExpansion(f.length),f}expandMacroAsText(h){const f=this.expandMacro(h);return f&&f.map(x=>x.text).join("")}_getExpansion(h){const f=this.macros.get(h);if(f==null)return f;if(h.length===1){const j=this.lexer.catcodes[h];if(j!=null&&j!==13)return}const x=typeof f=="function"?f(this):f;if(typeof x=="string"){let j=0;if(x.indexOf("#")!==-1){const we=x.replace(/##/g,"");for(;we.indexOf("#"+(j+1))!==-1;)++j}const D=new ey(x,this.settings),F=[];let H=D.lex();for(;H.text!=="EOF";)F.push(H),H=D.lex();return F.reverse(),{tokens:F,numArgs:j}}return x}isDefined(h){return this.macros.has(h)||mi.hasOwnProperty(h)||Be.math.hasOwnProperty(h)||Be.text.hasOwnProperty(h)||oy.hasOwnProperty(h)}isExpandable(h){const f=this.macros.get(h);return f!=null?typeof f=="string"||typeof f=="function"||!f.unexpandable:mi.hasOwnProperty(h)&&!mi[h].primitive}}const iy=/^[â‚Šâ‚‹â‚Œâ‚â‚Žâ‚€â‚â‚‚â‚ƒâ‚„â‚…â‚†â‚‡â‚ˆâ‚‰â‚â‚‘â‚•áµ¢â±¼â‚–â‚—â‚˜â‚™â‚’â‚šáµ£â‚›â‚œáµ¤áµ¥â‚“áµ¦áµ§áµ¨áµ©áµª]/,cd=Object.freeze({"â‚Š":"+","â‚‹":"-","â‚Œ":"=","â‚":"(","â‚Ž":")","â‚€":"0","â‚":"1","â‚‚":"2","â‚ƒ":"3","â‚„":"4","â‚…":"5","â‚†":"6","â‚‡":"7","â‚ˆ":"8","â‚‰":"9","â‚":"a","â‚‘":"e","â‚•":"h","áµ¢":"i","â±¼":"j","â‚–":"k","â‚—":"l","â‚˜":"m","â‚™":"n","â‚’":"o","â‚š":"p","áµ£":"r","â‚›":"s","â‚œ":"t","áµ¤":"u","áµ¥":"v","â‚“":"x","áµ¦":"Î²","áµ§":"Î³","áµ¨":"Ï","áµ©":"Ï•","áµª":"Ï‡","âº":"+","â»":"-","â¼":"=","â½":"(","â¾":")","â°":"0","Â¹":"1","Â²":"2","Â³":"3","â´":"4","âµ":"5","â¶":"6","â·":"7","â¸":"8","â¹":"9","á´¬":"A","á´®":"B","á´°":"D","á´±":"E","á´³":"G","á´´":"H","á´µ":"I","á´¶":"J","á´·":"K","á´¸":"L","á´¹":"M","á´º":"N","á´¼":"O","á´¾":"P","á´¿":"R","áµ€":"T","áµ":"U","â±½":"V","áµ‚":"W","áµƒ":"a","áµ‡":"b","á¶œ":"c","áµˆ":"d","áµ‰":"e","á¶ ":"f","áµ":"g",Ê°:"h","â±":"i",Ê²:"j","áµ":"k",Ë¡:"l","áµ":"m",â¿:"n","áµ’":"o","áµ–":"p",Ê³:"r",Ë¢:"s","áµ—":"t","áµ˜":"u","áµ›":"v",Ê·:"w",Ë£:"x",Ê¸:"y","á¶»":"z","áµ":"Î²","áµž":"Î³","áµŸ":"Î´","áµ ":"Ï•","áµ¡":"Ï‡","á¶¿":"Î¸"}),Xh={"Ì":{text:"\\'",math:"\\acute"},"Ì€":{text:"\\`",math:"\\grave"},"Ìˆ":{text:'\\"',math:"\\ddot"},"Ìƒ":{text:"\\~",math:"\\tilde"},"Ì„":{text:"\\=",math:"\\bar"},"Ì†":{text:"\\u",math:"\\breve"},"ÌŒ":{text:"\\v",math:"\\check"},"Ì‚":{text:"\\^",math:"\\hat"},"Ì‡":{text:"\\.",math:"\\dot"},"ÌŠ":{text:"\\r",math:"\\mathring"},"Ì‹":{text:"\\H"},"Ì§":{text:"\\c"}},ay={Ã¡:"aÌ",Ã :"aÌ€",Ã¤:"aÌˆ",ÇŸ:"aÌˆÌ„",Ã£:"aÌƒ",Ä:"aÌ„",Äƒ:"aÌ†",áº¯:"aÌ†Ì",áº±:"aÌ†Ì€",áºµ:"aÌ†Ìƒ",ÇŽ:"aÌŒ",Ã¢:"aÌ‚",áº¥:"aÌ‚Ì",áº§:"aÌ‚Ì€",áº«:"aÌ‚Ìƒ",È§:"aÌ‡",Ç¡:"aÌ‡Ì„",Ã¥:"aÌŠ",Ç»:"aÌŠÌ",á¸ƒ:"bÌ‡",Ä‡:"cÌ",á¸‰:"cÌ§Ì",Ä:"cÌŒ",Ä‰:"cÌ‚",Ä‹:"cÌ‡",Ã§:"cÌ§",Ä:"dÌŒ",á¸‹:"dÌ‡",á¸‘:"dÌ§",Ã©:"eÌ",Ã¨:"eÌ€",Ã«:"eÌˆ",áº½:"eÌƒ",Ä“:"eÌ„",á¸—:"eÌ„Ì",á¸•:"eÌ„Ì€",Ä•:"eÌ†",á¸:"eÌ§Ì†",Ä›:"eÌŒ",Ãª:"eÌ‚",áº¿:"eÌ‚Ì",á»:"eÌ‚Ì€",á»…:"eÌ‚Ìƒ",Ä—:"eÌ‡",È©:"eÌ§",á¸Ÿ:"fÌ‡",Çµ:"gÌ",á¸¡:"gÌ„",ÄŸ:"gÌ†",Ç§:"gÌŒ",Ä:"gÌ‚",Ä¡:"gÌ‡",Ä£:"gÌ§",á¸§:"hÌˆ",ÈŸ:"hÌŒ",Ä¥:"hÌ‚",á¸£:"hÌ‡",á¸©:"hÌ§",Ã­:"iÌ",Ã¬:"iÌ€",Ã¯:"iÌˆ",á¸¯:"iÌˆÌ",Ä©:"iÌƒ",Ä«:"iÌ„",Ä­:"iÌ†",Ç:"iÌŒ",Ã®:"iÌ‚",Ç°:"jÌŒ",Äµ:"jÌ‚",á¸±:"kÌ",Ç©:"kÌŒ",Ä·:"kÌ§",Äº:"lÌ",Ä¾:"lÌŒ",Ä¼:"lÌ§",á¸¿:"mÌ",á¹:"mÌ‡",Å„:"nÌ",Ç¹:"nÌ€",Ã±:"nÌƒ",Åˆ:"nÌŒ",á¹…:"nÌ‡",Å†:"nÌ§",Ã³:"oÌ",Ã²:"oÌ€",Ã¶:"oÌˆ",È«:"oÌˆÌ„",Ãµ:"oÌƒ",á¹:"oÌƒÌ",á¹:"oÌƒÌˆ",È­:"oÌƒÌ„",Å:"oÌ„",á¹“:"oÌ„Ì",á¹‘:"oÌ„Ì€",Å:"oÌ†",Ç’:"oÌŒ",Ã´:"oÌ‚",á»‘:"oÌ‚Ì",á»“:"oÌ‚Ì€",á»—:"oÌ‚Ìƒ",È¯:"oÌ‡",È±:"oÌ‡Ì„",Å‘:"oÌ‹",á¹•:"pÌ",á¹—:"pÌ‡",Å•:"rÌ",Å™:"rÌŒ",á¹™:"rÌ‡",Å—:"rÌ§",Å›:"sÌ",á¹¥:"sÌÌ‡",Å¡:"sÌŒ",á¹§:"sÌŒÌ‡",Å:"sÌ‚",á¹¡:"sÌ‡",ÅŸ:"sÌ§",áº—:"tÌˆ",Å¥:"tÌŒ",á¹«:"tÌ‡",Å£:"tÌ§",Ãº:"uÌ",Ã¹:"uÌ€",Ã¼:"uÌˆ",Ç˜:"uÌˆÌ",Çœ:"uÌˆÌ€",Ç–:"uÌˆÌ„",Çš:"uÌˆÌŒ",Å©:"uÌƒ",á¹¹:"uÌƒÌ",Å«:"uÌ„",á¹»:"uÌ„Ìˆ",Å­:"uÌ†",Ç”:"uÌŒ",Ã»:"uÌ‚",Å¯:"uÌŠ",Å±:"uÌ‹",á¹½:"vÌƒ",áºƒ:"wÌ",áº:"wÌ€",áº…:"wÌˆ",Åµ:"wÌ‚",áº‡:"wÌ‡",áº˜:"wÌŠ",áº:"xÌˆ",áº‹:"xÌ‡",Ã½:"yÌ",á»³:"yÌ€",Ã¿:"yÌˆ",á»¹:"yÌƒ",È³:"yÌ„",Å·:"yÌ‚",áº:"yÌ‡",áº™:"yÌŠ",Åº:"zÌ",Å¾:"zÌŒ",áº‘:"zÌ‚",Å¼:"zÌ‡",Ã:"AÌ",Ã€:"AÌ€",Ã„:"AÌˆ",Çž:"AÌˆÌ„",Ãƒ:"AÌƒ",Ä€:"AÌ„",Ä‚:"AÌ†",áº®:"AÌ†Ì",áº°:"AÌ†Ì€",áº´:"AÌ†Ìƒ",Ç:"AÌŒ",Ã‚:"AÌ‚",áº¤:"AÌ‚Ì",áº¦:"AÌ‚Ì€",áºª:"AÌ‚Ìƒ",È¦:"AÌ‡",Ç :"AÌ‡Ì„",Ã…:"AÌŠ",Çº:"AÌŠÌ",á¸‚:"BÌ‡",Ä†:"CÌ",á¸ˆ:"CÌ§Ì",ÄŒ:"CÌŒ",Äˆ:"CÌ‚",ÄŠ:"CÌ‡",Ã‡:"CÌ§",ÄŽ:"DÌŒ",á¸Š:"DÌ‡",á¸:"DÌ§",Ã‰:"EÌ",Ãˆ:"EÌ€",Ã‹:"EÌˆ",áº¼:"EÌƒ",Ä’:"EÌ„",á¸–:"EÌ„Ì",á¸”:"EÌ„Ì€",Ä”:"EÌ†",á¸œ:"EÌ§Ì†",Äš:"EÌŒ",ÃŠ:"EÌ‚",áº¾:"EÌ‚Ì",á»€:"EÌ‚Ì€",á»„:"EÌ‚Ìƒ",Ä–:"EÌ‡",È¨:"EÌ§",á¸ž:"FÌ‡",Ç´:"GÌ",á¸ :"GÌ„",Äž:"GÌ†",Ç¦:"GÌŒ",Äœ:"GÌ‚",Ä :"GÌ‡",Ä¢:"GÌ§",á¸¦:"HÌˆ",Èž:"HÌŒ",Ä¤:"HÌ‚",á¸¢:"HÌ‡",á¸¨:"HÌ§",Ã:"IÌ",ÃŒ:"IÌ€",Ã:"IÌˆ",á¸®:"IÌˆÌ",Ä¨:"IÌƒ",Äª:"IÌ„",Ä¬:"IÌ†",Ç:"IÌŒ",ÃŽ:"IÌ‚",Ä°:"IÌ‡",Ä´:"JÌ‚",á¸°:"KÌ",Ç¨:"KÌŒ",Ä¶:"KÌ§",Ä¹:"LÌ",Ä½:"LÌŒ",Ä»:"LÌ§",á¸¾:"MÌ",á¹€:"MÌ‡",Åƒ:"NÌ",Ç¸:"NÌ€",Ã‘:"NÌƒ",Å‡:"NÌŒ",á¹„:"NÌ‡",Å…:"NÌ§",Ã“:"OÌ",Ã’:"OÌ€",Ã–:"OÌˆ",Èª:"OÌˆÌ„",Ã•:"OÌƒ",á¹Œ:"OÌƒÌ",á¹Ž:"OÌƒÌˆ",È¬:"OÌƒÌ„",ÅŒ:"OÌ„",á¹’:"OÌ„Ì",á¹:"OÌ„Ì€",ÅŽ:"OÌ†",Ç‘:"OÌŒ",Ã”:"OÌ‚",á»:"OÌ‚Ì",á»’:"OÌ‚Ì€",á»–:"OÌ‚Ìƒ",È®:"OÌ‡",È°:"OÌ‡Ì„",Å:"OÌ‹",á¹”:"PÌ",á¹–:"PÌ‡",Å”:"RÌ",Å˜:"RÌŒ",á¹˜:"RÌ‡",Å–:"RÌ§",Åš:"SÌ",á¹¤:"SÌÌ‡",Å :"SÌŒ",á¹¦:"SÌŒÌ‡",Åœ:"SÌ‚",á¹ :"SÌ‡",Åž:"SÌ§",Å¤:"TÌŒ",á¹ª:"TÌ‡",Å¢:"TÌ§",Ãš:"UÌ",Ã™:"UÌ€",Ãœ:"UÌˆ",Ç—:"UÌˆÌ",Ç›:"UÌˆÌ€",Ç•:"UÌˆÌ„",Ç™:"UÌˆÌŒ",Å¨:"UÌƒ",á¹¸:"UÌƒÌ",Åª:"UÌ„",á¹º:"UÌ„Ìˆ",Å¬:"UÌ†",Ç“:"UÌŒ",Ã›:"UÌ‚",Å®:"UÌŠ",Å°:"UÌ‹",á¹¼:"VÌƒ",áº‚:"WÌ",áº€:"WÌ€",áº„:"WÌˆ",Å´:"WÌ‚",áº†:"WÌ‡",áºŒ:"XÌˆ",áºŠ:"XÌ‡",Ã:"YÌ",á»²:"YÌ€",Å¸:"YÌˆ",á»¸:"YÌƒ",È²:"YÌ„",Å¶:"YÌ‚",áºŽ:"YÌ‡",Å¹:"ZÌ",Å½:"ZÌŒ",áº:"ZÌ‚",Å»:"ZÌ‡",Î¬:"Î±Ì",á½°:"Î±Ì€",á¾±:"Î±Ì„",á¾°:"Î±Ì†",Î­:"ÎµÌ",á½²:"ÎµÌ€",Î®:"Î·Ì",á½´:"Î·Ì€",Î¯:"Î¹Ì",á½¶:"Î¹Ì€",ÏŠ:"Î¹Ìˆ",Î:"Î¹ÌˆÌ",á¿’:"Î¹ÌˆÌ€",á¿‘:"Î¹Ì„",á¿:"Î¹Ì†",ÏŒ:"Î¿Ì",á½¸:"Î¿Ì€",Ï:"Ï…Ì",á½º:"Ï…Ì€",Ï‹:"Ï…Ìˆ",Î°:"Ï…ÌˆÌ",á¿¢:"Ï…ÌˆÌ€",á¿¡:"Ï…Ì„",á¿ :"Ï…Ì†",ÏŽ:"Ï‰Ì",á½¼:"Ï‰Ì€",ÎŽ:"Î¥Ì",á¿ª:"Î¥Ì€",Î«:"Î¥Ìˆ",á¿©:"Î¥Ì„",á¿¨:"Î¥Ì†",Î:"Î©Ì",á¿º:"Î©Ì€"};class dd{constructor(h,f){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new xw(h,f,this.mode),this.settings=f,this.leftrightDepth=0}expect(h,f){if(f===void 0&&(f=!0),this.fetch().text!==h)throw new i("Expected '"+h+"', got '"+this.fetch().text+"'",this.fetch());f&&this.consume()}consume(){this.nextToken=null}fetch(){return this.nextToken==null&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(h){this.mode=h,this.gullet.switchMode(h)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{const h=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),h}finally{this.gullet.endGroups()}}subparse(h){const f=this.nextToken;this.consume(),this.gullet.pushToken(new Us("}")),this.gullet.pushTokens(h);const x=this.parseExpression(!1);return this.expect("}"),this.nextToken=f,x}parseExpression(h,f){const x=[];for(;;){this.mode==="math"&&this.consumeSpaces();const j=this.fetch();if(dd.endOfExpression.indexOf(j.text)!==-1||f&&j.text===f||h&&mi[j.text]&&mi[j.text].infix)break;const D=this.parseAtom(f);if(D){if(D.type==="internal")continue}else break;x.push(D)}return this.mode==="text"&&this.formLigatures(x),this.handleInfixNodes(x)}handleInfixNodes(h){let f=-1,x;for(let j=0;j<h.length;j++)if(h[j].type==="infix"){if(f!==-1)throw new i("only one infix operator per group",h[j].token);f=j,x=h[j].replaceWith}if(f!==-1&&x){let j,D;const F=h.slice(0,f),H=h.slice(f+1);F.length===1&&F[0].type==="ordgroup"?j=F[0]:j={type:"ordgroup",mode:this.mode,body:F},H.length===1&&H[0].type==="ordgroup"?D=H[0]:D={type:"ordgroup",mode:this.mode,body:H};let re;return x==="\\\\abovefrac"?re=this.callFunction(x,[j,h[f],D],[]):re=this.callFunction(x,[j,D],[]),[re]}else return h}handleSupSubscript(h){const f=this.fetch(),x=f.text;this.consume(),this.consumeSpaces();let j;do{var D;j=this.parseGroup(h)}while(((D=j)==null?void 0:D.type)==="internal");if(!j)throw new i("Expected group after '"+x+"'",f);return j}formatUnsupportedCmd(h){const f=[];for(let D=0;D<h.length;D++)f.push({type:"textord",mode:"text",text:h[D]});const x={type:"text",mode:this.mode,body:f};return{type:"color",mode:this.mode,color:this.settings.errorColor,body:[x]}}parseAtom(h){const f=this.parseGroup("atom",h);if((f==null?void 0:f.type)==="internal"||this.mode==="text")return f;let x,j;for(;;){this.consumeSpaces();const D=this.fetch();if(D.text==="\\limits"||D.text==="\\nolimits"){if(f&&f.type==="op"){const F=D.text==="\\limits";f.limits=F,f.alwaysHandleSupSub=!0}else if(f&&f.type==="operatorname")f.alwaysHandleSupSub&&(f.limits=D.text==="\\limits");else throw new i("Limit controls must follow a math operator",D);this.consume()}else if(D.text==="^"){if(x)throw new i("Double superscript",D);x=this.handleSupSubscript("superscript")}else if(D.text==="_"){if(j)throw new i("Double subscript",D);j=this.handleSupSubscript("subscript")}else if(D.text==="'"){if(x)throw new i("Double superscript",D);const F={type:"textord",mode:this.mode,text:"\\prime"},H=[F];for(this.consume();this.fetch().text==="'";)H.push(F),this.consume();this.fetch().text==="^"&&H.push(this.handleSupSubscript("superscript")),x={type:"ordgroup",mode:this.mode,body:H}}else if(cd[D.text]){const F=iy.test(D.text),H=[];for(H.push(new Us(cd[D.text])),this.consume();;){const we=this.fetch().text;if(!cd[we]||iy.test(we)!==F)break;H.unshift(new Us(cd[we])),this.consume()}const re=this.subparse(H);F?j={type:"ordgroup",mode:"math",body:re}:x={type:"ordgroup",mode:"math",body:re}}else break}return x||j?{type:"supsub",mode:this.mode,base:f,sup:x,sub:j}:f}parseFunction(h,f){const x=this.fetch(),j=x.text,D=mi[j];if(!D)return null;if(this.consume(),f&&f!=="atom"&&!D.allowedInArgument)throw new i("Got function '"+j+"' with no arguments"+(f?" as "+f:""),x);if(this.mode==="text"&&!D.allowedInText)throw new i("Can't use function '"+j+"' in text mode",x);if(this.mode==="math"&&D.allowedInMath===!1)throw new i("Can't use function '"+j+"' in math mode",x);const{args:F,optArgs:H}=this.parseArguments(j,D);return this.callFunction(j,F,H,x,h)}callFunction(h,f,x,j,D){const F={funcName:h,parser:this,token:j,breakOnTokenText:D},H=mi[h];if(H&&H.handler)return H.handler(F,f,x);throw new i("No function handler for "+h)}parseArguments(h,f){const x=f.numArgs+f.numOptionalArgs;if(x===0)return{args:[],optArgs:[]};const j=[],D=[];for(let F=0;F<x;F++){let H=f.argTypes&&f.argTypes[F];const re=F<f.numOptionalArgs;(f.primitive&&H==null||f.type==="sqrt"&&F===1&&D[0]==null)&&(H="primitive");const we=this.parseGroupOfType("argument to '"+h+"'",H,re);if(re)D.push(we);else if(we!=null)j.push(we);else throw new i("Null argument, please report this as a bug")}return{args:j,optArgs:D}}parseGroupOfType(h,f,x){switch(f){case"color":return this.parseColorGroup(x);case"size":return this.parseSizeGroup(x);case"url":return this.parseUrlGroup(x);case"math":case"text":return this.parseArgumentGroup(x,f);case"hbox":{const j=this.parseArgumentGroup(x,"text");return j!=null?{type:"styling",mode:j.mode,body:[j],style:"text"}:null}case"raw":{const j=this.parseStringGroup("raw",x);return j!=null?{type:"raw",mode:"text",string:j.text}:null}case"primitive":{if(x)throw new i("A primitive argument cannot be optional");const j=this.parseGroup(h);if(j==null)throw new i("Expected group as "+h,this.fetch());return j}case"original":case null:case void 0:return this.parseArgumentGroup(x);default:throw new i("Unknown group type as "+h,this.fetch())}}consumeSpaces(){for(;this.fetch().text===" ";)this.consume()}parseStringGroup(h,f){const x=this.gullet.scanArgument(f);if(x==null)return null;let j="",D;for(;(D=this.fetch()).text!=="EOF";)j+=D.text,this.consume();return this.consume(),x.text=j,x}parseRegexGroup(h,f){const x=this.fetch();let j=x,D="",F;for(;(F=this.fetch()).text!=="EOF"&&h.test(D+F.text);)j=F,D+=j.text,this.consume();if(D==="")throw new i("Invalid "+f+": '"+x.text+"'",x);return x.range(j,D)}parseColorGroup(h){const f=this.parseStringGroup("color",h);if(f==null)return null;const x=/^(#[a-f0-9]{3}|#?[a-f0-9]{6}|[a-z]+)$/i.exec(f.text);if(!x)throw new i("Invalid color: '"+f.text+"'",f);let j=x[0];return/^[0-9a-f]{6}$/i.test(j)&&(j="#"+j),{type:"color-token",mode:this.mode,color:j}}parseSizeGroup(h){let f,x=!1;if(this.gullet.consumeSpaces(),!h&&this.gullet.future().text!=="{"?f=this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size"):f=this.parseStringGroup("size",h),!f)return null;!h&&f.text.length===0&&(f.text="0pt",x=!0);const j=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(f.text);if(!j)throw new i("Invalid size: '"+f.text+"'",f);const D={number:+(j[1]+j[2]),unit:j[3]};if(!Qt(D))throw new i("Invalid unit: '"+D.unit+"'",f);return{type:"size",mode:this.mode,value:D,isBlank:x}}parseUrlGroup(h){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);const f=this.parseStringGroup("url",h);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),f==null)return null;const x=f.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:x}}parseArgumentGroup(h,f){const x=this.gullet.scanArgument(h);if(x==null)return null;const j=this.mode;f&&this.switchMode(f),this.gullet.beginGroup();const D=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();const F={type:"ordgroup",mode:this.mode,loc:x.loc,body:D};return f&&this.switchMode(j),F}parseGroup(h,f){const x=this.fetch(),j=x.text;let D;if(j==="{"||j==="\\begingroup"){this.consume();const F=j==="{"?"}":"\\endgroup";this.gullet.beginGroup();const H=this.parseExpression(!1,F),re=this.fetch();this.expect(F),this.gullet.endGroup(),D={type:"ordgroup",mode:this.mode,loc:Ds.range(x,re),body:H,semisimple:j==="\\begingroup"||void 0}}else if(D=this.parseFunction(f,h)||this.parseSymbol(),D==null&&j[0]==="\\"&&!oy.hasOwnProperty(j)){if(this.settings.throwOnError)throw new i("Undefined control sequence: "+j,x);D=this.formatUnsupportedCmd(j),this.consume()}return D}formLigatures(h){let f=h.length-1;for(let x=0;x<f;++x){const j=h[x],D=j.text;D==="-"&&h[x+1].text==="-"&&(x+1<f&&h[x+2].text==="-"?(h.splice(x,3,{type:"textord",mode:"text",loc:Ds.range(j,h[x+2]),text:"---"}),f-=2):(h.splice(x,2,{type:"textord",mode:"text",loc:Ds.range(j,h[x+1]),text:"--"}),f-=1)),(D==="'"||D==="`")&&h[x+1].text===D&&(h.splice(x,2,{type:"textord",mode:"text",loc:Ds.range(j,h[x+1]),text:D+D}),f-=1)}}parseSymbol(){const h=this.fetch();let f=h.text;if(/^\\verb[^a-zA-Z]/.test(f)){this.consume();let D=f.slice(5);const F=D.charAt(0)==="*";if(F&&(D=D.slice(1)),D.length<2||D.charAt(0)!==D.slice(-1))throw new i(`\\verb assertion failed --
                    please report what input caused this bug`);return D=D.slice(1,-1),{type:"verb",mode:"text",body:D,star:F}}ay.hasOwnProperty(f[0])&&!Be[this.mode][f[0]]&&(this.settings.strict&&this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+f[0]+'" used in math mode',h),f=ay[f[0]]+f.slice(1));const x=pw.exec(f);x&&(f=f.substring(0,x.index),f==="i"?f="Ä±":f==="j"&&(f="È·"));let j;if(Be[this.mode][f]){this.settings.strict&&this.mode==="math"&&Mt.indexOf(f)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+f[0]+'" used in math mode',h);const D=Be[this.mode][f].group,F=Ds.range(h);let H;if(An.hasOwnProperty(D)){const re=D;H={type:"atom",mode:this.mode,family:re,loc:F,text:f}}else H={type:D,mode:this.mode,loc:F,text:f};j=H}else if(f.charCodeAt(0)>=128)this.settings.strict&&(Se(f.charCodeAt(0))?this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+f[0]+'" used in math mode',h):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+f[0]+'"'+(" ("+f.charCodeAt(0)+")"),h)),j={type:"textord",mode:"text",loc:Ds.range(h),text:f};else return null;if(this.consume(),x)for(let D=0;D<x[0].length;D++){const F=x[0][D];if(!Xh[F])throw new i("Unknown accent ' "+F+"'",h);const H=Xh[F][this.mode]||Xh[F].text;if(!H)throw new i("Accent "+F+" unsupported in "+this.mode+" mode",h);j={type:"accent",mode:this.mode,loc:Ds.range(h),label:H,isStretchy:!1,isShifty:!0,base:j}}return j}}dd.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var Qh=function(p,h){if(!(typeof p=="string"||p instanceof String))throw new TypeError("KaTeX can only parse string typed expression");const f=new dd(p,h);delete f.gullet.macros.current["\\df@tag"];let x=f.parse();if(delete f.gullet.macros.current["\\current@color"],delete f.gullet.macros.current["\\color"],f.gullet.macros.get("\\df@tag")){if(!h.displayMode)throw new i("\\tag works only in display equations");x=[{type:"tag",mode:"text",body:x,tag:f.subparse([new Us("\\df@tag")])}]}return x};let ly=function(p,h,f){h.textContent="";const x=em(p,f).toNode();h.appendChild(x)};typeof document<"u"&&document.compatMode!=="CSS1Compat"&&(typeof console<"u"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),ly=function(){throw new i("KaTeX doesn't work in quirks mode.")});const vw=function(p,h){return em(p,h).toMarkup()},bw=function(p,h){const f=new C(h);return Qh(p,f)},cy=function(p,h,f){if(f.throwOnError||!(p instanceof i))throw p;const x=$e.makeSpan(["katex-error"],[new Et(h)]);return x.setAttribute("title",p.toString()),x.setAttribute("style","color:"+f.errorColor),x},em=function(p,h){const f=new C(h);try{const x=Qh(p,f);return O5(x,p,f)}catch(x){return cy(x,p,f)}};var Sw={version:"0.16.22",render:ly,renderToString:vw,ParseError:i,SETTINGS_SCHEMA:k,__parse:bw,__renderToDomTree:em,__renderToHTMLTree:function(p,h){const f=new C(h);try{const x=Qh(p,f);return _5(x,p,f)}catch(x){return cy(x,p,f)}},__setFontMetrics:Ue,__defineSymbol:w,__defineFunction:It,__defineMacro:J,__domTree:{Span:tt,Anchor:Ie,SymbolNode:Et,SvgNode:et,PathNode:pt,LineNode:Wt}},ww=Sw;return n=n.default,n}()})}(bm)),bm.exports}(function(t,e){(function(r,n){n(e,M,Pw,YE())})(Gv,function(r,n,s,i){Object.defineProperty(r,"__esModule",{value:!0});function a(S,b){for(var k in b)Object.defineProperty(S,k,{enumerable:!0,get:b[k]})}a(r,{BlockMath:()=>v,InlineMath:()=>I}),n=d(n),s=l(s),i=l(i);function l(S){return S&&S.__esModule?S:{default:S}}function c(S){if(typeof WeakMap!="function")return null;var b=new WeakMap,k=new WeakMap;return(c=function(A){return A?k:b})(S)}function d(S,b){if(S&&S.__esModule)return S;if(S===null||typeof S!="object"&&typeof S!="function")return{default:S};var k=c(b);if(k&&k.has(S))return k.get(S);var A={},C=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var T in S)if(T!=="default"&&Object.prototype.hasOwnProperty.call(S,T)){var P=C?Object.getOwnPropertyDescriptor(S,T):null;P&&(P.get||P.set)?Object.defineProperty(A,T,P):A[T]=S[T]}return A.default=S,k&&k.set(S,A),A}const u=(S,{displayMode:b})=>{const k=({children:A,errorColor:C,math:T,renderError:P})=>{const _=T??A,{html:R,error:G}=(0,n.useMemo)(()=>{try{return{html:i.default.renderToString(_,{displayMode:b,errorColor:C,throwOnError:!!P}),error:void 0}}catch(ne){if(ne instanceof i.default.ParseError||ne instanceof TypeError)return{error:ne};throw ne}},[_,C,P]);return G?P?P(G):n.default.createElement(S,{html:`${G.message}`}):n.default.createElement(S,{html:R})};return k.propTypes={children:s.default.string,errorColor:s.default.string,math:s.default.string,renderError:s.default.func},k},m={html:s.default.string.isRequired},g=({html:S})=>n.default.createElement("div",{"data-testid":"react-katex",dangerouslySetInnerHTML:{__html:S}});g.propTypes=m;const y=({html:S})=>n.default.createElement("span",{"data-testid":"react-katex",dangerouslySetInnerHTML:{__html:S}});y.propTypes=m;const v=u(g,{displayMode:!0}),I=u(y,{displayMode:!1})})})(Qp,Qp.exports);var KE=Qp.exports;class Ia{static getValidIdentifiers(e){const r={};return Object.keys(e).forEach(n=>{/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(n)&&(r[n]=e[n])}),r}static executeAlgorithm(e,r,n={},s){console.log("ðŸ”§ AlgorithmExecutionService.executeAlgorithm: Starting algorithm execution",{algorithmId:e.id,algorithmName:e.name,iterationValue:r,context:n,modeContext:s,variablesCount:e.variables.length,stepsCount:e.steps.length});const i={variables:{},results:{},iterationValue:r,finalResult:null};try{return console.log("ðŸ“Š AlgorithmExecutionService.executeAlgorithm: Initializing variables"),e.variables.forEach(a=>{console.log(`ðŸ“Š AlgorithmExecutionService.executeAlgorithm: Processing variable "${a.name}" (${a.id})`,{variableId:a.id,variableName:a.name,variableType:a.type,modeBased:a.modeBased,dimensionId:a.dimensionId,defaultValue:a.defaultValue,valuesByMode:a.valuesByMode});let l;if(a.modeBased&&a.dimensionId&&a.valuesByMode&&s){console.log(`ðŸŽ¯ AlgorithmExecutionService.executeAlgorithm: Processing mode-based variable "${a.name}"`,{variableId:a.id,dimensionId:a.dimensionId,modeContext:s,availableModeValues:Object.keys(a.valuesByMode)});const c=s[a.dimensionId];if(console.log(`ðŸŽ¯ AlgorithmExecutionService.executeAlgorithm: Current mode for dimension "${a.dimensionId}"`,{currentModeId:c,hasModeValue:c?!!a.valuesByMode[c]:!1}),c&&a.valuesByMode[c]){const d=a.valuesByMode[c];l=this.parseVariableValue(d,a.type),console.log(`âœ… AlgorithmExecutionService.executeAlgorithm: Using mode-specific value for "${a.name}"`,{modeId:c,modeValue:d,parsedValue:l,parsedValueType:typeof l})}else l=this.parseVariableValue(a.defaultValue||"",a.type),console.log(`âš ï¸ AlgorithmExecutionService.executeAlgorithm: Mode-specific value not found for "${a.name}", using default`,{currentModeId:c,availableModeValues:Object.keys(a.valuesByMode),defaultValue:a.defaultValue,parsedValue:l,parsedValueType:typeof l})}else l=this.parseVariableValue(a.defaultValue||"",a.type),console.log(`ðŸ“Š AlgorithmExecutionService.executeAlgorithm: Using default value for "${a.name}"`,{defaultValue:a.defaultValue,parsedValue:l,parsedValueType:typeof l});i.variables[a.id]=l,console.log(`ðŸ’¾ AlgorithmExecutionService.executeAlgorithm: Stored variable "${a.name}" in execution context`,{variableId:a.id,storedValue:l})}),i.variables.n=r,console.log('ðŸ“Š AlgorithmExecutionService.executeAlgorithm: Added system variable "n"',{n:r}),Object.assign(i.variables,n),console.log("ðŸ“Š AlgorithmExecutionService.executeAlgorithm: Added additional context",{context:n}),i.variables.Math={pow:Math.pow,max:Math.max,min:Math.min,abs:Math.abs,floor:Math.floor,ceil:Math.ceil,round:Math.round,sqrt:Math.sqrt,sin:Math.sin,cos:Math.cos,tan:Math.tan,log:Math.log,exp:Math.exp},i.variables.Array={isArray:Array.isArray},console.log("ðŸ“Š AlgorithmExecutionService.executeAlgorithm: Added Math and Array utilities"),console.log("ðŸ“Š AlgorithmExecutionService.executeAlgorithm: Final execution context variables",{variableCount:Object.keys(i.variables).length,variables:i.variables}),console.log("ðŸš€ AlgorithmExecutionService.executeAlgorithm: Starting step execution"),e.steps.forEach((a,l)=>{if(console.log(`ðŸš€ AlgorithmExecutionService.executeAlgorithm: Executing step ${l+1}/${e.steps.length}`,{stepType:a.type,stepId:a.id,stepName:a.name}),a.type==="formula"){const c=e.formulas.find(d=>d.id===a.id);if(c){console.log(`ðŸ“ AlgorithmExecutionService.executeAlgorithm: Evaluating formula "${c.name}"`,{formulaId:c.id,formulaName:c.name,expression:c.expressions.javascript.value});const d=this.evaluateFormula(c,i.variables);console.log(`âœ… AlgorithmExecutionService.executeAlgorithm: Formula "${c.name}" evaluated successfully`,{result:d,resultType:typeof d}),i.results[c.name]=d,i.finalResult=d}else console.error("âŒ AlgorithmExecutionService.executeAlgorithm: Formula not found for step",{stepId:a.id,stepName:a.name})}else if(a.type==="condition"){const c=e.conditions.find(d=>d.id===a.id);if(c){console.log(`ðŸ” AlgorithmExecutionService.executeAlgorithm: Evaluating condition "${c.name}"`,{conditionId:c.id,conditionName:c.name,expression:c.expression});const d=this.evaluateCondition(c,i.variables);console.log(`âœ… AlgorithmExecutionService.executeAlgorithm: Condition "${c.name}" evaluated successfully`,{result:d,resultType:typeof d}),i.results[c.name]=d}else console.error("âŒ AlgorithmExecutionService.executeAlgorithm: Condition not found for step",{stepId:a.id,stepName:a.name})}}),console.log("ðŸŽ‰ AlgorithmExecutionService.executeAlgorithm: Algorithm execution completed successfully",{finalResult:i.finalResult,finalResultType:typeof i.finalResult,resultsCount:Object.keys(i.results).length,results:i.results}),i}catch(a){throw console.error("ðŸ’¥ AlgorithmExecutionService.executeAlgorithm: Algorithm execution failed",{error:a,stack:a instanceof Error?a.stack:void 0,algorithmId:e.id,iterationValue:r,modeContext:s}),new Error(`Algorithm execution failed: ${a}`)}}static evaluateFormula(e,r){try{if(e.expressions.ast){const n=Is.validateAST(e.expressions.ast),s=n.filter(u=>u.startsWith("Warning:")),i=n.filter(u=>!u.startsWith("Warning:"));if(s.length>0&&console.warn(`AST validation warnings for formula "${e.name}":`,s),i.length>0)throw new Error(`AST validation failed: ${i.join(", ")}`);const a=Is.generateJavaScript(e.expressions.ast),l={...r,Math:r.Math||Math,Array:r.Array||Array,console};if(a.includes("=")){const u=a.split("=").map(m=>m.trim());if(u.length===2){const m=u[0],g=u[1],v=new Function(...Object.keys(this.getValidIdentifiers(l)),`return ${g}`)(...Object.values(this.getValidIdentifiers(l)));return r[m]=v,l[m]=v,v}}return new Function(...Object.keys(this.getValidIdentifiers(l)),`return ${a}`)(...Object.values(this.getValidIdentifiers(l)))}else{const n=e.expressions.javascript.value,s={...r,Math:r.Math||Math,Array:r.Array||Array,console};if(n.includes("=")){const l=n.split("=").map(c=>c.trim());if(l.length===2){const c=l[0],d=l[1],m=new Function(...Object.keys(this.getValidIdentifiers(s)),`return ${d}`)(...Object.values(this.getValidIdentifiers(s)));r[c]=m,s[c]=m;for(const g of Object.keys(r))g!==c&&r[g]===m&&(r[g]=m,s[g]=m);return m}}return new Function(...Object.keys(this.getValidIdentifiers(s)),`return ${n}`)(...Object.values(this.getValidIdentifiers(s)))}}catch(n){throw console.error("Formula evaluation error:",n),console.error("Expression:",e.expressions.javascript.value),console.error("Variables:",r),new Error(`Formula evaluation failed for ${e.name}: ${n}`)}}static evaluateCondition(e,r){try{const n=e.expression,s={...r,Math:r.Math||Math,Array:r.Array||Array,console};return!!new Function(...Object.keys(this.getValidIdentifiers(s)),`return ${n}`)(...Object.values(this.getValidIdentifiers(s)))}catch(n){throw console.error("Condition evaluation error:",n),console.error("  Expression:",e.expression),console.error("  Variables:",r),new Error(`Condition evaluation failed for ${e.name}: ${n}`)}}static generateTokensForAlgorithm(e){var i;const r=[];if(!((i=e.tokenGeneration)!=null&&i.enabled))return r;const{iterationRange:n}=e.tokenGeneration,s=[];for(let a=n.start;a<=n.end;a+=n.step)s.push(a);return s.forEach(a=>{try{const l=this.executeAlgorithm(e,a),c=this.generateTokenDisplayName(e,a),d={value:this.formatValueForTokenType(l.finalResult,e.resolvedValueTypeId)},u=`${e.id}-${a}`;r.push({tokenId:u,displayName:c,value:d,iterationValue:a,formulaName:this.getLastExecutedFormulaName(e)})}catch(l){console.error(`Error generating token for iteration ${a}:`,l),r.push({tokenId:`${e.id}-${a}`,displayName:`Error-${a}`,value:{value:""},iterationValue:a,formulaName:"Error",error:String(l)})}}),r}static generateTokenDisplayName(e,r){const n=e.name.replace(/\s+/g,"-").toLowerCase();return r<0?`${n}-minus-${Math.abs(r)}`:`${n}-${r}`}static formatValueForTokenType(e,r){if(e==null)return"";switch(r){case"dimension":case"gap":case"font-size":{const n=Number(e);return isNaN(n)?String(e):n.toString()}case"color":{if(typeof e=="string"&&(e.startsWith("#")||e.startsWith("rgb")))return e;const n=Number(e);return isNaN(n)?String(e):`#${n.toString(16).padStart(6,"0")}`}default:return String(e)}}static getLastExecutedFormulaName(e){for(let r=e.steps.length-1;r>=0;r--){const n=e.steps[r];if(n.type==="formula")return n.name}return"Unknown"}static parseVariableValue(e,r){switch(r){case"number":return Number(e)||0;case"string":{if(e.trim().startsWith("[")&&e.trim().endsWith("]"))try{return JSON.parse(e)}catch{return String(e)}return String(e)}case"boolean":return e==="true"||e==="1";case"color":return String(e);default:return e}}static validateAlgorithm(e){const r=[];return e.id||r.push("Algorithm ID is required"),e.name||r.push("Algorithm name is required"),e.resolvedValueTypeId||r.push("Resolved value type ID is required"),e.variables.forEach((n,s)=>{n.id||r.push(`Variable ${s}: ID is required`),n.name||r.push(`Variable ${s}: Name is required`),n.type||r.push(`Variable ${s}: Type is required`)}),e.formulas.forEach((n,s)=>{var i,a;n.id||r.push(`Formula ${s}: ID is required`),n.name||r.push(`Formula ${s}: Name is required`),(a=(i=n.expressions)==null?void 0:i.javascript)!=null&&a.value||r.push(`Formula ${s}: JavaScript expression is required`)}),e.steps.forEach((n,s)=>{n.type||r.push(`Step ${s}: Type is required`),n.id||r.push(`Step ${s}: ID is required`),n.name||r.push(`Step ${s}: Name is required`),n.type==="formula"?e.formulas.find(a=>a.id===n.id)||r.push(`Step ${s}: Referenced formula '${n.id}' not found`):n.type==="condition"&&(e.conditions.find(a=>a.id===n.id)||r.push(`Step ${s}: Referenced condition '${n.id}' not found`))}),r}}class Px{static generateTokens(e,r,n,s,i=!1,a){var d,u,m,g;if(console.log("ðŸ” TokenGenerationService.generateTokens: Starting token generation",{algorithmId:e.id,algorithmName:e.name,hasTokenGeneration:!!((d=e.tokenGeneration)!=null&&d.enabled),existingTokensCount:r.length,selectedModes:a,modifyTaxonomiesInPlace:i}),!((u=e.tokenGeneration)!=null&&u.enabled))return console.log("âŒ TokenGenerationService.generateTokens: Token generation not enabled"),{tokens:[],errors:[]};const l=[],c=[];try{if(e.formulas.length===0){const P="Algorithm must have at least one formula for token generation";return console.error("âŒ TokenGenerationService.generateTokens:",P),l.push(P),{tokens:[],errors:l}}const{logicalMapping:y}=e.tokenGeneration;if(!y.taxonomyId&&!y.newTaxonomyName){const P="Must select an existing taxonomy or provide a name for a new taxonomy";return console.error("âŒ TokenGenerationService.generateTokens:",P),l.push(P),{tokens:[],errors:l}}console.log("âœ… TokenGenerationService.generateTokens: Basic validation passed");const v=this.generateIterationValues(e.tokenGeneration.iterationRange);console.log("ðŸ“Š TokenGenerationService.generateTokens: Generated iteration values",{iterationValues:v,range:e.tokenGeneration.iterationRange});const I=this.generateTermsFromLogicalMapping(v,y);console.log("ðŸ·ï¸ TokenGenerationService.generateTokens: Generated terms",{generatedTerms:I,logicalMapping:y});const{taxonomy:S,newTaxonomies:b}=this.handleTaxonomyCreation(y,I,s,e.tokenGeneration.bulkAssignments.resolvedValueTypeId);console.log("ðŸ“š TokenGenerationService.generateTokens: Taxonomy handling complete",{taxonomyId:S.id,taxonomyName:S.name,termCount:S.terms.length,newTaxonomiesCount:b.length});const k=i?{id:S.id,termCount:S.terms.length,termNames:S.terms.map(P=>P.name)}:null,A=this.matchOrCreateTerms(S,I,v,i);console.log("ðŸ”— TokenGenerationService.generateTokens: Term mappings created",{termMappingsCount:A.length,termMappings:A.slice(0,3)});const C=this.generateModeCombinations(e,a);console.log("ðŸ”„ TokenGenerationService.generateTokens: Mode combinations generated",{modeCombinationsCount:C.length,modeCombinations:C,algorithmVariables:e.variables.map(P=>({id:P.id,name:P.name,modeBased:P.modeBased,dimensionId:P.dimensionId,hasModeValues:!!P.valuesByMode}))}),console.log("ðŸš€ TokenGenerationService.generateTokens: Starting token generation loop",{iterationValuesCount:v.length,modeCombinationsCount:C.length,totalExpectedTokens:v.length*C.length});for(let P=0;P<v.length;P++){const _=v[P];console.log(`ðŸ“ˆ TokenGenerationService.generateTokens: Processing iteration ${P+1}/${v.length}, n=${_}`);for(let R=0;R<C.length;R++){const G=C[R];console.log(`ðŸ”„ TokenGenerationService.generateTokens: Processing mode combination ${R+1}/${C.length}`,{modeContext:G,iterationValue:_,modeContextKeys:Object.keys(G),modeContextValues:Object.values(G)});try{console.log("âš™ï¸ TokenGenerationService.generateTokens: Executing algorithm steps",{algorithmId:e.id,stepsCount:e.steps.length,modeContext:G,variables:e.variables.map(O=>{var Z,ie;return{id:O.id,name:O.name,modeBased:O.modeBased,dimensionId:O.dimensionId,defaultValue:(ie=(Z=O.valuesByMode)==null?void 0:Z[0])==null?void 0:ie.value}})});const ne=this.executeAlgorithmSteps(e,_,G);console.log("âœ… TokenGenerationService.generateTokens: Algorithm execution successful",{calculatedValue:ne,calculatedValueType:typeof ne,isNumber:typeof ne=="number",isNaN:typeof ne=="number"?isNaN(ne):"N/A"});const he=this.generateTokenId();if(console.log("ðŸ†” TokenGenerationService.generateTokens: Generated token ID",{tokenId:he}),r.some(O=>O.id===he)){const O=`Token ID "${he}" already exists`;console.error("âŒ TokenGenerationService.generateTokens:",O),l.push(O);continue}const te=A.find(O=>O.iterationValue===_);if(!te){const O=`No term mapping found for iteration ${_}`;console.error("âŒ TokenGenerationService.generateTokens:",O,{termMappings:A,iterationValue:_}),l.push(O);continue}console.log("ðŸ·ï¸ TokenGenerationService.generateTokens: Found term mapping",{termMapping:te,iterationValue:_});const K=this.createTokenWithLogicalMappingAndModes(he,e,ne,_,S,te.termId,s,G);console.log("ðŸŽ¯ TokenGenerationService.generateTokens: Token created successfully",{tokenId:K.id,displayName:K.displayName,value:(m=K.valuesByMode[0])==null?void 0:m.value,modeIds:(g=K.valuesByMode[0])==null?void 0:g.modeIds,taxonomiesCount:K.taxonomies.length}),c.push(K),console.log("âœ… TokenGenerationService.generateTokens: Token added to generated tokens array",{currentGeneratedTokensCount:c.length})}catch(ne){const he=Object.keys(G).length>0?` (modes: ${Object.entries(G).map(([K,O])=>`${K}:${O}`).join(", ")})`:"",te=`Error generating token for iteration ${_}${he}: ${ne}`;console.error("âŒ TokenGenerationService.generateTokens:",te,{error:ne,stack:ne instanceof Error?ne.stack:void 0}),l.push(te)}}}console.log("ðŸŽ‰ TokenGenerationService.generateTokens: Token generation loop complete",{generatedTokensCount:c.length,errorsCount:l.length});let T;return y.taxonomyId&&i&&k&&(console.log("ðŸ” TokenGenerationService.generateTokens: Checking for taxonomy updates:",{taxonomyId:S.id,taxonomyName:S.name,originalTermCount:k.termCount,currentTermCount:S.terms.length,originalTerms:k.termNames,currentTerms:S.terms.map(P=>P.name),modifyTaxonomiesInPlace:i}),S.terms.length>k.termCount?(T=[S],console.log("âœ… TokenGenerationService.generateTokens: Returning updated taxonomy with new terms:",{taxonomyId:S.id,taxonomyName:S.name,originalTermCount:k.termCount,newTermCount:S.terms.length,newTerms:S.terms.slice(k.termCount).map(P=>P.name)})):console.log("â„¹ï¸ TokenGenerationService.generateTokens: No new terms added to taxonomy:",{taxonomyId:S.id,taxonomyName:S.name,termCount:S.terms.length})),console.log("ðŸ TokenGenerationService.generateTokens: Final results",{tokensCount:c.length,errorsCount:l.length,newTaxonomiesCount:(b==null?void 0:b.length)||0,updatedTaxonomiesCount:(T==null?void 0:T.length)||0}),{tokens:c,errors:l,newTaxonomies:b.length>0?b:void 0,updatedTaxonomies:T}}catch(y){const v=`Token generation failed: ${y}`;console.error("ðŸ’¥ TokenGenerationService.generateTokens: Critical error",v,{error:y,stack:y instanceof Error?y.stack:void 0}),l.push(v)}return{tokens:c,errors:l}}static generateModeCombinations(e,r){console.log("ðŸ”„ TokenGenerationService.generateModeCombinations: Starting mode combination generation",{algorithmId:e.id,algorithmName:e.name,selectedModes:r,totalVariables:e.variables.length});const n=e.variables.filter(l=>l.modeBased&&l.dimensionId);if(console.log("ðŸŽ¯ TokenGenerationService.generateModeCombinations: Found mode-based variables",{modeBasedVariablesCount:n.length,modeBasedVariables:n.map(l=>({id:l.id,name:l.name,dimensionId:l.dimensionId,modeValues:l.valuesByMode}))}),n.length===0)return console.log("â„¹ï¸ TokenGenerationService.generateModeCombinations: No mode-based variables found, returning empty context"),[{}];const s=L.getDimensions();console.log("ðŸ“ TokenGenerationService.generateModeCombinations: Retrieved dimensions from storage",{totalDimensions:s.length,dimensions:s.map(l=>({id:l.id,displayName:l.displayName,modesCount:l.modes.length}))});const i=s.filter(l=>n.some(c=>c.dimensionId===l.id));console.log("ðŸŽ¯ TokenGenerationService.generateModeCombinations: Filtered to used dimensions",{usedDimensionsCount:i.length,usedDimensions:i.map(l=>({id:l.id,displayName:l.displayName,modesCount:l.modes.length,modes:l.modes.map(c=>({id:c.id,name:c.name}))}))});const a=[{}];console.log("ðŸš€ TokenGenerationService.generateModeCombinations: Starting combination generation",{initialCombinationsCount:a.length});for(const l of i){console.log(`ðŸ”„ TokenGenerationService.generateModeCombinations: Processing dimension "${l.displayName}" (${l.id})`,{dimensionId:l.id,dimensionName:l.displayName,totalModes:l.modes.length});const c=[...a];a.length=0;let d=l.modes;r&&r[l.id]?(d=l.modes.filter(u=>r[l.id].includes(u.id)),console.log(`ðŸŽ¯ TokenGenerationService.generateModeCombinations: Filtered modes for dimension "${l.displayName}"`,{totalModes:l.modes.length,selectedModes:r[l.id],filteredModesCount:d.length,filteredModes:d.map(u=>({id:u.id,name:u.name}))})):console.log(`â„¹ï¸ TokenGenerationService.generateModeCombinations: Using all modes for dimension "${l.displayName}"`,{modesCount:d.length,modes:d.map(u=>({id:u.id,name:u.name}))});for(const u of d){console.log(`ðŸ”„ TokenGenerationService.generateModeCombinations: Processing mode "${u.name}" (${u.id})`,{modeId:u.id,modeName:u.name,currentCombinationsCount:c.length});for(const m of c){const g={...m,[l.id]:u.id};a.push(g)}}console.log(`âœ… TokenGenerationService.generateModeCombinations: Completed dimension "${l.displayName}"`,{dimensionId:l.id,dimensionName:l.displayName,newCombinationsCount:a.length,sampleCombinations:a.slice(0,3)})}return console.log("ðŸŽ‰ TokenGenerationService.generateModeCombinations: Mode combination generation complete",{finalCombinationsCount:a.length,combinations:a}),a}static generateIterationValues(e){console.log("ðŸ“Š TokenGenerationService.generateIterationValues: Generating iteration values",{range:e,start:e.start,end:e.end,step:e.step});const r=[],{start:n,end:s,step:i}=e;for(let a=n;a<=s;a+=i)r.push(a);return console.log("ðŸ“Š TokenGenerationService.generateIterationValues: Generated values",{values:r,count:r.length}),r}static generateTokenId(){return wn("token")}static createToken(e,r,n,s,i,a){var m;const l=(m=r.tokenGeneration)==null?void 0:m.bulkAssignments;if(!l)throw new Error("Bulk assignments not configured");const c=this.createTaxonomiesArray(l.taxonomies||[],s,r.tokenGeneration.logicalMapping,a),d=this.generateDisplayNameFromTaxonomies(c,a,s,r.tokenGeneration.logicalMapping);return{id:e,displayName:d,resolvedValueTypeId:l.resolvedValueTypeId,tokenCollectionId:l.collectionId||void 0,description:`Generated by algorithm "${r.name}" with n=${s}`,private:l.private,status:l.status||"stable",themeable:l.themeable,tokenTier:l.tokenTier||"PRIMITIVE",generatedByAlgorithm:!0,algorithmId:r.id,taxonomies:c,propertyTypes:[],valuesByMode:[{modeIds:[],value:{value:n.toString()}}]}}static generateDisplayNameFromTaxonomies(e,r,n,s){const i=[];for(const a of e){const l=r.find(c=>c.id===a.taxonomyId);if(l){const c=l.terms.find(d=>d.id===a.termId);c&&i.push(c.name)}}return i.length===0?this.generateFallbackDisplayName(n,s):i.join(" ")}static generateFallbackDisplayName(e,r){const{scaleType:n}=r;return n==="tshirt"?this.generateTshirtSizeName(e,r.defaultValue,r.extraPrefix||"X"):this.generateNumericSizeName(e,r.defaultValue,r.increasingStep||100,r.decreasingStep||25)}static generateTshirtSizeName(e,r,n){if(e===0)return r;if(e>0){if(e===1)return"Large";const s=e-1;return`${n.repeat(s)}-Large`}else{if(e===-1)return"Small";const s=Math.abs(e)-1;return`${n.repeat(s)}-Small`}}static generateNumericSizeName(e,r,n,s){const i=parseFloat(r)||100;return e===0?r:e>0?(i+e*n).toString():(i+e*s).toString()}static createTaxonomiesArray(e,r,n,s){return e.filter(i=>{const a=s.find(l=>l.id===i.taxonomyId);return a?a.terms.some(l=>l.id===i.termId):!1})}static findLogicalTerm(e,r,n){const{scaleType:s}=n;if(s==="tshirt"){const i=this.generateTshirtSizeName(r,n.defaultValue,n.extraPrefix||"X");return e.terms.find(a=>a.name.toLowerCase()===i.toLowerCase())||null}else{const i=this.generateNumericSizeName(r,n.defaultValue,n.increasingStep||100,n.decreasingStep||25);return e.terms.find(a=>a.name===i||a.name===r.toString())||null}}static generateTermsFromLogicalMapping(e,r){console.log("ðŸ·ï¸ TokenGenerationService.generateTermsFromLogicalMapping: Generating terms",{iterationValues:e,logicalMapping:r,scaleType:r.scaleType});const n=[];for(const s of e){let i;r.scaleType==="tshirt"?i=this.generateTshirtSizeName(s,r.defaultValue,r.extraPrefix||"X"):i=this.generateNumericSizeName(s,r.defaultValue,r.increasingStep||100,r.decreasingStep||25),n.push(i),console.log(`ðŸ·ï¸ TokenGenerationService.generateTermsFromLogicalMapping: Generated term for n=${s}: "${i}"`)}return console.log("ðŸ·ï¸ TokenGenerationService.generateTermsFromLogicalMapping: All terms generated",{terms:n,count:n.length}),n}static handleTaxonomyCreation(e,r,n,s){const i=[];if(e.taxonomyId){const a=n.find(l=>l.id===e.taxonomyId);if(!a)throw new Error(`Selected taxonomy with ID "${e.taxonomyId}" not found`);return{taxonomy:a,newTaxonomies:i}}if(e.newTaxonomyName){const a={id:wn("taxonomy"),name:e.newTaxonomyName,description:"Generated by algorithm for scale terms",terms:r.map(l=>({id:wn("term"),name:l,description:`Generated term for scale: ${l}`})),resolvedValueTypeIds:[s]};return i.push(a),{taxonomy:a,newTaxonomies:i}}throw new Error("No taxonomy selected or new taxonomy name provided")}static matchOrCreateTerms(e,r,n,s=!1){console.log("ðŸ”— TokenGenerationService.matchOrCreateTerms: Starting term matching/creation",{taxonomyId:e.id,taxonomyName:e.name,existingTermsCount:e.terms.length,generatedTerms:r,iterationValues:n,modifyTaxonomiesInPlace:s});const i=[],a=s?e:{...e,terms:[...e.terms]};for(let l=0;l<n.length;l++){const c=n[l],d=r[l];console.log(`ðŸ”— TokenGenerationService.matchOrCreateTerms: Processing iteration ${l+1}/${n.length}`,{iterationValue:c,termName:d,existingTerms:a.terms.map(m=>m.name)});let u=a.terms.find(m=>m.name===d);if(u)console.log("ðŸ”— TokenGenerationService.matchOrCreateTerms: Found existing term",{termId:u.id,termName:u.name});else{const m={id:wn("term"),name:d,description:`Generated term for scale: ${d}`};a.terms.push(m),u=m,console.log("ðŸ”— TokenGenerationService.matchOrCreateTerms: Created new term",{termId:m.id,termName:m.name})}i.push({iterationValue:c,termId:u.id,termName:u.name})}return console.log("ðŸ”— TokenGenerationService.matchOrCreateTerms: Term mappings complete",{termMappingsCount:i.length,termMappings:i,finalTaxonomyTermsCount:a.terms.length}),i}static createTokenWithLogicalMappingAndModes(e,r,n,s,i,a,l,c){var k,A;console.log("ðŸŽ¯ TokenGenerationService.createTokenWithLogicalMappingAndModes: Creating token with mode context",{tokenId:e,algorithmId:r.id,algorithmName:r.name,value:n,iterationValue:s,taxonomyId:i.id,taxonomyName:i.name,termId:a,modeContext:c,modeContextKeys:Object.keys(c),modeContextValues:Object.values(c)});const{tokenGeneration:d}=r,{bulkAssignments:u,logicalMapping:m}=d,g=[...u.taxonomies];console.log("ðŸ“š TokenGenerationService.createTokenWithLogicalMappingAndModes: Initial taxonomies array",{taxonomiesArray:g,bulkAssignmentsTaxonomies:u.taxonomies});const y={taxonomyId:i.id,termId:a};g.some(C=>C.taxonomyId===i.id)?console.log("ðŸ“š TokenGenerationService.createTokenWithLogicalMappingAndModes: Logical mapping taxonomy already included",{logicalMappingTaxonomy:y,existingTaxonomiesArray:g}):(g.push(y),console.log("ðŸ“š TokenGenerationService.createTokenWithLogicalMappingAndModes: Added logical mapping taxonomy",{logicalMappingTaxonomy:y,updatedTaxonomiesArray:g}));const I=this.generateDisplayNameFromTaxonomies(g,l,s,m);console.log("ðŸ·ï¸ TokenGenerationService.createTokenWithLogicalMappingAndModes: Generated display name",{displayName:I,taxonomiesArray:g,iterationValue:s});const S=Object.values(c).map(C=>C);console.log("ðŸ”„ TokenGenerationService.createTokenWithLogicalMappingAndModes: Extracted mode IDs from context",{modeContext:c,modeIds:S,modeIdsCount:S.length});const b={id:e,displayName:I,resolvedValueTypeId:u.resolvedValueTypeId,tokenCollectionId:u.collectionId||void 0,description:`Generated by algorithm "${r.name}" with n=${s}`,private:u.private,status:u.status||"stable",themeable:u.themeable,tokenTier:u.tokenTier||"PRIMITIVE",generatedByAlgorithm:!0,algorithmId:r.id,taxonomies:g,propertyTypes:[],valuesByMode:[{modeIds:S,value:{value:n.toString()}}]};return console.log("ðŸŽ¯ TokenGenerationService.createTokenWithLogicalMappingAndModes: Token created successfully",{tokenId:b.id,displayName:b.displayName,resolvedValueTypeId:b.resolvedValueTypeId,modeIds:(k=b.valuesByMode[0])==null?void 0:k.modeIds,value:(A=b.valuesByMode[0])==null?void 0:A.value,taxonomiesCount:b.taxonomies.length,generatedByAlgorithm:b.generatedByAlgorithm,algorithmId:b.algorithmId}),b}static executeAlgorithmSteps(e,r,n){console.log("âš™ï¸ TokenGenerationService.executeAlgorithmSteps: Starting algorithm execution",{algorithmId:e.id,algorithmName:e.name,iterationValue:r,modeContext:n,stepsCount:e.steps.length,variablesCount:e.variables.length});try{console.log("ðŸ”§ TokenGenerationService.executeAlgorithmSteps: Calling AlgorithmExecutionService.executeAlgorithm");const s=Ia.executeAlgorithm(e,r,{},n);console.log("âœ… TokenGenerationService.executeAlgorithmSteps: Algorithm execution completed",{finalResult:s.finalResult,finalResultType:typeof s.finalResult,variables:s.variables,results:s.results});const i=s.finalResult;if(typeof i=="number"&&!isNaN(i))return console.log("âœ… TokenGenerationService.executeAlgorithmSteps: Valid numeric result",{result:i}),i;if(typeof i=="string"){const l=parseFloat(i);if(!isNaN(l))return console.log("âœ… TokenGenerationService.executeAlgorithmSteps: Parsed string result to number",{originalResult:i,parsedResult:l}),l}const a=`Algorithm execution did not produce a valid number. Got: ${typeof i} ${i}`;throw console.error("âŒ TokenGenerationService.executeAlgorithmSteps:",a,{result:i,resultType:typeof i,executionContext:s}),new Error(a)}catch(s){const i=`Algorithm execution failed: ${s}`;throw console.error("âŒ TokenGenerationService.executeAlgorithmSteps:",i,{error:s,stack:s instanceof Error?s.stack:void 0,algorithmId:e.id,iterationValue:r,modeContext:n}),new Error(i)}}static evaluateFormulaWithContext(e,r){try{const n=Ia.evaluateFormula(e,r);if(typeof n=="number"&&!isNaN(n))return n;if(typeof n=="string"){const s=parseFloat(n);if(!isNaN(s))return s}throw new Error(`Formula "${e.name}" must evaluate to a valid number`)}catch(n){throw new Error(`Formula "${e.name}" evaluation failed: ${n}`)}}static evaluateConditionWithContext(e,r){try{return Ia.evaluateCondition(e,r)}catch(n){throw new Error(`Condition "${e.name}" evaluation failed: ${n}`)}}}class Wl{static findTokensByAlgorithm(e,r){return r.filter(n=>n.generatedByAlgorithm===!0&&n.algorithmId===e)}static evaluateFormula(e,r,n,s={}){try{const i={n,...s,...r.reduce((a,l)=>(a[l.name]=this.parseVariableValue(l.defaultValue||"",l.type),a),{})};return Ia.evaluateFormula(e,i)}catch(i){throw console.error("Formula evaluation error:",i),new Error(`Formula evaluation failed: ${i}`)}}static parseVariableValue(e,r){switch(r){case"number":return Number(e)||0;case"string":return String(e);case"boolean":return e==="true"||e==="1";default:return e}}static calculateTokenValues(e,r){var a;const n=new Map;if(!((a=e.tokenGeneration)!=null&&a.enabled))return n;const s=this.findTokensByAlgorithm(e.id,r),i=Ia.generateTokensForAlgorithm(e);return s.forEach(l=>{var c,d,u;try{const m=i.find(g=>g.tokenId===l.id);if(m){const g=((c=l.valuesByMode[0])==null?void 0:c.value)||{value:""},y=this.valuesAreDifferent(g,m.value),v={tokenId:l.id,originalValue:g,calculatedValue:m.value,hasChanges:y,iterationValue:m.iterationValue,affectedFormulas:[m.formulaName]};n.set(l.id,v)}else n.set(l.id,{tokenId:l.id,originalValue:((d=l.valuesByMode[0])==null?void 0:d.value)||{value:""},calculatedValue:{value:""},hasChanges:!1,iterationValue:0,error:"Token not found in algorithm execution results"})}catch(m){console.error(`Error processing token ${l.id}:`,m),n.set(l.id,{tokenId:l.id,originalValue:((u=l.valuesByMode[0])==null?void 0:u.value)||{value:""},calculatedValue:{value:""},hasChanges:!1,iterationValue:0,error:`Calculation failed: ${m}`})}}),n}static executeAlgorithmSteps(e,r){return Ia.executeAlgorithm(e,r).finalResult}static valuesAreDifferent(e,r){return"tokenId"in e&&"tokenId"in r?e.tokenId!==r.tokenId:"value"in e&&"value"in r?e.value!==r.value:!0}static calculateValueDifference(e,r){if("value"in e&&"value"in r){const n=Number(e.value)||0,s=Number(r.value)||0;return Math.abs(n-s)}return 1/0}static analyzeFormulaDependencies(e,r){const n=[],s=this.findTokensByAlgorithm(e.id,r);return e.formulas.forEach(i=>{const a=this.extractVariableDependencies(i.expressions.javascript.value),l=s.map(c=>c.id);n.push({formulaId:i.id,formulaName:i.name,affectedTokens:l,dependencies:a})}),n}static extractVariableDependencies(e){const r=[],n=/\b[a-zA-Z_$][a-zA-Z0-9_$]*\b/g,s=e.match(n)||[],i=["Math","sin","cos","tan","sqrt","pow","abs","round","floor","ceil","max","min"],a=["n"];return s.forEach(l=>{!i.includes(l)&&!a.includes(l)&&r.push(l)}),[...new Set(r)]}static getTokensForFormulaRecalculation(e,r,n){const i=this.analyzeFormulaDependencies(r,n).find(a=>a.formulaId===e);return(i==null?void 0:i.affectedTokens)||[]}static calculateTokenValuesSelective(e,r,n){var c;const s=new Map;if(!((c=e.tokenGeneration)!=null&&c.enabled))return s;const i=this.findTokensByAlgorithm(e.id,r),a=n?i.filter(d=>n.flatMap(m=>this.getTokensForFormulaRecalculation(m,e,r)).includes(d.id)):i,l=Ia.generateTokensForAlgorithm(e);return a.forEach(d=>{var u,m,g;try{const y=l.find(v=>v.tokenId===d.id);if(y){const v=((u=d.valuesByMode[0])==null?void 0:u.value)||{value:""},I=this.valuesAreDifferent(v,y.value),S={tokenId:d.id,originalValue:v,calculatedValue:y.value,hasChanges:I,iterationValue:y.iterationValue,affectedFormulas:n||[y.formulaName]};s.set(d.id,S)}else s.set(d.id,{tokenId:d.id,originalValue:((m=d.valuesByMode[0])==null?void 0:m.value)||{value:""},calculatedValue:{value:""},hasChanges:!1,iterationValue:0,error:"Token not found in algorithm execution results",affectedFormulas:n||[]})}catch(y){console.error(`Error processing token ${d.id}:`,y),s.set(d.id,{tokenId:d.id,originalValue:((g=d.valuesByMode[0])==null?void 0:g.value)||{value:""},calculatedValue:{value:""},hasChanges:!1,iterationValue:0,error:`Calculation failed: ${y}`,affectedFormulas:n||[]})}}),s}}class Xs{static saveToHistory(e,r,n){try{const s=this.getHistory(),i={id:this.generateId(),timestamp:Date.now(),algorithm:JSON.parse(JSON.stringify(e)),description:r,type:n};s.unshift(i),s.length>this.MAX_HISTORY_SIZE&&s.splice(this.MAX_HISTORY_SIZE),this.saveHistory(s)}catch(s){console.error("Failed to save algorithm to history:",s)}}static getHistory(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load algorithm history:",e),[]}}static getHistoryForAlgorithm(e){return this.getHistory().filter(r=>r.algorithm.id===e)}static getLatestEntry(e){const r=this.getHistoryForAlgorithm(e);return r.length>0?r[0]:null}static getPreviousEntry(e){const r=this.getHistoryForAlgorithm(e);return r.length>1?r[1]:null}static canUndo(e){return this.getHistoryForAlgorithm(e).length>1}static canRedo(e){return this.getRedoStack(e).length>0}static undo(e){try{const r=this.getHistoryForAlgorithm(e);if(r.length<=1)return null;const n=r[0],s=r[1];this.addToRedoStack(e,n);const a=this.getHistory().filter(l=>!(l.algorithm.id===e&&l.timestamp===n.timestamp));return this.saveHistory(a),s.algorithm}catch(r){return console.error("Failed to undo algorithm change:",r),null}}static redo(e){try{const r=this.getRedoStack(e);if(r.length===0)return null;const n=r.pop(),s=this.getHistory();return s.unshift(n),this.saveHistory(s),this.saveRedoStack(e,r),n.algorithm}catch(r){return console.error("Failed to redo algorithm change:",r),null}}static clearHistory(e){try{const n=this.getHistory().filter(s=>s.algorithm.id!==e);this.saveHistory(n),this.clearRedoStack(e)}catch(r){console.error("Failed to clear algorithm history:",r)}}static clearAllHistory(){try{localStorage.removeItem(this.STORAGE_KEY),Object.keys(localStorage).forEach(r=>{r.startsWith("algorithm_redo_")&&localStorage.removeItem(r)})}catch(e){console.error("Failed to clear all history:",e)}}static getRedoStack(e){try{const r=localStorage.getItem(`algorithm_redo_${e}`);return r?JSON.parse(r):[]}catch(r){return console.error("Failed to load redo stack:",r),[]}}static addToRedoStack(e,r){try{const n=this.getRedoStack(e);n.push(r),this.saveRedoStack(e,n)}catch(n){console.error("Failed to add to redo stack:",n)}}static saveRedoStack(e,r){try{localStorage.setItem(`algorithm_redo_${e}`,JSON.stringify(r))}catch(n){console.error("Failed to save redo stack:",n)}}static clearRedoStack(e){try{localStorage.removeItem(`algorithm_redo_${e}`)}catch(r){console.error("Failed to clear redo stack:",r)}}static saveHistory(e){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(r){console.error("Failed to save algorithm history:",r)}}static generateId(){return`history_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}rt(Xs,"MAX_HISTORY_SIZE",50),rt(Xs,"STORAGE_KEY","algorithm_history");function NS({taxonomies:t,value:e,onChange:r,disabled:n=!1,onViewClassifications:s}){var I,S;const[i,a]=M.useState(!1),[l,c]=M.useState(""),[d,u]=M.useState(""),m=t.filter(b=>!e.some(k=>k.taxonomyId===b.id)),g=(b,k)=>{const A=t.find(T=>T.id===b);return!A||!A.terms.some(T=>T.id===k)?!1:t.some(T=>T.id===b)},y=()=>{if(l&&d){try{r([...e,{taxonomyId:l,termId:d}])}catch(b){console.error("[TaxonomyPicker] Error calling onChange:",b)}a(!1),c(""),u("")}},v=b=>{try{r(e.filter((k,A)=>A!==b))}catch(k){console.error("[TaxonomyPicker] Error calling onChange:",k)}};return t.length===0?o.jsx(z,{p:2,color:"gray.500",fontStyle:"italic",children:"Must have at least one taxonomy term"}):o.jsxs(z,{children:[!i&&o.jsx(Oe,{variant:"outline",size:"sm",onClick:()=>a(!0),isDisabled:m.length===0||n,children:"Add Taxonomy"}),i?o.jsxs(le,{spacing:2,align:"center",mb:2,children:[o.jsx(Ye,{isDisabled:n,minW:"140px",children:o.jsx(Kt,{value:l,placeholder:"Select taxonomy",onChange:b=>{c(b.target.value),u("")},isDisabled:n,size:"sm",children:m.map(b=>o.jsx("option",{value:b.id,children:b.name},b.id))})}),o.jsx(Ye,{isDisabled:!l||n,minW:"140px",children:o.jsx(Kt,{value:d,placeholder:"Select term",onChange:b=>u(b.target.value),isDisabled:!l||n,size:"sm",children:((S=(I=t.find(b=>b.id===l))==null?void 0:I.terms)==null?void 0:S.map(b=>o.jsx("option",{value:b.id,children:b.name},b.id)))||[]})}),o.jsx(Oe,{colorScheme:"blue",size:"sm",onClick:y,isDisabled:!l||!d||n,children:"Add"}),o.jsx(Oe,{variant:"ghost",size:"sm",onClick:()=>{a(!1),c(""),u("")},children:"Cancel"})]}):null,o.jsx(le,{wrap:"wrap",spacing:2,mb:2,children:e.map((b,k)=>{const A=t.find(_=>_.id===b.taxonomyId),C=A==null?void 0:A.terms.find(_=>_.id===b.termId),T=`${b.taxonomyId}-${b.termId}`,P=g(b.taxonomyId,b.termId);return o.jsxs(Xo,{placement:"top",closeOnBlur:!0,children:[o.jsx(Qo,{children:o.jsxs(Yn,{size:"md",variant:"solid",colorScheme:P?"blue":"red",m:1,tabIndex:0,children:[o.jsxs(Ni,{children:[A&&C?`${A.name}: ${C.name}`:"Unknown",!P&&o.jsx(Cn,{label:"This term is no longer valid for the current value type",children:o.jsx(On,{as:QC,ml:1,boxSize:3})})]}),!n&&o.jsx(Af,{onClick:()=>v(k)})]})}),o.jsx(Ai,{width:"300px",children:o.jsx(Pi,{p:4,children:o.jsxs(ce,{align:"stretch",spacing:3,children:[A&&o.jsxs(o.Fragment,{children:[o.jsxs(z,{children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",children:A.name}),A.description&&o.jsx(E,{fontSize:"sm",color:"gray.400",children:A.description})]}),C&&o.jsxs(z,{children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",children:C.name}),C.description&&o.jsx(E,{fontSize:"sm",color:"gray.400",children:C.description}),!P&&o.jsx(E,{fontSize:"sm",color:"red.400",mt:1,children:"This term is no longer valid for the current value type"})]})]}),o.jsx(z,{pt:2,children:o.jsx(Oe,{variant:"link",color:"blue.500",fontWeight:"semibold",tabIndex:0,_hover:{textDecoration:"underline"},onMouseDown:()=>{console.log("[TaxonomyPicker] View all classifications link mousedown"),s&&s()},children:"View all classifications"})})]})})})]},T)})})]})}const ZE=({isOpen:t,onClose:e,onSave:r,algorithm:n,tokenCalculationStates:s,existingTokens:i,resolvedValueTypes:a})=>{const{colorMode:l}=Vt(),[c,d]=M.useState([]);nr.useEffect(()=>{if(t){const k=Array.from(s.values()).filter(A=>A.hasChanges).map(A=>A.tokenId);d(k)}},[t,s]);const u=Array.from(s.values()).filter(k=>k.hasChanges),m=Array.from(s.values()).filter(k=>!k.hasChanges),g=()=>{d(u.map(k=>k.tokenId))},y=()=>{d([])},v=k=>{d(A=>A.includes(k)?A.filter(C=>C!==k):[...A,k])},I=()=>{r(c),e()},S=k=>{const A=i.find(T=>T.id===k);if(!A)return"Unknown";const C=a.find(T=>T.id===A.resolvedValueTypeId);return(C==null?void 0:C.displayName)||"Unknown"},b=k=>typeof k=="number"?k.toString():typeof k=="string"?k:typeof k=="boolean"?k?"true":"false":String(k);return o.jsxs(Zr,{isOpen:t,onClose:e,size:"xl",scrollBehavior:"inside",children:[o.jsx(Dr,{}),o.jsxs(Xr,{maxH:"90vh",children:[o.jsx(Rr,{children:o.jsxs(le,{spacing:3,children:[o.jsx(E,{children:"Save Algorithm Changes"}),o.jsxs(wt,{colorScheme:"blue",variant:"subtle",children:[u.length," tokens affected"]})]})}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(z,{p:4,borderWidth:1,borderRadius:"md",bg:l==="light"?"blue.50":"blue.900",children:[o.jsxs(E,{fontWeight:"bold",mb:2,children:["Algorithm: ",n.name]}),o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["This will update ",u.length," tokens with new calculated values based on your formula changes."]})]}),u.length>0&&o.jsxs(z,{p:3,borderWidth:1,borderRadius:"md",bg:l==="light"?"gray.50":"gray.700",children:[o.jsxs(le,{justify:"space-between",mb:3,children:[o.jsx(E,{fontWeight:"medium",children:"Select tokens to update:"}),o.jsxs(le,{spacing:2,children:[o.jsx(Oe,{size:"sm",variant:"outline",onClick:g,children:"Select All"}),o.jsx(Oe,{size:"sm",variant:"outline",onClick:y,children:"Deselect All"})]})]}),o.jsxs(E,{fontSize:"sm",color:"gray.500",children:[c.length," of ",u.length," tokens selected"]})]}),u.length>0&&o.jsxs(z,{children:[o.jsxs(E,{fontWeight:"bold",mb:3,color:"orange.600",children:["Tokens with Changes (",u.length,")"]}),o.jsx(z,{children:o.jsx(ce,{spacing:2,align:"stretch",children:u.map(k=>{const A=i.find(_=>_.id===k.tokenId);if(!A)return null;const C=c.includes(k.tokenId),T=k.originalValue&&"value"in k.originalValue?b(k.originalValue.value):"N/A",P=k.calculatedValue&&"value"in k.calculatedValue?b(k.calculatedValue.value):"N/A";return o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",borderColor:C?"blue.300":"gray.200",bg:C?l==="light"?"blue.50":"blue.900":l==="light"?"white":"gray.700",children:o.jsxs(le,{justify:"space-between",align:"start",children:[o.jsxs(ce,{align:"start",flex:1,spacing:1,children:[o.jsxs(le,{children:[o.jsx(sn,{isChecked:C,onChange:()=>v(k.tokenId)}),o.jsx(E,{fontWeight:"medium",children:A.displayName}),o.jsx(wt,{size:"sm",colorScheme:"gray",children:S(k.tokenId)})]}),o.jsxs(le,{spacing:4,fontSize:"sm",children:[o.jsxs(ce,{align:"start",spacing:0,children:[o.jsx(E,{color:"gray.500",children:"Current:"}),o.jsx(E,{fontFamily:"mono",color:"red.500",children:T})]}),o.jsx(E,{color:"gray.400",children:"â†’"}),o.jsxs(ce,{align:"start",spacing:0,children:[o.jsx(E,{color:"gray.500",children:"New:"}),o.jsx(E,{fontFamily:"mono",color:"green.500",children:P})]})]}),o.jsxs(E,{fontSize:"xs",color:"gray.500",children:["Iteration: ",k.iterationValue]})]}),o.jsx(wt,{colorScheme:"orange",variant:"subtle",children:"Changed"})]})},k.tokenId)})})})]}),m.length>0&&o.jsxs(z,{children:[o.jsxs(E,{fontWeight:"bold",mb:3,color:"green.600",children:["Tokens Unchanged (",m.length,")"]}),o.jsx(z,{children:o.jsxs(ce,{spacing:2,align:"stretch",children:[m.slice(0,5).map(k=>{const A=i.find(T=>T.id===k.tokenId);if(!A)return null;const C=k.originalValue&&"value"in k.originalValue?b(k.originalValue.value):"N/A";return o.jsx(z,{p:2,borderWidth:1,borderRadius:"md",bg:l==="light"?"gray.50":"gray.700",opacity:.7,children:o.jsxs(le,{justify:"space-between",children:[o.jsxs(ce,{align:"start",spacing:0,children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",children:A.displayName}),o.jsxs(E,{fontSize:"xs",color:"gray.500",children:[S(k.tokenId)," â€¢ ",C]})]}),o.jsx(wt,{colorScheme:"green",variant:"subtle",size:"sm",children:"Unchanged"})]})},k.tokenId)}),m.length>5&&o.jsxs(E,{fontSize:"sm",color:"gray.500",textAlign:"center",children:["... and ",m.length-5," more unchanged tokens"]})]})})]}),u.length===0&&o.jsxs(zt,{status:"info",children:[o.jsx(Lt,{}),o.jsx(E,{children:"No token values have changed. The algorithm will be saved without updating any tokens."})]})]})}),o.jsx(rn,{children:o.jsxs(le,{spacing:3,children:[o.jsx(Oe,{variant:"ghost",onClick:e,leftIcon:o.jsx(Ab,{size:16}),children:"Cancel"}),o.jsxs(Oe,{colorScheme:"blue",onClick:I,leftIcon:o.jsx(Cb,{size:16}),isDisabled:u.length===0,children:["Save Algorithm",c.length>0&&` & Update ${c.length} Tokens`]})]})})]})]})},XE=({isOpen:t,onClose:e,onReset:r,algorithm:n,hasUnsavedChanges:s})=>{const{colorMode:i}=Vt(),[a,l]=M.useState("last-save"),[c,d]=M.useState(""),u=Xs.getHistoryForAlgorithm(n.id),m=Xs.canUndo(n.id),g=Xs.canRedo(n.id),y=()=>{let S;a==="specific-history"&&c&&(S=u.find(b=>b.id===c)),r(a,S),e()},v=S=>new Date(S).toLocaleString(),I=S=>{switch(S){case"last-save":return"Revert to the last saved version of the algorithm";case"specific-history":return"Revert to a specific point in the algorithm history";case"original":return"Reset to the original algorithm state (this will clear all history)";default:return""}};return o.jsxs(Zr,{isOpen:t,onClose:e,size:"lg",children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:o.jsxs(le,{spacing:3,children:[o.jsx(vc,{size:20}),o.jsx(E,{children:"Reset Algorithm"})]})}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[s&&o.jsxs(zt,{status:"warning",children:[o.jsx(Lt,{}),o.jsx(E,{children:"You have unsaved changes. Resetting will discard these changes."})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"bold",mb:3,children:"Choose Reset Option:"}),o.jsx(Zd,{value:a,onChange:S=>l(S),children:o.jsxs(ce,{spacing:3,align:"start",children:[o.jsx(To,{value:"last-save",isDisabled:!m,children:o.jsxs(ce,{align:"start",spacing:1,children:[o.jsx(E,{fontWeight:"medium",children:"Last Saved Version"}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:I("last-save")}),!m&&o.jsx(E,{fontSize:"xs",color:"orange.500",children:"No saved history available"})]})}),o.jsx(To,{value:"specific-history",isDisabled:u.length===0,children:o.jsxs(ce,{align:"start",spacing:1,children:[o.jsx(E,{fontWeight:"medium",children:"Specific History Point"}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:I("specific-history")}),u.length===0&&o.jsx(E,{fontSize:"xs",color:"orange.500",children:"No history available"})]})}),o.jsx(To,{value:"original",children:o.jsxs(ce,{align:"start",spacing:1,children:[o.jsx(E,{fontWeight:"medium",children:"Original State"}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:I("original")})]})})]})})]}),a==="specific-history"&&u.length>0&&o.jsxs(z,{children:[o.jsx(on,{my:3}),o.jsx(E,{fontWeight:"bold",mb:3,children:"Select History Point:"}),o.jsx(z,{maxH:"200px",overflowY:"auto",borderWidth:1,borderRadius:"md",p:2,children:o.jsx(Zd,{value:c,onChange:d,children:o.jsx(ce,{spacing:2,align:"start",children:u.map(S=>o.jsx(To,{value:S.id,children:o.jsxs(ce,{align:"start",spacing:0,children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",children:S.description}),o.jsxs(E,{fontSize:"xs",color:"gray.500",children:[v(S.timestamp)," â€¢ ",S.type]})]})},S.id))})})})]}),o.jsxs(z,{p:3,bg:i==="light"?"gray.50":"gray.700",borderRadius:"md",children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:2,children:"Current Status:"}),o.jsxs(ce,{spacing:1,align:"start",children:[o.jsxs(E,{fontSize:"xs",color:"gray.500",children:["Undo available: ",m?"Yes":"No"]}),o.jsxs(E,{fontSize:"xs",color:"gray.500",children:["Redo available: ",g?"Yes":"No"]}),o.jsxs(E,{fontSize:"xs",color:"gray.500",children:["History entries: ",u.length]})]})]})]})}),o.jsx(rn,{children:o.jsxs(le,{spacing:3,children:[o.jsx(Oe,{variant:"ghost",onClick:e,children:"Cancel"}),o.jsx(Oe,{colorScheme:"red",onClick:y,leftIcon:o.jsx(vc,{size:16}),isDisabled:a==="last-save"&&!m||a==="specific-history"&&(!c||u.length===0),children:"Reset Algorithm"})]})})]})]})};class zd{static analyzeFormulaDependencies(e){const r=[],n=[],s={},i=Kn.getSystemVariables(),a=new Set(["n",...i.map(c=>c.name)]);e.variables.forEach(c=>{s[c.name]={formulas:[],conditions:[],isSystemVariable:!1}}),a.forEach(c=>{s[c]={formulas:[],conditions:[],isSystemVariable:!0}}),e.formulas.forEach(c=>{const d=this.extractVariableDependencies(c.expressions.javascript.value,c.expressions.ast);d.forEach(g=>{s[g]&&s[g].formulas.push(c.id)});const u={id:c.id,name:c.name,type:"formula",inputs:d,outputs:[],dependencies:[],stepIndex:e.steps.findIndex(g=>g.id===c.id)},m=this.extractOutputVariables(c.expressions.javascript.value);u.outputs=m,r.push(u)}),e.conditions.forEach(c=>{const d=this.extractVariableDependencies(c.expression);d.forEach(m=>{s[m]&&s[m].conditions.push(c.id)});const u={id:c.id,name:c.name,type:"condition",inputs:d,outputs:[],dependencies:[],stepIndex:e.steps.findIndex(m=>m.id===c.id)};r.push(u)}),r.forEach(c=>{c.inputs.forEach(d=>{r.filter(m=>m.type==="formula"&&m.outputs.includes(d)).forEach(m=>{m.stepIndex!==void 0&&c.stepIndex!==void 0&&m.stepIndex<c.stepIndex&&(n.push({source:m.id,target:c.id,type:"formula",variableName:d}),c.dependencies.push(m.id))})})});const l=e.steps.map(c=>c.id);return{nodes:r,edges:n,executionOrder:l,variableUsage:s}}static getVariableUsage(e){return this.extractVariableDependencies(e.expressions.javascript.value,e.expressions.ast)}static validateFormulaDependencies(e){const r=[],n=this.analyzeFormulaDependencies(e),s=Kn.getSystemVariables(),i=new Set(["n",...s.map(l=>l.name)]);return n.nodes.forEach(l=>{l.inputs.forEach(c=>{const d=e.variables.some(m=>m.name===c),u=i.has(c);!d&&!u&&r.push({type:"error",message:`Undefined variable '${c}' used in ${l.type} '${l.name}'`,formulaId:l.type==="formula"?l.id:void 0,conditionId:l.type==="condition"?l.id:void 0,variableName:c})})}),this.detectCircularDependencies(n).forEach(l=>{r.push({type:"error",message:`Circular dependency detected: ${l.join(" -> ")}`,formulaId:l[0]})}),e.variables.forEach(l=>{const c=n.variableUsage[l.name];(!c||c.formulas.length===0&&c.conditions.length===0)&&r.push({type:"warning",message:`Variable '${l.name}' is defined but never used`,variableName:l.name})}),r}static generateExecutionTrace(e,r={}){const n=Date.now(),s=[],i=[];let a=null;try{const l=Kn.getSystemVariables(),c={...r,n:r.n||0};l.forEach(d=>{d.name in c||(c[d.name]=this.parseVariableValue(d.defaultValue||"",d.type))}),e.variables.forEach(d=>{d.name in c||(c[d.name]=this.parseVariableValue(d.defaultValue||"",d.type))}),e.steps.forEach((d,u)=>{var v,I,S;const m=Date.now();let g=null,y;try{if(d.type==="formula"){const A=e.formulas.find(C=>C.id===d.id);A&&(g=this.evaluateFormula(A,c),a=g)}else if(d.type==="condition"){const A=e.conditions.find(C=>C.id===d.id);A&&(g=this.evaluateCondition(A,c))}const b=Date.now(),k=d.type==="formula"?this.extractVariableDependencies(((v=e.formulas.find(A=>A.id===d.id))==null?void 0:v.expressions.javascript.value)||"",(I=e.formulas.find(A=>A.id===d.id))==null?void 0:I.expressions.ast):this.extractVariableDependencies(((S=e.conditions.find(A=>A.id===d.id))==null?void 0:S.expression)||"");s.push({stepId:d.id,stepName:d.name,stepType:d.type,inputValues:{...c},outputValue:g,error:y,executionTime:b-m,dependencies:k})}catch(b){y=b instanceof Error?b.message:String(b),i.push(`Step ${u+1} (${d.name}): ${y}`),s.push({stepId:d.id,stepName:d.name,stepType:d.type,inputValues:{...c},outputValue:null,error:y,executionTime:Date.now()-m,dependencies:[]})}})}catch(l){i.push(`Execution failed: ${l instanceof Error?l.message:String(l)}`)}return{steps:s,finalResult:a,errors:i,executionTime:Date.now()-n}}static extractVariableDependencies(e,r){if(r)return Is.extractVariables(r);const n=/\b[a-zA-Z_][a-zA-Z0-9_]*\b/g,s=e.match(n)||[],i=["Math","Array","console","function","return","if","else","for","while","var","let","const"],a=s.filter(l=>!i.includes(l));return[...new Set(a)]}static extractOutputVariables(e){const r=[],n=/^([a-zA-Z_$][a-zA-Z0-9_$]*)\s*=/,s=e.match(n);return s&&r.push(s[1]),r}static detectCircularDependencies(e){const r=[],n=new Set,s=new Set,i=(a,l)=>{if(s.has(a)){const d=l.indexOf(a);r.push(l.slice(d));return}if(n.has(a))return;n.add(a),s.add(a);const c=e.nodes.find(d=>d.id===a);c&&c.dependencies.forEach(d=>{i(d,[...l,a])}),s.delete(a)};return e.nodes.forEach(a=>{n.has(a.id)||i(a.id,[])}),r}static parseVariableValue(e,r){switch(r){case"number":return Number(e)||0;case"string":return e;case"boolean":return e.toLowerCase()==="true";case"color":return e;default:return e}}static evaluateFormula(e,r){try{const n=e.expressions.javascript.value,s=Object.keys(r),i=Object.values(r);return new Function(...s,`return ${n}`)(...i)}catch(n){throw new Error(`Formula evaluation failed for ${e.name}: ${n}`)}}static evaluateCondition(e,r){try{const n=e.expression,s=Object.keys(r),i=Object.values(r);return!!new Function(...s,`return ${n}`)(...i)}catch(n){throw new Error(`Condition evaluation failed for ${e.name}: ${n}`)}}}const QE=({algorithm:t,showValidation:e=!0,showExecutionTrace:r=!1,executionContext:n={}})=>{const s=M.useMemo(()=>zd.analyzeFormulaDependencies(t),[t]),i=M.useMemo(()=>e?zd.validateFormulaDependencies(t):[],[t,e]),a=M.useMemo(()=>r?zd.generateExecutionTrace(t,n):null,[t,r,n]),l=u=>u==="formula"?"purple":"green",c=u=>{switch(u){case"error":return Ro;case"warning":return Ro;case"info":return Ny;default:return Ny}},d=u=>{switch(u){case"error":return"red";case"warning":return"orange";case"info":return"blue";default:return"gray"}};return o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsxs(Zn,{children:[o.jsx(ss,{children:o.jsxs(le,{children:[o.jsx(On,{as:Gf}),o.jsx(Tt,{size:"md",children:"Dependency Graph"})]})}),o.jsx(Xn,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(Qs,{columns:2,spacing:4,children:[o.jsxs(z,{children:[o.jsxs(E,{fontWeight:"bold",mb:2,children:["Formulas (",s.nodes.filter(u=>u.type==="formula").length,")"]}),o.jsx(ce,{align:"start",spacing:1,children:s.nodes.filter(u=>u.type==="formula").map(u=>o.jsxs(le,{spacing:2,children:[o.jsx(wt,{colorScheme:l(u.type),size:"sm",children:u.type}),o.jsx(E,{fontSize:"sm",children:u.name}),u.inputs.length>0&&o.jsx(Cn,{label:`Uses: ${u.inputs.join(", ")}`,children:o.jsxs(wt,{size:"sm",colorScheme:"blue",variant:"outline",children:[u.inputs.length," inputs"]})})]},u.id))})]}),o.jsxs(z,{children:[o.jsxs(E,{fontWeight:"bold",mb:2,children:["Conditions (",s.nodes.filter(u=>u.type==="condition").length,")"]}),o.jsx(ce,{align:"start",spacing:1,children:s.nodes.filter(u=>u.type==="condition").map(u=>o.jsxs(le,{spacing:2,children:[o.jsx(wt,{colorScheme:l(u.type),size:"sm",children:u.type}),o.jsx(E,{fontSize:"sm",children:u.name}),u.inputs.length>0&&o.jsx(Cn,{label:`Uses: ${u.inputs.join(", ")}`,children:o.jsxs(wt,{size:"sm",colorScheme:"blue",variant:"outline",children:[u.inputs.length," inputs"]})})]},u.id))})]})]}),o.jsx(on,{}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"bold",mb:2,children:"Execution Order"}),o.jsx(le,{spacing:2,flexWrap:"wrap",children:s.executionOrder.map((u,m)=>{const g=s.nodes.find(y=>y.id===u);return g?o.jsxs(le,{spacing:1,children:[o.jsx(wt,{colorScheme:"gray",size:"sm",children:m+1}),o.jsx(wt,{colorScheme:l(g.type),size:"sm",children:g.type}),o.jsx(E,{fontSize:"sm",children:g.name}),m<s.executionOrder.length-1&&o.jsx(On,{as:My,size:16})]},u):null})})]}),s.edges.length>0&&o.jsxs(o.Fragment,{children:[o.jsx(on,{}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"bold",mb:2,children:"Dependencies"}),o.jsx(ce,{align:"start",spacing:1,children:s.edges.map((u,m)=>{const g=s.nodes.find(v=>v.id===u.source),y=s.nodes.find(v=>v.id===u.target);return!g||!y?null:o.jsxs(le,{spacing:2,children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",children:g.name}),o.jsx(On,{as:My,size:14}),o.jsx(E,{fontSize:"sm",fontWeight:"medium",children:y.name}),u.variableName&&o.jsx(Cn,{label:`Via variable: ${u.variableName}`,children:o.jsx(wt,{size:"sm",colorScheme:"teal",variant:"outline",children:u.variableName})})]},m)})})]})]})]})})]}),o.jsxs(Zn,{children:[o.jsx(ss,{children:o.jsxs(le,{children:[o.jsx(On,{as:bu}),o.jsx(Tt,{size:"md",children:"Variable Usage"})]})}),o.jsx(Xn,{children:o.jsx(Qs,{columns:2,spacing:4,children:Object.entries(s.variableUsage).map(([u,m])=>o.jsxs(z,{p:3,borderWidth:1,borderRadius:"md",children:[o.jsxs(le,{justify:"space-between",mb:2,children:[o.jsx(E,{fontWeight:"bold",children:u}),m.isSystemVariable&&o.jsx(wt,{size:"sm",colorScheme:"green",children:"System"})]}),m.formulas.length>0&&o.jsxs(E,{fontSize:"sm",color:"gray.500",children:["Used by ",m.formulas.length," formula",m.formulas.length!==1?"s":""]}),m.conditions.length>0&&o.jsxs(E,{fontSize:"sm",color:"gray.500",children:["Used by ",m.conditions.length," condition",m.conditions.length!==1?"s":""]})]},u))})})]}),e&&i.length>0&&o.jsxs(Zn,{children:[o.jsx(ss,{children:o.jsxs(le,{children:[o.jsx(On,{as:t6}),o.jsx(Tt,{size:"md",children:"Validation Results"})]})}),o.jsx(Xn,{children:o.jsx(ce,{spacing:3,align:"stretch",children:i.map((u,m)=>o.jsxs(zt,{status:u.type==="error"?"error":u.type==="warning"?"warning":"info",children:[o.jsx(Lt,{as:c(u.type)}),o.jsxs(tn,{children:[u.message,u.formulaId&&o.jsx(wt,{ml:2,colorScheme:d(u.type),size:"sm",children:"Formula"}),u.conditionId&&o.jsx(wt,{ml:2,colorScheme:d(u.type),size:"sm",children:"Condition"})]})]},m))})})]}),r&&a&&o.jsxs(Zn,{children:[o.jsx(ss,{children:o.jsxs(le,{children:[o.jsx(On,{as:xb}),o.jsx(Tt,{size:"md",children:"Execution Trace"})]})}),o.jsx(Xn,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[a.errors.length>0&&o.jsxs(zt,{status:"error",children:[o.jsx(Lt,{}),o.jsxs(tn,{children:[a.errors.length," error",a.errors.length!==1?"s":""," occurred during execution"]})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"bold",mb:2,children:"Execution Steps"}),o.jsx(ce,{spacing:2,align:"stretch",children:a.steps.map((u,m)=>o.jsxs(z,{p:3,borderWidth:1,borderRadius:"md",children:[o.jsxs(le,{justify:"space-between",mb:2,children:[o.jsxs(le,{children:[o.jsx(wt,{colorScheme:"gray",size:"sm",children:m+1}),o.jsx(wt,{colorScheme:l(u.stepType),size:"sm",children:u.stepType}),o.jsx(E,{fontWeight:"medium",children:u.stepName})]}),o.jsxs(E,{fontSize:"sm",color:"gray.500",children:[u.executionTime,"ms"]})]}),u.error?o.jsxs(zt,{status:"error",size:"sm",children:[o.jsx(Lt,{}),o.jsx(tn,{children:u.error})]}):o.jsxs(ce,{align:"start",spacing:1,children:[o.jsxs(E,{fontSize:"sm",children:[o.jsx("strong",{children:"Output:"})," ",String(u.outputValue)]}),u.dependencies.length>0&&o.jsxs(E,{fontSize:"sm",children:[o.jsx("strong",{children:"Dependencies:"})," ",u.dependencies.join(", ")]})]})]},u.stepId))})]}),o.jsx(on,{}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"bold",children:"Final Result"}),o.jsx(E,{children:String(a.finalResult)}),o.jsxs(E,{fontSize:"sm",color:"gray.500",mt:1,children:["Total execution time: ",a.executionTime,"ms"]})]})]})})]})]})},eM=({algorithm:t,onExecutionComplete:e})=>{const{colorMode:r}=Vt(),[n,s]=M.useState({}),[i,a]=M.useState(null),[l,c]=M.useState(!1),[d,u]=M.useState(-1),[m,g]=M.useState([]);M.useEffect(()=>{(()=>{const _=Kn.getSystemVariables(),R=[{id:"system_n",name:"n",type:"number",defaultValue:"0"},..._];g(R)})()},[]);const y=t.steps.length,v=y>0,I=()=>{c(!0);try{const P=zd.generateExecutionTrace(t,n);a(P),u(P.steps.length-1),e==null||e(P)}catch(P){console.error("Execution failed:",P)}finally{c(!1)}},S=()=>{d<y-1&&u(P=>P+1)},b=()=>{u(-1),a(null)},k=(P,_)=>{s(R=>({...R,[P]:_}))},A=P=>{var _;return!i||P>d?"pending":(_=i.steps[P])!=null&&_.error?"error":"completed"},C=P=>{switch(P){case"completed":return"green";case"error":return"red";case"pending":return"gray";default:return"gray"}},T=P=>P==null?"undefined":typeof P=="object"?JSON.stringify(P):String(P);return o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsxs(Zn,{children:[o.jsx(ss,{children:o.jsxs(le,{children:[o.jsx(On,{as:Dy}),o.jsx(Tt,{size:"md",children:"Execution Preview"})]})}),o.jsx(Xn,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(z,{children:[o.jsx(E,{fontWeight:"bold",mb:3,children:"Execution Context"}),o.jsxs(ce,{spacing:3,align:"stretch",children:[m.map(P=>o.jsxs(Ye,{children:[o.jsxs(Qe,{children:[P.name," (",P.type,")",P.id==="system_n"&&o.jsx(wt,{ml:2,size:"sm",colorScheme:"green",children:"Built-in"}),P.id!=="system_n"&&P.id.startsWith("system-")&&o.jsx(wt,{ml:2,size:"sm",colorScheme:"blue",children:"System"})]}),P.type==="number"?o.jsxs(Wm,{value:n[P.name]||Number(P.defaultValue)||0,onChange:(_,R)=>k(P.name,R),min:-10,max:100,children:[o.jsx(qm,{}),o.jsxs(Jm,{children:[o.jsx(Ym,{}),o.jsx(Km,{})]})]}):o.jsx(yt,{value:n[P.name]||P.defaultValue||"",onChange:_=>k(P.name,_.target.value),placeholder:`Enter ${P.name}`})]},P.id)),t.variables.map(P=>o.jsxs(Ye,{children:[o.jsxs(Qe,{children:[P.name," (",P.type,")"]}),P.type==="number"?o.jsxs(Wm,{value:n[P.name]||Number(P.defaultValue)||0,onChange:(_,R)=>k(P.name,R),children:[o.jsx(qm,{}),o.jsxs(Jm,{children:[o.jsx(Ym,{}),o.jsx(Km,{})]})]}):o.jsx(yt,{value:n[P.name]||P.defaultValue||"",onChange:_=>k(P.name,_.target.value),placeholder:`Enter ${P.name}`})]},P.id))]})]}),o.jsxs(le,{spacing:3,children:[o.jsx(Oe,{leftIcon:o.jsx(Dy,{size:16}),colorScheme:"green",onClick:I,isLoading:l,isDisabled:!v,children:"Run Execution"}),o.jsx(Oe,{leftIcon:o.jsx(Tk,{size:16}),onClick:S,isDisabled:d>=y||!i,children:"Step Forward"}),o.jsx(Oe,{leftIcon:o.jsx(vc,{size:16}),onClick:b,variant:"outline",children:"Reset"})]}),v&&o.jsxs(z,{children:[o.jsxs(E,{fontSize:"sm",color:"gray.500",mb:2,children:["Progress: ",d," / ",y," steps"]}),o.jsx(z,{w:"100%",h:2,bg:r==="light"?"gray.200":"gray.700",borderRadius:"full",overflow:"hidden",children:o.jsx(z,{h:"100%",bg:"blue.500",w:`${d/y*100}%`,transition:"width 0.3s ease"})})]})]})})]}),i&&o.jsxs(Zn,{children:[o.jsx(ss,{children:o.jsxs(le,{children:[o.jsx(On,{as:xb}),o.jsx(Tt,{size:"md",children:"Execution Steps"}),i.errors.length>0&&o.jsxs(wt,{colorScheme:"red",size:"sm",children:[i.errors.length," Error",i.errors.length!==1?"s":""]})]})}),o.jsx(Xn,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(z,{p:3,bg:r==="light"?"gray.50":"gray.700",borderRadius:"md",children:[o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{fontWeight:"bold",children:"Execution Summary"}),o.jsxs(le,{children:[o.jsx(On,{as:Py,size:14}),o.jsxs(E,{fontSize:"sm",children:[i.executionTime,"ms"]})]})]}),o.jsxs(E,{fontSize:"sm",color:"gray.500",mt:1,children:["Final Result: ",T(i.finalResult)]})]}),o.jsx(ce,{spacing:3,align:"stretch",children:i.steps.map((P,_)=>{const R=A(_),G=_<=d;return o.jsxs(z,{p:4,borderWidth:1,borderRadius:"md",opacity:G?1:.5,transition:"opacity 0.3s ease",children:[o.jsxs(le,{justify:"space-between",mb:3,children:[o.jsxs(le,{children:[o.jsx(wt,{colorScheme:"gray",size:"sm",children:_+1}),o.jsx(wt,{colorScheme:C(R),size:"sm",children:P.stepType}),o.jsx(E,{fontWeight:"medium",children:P.stepName})]}),o.jsxs(le,{children:[o.jsx(On,{as:Py,size:14}),o.jsxs(E,{fontSize:"sm",children:[P.executionTime,"ms"]})]})]}),G&&o.jsxs(ce,{spacing:3,align:"stretch",children:[o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:2,children:"Input Values"}),o.jsx(le,{spacing:2,flexWrap:"wrap",children:Object.entries(P.inputValues).map(([ne,he])=>o.jsx(wt,{size:"sm",colorScheme:"blue",variant:"outline",children:o.jsxs(le,{spacing:1,children:[o.jsx(On,{as:bu,size:10}),o.jsxs(E,{children:[ne,": ",T(he)]})]})},ne))})]}),o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:2,children:"Output"}),P.error?o.jsxs(zt,{status:"error",size:"sm",children:[o.jsx(Lt,{as:Ro}),o.jsx(tn,{children:P.error})]}):o.jsx(E,{fontSize:"sm",p:2,bg:r==="light"?"green.50":"green.900",borderRadius:"md",children:T(P.outputValue)})]}),P.dependencies.length>0&&o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:2,children:"Dependencies"}),o.jsx(le,{spacing:2,flexWrap:"wrap",children:P.dependencies.map(ne=>o.jsx(wt,{size:"sm",colorScheme:"purple",variant:"outline",children:o.jsxs(le,{spacing:1,children:[o.jsx(On,{as:bu,size:10}),o.jsx(E,{children:ne})]})},ne))})]})]})]},P.stepId)})}),i.errors.length>0&&o.jsxs(zt,{status:"error",children:[o.jsx(Lt,{}),o.jsxs(tn,{children:[i.errors.length," error",i.errors.length!==1?"s":""," occurred during execution"]})]})]})})]})]})},tM=({isOpen:t,onClose:e,onConfirm:r,algorithm:n})=>{const{colorMode:s}=Vt(),[i,a]=M.useState([]),[l,c]=M.useState({});M.useEffect(()=>{if(!t)return;const S=L.getDimensions(),b=n.variables||[],k=Kn.getSystemVariables(),C=[...b,...k].filter(R=>R.modeBased&&R.dimensionId);if(C.length===0){r({});return}const T=S.filter(R=>C.some(G=>G.dimensionId===R.id)),P=[];T.forEach(R=>{R.modes.forEach(G=>{P.push({dimensionId:R.id,dimensionName:R.displayName,modeId:G.id,modeName:G.name,isSelected:!0})})}),a(P);const _={};T.forEach(R=>{_[R.id]=R.modes.map(G=>G.id)}),c(_)},[t,n,r]);const d=(S,b,k)=>{c(A=>{const C=A[S]||[];return k?{...A,[S]:[...C,b]}:{...A,[S]:C.filter(T=>T!==b)}}),a(A=>A.map(C=>C.dimensionId===S&&C.modeId===b?{...C,isSelected:k}:C))},u=S=>{const k=i.filter(A=>A.dimensionId===S).map(A=>A.modeId);c(A=>({...A,[S]:k})),a(A=>A.map(C=>C.dimensionId===S?{...C,isSelected:!0}:C))},m=S=>{c(b=>({...b,[S]:[]})),a(b=>b.map(k=>k.dimensionId===S?{...k,isSelected:!1}:k))},g=()=>{const S={};Object.entries(l).forEach(([b,k])=>{k.length>0&&(S[b]=k)}),r(S),e()},y=()=>{e()},v=i.reduce((S,b)=>(S[b.dimensionId]||(S[b.dimensionId]={dimensionName:b.dimensionName,options:[]}),S[b.dimensionId].options.push(b),S),{}),I=Object.values(l).reduce((S,b)=>S*Math.max(b.length,1),1);return o.jsxs(Zr,{isOpen:t,onClose:e,size:"lg",children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:"Select Modes for Token Generation"}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(zt,{status:"info",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(tn,{children:["Your algorithm contains mode-based variables. Select which modes to generate tokens for.",I>1&&o.jsxs(E,{mt:2,fontWeight:"bold",children:["This will generate ",I," tokens per iteration."]})]})]}),Object.entries(v).map(([S,b])=>{var C;const k=((C=l[S])==null?void 0:C.length)||0,A=b.options.length;return o.jsxs(z,{p:4,borderWidth:1,borderRadius:"md",bg:s==="dark"?"gray.800":"gray.50",children:[o.jsxs(le,{justify:"space-between",mb:3,children:[o.jsx(E,{fontWeight:"bold",children:b.dimensionName}),o.jsxs(le,{spacing:2,children:[o.jsxs(wt,{colorScheme:"blue",children:[k,"/",A," selected"]}),o.jsx(Oe,{size:"xs",onClick:()=>u(S),children:"Select All"}),o.jsx(Oe,{size:"xs",onClick:()=>m(S),children:"Deselect All"})]})]}),o.jsx(ce,{spacing:2,align:"stretch",children:b.options.map(T=>o.jsx(sn,{isChecked:T.isSelected,onChange:P=>d(S,T.modeId,P.target.checked),children:o.jsxs(le,{children:[o.jsx(E,{children:T.modeName}),o.jsx(wt,{size:"sm",colorScheme:"gray",variant:"outline",children:T.modeId})]})},T.modeId))})]},S)})]})}),o.jsx(rn,{children:o.jsxs(le,{spacing:3,children:[o.jsx(Oe,{onClick:y,children:"Cancel"}),o.jsxs(Oe,{colorScheme:"blue",onClick:g,children:["Generate Tokens (",I," per iteration)"]})]})})]})]})},yd={id:ji("algorithm"),name:"New Algorithm",resolvedValueTypeId:"color",variables:[],formulas:[],conditions:[],steps:[],tokenGeneration:{enabled:!1,iterationRange:{start:-2,end:8,step:1},bulkAssignments:{resolvedValueTypeId:"color",taxonomies:[],tokenTier:"PRIMITIVE",private:!1,status:"stable",themeable:!1},logicalMapping:{scaleType:"numeric",defaultValue:"100",increasingStep:100,decreasingStep:25,extraPrefix:"X",incrementDirection:"ascending",taxonomyId:void 0,newTaxonomyName:void 0}}},rM=({algorithm:t=yd,onSave:e=()=>{},onUpdateTokens:r=()=>{}})=>{var We,lt,Et,et,pt,Wt,In,Mn,An,ts,jn,Be,w,N,Le,V,ae,er,it,Ar,yn,kt,sr,Re,Ge,q,bt,pe;const{colorMode:n}=Vt(),s=Hr(),[i,a]=M.useState(()=>t?{...t}:yd);M.useEffect(()=>{a(t?{...t}:yd)},[t]);const[l,c]=nr.useState({name:"",type:"number",defaultValue:""}),[d,u]=nr.useState({type:"formula",id:"",name:""}),[m,g]=M.useState(null),[y,v]=M.useState({}),[I,S]=M.useState([]),[b,k]=M.useState([]),[A,C]=M.useState([]),[T,P]=M.useState(!1),[_,R]=M.useState(new Map),[G,ne]=M.useState([]),[he,te]=M.useState([]),[K,O]=M.useState(!1),[Z,ie]=M.useState(!1),[ge,xe]=M.useState(!1),[$,B]=M.useState(null),[U,X]=M.useState(!1),[ee,be]=M.useState({}),[Se,Me]=M.useState(!1),[se,de]=M.useState([]),[fe,_e]=M.useState([]),[Y,Ce]=M.useState([]),[ue,Ee]=M.useState(!1);M.useEffect(()=>{if($){const me=JSON.stringify(i)!==JSON.stringify($);xe(me)}},[i,$]),M.useEffect(()=>{t&&B({...t})},[t]),M.useEffect(()=>{const me=()=>{var nt,Xe;const ke=L.getTaxonomies(),qe=(Xe=(nt=i.tokenGeneration)==null?void 0:nt.bulkAssignments)==null?void 0:Xe.resolvedValueTypeId;if(qe){const Mt=ke.filter(Xt=>Array.isArray(Xt.resolvedValueTypeIds)&&Xt.resolvedValueTypeIds.includes(qe));de(Mt)}else de([])};return me(),window.addEventListener("focus",me),()=>{window.removeEventListener("focus",me)}},[(lt=(We=i.tokenGeneration)==null?void 0:We.bulkAssignments)==null?void 0:lt.resolvedValueTypeId]),M.useEffect(()=>{var ke,qe;const me=((qe=(ke=i.tokenGeneration)==null?void 0:ke.bulkAssignments)==null?void 0:qe.taxonomies)||[];_e(me)},[(et=(Et=i.tokenGeneration)==null?void 0:Et.bulkAssignments)==null?void 0:et.taxonomies]),M.useEffect(()=>{const me=L.getValueTypes();Ce(me),me.length>0&&a(ke=>me.some(nt=>nt.id===ke.resolvedValueTypeId)?ke:{...ke,resolvedValueTypeId:me[0].id})},[]),M.useEffect(()=>{var Xt;const me=i.variables||[],ke=new Set;(Xt=i.formulas)==null||Xt.forEach(Ot=>{Ot.expressions.javascript.value&&(Ot.expressions.javascript.value.match(/\b[a-zA-Z_][a-zA-Z0-9_]*\b/g)||[]).forEach(kr=>{me.some(or=>or.name===kr)||ke.add(kr)})});const nt=Kn.getSystemVariables().filter(Ot=>ke.has(Ot.name)),Mt=[...me,...nt].filter(Ot=>Ot.modeBased&&Ot.dimensionId);Me(Mt.length>0)},[i.variables,i.formulas]),M.useEffect(()=>{(()=>{var nt;const ke=L.getTokens(),qe=Wl.findTokensByAlgorithm(i.id,ke);C(qe),P(qe.length>0),qe.length>0&&!((nt=i.tokenGeneration)!=null&&nt.enabled)&&(a(Xe=>({...Xe,tokenGeneration:{enabled:!0,iterationRange:{start:-2,end:8,step:1},bulkAssignments:{resolvedValueTypeId:Xe.resolvedValueTypeId,taxonomies:[],tokenTier:"PRIMITIVE",private:!1,status:"stable",themeable:!1},logicalMapping:{scaleType:"numeric",defaultValue:"100",increasingStep:100,decreasingStep:25,extraPrefix:"X",incrementDirection:"ascending",taxonomyId:void 0,newTaxonomyName:void 0}}})),s({title:"Token Generation Auto-Enabled",description:`Found ${qe.length} existing tokens generated by this algorithm. Token generation has been enabled.`,status:"info",duration:5e3,isClosable:!0}))})()},[i.id,(pt=i.tokenGeneration)==null?void 0:pt.enabled,s]),M.useEffect(()=>{var me;if(T&&((me=i.tokenGeneration)!=null&&me.enabled)){const ke=L.getTokens(),qe=Wl.calculateTokenValues(i,ke);R(qe)}},[i,T]),M.useEffect(()=>{var me;if(T&&((me=i.tokenGeneration)!=null&&me.enabled)){const ke=setTimeout(()=>{const qe=L.getTokens(),nt=Wl.analyzeFormulaDependencies(i,qe);te(nt);const Xe=G.length>0?Wl.calculateTokenValuesSelective(i,qe,G):Wl.calculateTokenValues(i,qe);R(Xe);const Mt=Array.from(Xe.values()).filter(Xt=>Xt.hasChanges);Mt.length>0&&s({title:"Formula Changes Detected",description:`${Mt.length} tokens have updated values based on formula changes.`,status:"info",duration:3e3,isClosable:!0}),ne([])},500);return()=>clearTimeout(ke)}},[i.formulas,i.variables,i.steps,(Wt=i.tokenGeneration)==null?void 0:Wt.iterationRange,T,G]);const ze=me=>{_e(me),a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,bulkAssignments:{...ke.tokenGeneration.bulkAssignments,taxonomies:me}}}))},De=me=>{ne(ke=>[...new Set([...ke,me])])},Ke=me=>{if(!me.destination)return;const ke=Array.from(i.steps),[qe]=ke.splice(me.source.index,1);ke.splice(me.destination.index,0,qe),a(nt=>({...nt,steps:ke}))},ve=()=>{var qe;if(!((qe=l.name)!=null&&qe.trim())){s({title:"Error",description:"Please enter a variable name",status:"error",duration:3e3,isClosable:!0});return}const me={id:ji("variable"),name:l.name,type:l.type||"number",defaultValue:l.defaultValue||"",modeBased:l.modeBased,dimensionId:l.dimensionId,valuesByMode:l.valuesByMode||[]},ke={...i,variables:[...i.variables,me]};a(ke),c({name:"",type:"number",defaultValue:"",modeBased:!1,dimensionId:void 0,valuesByMode:[]}),Ct(`Added variable: ${me.name}`,"variable")},Te=()=>{const me={id:ji("cond"),name:"",expression:"",variableIds:[]},ke={...i,conditions:[...i.conditions||[],me]};a(ke)},je=()=>{if(!d.id||!d.name||!d.type){s({title:"Error",description:"Please select a formula or condition",status:"error",duration:3e3,isClosable:!0});return}const me={type:d.type,id:d.id,name:d.name};a(ke=>({...ke,steps:[...ke.steps,me]})),u({type:"formula",id:"",name:""})},Fe=me=>{const ke=i.variables.find(nt=>nt.id===me),qe={...i,variables:i.variables.filter(nt=>nt.id!==me)};a(qe),ke&&Ct(`Deleted variable: ${ke.name}`,"variable")},Ue=me=>{a(ke=>({...ke,steps:ke.steps.filter((qe,nt)=>nt!==me)}))},Je=()=>{var me,ke,qe,nt,Xe,Mt,Xt;if(!((me=i.name)!=null&&me.trim())){s({title:"Error",description:"Please enter an algorithm name",status:"error",duration:3e3,isClosable:!0});return}for(const Ot of i.variables){if(!((ke=Ot.name)!=null&&ke.trim())){s({title:"Error",description:`Variable with ID "${Ot.id}" is missing a name`,status:"error",duration:3e3,isClosable:!0});return}if(!Ot.type){s({title:"Error",description:`Variable "${Ot.name}" is missing a type`,status:"error",duration:3e3,isClosable:!0});return}}for(const Ot of i.formulas||[])if(!((qe=Ot.name)!=null&&qe.trim())){s({title:"Error",description:`Formula with ID "${Ot.id}" is missing a name`,status:"error",duration:3e3,isClosable:!0});return}for(const Ot of i.conditions||[])if(!((nt=Ot.name)!=null&&nt.trim())){s({title:"Error",description:`Condition with ID "${Ot.id}" is missing a name`,status:"error",duration:3e3,isClosable:!0});return}if((Xe=i.tokenGeneration)!=null&&Xe.enabled&&!T){const{logicalMapping:Ot}=i.tokenGeneration;if(!(Ot.taxonomyId||((Mt=Ot.newTaxonomyName)==null?void 0:Mt.trim()))){s({title:"Token Generation Configuration Required",description:"Please configure the taxonomy settings in the Token Generation tab before saving.",status:"error",duration:5e3,isClosable:!0});return}const kr=i.variables&&i.variables.length>0,or=i.formulas&&i.formulas.length>0;if(!kr||!or){const xn=[];kr||xn.push("variables"),or||xn.push("formulas"),s({title:"Algorithm Configuration Required",description:`Please add ${xn.join(" and ")} before saving.`,status:"error",duration:5e3,isClosable:!0});return}}if(T&&Array.from(_.values()).some(Ot=>Ot.hasChanges)){O(!0);return}if((Xt=i.tokenGeneration)!=null&&Xt.enabled&&Se&&!T){X(!0);return}ut([])},ut=(me,ke)=>{var nt;e(i);const qe={schemaVersion:"5.0.0",profile:"basic",metadata:{name:"Algorithm Collection",description:"Collection of algorithms for design token generation",version:"1.0.0"},config:{},algorithms:[i],execution:{order:[],parallel:!1,onError:"stop"},integration:{targetSchema:"https://designsystem.org/schemas/tokens/v1.0.0",outputFormat:"design-tokens",mergeStrategy:"merge",validation:!0},examples:[]};if(console.log("AlgorithmEditor: Saving algorithm in schema format:",{algorithmId:i.id,algorithmName:i.name,schemaData:qe,rawAlgorithm:i}),B({...i}),xe(!1),Ct("Saved algorithm","general"),me.length>0)try{const Mt=L.getTokens().map(Xt=>{var Ot;if(me.includes(Xt.id)){const cr=_.get(Xt.id);if(cr&&cr.hasChanges)return{...Xt,valuesByMode:[{modeIds:((Ot=Xt.valuesByMode[0])==null?void 0:Ot.modeIds)||[],value:cr.calculatedValue}]}}return Xt});r(Mt),s({title:"Success",description:`Algorithm saved and ${me.length} tokens updated successfully!`,status:"success",duration:3e3,isClosable:!0})}catch(Xe){s({title:"Token Update Failed",description:`Algorithm saved but token updates failed: ${Xe}`,status:"error",duration:5e3,isClosable:!0})}else if((nt=i.tokenGeneration)!=null&&nt.enabled&&!T)try{const Xe=L.getTokens(),Mt=L.getCollections(),Xt=L.getTaxonomies(),{tokens:Ot,errors:cr,newTaxonomies:kr,updatedTaxonomies:or}=Px.generateTokens(i,Xe,Mt,Xt,!0,ke);if(console.log("AlgorithmEditor: Received from TokenGenerationService:",{tokensCount:Ot.length,errorsCount:cr.length,newTaxonomiesCount:(kr==null?void 0:kr.length)||0,updatedTaxonomiesCount:(or==null?void 0:or.length)||0,newTaxonomies:kr,updatedTaxonomies:or}),kr&&kr.length>0){const xn=[...Xt,...kr];L.setTaxonomies(xn),console.log("AlgorithmEditor: Saved new taxonomies:",kr)}if(or&&or.length>0){const xn=Xt.map(dt=>or.find(rr=>rr.id===dt.id)||dt);L.setTaxonomies(xn),console.log("AlgorithmEditor: Saved updated taxonomies:",or)}if(cr.length>0&&s({title:"Token Generation Errors",description:`Generated ${Ot.length} tokens with ${cr.length} errors. Check the preview for details.`,status:"warning",duration:5e3,isClosable:!0}),Ot.length>0){const xn=[...Xe,...Ot];r(xn),console.log("new tokens",Ot),s({title:"Success",description:`Algorithm saved and ${Ot.length} tokens generated successfully!`,status:"success",duration:3e3,isClosable:!0})}}catch(Xe){s({title:"Token Generation Failed",description:`Algorithm saved but token generation failed: ${Xe}`,status:"error",duration:5e3,isClosable:!0})}else s({title:"Success",description:"Algorithm saved successfully!",status:"success",duration:3e3,isClosable:!0})},Ze=me=>{c(ke=>({...ke,type:me}))},At=me=>{c(ke=>({...ke,defaultValue:me}))},gr=me=>{g(me.id),v(me)},vr=()=>{var ke;if(!((ke=y.name)!=null&&ke.trim())){s({title:"Error",description:"Please enter a variable name",status:"error",duration:3e3,isClosable:!0});return}if(!st.test(y.name)){s({title:"Error",description:"Variable name must start with a letter or underscore and contain only letters, numbers, and underscores.",status:"error",duration:3e3,isClosable:!0});return}const me={...i,variables:i.variables.map(qe=>qe.id===m?{...qe,...y}:qe)};a(me),g(null),v({}),Ct(`Updated variable: ${y.name}`,"variable")},yr=()=>{g(null),v({})},gt=()=>{var qe;if(!((qe=i.tokenGeneration)!=null&&qe.enabled)){S([]),k([]);return}if(!ue){S([]),k([]);return}const me=i.variables&&i.variables.length>0,ke=i.formulas&&i.formulas.length>0;if(!T&&(!me||!ke)){S([]),k(["Please add variables and formulas before generating tokens."]);return}if(ke){const nt=new Set(i.variables.map(or=>or.name)),Xe=Kn.getSystemVariables(),Mt=new Set(Xe.map(or=>or.name)),Xt=new Set([...nt,...Mt]),Ot=[],cr=[];if(i.formulas.forEach(or=>{if(or.expressions.javascript.value){const xn=or.expressions.javascript.value;xn.includes("Math.pow(")&&xn.includes("=")&&cr.push(`Formula "${or.name}" has invalid Math.pow syntax. Assignment cannot be done inside Math.pow().`),xn.includes("(")&&!xn.includes(")")&&cr.push(`Formula "${or.name}" has unmatched parentheses.`);const tr=gi.convertFormulaToNames(xn,i.variables).match(/\b[a-zA-Z_][a-zA-Z0-9_]*\b/g)||[],rr=[...new Set(tr)],_t=["Math","Array","Object","String","Number","Boolean","Date","RegExp","Function","undefined","null","true","false","NaN","Infinity"];rr.filter(dr=>!_t.includes(dr)).forEach(dr=>{Xt.has(dr)||Ot.push(dr)})}}),cr.length>0){S([]),k(cr);return}if(Ot.length>0){const or=[...new Set(Ot)];S([]),k([`The following variables are referenced in formulas but not defined: ${or.join(", ")}. Please add them in the Variables tab or ensure system variables are properly configured.`]);return}const kr=[];if(i.formulas.forEach(or=>{if(or.expressions.javascript.value){const xn=or.expressions.javascript.value,tr=gi.convertFormulaToNames(xn,i.variables).match(/\b[a-zA-Z_][a-zA-Z0-9_]*\b/g)||[],rr=[...new Set(tr)],_t=["Math","Array","Object","String","Number","Boolean","Date","RegExp","Function","undefined","null","true","false","NaN","Infinity"],ln=rr.filter(vo=>!_t.includes(vo)),dr=gi.getAllVariableMappings(i.variables),xo=new Set;ln.forEach(vo=>{const Jn=dr.find(di=>di.name===vo);Jn&&xo.add(Jn.id)});const Hi=Array.from(xo).filter(vo=>!or.variableIds.includes(vo));if(Hi.length>0){const vo=Hi.map(Jn=>{const di=dr.find(Wi=>Wi.id===Jn);return di?di.name:Jn});kr.push(`Formula "${or.name}" references variables not listed in variableIds: ${vo.join(", ")}`)}}}),kr.length>0){S([]),k(kr);return}}try{const nt=L.getTokens(),Xe=L.getCollections(),Mt=L.getTaxonomies(),{tokens:Xt,errors:Ot}=Px.generateTokens(i,nt,Xe,Mt,!1,ee);S(Xt),k(Ot)}catch(nt){console.error("Preview generation error:",nt),k([`Preview generation failed: ${nt}`]),S([])}};M.useEffect(()=>{gt()},[i,ee,ue]),M.useEffect(()=>{var Mt,Xt;if(!((Mt=i.tokenGeneration)!=null&&Mt.enabled)){Ee(!1);return}const{logicalMapping:me}=i.tokenGeneration,ke=me.taxonomyId||((Xt=me.newTaxonomyName)==null?void 0:Xt.trim()),qe=i.variables&&i.variables.length>0,nt=i.formulas&&i.formulas.length>0;Ee(!!ke&&(T?!0:qe&&nt))},[(Mn=(In=i.tokenGeneration)==null?void 0:In.logicalMapping)==null?void 0:Mn.taxonomyId,(ts=(An=i.tokenGeneration)==null?void 0:An.logicalMapping)==null?void 0:ts.newTaxonomyName,(jn=i.tokenGeneration)==null?void 0:jn.enabled,i.variables,i.formulas,T]);const Dt=()=>{const me={id:ji("formula"),name:"",description:"",expressions:{latex:{value:""},javascript:{value:"",metadata:{allowedOperations:["math"]}},ast:{type:"literal",value:"",metadata:{astVersion:"1.0.0",validationErrors:[],complexity:"low"}}},variableIds:[]},ke={...i,formulas:[...i.formulas||[],me]};a(ke),Xs.saveToHistory(ke,"Added new formula","formula")},Ct=(me,ke)=>{Xs.saveToHistory(i,me,ke)},Qt=()=>{const me=Xs.undo(i.id);me?(a(me),s({title:"Undo Successful",description:"Algorithm reverted to previous state",status:"success",duration:3e3,isClosable:!0})):s({title:"Nothing to Undo",description:"No previous states available",status:"info",duration:3e3,isClosable:!0})},Zt=()=>{const me=Xs.redo(i.id);me?(a(me),s({title:"Redo Successful",description:"Algorithm restored to next state",status:"success",duration:3e3,isClosable:!0})):s({title:"Nothing to Redo",description:"No future states available",status:"info",duration:3e3,isClosable:!0})},at=(me,ke)=>{let qe;switch(me){case"last-save":if($)qe={...$};else{s({title:"Reset Failed",description:"No saved state available",status:"error",duration:3e3,isClosable:!0});return}break;case"specific-history":if(ke)qe={...ke.algorithm};else{s({title:"Reset Failed",description:"No history entry selected",status:"error",duration:3e3,isClosable:!0});return}break;case"original":qe=t?{...t}:yd,Xs.clearHistory(i.id);break;default:return}a(qe),B(qe),xe(!1),s({title:"Reset Successful",description:`Algorithm reset to ${me.replace("-"," ")}`,status:"success",duration:3e3,isClosable:!0})},Q=me=>{be(me),X(!1),ut([],me)},Ae=Xs.canUndo(i.id),oe=Xs.canRedo(i.id),Ne=(me,ke)=>{if(!ke)return me;const nt=L.getDimensions().find(Mt=>Mt.id===ke);if(!nt)return me;const Xe=nt.modes.find(Mt=>Mt.id===me);return Xe?Xe.name:me},st=/^[a-zA-Z_][a-zA-Z0-9_]*$/,tt=l.name?st.test(l.name):!1,Ie=y.name?st.test(y.name):!0;return o.jsx(z,{children:o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsxs(le,{justify:"space-between",align:"center",children:[o.jsx(E,{fontSize:"xl",fontWeight:"bold",children:"Algorithm Editor"}),o.jsxs(le,{spacing:2,children:[o.jsx(Bt,{"aria-label":"Undo",icon:o.jsx(Vk,{size:16}),size:"sm",variant:"ghost",isDisabled:!Ae,onClick:Qt,title:Ae?"Undo last change":"Nothing to undo"}),o.jsx(Bt,{"aria-label":"Redo",icon:o.jsx(rk,{size:16}),size:"sm",variant:"ghost",isDisabled:!oe,onClick:Zt,title:oe?"Redo last undone change":"Nothing to redo"}),o.jsx(Bt,{"aria-label":"Reset Algorithm",icon:o.jsx(vc,{size:16}),size:"sm",variant:"ghost",colorScheme:"orange",onClick:()=>ie(!0),title:"Reset algorithm to previous state"})]})]}),ge&&o.jsx(z,{p:2,bg:"orange.100",borderRadius:"md",borderWidth:1,borderColor:"orange.200",children:o.jsxs(E,{fontSize:"sm",color:"orange.700",children:[o.jsx(Ro,{size:16})," You have unsaved changes"]})}),o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:"Basic Information"}),o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Algorithm Name"}),o.jsx(yt,{placeholder:"Algorithm Name",value:i.name,onChange:me=>{a(ke=>({...ke,name:me.target.value})),Ct("Updated algorithm name","general")}})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(Hu,{placeholder:"Description (optional)",value:i.description,onChange:me=>{a(ke=>({...ke,description:me.target.value})),Ct("Updated algorithm description","general")}})]})]}),o.jsx(on,{}),o.jsxs(Es,{children:[o.jsxs(Ms,{children:[o.jsx(pr,{children:"Variables"}),o.jsx(pr,{children:"Formulas"}),o.jsx(pr,{children:"Conditions"}),o.jsx(pr,{children:"Token Generation"}),o.jsx(pr,{children:"Algorithm Steps"}),o.jsx(pr,{children:"Preview"}),o.jsx(pr,{children:"Dependency Visualization"})]}),o.jsxs(Ls,{children:[o.jsx(Ir,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(le,{spacing:4,justify:"start",children:[o.jsxs(Ye,{isRequired:!0,isInvalid:!!l.name&&!tt,children:[o.jsx(Qe,{children:"Variable Name"}),o.jsx(yt,{placeholder:"Variable Name",value:l.name,onChange:me=>c(ke=>({...ke,name:me.target.value}))}),!tt&&l.name&&o.jsx(E,{fontSize:"xs",color:"red.500",children:"Variable names must start with a letter or underscore and contain only letters, numbers, and underscores."})]}),o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Type"}),o.jsxs(Kt,{value:l.type,onChange:me=>Ze(me.target.value),children:[o.jsx("option",{value:"number",children:"Number"}),o.jsx("option",{value:"string",children:"String"}),o.jsx("option",{value:"boolean",children:"Boolean"})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Default Value"}),o.jsx(yt,{placeholder:"Default Value (optional)",value:((Be=l.defaultValue)==null?void 0:Be.toString())||"",onChange:me=>At(me.target.value)})]}),o.jsx(Oe,{leftIcon:o.jsx(to,{size:16}),flexShrink:0,onClick:ve,isDisabled:!tt,children:"Add Variable"})]}),l.name&&o.jsx(zp,{variable:l,onVariableChange:me=>c(me),dimensions:L.getDimensions()}),o.jsx(ce,{spacing:2,align:"stretch",children:i.variables.map(me=>{var ke;return o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",children:o.jsx(le,{justify:"space-between",mb:2,children:m===me.id?o.jsxs(ce,{spacing:4,flex:1,align:"stretch",children:[o.jsxs(le,{spacing:4,children:[o.jsxs(Ye,{isRequired:!0,isInvalid:!!y.name&&!Ie,children:[o.jsx(Qe,{children:"Variable Name"}),o.jsx(yt,{placeholder:"Variable Name",value:y.name,onChange:qe=>v(nt=>({...nt,name:qe.target.value}))}),!Ie&&y.name&&o.jsx(E,{fontSize:"xs",color:"red.500",children:"Variable names must start with a letter or underscore and contain only letters, numbers, and underscores."})]}),o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Type"}),o.jsxs(Kt,{value:y.type,onChange:qe=>v(nt=>({...nt,type:qe.target.value})),children:[o.jsx("option",{value:"number",children:"Number"}),o.jsx("option",{value:"string",children:"String"}),o.jsx("option",{value:"boolean",children:"Boolean"})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Default Value"}),o.jsx(yt,{placeholder:"Default Value (optional)",value:((ke=y.defaultValue)==null?void 0:ke.toString())||"",onChange:qe=>v(nt=>({...nt,defaultValue:qe.target.value}))})]})]}),o.jsx(zp,{variable:y,onVariableChange:qe=>v(qe),dimensions:L.getDimensions()}),o.jsxs(le,{spacing:2,children:[o.jsx(Oe,{size:"sm",colorScheme:"blue",onClick:vr,isDisabled:!Ie,children:"Save"}),o.jsx(Oe,{size:"sm",onClick:yr,children:"Cancel"})]})]}):o.jsxs(o.Fragment,{children:[o.jsxs(ce,{align:"start",flex:1,spacing:1,children:[o.jsxs(le,{children:[o.jsx(wt,{colorScheme:"blue",children:me.name}),o.jsxs(E,{fontSize:"sm",color:"gray.500",children:["(",me.type,")"]}),me.defaultValue&&!me.modeBased&&o.jsxs(E,{fontSize:"sm",color:"gray.500",children:["= ",me.defaultValue]}),me.modeBased&&o.jsx(wt,{colorScheme:"green",size:"sm",children:"Mode-Based"})]}),me.modeBased&&me.valuesByMode&&me.valuesByMode.length>0&&o.jsxs(z,{children:[o.jsx(E,{fontSize:"xs",color:"gray.500",mb:1,children:"Mode Values:"}),o.jsx(le,{spacing:2,wrap:"wrap",children:me.valuesByMode.map(({modeIds:qe,value:nt})=>o.jsxs(wt,{size:"sm",colorScheme:"purple",variant:"outline",children:[Ne(qe[0],me.dimensionId),": ",nt]},qe.join(", ")))})]})]}),o.jsxs(le,{children:[o.jsx(Bt,{"aria-label":"Edit variable",icon:o.jsx(qf,{size:16}),size:"sm",onClick:()=>gr(me)}),o.jsx(Bt,{"aria-label":"Delete variable",icon:o.jsx(Eo,{size:16}),size:"sm",colorScheme:"red",onClick:()=>Fe(me.id)})]})]})})},me.id)})})]})}),o.jsx(Ir,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(le,{justify:"space-between",children:o.jsx(Oe,{size:"sm",leftIcon:o.jsx(to,{size:16}),onClick:Dt,children:"Add Formula"})}),o.jsx(ce,{spacing:4,align:"stretch",children:(i.formulas||[]).map((me,ke)=>o.jsx(z,{p:4,borderWidth:1,borderRadius:"md",position:"relative",children:o.jsxs(le,{spacing:4,align:"start",children:[o.jsxs(z,{flex:1,children:[o.jsxs(le,{spacing:4,align:"start",children:[o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Formula Name"}),o.jsx(yt,{placeholder:"Formula Name",value:me.name,onChange:qe=>{const nt=[...i.formulas||[]];nt[ke]={...me,name:qe.target.value};const Xe={...i,formulas:nt};a(Xe),De(me.id),Ct(`Updated formula name: ${qe.target.value}`,"formula")},mb:2})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(yt,{placeholder:"Description",value:me.description,onChange:qe=>{const nt=[...i.formulas||[]];nt[ke]={...me,description:qe.target.value};const Xe={...i,formulas:nt};a(Xe),De(me.id),Ct(`Updated formula description: ${qe.target.value}`,"formula")},mb:2})]})]}),me.expressions.latex.value&&o.jsxs(z,{p:2,bg:n==="light"?"gray.50":"gray.700",borderRadius:"md",mb:2,fontSize:"sm",children:[o.jsx(E,{mb:-2,fontSize:"sm",color:"gray.500",children:"LaTeX preview:"}),o.jsx(KE.BlockMath,{math:me.expressions.latex.value})]}),o.jsx(Mx,{variables:i.variables||[],value:me.expressions.javascript.value,mode:"formula",onChange:(qe,nt,Xe)=>{const Mt=gi.convertFormulaToIds(qe,i.variables),Xt=gi.convertLatexToIds(nt,i.variables),Ot=gi.convertASTToIds(Xe,i.variables),cr=[...i.formulas||[]];cr[ke]={...me,expressions:{latex:{value:Xt},javascript:{value:Mt,metadata:{allowedOperations:["math"]}},ast:Ot}};const kr={...i,formulas:cr};a(kr),De(me.id),Ct(`Updated formula expression: ${me.name}`,"formula")}})]}),o.jsx(Bt,{"aria-label":"Delete formula",icon:o.jsx(Eo,{size:16}),size:"sm",variant:"ghost",colorScheme:"red",onClick:()=>{const qe=(i.formulas||[]).filter(Xe=>Xe.id!==me.id),nt={...i,formulas:qe};a(nt),Ct(`Deleted formula: ${me.name}`,"formula")}})]})},me.id))})]})}),o.jsx(Ir,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(le,{justify:"space-between",children:o.jsx(Oe,{size:"sm",leftIcon:o.jsx(to,{size:16}),onClick:Te,children:"Add Condition"})}),o.jsx(ce,{spacing:4,align:"stretch",children:(i.conditions||[]).map((me,ke)=>o.jsx(z,{p:4,borderWidth:1,borderRadius:"md",position:"relative",children:o.jsxs(le,{spacing:4,align:"start",children:[o.jsxs(z,{flex:1,children:[o.jsx(le,{spacing:4,align:"start",children:o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Condition Name"}),o.jsx(yt,{placeholder:"Condition Name",value:me.name,onChange:qe=>{const nt=[...i.conditions||[]];nt[ke]={...me,name:qe.target.value};const Xe={...i,conditions:nt};a(Xe)},mb:2})]})}),o.jsx(Mx,{variables:i.variables||[],value:me.expression,mode:"condition",onChange:qe=>{const nt=[...i.conditions||[]];nt[ke]={...me,expression:qe};const Xe={...i,conditions:nt};a(Xe)}})]}),o.jsx(Bt,{"aria-label":"Delete condition",icon:o.jsx(Eo,{size:16}),size:"sm",variant:"ghost",colorScheme:"red",onClick:()=>{const qe=(i.conditions||[]).filter(Xe=>Xe.id!==me.id),nt={...i,conditions:qe};a(nt)}})]})},me.id))})]})}),o.jsx(Ir,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:"Token Generation Settings"}),o.jsx(Oe,{size:"sm",colorScheme:(w=i.tokenGeneration)!=null&&w.enabled?"green":"gray",onClick:()=>{var ke;const me=!((ke=i.tokenGeneration)!=null&&ke.enabled);a(qe=>({...qe,tokenGeneration:me?{enabled:!0,iterationRange:{start:-2,end:8,step:1},bulkAssignments:{resolvedValueTypeId:Y.length>0?Y[0].id:"color",taxonomies:[],tokenTier:"PRIMITIVE",private:!1,status:"stable",themeable:!1},logicalMapping:{scaleType:"numeric",defaultValue:"100",increasingStep:100,decreasingStep:25,extraPrefix:"X",incrementDirection:"ascending",taxonomyId:void 0,newTaxonomyName:void 0}}:void 0}))},children:(N=i.tokenGeneration)!=null&&N.enabled?"Enabled":"Enable Token Generation"})]}),Se&&((Le=i.tokenGeneration)==null?void 0:Le.enabled)&&o.jsxs(z,{p:4,borderWidth:1,borderRadius:"md",bg:n==="light"?"blue.50":"blue.900",children:[o.jsxs(le,{justify:"space-between",mb:3,children:[o.jsx(E,{fontWeight:"bold",color:"blue.600",children:"Mode-Based Variables Detected"}),o.jsx(wt,{colorScheme:"blue",children:"Mode Selection Required"})]}),o.jsx(E,{fontSize:"sm",color:"gray.600",mb:3,children:"Your algorithm contains variables with mode-specific values. When you save, you'll be prompted to select which modes to generate tokens for."}),Object.keys(ee).length>0&&o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:2,children:"Selected Modes:"}),o.jsx(ce,{spacing:1,align:"stretch",children:Object.entries(ee).map(([me,ke])=>{const qe=L.getDimensions().find(nt=>nt.id===me);return o.jsxs(le,{spacing:2,children:[o.jsx(wt,{size:"sm",colorScheme:"green",children:(qe==null?void 0:qe.displayName)||me}),o.jsxs(E,{fontSize:"xs",color:"gray.500",children:[ke.length," mode",ke.length!==1?"s":""," selected"]})]},me)})})]})]}),T&&o.jsxs(z,{p:4,borderWidth:1,borderRadius:"md",bg:n==="light"?"blue.50":"blue.900",children:[o.jsxs(le,{justify:"space-between",mb:3,children:[o.jsxs(E,{fontWeight:"bold",color:"blue.600",children:["Existing Tokens (",A.length,")"]}),o.jsx(wt,{colorScheme:"blue",children:"Algorithm-Generated"})]}),o.jsxs(E,{fontSize:"sm",color:"gray.600",mb:3,children:["This algorithm has generated ",A.length," tokens. Token generation settings are simplified to focus on formula-driven updates."]}),o.jsx(ce,{spacing:2,align:"stretch",maxH:"300px",overflowY:"auto",children:A.map(me=>{var Xe;const ke=_.get(me.id),qe=Y.find(Mt=>Mt.id===me.resolvedValueTypeId),nt=he.filter(Mt=>Mt.affectedTokens.includes(me.id)).map(Mt=>Mt.formulaName);return o.jsxs(le,{p:2,borderWidth:1,borderRadius:"md",bg:n==="light"?"white":"gray.700",children:[o.jsxs(ce,{align:"start",flex:1,spacing:1,children:[o.jsx(E,{fontWeight:"medium",fontSize:"sm",children:me.displayName}),o.jsxs(le,{spacing:2,children:[o.jsx(wt,{size:"sm",colorScheme:"gray",children:(qe==null?void 0:qe.displayName)||"Unknown Type"}),ke&&o.jsx(wt,{size:"sm",colorScheme:ke.hasChanges?"orange":"green",children:ke.hasChanges?"Has Changes":"Up to Date"}),ke&&o.jsxs(E,{fontSize:"xs",color:"gray.500",children:["Iteration: ",ke.iterationValue]})]}),nt.length>0&&o.jsxs(E,{fontSize:"xs",color:"blue.500",children:["Affected by: ",nt.join(", ")]})]}),o.jsxs(ce,{align:"end",spacing:1,children:[o.jsxs(E,{fontSize:"xs",color:"gray.500",children:["Current: ",(Xe=me.valuesByMode[0])!=null&&Xe.value&&"value"in me.valuesByMode[0].value?me.valuesByMode[0].value.value:"N/A"]}),ke&&ke.hasChanges&&o.jsxs(E,{fontSize:"xs",color:"orange.500",children:["New: ",ke.calculatedValue&&"value"in ke.calculatedValue?ke.calculatedValue.value:"N/A"]})]})]},me.id)})})]}),((V=i.tokenGeneration)==null?void 0:V.enabled)&&o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsxs(z,{p:4,borderWidth:1,borderRadius:"md",children:[o.jsx(E,{fontWeight:"bold",mb:3,children:"Iteration Range"}),o.jsxs(le,{spacing:4,children:[o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Start"}),o.jsx(yt,{type:"number",value:i.tokenGeneration.iterationRange.start,onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,iterationRange:{...ke.tokenGeneration.iterationRange,start:parseInt(me.target.value)||0}}}))}})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"End"}),o.jsx(yt,{type:"number",value:i.tokenGeneration.iterationRange.end,onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,iterationRange:{...ke.tokenGeneration.iterationRange,end:parseInt(me.target.value)||0}}}))}})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Step"}),o.jsx(yt,{type:"number",value:i.tokenGeneration.iterationRange.step,onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,iterationRange:{...ke.tokenGeneration.iterationRange,step:parseInt(me.target.value)||1}}}))}})]})]})]}),!T&&o.jsxs(o.Fragment,{children:[o.jsxs(z,{p:4,borderWidth:1,borderRadius:"md",children:[o.jsx(E,{fontWeight:"bold",mb:3,children:"Bulk Assignments"}),o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Resolved Value Type"}),o.jsx(Kt,{value:i.tokenGeneration.bulkAssignments.resolvedValueTypeId,onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,bulkAssignments:{...ke.tokenGeneration.bulkAssignments,resolvedValueTypeId:me.target.value}}}))},children:Y.map(me=>o.jsx("option",{value:me.id,children:me.displayName},me.id))})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Token Tier"}),o.jsxs(Kt,{value:i.tokenGeneration.bulkAssignments.tokenTier,onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,bulkAssignments:{...ke.tokenGeneration.bulkAssignments,tokenTier:me.target.value}}}))},children:[o.jsx("option",{value:"PRIMITIVE",children:"Primitive"}),o.jsx("option",{value:"SEMANTIC",children:"Semantic"}),o.jsx("option",{value:"COMPONENT",children:"Component"})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Status"}),o.jsxs(Kt,{value:i.tokenGeneration.bulkAssignments.status,onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,bulkAssignments:{...ke.tokenGeneration.bulkAssignments,status:me.target.value}}}))},children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"experimental",children:"Experimental"}),o.jsx("option",{value:"stable",children:"Stable"}),o.jsx("option",{value:"deprecated",children:"Deprecated"})]})]}),o.jsxs(ce,{spacing:3,align:"stretch",children:[o.jsx(sn,{isChecked:i.tokenGeneration.bulkAssignments.private,onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,bulkAssignments:{...ke.tokenGeneration.bulkAssignments,private:me.target.checked}}}))},children:"Private"}),o.jsx(sn,{isChecked:i.tokenGeneration.bulkAssignments.themeable,onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,bulkAssignments:{...ke.tokenGeneration.bulkAssignments,themeable:me.target.checked}}}))},children:"Themeable"})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Taxonomies"}),o.jsxs(ce,{spacing:2,align:"stretch",children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Select taxonomies for logical term assignment. Terms will be automatically mapped based on the logical mapping settings."}),o.jsx(NS,{taxonomies:se,value:fe,onChange:ze,disabled:se.length===0}),se.length===0&&o.jsx(z,{p:3,bg:n==="light"?"gray.50":"gray.700",borderRadius:"md",children:o.jsx(E,{fontSize:"sm",color:"gray.500",children:(()=>{var qe,nt;const me=L.getTaxonomies(),ke=(nt=(qe=i.tokenGeneration)==null?void 0:qe.bulkAssignments)==null?void 0:nt.resolvedValueTypeId;return me.length===0?"No taxonomies have been created yet. Please create taxonomies in the Classification setup first.":ke&&me.filter(Mt=>Array.isArray(Mt.resolvedValueTypeIds)&&Mt.resolvedValueTypeIds.includes(ke)).length===0?`No taxonomies support the "${ke}" value type. Please select a different value type (like "color" or "spacing") or create a taxonomy that supports "${ke}".`:"No taxonomies available for this value type. Please select a different value type or add taxonomies for this type."})()})})]})]})]})]}),o.jsxs(z,{p:4,borderWidth:1,borderRadius:"md",children:[o.jsx(E,{fontWeight:"bold",mb:3,children:"Logical Mapping"}),o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Scale Type"}),o.jsxs(Kt,{value:i.tokenGeneration.logicalMapping.scaleType,onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,logicalMapping:{...ke.tokenGeneration.logicalMapping,scaleType:me.target.value}}}))},children:[o.jsx("option",{value:"numeric",children:"Numeric"}),o.jsx("option",{value:"tshirt",children:"T-Shirt Sizing"})]})]}),o.jsxs(Ye,{isRequired:!ue,children:[o.jsxs(Qe,{children:["Taxonomy for Scale Terms",!ue&&o.jsx(E,{as:"span",color:"red.500",children:" *"})]}),o.jsxs(ce,{spacing:3,align:"stretch",children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Choose an existing taxonomy or create a new one for the scale terms. This is required for token generation."}),o.jsxs(Kt,{value:i.tokenGeneration.logicalMapping.taxonomyId||"",onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,logicalMapping:{...ke.tokenGeneration.logicalMapping,taxonomyId:me.target.value||void 0,newTaxonomyName:me.target.value?void 0:ke.tokenGeneration.logicalMapping.newTaxonomyName}}}))},children:[o.jsx("option",{value:"",children:"Create new taxonomy"}),se.map(me=>o.jsx("option",{value:me.id,children:me.name},me.id))]}),!i.tokenGeneration.logicalMapping.taxonomyId&&o.jsxs(Ye,{isRequired:!ue,children:[o.jsxs(Qe,{children:["New Taxonomy Name",!ue&&o.jsx(E,{as:"span",color:"red.500",children:" *"})]}),o.jsx(yt,{placeholder:"Enter taxonomy name (e.g., 'Scale Terms', 'Size Categories')",value:i.tokenGeneration.logicalMapping.newTaxonomyName||"",onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,logicalMapping:{...ke.tokenGeneration.logicalMapping,newTaxonomyName:me.target.value}}}))}}),o.jsx(E,{fontSize:"xs",color:"gray.500",mt:1,children:"Provide a descriptive name for the new taxonomy that will contain the scale terms."})]}),!ue&&o.jsxs(z,{p:3,bg:"orange.50",borderRadius:"md",borderWidth:1,borderColor:"orange.200",children:[o.jsxs(E,{fontSize:"sm",color:"orange.700",mb:2,children:[o.jsx(Ro,{size:16})," Please complete the following to enable token generation preview:"]}),o.jsxs(ce,{spacing:1,align:"start",children:[!((er=(ae=i.tokenGeneration)==null?void 0:ae.logicalMapping)!=null&&er.taxonomyId)&&!((yn=(Ar=(it=i.tokenGeneration)==null?void 0:it.logicalMapping)==null?void 0:Ar.newTaxonomyName)!=null&&yn.trim())&&o.jsx(E,{fontSize:"xs",color:"orange.600",children:"â€¢ Configure taxonomy settings above"}),!T&&i.variables.length===0&&o.jsx(E,{fontSize:"xs",color:"orange.600",children:"â€¢ Add variables in the Variables tab"}),!T&&i.formulas.length===0&&o.jsx(E,{fontSize:"xs",color:"orange.600",children:"â€¢ Add formulas in the Formulas tab"})]})]})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Default Value"}),o.jsx(yt,{value:i.tokenGeneration.logicalMapping.defaultValue,onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,logicalMapping:{...ke.tokenGeneration.logicalMapping,defaultValue:me.target.value}}}))}})]}),i.tokenGeneration.logicalMapping.scaleType==="numeric"&&o.jsxs(o.Fragment,{children:[o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Steps (Increasing)"}),o.jsx(yt,{type:"number",placeholder:"100",value:i.tokenGeneration.logicalMapping.increasingStep||"",onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,logicalMapping:{...ke.tokenGeneration.logicalMapping,increasingStep:parseInt(me.target.value)||void 0}}}))}})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Steps (Decreasing)"}),o.jsx(yt,{type:"number",placeholder:"25",value:i.tokenGeneration.logicalMapping.decreasingStep||"",onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,logicalMapping:{...ke.tokenGeneration.logicalMapping,decreasingStep:parseInt(me.target.value)||void 0}}}))}})]})]}),i.tokenGeneration.logicalMapping.scaleType==="tshirt"&&o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Prefix for Extra Sizes"}),o.jsxs(Kt,{value:i.tokenGeneration.logicalMapping.extraPrefix||"X",onChange:me=>{a(ke=>({...ke,tokenGeneration:{...ke.tokenGeneration,logicalMapping:{...ke.tokenGeneration.logicalMapping,extraPrefix:me.target.value}}}))},children:[o.jsx("option",{value:"X",children:"X (X-Small, X-Large)"}),o.jsx("option",{value:"extra",children:"extra (extra-small, extra-large)"})]})]})]})]})]})]})]})}),o.jsx(Ir,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(le,{spacing:4,children:[o.jsxs(Kt,{value:d.type,onChange:me=>u(ke=>({...ke,type:me.target.value})),children:[o.jsx("option",{value:"formula",children:"Formula"}),o.jsx("option",{value:"condition",children:"Condition"})]}),o.jsxs(Kt,{value:d.id,onChange:me=>{const qe=(d.type==="formula"?i.formulas:i.conditions).find(nt=>nt.id===me.target.value);u(nt=>({...nt,id:me.target.value,name:(qe==null?void 0:qe.name)||""}))},children:[o.jsxs("option",{value:"",children:["Select ",d.type==="formula"?"Formula":"Condition"]}),(d.type==="formula"?i.formulas:i.conditions).map(me=>o.jsx("option",{value:me.id,children:me.name},me.id))]}),o.jsx(Oe,{leftIcon:o.jsx(to,{size:16}),onClick:je,children:"Add Step"})]}),o.jsx(z,{p:4,bg:n==="dark"?"gray.800":"gray.50",borderRadius:"md",children:o.jsx(sh,{onDragEnd:Ke,children:o.jsx(oh,{droppableId:"algorithm-steps",children:me=>o.jsxs(ce,{...me.droppableProps,ref:me.innerRef,spacing:2,align:"stretch",children:[i.steps.map((ke,qe)=>{const nt=ke.type==="formula"?i.formulas.find(Xe=>Xe.id===ke.id):i.conditions.find(Xe=>Xe.id===ke.id);return o.jsx(Tc,{draggableId:`${ke.type}_${ke.id}_${qe}`,index:qe,children:(Xe,Mt)=>o.jsxs(le,{ref:Xe.innerRef,...Xe.draggableProps,...Xe.dragHandleProps,p:2,bg:n==="dark"?"gray.700":"white",borderRadius:"md",boxShadow:Mt.isDragging?"md":"sm",borderWidth:1,borderColor:n==="dark"?"gray.600":"gray.200",justify:"space-between",children:[o.jsxs(le,{children:[o.jsx(z,{cursor:"grab",children:o.jsx(Np,{size:16})}),o.jsx(wt,{colorScheme:ke.type==="formula"?"purple":"green",children:ke.type==="formula"?"Formula":"Condition"}),o.jsx(E,{children:nt==null?void 0:nt.name})]}),o.jsx(Bt,{"aria-label":"Delete step",icon:o.jsx(Eo,{size:16}),size:"sm",colorScheme:"red",onClick:()=>Ue(qe)})]})},`${ke.type}_${ke.id}_${qe}`)}),me.placeholder]})})})})]})}),o.jsx(Ir,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(z,{p:4,bg:n==="light"?"gray.50":"gray.800",borderRadius:"md",fontSize:"sm",fontFamily:"mono",overflowX:"auto",children:[o.jsx(E,{fontWeight:"bold",mb:2,children:"Algorithm JSON Preview"}),o.jsx("pre",{style:{margin:0},children:JSON.stringify(i,null,2)})]}),((kt=i.tokenGeneration)==null?void 0:kt.enabled)&&o.jsxs(z,{p:4,bg:n==="light"?"gray.50":"gray.800",borderRadius:"md",fontSize:"sm",fontFamily:"mono",overflowX:"auto",children:[o.jsx(E,{fontWeight:"bold",mb:2,children:"Generated Tokens Preview"}),!ue&&o.jsxs(z,{mb:3,p:3,bg:"orange.100",borderRadius:"md",children:[o.jsx(E,{fontWeight:"bold",color:"orange.600",children:"Configuration Required"}),o.jsxs(ce,{spacing:1,align:"start",mt:2,children:[!((Re=(sr=i.tokenGeneration)==null?void 0:sr.logicalMapping)!=null&&Re.taxonomyId)&&!((bt=(q=(Ge=i.tokenGeneration)==null?void 0:Ge.logicalMapping)==null?void 0:q.newTaxonomyName)!=null&&bt.trim())&&o.jsx(E,{color:"orange.600",fontSize:"xs",children:"â€¢ Configure taxonomy settings in the Token Generation tab"}),!T&&i.variables.length===0&&o.jsx(E,{color:"orange.600",fontSize:"xs",children:"â€¢ Add variables in the Variables tab"}),!T&&i.formulas.length===0&&o.jsx(E,{color:"orange.600",fontSize:"xs",children:"â€¢ Add formulas in the Formulas tab"})]})]}),b.length>0&&o.jsxs(z,{mb:3,p:3,bg:"red.100",borderRadius:"md",children:[o.jsx(E,{fontWeight:"bold",color:"red.600",children:"Generation Errors:"}),b.map((me,ke)=>o.jsxs(E,{color:"red.600",fontSize:"xs",children:["â€¢ ",me]},ke))]}),I.length>0&&o.jsxs(z,{children:[o.jsxs(E,{mb:2,fontSize:"sm",color:"gray.500",children:[I.length," tokens will be generated:"]}),o.jsxs(ce,{spacing:2,align:"stretch",children:[I.slice(0,10).map((me,ke)=>{var qe,nt;return o.jsxs(z,{p:2,bg:"white",borderRadius:"sm",borderWidth:1,children:[o.jsx(E,{fontSize:"xs",fontWeight:"bold",children:me.id}),o.jsx(E,{fontSize:"xs",color:"gray.600",children:me.displayName}),o.jsxs(E,{fontSize:"xs",color:"gray.500",children:["Value: ",(qe=me.valuesByMode[0])!=null&&qe.value&&"value"in me.valuesByMode[0].value?me.valuesByMode[0].value.value:"N/A"]}),((nt=me.valuesByMode[0])==null?void 0:nt.modeIds)&&me.valuesByMode[0].modeIds.length>0&&o.jsxs(E,{fontSize:"xs",color:"blue.500",children:["Modes: ",me.valuesByMode[0].modeIds.join(", ")]})]},ke)}),I.length>10&&o.jsxs(E,{fontSize:"xs",color:"gray.500",children:["... and ",I.length-10," more tokens"]})]})]}),I.length===0&&b.length===0&&ue&&o.jsx(E,{fontSize:"sm",color:"gray.500",children:"No tokens will be generated. Check your algorithm configuration and iteration range settings."})]})]})}),o.jsx(Ir,{children:o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsx(QE,{algorithm:i,showValidation:!0,showExecutionTrace:!1}),o.jsx(eM,{algorithm:i,onExecutionComplete:me=>{console.log("Execution completed:",me)}})]})})]})]}),o.jsx(Oe,{leftIcon:o.jsx(Cb,{size:16}),colorScheme:"blue",onClick:Je,size:"lg",children:(pe=i.tokenGeneration)!=null&&pe.enabled?"Save and Run":"Save Algorithm"}),o.jsx(ZE,{isOpen:K,onClose:()=>O(!1),onSave:ut,algorithm:i,tokenCalculationStates:_,existingTokens:A,resolvedValueTypes:Y}),o.jsx(XE,{isOpen:Z,onClose:()=>ie(!1),onReset:at,algorithm:i,hasUnsavedChanges:ge}),o.jsx(tM,{isOpen:U,onClose:()=>X(!1),onConfirm:Q,algorithm:i})]})})},_o=({title:t,cardType:e="algorithm"})=>{let r=null;const n=20;switch(e){case"algorithm":r=o.jsx(Xi,{size:n});break;case"collection":r=o.jsx(Ap,{size:n});break;case"componentProperty":r=o.jsx(Ib,{size:n});break;case"taxonomy":r=o.jsx(Dp,{size:n});break;case"figma":r=o.jsx(Uf,{size:n});break;case"dimension":r=o.jsx(Eb,{size:n});break;case"COLOR":r=o.jsx(Ha,{size:n});break;case"DIMENSION":r=o.jsx(Wf,{size:n});break;case"SPACING":r=o.jsx(yb,{size:n});break;case"FONT_FAMILY":case"FONT_WEIGHT":case"FONT_SIZE":r=o.jsx(Jf,{size:n});break;case"LINE_HEIGHT":r=o.jsx(wb,{size:n});break;case"LETTER_SPACING":r=o.jsx(Sb,{size:n});break;case"DURATION":r=o.jsx(Mb,{size:n});break;case"CUBIC_BEZIER":r=o.jsx(Lf,{size:n});break;case"BLUR":r=o.jsx(Yu,{size:n});break;case"SPREAD":r=o.jsx(to,{size:n});break;case"RADIUS":r=o.jsx(Tb,{size:n});break;case"system-variable":r=o.jsx(FC,{size:n});break;default:r=o.jsx(vu,{size:n});break}return o.jsxs(le,{children:[r,o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:t})]})},nM=({algorithms:t,onUpdate:e,onUpdateTokens:r,canEdit:n=!1})=>{const{colorMode:s}=Vt(),i=Hr(),[a,l]=M.useState(!1),[c,d]=M.useState();console.log("[AlgorithmsView] Received",t.length,"algorithms");const u=y=>{const v=c?t.map(I=>I.id===y.id?y:I):[...t,y];e(v),l(!1),d(void 0),i({title:"Success",description:`Algorithm ${c?"updated":"created"} successfully`,status:"success",duration:3e3,isClosable:!0})},m=y=>{const v=t.filter(I=>I.id!==y);e(v),i({title:"Success",description:"Algorithm deleted successfully",status:"success",duration:3e3,isClosable:!0})},g=y=>{d(y),l(!0)};return o.jsx(no,{title:"Algorithms",description:"Algorithms define automated processes for generating and managing design tokens based on mathematical formulas and business rules.",children:o.jsxs(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:s==="dark"?"gray.900":"white",children:[n&&o.jsx(Oe,{size:"sm",leftIcon:o.jsx(xs,{}),onClick:()=>l(!0),colorScheme:"blue",mb:4,children:"Add Algorithm"}),o.jsx(ce,{align:"stretch",spacing:3,children:t.map(y=>o.jsx(z,{p:4,borderWidth:1,borderRadius:"md",bg:s==="dark"?"gray.800":"gray.50",borderColor:s==="dark"?"gray.600":"gray.200",children:o.jsxs(ce,{align:"stretch",spacing:2,children:[o.jsxs(le,{justify:"space-between",children:[o.jsx(_o,{title:y.name,cardType:"algorithm"}),n&&o.jsxs(le,{children:[o.jsx(Bt,{"aria-label":"Edit algorithm",icon:o.jsx(ys,{}),size:"sm",onClick:()=>g(y)}),o.jsx(Bt,{"aria-label":"Delete algorithm",icon:o.jsx(As,{}),size:"sm",colorScheme:"red",onClick:()=>m(y.id)})]})]}),y.description&&o.jsx(E,{color:"gray.500",children:y.description}),o.jsxs(E,{fontSize:"sm",children:[y.variables.length," variables â€¢ ",y.formulas.length," formulas â€¢ ",y.conditions.length," conditions â€¢ ",y.steps.length," steps"]})]})},y.id))}),n&&o.jsxs(Zr,{isOpen:a,onClose:()=>l(!1),size:"6xl",children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:c?"Edit Algorithm":"New Algorithm"}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsx(rM,{algorithm:c,onSave:u,onUpdateTokens:r})})]})]})]})})},sM=({canEdit:t=!1})=>{const{colorMode:e}=Vt();return o.jsx(no,{title:"Foundations",children:o.jsx(o.Fragment,{children:o.jsxs(Es,{colorScheme:"blue",children:[o.jsxs(Ms,{mb:8,children:[o.jsx(pr,{children:o.jsxs(le,{gap:2,children:[o.jsx(Jf,{size:16})," ",o.jsx(E,{children:"Typography"})]})}),o.jsx(pr,{children:o.jsxs(le,{gap:2,children:[o.jsx(Y6,{size:16})," ",o.jsx(E,{children:"Iconography"})]})}),o.jsx(pr,{children:o.jsxs(le,{gap:2,children:[o.jsx(Wf,{size:16})," ",o.jsx(E,{children:"Spacing"})]})}),o.jsx(pr,{children:o.jsxs(le,{gap:2,children:[o.jsx(Ha,{size:16})," ",o.jsx(E,{children:"Color"})]})})]}),o.jsxs(Ls,{children:[o.jsx(Ir,{p:0,m:0,children:o.jsx(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:e==="dark"?"gray.900":"white",children:"Typography here"})}),o.jsx(Ir,{p:0,m:0,children:o.jsx(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:e==="dark"?"gray.900":"white",children:"Iconography here"})}),o.jsx(Ir,{p:0,m:0,children:o.jsx(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:e==="dark"?"gray.900":"white",children:"Spacing here"})}),o.jsx(Ir,{p:0,m:0,children:o.jsx(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:e==="dark"?"gray.900":"white",children:"Color here"})})]})]})})})};class Aa{static validateData(e){var r,n;try{qu(e);const s=e;if(s.config&&Array.isArray(s.config.systemVariables)){const i=s.config.systemVariables,a=new Set((s.dimensions||[]).map(l=>l.id));for(const l of i){if(!l.id||!l.name||!l.type)return{isValid:!1,errors:[`System variable is missing required fields (id, name, type): ${JSON.stringify(l)}`]};if(!["string","number","boolean","color"].includes(l.type))return{isValid:!1,errors:[`System variable ${l.id} has invalid type: ${l.type}`]};if(l.modeBased){if(!l.dimensionId)return{isValid:!1,errors:[`System variable ${l.id} is mode-based but missing dimensionId.`]};if(!a.has(l.dimensionId))return{isValid:!1,errors:[`System variable ${l.id} references non-existent dimensionId: ${l.dimensionId}`]};if(!Array.isArray(l.valuesByMode)||l.valuesByMode.length===0)return{isValid:!1,errors:[`System variable ${l.id} is mode-based but has no valuesByMode array.`]};for(const c of l.valuesByMode)if(!Array.isArray(c.modeIds)||typeof c.value>"u")return{isValid:!1,errors:[`System variable ${l.id} has invalid valuesByMode entry: ${JSON.stringify(c)}`]}}}}if(s.tokens){const i=new Set(((r=s.resolvedValueTypes)==null?void 0:r.map(a=>a.id))||[]);if(i.size===0)return{isValid:!1,errors:["No resolvedValueTypes found in data. Your system data must include all value types required by your schema."]};for(const a of s.tokens){const l=a.resolvedValueTypeId;if(!l)return{isValid:!1,errors:[`Token ${a.id} is missing required resolvedValueTypeId`]};if(!i.has(l))return{isValid:!1,errors:[`Token ${a.id} has invalid resolvedValueTypeId "${l}". Must be one of: ${Array.from(i).join(", ")}`]};for(const c of a.valuesByMode){const d=c.value;if("tokenId"in d&&!s.tokens.find(m=>m.id===d.tokenId))return{isValid:!1,errors:[`Token ${a.id} references non-existent token ${d.tokenId} in valuesByMode`]}}if(a.tokenCollectionId){const c=s.tokenCollections.find(d=>d.id===a.tokenCollectionId);if(!c)return{isValid:!1,errors:[`Token ${a.id} references non-existent collection ${a.tokenCollectionId}`]};if(!c.resolvedValueTypeIds.includes(a.resolvedValueTypeId))return{isValid:!1,errors:[`Token ${a.id} has type ${a.resolvedValueTypeId} which is not supported by collection ${c.id}`]}}}if(s.dimensions){const a=new Set(s.dimensions.map(l=>l.id));if(s.dimensionOrder){for(const c of s.dimensionOrder)if(!a.has(c))return{isValid:!1,errors:[`dimensionOrder contains ID "${c}" that does not exist in dimensions`]};const l=new Set(s.dimensionOrder);for(const c of s.dimensions)if(!l.has(c.id))return{isValid:!1,errors:[`Dimension "${c.id}" is not included in dimensionOrder`]};if(new Set(s.dimensionOrder).size!==s.dimensionOrder.length)return{isValid:!1,errors:["dimensionOrder contains duplicate IDs"]}}for(const l of s.dimensions){if(!l.resolvedValueTypeIds)return{isValid:!1,errors:[`Dimension ${l.id} is missing required resolvedValueTypeIds`]};for(const c of l.resolvedValueTypeIds)if(!i.has(c))return{isValid:!1,errors:[`Dimension ${l.id} has invalid resolvedValueTypeId "${c}". Must be one of: ${Array.from(i).join(", ")}`]}}}if(s.tokenCollections)for(const a of s.tokenCollections){const l=a.resolvedValueTypeIds;if(!l||l.length===0)return{isValid:!1,errors:[`Collection ${a.id} is missing required resolvedValueTypeIds`]};for(const c of l)if(!i.has(c))return{isValid:!1,errors:[`Collection ${a.id} has invalid resolvedValueTypeId "${c}". Must be one of: ${Array.from(i).join(", ")}`]}}if(s.taxonomies)for(const a of s.taxonomies){if(!a.terms||a.terms.length===0)return{isValid:!1,errors:[`Taxonomy ${a.id} must have at least one term`]};if(a.resolvedValueTypeIds){for(const l of a.resolvedValueTypeIds)if(!i.has(l))return{isValid:!1,errors:[`Taxonomy ${a.id} has invalid resolvedValueTypeId "${l}". Must be one of: ${Array.from(i).join(", ")}`]}}}if(s.themes,s.taxonomyOrder){const a=new Set(((n=s.taxonomies)==null?void 0:n.map(l=>l.id))||[]);for(const l of s.taxonomyOrder)if(!a.has(l))return{isValid:!1,errors:[`taxonomyOrder contains ID "${l}" that does not exist in taxonomies`]}}if(s.componentProperties){const a=this.validateComponentProperties(s.componentProperties);if(!a.isValid)return{isValid:!1,errors:a.errors||[]}}}return{isValid:!0}}catch(s){return s&&typeof s=="object"&&"errors"in s?{isValid:!1,errors:s.errors}:{isValid:!1,errors:[s instanceof Error?s.message:String(s)]}}}static validateComponentProperties(e){const r=[],n=new Set;for(const s of e)if(n.has(s.id)&&r.push(`Duplicate component property ID: ${s.id}`),n.add(s.id),s.type==="list")if(!s.options||s.options.length===0)r.push(`List component property '${s.id}' must have at least one option`);else{const i=new Set;for(const a of s.options)i.has(a.id)&&r.push(`Duplicate option ID '${a.id}' in component property '${s.id}'`),i.add(a.id);typeof s.default=="string"&&!s.options.some(a=>a.id===s.default)&&r.push(`Default value '${s.default}' in component property '${s.id}' does not reference an existing option`)}else s.type==="boolean"&&(s.options&&s.options.length>0&&r.push(`Boolean component property '${s.id}' cannot have options`),typeof s.default!="boolean"&&r.push(`Boolean component property '${s.id}' must have a boolean default value`));return{isValid:r.length===0,errors:r}}}function DS({value:t,onChange:e,label:r="Value Types",isRequired:n=!1,disabled:s=!1,error:i}){const a=L.getValueTypes()||[],l=d=>{d&&e([...t,d])},c=d=>{e(t.filter(u=>u!==d))};return o.jsxs(Ye,{isRequired:n,isInvalid:!!i,isDisabled:s,children:[o.jsx(Qe,{children:r}),o.jsxs(Kt,{value:"",onChange:d=>l(d.target.value),children:[o.jsx("option",{value:"",children:"Add a value type..."}),a.filter(d=>!t.includes(d.id)).map(d=>o.jsx("option",{value:d.id,children:d.displayName},d.id))]}),o.jsx(z,{mt:2,children:o.jsx(le,{spacing:2,wrap:"wrap",children:t.map(d=>{const u=a.find(m=>m.id===d);return u?o.jsxs(Yn,{size:"md",borderRadius:"full",variant:"solid",colorScheme:"blue",children:[o.jsx(Ni,{children:u.displayName}),o.jsx(Af,{onClick:()=>c(d)})]},d):null})})}),i&&o.jsx(E,{color:"red.500",fontSize:"sm",children:i})]})}function oM({dimensions:t,setDimensions:e,isOpen:r,onClose:n,editingIndex:s}){const[i,a]=M.useState({id:"",displayName:"",description:"",modes:[],defaultMode:"",required:!1,resolvedValueTypeIds:[]}),[l,c]=M.useState({id:"",name:"",description:""}),[d,u]=M.useState(!1),[m,g]=M.useState(null),y=Hr();nr.useEffect(()=>{var T;if(s!==null&&t[s]){const P=t[s];console.log("[DimensionsEditor] Editing existing dimension:",P),a({id:P.id,displayName:P.displayName,description:P.description||"",modes:P.modes,defaultMode:P.defaultMode||(((T=P.modes[0])==null?void 0:T.id)??""),required:P.required||!1,resolvedValueTypeIds:P.resolvedValueTypeIds||[]})}else console.log("[DimensionsEditor] Creating new dimension"),a({id:wn("dimension"),displayName:"",description:"",modes:[],defaultMode:"",required:!1,resolvedValueTypeIds:[]})},[s,t,r]);const v=(T,P)=>{console.log(`[DimensionsEditor] Form field "${T}" changed to:`,P),a(_=>({..._,[T]:P}))},I=(T=null)=>{if(console.log("[DimensionsEditor] Opening mode dialog for index:",T),g(T),T!==null&&i.modes){const P=i.modes[T];console.log("[DimensionsEditor] Editing existing mode:",P),c({id:P.id,name:P.name,description:P.description||""})}else console.log("[DimensionsEditor] Creating new mode"),c({id:wn("mode"),name:"",description:""});u(!0)},S=()=>{u(!1),g(null)},b=(T,P)=>{c(_=>({..._,[T]:P}))},k=()=>{if(console.log("[DimensionsEditor] Saving mode:",l),!l.id||!l.name){console.error("[DimensionsEditor] Mode validation failed: Missing id or name");return}const T=i.modes?[...i.modes]:[];let P=i.defaultMode;m!==null?(console.log("[DimensionsEditor] Updating existing mode at index:",m),T[m]={...l,dimensionId:i.id}):(console.log("[DimensionsEditor] Adding new mode"),T.push({...l,dimensionId:i.id}),T.length===1&&(P=T[0].id,console.log("[DimensionsEditor] Setting first mode as default:",P))),a(_=>({..._,modes:T,defaultMode:P})),u(!1),g(null)},A=T=>{a(P=>{var G,ne;const _=(P.modes||[]).filter((he,te)=>te!==T);let R=P.defaultMode;return((G=P.modes[T])==null?void 0:G.id)===P.defaultMode&&(R=((ne=_[0])==null?void 0:ne.id)||""),{...P,modes:_,defaultMode:R}})},C=()=>{if(console.log("[DimensionsEditor] Starting save process with form data:",i),!i.id||!i.displayName){console.error("[DimensionsEditor] Validation failed: Missing id or displayName",i),y({title:"Required Fields Missing",description:"ID and display name are required fields.",status:"error",duration:4e3,isClosable:!0});return}if(!i.modes||i.modes.length===0){console.error("[DimensionsEditor] Validation failed: No modes",i),y({title:"At least one mode required",description:"You must add at least one mode to the dimension.",status:"error",duration:4e3,isClosable:!0});return}if(!i.defaultMode||!i.modes.some(he=>he.id===i.defaultMode)){console.error("[DimensionsEditor] Validation failed: Invalid defaultMode",i),y({title:"Invalid Default Mode",description:"Please select a valid default mode from the available modes.",status:"error",duration:4e3,isClosable:!0});return}if(typeof i.required!="boolean"){console.error("[DimensionsEditor] Validation failed: required is not boolean",i),y({title:"Required Field Missing",description:'The "Required" field must be set.',status:"error",duration:4e3,isClosable:!0});return}for(const he of i.modes)if(!he.id||!he.name||!he.dimensionId){console.error("[DimensionsEditor] Validation failed: Mode missing required fields",he),y({title:"Invalid Mode",description:"Each mode must have an id, name, and dimensionId.",status:"error",duration:4e3,isClosable:!0});return}const T=[...t],P={...i,modes:i.modes||[],required:i.required,defaultMode:i.defaultMode,resolvedValueTypeIds:i.resolvedValueTypeIds||[]};console.log("[DimensionsEditor] Prepared dimension to save:",P),s!==null?(console.log("[DimensionsEditor] Updating existing dimension at index:",s),T[s]=P):(console.log("[DimensionsEditor] Adding new dimension"),T.push(P));const _=localStorage.getItem("tokenSystem");console.log("[DimensionsEditor] Existing data from storage:",_);const R=_?JSON.parse(_):{systemName:"Design System",systemId:"design-system",description:"Design system for validation",tokenCollections:[],tokens:[],platforms:[],taxonomies:[],version:"1.0.0",versionHistory:[]},G=L.getValueTypes()||[],ne={...R,dimensions:T,resolvedValueTypes:G};if(console.log("[DimensionsEditor] Validation data:",ne),typeof Aa<"u"&&typeof Aa.validateData=="function"){console.log("[DimensionsEditor] Calling ValidationService");const he=Aa.validateData(ne);if(console.log("[DimensionsEditor] Validation result:",he),!he.isValid){console.error("[DimensionsEditor] Schema validation failed:",he.errors);const te=Array.isArray(he.errors)?he.errors.map(K=>typeof K=="string"?K:JSON.stringify(K)).join(", "):"See console for details.";y({title:"Schema Validation Failed",description:te,status:"error",duration:5e3,isClosable:!0});return}}e(T),n(),y({title:"Dimension Saved",description:`Successfully ${s!==null?"updated":"created"} dimension "${i.displayName}"`,status:"success",duration:3e3,isClosable:!0})};return o.jsxs(o.Fragment,{children:[o.jsxs(Zr,{isOpen:r,onClose:n,size:"lg",children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:s!==null?"Edit Dimension":"Add Dimension"}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"ID"}),o.jsx(yt,{value:i.id,isReadOnly:!0})]}),o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Display Name"}),o.jsx(yt,{value:i.displayName,onChange:T=>v("displayName",T.target.value)})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(yt,{value:i.description,onChange:T=>v("description",T.target.value)})]}),o.jsxs(Ye,{isRequired:!0,display:"flex",alignItems:"center",children:[o.jsx(Qe,{mb:"0",children:"Required"}),o.jsx(hl,{isChecked:i.required||!1,onChange:T=>a(P=>({...P,required:T.target.checked}))})]}),o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Default Mode"}),o.jsxs(Kt,{value:i.defaultMode,onChange:T=>v("defaultMode",T.target.value),children:[o.jsx("option",{value:"",children:"None"}),i.modes.map(T=>o.jsx("option",{value:T.id,children:T.name},T.id))]})]}),o.jsxs(z,{children:[o.jsxs(E,{fontWeight:"bold",mb:2,children:["Modes ",o.jsx("span",{style:{color:"red"},children:"*"})]}),o.jsx(Oe,{leftIcon:o.jsx(xs,{}),size:"sm",onClick:()=>I(null),mb:2,children:"Add Mode"}),o.jsx(ce,{align:"stretch",spacing:1,children:i.modes.map((T,P)=>o.jsxs(le,{children:[o.jsx(E,{children:T.name}),o.jsx(Bt,{"aria-label":"Edit mode",icon:o.jsx(ys,{}),size:"xs",onClick:()=>I(P)}),o.jsx(Bt,{"aria-label":"Delete mode",icon:o.jsx(As,{}),size:"xs",colorScheme:"red",onClick:()=>A(P)})]},T.id))})]}),o.jsx(Ye,{children:o.jsx(DS,{value:i.resolvedValueTypeIds,onChange:T=>a(P=>({...P,resolvedValueTypeIds:T})),label:"Value Types",isRequired:!1,error:void 0})})]})}),o.jsxs(rn,{children:[o.jsx(Oe,{variant:"ghost",mr:3,onClick:n,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:C,children:s!==null?"Save":"Add"})]})]})]}),o.jsxs(Zr,{isOpen:d,onClose:S,size:"sm",children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:m!==null?"Edit Mode":"Add Mode"}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Name"}),o.jsx(yt,{value:l.name,onChange:T=>b("name",T.target.value)})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(yt,{value:l.description,onChange:T=>b("description",T.target.value)})]})]})}),o.jsxs(rn,{children:[o.jsx(Oe,{variant:"ghost",mr:3,onClick:S,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:k,children:m!==null?"Save":"Add"})]})]})]})]})}function RS({dimensions:t,setDimensions:e,canEdit:r=!1}){const{colorMode:n}=Vt(),[s,i]=M.useState(!1),[a,l]=M.useState(null),[c,d]=M.useState([]),u=Hr(),m=L.getValueTypes();M.useEffect(()=>{const b=L.getDimensionOrder()||[];d(b)},[]),M.useEffect(()=>{if(!c||c.length===0){const b=t.map(k=>k.id);b.length>0&&(console.log("Initializing dimension order:",b),L.setDimensionOrder(b),d(b))}},[t,c]),M.useEffect(()=>{L.setDimensions(t)},[t]);const g=b=>{if(console.log("Drag end result:",b),console.log("Current dimensionOrder:",c),!b.destination||!c){console.log("No destination or dimensionOrder is undefined");return}const k=Array.from(c),[A]=k.splice(b.source.index,1);k.splice(b.destination.index,0,A),console.log("New order after drag:",k);const C=new Set(t.map(R=>R.id)),T=new Set(k);C.forEach(R=>{T.has(R)||k.push(R)});const P=new Set(t.map(R=>R.id)),_=k.filter(R=>!P.has(R));if(_.length>0){console.log("Validation failed: Invalid dimension IDs:",_),u({title:"Validation Error",description:`Invalid dimension IDs in order: ${_.join(", ")}`,status:"error",duration:5e3,isClosable:!0});return}L.setDimensionOrder(k),d(k),window.dispatchEvent(new CustomEvent("token-model:data-change"))};M.useEffect(()=>{console.log("Dimension order changed:",c)},[c]),M.useEffect(()=>{console.log("Dimensions changed:",t)},[t]);const y=(b=null)=>{l(b),i(!0)},v=()=>{i(!1),l(null)},I=b=>{const k=t[b],A=t.filter((_,R)=>R!==b),C=c.filter(_=>_!==k.id),T=new Set(A.map(_=>_.id)),P=C.filter(_=>!T.has(_));if(P.length>0){console.log("Validation failed: Invalid dimension IDs after deletion:",P),u({title:"Cannot Delete Dimension",description:`Invalid dimension IDs in order: ${P.join(", ")}`,status:"error",duration:5e3,isClosable:!0});return}e(A),L.setDimensionOrder(C),d(C),window.dispatchEvent(new CustomEvent("token-model:data-change")),u({title:"Dimension Deleted",description:`Successfully deleted dimension "${k.displayName}"`,status:"info",duration:3e3,isClosable:!0})},S=[...t].sort((b,k)=>{if(!c||c.length===0)return console.log("No dimension order, using original order"),0;const A=c.indexOf(b.id),C=c.indexOf(k.id);return A===-1?1:C===-1?-1:A-C});return console.log("Sorted dimensions:",S),o.jsxs(z,{children:[o.jsx(E,{fontSize:"2xl",fontWeight:"bold",mb:2,children:"Dimensions"}),o.jsx(E,{fontSize:"sm",color:"gray.600",mb:6,children:"Dimensions define mutually exclusive modes that share a common theme. Each dimension can have multiple modes, and tokens can have different values for each mode."}),o.jsxs(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:n==="dark"?"gray.900":"white",children:[r&&o.jsx(Oe,{size:"sm",leftIcon:o.jsx(xs,{}),onClick:()=>y(null),colorScheme:"blue",mb:4,children:"Add Dimension"}),r?o.jsx(sh,{onDragEnd:g,children:o.jsx(oh,{droppableId:"dimensions",children:b=>o.jsxs(ce,{...b.droppableProps,ref:b.innerRef,align:"stretch",spacing:2,children:[S.map((k,A)=>o.jsx(Tc,{draggableId:k.id,index:A,children:(C,T)=>o.jsx(z,{ref:C.innerRef,...C.draggableProps,p:3,borderWidth:1,borderRadius:"md",bg:n==="dark"?"gray.800":"gray.50",borderColor:n==="dark"?"gray.600":"gray.200",opacity:T.isDragging?.8:1,children:o.jsxs(le,{justify:"space-between",align:"center",children:[o.jsxs(le,{spacing:2,children:[o.jsx(z,{w:"32px",textAlign:"center",fontWeight:"bold",color:"gray.500",children:A+1}),o.jsx(z,{...C.dragHandleProps,cursor:"grab",children:o.jsx(zb,{})}),o.jsxs(z,{children:[o.jsx(_o,{title:k.displayName,cardType:"dimension"}),o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["Modes: ",k.modes.map(P=>P.name).join(", ")]}),o.jsxs(E,{fontSize:"xs",color:"gray.500",children:["ID: ",k.id]}),Array.isArray(k.resolvedValueTypeIds)&&k.resolvedValueTypeIds.length>0&&o.jsx(Ra,{mt:2,spacing:2,children:k.resolvedValueTypeIds.map(P=>{const _=m.find(R=>R.id===P);return _?o.jsx(Yn,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"blue",children:o.jsx(Ni,{children:_.displayName})},P):null})})]})]}),o.jsxs(le,{children:[o.jsx(Bt,{"aria-label":"Edit dimension",icon:o.jsx(ys,{}),size:"sm",onClick:()=>y(A)}),o.jsx(Bt,{"aria-label":"Delete dimension",icon:o.jsx(As,{}),size:"sm",colorScheme:"red",onClick:()=>I(A)})]})]})})},k.id)),b.placeholder]})})}):o.jsx(ce,{align:"stretch",spacing:2,children:S.map((b,k)=>o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:n==="dark"?"gray.800":"gray.50",borderColor:n==="dark"?"gray.600":"gray.200",children:o.jsx(le,{justify:"space-between",align:"center",children:o.jsxs(le,{spacing:2,children:[o.jsx(z,{w:"32px",textAlign:"center",fontWeight:"bold",color:"gray.500",children:k+1}),o.jsxs(z,{children:[o.jsx(_o,{title:b.displayName,cardType:"dimension"}),o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["Modes: ",b.modes.map(A=>A.name).join(", ")]}),o.jsxs(E,{fontSize:"xs",color:"gray.500",children:["ID: ",b.id]}),Array.isArray(b.resolvedValueTypeIds)&&b.resolvedValueTypeIds.length>0&&o.jsx(Ra,{mt:2,spacing:2,children:b.resolvedValueTypeIds.map(A=>{const C=m.find(T=>T.id===A);return C?o.jsx(Yn,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"blue",children:o.jsx(Ni,{children:C.displayName})},A):null})})]})]})})},b.id))})]}),o.jsx(oM,{dimensions:t,setDimensions:e,isOpen:s,onClose:v,editingIndex:a})]})}const iM=t=>{const{open:e,onClose:r,onSave:n,form:s,handleFormChange:i,handleTermDialogOpen:a,handleTermDelete:l,resolvedValueTypes:c}=t,{colorMode:d}=Vt();nr.useEffect(()=>{e&&console.log("[TaxonomyEditorDialog] Form data:",JSON.stringify(s,null,2))},[e,s]);const u=g=>{var y;if(!((y=s.resolvedValueTypeIds)!=null&&y.includes(g))){const v=[...s.resolvedValueTypeIds||[],g];i("resolvedValueTypeIds",v)}},m=g=>{const y=(s.resolvedValueTypeIds||[]).filter(v=>v!==g);i("resolvedValueTypeIds",y)};return o.jsxs(Zr,{isOpen:e,onClose:r,size:"lg",children:[o.jsx(Dr,{}),o.jsxs(Xr,{bg:d==="dark"?"gray.900":"white",children:[o.jsx(Rr,{children:s.editingIndex!==null?"Edit Taxonomy":"Add Taxonomy"}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Name"}),o.jsx(yt,{value:s.name,onChange:g=>i("name",g.target.value)})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(yt,{value:s.description,onChange:g=>i("description",g.target.value)})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Value Types"}),o.jsx(Kt,{placeholder:"Add a value type...",value:"",onChange:g=>{g.target.value&&u(g.target.value)},children:c.filter(g=>!(s.resolvedValueTypeIds||[]).includes(g.id)).map(g=>o.jsx("option",{value:g.id,children:g.name},g.id))}),o.jsx(Ra,{mt:2,spacing:2,children:(s.resolvedValueTypeIds||[]).map(g=>{const y=c.find(v=>v.id===g);return y?o.jsxs(Yn,{size:"md",borderRadius:"full",variant:"solid",colorScheme:"blue",children:[o.jsx(Ni,{children:y.name}),o.jsx(Af,{onClick:()=>m(g)})]},g):null})})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"bold",mb:2,children:"Terms"}),o.jsx(Oe,{leftIcon:o.jsx(xs,{}),size:"sm",onClick:()=>a(null),mb:2,children:"Add Term"}),o.jsx(ce,{align:"stretch",spacing:1,children:s.terms.map((g,y)=>o.jsxs(le,{children:[o.jsx(E,{children:g.name}),o.jsx(Bt,{"aria-label":"Edit term",icon:o.jsx(ys,{}),size:"xs",onClick:()=>a(y)}),o.jsx(Bt,{"aria-label":"Delete term",icon:o.jsx(As,{}),size:"xs",colorScheme:"red",onClick:()=>l(y)})]},g.id))})]})]})}),o.jsxs(rn,{children:[o.jsx(Oe,{variant:"ghost",mr:3,onClick:r,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:async()=>await n(),children:"Save"})]})]})]})},aM=({open:t,onClose:e,onSave:r,termForm:n,handleTermFormChange:s,termEditIndex:i})=>{const{colorMode:a}=Vt();return o.jsxs(Zr,{isOpen:t,onClose:e,size:"sm",children:[o.jsx(Dr,{}),o.jsxs(Xr,{bg:a==="dark"?"gray.900":"white",children:[o.jsx(Rr,{children:i!==null?"Edit Term":"Add Term"}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Name"}),o.jsx(yt,{value:n.name,onChange:l=>s("name",l.target.value)})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(yt,{value:n.description,onChange:l=>s("description",l.target.value)})]})]})}),o.jsxs(rn,{children:[o.jsx(Oe,{variant:"ghost",mr:3,onClick:e,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:r,children:"Save"})]})]})]})};function xd(t){return t.map(e=>({...e,description:typeof e.description=="string"?e.description:""}))}function OS({taxonomies:t,setTaxonomies:e,tokens:r,collections:n,dimensions:s,platforms:i,resolvedValueTypes:a,canEdit:l=!1}){const{colorMode:c}=Vt(),[d,u]=M.useState(!1),[m,g]=M.useState(null),[y,v]=M.useState({id:"",name:"",description:"",terms:xd([]),resolvedValueTypeIds:[]}),[I,S]=M.useState({id:"",name:"",description:""}),[b,k]=M.useState(!1),[A,C]=M.useState(null),[T,P]=M.useState([]),_=Hr();M.useEffect(()=>{const U=L.getTaxonomyOrder()||[];P(U)},[]),M.useEffect(()=>{if(t.length>0){const U=T||[],X=new Set(t.map(Se=>Se.id)),ee=U.filter(Se=>X.has(Se));if(Array.from(X).filter(Se=>!U.includes(Se)).length>0||ee.length===0){const Se=t.map(Me=>Me.id);console.log("Updating taxonomy order to match source data:",Se),L.setTaxonomyOrder(Se),P(Se)}else ee.length<U.length&&(console.log("Removing invalid taxonomy IDs from order:",ee),L.setTaxonomyOrder(ee),P(ee))}},[t]);const R=U=>{if(console.log("Drag end result:",U),console.log("Current taxonomyOrder:",T),!U.destination||!T){console.log("No destination or taxonomyOrder is undefined");return}const X=Array.from(T),[ee]=X.splice(U.source.index,1);X.splice(U.destination.index,0,ee),console.log("New order after drag:",X);const be=new Set(t.map(de=>de.id)),Se=new Set(X);be.forEach(de=>{Se.has(de)||X.push(de)});const Me=new Set(t.map(de=>de.id)),se=X.filter(de=>!Me.has(de));if(se.length>0){console.log("Validation failed: Invalid taxonomy IDs:",se),_({title:"Validation Error",description:`Invalid taxonomy IDs in order: ${se.join(", ")}`,status:"error",duration:5e3,isClosable:!0});return}L.setTaxonomyOrder(X),P(X),window.dispatchEvent(new CustomEvent("token-model:data-change"))};M.useEffect(()=>{const U=L.getTaxonomyOrder();console.log("Initial taxonomy order from localStorage:",U)},[]),M.useEffect(()=>{console.log("Taxonomy order changed:",T)},[T]),M.useEffect(()=>{console.log("Taxonomies changed:",t)},[t]);const G=(U=null)=>{if(g(U),U!==null){const X=t[U];v({id:X.id,name:X.name,description:X.description||"",terms:xd(X.terms||[]),resolvedValueTypeIds:Array.isArray(X.resolvedValueTypeIds)?X.resolvedValueTypeIds:[]})}else v({id:wn("taxonomy"),name:"",description:"",terms:xd([]),resolvedValueTypeIds:[]});u(!0)},ne=()=>{u(!1),g(null)},he=(U,X)=>{v(ee=>U==="terms"?{...ee,terms:xd(X)}:U==="resolvedValueTypeIds"?{...ee,resolvedValueTypeIds:X}:{...ee,[U]:X})},te=async U=>{try{console.log("[TaxonomyView] validateAndSetTaxonomies called with:",{newTaxonomiesCount:U.length,newTaxonomies:U.map(X=>({id:X.id,name:X.name})),currentTaxonomiesCount:t.length,currentTaxonomies:t.map(X=>({id:X.id,name:X.name}))});for(let X=0;X<U.length;X++)try{console.log(`[TaxonomyView] Validating taxonomy ${X+1}/${U.length}:`,U[X].name),fu.parse(U[X]),console.log(`[TaxonomyView] Taxonomy "${U[X].name}" is valid`)}catch(ee){console.error(`[TaxonomyView] Taxonomy "${U[X].name}" validation failed:`,ee);const be=ee instanceof Error?ee.message:"Unknown validation error";return _({title:"Taxonomy Validation Error",description:`Taxonomy "${U[X].name}" is invalid: ${be}`,status:"error",duration:5e3,isClosable:!0}),!1}return console.log("[TaxonomyView] About to call setTaxonomies (parent update) with:",{newTaxonomiesCount:U.length,newTaxonomies:U.map(X=>({id:X.id,name:X.name}))}),e(U),console.log("[TaxonomyView] setTaxonomies (parent update) called successfully"),console.log("[TaxonomyView] All taxonomies validated and parent state updated successfully"),!0}catch(X){return console.error("[TaxonomyView] Unexpected error during validation:",X),_({title:"Validation Error",description:"An unexpected error occurred while validating the taxonomies",status:"error",duration:5e3,isClosable:!0}),!1}},K=async()=>{console.log("[TaxonomyView] handleSave called");const U=y.id&&y.id.trim()?y.id:wn("taxonomy");if(!y.name.trim()){_({title:"Name is required",status:"error",duration:2e3});return}const X=(y.terms||[]).map(de=>({...de,id:de.id&&de.id.trim()?de.id:wn("term"),name:de.name&&de.name.trim()?de.name:""}));if(X.some(de=>!de.name.trim())){_({title:"All terms must have a name",status:"error",duration:2e3});return}const ee=X.map(de=>de.id);if(new Set(ee).size!==ee.length){_({title:"Term IDs must be unique",status:"error",duration:2e3});return}const be=X.map(de=>de.name.trim().toLowerCase());if(new Set(be).size!==be.length){_({title:"Term names must be unique",status:"error",duration:2e3});return}const Se=[...t],Me={...y,id:U,terms:X,resolvedValueTypeIds:Array.isArray(y.resolvedValueTypeIds)?y.resolvedValueTypeIds:[]};if(console.log("[TaxonomyView] Creating new taxonomies array:",{currentCount:t.length,newTaxonomy:{id:U,name:y.name},editingIndex:m}),m!==null)Se[m]=Me,console.log("[TaxonomyView] Editing existing taxonomy at index:",m);else if(Se.push(Me),console.log("[TaxonomyView] Adding new taxonomy, new count:",Se.length),!T.includes(U)){const de=[...T,U];L.setTaxonomyOrder(de),P(de),window.dispatchEvent(new CustomEvent("token-model:data-change"))}if(console.log("[TaxonomyView] About to call validateAndSetTaxonomies with:",{newTaxonomiesCount:Se.length,newTaxonomies:Se.map(de=>({id:de.id,name:de.name}))}),!await te(Se)){console.log("[TaxonomyView] Validation failed, returning early");return}console.log("[TaxonomyView] Validation successful, closing dialog"),u(!1),g(null),_({title:"Taxonomy saved",status:"success",duration:2e3})},O=U=>{const X=t[U],ee=t.filter((se,de)=>de!==U),be=T.filter(se=>se!==X.id),Se=new Set(ee.map(se=>se.id)),Me=be.filter(se=>!Se.has(se));if(Me.length>0){console.log("Validation failed: Invalid taxonomy IDs after deletion:",Me),_({title:"Cannot Delete Taxonomy",description:`Invalid taxonomy IDs in order: ${Me.join(", ")}`,status:"error",duration:5e3,isClosable:!0});return}e(ee),L.setTaxonomyOrder(be),P(be),window.dispatchEvent(new CustomEvent("token-model:data-change")),_({title:"Taxonomy deleted",status:"info",duration:2e3})},Z=U=>{if(U!==null&&y.terms[U]){const X=y.terms[U];S({id:X.id,name:X.name,description:X.description||""})}else S({id:wn("term"),name:"",description:""});k(!0),C(U)},ie=()=>{k(!1),C(null)},ge=(U,X)=>{S(ee=>({...ee,[U]:X}))},xe=()=>{const U=I.id&&I.id.trim()?I.id:wn("term");if(!I.name.trim()){_({title:"Term name is required",status:"error",duration:2e3});return}const X=y.terms?[...y.terms]:[],ee=X.map(be=>be.name.trim().toLowerCase());if(A===null&&ee.includes(I.name.trim().toLowerCase())||A!==null&&ee.filter((be,Se)=>Se!==A).includes(I.name.trim().toLowerCase())){_({title:"Term names must be unique",status:"error",duration:2e3});return}A!==null?X[A]={...I,id:U}:X.push({...I,id:U}),v(be=>({...be,terms:X})),k(!1),C(null)},$=U=>{v(X=>({...X,terms:(X.terms||[]).filter((ee,be)=>be!==U)}))},B=[...t].sort((U,X)=>{if(!T||T.length===0)return console.log("No taxonomy order, using original order"),0;const ee=T.indexOf(U.id),be=T.indexOf(X.id);return ee===-1?1:be===-1?-1:ee-be});return console.log("[TaxonomyView] Sorting debug:",{taxonomiesCount:t.length,taxonomyOrderCount:(T==null?void 0:T.length)||0,taxonomyIds:t.map(U=>U.id),taxonomyOrder:T,sortedTaxonomiesCount:B.length,sortedTaxonomiesIds:B.map(U=>U.id)}),o.jsxs(z,{children:[o.jsx(E,{fontSize:"2xl",fontWeight:"bold",mb:2,children:"Taxonomies"}),o.jsx(E,{fontSize:"sm",color:"gray.600",mb:6,children:"Taxonomies help organize tokens into logical groups. Drag and drop to reorder taxonomies, which affects the order in generated token structures."}),o.jsxs(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:c==="dark"?"gray.900":"white",children:[l&&o.jsx(Oe,{size:"sm",leftIcon:o.jsx(xs,{}),onClick:()=>G(null),colorScheme:"blue",mb:4,children:"Add Taxonomy"}),l?o.jsx(sh,{onDragEnd:R,children:o.jsx(oh,{droppableId:"taxonomies",children:U=>o.jsxs(ce,{...U.droppableProps,ref:U.innerRef,align:"stretch",spacing:2,children:[B.map((X,ee)=>o.jsx(Tc,{draggableId:X.id,index:ee,children:(be,Se)=>o.jsx(z,{ref:be.innerRef,...be.draggableProps,p:3,borderWidth:1,borderRadius:"md",bg:c==="dark"?"gray.800":"gray.50",borderColor:c==="dark"?"gray.600":"gray.200",opacity:Se.isDragging?.8:1,children:o.jsxs(le,{justify:"space-between",align:"center",children:[o.jsxs(le,{spacing:2,children:[o.jsx(z,{w:"32px",textAlign:"center",fontWeight:"bold",color:"gray.500",children:ee+1}),o.jsx(z,{...be.dragHandleProps,cursor:"grab",children:o.jsx(zb,{})}),o.jsxs(z,{children:[o.jsx(_o,{title:X.name,cardType:"taxonomy"}),o.jsx(E,{fontSize:"sm",color:"gray.600",children:X.description}),o.jsxs(E,{fontSize:"xs",color:"gray.500",children:["ID: ",X.id]}),o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["Terms: ",X.terms.map(Me=>Me.name).join(", ")]}),Array.isArray(X.resolvedValueTypeIds)&&X.resolvedValueTypeIds.length>0&&o.jsx(Ra,{mt:2,spacing:2,children:X.resolvedValueTypeIds.map(Me=>{const se=a.find(de=>de.id===Me);return se?o.jsx(Yn,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"blue",children:o.jsx(Ni,{children:se.displayName})},Me):null})})]})]}),o.jsxs(le,{children:[o.jsx(Bt,{"aria-label":"Edit taxonomy",icon:o.jsx(ys,{}),size:"sm",onClick:()=>G(ee)}),o.jsx(Bt,{"aria-label":"Delete taxonomy",icon:o.jsx(As,{}),size:"sm",colorScheme:"red",onClick:()=>O(ee)})]})]})})},X.id)),U.placeholder]})})}):o.jsx(ce,{align:"stretch",spacing:2,children:B.map((U,X)=>o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:c==="dark"?"gray.800":"gray.50",borderColor:c==="dark"?"gray.600":"gray.200",children:o.jsx(le,{justify:"space-between",align:"center",children:o.jsxs(le,{spacing:2,children:[o.jsx(z,{w:"32px",textAlign:"center",fontWeight:"bold",color:"gray.500",children:X+1}),o.jsxs(z,{children:[o.jsx(_o,{title:U.name,cardType:"taxonomy"}),o.jsx(E,{fontSize:"sm",color:"gray.600",children:U.description}),o.jsxs(E,{fontSize:"xs",color:"gray.500",children:["ID: ",U.id]}),o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["Terms: ",U.terms.map(ee=>ee.name).join(", ")]}),Array.isArray(U.resolvedValueTypeIds)&&U.resolvedValueTypeIds.length>0&&o.jsx(Ra,{mt:2,spacing:2,children:U.resolvedValueTypeIds.map(ee=>{const be=a.find(Se=>Se.id===ee);return be?o.jsx(Yn,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"blue",children:o.jsx(Ni,{children:be.displayName})},ee):null})})]})]})})},U.id))})]}),o.jsx(iM,{open:d,onClose:ne,onSave:K,form:{...y,editingIndex:m},handleFormChange:he,handleTermDialogOpen:Z,handleTermDelete:$,resolvedValueTypes:Array.isArray(a)?a.map(U=>({id:U.id,name:U.displayName})):[]}),o.jsx(aM,{open:b,onClose:ie,onSave:xe,termForm:I,handleTermFormChange:ge,termEditIndex:A})]})}const _S=hr(["COLOR","DIMENSION","SPACING","FONT_FAMILY","FONT_WEIGHT","FONT_SIZE","LINE_HEIGHT","LETTER_SPACING","DURATION","CUBIC_BEZIER","BLUR","SPREAD","RADIUS"]),lM=ot({pattern:ye().optional(),minimum:$r().optional(),maximum:$r().optional(),allowedValues:mt(ye()).optional()}),cM=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),displayName:ye(),type:_S.optional(),description:ye().optional(),validation:lM.optional()}),dM=hr(["experimental","stable","deprecated"]),uM=hr(["PRIMITIVE","SEMANTIC","COMPONENT"]),hM=hr(["MOST_SPECIFIC_MATCH","DIMENSION_PRIORITY","NEAREST_PARENT","DEFAULT_VALUE"]),ef=ot({hex:ye().regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{8})$/),rgb:ot({r:$r().int().min(0).max(255),g:$r().int().min(0).max(255),b:$r().int().min(0).max(255),a:$r().min(0).max(1).optional()}).optional()}),Zs=En([ot({value:$r(),unit:hr(["px","rem","%","em","vh","vw","pt"])}),ye().regex(/^[0-9]+(\.[0-9]+)?(px|rem|%|em|vh|vw|pt)$/)]);En([ot({value:$r().min(0),unit:hr(["ms","s"])}),ye().regex(/^[0-9]+(\.[0-9]+)?(ms|s)$/)]);En([ot({x1:$r().min(0).max(1),y1:$r(),x2:$r().min(0).max(1),y2:$r()}),ye().regex(/^cubic-bezier\([0-9]*(\.[0-9]+)?, ?[0-9]*(\.[0-9]+)?, ?[0-9]*(\.[0-9]+)?, ?[0-9]*(\.[0-9]+)?\)$/)]);En([ot({offsetX:Zs,offsetY:Zs,blur:Zs,spread:Zs,color:ef,inset:en().optional()}),mt(ot({offsetX:Zs,offsetY:Zs,blur:Zs,spread:Zs,color:ef,inset:en().optional()})),ye().regex(/^([0-9]+(\.[0-9]+)?(px|rem) [0-9]+(\.[0-9]+)?(px|rem) [0-9]+(\.[0-9]+)?(px|rem) [0-9]+(\.[0-9]+)?(px|rem) (#[A-Fa-f0-9]{6}|rgba?\([0-9]+, ?[0-9]+, ?[0-9]+(, ?[0-9]+(\.[0-9]+)?)?\))( inset)?)(, ?[0-9]+(\.[0-9]+)?(px|rem) [0-9]+(\.[0-9]+)?(px|rem) [0-9]+(\.[0-9]+)?(px|rem) [0-9]+(\.[0-9]+)?(px|rem) (#[A-Fa-f0-9]{6}|rgba?\([0-9]+, ?[0-9]+, ?[0-9]+(, ?[0-9]+(\.[0-9]+)?)?\))( inset)?)*$/)]);ot({fontFamily:ye(),fontSize:Zs,fontWeight:En([$r().int().min(100).max(900).multipleOf(100),hr(["normal","bold","lighter","bolder"])]),lineHeight:En([$r(),Zs]).optional(),letterSpacing:Zs.optional(),textDecoration:hr(["none","underline","line-through","overline"]).optional(),textTransform:hr(["none","capitalize","uppercase","lowercase"]).optional()});En([ot({width:Zs,style:hr(["solid","dashed","dotted","double","groove","ridge","inset","outset","none"]),color:ef}),ye().regex(/^[0-9]+(\.[0-9]+)?(px|rem) (solid|dashed|dotted|double|groove|ridge|inset|outset|none) (#[A-Fa-f0-9]{6}|rgba?\([0-9]+, ?[0-9]+, ?[0-9]+(, ?[0-9]+(\.[0-9]+)?)?\))$/)]);const mM=En([ot({value:os()}),ot({tokenId:ye().regex(/^[a-zA-Z0-9-_]+$/)})]),pM=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),name:ye(),description:ye().optional(),dimensionId:ye().regex(/^[a-zA-Z0-9-_]+$/)}),fM=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),displayName:ye(),description:ye().optional(),modes:mt(pM).min(1),required:en().default(!1),defaultMode:ye(),resolvedValueTypeIds:mt(ye()).optional()}),gM=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),name:ye(),description:ye().optional(),resolvedValueTypeIds:mt(ye().regex(/^[a-zA-Z0-9-_]+$/)),private:en().default(!1),defaultModeIds:mt(ye().regex(/^[a-zA-Z0-9-_]+$/)).optional(),modeResolutionStrategy:ot({priorityByType:mt(ye()),fallbackStrategy:hM}).optional()}),yM=ot({platformId:ye(),value:ye(),metadata:Li(os()).optional()}),xM=ot({taxonomyId:ye(),termId:ye()}),k0=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),displayName:ye(),description:ye().optional(),tokenCollectionId:ye().regex(/^[a-zA-Z0-9-_]+$/).optional(),resolvedValueTypeId:ye().regex(/^[a-zA-Z0-9-_]+$/),private:en().default(!1),themeable:en().default(!1),status:dM.optional(),tokenTier:uM,generatedByAlgorithm:en().default(!1),algorithmId:ye().regex(/^[a-zA-Z0-9-_]+$/).optional(),taxonomies:mt(xM),propertyTypes:mt(ye()),valuesByMode:mt(ot({modeIds:mt(ye()),value:mM,metadata:Li(os()).optional(),platformOverrides:mt(yM).optional()})).describe("If any entry in valuesByMode has modeIds: [], it must be the only entry in the array. Otherwise, all entries must have modeIds.length > 0. This enforces that a token can have either a single global value or multiple mode-specific values, but not both.").min(1)}),vM=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),name:ye(),description:ye().optional(),tokenCollectionId:ye().regex(/^[a-zA-Z0-9-_]+$/),tokens:mt(k0)});ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),name:ye(),description:ye().optional(),tokenCollectionId:ye().regex(/^[a-zA-Z0-9-_]+$/),tokens:mt(k0)});const bM=hr(["","_","-",".","/"]),SM=ot({id:ye(),displayName:ye(),description:ye().optional(),syntaxPatterns:ot({prefix:ye().optional(),suffix:ye().optional(),delimiter:bM.optional(),capitalization:hr(["none","uppercase","lowercase","capitalize"]).optional(),formatString:ye().optional()}).optional(),valueFormatters:ot({color:hr(["hex","rgb","rgba","hsl","hsla"]).optional(),dimension:hr(["px","rem","em","pt","dp","sp"]).optional(),numberPrecision:$r().int().min(0).max(10).optional()}).optional()}),wM=ot({id:ye().regex(/^[a-zA-Z0-9-_]+$/),displayName:ye(),description:ye().optional(),isDefault:en()}),FS=ot({value:En([ye(),$r(),en()]),tokenId:ye().regex(/^[a-zA-Z0-9-_]+$/).optional()}),CM=ot({platformId:ye(),value:FS}),kM=ot({tokenId:ye().regex(/^[a-zA-Z0-9-_]+$/),value:FS,platformOverrides:mt(CM).optional()}),IM=Li(mt(kM)),jM=ot({id:ye(),name:ye(),description:ye().optional()}),TM=ot({id:ye(),name:ye(),description:ye(),terms:mt(jM),resolvedValueTypeIds:mt(ye()).optional()}),EM=ot({emptyModeIds:hr(["mapToDefaults","preserveEmpty","requireExplicit"]),preserveOriginalValues:en()}),MM=ot({version:ye(),dimensions:mt(ye().regex(/^[a-zA-Z0-9-_]+$/)),date:ye(),migrationStrategy:EM.optional()}),AM=ot({whenAdding:ye().regex(/^[a-zA-Z0-9-_]+$/),mapEmptyModeIdsTo:mt(ye().regex(/^[a-zA-Z0-9-_]+$/)),preserveDefaultValues:en().optional()}),PM=ot({rules:mt(AM)});ot({systemName:ye(),systemId:ye().regex(/^[a-zA-Z0-9-_]+$/),description:ye().optional(),version:ye(),versionHistory:mt(MM),dimensionEvolution:PM.optional(),dimensions:mt(fM),dimensionOrder:mt(ye().regex(/^[a-zA-Z0-9-_]+$/)).optional(),tokenCollections:mt(gM),tokens:mt(k0),platforms:mt(SM),themes:mt(wM).optional(),themeOverrides:IM.optional(),taxonomies:mt(TM),resolvedValueTypes:mt(cM),extensions:ot({tokenGroups:mt(vM).optional(),tokenVariants:Li(os()).optional()}).optional()}).refine(t=>{if(!t.dimensionOrder)return!0;const e=new Set(t.dimensions.map(r=>r.id));return t.dimensionOrder.every(r=>e.has(r))},{message:"All dimensionOrder IDs must match existing dimension IDs",path:["dimensionOrder"]});function VS({valueTypes:t,onUpdate:e,tokens:r,collections:n,dimensions:s,platforms:i,taxonomies:a,themes:l,canEdit:c=!1}){const{colorMode:d}=Vt(),[u,m]=M.useState(!1),[g,y]=M.useState(null),[v,I]=M.useState(""),[S,b]=M.useState("CUSTOM"),[k,A]=M.useState({}),C=Hr(),T=t.filter(K=>!g||K.id!==g.id).map(K=>K.type).filter(K=>!!K),P=Object.values(_S.enum).filter(K=>!T.includes(K)),_=()=>{y(null),I(""),b("CUSTOM"),m(!0)},R=K=>{y(K),I(K.displayName),b(K.type||"CUSTOM"),m(!0)},G=K=>{const O=JSON.parse(localStorage.getItem("token-model:data")||"{}"),Z=O.systemName||"Design Token System",ie=O.systemId||"default-system-id",ge={tokenCollections:n,dimensions:s,tokens:r,platforms:i,taxonomies:a,themes:l,resolvedValueTypes:K,version:"1.0.0",versionHistory:[],systemName:Z,systemId:ie},xe=Aa.validateData(ge);if(!xe.isValid){console.error("[ValueTypesView] Schema validation failed:",{errors:xe.errors,data:ge});const $=Array.isArray(xe.errors)?xe.errors.map(B=>typeof B=="string"?B:JSON.stringify(B)).join(", "):"See console for details.";return C({title:"Schema Validation Failed",description:`Your change would make the data invalid: ${$}`,status:"error",duration:4e3,isClosable:!0}),!1}return e(K),!0},ne=()=>{if(A({}),!v.trim()){A({name:"Name is required"}),C({title:"Required Field Missing",description:"Value type name is required.",status:"error",duration:4e3,isClosable:!0});return}if(!S){A({type:"Type is required"}),C({title:"Required Field Missing",description:"Value type must be selected.",status:"error",duration:4e3,isClosable:!0});return}const K={id:v.trim().toLowerCase().replace(/\s+/g,"-"),displayName:v.trim(),...S!=="CUSTOM"?{type:S}:{}};if(g){const O=t.map(Z=>Z.id===g.id?K:Z);if(!G(O))return;C({title:"Value Type Updated",description:`Successfully updated value type "${K.displayName}"`,status:"success",duration:3e3,isClosable:!0})}else{const O=[...t,K];if(!G(O))return;C({title:"Value Type Created",description:`Successfully created value type "${K.displayName}"`,status:"success",duration:3e3,isClosable:!0})}m(!1)},he=()=>{m(!1)},te=K=>{const O=t.filter(Z=>Z.id!==K.id);G(O)&&C({title:"Value Type Deleted",description:`Successfully deleted value type "${K.displayName}"`,status:"info",duration:3e3,isClosable:!0})};return o.jsxs(z,{children:[o.jsx(E,{fontSize:"2xl",fontWeight:"bold",mb:4,children:"Value Types"}),o.jsxs(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:d==="dark"?"gray.900":"white",children:[c&&o.jsx(Oe,{size:"sm",onClick:_,colorScheme:"blue",mb:4,leftIcon:o.jsx(xs,{}),children:"Create New Value Type"}),o.jsx(ce,{align:"stretch",spacing:2,children:t.map(K=>o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:d==="dark"?"gray.800":"gray.50",borderColor:d==="dark"?"gray.600":"gray.200",children:o.jsxs(le,{justify:"space-between",align:"center",children:[o.jsxs(z,{children:[o.jsx(_o,{title:K.displayName,cardType:K.type||"Custom"}),o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["Type: ",K.type||"Custom"]})]}),c&&o.jsxs(le,{children:[o.jsx(Bt,{"aria-label":"Edit value type",icon:o.jsx(ys,{}),size:"sm",onClick:()=>R(K)}),o.jsx(Bt,{"aria-label":"Delete value type",icon:o.jsx(As,{}),size:"sm",colorScheme:"red",onClick:()=>te(K)})]})]})},K.id))})]}),o.jsxs(Zr,{isOpen:u,onClose:he,children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:g?"Edit Value Type":"Create Value Type"}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,children:[o.jsxs(Ye,{isInvalid:!!k.name,children:[o.jsx(Qe,{children:"Name"}),o.jsx(yt,{value:v,onChange:K=>I(K.target.value),placeholder:"Enter value type name"}),k.name&&o.jsx(Jd,{children:k.name})]}),o.jsxs(Ye,{isInvalid:!!k.type,children:[o.jsx(Qe,{children:"Type"}),o.jsxs(Kt,{value:S,onChange:K=>b(K.target.value),children:[o.jsx("option",{value:"CUSTOM",children:"Custom"}),P.map(K=>o.jsx("option",{value:K,children:K},K))]}),k.type&&o.jsx(Jd,{children:k.type})]})]})}),o.jsxs(rn,{children:[o.jsx(Oe,{variant:"ghost",mr:3,onClick:he,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:ne,children:"Save"})]})]})]})]})}function NM({themes:t,setThemes:e,canEdit:r=!1}){var b,k;const{colorMode:n}=Vt(),[s,i]=M.useState(!1),[a,l]=M.useState(null),[c,d]=M.useState({id:"",displayName:"",description:"",isDefault:!1,status:"active"}),u=Hr(),m=(A=null)=>{l(A),d(A!==null?t[A]:{id:"",displayName:"",description:"",isDefault:!1,status:"active"}),i(!0)},g=()=>{i(!1),l(null)},y=(A,C)=>{d(T=>({...T,[A]:C}))},v=A=>(e(A),!0),I=()=>{if(!c.displayName.trim()){u({title:"Required Field Missing",description:"Display name is required for themes.",status:"error",duration:4e3,isClosable:!0});return}const A=c.id||c.displayName.trim().replace(/\s+/g,"_").toLowerCase();if(!c.id&&t.some(P=>P.id===A)){u({title:"Duplicate Theme",description:"A theme with this name already exists. Please choose a different name.",status:"error",duration:4e3,isClosable:!0});return}const C=[...t],T={...c,id:A,isDefault:c.isDefault};a!==null?C[a]=T:C.push(T),T.isDefault&&C.forEach(P=>{P.id!==T.id&&(P.isDefault=!1)}),v(C),i(!1),l(null),u({title:"Theme Saved",description:`Successfully ${a!==null?"updated":"created"} theme "${c.displayName}"`,status:"success",duration:3e3,isClosable:!0})},S=A=>{const C=t[A],T=t.filter((P,_)=>_!==A);v(T),u({title:"Theme Deleted",description:`Successfully deleted theme "${C.displayName}"`,status:"info",duration:3e3,isClosable:!0})};return o.jsxs(z,{children:[o.jsx(E,{fontSize:"2xl",fontWeight:"bold",mb:4,children:"Themes"}),o.jsxs(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:n==="dark"?"gray.900":"white",children:[r&&o.jsx(Oe,{leftIcon:o.jsx(xs,{}),size:"sm",onClick:()=>m(null),colorScheme:"blue",mb:4,children:"Add Theme"}),o.jsx(ce,{align:"stretch",spacing:2,children:t.map((A,C)=>o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:n==="dark"?"gray.800":"gray.50",borderColor:n==="dark"?"gray.600":"gray.200",children:o.jsxs(le,{justify:"space-between",align:"center",children:[o.jsxs(z,{children:[o.jsx(E,{fontSize:"lg",fontWeight:"medium",children:A.displayName}),o.jsx(E,{fontSize:"sm",color:n==="dark"?"gray.400":"gray.600",children:A.description||""}),o.jsxs(le,{spacing:2,mt:1,children:[A.isDefault&&o.jsx(Yn,{colorScheme:"green",size:"sm",children:"Default"}),A.status==="deprecated"&&o.jsx(Yn,{colorScheme:"red",size:"sm",children:"Deprecated"}),A.overrideSource&&o.jsx(Yn,{colorScheme:"blue",size:"sm",children:"External"})]})]}),r&&o.jsxs(le,{children:[o.jsx(Bt,{"aria-label":"Edit theme",icon:o.jsx(ys,{}),size:"sm",onClick:()=>m(C),colorScheme:n==="dark"?"blue":"gray"}),o.jsx(Bt,{"aria-label":"Delete theme",icon:o.jsx(As,{}),size:"sm",colorScheme:"red",onClick:()=>S(C)})]})]})},A.id))})]}),o.jsxs(Zr,{isOpen:s,onClose:g,size:"lg",children:[o.jsx(Dr,{}),o.jsxs(Xr,{bg:n==="dark"?"gray.900":"white",children:[o.jsx(Rr,{children:a!==null?"Edit Theme":"Add Theme"}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Display Name"}),o.jsx(yt,{value:c.displayName,onChange:A=>y("displayName",A.target.value),bg:n==="dark"?"gray.700":"white"})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(yt,{value:c.description||"",onChange:A=>y("description",A.target.value),bg:n==="dark"?"gray.700":"white"})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Default Theme"}),o.jsx(Oe,{colorScheme:c.isDefault?"green":"gray",onClick:()=>y("isDefault",!c.isDefault),size:"sm",children:c.isDefault?"Default Theme":"Set as Default"})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Status"}),o.jsxs(Kt,{value:c.status||"active",onChange:A=>y("status",A.target.value),bg:n==="dark"?"gray.700":"white",children:[o.jsx("option",{value:"active",children:"Active"}),o.jsx("option",{value:"deprecated",children:"Deprecated"})]}),o.jsx(Xd,{children:"Lifecycle status of this theme"})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"External Theme Override"}),o.jsxs(ce,{spacing:2,align:"stretch",children:[o.jsx(yt,{placeholder:"Repository URI (e.g., owner/repo)",value:((b=c.overrideSource)==null?void 0:b.repositoryUri)||"",onChange:A=>{var P;const C=A.target.value,T=((P=c.overrideSource)==null?void 0:P.filePath)||"";d(_=>({..._,overrideSource:C&&T?{repositoryUri:C,filePath:T}:void 0}))},bg:n==="dark"?"gray.700":"white"}),o.jsx(yt,{placeholder:"File path (e.g., theme-dark.json)",value:((k=c.overrideSource)==null?void 0:k.filePath)||"",onChange:A=>{var P;const C=((P=c.overrideSource)==null?void 0:P.repositoryUri)||"",T=A.target.value;d(_=>({..._,overrideSource:C&&T?{repositoryUri:C,filePath:T}:void 0}))},bg:n==="dark"?"gray.700":"white"})]}),o.jsx(Xd,{children:"Optional: Reference to external theme override file"})]})]})}),o.jsxs(rn,{children:[o.jsx(Oe,{variant:"ghost",mr:3,onClick:g,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:I,children:"Save"})]})]})]})]})}const DM=({themes:t,setThemes:e,canEdit:r=!1})=>o.jsx(no,{title:"Themes",description:"Manage design system themes and their configurations. Themes allow you to create different visual variations of your design system.",children:o.jsx(NM,{themes:t,setThemes:e,canEdit:r})});class $S{static validatePlatformExtension(e){const r=[],n=[];if((!e.systemId||typeof e.systemId!="string")&&r.push("systemId is required and must be a string"),(!e.platformId||typeof e.platformId!="string")&&r.push("platformId is required and must be a string"),(!e.version||typeof e.version!="string")&&r.push("version is required and must be a string"),e.syntaxPatterns&&typeof e.syntaxPatterns=="object"){const s=e.syntaxPatterns;s.delimiter&&typeof s.delimiter=="string"&&(["","_","-",".","/"].includes(s.delimiter)||r.push('syntaxPatterns.delimiter must be one of: "", "_", "-", ".", "/"')),s.capitalization&&typeof s.capitalization=="string"&&(["camel","uppercase","lowercase","capitalize"].includes(s.capitalization)||r.push('syntaxPatterns.capitalization must be one of: "camel", "uppercase", "lowercase", "capitalize"'))}if(e.valueFormatters&&typeof e.valueFormatters=="object"){const s=e.valueFormatters;s.color&&typeof s.color=="string"&&(["hex","rgb","rgba","hsl","hsla"].includes(s.color)||r.push('valueFormatters.color must be one of: "hex", "rgb", "rgba", "hsl", "hsla"')),s.dimension&&typeof s.dimension=="string"&&(["px","rem","em","pt","dp","sp"].includes(s.dimension)||r.push('valueFormatters.dimension must be one of: "px", "rem", "em", "pt", "dp", "sp"')),s.numberPrecision!==void 0&&(typeof s.numberPrecision!="number"||s.numberPrecision<0||s.numberPrecision>10)&&r.push("valueFormatters.numberPrecision must be a number between 0 and 10")}return e.algorithmVariableOverrides&&Array.isArray(e.algorithmVariableOverrides)&&e.algorithmVariableOverrides.forEach((i,a)=>{if(typeof i!="object"||i===null){r.push(`algorithmVariableOverrides[${a}] must be an object`);return}const l=i;(!l.algorithmId||typeof l.algorithmId!="string")&&r.push(`algorithmVariableOverrides[${a}].algorithmId is required and must be a string`),(!l.variableId||typeof l.variableId!="string")&&r.push(`algorithmVariableOverrides[${a}].variableId is required and must be a string`),(!l.valuesByMode||!Array.isArray(l.valuesByMode))&&r.push(`algorithmVariableOverrides[${a}].valuesByMode is required and must be an array`)}),e.tokenOverrides&&Array.isArray(e.tokenOverrides)&&e.tokenOverrides.forEach((i,a)=>{if(typeof i!="object"||i===null){r.push(`tokenOverrides[${a}] must be an object`);return}const l=i;(!l.id||typeof l.id!="string")&&r.push(`tokenOverrides[${a}].id is required and must be a string`),(!l.valuesByMode||!Array.isArray(l.valuesByMode))&&r.push(`tokenOverrides[${a}].valuesByMode is required and must be an array`)}),e.omittedModes&&Array.isArray(e.omittedModes)&&e.omittedModes.forEach((i,a)=>{typeof i!="string"&&r.push(`omittedModes[${a}] must be a string`)}),e.omittedDimensions&&Array.isArray(e.omittedDimensions)&&e.omittedDimensions.forEach((i,a)=>{typeof i!="string"&&r.push(`omittedDimensions[${a}] must be a string`)}),{isValid:r.length===0,errors:r,warnings:n}}static validateCompatibility(e,r){const n=[],s=[],i=e.systemId,a=r.systemId;i&&a&&i!==a&&n.push(`Extension systemId (${i}) does not match core systemId (${a})`);const l=e.platformId,c=r.platforms||[];if(l&&!c.find(d=>d.id===l)&&n.push(`Extension platformId (${l}) not found in core platforms`),e.tokenOverrides&&Array.isArray(e.tokenOverrides)){const d=r.tokens||[];e.tokenOverrides.forEach(m=>{m.id&&!d.find(g=>g.id===m.id)&&s.push(`Token override references non-existent core token: ${m.id}`)})}return{isValid:n.length===0,errors:n,warnings:s}}}const Du=({syntaxPatterns:t,onSyntaxPatternsChange:e,onSyntaxPatternChange:r,preview:n,isReadOnly:s=!1,title:i="Syntax Patterns",showTitle:a=!0})=>{const{colorMode:l}=Vt(),c=(m,g)=>{const y={...t,[m]:g};e(y),r&&r(m,g)},d=n||(()=>{const{prefix:m="",suffix:g="",delimiter:y="",capitalization:v="none"}=t;let I="color-primary-500";switch(v){case"uppercase":I=I.toUpperCase();break;case"lowercase":I=I.toLowerCase();break;case"capitalize":I=I.split("-").map(S=>S.charAt(0).toUpperCase()+S.slice(1)).join("-");break}return y&&(I=I.replace(/-/g,y)),`${m}${I}${g}`})(),u=n||d;return s?o.jsxs(ce,{spacing:6,align:"stretch",children:[a&&o.jsxs(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:[i," (Read-only from source file)"]}),o.jsx(z,{p:4,borderWidth:1,borderRadius:"md",bg:l==="dark"?"gray.800":"gray.50",borderColor:l==="dark"?"gray.600":"gray.200",children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:3,color:"gray.500",children:"Naming Patterns"}),o.jsxs(ce,{spacing:3,align:"stretch",children:[o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Prefix:"}),o.jsx(E,{fontSize:"sm",fontFamily:"mono",color:"gray.800",bg:"gray.100",px:2,py:1,borderRadius:"sm",children:(t==null?void 0:t.prefix)||"None"})]}),o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Suffix:"}),o.jsx(E,{fontSize:"sm",fontFamily:"mono",color:"gray.800",bg:"gray.100",px:2,py:1,borderRadius:"sm",children:(t==null?void 0:t.suffix)||"None"})]}),o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Delimiter:"}),o.jsx(E,{fontSize:"sm",fontFamily:"mono",color:"gray.800",bg:"gray.100",px:2,py:1,borderRadius:"sm",children:(t==null?void 0:t.delimiter)||"None"})]}),o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Capitalization:"}),o.jsx(E,{fontSize:"sm",fontFamily:"mono",color:"gray.800",bg:"gray.100",px:2,py:1,borderRadius:"sm",children:(t==null?void 0:t.capitalization)||"None"})]}),o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Format String:"}),o.jsx(E,{fontSize:"sm",fontFamily:"mono",color:"gray.800",bg:"gray.100",px:2,py:1,borderRadius:"sm",children:(t==null?void 0:t.formatString)||"None"})]})]})]}),o.jsxs(z,{mt:2,p:3,borderWidth:1,borderRadius:"md",bg:l==="dark"?"gray.700":"gray.100",children:[o.jsx(E,{fontSize:"sm",color:"gray.500",mb:1,fontWeight:"bold",children:"Token name formatting preview"}),o.jsx(E,{fontFamily:"mono",fontSize:"md",wordBreak:"break-all",children:u})]})]})})]}):o.jsxs(ce,{spacing:6,align:"stretch",children:[a&&o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:i}),o.jsxs(z,{p:3,borderWidth:1,borderRadius:"md",bg:l==="dark"?"gray.800":"gray.50",borderColor:l==="dark"?"gray.600":"gray.200",children:[o.jsxs(le,{spacing:4,align:"flex-end",children:[o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Prefix"}),o.jsx(yt,{value:(t==null?void 0:t.prefix)||"",onChange:m=>c("prefix",m.target.value),placeholder:"e.g., TKN_"})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Suffix"}),o.jsx(yt,{value:(t==null?void 0:t.suffix)||"",onChange:m=>c("suffix",m.target.value),placeholder:"e.g., _SUF"})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Delimiter"}),o.jsxs(Kt,{value:(t==null?void 0:t.delimiter)||"",onChange:m=>c("delimiter",m.target.value),children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"_",children:"Underscore (_)"}),o.jsx("option",{value:"-",children:"Hyphen (-)"}),o.jsx("option",{value:".",children:"Dot (.)"}),o.jsx("option",{value:"/",children:"Slash (/)"})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Capitalization"}),o.jsxs(Kt,{value:(t==null?void 0:t.capitalization)??"none",onChange:m=>c("capitalization",m.target.value),children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"uppercase",children:"UPPERCASE"}),o.jsx("option",{value:"lowercase",children:"lowercase"}),o.jsx("option",{value:"capitalize",children:"Capitalize"})]})]})]}),o.jsxs(ce,{spacing:3,align:"stretch",mt:4,children:[o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Format String"}),o.jsx(yt,{value:(t==null?void 0:t.formatString)||"",onChange:m=>c("formatString",m.target.value),placeholder:"e.g., {prefix}{name}{suffix}",width:"100%"})]}),o.jsxs(z,{mt:2,p:3,borderWidth:1,borderRadius:"md",bg:l==="dark"?"gray.700":"gray.100",children:[o.jsx(E,{fontSize:"sm",color:"gray.500",mb:1,fontWeight:"bold",children:"Preview"}),o.jsx(E,{fontFamily:"mono",fontSize:"md",wordBreak:"break-all",children:u})]})]})]})]})},tf=({valueFormatters:t,onValueFormattersChange:e,isReadOnly:r=!1,title:n="Value Formatters"})=>{const{colorMode:s}=Vt(),i=(a,l)=>{e({...t,[a]:l})};return r?o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsxs(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:[n," (Read-only from source file)"]}),o.jsx(z,{p:4,borderWidth:1,borderRadius:"md",bg:s==="dark"?"gray.800":"gray.50",borderColor:s==="dark"?"gray.600":"gray.200",children:o.jsx(ce,{spacing:4,align:"stretch",children:o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:3,color:"gray.500",children:"Value Formatting"}),o.jsxs(ce,{spacing:3,align:"stretch",children:[o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Color Format:"}),o.jsx(E,{fontSize:"sm",fontFamily:"mono",color:"gray.800",bg:"gray.100",px:2,py:1,borderRadius:"sm",children:(t==null?void 0:t.color)||"hex"})]}),o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Dimension Unit:"}),o.jsx(E,{fontSize:"sm",fontFamily:"mono",color:"gray.800",bg:"gray.100",px:2,py:1,borderRadius:"sm",children:(t==null?void 0:t.dimension)||"px"})]}),o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Number Precision:"}),o.jsx(E,{fontSize:"sm",fontFamily:"mono",color:"gray.800",bg:"gray.100",px:2,py:1,borderRadius:"sm",children:(t==null?void 0:t.numberPrecision)||2})]})]})]})})})]}):o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:n}),o.jsxs(le,{spacing:4,children:[o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Color Format"}),o.jsxs(Kt,{value:(t==null?void 0:t.color)||"hex",onChange:a=>i("color",a.target.value),children:[o.jsx("option",{value:"hex",children:"Hex"}),o.jsx("option",{value:"rgb",children:"RGB"}),o.jsx("option",{value:"rgba",children:"RGBA"}),o.jsx("option",{value:"hsl",children:"HSL"}),o.jsx("option",{value:"hsla",children:"HSLA"})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Dimension Unit"}),o.jsxs(Kt,{value:(t==null?void 0:t.dimension)||"px",onChange:a=>i("dimension",a.target.value),children:[o.jsx("option",{value:"px",children:"px"}),o.jsx("option",{value:"rem",children:"rem"}),o.jsx("option",{value:"em",children:"em"}),o.jsx("option",{value:"pt",children:"pt"}),o.jsx("option",{value:"dp",children:"dp"}),o.jsx("option",{value:"sp",children:"sp"})]})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Number Precision"}),o.jsx(yt,{type:"number",min:0,max:10,value:(t==null?void 0:t.numberPrecision)||2,onChange:a=>i("numberPrecision",parseInt(a.target.value))})]})]})};class al{static validateUniqueExtensionSources(){const e={isValid:!0,errors:[],warnings:[],duplicateSources:[]};try{const r=L.getPlatforms(),n=new Map;r.forEach(s=>{if(s.extensionSource){const i=`${s.extensionSource.repositoryUri}:${s.extensionSource.filePath}`;n.has(i)||n.set(i,[]),n.get(i).push({platformId:s.id,displayName:s.displayName,source:s.extensionSource})}}),n.forEach((s,i)=>{s.length>1&&(e.isValid=!1,e.errors.push(`Duplicate extension source found: ${i}. Used by platforms: ${s.map(a=>a.displayName).join(", ")}`),e.duplicateSources=e.duplicateSources||[],e.duplicateSources.push(...s))})}catch(r){e.isValid=!1,e.errors.push(`Validation error: ${r instanceof Error?r.message:"Unknown error"}`)}return e}static isExtensionSourceInUse(e,r,n){try{const i=L.getPlatforms().find(a=>n&&a.id===n?!1:a.extensionSource&&a.extensionSource.repositoryUri===e&&a.extensionSource.filePath===r);return i?{inUse:!0,existingPlatform:{id:i.id,displayName:i.displayName}}:{inUse:!1}}catch(s){return console.error("Error checking extension source usage:",s),{inUse:!1}}}static validateExtensionSource(e,r,n){if(!e.trim())return{isValid:!1,error:"Repository URI is required"};if(!r.trim())return{isValid:!1,error:"File path is required"};const s=this.isExtensionSourceInUse(e,r,n);return s.inUse&&s.existingPlatform?{isValid:!1,error:`This file is already linked to platform "${s.existingPlatform.displayName}" (${s.existingPlatform.id})`}:{isValid:!0}}static async validateExternalRepository(e,r,n="main"){try{return console.log(`[PlatformSourceValidationService] Validating external repository: ${e}/${r}`),await xt.getFileContent(e,r,n),{exists:!0}}catch(s){return console.warn("[PlatformSourceValidationService] External repository validation failed:",s),s instanceof Error?s.message.includes("404")||s.message.includes("Not Found")?{exists:!1,error:"Repository or file not found. The repository may have been moved or deleted."}:{exists:!1,error:`Failed to access repository: ${s.message}`}:{exists:!1,error:"Failed to validate external repository"}}}static async validateLocalFile(e,r,n){try{console.log(`[PlatformSourceValidationService] Validating local file: ${e}`);const s=xt.getSelectedRepositoryInfo();if(!s)return{exists:!1,error:"No repository selected. Please load a file from GitHub first."};try{return await xt.getFileContent(s.fullName,e,s.branch),{exists:!0}}catch{console.log(`[PlatformSourceValidationService] File not found at ${e}, searching for it...`);const a=await this.findPlatformExtensionFile(s.fullName,s.branch,r,n);return a?{exists:!0,updatedPath:a}:{exists:!1,error:"Platform extension file not found. The file may have been moved or deleted."}}}catch(s){return console.error("[PlatformSourceValidationService] Local file validation failed:",s),{exists:!1,error:s instanceof Error?s.message:"Failed to validate local file"}}}static async findPlatformExtensionFile(e,r,n,s){try{console.log(`[PlatformSourceValidationService] Searching for platform extension file: ${n} in ${s}`);const a=(await xt.scanRepositoryForValidFiles(e,r,s)).filter(l=>l.type==="platform-extension");console.log(`[PlatformSourceValidationService] Found ${a.length} platform extension files`);for(const l of a)try{const c=await xt.getFileContent(e,l.path,r);if(c&&c.content){const d=JSON.parse(c.content);if(d.platformId===n&&d.systemId===s)return console.log(`[PlatformSourceValidationService] Found matching file: ${l.path}`),l.path}}catch(c){console.warn(`[PlatformSourceValidationService] Failed to parse file ${l.path}:`,c);continue}return console.log("[PlatformSourceValidationService] No matching platform extension file found"),null}catch(i){return console.error("[PlatformSourceValidationService] Failed to search for platform extension file:",i),null}}}const RM=({isOpen:t,onClose:e,onSave:r,currentDataType:n})=>{const[s,i]=M.useState({type:"platform-extension",repositoryUri:"",branch:"main",filePath:"",systemId:"",platformId:"",displayName:"",description:"",workflow:"link-existing",newFileName:"platform-extension.json",newRepositoryName:"",newRepositoryDescription:"",newRepositoryVisibility:"public",syntaxPatterns:{prefix:"",suffix:"",delimiter:"_",capitalization:"none",formatString:""},valueFormatters:{color:"hex",dimension:"px",numberPrecision:2}}),[a,l]=M.useState({}),c=Hr(),{colorMode:d}=Vt(),u=M.useRef(null),m=M.useRef(null),g=M.useRef(null),y=M.useRef(null),[v,I]=M.useState([]),[S,b]=M.useState([]),[k,A]=M.useState([]),[C,T]=M.useState([]),[P,_]=M.useState(null),[R,G]=M.useState(null),[ne,he]=M.useState(""),[te,K]=M.useState(null),[O,Z]=M.useState(!1),[ie,ge]=M.useState(null),[xe,$]=M.useState(""),[B,U]=M.useState(null),X=/^[a-zA-Z0-9._-]{1,100}$/,[ee,be]=M.useState(!1),[Se,Me]=M.useState(null),se=[{title:"Source",description:"Select repository and workflow"},{title:"Settings",description:"Configure platform settings"}],{activeStep:de,setActiveStep:fe}=Nw({index:0,count:se.length}),_e=()=>L.getRootData().systemId||"system-default",Y=()=>wn("platform"),Ce=()=>{const Ie=_e();i({type:"platform-extension",repositoryUri:"",branch:"main",filePath:"",systemId:Ie,platformId:"",displayName:"",description:"",workflow:"link-existing",newFileName:"platform-extension.json",newRepositoryName:"",newRepositoryDescription:"",newRepositoryVisibility:"public",syntaxPatterns:{prefix:"",suffix:"",delimiter:"_",capitalization:"none",formatString:""},valueFormatters:{color:"hex",dimension:"px",numberPrecision:2}}),_(null),G(null),he(""),K(null),b([]),A([]),T([]),l({}),$(""),Z(!1),ge(null),U(null),be(!1),Me(null),fe(0)},ue=()=>{Ce(),e()};M.useEffect(()=>{if((s.workflow==="create-file"||s.workflow==="create-repository")&&s.type==="platform-extension"&&!s.platformId){const Ie=Y();i(We=>({...We,platformId:Ie}))}},[s.workflow,s.type]);const Ee=async(Ie=!1)=>{Z(!0),ge("orgs"),$("");try{Ie&&(qr.clearAll(),U(qr.getCacheStats()));const We=await xt.getOrganizations();I(We),We.length>0&&(_(We[0]),await ze(We[0],Ie)),U(qr.getCacheStats())}catch(We){console.error("Failed to load organizations:",We),$("Failed to load organizations. Please try again."),c({title:"Error",description:"Failed to load organizations from GitHub.",status:"error",duration:5e3,isClosable:!0})}finally{Z(!1),ge(null)}},ze=async(Ie,We=!1)=>{Z(!0),ge("repos"),$("");try{We&&(qr.clearAll(),U(qr.getCacheStats()));const Et=(await xt.getRepositories()).filter(et=>et.full_name.split("/")[0]===Ie.login);b(Et),U(qr.getCacheStats())}catch(lt){console.error("Failed to load repositories:",lt),$("Failed to load repositories. Please try again."),c({title:"Error",description:"Failed to load repositories from GitHub.",status:"error",duration:5e3,isClosable:!0})}finally{Z(!1),ge(null)}},De=async Ie=>{const We=v.find(lt=>lt.login===Ie);We&&(_(We),G(null),he(""),T([]),K(null),$(""),await ze(We),setTimeout(()=>{m.current&&m.current.focus()},100))},Ke=async Ie=>{const We=S.find(lt=>lt.full_name===Ie);if(We){G(We),he(""),T([]),K(null),$(""),Z(!0),ge("branches");try{const lt=await xt.getBranches(We.full_name);A(lt),lt.find(et=>et.name==="main")?(he("main"),await Te(We.full_name,"main"),setTimeout(()=>{y.current&&y.current.focus()},100)):setTimeout(()=>{g.current&&g.current.focus()},100),U(qr.getCacheStats())}catch(lt){console.error("Failed to load branches:",lt),$("Failed to load branches. Please try again."),c({title:"Error",description:"Failed to load branches from GitHub.",status:"error",duration:5e3,isClosable:!0}),setTimeout(()=>{m.current&&m.current.focus()},100)}finally{Z(!1),ge(null)}}},ve=async Ie=>{R&&(he(Ie),T([]),K(null),$(""),await Te(R.full_name,Ie),setTimeout(()=>{y.current&&y.current.focus()},100))},Te=async(Ie,We)=>{Z(!0),ge("files");try{const lt=_e(),Et=await xt.scanRepositoryForValidFiles(Ie,We,s.type==="platform-extension"?lt:void 0),et=s.type==="platform-extension"?"platform-extension":"schema",pt=Et.filter(Wt=>Wt.type===et);T(pt),pt.length>0?(console.log("ðŸ” [DEBUG] Auto-selecting first file:",pt[0].path),K(pt[0]),i(Wt=>({...Wt,repositoryUri:Ie,branch:We,filePath:pt[0].path})),console.log("ðŸ” [DEBUG] Calling handleFileSelect for auto-selected file"),await Ct(pt[0].path),setTimeout(()=>{y.current&&y.current.focus()},100)):setTimeout(()=>{y.current&&y.current.focus()},100)}catch(lt){console.error("Failed to load files:",lt),$("Failed to load files. Please try again."),setTimeout(()=>{g.current&&g.current.focus()},100)}finally{Z(!1),ge(null)}},je=async()=>{P&&(c({title:"Refreshing Cache",description:"Clearing cached data and fetching fresh information...",status:"info",duration:2e3,isClosable:!0}),await Ee(!0))},Fe=()=>B?B.validEntries===0?"No cached data":B.expiredEntries>0?`${B.validEntries} valid, ${B.expiredEntries} expired`:`${B.validEntries} cached items`:"Unknown";M.useEffect(()=>{console.log("ðŸ” [DEBUG] formData changed:",{platformId:s.platformId,displayName:s.displayName,description:s.description,workflow:s.workflow,filePath:s.filePath})},[s.platformId,s.displayName,s.description,s.workflow,s.filePath]),M.useEffect(()=>{if(t){Ce();const We=(()=>{switch(n){case"core":return[{value:"platform-extension",label:"Platform Extension",description:"Link to a platform-specific extension repository"}];case"extension":return[{value:"core",label:"Core Data",description:"Link to the main core data repository"}];case"theme":return[{value:"core",label:"Core Data",description:"Link to the main core data repository"}];default:return[]}})(),lt=We.length>0?We[0].value:"platform-extension";i(Et=>({...Et,type:lt})),v.length===0&&Ee()}},[t,n]),M.useEffect(()=>{t&&U(qr.getCacheStats())},[t]),M.useEffect(()=>{if(!t){const Ie=setTimeout(()=>{Ce()},100);return()=>clearTimeout(Ie)}},[t]),M.useEffect(()=>{if(O){const We=setTimeout(()=>{if(!O){let lt=null;switch(ie){case"orgs":lt=u;break;case"repos":lt=m;break;case"branches":lt=g;break;case"files":lt=y;break;default:te?lt=y:ne?lt=g:R?lt=m:P&&(lt=u)}lt!=null&&lt.current&&setTimeout(()=>{var Et;(Et=lt.current)==null||Et.focus()},50)}},100);return()=>clearTimeout(We)}},[O,ie,P,R,ne,te]);const Je=(()=>{switch(n){case"core":return[{value:"platform-extension",label:"Platform Extension",description:"Link to a platform-specific extension repository"}];case"extension":return[{value:"core",label:"Core Data",description:"Link to the main core data repository"}];case"theme":return[{value:"core",label:"Core Data",description:"Link to the main core data repository"}];default:return[]}})(),ut=M.useMemo(()=>{if(s.type!=="platform-extension")return"";const{prefix:Ie="",suffix:We="",delimiter:lt="",capitalization:Et="none"}=s.syntaxPatterns||{};let et="primary-color-background";switch(Et){case"uppercase":et=et.toUpperCase();break;case"lowercase":et=et.toLowerCase();break;case"capitalize":et=et.split("-").map(pt=>pt.charAt(0).toUpperCase()+pt.slice(1)).join("-");break}return lt&&lt!==""?et=et.replace(/-/g,lt):et=et.replace(/-/g,""),`${Ie}${et}${We}`},[s.syntaxPatterns,s.type]);console.log("[ExtensionCreateDialog] Debug info:",{currentDataType:n,availableTypes:Je,availableTypesLength:Je.length,formDataType:s.type,currentSystemId:_e(),workflow:s.workflow});const Ze=()=>{var We,lt,Et;const Ie={};switch(s.workflow){case"link-existing":if(s.repositoryUri.trim()||(Ie.repositoryUri="Repository URI is required"),s.branch.trim()||(Ie.branch="Branch is required"),s.filePath.trim()||(Ie.filePath="File path is required"),s.repositoryUri.trim()&&s.filePath.trim()){const et=al.validateExtensionSource(s.repositoryUri,s.filePath);et.isValid||(Ie.filePath=et.error||"This extension source is already in use by another platform")}break;case"create-file":(We=s.newFileName)!=null&&We.trim()||(Ie.newFileName="File name is required");break;case"create-repository":(lt=s.newRepositoryName)!=null&&lt.trim()||(Ie.newRepositoryName="Repository name is required");break}return s.type==="platform-extension"&&((Et=s.displayName)!=null&&Et.trim()||(Ie.displayName="Display name is required for platform extensions")),l(Ie),Object.keys(Ie).length===0},At=Ie=>Ie.trim()?X.test(Ie)?null:"Repository name can only contain letters, numbers, hyphens, underscores, and periods (1-100 chars)":"Repository name is required",gr=async Ie=>{be(!0),Me(null);try{return(await xt.getRepositories()).some(lt=>lt.name.toLowerCase()===Ie.toLowerCase())}catch{return Me("Failed to check if repository exists. Please try again."),!1}finally{be(!1)}},vr=async()=>{var We,lt,Et;const Ie={};switch(de){case 0:switch(s.workflow){case"link-existing":s.repositoryUri.trim()||(Ie.repositoryUri="Repository URI is required"),s.branch.trim()||(Ie.branch="Branch is required"),s.filePath.trim()||(Ie.filePath="File path is required");break;case"create-file":(We=s.newFileName)!=null&&We.trim()||(Ie.newFileName="File name is required");break;case"create-repository":{const et=At(s.newRepositoryName||"");if(et)return Ie.newRepositoryName=et,l(Ie),!1;if(!ee&&await gr(s.newRepositoryName||""))return Ie.newRepositoryName="A repository with this name already exists.",l(Ie),!1;break}}break;case 1:s.type==="platform-extension"&&((lt=s.displayName)!=null&&lt.trim()||(Ie.displayName="Display name is required for platform extensions"),s.workflow==="link-existing"&&!((Et=s.platformId)!=null&&Et.trim())&&(Ie.platformId="Platform ID is required"));break}return l(Ie),Object.keys(Ie).length===0},yr=async()=>{if(await vr())de<se.length-1&&fe(de+1);else{const We=Object.values(a).filter(Boolean),lt=We.length>0?`Please fix: ${We.join(", ")}`:"Please fix the errors before continuing";c({title:"Validation Error",description:lt,status:"error",duration:5e3,isClosable:!0})}},gt=()=>{de>0&&fe(de-1)},Dt=()=>{if(!Ze()){const Ie=Object.values(a).filter(Boolean),We=Ie.length>0?`Please fix: ${Ie.join(", ")}`:"Please fix the errors before saving";c({title:"Validation Error",description:We,status:"error",duration:5e3,isClosable:!0});return}try{if(s.type==="platform-extension"){const Ie={systemId:s.systemId,platformId:s.platformId,version:"1.0.0",syntaxPatterns:s.syntaxPatterns,valueFormatters:s.valueFormatters},We=$S.validatePlatformExtension(Ie);if(!We.isValid)throw new Error(`Validation failed: ${We.errors.join(", ")}`);We.warnings.length>0&&console.warn("Platform extension warnings:",We.warnings)}}catch(Ie){c({title:"Schema Validation Error",description:Ie instanceof Error?Ie.message:"Invalid data structure",status:"error",duration:5e3,isClosable:!0});return}r(s),Ce(),e()},Ct=async Ie=>{var lt,Et,et,pt,Wt,In,Mn,An,ts;console.log("ðŸ” [DEBUG] handleFileSelect called with filePath:",Ie);const We=C.find(jn=>jn.path===Ie);if(console.log("ðŸ” [DEBUG] Found file in validFiles:",We),K(We||null),console.log("ðŸ” [DEBUG] Set selectedFile to:",We||null),We){console.log("ðŸ” [DEBUG] File found, updating formData with filePath:",We.path);const jn=al.validateExtensionSource(R.full_name,We.path);if(!jn.isValid){$(jn.error||"Invalid extension source"),c({title:"Validation Error",description:jn.error||"This extension source is already in use",status:"error",duration:5e3,isClosable:!0});return}i(Be=>{const w={...Be,filePath:We.path};return console.log("ðŸ” [DEBUG] Updated formData with filePath:",w),w});try{console.log("ðŸ” [DEBUG] Starting file content extraction..."),Z(!0),ge("files"),console.log("ðŸ” [DEBUG] Calling GitHubApiService.getFileContent with:",{repo:R.full_name,path:We.path,branch:ne});const Be=await xt.getFileContent(R.full_name,We.path,ne);if(console.log("ðŸ” [DEBUG] File response received:",{hasContent:!!(Be!=null&&Be.content),contentLength:((lt=Be==null?void 0:Be.content)==null?void 0:lt.length)||0,response:Be}),Be&&Be.content){console.log("ðŸ” [DEBUG] Parsing JSON content...");const w=JSON.parse(Be.content);console.log("ðŸ” [DEBUG] Parsed fileData:",w);const N=w.platformId;console.log("ðŸ” [DEBUG] Extracted platformId:",N);const Le=((Et=w.metadata)==null?void 0:Et.name)||w.displayName||((et=w.metadata)==null?void 0:et.displayName)||w.name;console.log("ðŸ” [DEBUG] Extracted displayName:",Le,"from sources:",{"metadata.name":(pt=w.metadata)==null?void 0:pt.name,displayName:w.displayName,"metadata.displayName":(Wt=w.metadata)==null?void 0:Wt.displayName,name:w.name});const V=((In=w.metadata)==null?void 0:In.description)||w.description||((Mn=w.metadata)==null?void 0:Mn.desc);console.log("ðŸ” [DEBUG] Extracted description:",V,"from sources:",{"metadata.description":(An=w.metadata)==null?void 0:An.description,description:w.description,"metadata.desc":(ts=w.metadata)==null?void 0:ts.desc});const ae=w.syntaxPatterns;console.log("ðŸ” [DEBUG] Extracted syntaxPatterns:",ae);const er=w.valueFormatters;console.log("ðŸ” [DEBUG] Extracted valueFormatters:",er),console.log("ðŸ” [DEBUG] About to update formData with extracted values:",{platformId:N,displayName:Le,description:V,syntaxPatterns:ae,valueFormatters:er}),i(Ar=>{const yn={...Ar,platformId:N||Ar.platformId,displayName:Le||Ar.displayName,description:V||Ar.description,syntaxPatterns:ae||Ar.syntaxPatterns,valueFormatters:er||Ar.valueFormatters};return console.log("ðŸ” [DEBUG] Updated formData:",yn),yn});const it=[];N&&it.push(`platformId: ${N}`),Le&&it.push(`displayName: ${Le}`),V&&it.push(`description: ${V}`),ae&&it.push("syntax patterns"),er&&it.push("value formatters"),console.log("ðŸ” [DEBUG] Extracted fields for toast:",it),it.length>0?(console.log("ðŸ” [DEBUG] Showing success toast with extracted fields"),c({title:"File Data Extracted",description:`Found: ${it.join(", ")}`,status:"success",duration:3e3,isClosable:!0})):(console.log("ðŸ” [DEBUG] No fields extracted, showing warning toast"),c({title:"No Data Found",description:"Could not extract platform data from the selected file. Please fill in the fields manually.",status:"warning",duration:4e3,isClosable:!0}))}else console.log("ðŸ” [DEBUG] No file content received from API")}catch(Be){console.error("ðŸ” [DEBUG] Error during file extraction:",Be),c({title:"Warning",description:"Could not extract platform data from the selected file. Please fill in the fields manually.",status:"warning",duration:4e3,isClosable:!0})}finally{console.log("ðŸ” [DEBUG] File extraction complete, setting loading to false"),Z(!1),ge(null)}}else console.log("ðŸ” [DEBUG] No file found for filePath:",Ie)},Qt=()=>o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Source location"}),o.jsx(Zd,{value:s.workflow,onChange:Ie=>i({...s,workflow:Ie}),children:o.jsxs(Bv,{spacing:3,children:[o.jsx(To,{value:"link-existing",children:o.jsxs(le,{spacing:2,children:[o.jsx(On,{as:Lb}),o.jsxs(ce,{align:"start",spacing:0,children:[o.jsx(E,{fontWeight:"medium",children:"Link Existing Extension"}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:"Connect to an existing platform extension repository"})]})]})}),o.jsx(To,{value:"create-file",children:o.jsxs(le,{spacing:2,children:[o.jsx(On,{as:Vb}),o.jsxs(ce,{align:"start",spacing:0,children:[o.jsx(E,{fontWeight:"medium",children:"Create Extension File"}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:"Create a new platform extension file in the current repository"})]})]})}),o.jsx(To,{value:"create-repository",children:o.jsxs(le,{spacing:2,children:[o.jsx(On,{as:$b}),o.jsxs(ce,{align:"start",spacing:0,children:[o.jsx(E,{fontWeight:"medium",children:"Create New Repository"}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:"Create a new repository with scaffolded platform extension structure"})]})]})})]})})]}),Zt=()=>o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Repository Settings"}),xe&&o.jsxs(zt,{status:"error",children:[o.jsx(Lt,{}),o.jsx(E,{children:xe})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"Organization"}),o.jsx(Kt,{value:(P==null?void 0:P.login)||"",onChange:Ie=>De(Ie.target.value),isDisabled:O,placeholder:"Select organization",ref:u,children:v.map(Ie=>o.jsx("option",{value:Ie.login,children:Ie.name||Ie.login},Ie.login))})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"Repository"}),o.jsx(Kt,{value:(R==null?void 0:R.full_name)||"",onChange:Ie=>Ke(Ie.target.value),isDisabled:O||!P,placeholder:"Select repository",ref:m,children:S.map(Ie=>o.jsx("option",{value:Ie.full_name,children:Ie.name},Ie.full_name))})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"Branch"}),o.jsx(Kt,{value:ne,onChange:Ie=>ve(Ie.target.value),isDisabled:O||!R,placeholder:"Select branch",ref:g,children:k.map(Ie=>o.jsx("option",{value:Ie.name,children:Ie.name},Ie.name))})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"File"}),o.jsx(Kt,{value:(te==null?void 0:te.path)||"",onChange:Ie=>Ct(Ie.target.value),isDisabled:O||!ne,placeholder:"Select file",ref:y,children:C.map(Ie=>o.jsxs("option",{value:Ie.path,children:[Ie.name," (",Ie.type,")"]},Ie.path))}),C.length===0&&ne&&!O&&o.jsx(E,{fontSize:"sm",color:"gray.500",mt:1,children:s.type==="platform-extension"?`No platform extension files found with matching systemId: ${_e()}`:`No ${s.type} files found in this branch`})]}),O&&o.jsxs(le,{justify:"center",py:4,children:[o.jsx(kn,{size:"sm"}),o.jsxs(E,{fontSize:"sm",children:[ie==="orgs"&&"Loading organizations...",ie==="repos"&&"Loading repositories...",ie==="branches"&&"Loading branches...",ie==="files"&&"Scanning files..."]})]}),o.jsxs(le,{justify:"space-between",align:"center",children:[o.jsx(E,{fontSize:"sm",color:"gray.500",children:s.type==="platform-extension"?`Looking for platform extension files with systemId: ${_e()}`:`Looking for ${s.type} files`}),o.jsxs(le,{spacing:2,children:[B&&o.jsx(wt,{colorScheme:B.validEntries>0?"green":"gray",variant:"subtle",fontSize:"xs",children:Fe()}),o.jsx(Cn,{label:"Refresh cache and fetch latest data",children:o.jsx(Bt,{"aria-label":"Refresh cache",icon:o.jsx(gI,{}),size:"sm",variant:"ghost",onClick:je,isLoading:O})})]})]})]}),at=()=>o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"File Settings"}),o.jsxs(Ye,{isRequired:!0,isInvalid:!!a.newFileName,children:[o.jsx(Qe,{children:"File Name"}),o.jsx(yt,{value:s.newFileName,onChange:Ie=>i({...s,newFileName:Ie.target.value}),placeholder:"platform-extension.json"}),o.jsx(E,{fontSize:"xs",color:"gray.500",mt:1,children:"File will be created in the platforms/ directory following repository scaffolding standards"})]})]}),Q=()=>o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Repository Settings"}),o.jsxs(Ye,{isRequired:!0,isInvalid:!!a.newRepositoryName||!!Se,children:[o.jsx(Qe,{children:"Repository Name"}),o.jsx(yt,{value:s.newRepositoryName,onChange:Ie=>{i({...s,newRepositoryName:Ie.target.value}),l({...a,newRepositoryName:void 0}),Me(null)},placeholder:"my-platform-extension",onBlur:async()=>{const Ie=s.newRepositoryName||"",We=At(Ie);if(We){l({...a,newRepositoryName:We});return}if(Ie){be(!0);const lt=await gr(Ie);be(!1),lt&&l({...a,newRepositoryName:"A repository with this name already exists."})}},isDisabled:ee}),ee&&o.jsxs(le,{mt:2,children:[o.jsx(kn,{size:"xs"}),o.jsx(E,{fontSize:"xs",children:"Checking availabilityâ€¦"})]}),a.newRepositoryName&&o.jsx(E,{color:"red.500",fontSize:"xs",children:a.newRepositoryName}),Se&&o.jsx(E,{color:"red.500",fontSize:"xs",children:Se}),o.jsxs(E,{fontSize:"xs",color:"gray.500",mt:1,children:["Repository will be created as: ",s.newRepositoryName?`${s.newRepositoryName}`:"your-org/repo-name"]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(yt,{value:s.newRepositoryDescription,onChange:Ie=>i({...s,newRepositoryDescription:Ie.target.value}),placeholder:"Platform-specific design tokens and overrides"})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Visibility"}),o.jsxs(Kt,{value:s.newRepositoryVisibility,onChange:Ie=>i({...s,newRepositoryVisibility:Ie.target.value}),children:[o.jsx("option",{value:"public",children:"Public"}),o.jsx("option",{value:"private",children:"Private"})]})]}),o.jsxs(zt,{status:"info",size:"sm",children:[o.jsx(Lt,{}),"Repository will be scaffolded with proper directory structure and initial platform extension file"]})]}),Ae=()=>(console.log("ðŸ” [DEBUG] renderPlatformFields called with formData:",{platformId:s.platformId,displayName:s.displayName,description:s.description,workflow:s.workflow}),o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Platform Extension Settings"}),o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:d==="dark"?"gray.800":"gray.50",borderColor:d==="dark"?"gray.600":"gray.200",children:o.jsxs(ce,{spacing:3,align:"stretch",children:[o.jsxs(Ye,{isRequired:!0,isInvalid:!!a.displayName,children:[o.jsx(Qe,{children:"Display Name"}),o.jsx(yt,{value:s.displayName||"",onChange:Ie=>{console.log("ðŸ” [DEBUG] Display Name input changed to:",Ie.target.value),i({...s,displayName:Ie.target.value})},placeholder:"iOS Platform"}),o.jsxs(E,{fontSize:"xs",color:"gray.500",mt:1,children:["Current value: ",s.displayName||"empty"]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(yt,{value:s.description||"",onChange:Ie=>{console.log("ðŸ” [DEBUG] Description input changed to:",Ie.target.value),i({...s,description:Ie.target.value})},placeholder:"Platform-specific extensions for iOS"}),o.jsxs(E,{fontSize:"xs",color:"gray.500",mt:1,children:["Current value: ",s.description||"empty"]})]})]})}),s.workflow==="link-existing"?o.jsxs(Ye,{isRequired:!0,isInvalid:!!a.platformId,children:[o.jsx(Qe,{children:"Platform ID"}),o.jsx(yt,{value:s.platformId||"",onChange:Ie=>{console.log("ðŸ” [DEBUG] Platform ID input changed to:",Ie.target.value),i({...s,platformId:Ie.target.value})},placeholder:"e.g., platform-ios, platform-android"}),o.jsx(E,{fontSize:"xs",color:"gray.500",mt:1,children:"Platform ID from the selected file will be auto-populated"})]}):o.jsxs(z,{p:3,borderWidth:1,borderRadius:"md",bg:d==="dark"?"gray.800":"gray.50",borderColor:d==="dark"?"gray.600":"gray.200",children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:2,children:"Platform ID"}),o.jsx(E,{fontSize:"sm",color:"gray.500",fontFamily:"mono",children:s.platformId||"Generating..."}),o.jsx(E,{fontSize:"xs",color:"gray.400",mt:1,children:"Auto-generated unique identifier for the new platform extension"})]}),o.jsxs(z,{p:3,borderWidth:1,borderRadius:"md",bg:d==="dark"?"gray.800":"gray.50",borderColor:d==="dark"?"gray.600":"gray.200",children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:2,children:"System ID"}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:s.systemId||_e()}),o.jsx(E,{fontSize:"xs",color:"gray.400",mt:1,children:"Auto-populated from current system"})]})]})),oe=()=>{switch(s.workflow){case"link-existing":return Zt();case"create-file":return at();case"create-repository":return Q();default:return null}},Ne=()=>{switch(s.workflow){case"link-existing":return"Link Platform";case"create-file":return"Create Platform Extension File";case"create-repository":return"Create Repository & PlatformExtension";default:return"Add Platform"}},st=()=>o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsx(Du,{syntaxPatterns:s.syntaxPatterns||{prefix:"",suffix:"",delimiter:"",capitalization:"none",formatString:""},onSyntaxPatternsChange:()=>{},preview:ut,isReadOnly:!0,title:"Syntax Patterns"}),o.jsx(on,{}),o.jsx(tf,{valueFormatters:s.valueFormatters||{color:"hex",dimension:"px",numberPrecision:2},onValueFormattersChange:()=>{},isReadOnly:!0,title:"Value Formatters"})]}),tt=()=>{switch(de){case 0:return o.jsxs(ce,{spacing:6,align:"stretch",children:[Je.length===0&&o.jsxs(zt,{status:"warning",children:[o.jsx(Lt,{}),"No extension types available for current data type (",n,")"]}),Qt(),o.jsx(on,{}),oe()]});case 1:return o.jsx(ce,{spacing:6,align:"stretch",children:s.type==="platform-extension"&&o.jsxs(o.Fragment,{children:[Ae(),o.jsx(on,{}),s.workflow==="link-existing"?st():o.jsxs(o.Fragment,{children:[o.jsx(Du,{syntaxPatterns:s.syntaxPatterns||{prefix:"",suffix:"",delimiter:"_",capitalization:"camel",formatString:""},onSyntaxPatternsChange:Ie=>{i(We=>({...We,syntaxPatterns:Ie}))},preview:ut,isReadOnly:!1,title:"Syntax Patterns"}),o.jsx(on,{}),o.jsx(tf,{valueFormatters:s.valueFormatters||{color:"hex",dimension:"px",numberPrecision:2},onValueFormattersChange:Ie=>{i(We=>({...We,valueFormatters:Ie}))},isReadOnly:!1,title:"Value Formatters"})]})]})});default:return null}};return o.jsxs(Zr,{isOpen:t,onClose:ue,size:"xl",children:[o.jsx(Dr,{}),o.jsxs(Xr,{maxW:"900px",children:[o.jsx(Rr,{children:n==="core"?"Add Platform":"Link Core Repository"}),o.jsx(Or,{children:o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsx(Dw,{index:de,orientation:"horizontal",gap:"0",mb:5,children:se.map((Ie,We)=>o.jsxs(Rw,{children:[o.jsx(Ow,{children:o.jsx(_w,{complete:o.jsx(Fw,{}),incomplete:o.jsx(hy,{}),active:o.jsx(hy,{})})}),o.jsxs(z,{flexShrink:"0",children:[o.jsx(Vw,{children:Ie.title}),o.jsx($w,{children:Ie.description})]}),o.jsx(zw,{})]},We))}),tt()]})}),o.jsxs(rn,{children:[o.jsx(Oe,{variant:"ghost",mr:3,onClick:ue,children:"Cancel"}),de>0&&o.jsx(Oe,{variant:"ghost",mr:3,onClick:gt,children:"Previous"}),de<se.length-1?o.jsx(Oe,{colorScheme:"blue",onClick:yr,children:"Next"}):o.jsx(Oe,{colorScheme:"blue",onClick:Dt,isDisabled:Je.length===0,children:Ne()})]})]})]})};class Nx{static async createPlatformExtensionRepository(e){try{throw console.log("Repository creation config:",e),new Error('Repository creation not yet implemented. Please create the repository manually on GitHub and then use the "Link Existing Extension" workflow.')}catch(r){throw console.error("Failed to create scaffolded repository:",r),new Error(`Failed to create repository: ${r instanceof Error?r.message:"Unknown error"}`)}}static async createRepositoryStructure(e,r,n){const s=this.generateRepositoryFiles(n);for(let i=0;i<s.length;i++){const a=s[i],l=i===0?`Initial commit: Scaffold platform extension repository for ${n.platformId}`:`Add ${a.path} for platform extension repository`;try{await xt.createFile(r,a.path,a.content,"main",l)}catch(c){if(c instanceof Error&&(c.message.includes("409")||c.message.includes("Conflict")))console.log(`File ${a.path} already exists, updating instead...`),await xt.createOrUpdateFile(r,a.path,a.content,"main",`Update ${a.path} for platform extension repository`);else throw c}}}static generateRepositoryFiles(e){const r=[],n=this.generatePlatformExtensionFile(e);r.push({path:"platforms/platform-extension.json",content:n});const s=this.generateReadmeFile(e);r.push({path:"README.md",content:s});const i=this.generateGitignoreFile();return r.push({path:".gitignore",content:i}),r}static generatePlatformExtensionFile(e){const r={systemId:e.systemId,platformId:e.platformId,version:"1.0.0",figmaFileKey:`${e.platformId}-figma-file`,metadata:{name:e.displayName||e.platformId,description:e.description||`Platform extension for ${e.platformId}`,maintainer:"",lastUpdated:new Date().toISOString().split("T")[0],repositoryVisibility:e.visibility},syntaxPatterns:e.syntaxPatterns||{prefix:"",suffix:"",delimiter:"_",capitalization:"camel",formatString:""},valueFormatters:e.valueFormatters||{color:"hex",dimension:"px",numberPrecision:2},algorithmVariableOverrides:[],tokenOverrides:[],omittedModes:[],omittedDimensions:[]};return JSON.stringify(r,null,2)}static generateReadmeFile(e){return`# ${e.displayName||e.platformId} Platform Extension

${e.description||`Platform-specific design tokens and overrides for ${e.platformId}`}

## Overview

This repository contains platform-specific extensions and overrides for the ${e.systemId} design system.

## Structure

\`\`\`
${e.name}/
â”œâ”€â”€ platform-extension.json     # Main platform extension file
â”œâ”€â”€ .figma/                     # Figma integration metadata
â”‚   â”œâ”€â”€ mappings/               # Token to variable mappings
â”‚   â”œâ”€â”€ cache/                  # Cached data
â”‚   â””â”€â”€ config/                 # Export configuration
â””â”€â”€ README.md                   # This file
\`\`\`

## Usage

This platform extension is automatically loaded by the design system manager when linked to the core system.

## Development

1. Edit \`platform-extension.json\` to add platform-specific tokens and overrides
2. Commit and push changes
3. The design system manager will automatically sync changes

## Schema

This repository follows the [Platform Extension Schema](https://designsystem.org/schemas/platform-extension/v1.0.0).

## Support

For questions or issues, please contact the platform team or create an issue in this repository.
`}static generateGitignoreFile(){return`# Dependencies
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Build outputs
dist/
build/
*.tsbuildinfo

# Environment variables
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# IDE files
.vscode/
.idea/
*.swp
*.swo

# OS files
.DS_Store
Thumbs.db

# Logs
logs
*.log

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Coverage directory used by tools like istanbul
coverage/

# Temporary folders
tmp/
temp/
`}static generateFigmaDirectoryFiles(e){const r=[];r.push({path:".figma/.gitkeep",content:""}),r.push({path:".figma/mappings/.gitkeep",content:""}),r.push({path:".figma/cache/.gitkeep",content:""}),r.push({path:".figma/config/.gitkeep",content:""});const n={systemId:e.systemId,platformId:e.platformId,lastUpdated:new Date().toISOString(),settings:{includeComments:!0,includeMetadata:!1,minifyOutput:!1}};return r.push({path:".figma/config/export-settings.json",content:JSON.stringify(n,null,2)}),r}static generatePlatformsDirectoryFiles(){const e=[];return e.push({path:"platforms/.gitkeep",content:""}),e}static async createPlatformExtensionFile(e,r,n){try{const s=this.generatePlatformExtensionFile(r),i=xt.getSelectedRepositoryInfo();if(!i)throw new Error("No repository selected. Please select a repository first.");const a=`platforms/${e}`;await xt.createFile(i.fullName,a,s,i.branch,n||`Add platform extension file: ${e}`)}catch(s){throw console.error("Failed to create platform extension file:",s),new Error(`Failed to create file: ${s instanceof Error?s.message:"Unknown error"}`)}}static async createAdditionalDirectoryStructure(e,r){try{const n=this.generateFigmaDirectoryFiles(r),s=this.generatePlatformsDirectoryFiles(),i=[...n,...s];for(let a=0;a<i.length;a++){const l=i[a];try{await xt.createFile(e,l.path,l.content,"main",`Add ${l.path} for directory structure`)}catch(c){if(c instanceof Error&&(c.message.includes("409")||c.message.includes("Conflict")))console.log(`File ${l.path} already exists, skipping...`);else throw c}}}catch(n){console.error("Failed to create additional directory structure:",n)}}}class Dx{static async createRepository(e){try{const r=await this.createGitHubRepository(e);await this.scaffoldRepository(r,e);let n;return e.schemaType!=="platform-extension"?n=await this.createInitialSchemaFile(r,e):n="platforms/platform-extension.json",{...r,schemaType:e.schemaType,initialFilePath:n}}catch(r){throw console.error("Repository creation failed:",r),new Error(`Failed to create repository: ${r instanceof Error?r.message:"Unknown error"}`)}}static async createGitHubRepository(e){try{if(!await Yt.getCurrentUser())throw new Error("GitHub authentication required. Please sign in to GitHub first.");const n=await xt.createRepository({name:e.name,description:e.description||"Design system repository",private:e.visibility==="private",autoInit:!0,organization:e.organization});return{id:n.id,name:n.name,fullName:n.full_name,description:n.description,visibility:n.private?"private":"public",htmlUrl:n.html_url,cloneUrl:n.clone_url,defaultBranch:n.default_branch}}catch(r){throw console.error("GitHub repository creation failed:",r),new Error(`Failed to create GitHub repository: ${r instanceof Error?r.message:"Unknown error"}`)}}static async scaffoldRepository(e,r){try{const n={name:r.name,systemId:r.systemId||this.getCurrentSystemId(),platformId:r.platformId||this.generatePlatformId(),displayName:r.name,description:r.description||`Design tokens for ${r.schemaType}`,visibility:r.visibility};switch(r.schemaType){case"platform-extension":{await this.createPlatformExtensionFile(e.fullName,n);try{await Nx.createAdditionalDirectoryStructure(e.fullName,n)}catch(s){console.warn("Failed to create additional directory structure:",s)}break}case"core":{console.warn("Core repository scaffolding not yet implemented");break}case"theme-override":{console.warn("Theme override repository scaffolding not yet implemented");break}default:throw new Error(`Unsupported schema type: ${r.schemaType}`)}}catch(n){throw console.error("Repository scaffolding failed:",n),new Error(`Repository created successfully, but scaffolding failed. You can manually create the required files. Error: ${n instanceof Error?n.message:"Unknown error"}`)}}static async createInitialSchemaFile(e,r){try{const n=r.systemId||this.getCurrentSystemId();let s,i,a,l;switch(r.schemaType){case"platform-extension":a=r.platformId||this.generatePlatformId(),s="platforms/platform-extension.json",i=this.generatePlatformExtensionSchema(n,a,r);break;case"core":s="design-system.json",i=this.generateCoreSchema(n,r);break;case"theme-override":l=r.themeId||this.generateThemeId(),s="theme-override.json",i=this.generateThemeOverrideSchema(n,l,r);break;default:throw new Error(`Unsupported schema type: ${r.schemaType}`)}return await xt.createFile(e.fullName,s,i,e.defaultBranch,`Add initial ${r.schemaType} schema file`),s}catch(n){throw console.error("Initial schema file creation failed:",n),new Error(`Repository created and scaffolded, but initial schema file creation failed. You can manually create the schema file. Error: ${n instanceof Error?n.message:"Unknown error"}`)}}static generatePlatformExtensionSchema(e,r,n){const s={systemId:e,platformId:r,version:"1.0.0",figmaFileKey:`${r}-figma-file`,metadata:{name:n.name,description:n.description||`Platform extension for ${r}`,maintainer:"",lastUpdated:new Date().toISOString().split("T")[0],repositoryVisibility:n.visibility},syntaxPatterns:{prefix:"",suffix:"",delimiter:"_",capitalization:"camel",formatString:""},valueFormatters:{color:"hex",dimension:"px",numberPrecision:2},algorithmVariableOverrides:[],tokenOverrides:[],omittedModes:[],omittedDimensions:[]};return JSON.stringify(s,null,2)}static generateCoreSchema(e,r){const n={systemId:e,version:"1.0.0",figmaConfiguration:{syntaxPatterns:{prefix:"",suffix:"",delimiter:"_",capitalization:"camel",formatString:""},fileKey:"default-design-system-figma"},metadata:{name:r.name,description:r.description||"Core design system tokens",maintainer:"",lastUpdated:new Date().toISOString().split("T")[0],repositoryVisibility:r.visibility},platforms:[],dimensions:[],modes:[],resolvedValueTypes:[],tokens:[],collections:[],taxonomies:[],algorithms:[],taxonomyOrder:[]};return JSON.stringify(n,null,2)}static generateThemeOverrideSchema(e,r,n){const s={systemId:e,themeId:r,version:"1.0.0",metadata:{name:n.name,description:n.description||`Theme override for ${r}`,maintainer:"",lastUpdated:new Date().toISOString().split("T")[0],repositoryVisibility:n.visibility},tokenOverrides:[],platformOverrides:[]};return JSON.stringify(s,null,2)}static getCurrentSystemId(){return L.getRootData().systemId||"system-default"}static generatePlatformId(){return wn("platform")}static generateThemeId(){return wn("theme")}static async createPlatformExtensionFile(e,r){try{const n=Nx.generateRepositoryFiles(r);for(let s=0;s<n.length;s++){const i=n[s],a=s===0?`Initial commit: Scaffold platform extension repository for ${r.platformId}`:`Add ${i.path} for platform extension repository`;try{await xt.createFile(e,i.path,i.content,"main",a)}catch(l){if(l instanceof Error&&(l.message.includes("409")||l.message.includes("Conflict")))console.log(`File ${i.path} already exists, updating instead...`),await xt.createOrUpdateFile(e,i.path,i.content,"main",`Update ${i.path} for platform extension repository`);else throw l}}}catch(n){throw console.error("Failed to create platform extension file:",n),new Error(`Failed to create platform extension file: ${n instanceof Error?n.message:"Unknown error"}`)}}static validateConfig(e){var n;const r=[];return(n=e.name)!=null&&n.trim()?/^[a-zA-Z0-9-_]+$/.test(e.name)||r.push("Repository name can only contain letters, numbers, hyphens, and underscores"):r.push("Repository name is required"),e.schemaType?["core","platform-extension","theme-override"].includes(e.schemaType)||r.push("Invalid schema type. Must be one of: core, platform-extension, theme-override"):r.push("Schema type is required"),e.visibility?["public","private"].includes(e.visibility)||r.push("Invalid visibility. Must be one of: public, private"):r.push("Repository visibility is required"),{isValid:r.length===0,errors:r}}}const OM=({isOpen:t,onClose:e,onRepositoryCreated:r,schemaType:n="platform-extension",prefillData:s={}})=>{const[i,a]=M.useState({name:s.name||"",description:s.description||"",visibility:"public",organization:"",schemaType:n,systemId:s.systemId,platformId:s.platformId,themeId:s.themeId}),[l,c]=M.useState({}),[d,u]=M.useState([]),[m,g]=M.useState(!1),[y,v]=M.useState("idle"),[I,S]=M.useState(0),[b,k]=M.useState(null),A=Hr(),{colorMode:C}=Vt();M.useEffect(()=>{t&&(T(),a({name:s.name||"",description:s.description||"",visibility:"public",organization:"",schemaType:n,systemId:s.systemId,platformId:s.platformId,themeId:s.themeId}),c({}),v("idle"),S(0),k(null))},[t,n,s]);const T=async()=>{try{const K=await xt.getOrganizations();if(u(K),K.length>0){const O=K.find(Z=>Z.type==="User");O&&a(Z=>({...Z,organization:O.login}))}}catch(K){console.error("Failed to load organizations:",K),A({title:"Error",description:"Failed to load organizations from GitHub.",status:"error",duration:5e3,isClosable:!0})}},P=()=>{const K=Dx.validateConfig(i);if(!K.isValid){const O={};return K.errors.forEach(Z=>{Z.includes("name")&&(O.name=Z),Z.includes("schema type")&&(O.schemaType=Z),Z.includes("visibility")&&(O.visibility=Z)}),c(O),!1}return c({}),!0},_=async()=>{if(!P()){A({title:"Validation Error",description:"Please fix the errors before creating the repository",status:"error",duration:3e3,isClosable:!0});return}if(!Yt.getCurrentUser()){A({title:"Authentication Required",description:"Please authenticate with GitHub first",status:"error",duration:5e3,isClosable:!0});return}g(!0),v("creating"),S(25);try{const O=await Dx.createRepository(i);v("complete"),S(100),k(O),A({title:"Repository Created",description:`Successfully created ${O.name}`,status:"success",duration:5e3,isClosable:!0}),r(O)}catch(O){console.error("Repository creation failed:",O),v("idle"),S(0),A({title:"Creation Failed",description:O instanceof Error?O.message:"Failed to create repository",status:"error",duration:8e3,isClosable:!0})}finally{g(!1)}},R=()=>{m||e()},G=K=>{switch(K){case"core":return"Core Design System";case"platform-extension":return"Platform Extension";case"theme-override":return"Theme Override";default:return K}},ne=()=>{if(y==="idle")return null;const K={creating:"Creating GitHub repository...",scaffolding:"Setting up repository structure...",schema:"Creating initial schema file...",complete:"Repository created successfully!"};return o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(sc,{value:I,colorScheme:"blue",size:"sm"}),o.jsx(E,{fontSize:"sm",textAlign:"center",children:K[y]})]})},he=()=>b?o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsxs(zt,{status:"success",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(ce,{align:"start",spacing:1,children:[o.jsx(E,{fontWeight:"bold",children:"Repository Created Successfully!"}),o.jsx(E,{fontSize:"sm",children:"Your new repository is ready to use."})]})]}),o.jsx(z,{p:4,borderWidth:1,borderRadius:"md",bg:C==="dark"?"gray.800":"gray.50",children:o.jsxs(ce,{align:"start",spacing:3,children:[o.jsxs(le,{children:[o.jsx(E,{fontWeight:"bold",children:"Repository:"}),o.jsx(E,{fontFamily:"mono",children:b.fullName}),o.jsx(wt,{colorScheme:b.visibility==="public"?"green":"orange",children:b.visibility})]}),o.jsxs(le,{children:[o.jsx(E,{fontWeight:"bold",children:"Type:"}),o.jsx(E,{children:G(b.schemaType)})]}),b.description&&o.jsxs(le,{children:[o.jsx(E,{fontWeight:"bold",children:"Description:"}),o.jsx(E,{children:b.description})]}),o.jsxs(le,{children:[o.jsx(E,{fontWeight:"bold",children:"URL:"}),o.jsx(E,{color:"blue.500",cursor:"pointer",onClick:()=>window.open(b.htmlUrl,"_blank"),children:b.htmlUrl})]}),b.initialFilePath&&o.jsxs(le,{children:[o.jsx(E,{fontWeight:"bold",children:"Initial File:"}),o.jsx(E,{fontFamily:"mono",children:b.initialFilePath})]})]})})]}):null,te=()=>y==="complete"?null:o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:C==="dark"?"gray.800":"gray.50",children:o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{fontWeight:"bold",children:"Schema Type"}),o.jsx(wt,{colorScheme:"blue",children:G(n)})]})}),o.jsxs(Ye,{isRequired:!0,isInvalid:!!l.name,children:[o.jsx(Qe,{children:"Repository Name"}),o.jsx(yt,{value:i.name,onChange:K=>a({...i,name:K.target.value}),placeholder:`my-${n}`,disabled:m}),l.name&&o.jsx(E,{fontSize:"sm",color:"red.500",mt:1,children:l.name})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(yt,{value:i.description,onChange:K=>a({...i,description:K.target.value}),placeholder:`Design tokens for ${n}`,disabled:m})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Organization"}),o.jsxs(Kt,{value:i.organization,onChange:K=>a({...i,organization:K.target.value}),disabled:m,children:[o.jsx("option",{value:"",children:"Select organization"}),d.map(K=>o.jsxs("option",{value:K.login,children:[K.name||K.login," (",K.type,")"]},K.login))]})]}),o.jsxs(Ye,{isRequired:!0,isInvalid:!!l.visibility,children:[o.jsx(Qe,{children:"Visibility"}),o.jsxs(Kt,{value:i.visibility,onChange:K=>a({...i,visibility:K.target.value}),disabled:m,children:[o.jsx("option",{value:"public",children:"Public"}),o.jsx("option",{value:"private",children:"Private"})]}),l.visibility&&o.jsx(E,{fontSize:"sm",color:"red.500",mt:1,children:l.visibility})]}),o.jsxs(zt,{status:"info",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(ce,{align:"start",spacing:1,children:[o.jsx(E,{fontWeight:"bold",children:"What will be created:"}),o.jsx(E,{fontSize:"sm",children:"â€¢ A new GitHub repository with proper directory structure"}),o.jsxs(E,{fontSize:"sm",children:["â€¢ Initial ",n," schema file with default configuration"]}),o.jsx(E,{fontSize:"sm",children:"â€¢ README, .gitignore, and other supporting files"})]})]})]});return o.jsxs(Zr,{isOpen:t,onClose:R,size:"xl",children:[o.jsx(Dr,{}),o.jsxs(Xr,{maxW:"800px",children:[o.jsx(Rr,{children:"Create New Repository"}),o.jsx(Or,{children:o.jsxs(ce,{spacing:6,align:"stretch",children:[ne(),he(),te()]})}),o.jsxs(rn,{children:[o.jsx(Oe,{variant:"ghost",mr:3,onClick:R,disabled:m,children:b?"Close":"Cancel"}),!b&&o.jsx(Oe,{colorScheme:"blue",onClick:_,isLoading:m,loadingText:"Creating...",disabled:m,children:"Create Repository"})]})]})]})},_M=({isOpen:t,onClose:e,onSourceSelected:r,schemaType:n})=>{const[s,i]=M.useState("link-existing"),[a,l]=M.useState("system-default"),[c,d]=M.useState(!1),[u,m]=M.useState(null),[g,y]=M.useState({workflow:"link-existing",repositoryUri:"",branch:"main",filePath:"",newFileName:`${n}.json`,newRepositoryName:"",newRepositoryDescription:"",newRepositoryVisibility:"public"}),[v,I]=M.useState({}),[S,b]=M.useState(!1),[k,A]=M.useState(null),[C,T]=M.useState(""),[P,_]=M.useState([]),[R,G]=M.useState([]),[ne,he]=M.useState([]),[te,K]=M.useState([]),[O,Z]=M.useState(null),[ie,ge]=M.useState(null),[xe,$]=M.useState(""),[B,U]=M.useState(null),X=Hr(),{colorMode:ee}=Vt();M.useEffect(()=>{t&&(async()=>{try{const{StorageService:Fe}=await ir(async()=>{const{StorageService:ut}=await Promise.resolve().then(()=>ko);return{StorageService:ut}},void 0),Je=Fe.getRootData().systemId||"system-default";l(Je)}catch(Fe){console.error("Failed to load data:",Fe)}})()},[t]),M.useEffect(()=>{t&&(i("link-existing"),y(je=>({...je,workflow:"link-existing",repositoryUri:"",branch:"main",filePath:"",newFileName:`${n}.json`,newRepositoryName:"",newRepositoryDescription:"",newRepositoryVisibility:"public"})),I({}),T(""),b(!1),A(null),_([]),G([]),he([]),K([]),Z(null),ge(null),$(""),U(null),m(null),be())},[t,n]);const be=M.useCallback(async(je=!1)=>{b(!0),A("orgs"),T("");try{je&&qr.clearAll();const Fe=await xt.getOrganizations();_(Fe),Fe.length>0&&(Z(Fe[0]),await Se(Fe[0],je))}catch(Fe){console.error("Failed to load organizations:",Fe),T("Failed to load organizations. Please try again."),X({title:"Error",description:"Failed to load organizations from GitHub.",status:"error",duration:5e3,isClosable:!0})}finally{b(!1),A(null)}},[X]),Se=M.useCallback(async(je,Fe=!1)=>{b(!0),A("repos"),T("");try{Fe&&qr.clearAll();const Je=(await xt.getRepositories()).filter(ut=>ut.full_name.split("/")[0]===je.login);G(Je)}catch(Ue){console.error("Failed to load repositories:",Ue),T("Failed to load repositories. Please try again."),X({title:"Error",description:"Failed to load repositories from GitHub.",status:"error",duration:5e3,isClosable:!0})}finally{b(!1),A(null)}},[X]),Me=M.useCallback(async je=>{const Fe=P.find(Ue=>Ue.login===je);Fe&&(Z(Fe),ge(null),$(""),K([]),U(null),T(""),await Se(Fe))},[P,Se]),se=M.useCallback(async je=>{const Fe=R.find(Ue=>Ue.full_name===je);if(Fe){ge(Fe),$(""),K([]),U(null),T(""),b(!0),A("branches");try{const Ue=await xt.getBranches(Fe.full_name);he(Ue),Ue.find(ut=>ut.name==="main")&&($("main"),await fe(Fe.full_name,"main"))}catch(Ue){console.error("Failed to load branches:",Ue),T("Failed to load branches. Please try again."),X({title:"Error",description:"Failed to load branches from GitHub.",status:"error",duration:5e3,isClosable:!0})}finally{b(!1),A(null)}}},[R,X]),de=M.useCallback(async je=>{ie&&($(je),K([]),U(null),T(""),await fe(ie.full_name,je))},[ie]),fe=M.useCallback(async(je,Fe)=>{b(!0),A("files");try{const Ue=await xt.scanRepositoryForValidFiles(je,Fe,n==="platform-extension"?a:void 0),Je=n==="platform-extension"?"platform-extension":"schema",ut=Ue.filter(Ze=>Ze.type===Je);K(ut),ut.length>0&&(U(ut[0]),y(Ze=>({...Ze,repositoryUri:je,branch:Fe,filePath:ut[0].path})))}catch(Ue){console.error("Failed to load files:",Ue),T("Failed to load files. Please try again.")}finally{b(!1),A(null)}},[n,a]),_e=M.useCallback(je=>{const Fe=te.find(Ue=>Ue.path===je);U(Fe||null),Fe&&y(Ue=>({...Ue,filePath:Fe.path}))},[te]),Y=M.useCallback(()=>{var Fe,Ue,Je,ut;const je={};switch(s){case"link-existing":(Fe=g.repositoryUri)!=null&&Fe.trim()||(je.repositoryUri="Repository URI is required"),(Ue=g.branch)!=null&&Ue.trim()||(je.branch="Branch is required"),(Je=g.filePath)!=null&&Je.trim()||(je.filePath="File path is required");break;case"create-file":(ut=g.newFileName)!=null&&ut.trim()||(je.newFileName="File name is required");break}return I(je),Object.keys(je).length===0},[s,g]),Ce=M.useCallback(()=>{d(!0)},[]),ue=M.useCallback(je=>{d(!1),m(je),y(Fe=>({...Fe,repositoryUri:je.fullName,branch:je.defaultBranch,filePath:je.initialFilePath||`${n}.json`,newRepositoryName:je.name,newRepositoryDescription:je.description||""})),X({title:"Repository Created",description:`Successfully created ${je.name}. Repository information is displayed below.`,status:"success",duration:5e3,isClosable:!0})},[n,X]),Ee=M.useCallback(async()=>{if(!Y()){X({title:"Validation Error",description:"Please fix the errors before continuing",status:"error",duration:3e3,isClosable:!0});return}const je={workflow:s,repositoryUri:g.repositoryUri,branch:g.branch,filePath:g.filePath,newFileName:g.newFileName,newRepositoryName:g.newRepositoryName,newRepositoryDescription:g.newRepositoryDescription,newRepositoryVisibility:g.newRepositoryVisibility};r(je),e()},[s,Y,g,r,e,X]),ze=()=>o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Select new source"}),o.jsx(Zd,{value:s,onChange:je=>{i(je)},children:o.jsxs(Bv,{spacing:3,children:[o.jsx(To,{value:"link-existing",children:o.jsxs(le,{spacing:2,children:[o.jsx(On,{as:Lb}),o.jsxs(ce,{align:"start",spacing:0,children:[o.jsxs(E,{fontWeight:"medium",children:["Link Existing ",n==="platform-extension"?"Platform Extension":n]}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:"Connect to an existing repository"})]})]})}),o.jsx(To,{value:"create-file",children:o.jsxs(le,{spacing:2,children:[o.jsx(On,{as:Vb}),o.jsxs(ce,{align:"start",spacing:0,children:[o.jsxs(E,{fontWeight:"medium",children:["Create ",n==="platform-extension"?"Platform Extension":n," File"]}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:"Create a new file in the current repository"})]})]})}),o.jsx(To,{value:"create-repository",children:o.jsxs(le,{spacing:2,children:[o.jsx(On,{as:$b}),o.jsxs(ce,{align:"start",spacing:0,children:[o.jsx(E,{fontWeight:"medium",children:"Create New Repository"}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:"Create a new repository with scaffolded structure"})]})]})}),s==="create-repository"&&o.jsx(Oe,{size:"sm",colorScheme:"blue",variant:"outline",onClick:Ce,ml:6,children:"Create Repository"})]})})]}),De=()=>o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Repository Settings"}),C&&o.jsxs(zt,{status:"error",children:[o.jsx(Lt,{}),o.jsx(E,{children:C})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"Organization"}),o.jsxs("select",{value:(O==null?void 0:O.login)||"",onChange:je=>Me(je.target.value),disabled:S,style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",backgroundColor:ee==="dark"?"#2d3748":"white",color:ee==="dark"?"white":"black"},children:[o.jsx("option",{value:"",children:"Select organization"}),P.map(je=>o.jsx("option",{value:je.login,children:je.name||je.login},je.login))]})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"Repository"}),o.jsxs("select",{value:(ie==null?void 0:ie.full_name)||"",onChange:je=>se(je.target.value),disabled:S||!O,style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",backgroundColor:ee==="dark"?"#2d3748":"white",color:ee==="dark"?"white":"black"},children:[o.jsx("option",{value:"",children:"Select repository"}),R.map(je=>o.jsx("option",{value:je.full_name,children:je.name},je.full_name))]})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"Branch"}),o.jsxs("select",{value:xe,onChange:je=>de(je.target.value),disabled:S||!ie,style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",backgroundColor:ee==="dark"?"#2d3748":"white",color:ee==="dark"?"white":"black"},children:[o.jsx("option",{value:"",children:"Select branch"}),ne.map(je=>o.jsx("option",{value:je.name,children:je.name},je.name))]})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"File"}),o.jsxs("select",{value:(B==null?void 0:B.path)||"",onChange:je=>_e(je.target.value),disabled:S||!xe,style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",backgroundColor:ee==="dark"?"#2d3748":"white",color:ee==="dark"?"white":"black"},children:[o.jsx("option",{value:"",children:"Select file"}),te.map(je=>o.jsxs("option",{value:je.path,children:[je.name," (",je.type,")"]},je.path))]}),te.length===0&&xe&&!S&&o.jsx(E,{fontSize:"sm",color:"gray.500",mt:1,children:n==="platform-extension"?`No platform extension files found with matching systemId: ${a}`:`No ${n} files found in this branch`})]}),S&&o.jsx(le,{justify:"center",py:4,children:o.jsxs(E,{fontSize:"sm",children:[k==="orgs"&&"Loading organizations...",k==="repos"&&"Loading repositories...",k==="branches"&&"Loading branches...",k==="files"&&"Scanning files..."]})})]}),Ke=()=>o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"File Settings"}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"File Name"}),o.jsx("input",{type:"text",value:g.newFileName,onChange:je=>y({...g,newFileName:je.target.value}),placeholder:`${n}.json`,style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:v.newFileName?"1px solid #e53e3e":"1px solid #e2e8f0",backgroundColor:ee==="dark"?"#2d3748":"white",color:ee==="dark"?"white":"black"}}),v.newFileName&&o.jsx(E,{fontSize:"sm",color:"red.500",mt:1,children:v.newFileName}),o.jsx(E,{fontSize:"xs",color:"gray.500",mt:1,children:"File will be created in the current repository"})]})]}),ve=()=>u?o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Repository Settings"}),o.jsxs(zt,{status:"success",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsx(E,{fontWeight:"bold",children:"Repository created successfully!"})]}),o.jsx(z,{p:4,borderWidth:1,borderRadius:"md",bg:ee==="dark"?"gray.800":"gray.50",children:o.jsxs(ce,{align:"start",spacing:3,children:[o.jsxs(le,{children:[o.jsx(E,{fontWeight:"bold",children:"Repository Name:"}),o.jsx(E,{fontFamily:"mono",children:u.name}),o.jsx(wt,{colorScheme:u.visibility==="public"?"green":"orange",children:u.visibility})]}),u.description&&o.jsxs(le,{children:[o.jsx(E,{fontWeight:"bold",children:"Description:"}),o.jsx(E,{children:u.description})]}),o.jsxs(le,{children:[o.jsx(E,{fontWeight:"bold",children:"Organization:"}),o.jsx(E,{children:u.fullName.split("/")[0]})]}),o.jsxs(le,{children:[o.jsx(E,{fontWeight:"bold",children:"Repository URL:"}),o.jsx(E,{color:"blue.500",cursor:"pointer",onClick:()=>window.open(u.htmlUrl,"_blank"),children:u.htmlUrl})]}),o.jsxs(le,{children:[o.jsx(E,{fontWeight:"bold",children:"Default Branch:"}),o.jsx(E,{children:u.defaultBranch})]}),u.initialFilePath&&o.jsxs(le,{children:[o.jsx(E,{fontWeight:"bold",children:"Initial File:"}),o.jsx(E,{fontFamily:"mono",children:u.initialFilePath})]})]})})]}):o.jsx(ce,{spacing:4,align:"stretch",children:o.jsxs(zt,{status:"info",children:[o.jsx(Lt,{}),o.jsx(E,{children:'Click "Create Repository" above to create a new repository with scaffolded structure'})]})}),Te=()=>{switch(s){case"link-existing":return De();case"create-file":return Ke();case"create-repository":return ve();default:return null}};return o.jsxs(o.Fragment,{children:[o.jsxs(Zr,{isOpen:t,onClose:e,size:"xl",children:[o.jsx(Dr,{}),o.jsxs(Xr,{maxW:"800px",children:[o.jsx(Rr,{children:"Select New Source"}),o.jsx(Or,{children:o.jsxs(ce,{spacing:6,align:"stretch",children:[ze(),Te()]})}),o.jsxs(rn,{children:[o.jsx(Oe,{variant:"ghost",mr:3,onClick:e,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:Ee,children:"Select Source"})]})]})]}),o.jsx(OM,{isOpen:c,onClose:()=>d(!1),onRepositoryCreated:ue,schemaType:n,prefillData:{name:g.newRepositoryName,description:g.newRepositoryDescription,systemId:a,platformId:void 0,themeId:void 0}})]})},FM=({repository:t,isOpen:e,onClose:r,onSave:n,onDelete:s,onDeprecate:i,platforms:a=[],platformStatus:l})=>{const[c,d]=M.useState({type:t.type,repositoryUri:t.repositoryUri,branch:t.branch,filePath:t.filePath,systemId:"",platformId:t.platformId||"",themeId:t.themeId||"",displayName:"",description:"",figmaPlatformMapping:null,workflow:"link-existing",newFileName:"",newRepositoryName:"",newRepositoryDescription:"",newRepositoryVisibility:"public",syntaxPatterns:{prefix:"",suffix:"",delimiter:"_",capitalization:"none",formatString:""},valueFormatters:{color:"hex",dimension:"px",numberPrecision:2}}),[u,m]=M.useState({}),[g,y]=M.useState(null),[v,I]=M.useState(!1),[S,b]=M.useState(null),k=Hr(),{colorMode:A}=Vt(),[C,T]=M.useState(""),[P,_]=M.useState(!1),R=M.useRef(null),[G,ne]=M.useState(!1),[he,te]=M.useState(!1),K=()=>L.getRootData().systemId||"system-default",O=()=>{if(t.type!=="platform-extension")return console.log("[ExtensionEditDialog] getCanonicalPlatformData: Not a platform extension",{type:t.type}),null;console.log("[ExtensionEditDialog] getCanonicalPlatformData: Available platforms",{availablePlatforms:a.map(Ce=>({id:Ce.id,hasExtensionSource:!!Ce.extensionSource,extensionSource:Ce.extensionSource})),totalPlatforms:a.length,repositoryPlatformId:t.platformId,repositoryUri:t.repositoryUri,repositoryFilePath:t.filePath});let Y=a.find(Ce=>Ce.id===t.platformId);return Y?console.log("[ExtensionEditDialog] getCanonicalPlatformData: Found platform by repository.platformId",{platformId:Y.id,displayName:Y.displayName,hasExtensionSource:!!Y.extensionSource,extensionSource:Y.extensionSource}):(console.log("[ExtensionEditDialog] getCanonicalPlatformData: No platform found by repository.platformId",{searchedPlatformId:t.platformId,availablePlatformIds:a.map(Ce=>Ce.id)}),t.repositoryUri&&t.filePath&&(Y=a.find(Ce=>{var ue,Ee;return((ue=Ce.extensionSource)==null?void 0:ue.repositoryUri)===t.repositoryUri&&((Ee=Ce.extensionSource)==null?void 0:Ee.filePath)===t.filePath}),Y?console.log("[ExtensionEditDialog] getCanonicalPlatformData: Found platform by extensionSource match",{platformId:Y.id,displayName:Y.displayName,hasExtensionSource:!!Y.extensionSource,extensionSource:Y.extensionSource}):console.log("[ExtensionEditDialog] getCanonicalPlatformData: No platform found by extensionSource match",{searchedRepositoryUri:t.repositoryUri,searchedFilePath:t.filePath,availableExtensionSources:a.filter(Ce=>Ce.extensionSource).map(Ce=>{var ue,Ee;return{platformId:Ce.id,repositoryUri:(ue=Ce.extensionSource)==null?void 0:ue.repositoryUri,filePath:(Ee=Ce.extensionSource)==null?void 0:Ee.filePath}})}))),Y!=null&&Y.extensionSource?Y:Y&&t.repositoryUri&&t.filePath?(console.log("[ExtensionEditDialog] getCanonicalPlatformData: Using repository source info as fallback",{repositoryUri:t.repositoryUri,filePath:t.filePath}),{...Y,extensionSource:{repositoryUri:t.repositoryUri,filePath:t.filePath}}):t.repositoryUri&&t.filePath?(console.log("[ExtensionEditDialog] getCanonicalPlatformData: Creating minimal platform object from repository info",{platformId:t.platformId,repositoryUri:t.repositoryUri,filePath:t.filePath}),{id:t.platformId||"unknown-platform",displayName:t.platformId||"Unknown Platform",description:"",extensionSource:{repositoryUri:t.repositoryUri,filePath:t.filePath}}):Y},Z=async()=>{if(console.log("[ExtensionEditDialog] loadPlatformExtensionData: Starting",{repositoryType:t.type,platformId:t.platformId,repositoryUri:t.repositoryUri,filePath:t.filePath,branch:t.branch}),t.type!=="platform-extension"){console.log("[ExtensionEditDialog] loadPlatformExtensionData: Not a platform extension");return}const Y=O();if(console.log("[ExtensionEditDialog] loadPlatformExtensionData: Canonical platform data",{found:!!Y,hasExtensionSource:!!(Y!=null&&Y.extensionSource),extensionSource:Y==null?void 0:Y.extensionSource,platformId:Y==null?void 0:Y.id}),!(Y!=null&&Y.extensionSource)){console.log("[ExtensionEditDialog] No extension source found, skipping data load");return}I(!0),b(null);try{const{repositoryUri:Ce,filePath:ue}=Y.extensionSource,Ee=Ce==="local";let ze;if(Ee){const ve=K();ze=await al.validateLocalFile(ue,Y.id,ve)}else{const ve=t.branch||"main";ze=await al.validateExternalRepository(Ce,ue,ve)}if(!ze.exists){b({isValid:!1,error:ze.error,showSourceSelection:!0}),k({title:"Source Not Found",description:ze.error||"The platform source could not be found. Please select a new source.",status:"warning",duration:8e3,isClosable:!0});return}ze.updatedPath&&Ee&&(console.log("[ExtensionEditDialog] File found at new path, updating platform data:",ze.updatedPath),await ee("local",ze.updatedPath),k({title:"File Location Updated",description:"Platform extension file was found at a new location and has been updated automatically.",status:"info",duration:5e3,isClosable:!0}),Y.extensionSource.filePath=ze.updatedPath),b({isValid:!0,showSourceSelection:!1});const De=t.branch||"main";console.log("[ExtensionEditDialog] loadPlatformExtensionData: Fetching data from source",{repositoryUri:Y.extensionSource.repositoryUri,filePath:Y.extensionSource.filePath,branch:De,platformId:Y.id});const Ke=await Di.getPlatformExtensionData(Y.extensionSource.repositoryUri,Y.extensionSource.filePath,De,Y.id);Ke.data?(y(Ke.data),console.log("[ExtensionEditDialog] Loaded platform extension data:",Ke.data)):console.warn("[ExtensionEditDialog] No platform extension data found")}catch(Ce){console.error("[ExtensionEditDialog] Failed to load platform extension data:",Ce),b({isValid:!1,error:"Failed to load platform extension data from source",showSourceSelection:!0}),k({title:"Error",description:"Failed to load platform extension data from source",status:"error",duration:5e3,isClosable:!0})}finally{I(!1)}},ie=M.useMemo(()=>{var Te;if(c.type!=="platform-extension")return"";const Y=O(),ue=((Te=Y==null?void 0:Y.extensionSource)==null?void 0:Te.repositoryUri)==="local"?c.syntaxPatterns:(g==null?void 0:g.syntaxPatterns)||c.syntaxPatterns,Ee=(ue==null?void 0:ue.prefix)||"",ze=(ue==null?void 0:ue.suffix)||"",De=(ue==null?void 0:ue.delimiter)||"",Ke=(ue==null?void 0:ue.capitalization)||"none";let ve="primary-color-background";switch(Ke){case"uppercase":ve=ve.toUpperCase();break;case"lowercase":ve=ve.toLowerCase();break;case"capitalize":ve=ve.split("-").map(je=>je.charAt(0).toUpperCase()+je.slice(1)).join("-");break}return De&&De!==""?ve=ve.replace(/-/g,De):ve=ve.replace(/-/g,""),`${Ee}${ve}${ze}`},[c.syntaxPatterns,c.type,g]);M.useEffect(()=>{var ze,De,Ke,ve,Te,je,Fe,Ue,Je,ut;if(l!=null&&l.hasError&&(l.errorType==="file-not-found"||l.errorType==="repository-not-found")){b({isValid:!1,error:l.errorMessage||"File or repository is not found",showSourceSelection:!0}),I(!1);return}const Y=O();let Ce=null;t.platformId&&t.type==="platform-extension"&&(Ce=L.getPlatformExtensionFile(t.platformId));const ue=(Y==null?void 0:Y.displayName)||((ze=Ce==null?void 0:Ce.metadata)==null?void 0:ze.name)||(Ce==null?void 0:Ce.displayName)||t.platformId||"",Ee=(Y==null?void 0:Y.description)||((De=Ce==null?void 0:Ce.metadata)==null?void 0:De.description)||(Ce==null?void 0:Ce.description)||"";d({type:t.type,repositoryUri:t.repositoryUri,branch:t.branch,filePath:t.filePath,systemId:(Ce==null?void 0:Ce.systemId)||K(),platformId:t.platformId||"",themeId:t.themeId||"",displayName:ue,description:Ee,figmaPlatformMapping:(Ce==null?void 0:Ce.figmaPlatformMapping)||null,workflow:"link-existing",newFileName:"",newRepositoryName:"",newRepositoryDescription:"",newRepositoryVisibility:"public",syntaxPatterns:{prefix:((Ke=Ce==null?void 0:Ce.syntaxPatterns)==null?void 0:Ke.prefix)||"",suffix:((ve=Ce==null?void 0:Ce.syntaxPatterns)==null?void 0:ve.suffix)||"",delimiter:((Te=Ce==null?void 0:Ce.syntaxPatterns)==null?void 0:Te.delimiter)||"",capitalization:((je=Ce==null?void 0:Ce.syntaxPatterns)==null?void 0:je.capitalization)||"none",formatString:((Fe=Ce==null?void 0:Ce.syntaxPatterns)==null?void 0:Fe.formatString)||""},valueFormatters:{color:((Ue=Ce==null?void 0:Ce.valueFormatters)==null?void 0:Ue.color)||"hex",dimension:((Je=Ce==null?void 0:Ce.valueFormatters)==null?void 0:Je.dimension)||"px",numberPrecision:((ut=Ce==null?void 0:Ce.valueFormatters)==null?void 0:ut.numberPrecision)||2}}),m({}),Z()},[t,a,l]),M.useEffect(()=>{g&&c.type==="platform-extension"&&d(Y=>{var Ce,ue,Ee,ze,De,Ke,ve,Te;return{...Y,figmaPlatformMapping:g.figmaPlatformMapping||null,syntaxPatterns:{prefix:((Ce=g.syntaxPatterns)==null?void 0:Ce.prefix)||"",suffix:((ue=g.syntaxPatterns)==null?void 0:ue.suffix)||"",delimiter:((Ee=g.syntaxPatterns)==null?void 0:Ee.delimiter)||"",capitalization:((ze=g.syntaxPatterns)==null?void 0:ze.capitalization)||"none",formatString:((De=g.syntaxPatterns)==null?void 0:De.formatString)||""},valueFormatters:{color:((Ke=g.valueFormatters)==null?void 0:Ke.color)||"hex",dimension:((ve=g.valueFormatters)==null?void 0:ve.dimension)||"px",numberPrecision:((Te=g.valueFormatters)==null?void 0:Te.numberPrecision)||2}}})},[g,c.type]),M.useEffect(()=>{if(S&&!S.isValid&&S.showSourceSelection){const Y=setTimeout(()=>{ne(!0)},100);return()=>clearTimeout(Y)}},[S]);const ge=()=>{var Ce;const Y={};if(c.type==="platform-extension"&&((Ce=c.displayName)!=null&&Ce.trim()||(Y.displayName="Display name is required for platform extensions"),c.workflow==="link-existing"&&c.repositoryUri&&c.filePath)){const ue=al.validateExtensionSource(c.repositoryUri,c.filePath,t.platformId);ue.isValid||(Y.filePath=ue.error||"This extension source is already in use by another platform")}return m(Y),Object.keys(Y).length===0},xe=async()=>{var ue,Ee,ze;if(!ge()){k({title:"Validation Error",description:"Please fix the errors before saving",status:"error",duration:3e3,isClosable:!0});return}if(c.workflow==="create-file"&&c.type==="platform-extension")try{const De={systemId:c.systemId||K(),platformId:t.platformId||"",version:"1.0.0",status:"active",figmaFileKey:`${t.platformId||"platform"}-figma-file`,figmaPlatformMapping:c.figmaPlatformMapping||null,syntaxPatterns:c.syntaxPatterns||{prefix:"",suffix:"",delimiter:"_",capitalization:"camel",formatString:""},valueFormatters:c.valueFormatters||{color:"hex",dimension:"px",numberPrecision:2},algorithmVariableOverrides:[],tokenOverrides:[],omittedModes:[],omittedDimensions:[]},Ke=JSON.stringify(De,null,2),ve=`platforms/${c.newFileName||"platform-extension.json"}`,{GitHubApiService:Te}=await ir(async()=>{const{GitHubApiService:Ue}=await Promise.resolve().then(()=>fo);return{GitHubApiService:Ue}},void 0),je=Te.getSelectedRepositoryInfo();if(!je)throw new Error("No repository selected. Please load a file from GitHub first.");await Te.createFile(je.fullName,ve,Ke,je.branch,`Add platform extension file: ${ve} for ${t.platformId}`);const{StorageService:Fe}=await ir(async()=>{const{StorageService:Ue}=await Promise.resolve().then(()=>ko);return{StorageService:Ue}},void 0);Fe.setPlatformExtensionFile(t.platformId||"",De),Fe.setPlatformExtensionFileContent(t.platformId||"",Ke),await ee("local",ve),k({title:"File Created Successfully",description:`Platform extension file "${ve}" has been created and linked to the platform.`,status:"success",duration:3e3,isClosable:!0}),r();return}catch(De){console.error("[ExtensionEditDialog] Failed to create platform extension file:",De),k({title:"File Creation Failed",description:De instanceof Error?De.message:"Failed to create platform extension file",status:"error",duration:5e3,isClosable:!0});return}const Y=O();if(((ue=Y==null?void 0:Y.extensionSource)==null?void 0:ue.repositoryUri)==="local"&&c.type==="platform-extension"&&g)try{const De={...g,syntaxPatterns:c.syntaxPatterns||g.syntaxPatterns,valueFormatters:c.valueFormatters||g.valueFormatters,metadata:{...g.metadata,name:c.displayName||((Ee=g.metadata)==null?void 0:Ee.name)||"",description:c.description||((ze=g.metadata)==null?void 0:ze.description)||"",lastUpdated:new Date().toISOString().split("T")[0]}},Ke=JSON.stringify(De,null,2),{GitHubApiService:ve}=await ir(async()=>{const{GitHubApiService:Fe}=await Promise.resolve().then(()=>fo);return{GitHubApiService:Fe}},void 0),Te=ve.getSelectedRepositoryInfo();if(!Te)throw new Error("No repository selected. Please load a file from GitHub first.");await ve.createOrUpdateFile(Te.fullName,Y.extensionSource.filePath,Ke,Te.branch,`Update platform extension settings for ${t.platformId}`);const{StorageService:je}=await ir(async()=>{const{StorageService:Fe}=await Promise.resolve().then(()=>ko);return{StorageService:Fe}},void 0);je.setPlatformExtensionFile(t.platformId||"",De),je.setPlatformExtensionFileContent(t.platformId||"",Ke),await X(),k({title:"Platform Settings Updated",description:"Platform extension settings have been saved successfully.",status:"success",duration:3e3,isClosable:!0}),r();return}catch(De){console.error("[ExtensionEditDialog] Failed to update platform extension file:",De),k({title:"Update Failed",description:De instanceof Error?De.message:"Failed to update platform extension file",status:"error",duration:5e3,isClosable:!0});return}try{if(c.type==="platform-extension"){const De={systemId:c.systemId,platformId:c.platformId,version:"1.0.0",syntaxPatterns:c.syntaxPatterns,valueFormatters:c.valueFormatters},Ke=$S.validatePlatformExtension(De);if(!Ke.isValid)throw new Error(`Validation failed: ${Ke.errors.join(", ")}`);Ke.warnings.length>0&&console.warn("Platform extension warnings:",Ke.warnings)}}catch(De){k({title:"Schema Validation Error",description:De instanceof Error?De.message:"Invalid data structure",status:"error",duration:5e3,isClosable:!0});return}n(c),r()},$=()=>{s&&(s(t.id),_(!1),r())},B=()=>{i&&(i(t.id),_(!1),r())},U=()=>{ne(!0)},X=async()=>{if(!t.platformId||t.type!=="platform-extension"){console.log("[ExtensionEditDialog] updateCanonicalPlatformData: Not a platform extension or no platformId");return}try{const{DataManager:Y}=await ir(async()=>{const{DataManager:De}=await Promise.resolve().then(()=>oc);return{DataManager:De}},void 0),Ce=Y.getInstance(),Ee=Ce.getCurrentSnapshot().platforms,ze=Ee.findIndex(De=>De.id===t.platformId);if(ze!==-1){const De=[...Ee];De[ze]={...De[ze],displayName:c.displayName||De[ze].displayName,description:c.description||De[ze].description,figmaPlatformMapping:c.figmaPlatformMapping||De[ze].figmaPlatformMapping},Ce.updateData({platforms:De}),console.log("[ExtensionEditDialog] Updated canonical platform data:",{platformId:t.platformId,displayName:c.displayName,description:c.description,figmaPlatformMapping:c.figmaPlatformMapping})}else console.error("[ExtensionEditDialog] Platform not found for canonical update:",t.platformId)}catch(Y){throw console.error("[ExtensionEditDialog] Failed to update canonical platform data:",Y),Y}},ee=async(Y,Ce)=>{if(!t.platformId||t.type!=="platform-extension"){console.log("[ExtensionEditDialog] updatePlatformExtensionSource: Not a platform extension or no platformId");return}try{const{DataManager:ue}=await ir(async()=>{const{DataManager:ve}=await Promise.resolve().then(()=>oc);return{DataManager:ve}},void 0),De=ue.getInstance().getCurrentSnapshot().platforms,Ke=De.findIndex(ve=>ve.id===t.platformId);if(Ke!==-1){const ve=[...De];ve[Ke]={...ve[Ke],extensionSource:{repositoryUri:Y,filePath:Ce}};const{DataManager:Te}=await ir(async()=>{const{DataManager:Fe}=await Promise.resolve().then(()=>oc);return{DataManager:Fe}},void 0);Te.getInstance().updateData({platforms:ve}),console.log("[ExtensionEditDialog] Updated platform extensionSource:",{platformId:t.platformId,repositoryUri:Y,filePath:Ce}),await Z(),k({title:"Platform Updated",description:"Platform extension source has been updated successfully.",status:"success",duration:3e3,isClosable:!0})}else console.error("[ExtensionEditDialog] Platform not found for update:",t.platformId)}catch(ue){console.error("[ExtensionEditDialog] Failed to update platform extensionSource:",ue),k({title:"Update Failed",description:"Failed to update platform extension source.",status:"error",duration:5e3,isClosable:!0})}},be=async Y=>{d(ue=>({...ue,repositoryUri:Y.repositoryUri||ue.repositoryUri,branch:Y.branch||ue.branch,filePath:Y.filePath||ue.filePath,newFileName:Y.newFileName||ue.newFileName,newRepositoryName:Y.newRepositoryName||ue.newRepositoryName,newRepositoryDescription:Y.newRepositoryDescription||ue.newRepositoryDescription,newRepositoryVisibility:Y.newRepositoryVisibility||ue.newRepositoryVisibility,workflow:Y.workflow}));const Ce=Y.workflow==="link-existing"&&Y.repositoryUri&&Y.repositoryUri!=="local";if(te(!!Ce),Y.workflow==="link-existing"&&Y.repositoryUri&&Y.filePath){const ue=al.validateExtensionSource(Y.repositoryUri,Y.filePath,t.platformId);if(!ue.isValid){k({title:"Validation Error",description:ue.error||"This extension source is already in use by another platform",status:"error",duration:5e3,isClosable:!0});return}await ee(Y.repositoryUri,Y.filePath),d(Ee=>({...Ee,repositoryUri:Y.repositoryUri||Ee.repositoryUri,branch:Y.branch||Ee.branch,filePath:Y.filePath||Ee.filePath}))}k({title:"Source Updated",description:`Source has been updated to ${Y.workflow==="link-existing"?"external repository":Y.workflow==="create-file"?"local file":"new repository"}`,status:"success",duration:3e3,isClosable:!0})},Se=()=>{const Y=O(),Ce=Y==null?void 0:Y.extensionSource;return console.log("[ExtensionEditDialog] renderSourceConfiguration",{canonicalPlatformData:!!Y,hasExtensionSource:!!Ce,extensionSource:Y==null?void 0:Y.extensionSource,repositoryType:c.type,sourceValidationResult:S}),o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(le,{justify:"space-between",align:"center",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Source Configuration"}),o.jsx(Oe,{size:"sm",colorScheme:"blue",variant:"outline",onClick:U,children:"Select New Source"})]}),S&&!S.isValid&&o.jsxs(zt,{status:"warning",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(ce,{align:"start",spacing:2,flex:1,children:[o.jsx(E,{fontWeight:"bold",children:"Source Validation Failed"}),o.jsx(E,{fontSize:"sm",children:S.error}),S.showSourceSelection&&o.jsx(Oe,{size:"sm",colorScheme:"blue",onClick:U,children:"Select New Source"})]})]}),c.type==="platform-extension"&&o.jsx(z,{p:4,borderWidth:1,borderRadius:"md",bg:A==="dark"?"gray.800":"gray.50",children:o.jsxs(ce,{align:"start",spacing:3,children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Canonical Platform Data"}),Ce&&(Y!=null&&Y.extensionSource)?o.jsxs(ce,{align:"start",spacing:2,children:[o.jsxs(le,{children:[o.jsx(E,{fontWeight:"medium",children:"Repository URI:"}),o.jsx(E,{fontFamily:"mono",fontSize:"sm",color:"gray.500",children:Y.extensionSource.repositoryUri})]}),o.jsxs(le,{children:[o.jsx(E,{fontWeight:"medium",children:"File Path:"}),o.jsx(E,{fontFamily:"mono",fontSize:"sm",color:"gray.500",children:Y.extensionSource.filePath})]}),(S==null?void 0:S.isValid)&&o.jsxs(le,{children:[o.jsx(E,{fontWeight:"medium",children:"Status:"}),o.jsx(wt,{colorScheme:"green",variant:"subtle",children:"Valid"})]})]}):o.jsxs(zt,{status:"info",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsx(E,{children:"No source linked"})]})]})}),he&&o.jsxs(zt,{status:"info",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(ce,{align:"start",spacing:1,children:[o.jsx(E,{fontWeight:"bold",children:"External Source Detected"}),o.jsx(E,{fontSize:"sm",children:"This data comes from an external source file. Most fields are read-only to maintain data integrity."})]})]})]})},Me=()=>o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"File Settings"}),o.jsxs(Ye,{isRequired:!0,isInvalid:!!u.newFileName,children:[o.jsx(Qe,{children:"File Name"}),o.jsx(yt,{value:c.newFileName,onChange:Y=>d({...c,newFileName:Y.target.value}),placeholder:"platform-extension.json"}),o.jsx(E,{fontSize:"xs",color:"gray.500",mt:1,children:"File will be created in the platforms/ directory following repository scaffolding standards"})]})]}),se=()=>o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Repository Settings"}),o.jsxs(Ye,{isRequired:!0,isInvalid:!!u.newRepositoryName,children:[o.jsx(Qe,{children:"Repository Name"}),o.jsx(yt,{value:c.newRepositoryName,onChange:Y=>d({...c,newRepositoryName:Y.target.value}),placeholder:"my-platform-extension"}),o.jsxs(E,{fontSize:"xs",color:"gray.500",mt:1,children:["Repository will be created as: ",c.newRepositoryName?`${c.newRepositoryName}`:"your-org/repo-name"]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(yt,{value:c.newRepositoryDescription,onChange:Y=>d({...c,newRepositoryDescription:Y.target.value}),placeholder:"Platform-specific design tokens and overrides"})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Visibility"}),o.jsxs(Kt,{value:c.newRepositoryVisibility,onChange:Y=>d({...c,newRepositoryVisibility:Y.target.value}),children:[o.jsx("option",{value:"public",children:"Public"}),o.jsx("option",{value:"private",children:"Private"})]})]}),o.jsxs(zt,{status:"info",size:"sm",children:[o.jsx(Lt,{}),"Repository will be scaffolded with proper directory structure and initial platform extension file"]})]}),de=()=>o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Basic Information"}),o.jsxs(ce,{spacing:3,align:"stretch",children:[o.jsxs(Ye,{isRequired:!0,isInvalid:!!u.displayName,children:[o.jsx(Qe,{children:"Display Name"}),he?o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:A==="dark"?"gray.800":"gray.50",borderColor:A==="dark"?"gray.600":"gray.200",children:o.jsx(E,{fontSize:"sm",color:"gray.500",children:c.displayName||"Not set"})}):o.jsx(yt,{value:c.displayName||"",onChange:Y=>d({...c,displayName:Y.target.value}),placeholder:"iOS Platform"})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),he?o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:A==="dark"?"gray.800":"gray.50",borderColor:A==="dark"?"gray.600":"gray.200",children:o.jsx(E,{fontSize:"sm",color:"gray.500",children:c.description||"Not set"})}):o.jsx(yt,{value:c.description||"",onChange:Y=>d({...c,description:Y.target.value}),placeholder:"Platform-specific extensions for iOS"})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Figma Platform Mapping"}),he?o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:A==="dark"?"gray.800":"gray.50",borderColor:A==="dark"?"gray.600":"gray.200",children:o.jsx(E,{fontSize:"sm",color:"gray.500",children:c.figmaPlatformMapping?o.jsx(wt,{colorScheme:"blue",variant:"subtle",children:c.figmaPlatformMapping}):"Not mapped"})}):o.jsxs(o.Fragment,{children:[o.jsxs(Kt,{value:c.figmaPlatformMapping||"",onChange:Y=>d({...c,figmaPlatformMapping:Y.target.value||null}),placeholder:"No Figma mapping",children:[o.jsx("option",{value:"WEB",children:"Web (CSS/JavaScript)"}),o.jsx("option",{value:"iOS",children:"iOS (Swift/SwiftUI)"}),o.jsx("option",{value:"ANDROID",children:"Android (Kotlin/XML)"})]}),o.jsx(Xd,{children:"Maps this platform to a specific Figma platform for variable export. Only one platform can be mapped to each Figma platform."})]})]})]})]}),fe=()=>{var ze,De,Ke,ve,Te,je,Fe,Ue,Je,ut,Ze,At;if(c.type!=="platform-extension")return null;const Y=O();if(!(Y==null?void 0:Y.extensionSource))return o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Platform Settings"}),o.jsxs(zt,{status:"info",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsx(E,{children:"Select a source to see settings"})]})]});if(v)return o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Platform Settings"}),o.jsx(z,{p:4,borderWidth:1,borderRadius:"md",bg:A==="dark"?"gray.800":"gray.50",children:o.jsx(E,{fontSize:"sm",color:"gray.500",children:"Loading platform settings from source..."})})]});const ue=g;if(!ue)return o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Platform Settings"}),o.jsxs(zt,{status:"warning",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsx(E,{children:"Unable to load platform settings from source"})]})]});const Ee=((ze=Y.extensionSource)==null?void 0:ze.repositoryUri)==="local";return o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Platform Settings"}),o.jsxs(z,{p:3,borderWidth:1,borderRadius:"md",bg:A==="dark"?"gray.800":"gray.50",borderColor:A==="dark"?"gray.600":"gray.200",children:[o.jsxs(z,{mb:4,children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:2,children:"Platform ID"}),o.jsx(E,{fontSize:"sm",color:"gray.500",fontFamily:"mono",children:ue.platformId||"Not set"}),o.jsx(E,{fontSize:"xs",color:"gray.400",mt:1,children:"Platform ID cannot be changed after creation"})]}),o.jsxs(z,{mb:4,children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:2,children:"System ID"}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:ue.systemId||"Not set"}),o.jsx(E,{fontSize:"xs",color:"gray.400",mt:1,children:"Auto-populated from current system"})]}),o.jsx(z,{mb:4,children:o.jsx(Du,{syntaxPatterns:Ee?c.syntaxPatterns??{prefix:"",suffix:"",delimiter:"_",capitalization:"none",formatString:""}:{prefix:((De=ue.syntaxPatterns)==null?void 0:De.prefix)||"",suffix:((Ke=ue.syntaxPatterns)==null?void 0:Ke.suffix)||"",delimiter:((ve=ue.syntaxPatterns)==null?void 0:ve.delimiter)||"_",capitalization:((Te=ue.syntaxPatterns)==null?void 0:Te.capitalization)||"none",formatString:((je=ue.syntaxPatterns)==null?void 0:je.formatString)||""},onSyntaxPatternsChange:gr=>{Ee&&d(vr=>({...vr,syntaxPatterns:gr}))},preview:ie,isReadOnly:!Ee,title:"Syntax Patterns"})}),o.jsx(z,{mb:4,children:o.jsx(tf,{valueFormatters:Ee?{color:((Fe=c.valueFormatters)==null?void 0:Fe.color)||"hex",dimension:((Ue=c.valueFormatters)==null?void 0:Ue.dimension)||"px",numberPrecision:((Je=c.valueFormatters)==null?void 0:Je.numberPrecision)||2}:{color:((ut=ue.valueFormatters)==null?void 0:ut.color)||"hex",dimension:((Ze=ue.valueFormatters)==null?void 0:Ze.dimension)||"px",numberPrecision:((At=ue.valueFormatters)==null?void 0:At.numberPrecision)||2},onValueFormattersChange:gr=>{Ee&&d(vr=>({...vr,valueFormatters:gr}))},isReadOnly:!Ee,title:"Value Formatters"})})]})]})},_e=()=>{var Y,Ce,ue,Ee,ze,De,Ke,ve;switch(c.workflow){case"create-file":return o.jsxs(ce,{spacing:6,align:"stretch",children:[Me(),c.type==="platform-extension"&&o.jsxs(o.Fragment,{children:[o.jsx(on,{}),o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Syntax Patterns"}),o.jsxs(z,{p:3,borderWidth:1,borderRadius:"md",bg:A==="dark"?"gray.800":"gray.50",borderColor:A==="dark"?"gray.600":"gray.200",children:[o.jsxs(le,{spacing:4,align:"flex-end",children:[o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Prefix"}),o.jsx(yt,{value:((Y=c.syntaxPatterns)==null?void 0:Y.prefix)||"",onChange:Te=>d({...c,syntaxPatterns:{...c.syntaxPatterns,prefix:Te.target.value}}),placeholder:"e.g., TKN_"})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Suffix"}),o.jsx(yt,{value:((Ce=c.syntaxPatterns)==null?void 0:Ce.suffix)||"",onChange:Te=>d({...c,syntaxPatterns:{...c.syntaxPatterns,suffix:Te.target.value}}),placeholder:"e.g., _SUF"})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Delimiter"}),o.jsxs(Kt,{value:((ue=c.syntaxPatterns)==null?void 0:ue.delimiter)||"",onChange:Te=>d({...c,syntaxPatterns:{...c.syntaxPatterns,delimiter:Te.target.value}}),children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"_",children:"Underscore (_)"}),o.jsx("option",{value:"-",children:"Hyphen (-)"}),o.jsx("option",{value:".",children:"Dot (.)"}),o.jsx("option",{value:"/",children:"Slash (/)"})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Capitalization"}),o.jsxs(Kt,{value:((Ee=c.syntaxPatterns)==null?void 0:Ee.capitalization)??"none",onChange:Te=>d({...c,syntaxPatterns:{...c.syntaxPatterns,capitalization:Te.target.value}}),children:[o.jsx("option",{value:"none",children:"None"}),o.jsx("option",{value:"uppercase",children:"UPPERCASE"}),o.jsx("option",{value:"lowercase",children:"lowercase"}),o.jsx("option",{value:"capitalize",children:"Capitalize"})]})]})]}),o.jsxs(ce,{spacing:3,align:"stretch",mt:4,children:[o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Format String"}),o.jsx(yt,{value:((ze=c.syntaxPatterns)==null?void 0:ze.formatString)||"",onChange:Te=>d({...c,syntaxPatterns:{...c.syntaxPatterns,formatString:Te.target.value}}),placeholder:"e.g., {prefix}{name}{suffix}",width:"100%"})]}),o.jsxs(z,{mt:2,p:3,borderWidth:1,borderRadius:"md",bg:A==="dark"?"gray.700":"gray.100",children:[o.jsx(E,{fontSize:"sm",color:"gray.500",mb:1,fontWeight:"bold",children:"Preview"}),o.jsx(E,{fontFamily:"mono",fontSize:"md",wordBreak:"break-all",children:ie})]})]})]}),o.jsx(on,{}),o.jsx(E,{fontWeight:"bold",fontSize:"sm",color:"gray.600",children:"Value Formatters"}),o.jsxs(le,{spacing:4,children:[o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Color Format"}),o.jsxs(Kt,{value:((De=c.valueFormatters)==null?void 0:De.color)||"hex",onChange:Te=>d({...c,valueFormatters:{...c.valueFormatters,color:Te.target.value}}),children:[o.jsx("option",{value:"hex",children:"Hex"}),o.jsx("option",{value:"rgb",children:"RGB"}),o.jsx("option",{value:"rgba",children:"RGBA"}),o.jsx("option",{value:"hsl",children:"HSL"}),o.jsx("option",{value:"hsla",children:"HSLA"})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Dimension Unit"}),o.jsxs(Kt,{value:((Ke=c.valueFormatters)==null?void 0:Ke.dimension)||"px",onChange:Te=>d({...c,valueFormatters:{...c.valueFormatters,dimension:Te.target.value}}),children:[o.jsx("option",{value:"px",children:"px"}),o.jsx("option",{value:"rem",children:"rem"}),o.jsx("option",{value:"em",children:"em"}),o.jsx("option",{value:"pt",children:"pt"}),o.jsx("option",{value:"dp",children:"dp"}),o.jsx("option",{value:"sp",children:"sp"})]})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Number Precision"}),o.jsx(yt,{type:"number",min:0,max:10,value:((ve=c.valueFormatters)==null?void 0:ve.numberPrecision)||2,onChange:Te=>d({...c,valueFormatters:{...c.valueFormatters,numberPrecision:parseInt(Te.target.value)}})})]})]})]});case"create-repository":return se();default:return null}};return o.jsxs(o.Fragment,{children:[o.jsxs(Zr,{isOpen:e,onClose:r,size:"xl",children:[o.jsx(Dr,{}),o.jsxs(Xr,{maxW:"900px",children:[o.jsx(Rr,{children:o.jsxs(ce,{align:"start",spacing:2,children:[o.jsx(E,{children:"Edit Platform"}),o.jsx(le,{spacing:2,children:c.type==="platform-extension"&&(()=>{const Y=O();return Y!=null&&Y.extensionSource?Y.extensionSource.repositoryUri==="local"?o.jsx(wt,{colorScheme:"blue",variant:"subtle",children:"Local"}):o.jsx(wt,{colorScheme:"green",variant:"subtle",children:"External"}):null})()})]})}),o.jsx(Or,{children:o.jsxs(ce,{spacing:6,align:"stretch",children:[c.type==="platform-extension"&&o.jsxs(o.Fragment,{children:[de(),o.jsx(on,{})]}),Se(),o.jsx(on,{}),_e(),c.type==="platform-extension"&&o.jsx(o.Fragment,{children:fe()})]})}),o.jsx(rn,{children:o.jsxs(le,{spacing:3,children:[(s||i)&&o.jsx(Oe,{colorScheme:"red",variant:"outline",onClick:()=>_(!0),children:"Delete"}),o.jsx(Oe,{variant:"ghost",mr:3,onClick:r,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:xe,children:"Save Changes"})]})})]})]}),o.jsx(uc,{isOpen:P,leastDestructiveRef:R,onClose:()=>_(!1),isCentered:!0,children:o.jsx(Dr,{bg:"blackAlpha.300",backdropFilter:"blur(2px)",children:o.jsxs(hc,{maxW:"500px",mx:"auto",my:"auto",borderRadius:"lg",boxShadow:"xl",children:[o.jsx(Rr,{fontSize:"lg",fontWeight:"bold",children:"Delete Extension"}),o.jsx(Or,{children:o.jsxs(ce,{align:"stretch",spacing:4,children:[o.jsxs(E,{children:["Delete extension â€œ",t.platformId||t.themeId,"â€?"]}),o.jsxs(zt,{status:"warning",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(ce,{align:"start",spacing:1,children:[o.jsx(E,{fontWeight:"bold",children:"Warning: This action will:"}),l!=null&&l.hasError&&(l.errorType==="file-not-found"||l.errorType==="repository-not-found")?o.jsxs(o.Fragment,{children:[o.jsx(E,{children:"â€¢ Remove the platform from local data (file already missing)"}),o.jsx(E,{children:"â€¢ Remove the repository link"}),o.jsx(E,{children:"â€¢ Clean up all associated files"})]}):o.jsxs(o.Fragment,{children:[o.jsx(E,{children:"â€¢ Delete the file from GitHub repository"}),o.jsx(E,{children:"â€¢ Remove the repository link"}),o.jsx(E,{children:"â€¢ Remove the platform from local data"}),o.jsx(E,{children:"â€¢ Clean up all associated files"})]}),o.jsx(E,{fontWeight:"bold",color:"red.500",children:"â€¢ This action cannot be undone"})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Type â€œdeleteâ€ to confirm"}),o.jsx(yt,{value:C,onChange:Y=>T(Y.target.value),placeholder:"Type delete to confirm",autoFocus:!0})]})]})}),o.jsxs(rn,{children:[o.jsx(Oe,{ref:R,onClick:()=>_(!1),children:"Cancel"}),i&&o.jsx(Oe,{colorScheme:"orange",onClick:B,ml:3,children:"Deprecate"}),s&&o.jsx(Oe,{colorScheme:"red",onClick:$,ml:3,isDisabled:C!=="delete",children:"Yes, delete"})]})]})})}),o.jsx(_M,{isOpen:G,onClose:()=>ne(!1),onSourceSelected:be,schemaType:c.type})]})},VM=({analytics:t,platformExtensions:e,hasCoreData:r})=>{const n=t.totalTokens>0?t.overriddenTokens/t.totalTokens*100:0,s=t.totalTokens>0?t.newTokens/t.totalTokens*100:0,i=t.totalTokens>0?t.omittedTokens/t.totalTokens*100:0,a=e.filter(c=>c.isValid),l=e.filter(c=>!c.isValid);return o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsxs(Zn,{children:[o.jsx(ss,{children:o.jsx(Tt,{size:"md",children:"Platform Analytics Overview"})}),o.jsx(Xn,{children:o.jsxs(Qs,{columns:{base:1,md:2,lg:3},spacing:6,children:[o.jsxs(un,{children:[o.jsx(hn,{children:"Total Tokens"}),o.jsx(mn,{children:t.totalTokens}),o.jsx(rs,{children:"Core data tokens"})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Platform Extensions"}),o.jsx(mn,{children:t.platformCount}),o.jsxs(rs,{children:[a.length," valid, ",l.length," invalid"]})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Theme Overrides"}),o.jsx(mn,{children:t.themeCount}),o.jsx(rs,{children:"Active theme overrides"})]})]})})]}),o.jsxs(Zn,{children:[o.jsx(ss,{children:o.jsx(Tt,{size:"md",children:"Token Analysis"})}),o.jsx(Xn,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(z,{children:[o.jsxs(le,{justify:"space-between",mb:2,children:[o.jsx(E,{fontWeight:"medium",children:"Overridden Tokens"}),o.jsxs(E,{fontSize:"sm",color:"gray.600",children:[t.overriddenTokens," of ",t.totalTokens]})]}),o.jsx(sc,{value:n,colorScheme:"blue",size:"sm"}),o.jsxs(E,{fontSize:"xs",color:"gray.500",mt:1,children:[n.toFixed(1),"% of tokens have platform-specific overrides"]})]}),o.jsxs(z,{children:[o.jsxs(le,{justify:"space-between",mb:2,children:[o.jsx(E,{fontWeight:"medium",children:"New Tokens"}),o.jsxs(E,{fontSize:"sm",color:"gray.600",children:[t.newTokens," added by platforms"]})]}),o.jsx(sc,{value:s,colorScheme:"green",size:"sm"}),o.jsxs(E,{fontSize:"xs",color:"gray.500",mt:1,children:[s.toFixed(1),"% of tokens are platform-specific additions"]})]}),o.jsxs(z,{children:[o.jsxs(le,{justify:"space-between",mb:2,children:[o.jsx(E,{fontWeight:"medium",children:"Omitted Tokens"}),o.jsxs(E,{fontSize:"sm",color:"gray.600",children:[t.omittedTokens," hidden by platforms"]})]}),o.jsx(sc,{value:i,colorScheme:"orange",size:"sm"}),o.jsxs(E,{fontSize:"xs",color:"gray.500",mt:1,children:[i.toFixed(1),"% of tokens are omitted by platforms"]})]})]})})]}),o.jsxs(Zn,{children:[o.jsx(ss,{children:o.jsx(Tt,{size:"md",children:"Platform Extension Status"})}),o.jsx(Xn,{children:e.length===0?o.jsx(z,{textAlign:"center",py:4,children:o.jsx(E,{color:"gray.500",children:"No platform extensions linked"})}):o.jsx(ce,{spacing:4,align:"stretch",children:e.map(c=>o.jsxs(z,{children:[o.jsx(le,{justify:"space-between",mb:2,children:o.jsxs(le,{children:[o.jsx(wt,{colorScheme:c.isValid?"green":"red",variant:"solid",children:c.isValid?"Valid":"Invalid"}),o.jsx(E,{fontWeight:"medium",children:c.platformId})]})}),c.errors.length>0&&o.jsxs(zt,{status:"error",size:"sm",mb:2,children:[o.jsx(Lt,{}),o.jsx(ce,{align:"start",spacing:1,children:c.errors.map((d,u)=>o.jsx(E,{fontSize:"xs",children:d},u))})]}),c.warnings.length>0&&o.jsxs(zt,{status:"warning",size:"sm",children:[o.jsx(Lt,{}),o.jsx(ce,{align:"start",spacing:1,children:c.warnings.map((d,u)=>o.jsx(E,{fontSize:"xs",children:d},u))})]}),c.errors.length===0&&c.warnings.length===0&&o.jsx(E,{fontSize:"sm",color:"green.600",children:"âœ“ No issues found"})]},c.platformId))})})]}),o.jsxs(Zn,{children:[o.jsx(ss,{children:o.jsx(Tt,{size:"md",children:"Data Source Status"})}),o.jsx(Xn,{children:o.jsxs(ce,{spacing:3,align:"stretch",children:[o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{children:"Core Data"}),o.jsx(wt,{colorScheme:r?"green":"red",children:r?"Connected":"Not Connected"})]}),o.jsx(on,{}),o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{children:"Platform Extensions"}),o.jsxs(wt,{colorScheme:t.platformCount>0?"green":"gray",children:[t.platformCount," Connected"]})]}),o.jsx(on,{}),o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{children:"Theme Overrides"}),o.jsxs(wt,{colorScheme:t.themeCount>0?"green":"gray",children:[t.themeCount," Connected"]})]})]})})]})]})},$M=()=>{const[t,e]=M.useState(null),[r,n]=M.useState(!1),[s,i]=M.useState(!1),a=Hr(),l=()=>{const y=qr.getCacheStats();e(y)};M.useEffect(()=>{l();const y=setInterval(l,5e3);return()=>clearInterval(y)},[]);const c=async()=>{i(!0);try{qr.forceClearAll(),l(),a({title:"Cache Cleared",description:"All GitHub cache has been cleared successfully.",status:"success",duration:3e3,isClosable:!0})}catch{a({title:"Cache Clear Failed",description:"Failed to clear cache. Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{i(!1)}},d=y=>{if(y===0)return"0 B";const v=1024,I=["B","KB","MB","GB"],S=Math.floor(Math.log(y)/Math.log(v));return parseFloat((y/Math.pow(v,S)).toFixed(2))+" "+I[S]},u=()=>{if(!t)return"good";const y=t.totalSize/(t.totalSize+t.availableStorage)*100;return y>80?"critical":y>60?"warning":"good"},m=y=>{switch(y){case"good":return"green";case"warning":return"yellow";case"critical":return"red"}};if(!t)return o.jsx(Zn,{children:o.jsx(Xn,{children:o.jsx(E,{children:"Loading cache statistics..."})})});const g=u();return o.jsxs(Zn,{children:[o.jsx(ss,{children:o.jsxs(le,{justify:"space-between",children:[o.jsxs(z,{children:[o.jsx(Tt,{size:"sm",children:"GitHub Cache Debug"}),o.jsx(E,{fontSize:"sm",color:"gray.600",mt:1,children:"Monitor and manage GitHub API cache storage"})]}),o.jsx(wt,{colorScheme:m(g),children:g.toUpperCase()})]})}),o.jsx(Xn,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[g!=="good"&&o.jsxs(zt,{status:g==="critical"?"error":"warning",children:[o.jsx(Lt,{}),g==="critical"?"Storage usage is critical. Consider clearing cache to free space.":"Storage usage is high. Monitor cache size."]}),o.jsxs(Qs,{columns:{base:1,md:2,lg:4},spacing:4,children:[o.jsxs(un,{children:[o.jsx(hn,{children:"Total Entries"}),o.jsx(mn,{children:t.totalEntries}),o.jsx(rs,{children:"Cache entries"})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Valid Entries"}),o.jsx(mn,{color:"green.500",children:t.validEntries}),o.jsx(rs,{children:"Not expired"})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Expired Entries"}),o.jsx(mn,{color:"red.500",children:t.expiredEntries}),o.jsx(rs,{children:"Ready for cleanup"})]}),o.jsxs(un,{children:[o.jsx(hn,{children:"Total Size"}),o.jsx(mn,{children:d(t.totalSize)}),o.jsx(rs,{children:"Cache storage used"})]})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"medium",mb:2,children:"Available Storage"}),o.jsx(E,{fontSize:"lg",color:m(g),children:d(t.availableStorage)}),o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Estimated available localStorage space"})]}),o.jsxs(le,{spacing:3,children:[o.jsxs(Oe,{size:"sm",onClick:()=>n(!r),variant:"outline",children:[r?"Hide":"Show"," Details"]}),o.jsx(Oe,{size:"sm",colorScheme:"blue",onClick:l,children:"Refresh Stats"}),o.jsx(Oe,{size:"sm",colorScheme:"red",onClick:c,isLoading:s,loadingText:"Clearing...",children:"Clear All Cache"})]}),o.jsx(Gm,{in:r,children:o.jsxs(z,{mt:4,p:4,bg:"gray.50",borderRadius:"md",children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:2,children:"Cache Details:"}),o.jsxs(ce,{spacing:2,align:"stretch",children:[o.jsxs(E,{fontSize:"xs",children:[o.jsx("strong",{children:"Cache Prefix:"})," github_cache_"]}),o.jsxs(E,{fontSize:"xs",children:[o.jsx("strong",{children:"Storage Limit:"})," ~5MB (varies by browser)"]}),o.jsxs(E,{fontSize:"xs",children:[o.jsx("strong",{children:"Repository Cache:"})," Max 1000 entries, 1MB"]}),o.jsxs(E,{fontSize:"xs",children:[o.jsx("strong",{children:"Branch Cache:"})," Max 100KB per repository"]}),o.jsxs(E,{fontSize:"xs",children:[o.jsx("strong",{children:"Organization Cache:"})," Max 50KB"]}),o.jsxs(E,{fontSize:"xs",children:[o.jsx("strong",{children:"TTL:"})," Repos 5min, Branches 2min, Orgs 10min"]})]})]})})]})})]})};class Rx{static async createPlatformExtensionRepository(e){try{const r=await xt.createRepository({name:e.name,description:e.description||`Platform extension for ${e.platformId}`,private:e.visibility==="private",autoInit:!0,organization:e.organization}),n={systemId:e.systemId,platformId:e.platformId,version:"1.0.0",figmaFileKey:`${e.platformId}-figma-file`,metadata:{name:e.displayName||e.platformId,description:e.description||`Platform extension for ${e.platformId}`,maintainer:"",lastUpdated:new Date().toISOString().split("T")[0],repositoryVisibility:e.visibility},syntaxPatterns:e.syntaxPatterns||{prefix:"",suffix:"",delimiter:"_",capitalization:"camel",formatString:""},valueFormatters:e.valueFormatters||{color:"hex",dimension:"px",numberPrecision:2},algorithmVariableOverrides:[],tokenOverrides:[],omittedModes:[],omittedDimensions:[]};return await xt.createFile(r.full_name,"platforms/platform-extension.json",JSON.stringify(n,null,2),"main",`Add platform extension file for ${e.platformId}`),L.setPlatformExtensionFile(e.platformId,n),L.setPlatformExtensionFileContent(e.platformId,JSON.stringify(n,null,2)),{id:r.id,name:r.name,fullName:r.full_name,description:r.description,visibility:r.private?"private":"public",htmlUrl:r.html_url,cloneUrl:r.clone_url,defaultBranch:r.default_branch,initialFilePath:"platforms/platform-extension.json"}}catch(r){throw console.error("Simple repository creation failed:",r),new Error(`Failed to create repository: ${r instanceof Error?r.message:"Unknown error"}`)}}static async createPlatformExtensionFile(e,r){try{const n=xt.getSelectedRepositoryInfo();if(!n)throw new Error("No repository selected. Please select a repository first.");const s={systemId:r.systemId,platformId:r.platformId,version:"1.0.0",figmaFileKey:`${r.platformId}-figma-file`,metadata:{name:r.displayName||r.platformId,description:r.description||`Platform extension for ${r.platformId}`,maintainer:"",lastUpdated:new Date().toISOString().split("T")[0],repositoryVisibility:"public"},syntaxPatterns:r.syntaxPatterns||{prefix:"",suffix:"",delimiter:"_",capitalization:"camel",formatString:""},valueFormatters:r.valueFormatters||{color:"hex",dimension:"px",numberPrecision:2},algorithmVariableOverrides:[],tokenOverrides:[],omittedModes:[],omittedDimensions:[]},i=`platforms/${e}`;await xt.createFile(n.fullName,i,JSON.stringify(s,null,2),n.branch,`Add platform extension file: ${e} for ${r.platformId}`),L.setPlatformExtensionFile(r.platformId,s),L.setPlatformExtensionFileContent(r.platformId,JSON.stringify(s,null,2))}catch(n){throw console.error("Failed to create platform extension file:",n),new Error(`Failed to create file: ${n instanceof Error?n.message:"Unknown error"}`)}}static validateConfig(e){var n,s,i;const r=[];return(n=e.name)!=null&&n.trim()?/^[a-zA-Z0-9-_]+$/.test(e.name)||r.push("Repository name can only contain letters, numbers, hyphens, and underscores"):r.push("Repository name is required"),(s=e.systemId)!=null&&s.trim()||r.push("System ID is required"),(i=e.platformId)!=null&&i.trim()||r.push("Platform ID is required"),e.visibility?["public","private"].includes(e.visibility)||r.push("Invalid visibility. Must be one of: public, private"):r.push("Repository visibility is required"),{isValid:r.length===0,errors:r}}}const wa=class wa{constructor(){rt(this,"cache",new Map);rt(this,"CACHE_DURATION",2*60*1e3)}static getInstance(){return wa.instance||(wa.instance=new wa),wa.instance}async getPlatformExtensionStatus(e){const r=`platform-status-${e.id}`,n=this.cache.get(r);if(n&&Date.now()-n.timestamp<this.CACHE_DURATION)return n.data;const s=await this.checkPlatformExtensionStatus(e);return this.cache.set(r,{data:s,timestamp:Date.now()}),s}async getPlatformsExtensionStatus(e){const r=e.map(n=>this.getPlatformExtensionStatus(n));return Promise.all(r)}async checkPlatformExtensionStatus(e){if(!e.extensionSource)return{platformId:e.id,platformName:e.displayName,hasError:!1,isLocal:!1};const r=e.extensionSource.repositoryUri==="local";try{const n=await Di.getPlatformExtensionData(e.extensionSource.repositoryUri,e.extensionSource.filePath,"main",e.id);if(n.data){if(r&&n.source!=="github"){const s="file-not-found",i=`File not found: ${e.extensionSource.filePath}`;return{platformId:e.id,platformName:e.displayName,hasError:!0,errorType:s,errorMessage:i,isLocal:r,repositoryUri:e.extensionSource.repositoryUri,filePath:e.extensionSource.filePath}}return{platformId:e.id,platformName:e.displayName,hasError:!1,isLocal:r,repositoryUri:e.extensionSource.repositoryUri,filePath:e.extensionSource.filePath}}else{const s=r?"file-not-found":"repository-not-found",i=r?`File not found: ${e.extensionSource.filePath}`:`Repository not found: ${e.extensionSource.repositoryUri}`;return{platformId:e.id,platformName:e.displayName,hasError:!0,errorType:s,errorMessage:i,isLocal:r,repositoryUri:e.extensionSource.repositoryUri,filePath:e.extensionSource.filePath}}}catch{const s=r?"file-not-found":"repository-not-found",i=r?`File not found: ${e.extensionSource.filePath}`:`Repository not found: ${e.extensionSource.repositoryUri}`;return{platformId:e.id,platformName:e.displayName,hasError:!0,errorType:s,errorMessage:i,isLocal:r,repositoryUri:e.extensionSource.repositoryUri,filePath:e.extensionSource.filePath}}}clearCache(){this.cache.clear()}clearCacheForPlatform(e){const r=`platform-status-${e}`;this.cache.delete(r)}};rt(wa,"instance");let rf=wa;const zM=({platforms:t=[],setPlatforms:e,canEdit:r=!1})=>{const{colorMode:n}=Vt(),[s]=M.useState(!1),[i,a]=M.useState(null),[l,c]=M.useState({totalTokens:0,overriddenTokens:0,newTokens:0,omittedTokens:0,platformCount:0,themeCount:0}),[d,u]=M.useState([]),[m,g]=M.useState([]),[y,v]=M.useState(!1),[I,S]=M.useState(!1),[b,k]=M.useState(null),[A,C]=M.useState("core"),T=Qd("gray.50","gray.800"),P=Qd("gray.200","gray.600"),_=Hr(),R=$a.getInstance(),G=Un.getInstance(),ne=rf.getInstance(),he=async()=>{const{StorageService:$}=await ir(async()=>{const{StorageService:U}=await Promise.resolve().then(()=>ko);return{StorageService:U}},void 0);return $.getRootData().systemId||"system-default"};M.useEffect(()=>{(()=>{const B=G.getCurrentSnapshot();if(B.tokens&&B.tokens.length>0){C("core");return}if(B.themeOverrides&&Object.keys(B.themeOverrides).length>0){C("theme");return}if(B.platformExtensions&&Object.keys(B.platformExtensions).length>0&&(!B.tokens||B.tokens.length===0)){C("extension");return}C("core")})()},[G]),M.useEffect(()=>{(async()=>{try{R.setCallbacks({onDataLoaded:X=>{c(X.analytics);const ee=R.validatePlatformExtensions();u(ee)},onRepositoryLinked:X=>{console.log("ðŸ” [onRepositoryLinked] Repository linked:",X)},onRepositoryUnlinked:()=>{console.log("ðŸ” [onRepositoryUnlinked] Repository unlinked")},onError:X=>{a(X)}});const B=R.getCurrentData();c(B.analytics);const U=R.validatePlatformExtensions();u(U)}catch(B){console.error("Failed to initialize MultiRepositoryManager:",B),a("Failed to initialize repository manager")}})()},[R,_,G]),M.useEffect(()=>{console.log("ðŸ” [platforms state changed] Current platforms:",t)},[t]),M.useEffect(()=>{(async()=>{if(t.length>0)try{const B=await ne.getPlatformsExtensionStatus(t);g(B)}catch(B){console.error("Failed to load platform extension statuses:",B)}else g([])})()},[t,ne]);const te=$=>{console.log("ðŸ” [updatePlatformsInDataManager] Updating platforms through App-level state management:",$),e==null||e($),ne.clearCache()},K=async $=>{try{switch($.workflow){case"link-existing":{if(await R.linkRepository($.type,$.repositoryUri,$.branch,$.filePath,$.platformId,$.themeId),$.platformId&&$.type==="platform-extension"){const{StorageService:B}=await ir(async()=>{const{StorageService:X}=await Promise.resolve().then(()=>ko);return{StorageService:X}},void 0),{GitHubApiService:U}=await ir(async()=>{const{GitHubApiService:X}=await Promise.resolve().then(()=>fo);return{GitHubApiService:X}},void 0);try{const X=await U.getFileContent($.repositoryUri,$.filePath,$.branch);if(X&&X.content){const ee=JSON.parse(X.content);B.setPlatformExtensionFile($.platformId,ee),B.setPlatformExtensionFileContent($.platformId,X.content),console.log("ðŸ” [link-existing] Stored platform extension data locally for:",$.platformId)}}catch(X){console.warn("ðŸ” [link-existing] Failed to fetch platform extension data for local storage:",X)}}if($.platformId){const U=G.getCurrentSnapshot().platforms,X=U.findIndex(be=>be.id===$.platformId);if(X!==-1){const be=[...U];be[X]={...be[X],extensionSource:{repositoryUri:$.repositoryUri,filePath:$.filePath}},te(be),console.log("ðŸ” [link-existing] Updated existing platform with extension source:",$.platformId)}else{const be={id:$.platformId,displayName:$.displayName||$.platformId,description:$.description||"",extensionSource:{repositoryUri:$.repositoryUri,filePath:$.filePath}},Se=[...U,be];te(Se),console.log("ðŸ” [link-existing] Created new platform with extension source:",$.platformId)}const ee=R.validatePlatformExtensions();u(ee)}break}case"create-file":if($.platformId&&$.type==="platform-extension")try{const B=$.newFileName||"platform-extension.json",U={name:"",description:$.description||`Platform extension for ${$.platformId}`,visibility:"public",systemId:$.systemId||await he(),platformId:$.platformId,displayName:$.displayName,syntaxPatterns:$.syntaxPatterns,valueFormatters:$.valueFormatters};await Rx.createPlatformExtensionFile(B,U);const{GitHubApiService:X}=await ir(async()=>{const{GitHubApiService:se}=await Promise.resolve().then(()=>fo);return{GitHubApiService:se}},void 0);if(!X.getSelectedRepositoryInfo())throw new Error("No repository selected. Please load a file from GitHub first.");const Se=G.getCurrentSnapshot().platforms,Me=Se.findIndex(se=>se.id===$.platformId);if(Me!==-1){const se=[...Se];se[Me]={...se[Me],extensionSource:{repositoryUri:"local",filePath:`platforms/${B}`}},te(se)}else{const se={id:$.platformId,displayName:$.displayName||$.platformId,description:$.description||"",extensionSource:{repositoryUri:"local",filePath:`platforms/${B}`}};te([...Se,se])}_({title:"Extension File Created",description:`Platform extension file "${B}" has been created in repository with schema-compliant structure`,status:"success",duration:3e3,isClosable:!0})}catch(B){throw console.error("Failed to create platform extension file:",B),_({title:"File Creation Failed",description:B instanceof Error?B.message:"Failed to create platform extension file",status:"error",duration:5e3,isClosable:!0}),B}break;case"create-repository":if($.platformId&&$.type==="platform-extension")try{console.log("ðŸ” [PlatformsView] Creating repository with simplified approach");const B={name:$.newRepositoryName||`${$.platformId}-${Date.now()}`,description:$.newRepositoryDescription||`Platform extension for ${$.platformId}`,visibility:$.newRepositoryVisibility||"public",organization:"",systemId:$.systemId||await he(),platformId:$.platformId,displayName:$.displayName,syntaxPatterns:$.syntaxPatterns,valueFormatters:$.valueFormatters};console.log("ðŸ” [PlatformsView] Repository config:",B);const U=await Rx.createPlatformExtensionRepository(B);console.log("ðŸ” [PlatformsView] Repository created successfully:",U);const ee=G.getCurrentSnapshot().platforms,be={id:$.platformId,displayName:$.displayName||$.platformId,description:$.description||"",extensionSource:{repositoryUri:U.fullName,filePath:U.initialFilePath}},Se=[...ee,be];te(Se),await R.linkRepository("platform-extension",U.fullName,U.defaultBranch,U.initialFilePath||"platforms/platform-extension.json",$.platformId);const Me=R.validatePlatformExtensions();u(Me),_({title:"Repository Created Successfully",description:`Created ${U.name} and linked it to platform ${$.platformId}`,status:"success",duration:5e3,isClosable:!0})}catch(B){console.error("ðŸ” [PlatformsView] Repository creation failed:",B);let U="Failed to create repository";B instanceof Error&&(B.message.includes("name already exists")?U="Repository name already exists. Please choose a different name.":B.message.includes("authentication")?U="GitHub authentication required. Please sign in to GitHub first.":B.message.includes("permission")?U="Insufficient permissions to create repository. Please check your GitHub permissions.":U=B.message),_({title:"Repository Creation Failed",description:U,status:"error",duration:8e3,isClosable:!0})}break}v(!1)}catch(B){console.error("Error linking repository:",B)}},O=($,B)=>{if(B)k(B),S(!0);else if($.extensionSource){const U={id:`extension-${$.id}`,type:"platform-extension",repositoryUri:$.extensionSource.repositoryUri,branch:"main",filePath:$.extensionSource.filePath,platformId:$.id,status:"linked"};k(U),S(!0)}else{const U={id:`mock-${$.id}`,type:"platform-extension",repositoryUri:"",branch:"main",filePath:"",platformId:$.id,status:"linked"};k(U),S(!0)}},Z=async $=>{var B,U,X,ee,be,Se,Me,se;if(b)try{const de=b.id.startsWith("mock-"),fe=b.id.startsWith("extension-");if(de)$.repositoryUri&&$.filePath&&$.platformId&&await K({type:"platform-extension",repositoryUri:$.repositoryUri,branch:$.branch,filePath:$.filePath,platformId:$.platformId,systemId:await he(),displayName:$.displayName||$.platformId,description:$.description||"",syntaxPatterns:{prefix:((B=$.syntaxPatterns)==null?void 0:B.prefix)||"",suffix:((U=$.syntaxPatterns)==null?void 0:U.suffix)||"",delimiter:((X=$.syntaxPatterns)==null?void 0:X.delimiter)||"_",capitalization:((ee=$.syntaxPatterns)==null?void 0:ee.capitalization)||"none",formatString:((be=$.syntaxPatterns)==null?void 0:be.formatString)||""},valueFormatters:{color:((Se=$.valueFormatters)==null?void 0:Se.color)||"hex",dimension:((Me=$.valueFormatters)==null?void 0:Me.dimension)||"px",numberPrecision:((se=$.valueFormatters)==null?void 0:se.numberPrecision)||2},workflow:"link-existing"});else if(fe){const Y=G.getCurrentSnapshot().platforms,Ce=Y.findIndex(ue=>ue.id===b.platformId);if(Ce!==-1){const ue=[...Y];if(ue[Ce]={...ue[Ce],displayName:$.displayName||ue[Ce].displayName,description:$.description||ue[Ce].description,figmaPlatformMapping:$.figmaPlatformMapping||ue[Ce].figmaPlatformMapping},te(ue),b.repositoryUri==="local"&&b.platformId){const{StorageService:Ee}=await ir(async()=>{const{StorageService:De}=await Promise.resolve().then(()=>ko);return{StorageService:De}},void 0),ze=Ee.getPlatformExtensionFile(b.platformId);if(ze&&typeof ze=="object"&&ze!==null){const De=ze,Ke=De.metadata,ve={...De,metadata:{...Ke,name:$.displayName||(Ke==null?void 0:Ke.name)||"",description:$.description||(Ke==null?void 0:Ke.description)||""}};Ee.setPlatformExtensionFile(b.platformId,ve),Ee.setPlatformExtensionFileContent(b.platformId,JSON.stringify(ve,null,2))}}_({title:"Platform Updated",description:"Platform settings have been updated successfully.",status:"success",duration:3e3,isClosable:!0})}else throw new Error(`Platform with ID "${b.platformId}" not found`)}else await R.updateRepositoryLink(b.id,{branch:$.branch,filePath:$.filePath}),_({title:"Extension Updated",description:"Extension settings have been updated successfully.",status:"success",duration:3e3,isClosable:!0});S(!1),k(null)}catch(de){_({title:"Update Failed",description:de instanceof Error?de.message:"Failed to update extension settings.",status:"error",duration:5e3,isClosable:!0})}},ie=async $=>{console.log("ðŸ” [handleDeleteRepository] Starting delete process for repositoryId:",$);try{const B=$.startsWith("mock-"),U=$.startsWith("extension-");if(console.log("ðŸ” [handleDeleteRepository] Is mock repository:",B,"Is extension repository:",U),B||U){const X=$.replace("mock-","").replace("extension-","");console.log("ðŸ” [handleDeleteRepository] Extracted platformId from mock repository:",X);const{StorageService:ee}=await ir(async()=>{const{StorageService:se}=await Promise.resolve().then(()=>ko);return{StorageService:se}},void 0),Se=G.getCurrentSnapshot().platforms;console.log("ðŸ” [handleDeleteRepository] Current platforms from DataManager:",Se);const Me=Se.findIndex(se=>se.id===X);if(console.log("ðŸ” [handleDeleteRepository] Platform index found:",Me),Me!==-1){const se=Se[Me];if(console.log("ðŸ” [handleDeleteRepository] Found platform:",se),console.log("ðŸ” [handleDeleteRepository] Platform has extensionSource:",!!se.extensionSource),se.extensionSource){console.log("ðŸ” [handleDeleteRepository] Platform has extensionSource, checking if local or external");const fe=se.extensionSource.repositoryUri==="local";if(console.log("ðŸ” [handleDeleteRepository] Is local file:",fe),fe){console.log("ðŸ” [handleDeleteRepository] Deleting local file...");const Y=m.find(ue=>ue.platformId===X);if((Y==null?void 0:Y.hasError)&&(Y.errorType==="file-not-found"||Y.errorType==="repository-not-found"))console.log("ðŸ” [handleDeleteRepository] File is known to be missing, skipping file deletion"),_({title:"File Already Missing",description:"The platform file was already missing. Removing platform from core data only.",status:"info",duration:3e3,isClosable:!0});else try{const ue=xt.getSelectedRepositoryInfo();if(!ue)throw new Error("No repository selected for local file deletion");await xt.deleteFile(ue.fullName,se.extensionSource.filePath,ue.branch,`Delete local platform extension: ${X}`),console.log("ðŸ” [handleDeleteRepository] Local file successfully deleted from GitHub")}catch(ue){console.error("ðŸ” [handleDeleteRepository] Failed to delete local file:",ue);const Ee=ue instanceof Error?ue.message:"Unknown error";Ee.includes("not found")||Ee.includes("cannot be accessed")?_({title:"File Not Found",description:`File not found or you don't have access: ${se.extensionSource.filePath}. The platform will still be removed from core data.`,status:"warning",duration:5e3,isClosable:!0}):_({title:"Local File Delete Failed",description:`Failed to delete local file: ${Ee}. The platform will still be removed from core data.`,status:"warning",duration:5e3,isClosable:!0})}}else console.log("ðŸ” [handleDeleteRepository] External repository - only removing from core data");const _e=Se.filter((Y,Ce)=>Ce!==Me);console.log("ðŸ” [handleDeleteRepository] Updated platforms after removal:",_e),te(_e),console.log("ðŸ” [handleDeleteRepository] Removing platform extension files from localStorage..."),ee.removePlatformExtensionFile(X),ee.removePlatformExtensionFileContent(X),console.log("ðŸ” [handleDeleteRepository] Platform extension files removed from localStorage")}else{console.log("ðŸ” [handleDeleteRepository] Platform has no extensionSource - removing only extensionSource (core platform)");const fe=[...Se],{extensionSource:_e,...Y}=se;fe[Me]=Y,console.log("ðŸ” [handleDeleteRepository] Updated platform without extensionSource:",Y),te(fe)}const de=G.getCurrentSnapshot();console.log("ðŸ” [handleDeleteRepository] Verification - platforms in DataManager after update:",de.platforms),console.log("âœ… [handleDeleteRepository] Mock repository delete process completed successfully")}else{console.error("âŒ [handleDeleteRepository] Platform not found in storage for platformId:",X),_({title:"Delete Failed",description:`Platform with ID "${X}" not found in storage.`,status:"error",duration:5e3,isClosable:!0});return}}else{const X=R.getRepositoryLink($);if(console.log("ðŸ” [handleDeleteRepository] Found repository:",X),!X){console.error("âŒ [handleDeleteRepository] No repository found for ID:",$),_({title:"Delete Failed",description:"Repository not found.",status:"error",duration:5e3,isClosable:!0});return}if(console.log("ðŸ” [handleDeleteRepository] Real repository link - only removing from core data"),console.log("ðŸ” [handleDeleteRepository] Removing from MultiRepositoryManager..."),R.unlinkRepository($),X.platformId){console.log("ðŸ” [handleDeleteRepository] Processing platform extension for platformId:",X.platformId);const{StorageService:ee}=await ir(async()=>{const{StorageService:se}=await Promise.resolve().then(()=>ko);return{StorageService:se}},void 0),Se=G.getCurrentSnapshot().platforms;console.log("ðŸ” [handleDeleteRepository] Current platforms from DataManager:",Se);const Me=Se.findIndex(se=>se.id===X.platformId);if(console.log("ðŸ” [handleDeleteRepository] Platform index found:",Me),Me!==-1){const se=Se[Me];if(console.log("ðŸ” [handleDeleteRepository] Found platform:",se),console.log("ðŸ” [handleDeleteRepository] Platform has extensionSource:",!!se.extensionSource),se.extensionSource){console.log("ðŸ” [handleDeleteRepository] Removing entire platform (created as extension)");const fe=Se.filter((_e,Y)=>Y!==Me);console.log("ðŸ” [handleDeleteRepository] Updated platforms after removal:",fe),te(fe),console.log("ðŸ” [handleDeleteRepository] Removing platform extension files from localStorage..."),ee.removePlatformExtensionFile(X.platformId),ee.removePlatformExtensionFileContent(X.platformId),console.log("ðŸ” [handleDeleteRepository] Platform extension files removed from localStorage")}else{console.log("ðŸ” [handleDeleteRepository] Removing only extensionSource (core platform)");const fe=[...Se],{extensionSource:_e,...Y}=se;fe[Me]=Y,console.log("ðŸ” [handleDeleteRepository] Updated platform without extensionSource:",Y),te(fe)}const de=G.getCurrentSnapshot();console.log("ðŸ” [handleDeleteRepository] Verification - platforms in DataManager after update:",de.platforms),console.log("âœ… [handleDeleteRepository] Real repository delete process completed successfully")}else{console.error("âŒ [handleDeleteRepository] Platform not found in storage for platformId:",X.platformId),_({title:"Delete Failed",description:`Platform with ID "${X.platformId}" not found in storage.`,status:"error",duration:5e3,isClosable:!0});return}}else console.log("ðŸ” [handleDeleteRepository] No platformId in repository, skipping platform cleanup")}_({title:"Platform Deleted",description:"Platform has been deleted from local storage. Changes will be saved to GitHub when you commit or create a PR.",status:"info",duration:3e3,isClosable:!0})}catch(B){console.error("âŒ [handleDeleteRepository] Error during delete process:",B),_({title:"Delete Failed",description:B instanceof Error?B.message:"Failed to delete platform.",status:"error",duration:5e3,isClosable:!0})}},ge=async $=>{console.log("ðŸ” [handleDeprecateRepository] Starting deprecate process for repositoryId:",$);try{const B=$.startsWith("mock-"),U=$.startsWith("extension-");if(console.log("ðŸ” [handleDeprecateRepository] Is mock repository:",B,"Is extension repository:",U),B||U){const X=$.replace("mock-","").replace("extension-","");console.log("ðŸ” [handleDeprecateRepository] Extracted platformId from mock repository:",X);const{StorageService:ee}=await ir(async()=>{const{StorageService:se}=await Promise.resolve().then(()=>ko);return{StorageService:se}},void 0),Se=G.getCurrentSnapshot().platforms;console.log("ðŸ” [handleDeprecateRepository] Current platforms from DataManager:",Se);const Me=Se.findIndex(se=>se.id===X);if(console.log("ðŸ” [handleDeprecateRepository] Platform index found:",Me),Me!==-1){const se=Se[Me];if(console.log("ðŸ” [handleDeprecateRepository] Found platform:",se),console.log("ðŸ” [handleDeprecateRepository] Platform has extensionSource:",!!se.extensionSource),se.extensionSource){console.log("ðŸ” [handleDeprecateRepository] Platform has extensionSource, checking if local or external");const fe=se.extensionSource.repositoryUri==="local";if(console.log("ðŸ” [handleDeprecateRepository] Is local file:",fe),fe){console.log("ðŸ” [handleDeprecateRepository] Deleting local file...");const Y=m.find(ue=>ue.platformId===X);if((Y==null?void 0:Y.hasError)&&(Y.errorType==="file-not-found"||Y.errorType==="repository-not-found"))console.log("ðŸ” [handleDeprecateRepository] File is known to be missing, skipping file deletion"),_({title:"File Already Missing",description:"The platform file was already missing. Removing platform from core data only.",status:"info",duration:3e3,isClosable:!0});else try{const ue=xt.getSelectedRepositoryInfo();if(!ue)throw new Error("No repository selected for local file deletion");await xt.deleteFile(ue.fullName,se.extensionSource.filePath,ue.branch,`Deprecate local platform extension: ${X}`),console.log("ðŸ” [handleDeprecateRepository] Local file successfully deleted from GitHub")}catch(ue){console.error("ðŸ” [handleDeprecateRepository] Failed to delete local file:",ue);const Ee=ue instanceof Error?ue.message:"Unknown error";Ee.includes("not found")||Ee.includes("cannot be accessed")?_({title:"File Not Found",description:`File not found or you don't have access: ${se.extensionSource.filePath}. The platform will still be removed from core data.`,status:"warning",duration:5e3,isClosable:!0}):_({title:"Local File Delete Failed",description:`Failed to delete local file: ${Ee}. The platform will still be removed from core data.`,status:"warning",duration:5e3,isClosable:!0})}}else console.log("ðŸ” [handleDeprecateRepository] External repository - only removing from core data");const _e=Se.filter((Y,Ce)=>Ce!==Me);console.log("ðŸ” [handleDeprecateRepository] Updated platforms after removal:",_e),te(_e),console.log("ðŸ” [handleDeprecateRepository] Removing platform extension files from localStorage..."),ee.removePlatformExtensionFile(X),ee.removePlatformExtensionFileContent(X),console.log("ðŸ” [handleDeprecateRepository] Platform extension files removed from localStorage")}else{console.log("ðŸ” [handleDeprecateRepository] Platform has no extensionSource - removing only extensionSource (core platform)");const fe=[...Se],{extensionSource:_e,...Y}=se;fe[Me]=Y,console.log("ðŸ” [handleDeprecateRepository] Updated platform without extensionSource:",Y),te(fe)}const de=G.getCurrentSnapshot();console.log("ðŸ” [handleDeprecateRepository] Verification - platforms in DataManager after update:",de.platforms),console.log("âœ… [handleDeprecateRepository] Mock repository deprecate process completed successfully")}else{console.error("âŒ [handleDeprecateRepository] Platform not found in storage for platformId:",X),_({title:"Deprecate Failed",description:`Platform with ID "${X}" not found in storage.`,status:"error",duration:5e3,isClosable:!0});return}}else{const X=R.getRepositoryLink($);if(console.log("ðŸ” [handleDeprecateRepository] Found repository:",X),!X){console.error("âŒ [handleDeprecateRepository] No repository found for ID:",$),_({title:"Deprecate Failed",description:"Repository not found.",status:"error",duration:5e3,isClosable:!0});return}if(console.log("ðŸ” [handleDeprecateRepository] Real repository link - only removing from core data"),console.log("ðŸ” [handleDeprecateRepository] Removing from MultiRepositoryManager..."),R.unlinkRepository($),X.platformId){console.log("ðŸ” [handleDeprecateRepository] Processing platform extension for platformId:",X.platformId);const{StorageService:ee}=await ir(async()=>{const{StorageService:se}=await Promise.resolve().then(()=>ko);return{StorageService:se}},void 0),Se=G.getCurrentSnapshot().platforms;console.log("ðŸ” [handleDeprecateRepository] Current platforms from DataManager:",Se);const Me=Se.findIndex(se=>se.id===X.platformId);if(console.log("ðŸ” [handleDeprecateRepository] Platform index found:",Me),Me!==-1){const se=Se[Me];if(console.log("ðŸ” [handleDeprecateRepository] Found platform:",se),console.log("ðŸ” [handleDeprecateRepository] Platform has extensionSource:",!!se.extensionSource),se.extensionSource){console.log("ðŸ” [handleDeprecateRepository] Removing entire platform (created as extension)");const fe=Se.filter((_e,Y)=>Y!==Me);console.log("ðŸ” [handleDeprecateRepository] Updated platforms after removal:",fe),te(fe),console.log("ðŸ” [handleDeprecateRepository] Removing platform extension files from localStorage..."),ee.removePlatformExtensionFile(X.platformId),ee.removePlatformExtensionFileContent(X.platformId),console.log("ðŸ” [handleDeprecateRepository] Platform extension files removed from localStorage")}else{console.log("ðŸ” [handleDeprecateRepository] Removing only extensionSource (core platform)");const fe=[...Se],{extensionSource:_e,...Y}=se;fe[Me]=Y,console.log("ðŸ” [handleDeprecateRepository] Updated platform without extensionSource:",Y),te(fe)}const de=G.getCurrentSnapshot();console.log("ðŸ” [handleDeprecateRepository] Verification - platforms in DataManager after update:",de.platforms),console.log("âœ… [handleDeprecateRepository] Real repository deprecate process completed successfully")}else{console.error("âŒ [handleDeprecateRepository] Platform not found in storage for platformId:",X.platformId),_({title:"Deprecate Failed",description:`Platform with ID "${X.platformId}" not found in storage.`,status:"error",duration:5e3,isClosable:!0});return}}else console.log("ðŸ” [handleDeprecateRepository] No platformId in repository, skipping platform cleanup")}_({title:"Platform Deprecated",description:"Platform has been deprecated and removed from local storage. Changes will be saved to GitHub when you commit or create a PR.",status:"info",duration:3e3,isClosable:!0})}catch(B){console.error("âŒ [handleDeprecateRepository] Error during deprecate process:",B),_({title:"Deprecate Failed",description:B instanceof Error?B.message:"Failed to deprecate platform.",status:"error",duration:5e3,isClosable:!0})}},xe=()=>{switch(A){case"core":return[{value:"platform-extension",label:"Platform Extension",description:"Link to a platform-specific extension repository"}];case"extension":return[{value:"core",label:"Core Data",description:"Link to the main core data repository"}];case"theme":return[{value:"core",label:"Core Data",description:"Link to the main core data repository"}];default:return[]}};return s?o.jsx(Wu,{py:20,children:o.jsxs(ce,{spacing:4,children:[o.jsx(kn,{size:"xl"}),o.jsx(E,{children:"Loading platform data..."})]})}):o.jsxs(no,{title:"Platforms",description:"Manage platform extensions and link repositories for your distributed design system.",children:[i&&o.jsxs(zt,{status:"error",children:[o.jsx(Lt,{}),i]}),o.jsxs(Es,{children:[o.jsxs(Ms,{children:[o.jsx(pr,{children:"Platform Management"}),o.jsx(pr,{children:"Analytics"}),o.jsx(pr,{children:"Cache Debug"})]}),o.jsxs(Ls,{children:[o.jsx(Ir,{px:0,children:o.jsxs(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:n==="dark"?"gray.900":"white",children:[o.jsx(le,{justify:"space-between",mb:4,children:r&&o.jsx(Oe,{size:"sm",leftIcon:o.jsx(xs,{}),onClick:()=>v(!0),colorScheme:"blue",isDisabled:xe().length===0,children:"Add Platform"})}),o.jsxs(ce,{align:"stretch",spacing:3,children:[t.map($=>{const B=R.getLinkedRepositories().find(X=>X.platformId===$.id),U=m.find(X=>X.platformId===$.id);return o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:T,borderColor:U!=null&&U.hasError?"red.300":P,children:o.jsxs(le,{justify:"space-between",align:"flex-start",children:[o.jsxs(z,{flex:1,minW:0,children:[o.jsxs(le,{spacing:2,align:"center",mb:1,children:[o.jsx(E,{fontSize:"lg",fontWeight:"medium",children:$.displayName}),(U==null?void 0:U.hasError)&&o.jsx(Cn,{label:U.errorMessage||"File or repository is not found","aria-label":`Error for ${$.displayName}: ${U.errorMessage||"File or repository is not found"}`,children:o.jsx(E,{color:"red.500",fontWeight:"bold",fontSize:"sm",children:o.jsx(Ro,{size:16})})})]}),o.jsxs(E,{fontSize:"sm",color:"gray.500",children:["ID: ",$.id]}),$.description&&o.jsx(E,{fontSize:"sm",color:"gray.500",children:$.description}),$.figmaPlatformMapping?o.jsxs(le,{spacing:1,children:[o.jsx(E,{fontSize:"sm",color:"gray.500",children:"Figma:"}),o.jsx(wt,{colorScheme:"blue",variant:"subtle",fontSize:"xs",children:$.figmaPlatformMapping})]}):o.jsx(E,{fontSize:"sm",color:"gray.400",children:"Figma: Not mapped"}),$.syntaxPatterns&&o.jsxs(E,{fontSize:"sm",color:"gray.500",children:["Syntax: ",$.syntaxPatterns.prefix||"",$.syntaxPatterns.delimiter||"_","name",$.syntaxPatterns.suffix||""]}),$.extensionSource&&o.jsxs(E,{fontSize:"sm",color:U!=null&&U.hasError?"red.500":"blue.500",children:["Extension: ",$.extensionSource.repositoryUri," â†’ ",$.extensionSource.filePath]}),(U==null?void 0:U.hasError)&&o.jsx(E,{fontSize:"sm",color:"red.500",fontWeight:"medium",children:U.errorMessage||"File or repository is not found"}),B&&!(U!=null&&U.hasError)&&o.jsxs(E,{fontSize:"sm",color:"gray.500",children:["Status: ",B.status]})]}),o.jsxs(le,{spacing:2,align:"flex-start",children:[$.extensionSource?U!=null&&U.hasError?o.jsx(wt,{colorScheme:"red",variant:"subtle",children:"Error"}):$.extensionSource.repositoryUri==="local"?o.jsx(wt,{colorScheme:"blue",variant:"subtle",children:"Local"}):o.jsx(wt,{colorScheme:"green",variant:"subtle",children:"External"}):null,$.extensionSource&&$.extensionSource.repositoryUri!=="local"&&o.jsx(Cn,{label:"Open Repository on GitHub",children:o.jsx(Bt,{"aria-label":"Open repository on GitHub",size:"sm",icon:o.jsx(dI,{}),onClick:()=>{const X=`https://github.com/${$.extensionSource.repositoryUri}`;window.open(X,"_blank")}})}),r&&o.jsx(Cn,{label:"Edit Platform",children:o.jsx(Bt,{"aria-label":"Edit platform",icon:o.jsx(ys,{}),size:"sm",onClick:()=>O($,B)})})]})]})},$.id)}),t.length===0&&o.jsx(E,{color:"gray.500",textAlign:"center",py:8,children:"No platforms found in source data. Load a core data file to see platforms."})]})]})}),o.jsx(Ir,{children:o.jsx(VM,{analytics:l,platformExtensions:d,hasCoreData:!0})}),o.jsx(Ir,{children:o.jsx($M,{})})]})]}),r&&o.jsx(RM,{isOpen:y,onClose:()=>v(!1),onSave:K,currentDataType:A}),b&&o.jsx(FM,{repository:b,isOpen:I,onClose:()=>{S(!1),k(null)},onSave:Z,onDelete:ie,onDeprecate:ge,platforms:t,platformStatus:m.find($=>$.platformId===b.platformId)})]})};function Sl(){var ne,he;console.log("[createSchemaJsonFromLocalStorage] ðŸ” Starting to read data from localStorage..."),console.log("[createSchemaJsonFromLocalStorage] ðŸ” Raw localStorage keys:");for(let te=0;te<localStorage.length;te++){const K=localStorage.key(te);if(K&&K.startsWith("token-model:")){const O=localStorage.getItem(K);console.log(`[createSchemaJsonFromLocalStorage] - ${K}:`,O?"exists":"null")}}const t=L.getMergedData(),e=L.getCoreData(),r=L.getLocalEdits();if(console.log("[createSchemaJsonFromLocalStorage] ðŸ” Checking new data management system:"),console.log("[createSchemaJsonFromLocalStorage] - mergedData exists:",!!t),console.log("[createSchemaJsonFromLocalStorage] - coreData exists:",!!e),console.log("[createSchemaJsonFromLocalStorage] - localEdits exists:",!!r),t&&t.tokens&&t.tokens.length>0&&(console.log("[createSchemaJsonFromLocalStorage] ðŸ” Using merged data from new system"),console.log("[createSchemaJsonFromLocalStorage] - mergedData tokens:",t.tokens.length),console.log("[createSchemaJsonFromLocalStorage] - mergedData dimensions:",((ne=t.dimensions)==null?void 0:ne.length)||0),console.log("[createSchemaJsonFromLocalStorage] - mergedData dimensionOrder:",t.dimensionOrder),t.dimensionOrder&&t.dimensionOrder.length>0))return console.log("[createSchemaJsonFromLocalStorage] âœ… Using merged data with valid dimensionOrder"),t;if(e&&e.tokens&&e.tokens.length>0&&(console.log("[createSchemaJsonFromLocalStorage] ðŸ” Using core data from new system"),console.log("[createSchemaJsonFromLocalStorage] - coreData tokens:",e.tokens.length),console.log("[createSchemaJsonFromLocalStorage] - coreData dimensions:",((he=e.dimensions)==null?void 0:he.length)||0),console.log("[createSchemaJsonFromLocalStorage] - coreData dimensionOrder:",e.dimensionOrder),e.dimensionOrder&&e.dimensionOrder.length>0))return console.log("[createSchemaJsonFromLocalStorage] âœ… Using core data with valid dimensionOrder"),e;console.log("[createSchemaJsonFromLocalStorage] ðŸ” Falling back to individual storage keys...");const n=L.getCollections(),s=L.getTokens(),i=L.getDimensions(),a=L.getPlatforms(),l=L.getThemes(),c=L.getTaxonomies(),d=L.getValueTypes(),u=L.getTaxonomyOrder(),m=JSON.parse(localStorage.getItem("token-model:dimension-order")||"[]"),g=L.getFigmaConfiguration();console.log("[createSchemaJsonFromLocalStorage] ðŸ” Data read from StorageService:"),console.log("[createSchemaJsonFromLocalStorage] - tokenCollections:",(n==null?void 0:n.length)||0),console.log("[createSchemaJsonFromLocalStorage] - tokens:",(s==null?void 0:s.length)||0),console.log("[createSchemaJsonFromLocalStorage] - dimensions:",(i==null?void 0:i.length)||0),console.log("[createSchemaJsonFromLocalStorage] - platforms:",(a==null?void 0:a.length)||0),console.log("[createSchemaJsonFromLocalStorage] - themes:",(l==null?void 0:l.length)||0),console.log("[createSchemaJsonFromLocalStorage] - taxonomies:",(c==null?void 0:c.length)||0),console.log("[createSchemaJsonFromLocalStorage] - resolvedValueTypes:",(d==null?void 0:d.length)||0),console.log("[createSchemaJsonFromLocalStorage] - taxonomyOrder:",u),console.log("[createSchemaJsonFromLocalStorage] - dimensionOrder:",m),console.log("[createSchemaJsonFromLocalStorage] - figmaConfiguration:",g);const y=L.getRootData();console.log("[createSchemaJsonFromLocalStorage] - rootData:",y);const{systemName:v="Design System",systemId:I="design-system",description:S="A comprehensive design system with tokens, dimensions, and themes",version:b="1.0.0",versionHistory:k=[]}=y,A=Array.isArray(k)&&k.length>0?k.map(te=>({...te,migrationStrategy:te.migrationStrategy?{...te.migrationStrategy,emptyModeIds:["mapToDefaults","preserveEmpty","requireExplicit"].includes(te.migrationStrategy.emptyModeIds)?te.migrationStrategy.emptyModeIds:"mapToDefaults"}:void 0})):[{version:b,dimensions:Array.isArray(i)?i.map(te=>te.id):[],date:new Date().toISOString().slice(0,10),migrationStrategy:{emptyModeIds:"mapToDefaults",preserveOriginalValues:!0}}];let C=[];Array.isArray(d)&&d.length>0?C=d.map(te=>typeof te=="string"?{id:te,displayName:te}:te):(console.warn("[createSchemaJsonFromLocalStorage] No resolvedValueTypes found in localStorage. Creating default value types."),C=[{id:"color",displayName:"Color",type:"COLOR"},{id:"font_family",displayName:"Font Family",type:"FONT_FAMILY"},{id:"font_weight",displayName:"Font Weight",type:"FONT_WEIGHT"},{id:"font_size",displayName:"Font Size",type:"FONT_SIZE"},{id:"line_height",displayName:"Line Height",type:"LINE_HEIGHT"},{id:"spacing",displayName:"Spacing",type:"SPACING"},{id:"opacity",displayName:"Opacity"},{id:"shadow",displayName:"Shadow"},{id:"border",displayName:"Border"},{id:"radius",displayName:"Radius",type:"RADIUS"},{id:"z_index",displayName:"Z Index"},{id:"dimension",displayName:"Dimension",type:"DIMENSION"},{id:"duration",displayName:"Duration",type:"DURATION"},{id:"cubic_bezier",displayName:"Cubic Bezier",type:"CUBIC_BEZIER"},{id:"blur",displayName:"Blur",type:"BLUR"},{id:"spread",displayName:"Spread",type:"SPREAD"},{id:"letter_spacing",displayName:"Letter Spacing",type:"LETTER_SPACING"}]);const T=new Set;i.forEach(te=>{(te.resolvedValueTypeIds||[]).forEach(K=>T.add(K))}),n.forEach(te=>{(te.resolvedValueTypeIds||[]).forEach(K=>T.add(K))}),s.forEach(te=>{te.resolvedValueTypeId&&T.add(te.resolvedValueTypeId)});const P=Array.from(T).filter(te=>!C.some(K=>K.id===te));if(P.length>0){console.warn(`[createSchemaJsonFromLocalStorage] The following resolvedValueTypeIds are referenced but missing from resolvedValueTypes: ${P.join(", ")}. Auto-adding missing value types.`);const te={color:{displayName:"Color",type:"COLOR"},font_family:{displayName:"Font Family",type:"FONT_FAMILY"},font_weight:{displayName:"Font Weight",type:"FONT_WEIGHT"},font_size:{displayName:"Font Size",type:"FONT_SIZE"},line_height:{displayName:"Line Height",type:"LINE_HEIGHT"},spacing:{displayName:"Spacing",type:"SPACING"},opacity:{displayName:"Opacity"},shadow:{displayName:"Shadow"},border:{displayName:"Border"},radius:{displayName:"Radius",type:"RADIUS"},z_index:{displayName:"Z Index"},dimension:{displayName:"Dimension",type:"DIMENSION"},duration:{displayName:"Duration",type:"DURATION"},cubic_bezier:{displayName:"Cubic Bezier",type:"CUBIC_BEZIER"},blur:{displayName:"Blur",type:"BLUR"},spread:{displayName:"Spread",type:"SPREAD"},letter_spacing:{displayName:"Letter Spacing",type:"LETTER_SPACING"}};P.forEach(K=>{const O=te[K];if(O){const Z={id:K,displayName:O.displayName,...O.type&&{type:O.type}};C.push(Z),console.log(`[createSchemaJsonFromLocalStorage] Auto-added missing value type: ${K}`)}else{const Z={id:K,displayName:K.split("_").map(ie=>ie.charAt(0).toUpperCase()+ie.slice(1)).join(" ")};C.push(Z),console.log(`[createSchemaJsonFromLocalStorage] Auto-added generic value type: ${K}`)}})}const _=(a||[]).map(te=>{var K,O,Z,ie,ge;return{...te,syntaxPatterns:{prefix:((K=te.syntaxPatterns)==null?void 0:K.prefix)??"",suffix:((O=te.syntaxPatterns)==null?void 0:O.suffix)??"",delimiter:((Z=te.syntaxPatterns)==null?void 0:Z.delimiter)??"_",capitalization:((ie=te.syntaxPatterns)==null?void 0:ie.capitalization)??"none",formatString:((ge=te.syntaxPatterns)==null?void 0:ge.formatString)??""}}}),R=Array.isArray(l)?l:[];return{systemName:v,systemId:I,description:S,version:b,versionHistory:A,tokenCollections:n,dimensions:i,dimensionOrder:m,tokens:s,platforms:_,themes:R,taxonomies:c,resolvedValueTypes:C,taxonomyOrder:u||[],figmaConfiguration:g||{fileKey:""},standardPropertyTypes:[],propertyTypes:[],componentProperties:[],componentCategories:[],components:[]}}function LM(){var l;const t=L.getAlgorithms(),e=JSON.parse(localStorage.getItem("token-model:root")||"{}"),{systemName:r="Design System",version:n="1.0.0"}=e,s=L.getAlgorithmFile();if(s)return{...s,algorithms:t.map(d=>({id:d.id,name:d.name,description:d.description||"",resolvedValueTypeId:d.resolvedValueTypeId,variables:d.variables.map(u=>({id:u.id,name:u.name,type:u.type,defaultValue:u.defaultValue||"",description:u.description||""})),formulas:d.formulas.map(u=>({id:u.id,name:u.name,description:u.description||"",expressions:{latex:{value:u.expressions.latex.value},javascript:{value:u.expressions.javascript.value,metadata:u.expressions.javascript.metadata||{allowedOperations:["math"]}},ast:u.expressions.ast||{type:"literal",value:u.expressions.javascript.value,metadata:{astVersion:"1.0.0",validationErrors:[],complexity:"low"}}},variableIds:u.variableIds||[]})),conditions:d.conditions.map(u=>({id:u.id,name:u.name,expression:u.expression,variableIds:u.variableIds||[]})),steps:d.steps.map(u=>({type:u.type,id:u.id,name:u.name}))}))};let i=[];if(t&&t.length>0){const c=t[0];(l=c.config)!=null&&l.systemVariables&&(i=c.config.systemVariables)}return{schemaVersion:"5.0.0",profile:"basic",metadata:{name:`${r} Algorithm Collection`,description:`Algorithm collection for ${r}`,version:n,author:"Design System Manager"},config:{systemVariables:i,defaultBaseValue:16,defaultRatio:1.25,defaultSpacing:4},algorithms:t.map(c=>({id:c.id,name:c.name,description:c.description||"",resolvedValueTypeId:c.resolvedValueTypeId,variables:c.variables.map(d=>({id:d.id,name:d.name,type:d.type,defaultValue:d.defaultValue||"",description:d.description||""})),formulas:c.formulas.map(d=>({id:d.id,name:d.name,description:d.description||"",expressions:{latex:{value:d.expressions.latex.value},javascript:{value:d.expressions.javascript.value,metadata:d.expressions.javascript.metadata||{allowedOperations:["math"]}},ast:d.expressions.ast||{type:"literal",value:d.expressions.javascript.value,metadata:{astVersion:"1.0.0",validationErrors:[],complexity:"low"}}},variableIds:d.variableIds||[]})),conditions:c.conditions.map(d=>({id:d.id,name:d.name,expression:d.expression,variableIds:d.variableIds||[]})),steps:c.steps.map(d=>({type:d.type,id:d.id,name:d.name}))})),execution:{order:[],parallel:!1,onError:"stop"},integration:{targetSchema:"https://designsystem.org/schemas/tokens/v1.0.0",outputFormat:"design-tokens",mergeStrategy:"merge",validation:!0},examples:[]}}function BM({tokens:t=[],collections:e=[],dimensions:r=[],platforms:n=[],taxonomies:s=[],version:i="1.0.0",versionHistory:a=[],onValidate:l}){var K,O,Z;const{colorMode:c}=Vt(),[d,u]=M.useState(null),[m,g]=M.useState(!1),[y,v]=M.useState(null),[I,S]=M.useState(!1),[b,k]=M.useState(null),[A,C]=M.useState(!1),[T,P]=M.useState(""),_=nr.useRef(null),R=Hr();M.useEffect(()=>{if(A){const ie=Sl();P(JSON.stringify(ie,null,2))}},[A,e,r,t,n,s,i,a]);const G=()=>{try{const ie=Sl(),ge=Aa.validateData(ie);ge.isValid?R({title:"Validation Successful",description:"Your data is valid according to the schema.",status:"success",duration:3e3,isClosable:!0}):(k(ge),S(!0))}catch{R({title:"Validation Error",description:"An error occurred during validation.",status:"error",duration:3e3,isClosable:!0})}},ne=()=>{C(!0)},he=ie=>{const ge=t.find(xe=>xe.id===ie);u(ge||null),v(null)},te=()=>{if(d)try{l(d),R({title:"Token Validation Successful",description:"The selected token is valid.",status:"success",duration:3e3,isClosable:!0})}catch(ie){v({isValid:!1,errors:[ie]}),g(!0)}};return o.jsxs(no,{title:"Validation",description:"Validate your design system data against the schema and test individual tokens for compliance.",children:[o.jsx(z,{p:4,bg:c==="dark"?"gray.900":"white",borderRadius:"md",children:o.jsxs(ce,{align:"stretch",spacing:6,children:[o.jsxs(z,{children:[o.jsx(Tt,{as:"h2",size:"md",mb:4,children:"Global Data Validation"}),o.jsx(Oe,{colorScheme:"blue",onClick:G,mb:4,children:"Validate All Data"}),o.jsx(Oe,{variant:"outline",colorScheme:"gray",onClick:ne,mb:4,ml:2,children:"Preview JSON"})]}),o.jsxs(z,{pt:6,children:[o.jsx(Tt,{as:"h2",size:"md",mb:4,children:"Token Validation Tester"}),o.jsxs(ce,{align:"stretch",spacing:4,children:[o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Select Token"}),o.jsx(Kt,{value:(d==null?void 0:d.id)||"",onChange:ie=>he(ie.target.value),placeholder:"Select token",children:t==null?void 0:t.map(ie=>o.jsx("option",{value:ie.id,children:ie.displayName},ie.id))})]}),d&&o.jsxs(z,{children:[o.jsx(E,{fontWeight:"semibold",mb:2,children:"Selected Token Details"}),o.jsxs(E,{fontSize:"sm",children:["Name: ",d.displayName]}),o.jsxs(E,{fontSize:"sm",children:["Collection: ",d.tokenCollectionId?(K=e==null?void 0:e.find(ie=>ie.id===d.tokenCollectionId))==null?void 0:K.name:"None"]}),o.jsxs(E,{fontSize:"sm",children:["Value Type: ",d.resolvedValueTypeId]}),o.jsx(Oe,{colorScheme:"blue",onClick:te,mt:3,children:"Validate Token"})]})]})]})]})}),o.jsx(uc,{isOpen:I,leastDestructiveRef:_,onClose:()=>S(!1),children:o.jsx(Dr,{children:o.jsxs(hc,{children:[o.jsx(Rr,{fontSize:"lg",fontWeight:"bold",children:"Validation Failed"}),o.jsxs(Or,{children:[o.jsx(E,{mb:4,children:"The following validation errors were found:"}),(O=b==null?void 0:b.errors)==null?void 0:O.map((ie,ge)=>o.jsx(Nt,{display:"block",mb:2,p:2,whiteSpace:"pre-wrap",children:JSON.stringify(ie,null,2)},ge))]}),o.jsx(rn,{children:o.jsx(Oe,{ref:_,onClick:()=>S(!1),children:"Close"})})]})})}),o.jsx(uc,{isOpen:m,leastDestructiveRef:_,onClose:()=>g(!1),children:o.jsx(Dr,{children:o.jsxs(hc,{children:[o.jsx(Rr,{fontSize:"lg",fontWeight:"bold",children:"Token Validation Failed"}),o.jsxs(Or,{children:[o.jsx(E,{mb:4,children:"The following validation errors were found:"}),(Z=y==null?void 0:y.errors)==null?void 0:Z.map((ie,ge)=>o.jsx(Nt,{display:"block",mb:2,p:2,whiteSpace:"pre-wrap",children:JSON.stringify(ie,null,2)},ge))]}),o.jsx(rn,{children:o.jsx(Oe,{ref:_,onClick:()=>g(!1),children:"Close"})})]})})}),o.jsxs(Zr,{size:"4xl",isOpen:A,onClose:()=>C(!1),children:[o.jsx(Dr,{}),o.jsxs(Xr,{bg:c==="dark"?"gray.900":"white",maxH:"80vh",overflowY:"auto",children:[o.jsx(Rr,{children:"Local Storage Data Preview"}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsxs(Es,{isFitted:!0,children:[o.jsxs(Ms,{children:[o.jsx(pr,{children:"Core Data"}),o.jsx(pr,{children:"Algorithm Data"})]}),o.jsxs(Ls,{children:[o.jsx(Ir,{children:o.jsx(z,{maxH:"60vh",overflowY:"auto",children:o.jsx(Nt,{width:"100%",whiteSpace:"pre",p:4,fontSize:"sm",display:"block",children:T})})}),o.jsx(Ir,{children:o.jsx(z,{maxH:"60vh",overflowY:"auto",children:o.jsx(Nt,{width:"100%",whiteSpace:"pre",p:4,fontSize:"sm",display:"block",children:JSON.stringify(LM(),null,2)})})})]})]})})]})]})]})}const hh=({open:t,onClose:e,onSave:r,title:n,children:s})=>{const{colorMode:i}=Vt();return o.jsxs(Zr,{isOpen:t,onClose:e,size:"xl",children:[o.jsx(Dr,{}),o.jsxs(Xr,{bg:i==="dark"?"gray.900":"white",children:[o.jsx(Rr,{children:n}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsx(ce,{spacing:4,align:"stretch",children:s})}),o.jsxs(rn,{children:[o.jsx(Oe,{variant:"ghost",mr:3,onClick:e,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:async()=>{try{await r()}catch(a){console.error("Error saving:",a)}},children:"Save"})]})]})]})},I0=({value:t,onChange:e})=>o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Name"}),o.jsx(yt,{value:t,onChange:r=>e(r.target.value)})]}),j0=({value:t,onChange:e})=>o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(yt,{value:t,onChange:r=>e(r.target.value)})]}),UM=({open:t,onClose:e,onSave:r,form:n,handleFormChange:s,handleOptionDialogOpen:i,handleOptionDelete:a})=>{var c,d;const l=n.editingIndex!==null?"Edit Component Property":"Add Component Property";return o.jsxs(hh,{open:t,onClose:e,onSave:r,title:l,children:[o.jsx(I0,{value:n.displayName,onChange:u=>s("displayName",u)}),o.jsx(j0,{value:n.description,onChange:u=>s("description",u)}),o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Type"}),o.jsxs(Kt,{value:n.type,onChange:u=>{const m=u.target.value;s("type",m),m==="boolean"?s("default",!1):m==="list"&&s("default",n.options&&n.options.length>0?n.options[0].id:"")},children:[o.jsx("option",{value:"boolean",children:"Boolean"}),o.jsx("option",{value:"list",children:"List"})]})]}),n.type==="boolean"&&o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Default Value"}),o.jsxs(le,{children:[o.jsx(E,{children:"False"}),o.jsx(hl,{isChecked:n.default,onChange:u=>s("default",u.target.checked),colorScheme:"blue"}),o.jsx(E,{children:"True"})]})]}),n.type==="list"&&o.jsxs(o.Fragment,{children:[o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Default Value"}),o.jsx(Kt,{value:n.default,onChange:u=>s("default",u.target.value),placeholder:"Select default option...",children:(c=n.options)==null?void 0:c.map(u=>o.jsx("option",{value:u.id,children:u.displayName},u.id))})]}),o.jsxs(z,{children:[o.jsx(E,{fontWeight:"bold",mb:2,children:"Options"}),o.jsx(Oe,{leftIcon:o.jsx(xs,{}),size:"sm",onClick:()=>i(null),mb:2,children:"Add Option"}),o.jsx(ce,{align:"stretch",spacing:1,children:(d=n.options)==null?void 0:d.map((u,m)=>o.jsxs(le,{children:[o.jsx(E,{children:u.displayName}),o.jsx(Bt,{"aria-label":"Edit option",icon:o.jsx(ys,{}),size:"xs",onClick:()=>i(m)}),o.jsx(Bt,{"aria-label":"Delete option",icon:o.jsx(As,{}),size:"xs",colorScheme:"red",onClick:()=>a(m)})]},u.id))})]})]})]})},GM=({open:t,onClose:e,onSave:r,optionForm:n,handleOptionFormChange:s,optionEditIndex:i})=>{const a=i!==null?"Edit Option":"Add Option";return o.jsxs(hh,{open:t,onClose:e,onSave:r,title:a,children:[o.jsx(I0,{value:n.displayName,onChange:l=>s("displayName",l)}),o.jsx(j0,{value:n.description,onChange:l=>s("description",l)})]})};function ql(t){return t.map(e=>({...e,description:typeof e.description=="string"?e.description:""}))}function HM({componentProperties:t,setComponentProperties:e,tokens:r,collections:n,dimensions:s,platforms:i,resolvedValueTypes:a,canEdit:l=!1}){const{colorMode:c}=Vt(),[d,u]=M.useState(!1),[m,g]=M.useState(null),[y,v]=M.useState({id:"",displayName:"",description:"",type:"boolean",default:!1,options:ql([])}),[I,S]=M.useState({id:"",displayName:"",description:""}),[b,k]=M.useState(!1),[A,C]=M.useState(null),T=Hr();M.useEffect(()=>{L.setComponentProperties(t)},[t]);const[P,_]=M.useState(t);M.useEffect(()=>{_(t)},[t]);const R=($=null)=>{if(g($),$!==null){const B=P[$];v({id:B.id,displayName:B.displayName,description:B.description||"",type:B.type,default:B.default,options:B.type==="list"?ql(B.options||[]):ql([])})}else v({id:wn("component-property"),displayName:"",description:"",type:"boolean",default:!1,options:ql([])});u(!0)},G=()=>{u(!1),g(null)},ne=($,B)=>{v(U=>$==="options"?{...U,options:ql(B)}:{...U,[$]:B})},he=async $=>{try{const B=JSON.parse(localStorage.getItem("token-model:root")||"{}"),{systemName:U="Design System",systemId:X="design-system",version:ee="1.0.0",versionHistory:be=[]}=B,Se={systemName:U,systemId:X,description:"Design system with component properties",tokenCollections:n||[],dimensions:s||[],tokens:r||[],platforms:i||[],themes:L.getThemes()||[{id:"default",displayName:"Default",isDefault:!0}],taxonomies:L.getTaxonomies()||[],resolvedValueTypes:a||[],componentProperties:$||[],componentCategories:L.getComponentCategories()||[],components:L.getComponents()||[],standardPropertyTypes:[],propertyTypes:[],version:ee,versionHistory:be||[]};console.log("[ComponentPropertiesView] Validation data:",JSON.stringify(Se,null,2)),console.log("[ComponentPropertiesView] componentProperties being validated:",JSON.stringify(Se.componentProperties,null,2));const Me=Aa.validateData(Se);if(console.log("[ComponentPropertiesView] Validation result:",Me),!Me.isValid){console.error("[ComponentPropertiesView] Validation errors:",Me.errors),Array.isArray(Me.errors)&&Me.errors.forEach((de,fe)=>{console.error(`[ComponentPropertiesView] Error ${fe+1}:`,JSON.stringify(de,null,2))});const se=Array.isArray(Me.errors)?Me.errors.map(de=>typeof de=="string"?de:JSON.stringify(de)).join(", "):"See console for details.";T({title:"Validation Error",description:`Schema Validation Failed: ${se}`,status:"error",duration:5e3,isClosable:!0});return}localStorage.setItem("token-model:component-properties",JSON.stringify($)),e($)}catch(B){console.error("[ComponentPropertiesView] Validation error:",B),T({title:"Validation Error",description:"An error occurred while validating the data",status:"error",duration:5e3,isClosable:!0})}},te=()=>{const $=y.id&&y.id.trim()?y.id:wn("component-property");if(!y.displayName.trim()){T({title:"Name is required",status:"error",duration:2e3});return}if(y.type==="list"){const X=(y.options||[]).map(Se=>({...Se,id:Se.id&&Se.id.trim()?Se.id:wn("component-option"),displayName:Se.displayName&&Se.displayName.trim()?Se.displayName:""}));if(X.some(Se=>!Se.displayName.trim())){T({title:"All options must have a name",status:"error",duration:2e3});return}const ee=X.map(Se=>Se.id);if(new Set(ee).size!==ee.length){T({title:"Option IDs must be unique",status:"error",duration:2e3});return}const be=X.map(Se=>Se.displayName.trim().toLowerCase());if(new Set(be).size!==be.length){T({title:"Option names must be unique",status:"error",duration:2e3});return}if(!y.default||y.default===""||typeof y.default=="boolean")if(X.length>0)y.default=X[0].id;else{T({title:"List type properties must have at least one option",status:"error",duration:2e3});return}if(typeof y.default=="string"&&!X.some(Se=>Se.id===y.default)){T({title:"Default value must reference an existing option",status:"error",duration:2e3});return}y.options=X}console.log("[ComponentPropertiesView] Existing componentProperties:",JSON.stringify(P,null,2));const B=[...P],U=y.type==="list"?{id:$,displayName:y.displayName,description:y.description,type:y.type,default:y.default,options:y.options}:{id:$,displayName:y.displayName,description:y.description,type:y.type,default:y.default};console.log("[ComponentPropertiesView] Form data:",JSON.stringify(y,null,2)),console.log("[ComponentPropertiesView] Property to save:",JSON.stringify(U,null,2)),console.log("[ComponentPropertiesView] Property type:",typeof U.default),console.log("[ComponentPropertiesView] Property default value:",U.default),m!==null?B[m]=U:B.push(U),_(B),he(B),window.dispatchEvent(new CustomEvent("token-model:data-change")),u(!1),g(null),T({title:"Component property saved",status:"success",duration:2e3})},K=$=>{const B=P.filter((U,X)=>X!==$);_(B),e(B),window.dispatchEvent(new CustomEvent("token-model:data-change")),T({title:"Component property deleted",status:"info",duration:2e3})},O=$=>{if($!==null&&y.options[$]){const B=y.options[$];S({id:B.id,displayName:B.displayName,description:B.description||""})}else S({id:wn("component-option"),displayName:"",description:""});k(!0),C($)},Z=()=>{k(!1),C(null)},ie=($,B)=>{S(U=>({...U,[$]:B}))},ge=()=>{const $=I.id&&I.id.trim()?I.id:wn("component-option");if(!I.displayName.trim()){T({title:"Option name is required",status:"error",duration:2e3});return}const B=y.options?[...y.options]:[],U=B.map(ee=>ee.displayName.trim().toLowerCase());if(A===null&&U.includes(I.displayName.trim().toLowerCase())||A!==null&&U.filter((ee,be)=>be!==A).includes(I.displayName.trim().toLowerCase())){T({title:"Option names must be unique",status:"error",duration:2e3});return}A!==null?B[A]={...I,id:$}:B.push({...I,id:$});const X={...y,options:B};A===null&&y.type==="list"&&(!y.default||y.default==="")&&(X.default=$),v(X),k(!1),C(null)},xe=$=>{v(B=>({...B,options:(B.options||[]).filter((U,X)=>X!==$)}))};return o.jsxs(z,{children:[o.jsx(E,{fontSize:"2xl",fontWeight:"bold",mb:2,children:"Component Properties"}),o.jsx(E,{fontSize:"sm",color:"gray.600",mb:6,children:"Component properties define the configurable aspects of components, such as colors, spacing, and behavior options."}),o.jsxs(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:c==="dark"?"gray.900":"white",children:[l&&o.jsx(Oe,{size:"sm",leftIcon:o.jsx(xs,{}),onClick:()=>R(null),colorScheme:"blue",mb:4,children:"Add Component Property"}),o.jsx(ce,{align:"stretch",spacing:2,children:P.map(($,B)=>o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:c==="dark"?"gray.800":"gray.50",borderColor:c==="dark"?"gray.600":"gray.200",children:o.jsxs(le,{justify:"space-between",align:"center",children:[o.jsxs(z,{children:[o.jsx(_o,{title:$.displayName,cardType:"componentProperty"}),o.jsx(E,{fontSize:"sm",color:"gray.600",children:$.description}),o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["Type: ",$.type," | Default: ",$.type==="boolean"?$.default?"True":"False":$.default]}),$.type==="list"&&$.options&&$.options.length>0&&o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["Options: ",$.options.map(U=>U.displayName).join(", ")]})]}),l&&o.jsxs(le,{children:[o.jsx(Bt,{"aria-label":"Edit component property",icon:o.jsx(ys,{}),size:"sm",onClick:()=>R(B)}),o.jsx(Bt,{"aria-label":"Delete component property",icon:o.jsx(As,{}),size:"sm",colorScheme:"red",onClick:()=>K(B)})]})]})},$.id))})]}),o.jsx(UM,{open:d,onClose:G,onSave:te,form:{...y,editingIndex:m},handleFormChange:ne,handleOptionDialogOpen:O,handleOptionDelete:xe}),o.jsx(GM,{open:b,onClose:Z,onSave:ge,optionForm:I,handleOptionFormChange:ie,optionEditIndex:A})]})}function WM({componentCategories:t,setComponentCategories:e,canEdit:r=!1}){const{colorMode:n}=Vt(),[s,i]=M.useState(!1),[a,l]=M.useState(null),[c,d]=M.useState({id:"",displayName:"",description:""}),u=Hr();M.useEffect(()=>{L.setComponentCategories(t)},[t]);const[m,g]=M.useState(t);M.useEffect(()=>{g(t)},[t]);const y=(k=null)=>{if(l(k),k!==null){const A=m[k];d({id:A.id,displayName:A.displayName,description:A.description||""})}else d({id:wn("component-category"),displayName:"",description:""});i(!0)},v=(k,A)=>{d(C=>({...C,[k]:A}))},I=async()=>{if(!c.displayName.trim()){u({title:"Validation Error",description:"Display name is required",status:"error",duration:3e3,isClosable:!0});return}const k={id:c.id,displayName:c.displayName.trim(),description:c.description.trim()||void 0};let A;a!==null?(A=[...m],A[a]=k):A=[...m,k],g(A),e(A),i(!1),d({id:"",displayName:"",description:""}),window.dispatchEvent(new CustomEvent("token-model:data-change")),u({title:"Success",description:`Component category ${a!==null?"updated":"created"} successfully`,status:"success",duration:3e3,isClosable:!0})},S=async k=>{const A=m[k],C=m.filter((T,P)=>P!==k);g(C),e(C),window.dispatchEvent(new CustomEvent("token-model:data-change")),u({title:"Success",description:`Component category ${A.displayName} deleted successfully`,status:"success",duration:3e3,isClosable:!0})},b=()=>{i(!1),d({id:"",displayName:"",description:""})};return o.jsxs(z,{children:[o.jsx(E,{fontSize:"2xl",fontWeight:"bold",mb:2,children:"Component Categories"}),o.jsx(E,{fontSize:"sm",color:"gray.600",mb:6,children:"Component categories help organize components into logical groups for better management and discovery."}),o.jsxs(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:n==="dark"?"gray.900":"white",children:[r&&o.jsx(Oe,{size:"sm",leftIcon:o.jsx(xs,{}),onClick:()=>y(null),colorScheme:"blue",mb:4,children:"Add Component Category"}),o.jsx(ce,{align:"stretch",spacing:2,children:m.map((k,A)=>o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:n==="dark"?"gray.800":"gray.50",borderColor:n==="dark"?"gray.600":"gray.200",children:o.jsxs(le,{justify:"space-between",align:"center",children:[o.jsxs(z,{children:[o.jsx(_o,{title:k.displayName,cardType:"collection"}),o.jsx(E,{fontSize:"sm",color:"gray.600",children:k.description}),o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["ID: ",k.id]})]}),r&&o.jsxs(le,{children:[o.jsx(Bt,{"aria-label":"Edit component category",icon:o.jsx(ys,{}),size:"sm",onClick:()=>y(A)}),o.jsx(Bt,{"aria-label":"Delete component category",icon:o.jsx(As,{}),size:"sm",colorScheme:"red",onClick:()=>S(A)})]})]})},k.id))})]}),o.jsxs(Zr,{isOpen:s,onClose:b,size:"md",children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:a!==null?"Edit Component Category":"Create Component Category"}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,children:[o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Display Name"}),o.jsx(yt,{value:c.displayName,onChange:k=>v("displayName",k.target.value),placeholder:"Enter display name"})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(Hu,{value:c.description,onChange:k=>v("description",k.target.value),placeholder:"Enter description (optional)",rows:3})]})]})}),o.jsxs(rn,{children:[o.jsx(Oe,{variant:"ghost",mr:3,onClick:b,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:I,children:a!==null?"Update":"Create"})]})]})]})]})}const qM=({canEdit:t=!1})=>{const e=L.getLocalEdits(),n=L.getMergedData()||e,s=v=>v?"dimensions"in v?{dimensions:v.dimensions||[],taxonomies:v.taxonomies||[],resolvedValueTypes:v.resolvedValueTypes||[],tokens:v.tokens||[],collections:v.tokenCollections||[],platforms:v.platforms||[],themes:v.themes||[],componentProperties:v.componentProperties||[],componentCategories:v.componentCategories||[]}:{dimensions:[],taxonomies:[],resolvedValueTypes:[],tokens:[],collections:[],platforms:[],themes:[],componentProperties:[],componentCategories:[]}:{},{dimensions:i,taxonomies:a,resolvedValueTypes:l,tokens:c,collections:d,platforms:u,themes:m,componentProperties:g,componentCategories:y}=s(n);return o.jsx(no,{title:"System",children:o.jsxs(Es,{children:[o.jsxs(Ms,{children:[o.jsx(pr,{children:"Dimensions"}),o.jsx(pr,{children:"Taxonomies"}),o.jsx(pr,{children:"Value Types"}),o.jsx(pr,{children:"Component Categories"}),o.jsx(pr,{children:"Component Properties"})]}),o.jsxs(Ls,{mt:4,children:[o.jsx(Ir,{children:o.jsx(RS,{dimensions:i,setDimensions:v=>L.updateLocalEditsDimensions(v),canEdit:t})}),o.jsx(Ir,{children:o.jsx(OS,{taxonomies:a,setTaxonomies:v=>L.updateLocalEditsTaxonomies(v),tokens:c,collections:d,dimensions:i,platforms:u,resolvedValueTypes:l,canEdit:t})}),o.jsx(Ir,{children:o.jsx(VS,{valueTypes:l,onUpdate:v=>L.updateLocalEditsValueTypes(v),tokens:c,collections:d,dimensions:i,platforms:u,taxonomies:a,themes:m,canEdit:t})}),o.jsx(Ir,{children:o.jsx(WM,{componentCategories:y,setComponentCategories:v=>L.updateLocalEditsComponentCategories(v),canEdit:t})}),o.jsx(Ir,{children:o.jsx(HM,{componentProperties:g,setComponentProperties:v=>L.updateLocalEditsComponentProperties(v),tokens:c,collections:d,dimensions:i,platforms:u,resolvedValueTypes:l,canEdit:t})})]})]})})};function gn(t,e){let r=t.length;Array.isArray(t[0])||(t=[t]),Array.isArray(e[0])||(e=e.map(a=>[a]));let n=e[0].length,s=e[0].map((a,l)=>e.map(c=>c[l])),i=t.map(a=>s.map(l=>{let c=0;if(!Array.isArray(a)){for(let d of l)c+=a*d;return c}for(let d=0;d<a.length;d++)c+=a[d]*(l[d]||0);return c}));return r===1&&(i=i[0]),n===1?i.map(a=>a[0]):i}function Wc(t){return Mi(t)==="string"}function Mi(t){return(Object.prototype.toString.call(t).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase()}function Ru(t,{precision:e,unit:r}){return Fi(t)?"none":zS(t,e)+(r??"")}function Fi(t){return Number.isNaN(t)||t instanceof Number&&(t==null?void 0:t.none)}function _n(t){return Fi(t)?0:t}function zS(t,e){if(t===0)return 0;let r=~~t,n=0;r&&e&&(n=~~Math.log10(Math.abs(r))+1);const s=10**(e-n);return Math.floor(t*s+.5)/s}const JM={deg:1,grad:.9,rad:180/Math.PI,turn:360};function LS(t){if(!t)return;t=t.trim();const e=/^([a-z]+)\((.+?)\)$/i,r=/^-?[\d.]+$/,n=/%|deg|g?rad|turn$/,s=/\/?\s*(none|[-\w.]+(?:%|deg|g?rad|turn)?)/g;let i=t.match(e);if(i){let a=[];return i[2].replace(s,(l,c)=>{let d=c.match(n),u=c;if(d){let m=d[0],g=u.slice(0,-m.length);m==="%"?(u=new Number(g/100),u.type="<percentage>"):(u=new Number(g*JM[m]),u.type="<angle>",u.unit=m)}else r.test(u)?(u=new Number(u),u.type="<number>"):u==="none"&&(u=new Number(NaN),u.none=!0);l.startsWith("/")&&(u=u instanceof Number?u:new Number(u),u.alpha=!0),typeof u=="object"&&u instanceof Number&&(u.raw=c),a.push(u)}),{name:i[1].toLowerCase(),rawName:i[1],rawArgs:i[2],args:a}}}function BS(t){return t[t.length-1]}function Ac(t,e,r){return isNaN(t)?e:isNaN(e)?t:t+(e-t)*r}function US(t,e,r){return(r-t)/(e-t)}function T0(t,e,r){return Ac(e[0],e[1],US(t[0],t[1],r))}function GS(t){return t.map(e=>e.split("|").map(r=>{r=r.trim();let n=r.match(/^(<[a-z]+>)\[(-?[.\d]+),\s*(-?[.\d]+)\]?$/);if(n){let s=new String(n[1]);return s.range=[+n[2],+n[3]],s}return r}))}function HS(t,e,r){return Math.max(Math.min(r,e),t)}function mh(t,e){return Math.sign(t)===Math.sign(e)?t:-t}function Mo(t,e){return mh(Math.abs(t)**e,t)}function E0(t,e){return e===0?0:t/e}function WS(t,e,r=0,n=t.length){for(;r<n;){const s=r+n>>1;t[s]<e?r=s+1:n=s}return r}var YM=Object.freeze({__proto__:null,bisectLeft:WS,clamp:HS,copySign:mh,interpolate:Ac,interpolateInv:US,isNone:Fi,isString:Wc,last:BS,mapRange:T0,multiplyMatrices:gn,parseCoordGrammar:GS,parseFunction:LS,serializeNumber:Ru,skipNone:_n,spow:Mo,toPrecision:zS,type:Mi,zdiv:E0});class KM{add(e,r,n){if(typeof arguments[0]!="string"){for(var e in arguments[0])this.add(e,arguments[0][e],arguments[1]);return}(Array.isArray(e)?e:[e]).forEach(function(s){this[s]=this[s]||[],r&&this[s][n?"unshift":"push"](r)},this)}run(e,r){this[e]=this[e]||[],this[e].forEach(function(n){n.call(r&&r.context?r.context:r,r)})}}const Vi=new KM;var Mv,Av,Pv,$s={gamut_mapping:"css",precision:5,deltaE:"76",verbose:((Pv=(Av=(Mv=globalThis==null?void 0:globalThis.process)==null?void 0:Mv.env)==null?void 0:Av.NODE_ENV)==null?void 0:Pv.toLowerCase())!=="test",warn:function(e){var r,n;this.verbose&&((n=(r=globalThis==null?void 0:globalThis.console)==null?void 0:r.warn)==null||n.call(r,e))}};const ps={D50:[.3457/.3585,1,(1-.3457-.3585)/.3585],D65:[.3127/.329,1,(1-.3127-.329)/.329]};function nf(t){return Array.isArray(t)?t:ps[t]}function Ou(t,e,r,n={}){if(t=nf(t),e=nf(e),!t||!e)throw new TypeError(`Missing white point to convert ${t?"":"from"}${!t&&!e?"/":""}${e?"":"to"}`);if(t===e)return r;let s={W1:t,W2:e,XYZ:r,options:n};if(Vi.run("chromatic-adaptation-start",s),s.M||(s.W1===ps.D65&&s.W2===ps.D50?s.M=[[1.0479297925449969,.022946870601609652,-.05019226628920524],[.02962780877005599,.9904344267538799,-.017073799063418826],[-.009243040646204504,.015055191490298152,.7518742814281371]]:s.W1===ps.D50&&s.W2===ps.D65&&(s.M=[[.955473421488075,-.02309845494876471,.06325924320057072],[-.0283697093338637,1.0099953980813041,.021041441191917323],[.012314014864481998,-.020507649298898964,1.330365926242124]])),Vi.run("chromatic-adaptation-end",s),s.M)return gn(s.M,s.XYZ);throw new TypeError("Only Bradford CAT with white points D50 and D65 supported for now.")}const ZM=new Set(["<number>","<percentage>","<angle>"]);function Ox(t,e,r,n){return Object.entries(t.coords).map(([i,a],l)=>{let c=e.coordGrammar[l],d=n[l],u=d==null?void 0:d.type,m;if(d.none?m=c.find(v=>ZM.has(v)):m=c.find(v=>v==u),!m){let v=a.name||i;throw new TypeError(`${u??d.raw} not allowed for ${v} in ${r}()`)}let g=m.range;u==="<percentage>"&&(g||(g=[0,1]));let y=a.range||a.refRange;return g&&y&&(n[l]=T0(g,y,n[l])),m})}function qS(t,{meta:e}={}){var n,s,i,a;let r={str:(n=String(t))==null?void 0:n.trim()};if(Vi.run("parse-start",r),r.color)return r.color;if(r.parsed=LS(r.str),r.parsed){let l=r.parsed.name;if(l==="color"){let c=r.parsed.args.shift(),d=c.startsWith("--")?c.substring(2):`--${c}`,u=[c,d],m=r.parsed.rawArgs.indexOf("/")>0?r.parsed.args.pop():1;for(let v of qt.all){let I=v.getFormat("color");if(I&&(u.includes(I.id)||(s=I.ids)!=null&&s.filter(S=>u.includes(S)).length)){const S=Object.keys(v.coords).map((k,A)=>r.parsed.args[A]||0);let b;return I.coordGrammar&&(b=Ox(v,I,"color",S)),e&&Object.assign(e,{formatId:"color",types:b}),I.id.startsWith("--")&&!c.startsWith("--")&&$s.warn(`${v.name} is a non-standard space and not currently supported in the CSS spec. Use prefixed color(${I.id}) instead of color(${c}).`),c.startsWith("--")&&!I.id.startsWith("--")&&$s.warn(`${v.name} is a standard space and supported in the CSS spec. Use color(${I.id}) instead of prefixed color(${c}).`),{spaceId:v.id,coords:S,alpha:m}}}let g="",y=c in qt.registry?c:d;if(y in qt.registry){let v=(a=(i=qt.registry[y].formats)==null?void 0:i.color)==null?void 0:a.id;v&&(g=`Did you mean color(${v})?`)}throw new TypeError(`Cannot parse color(${c}). `+(g||"Missing a plugin?"))}else for(let c of qt.all){let d=c.getFormat(l);if(d&&d.type==="function"){let u=1;(d.lastAlpha||BS(r.parsed.args).alpha)&&(u=r.parsed.args.pop());let m=r.parsed.args,g;return d.coordGrammar&&(g=Ox(c,d,l,m)),e&&Object.assign(e,{formatId:d.name,types:g}),{spaceId:c.id,coords:m,alpha:u}}}}else for(let l of qt.all)for(let c in l.formats){let d=l.formats[c];if(d.type!=="custom"||d.test&&!d.test(r.str))continue;let u=d.parse(r.str);if(u)return u.alpha??(u.alpha=1),e&&(e.formatId=c),u}throw new TypeError(`Could not parse ${t} as a color. Missing a plugin?`)}function Cr(t){if(Array.isArray(t))return t.map(Cr);if(!t)throw new TypeError("Empty color reference");Wc(t)&&(t=qS(t));let e=t.space||t.spaceId;return e instanceof qt||(t.space=qt.get(e)),t.alpha===void 0&&(t.alpha=1),t}const XM=75e-6,ks=class ks{constructor(e){var s;this.id=e.id,this.name=e.name,this.base=e.base?ks.get(e.base):null,this.aliases=e.aliases,this.base&&(this.fromBase=e.fromBase,this.toBase=e.toBase);let r=e.coords??this.base.coords;for(let i in r)"name"in r[i]||(r[i].name=i);this.coords=r;let n=e.white??this.base.white??"D65";this.white=nf(n),this.formats=e.formats??{};for(let i in this.formats){let a=this.formats[i];a.type||(a.type="function"),a.name||(a.name=i)}(s=this.formats.color)!=null&&s.id||(this.formats.color={...this.formats.color??{},id:e.cssId||this.id}),e.gamutSpace?this.gamutSpace=e.gamutSpace==="self"?this:ks.get(e.gamutSpace):this.isPolar?this.gamutSpace=this.base:this.gamutSpace=this,this.gamutSpace.isUnbounded&&(this.inGamut=(i,a)=>!0),this.referred=e.referred,Object.defineProperty(this,"path",{value:QM(this).reverse(),writable:!1,enumerable:!0,configurable:!0}),Vi.run("colorspace-init-end",this)}inGamut(e,{epsilon:r=XM}={}){if(!this.equals(this.gamutSpace))return e=this.to(this.gamutSpace,e),this.gamutSpace.inGamut(e,{epsilon:r});let n=Object.values(this.coords);return e.every((s,i)=>{let a=n[i];if(a.type!=="angle"&&a.range){if(Number.isNaN(s))return!0;let[l,c]=a.range;return(l===void 0||s>=l-r)&&(c===void 0||s<=c+r)}return!0})}get isUnbounded(){return Object.values(this.coords).every(e=>!("range"in e))}get cssId(){var e,r;return((r=(e=this.formats)==null?void 0:e.color)==null?void 0:r.id)||this.id}get isPolar(){for(let e in this.coords)if(this.coords[e].type==="angle")return!0;return!1}getFormat(e){if(typeof e=="object")return e=_x(e,this),e;let r;return e==="default"?r=Object.values(this.formats)[0]:r=this.formats[e],r?(r=_x(r,this),r):null}equals(e){return e?this===e||this.id===e||this.id===e.id:!1}to(e,r){if(arguments.length===1){const l=Cr(e);[e,r]=[l.space,l.coords]}if(e=ks.get(e),this.equals(e))return r;r=r.map(l=>Number.isNaN(l)?0:l);let n=this.path,s=e.path,i,a;for(let l=0;l<n.length&&n[l].equals(s[l]);l++)i=n[l],a=l;if(!i)throw new Error(`Cannot convert between color spaces ${this} and ${e}: no connection space was found`);for(let l=n.length-1;l>a;l--)r=n[l].toBase(r);for(let l=a+1;l<s.length;l++)r=s[l].fromBase(r);return r}from(e,r){if(arguments.length===1){const n=Cr(e);[e,r]=[n.space,n.coords]}return e=ks.get(e),e.to(this,r)}toString(){return`${this.name} (${this.id})`}getMinCoords(){let e=[];for(let r in this.coords){let n=this.coords[r],s=n.range||n.refRange;e.push((s==null?void 0:s.min)??0)}return e}static get all(){return[...new Set(Object.values(ks.registry))]}static register(e,r){if(arguments.length===1&&(r=arguments[0],e=r.id),r=this.get(r),this.registry[e]&&this.registry[e]!==r)throw new Error(`Duplicate color space registration: '${e}'`);if(this.registry[e]=r,arguments.length===1&&r.aliases)for(let n of r.aliases)this.register(n,r);return r}static get(e,...r){if(!e||e instanceof ks)return e;if(Mi(e)==="string"){let s=ks.registry[e.toLowerCase()];if(!s)throw new TypeError(`No color space found with id = "${e}"`);return s}if(r.length)return ks.get(...r);throw new TypeError(`${e} is not a valid color space`)}static resolveCoord(e,r){var c;let n=Mi(e),s,i;if(n==="string"?e.includes(".")?[s,i]=e.split("."):[s,i]=[,e]:Array.isArray(e)?[s,i]=e:(s=e.space,i=e.coordId),s=ks.get(s),s||(s=r),!s)throw new TypeError(`Cannot resolve coordinate reference ${e}: No color space specified and relative references are not allowed here`);if(n=Mi(i),n==="number"||n==="string"&&i>=0){let d=Object.entries(s.coords)[i];if(d)return{space:s,id:d[0],index:i,...d[1]}}s=ks.get(s);let a=i.toLowerCase(),l=0;for(let d in s.coords){let u=s.coords[d];if(d.toLowerCase()===a||((c=u.name)==null?void 0:c.toLowerCase())===a)return{space:s,id:d,index:l,...u};l++}throw new TypeError(`No "${i}" coordinate found in ${s.name}. Its coordinates are: ${Object.keys(s.coords).join(", ")}`)}};rt(ks,"registry",{}),rt(ks,"DEFAULT_FORMAT",{type:"functions",name:"color"});let qt=ks;function QM(t){let e=[t];for(let r=t;r=r.base;)e.push(r);return e}function _x(t,{coords:e}={}){if(t.coords&&!t.coordGrammar){t.type||(t.type="function"),t.name||(t.name="color"),t.coordGrammar=GS(t.coords);let r=Object.entries(e).map(([n,s],i)=>{let a=t.coordGrammar[i][0],l=s.range||s.refRange,c=a.range,d="";return a=="<percentage>"?(c=[0,100],d="%"):a=="<angle>"&&(d="deg"),{fromRange:l,toRange:c,suffix:d}});t.serializeCoords=(n,s)=>n.map((i,a)=>{let{fromRange:l,toRange:c,suffix:d}=r[a];return l&&c&&(i=T0(l,c,i)),i=Ru(i,{precision:s,unit:d}),i})}return t}var es=new qt({id:"xyz-d65",name:"XYZ D65",coords:{x:{name:"X"},y:{name:"Y"},z:{name:"Z"}},white:"D65",formats:{color:{ids:["xyz-d65","xyz"]}},aliases:["xyz"]});class Ps extends qt{constructor(e){e.coords||(e.coords={r:{range:[0,1],name:"Red"},g:{range:[0,1],name:"Green"},b:{range:[0,1],name:"Blue"}}),e.base||(e.base=es),e.toXYZ_M&&e.fromXYZ_M&&(e.toBase??(e.toBase=r=>{let n=gn(e.toXYZ_M,r);return this.white!==this.base.white&&(n=Ou(this.white,this.base.white,n)),n}),e.fromBase??(e.fromBase=r=>(r=Ou(this.base.white,this.white,r),gn(e.fromXYZ_M,r)))),e.referred??(e.referred="display"),super(e)}}function qc(t,e){return t=Cr(t),!e||t.space.equals(e)?t.coords.slice():(e=qt.get(e),e.from(t))}function Os(t,e){t=Cr(t);let{space:r,index:n}=qt.resolveCoord(e,t.space);return qc(t,r)[n]}function M0(t,e,r){return t=Cr(t),e=qt.get(e),t.coords=e.to(t.space,r),t}M0.returns="color";function ii(t,e,r){if(t=Cr(t),arguments.length===2&&Mi(arguments[1])==="object"){let n=arguments[1];for(let s in n)ii(t,s,n[s])}else{typeof r=="function"&&(r=r(Os(t,e)));let{space:n,index:s}=qt.resolveCoord(e,t.space),i=qc(t,n);i[s]=r,M0(t,n,i)}return t}ii.returns="color";var A0=new qt({id:"xyz-d50",name:"XYZ D50",white:"D50",base:es,fromBase:t=>Ou(es.white,"D50",t),toBase:t=>Ou("D50",es.white,t)});const eA=216/24389,Fx=24/116,vd=24389/27;let Sm=ps.D50;var _s=new qt({id:"lab",name:"Lab",coords:{l:{refRange:[0,100],name:"Lightness"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:Sm,base:A0,fromBase(t){let r=t.map((n,s)=>n/Sm[s]).map(n=>n>eA?Math.cbrt(n):(vd*n+16)/116);return[116*r[1]-16,500*(r[0]-r[1]),200*(r[1]-r[2])]},toBase(t){let e=[];return e[1]=(t[0]+16)/116,e[0]=t[1]/500+e[1],e[2]=e[1]-t[2]/200,[e[0]>Fx?Math.pow(e[0],3):(116*e[0]-16)/vd,t[0]>8?Math.pow((t[0]+16)/116,3):t[0]/vd,e[2]>Fx?Math.pow(e[2],3):(116*e[2]-16)/vd].map((n,s)=>n*Sm[s])},formats:{lab:{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function $o(t){return(t%360+360)%360}function tA(t,e){if(t==="raw")return e;let[r,n]=e.map($o),s=n-r;return t==="increasing"?s<0&&(n+=360):t==="decreasing"?s>0&&(r+=360):t==="longer"?-180<s&&s<180&&(s>0?r+=360:n+=360):t==="shorter"&&(s>180?r+=360:s<-180&&(n+=360)),[r,n]}var Pc=new qt({id:"lch",name:"LCH",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,150],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:_s,fromBase(t){let[e,r,n]=t,s;const i=.02;return Math.abs(r)<i&&Math.abs(n)<i?s=NaN:s=Math.atan2(n,r)*180/Math.PI,[e,Math.sqrt(r**2+n**2),$o(s)]},toBase(t){let[e,r,n]=t;return r<0&&(r=0),isNaN(n)&&(n=0),[e,r*Math.cos(n*Math.PI/180),r*Math.sin(n*Math.PI/180)]},formats:{lch:{coords:["<number> | <percentage>","<number> | <percentage>","<number> | <angle>"]}}});const Vx=25**7,_u=Math.PI,$x=180/_u,Ka=_u/180;function zx(t){const e=t*t;return e*e*e*t}function JS(t,e,{kL:r=1,kC:n=1,kH:s=1}={}){[t,e]=Cr([t,e]);let[i,a,l]=_s.from(t),c=Pc.from(_s,[i,a,l])[1],[d,u,m]=_s.from(e),g=Pc.from(_s,[d,u,m])[1];c<0&&(c=0),g<0&&(g=0);let y=(c+g)/2,v=zx(y),I=.5*(1-Math.sqrt(v/(v+Vx))),S=(1+I)*a,b=(1+I)*u,k=Math.sqrt(S**2+l**2),A=Math.sqrt(b**2+m**2),C=S===0&&l===0?0:Math.atan2(l,S),T=b===0&&m===0?0:Math.atan2(m,b);C<0&&(C+=2*_u),T<0&&(T+=2*_u),C*=$x,T*=$x;let P=d-i,_=A-k,R=T-C,G=C+T,ne=Math.abs(R),he;k*A===0?he=0:ne<=180?he=R:R>180?he=R-360:R<-180?he=R+360:$s.warn("the unthinkable has happened");let te=2*Math.sqrt(A*k)*Math.sin(he*Ka/2),K=(i+d)/2,O=(k+A)/2,Z=zx(O),ie;k*A===0?ie=G:ne<=180?ie=G/2:G<360?ie=(G+360)/2:ie=(G-360)/2;let ge=(K-50)**2,xe=1+.015*ge/Math.sqrt(20+ge),$=1+.045*O,B=1;B-=.17*Math.cos((ie-30)*Ka),B+=.24*Math.cos(2*ie*Ka),B+=.32*Math.cos((3*ie+6)*Ka),B-=.2*Math.cos((4*ie-63)*Ka);let U=1+.015*O*B,X=30*Math.exp(-1*((ie-275)/25)**2),ee=2*Math.sqrt(Z/(Z+Vx)),be=-1*Math.sin(2*X*Ka)*ee,Se=(P/(r*xe))**2;return Se+=(_/(n*$))**2,Se+=(te/(s*U))**2,Se+=be*(_/(n*$))*(te/(s*U)),Math.sqrt(Se)}const rA=[[.819022437996703,.3619062600528904,-.1288737815209879],[.0329836539323885,.9292868615863434,.0361446663506424],[.0481771893596242,.2642395317527308,.6335478284694309]],nA=[[1.2268798758459243,-.5578149944602171,.2813910456659647],[-.0405757452148008,1.112286803280317,-.0717110580655164],[-.0763729366746601,-.4214933324022432,1.5869240198367816]],sA=[[.210454268309314,.7936177747023054,-.0040720430116193],[1.9779985324311684,-2.42859224204858,.450593709617411],[.0259040424655478,.7827717124575296,-.8086757549230774]],oA=[[1,.3963377773761749,.2158037573099136],[1,-.1055613458156586,-.0638541728258133],[1,-.0894841775298119,-1.2914855480194092]];var wl=new qt({id:"oklab",name:"Oklab",coords:{l:{refRange:[0,1],name:"Lightness"},a:{refRange:[-.4,.4]},b:{refRange:[-.4,.4]}},white:"D65",base:es,fromBase(t){let r=gn(rA,t).map(n=>Math.cbrt(n));return gn(sA,r)},toBase(t){let r=gn(oA,t).map(n=>n**3);return gn(nA,r)},formats:{oklab:{coords:["<percentage> | <number>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function sf(t,e){[t,e]=Cr([t,e]);let[r,n,s]=wl.from(t),[i,a,l]=wl.from(e),c=r-i,d=n-a,u=s-l;return Math.sqrt(c**2+d**2+u**2)}const iA=75e-6;function Pa(t,e,{epsilon:r=iA}={}){t=Cr(t),e||(e=t.space),e=qt.get(e);let n=t.coords;return e!==t.space&&(n=e.from(t)),e.inGamut(n,{epsilon:r})}function Cl(t){return{space:t.space,coords:t.coords.slice(),alpha:t.alpha}}function YS(t,e,r="lab"){r=qt.get(r);let n=r.from(t),s=r.from(e);return Math.sqrt(n.reduce((i,a,l)=>{let c=s[l];return isNaN(a)||isNaN(c)?i:i+(c-a)**2},0))}function aA(t,e){return YS(t,e,"lab")}const lA=Math.PI,Lx=lA/180;function cA(t,e,{l:r=2,c:n=1}={}){[t,e]=Cr([t,e]);let[s,i,a]=_s.from(t),[,l,c]=Pc.from(_s,[s,i,a]),[d,u,m]=_s.from(e),g=Pc.from(_s,[d,u,m])[1];l<0&&(l=0),g<0&&(g=0);let y=s-d,v=l-g,I=i-u,S=a-m,b=I**2+S**2-v**2,k=.511;s>=16&&(k=.040975*s/(1+.01765*s));let A=.0638*l/(1+.0131*l)+.638,C;Number.isNaN(c)&&(c=0),c>=164&&c<=345?C=.56+Math.abs(.2*Math.cos((c+168)*Lx)):C=.36+Math.abs(.4*Math.cos((c+35)*Lx));let T=Math.pow(l,4),P=Math.sqrt(T/(T+1900)),_=A*(P*C+1-P),R=(y/(r*k))**2;return R+=(v/(n*A))**2,R+=b/_**2,Math.sqrt(R)}const Bx=203;var P0=new qt({id:"xyz-abs-d65",cssId:"--xyz-abs-d65",name:"Absolute XYZ D65",coords:{x:{refRange:[0,9504.7],name:"Xa"},y:{refRange:[0,1e4],name:"Ya"},z:{refRange:[0,10888.3],name:"Za"}},base:es,fromBase(t){return t.map(e=>Math.max(e*Bx,0))},toBase(t){return t.map(e=>Math.max(e/Bx,0))}});const bd=1.15,Sd=.66,Ux=2610/2**14,dA=2**14/2610,Gx=3424/2**12,Hx=2413/2**7,Wx=2392/2**7,uA=1.7*2523/2**5,qx=2**5/(1.7*2523),wd=-.56,wm=16295499532821565e-27,hA=[[.41478972,.579999,.014648],[-.20151,1.120649,.0531008],[-.0166008,.2648,.6684799]],mA=[[1.9242264357876067,-1.0047923125953657,.037651404030618],[.35031676209499907,.7264811939316552,-.06538442294808501],[-.09098281098284752,-.3127282905230739,1.5227665613052603]],pA=[[.5,.5,0],[3.524,-4.066708,.542708],[.199076,1.096799,-1.295875]],fA=[[1,.1386050432715393,.05804731615611886],[.9999999999999999,-.1386050432715393,-.05804731615611886],[.9999999999999998,-.09601924202631895,-.8118918960560388]];var KS=new qt({id:"jzazbz",name:"Jzazbz",coords:{jz:{refRange:[0,1],name:"Jz"},az:{refRange:[-.5,.5]},bz:{refRange:[-.5,.5]}},base:P0,fromBase(t){let[e,r,n]=t,s=bd*e-(bd-1)*n,i=Sd*r-(Sd-1)*e,l=gn(hA,[s,i,n]).map(function(g){let y=Gx+Hx*(g/1e4)**Ux,v=1+Wx*(g/1e4)**Ux;return(y/v)**uA}),[c,d,u]=gn(pA,l);return[(1+wd)*c/(1+wd*c)-wm,d,u]},toBase(t){let[e,r,n]=t,s=(e+wm)/(1+wd-wd*(e+wm)),a=gn(fA,[s,r,n]).map(function(g){let y=Gx-g**qx,v=Wx*g**qx-Hx;return 1e4*(y/v)**dA}),[l,c,d]=gn(mA,a),u=(l+(bd-1)*d)/bd,m=(c+(Sd-1)*u)/Sd;return[u,m,d]},formats:{color:{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}}),of=new qt({id:"jzczhz",name:"JzCzHz",coords:{jz:{refRange:[0,1],name:"Jz"},cz:{refRange:[0,1],name:"Chroma"},hz:{refRange:[0,360],type:"angle",name:"Hue"}},base:KS,fromBase(t){let[e,r,n]=t,s;const i=2e-4;return Math.abs(r)<i&&Math.abs(n)<i?s=NaN:s=Math.atan2(n,r)*180/Math.PI,[e,Math.sqrt(r**2+n**2),$o(s)]},toBase(t){return[t[0],t[1]*Math.cos(t[2]*Math.PI/180),t[1]*Math.sin(t[2]*Math.PI/180)]}});function gA(t,e){[t,e]=Cr([t,e]);let[r,n,s]=of.from(t),[i,a,l]=of.from(e),c=r-i,d=n-a;Number.isNaN(s)&&Number.isNaN(l)?(s=0,l=0):Number.isNaN(s)?s=l:Number.isNaN(l)&&(l=s);let u=s-l,m=2*Math.sqrt(n*a)*Math.sin(u/2*(Math.PI/180));return Math.sqrt(c**2+d**2+m**2)}const ZS=3424/4096,XS=2413/128,QS=2392/128,Jx=2610/16384,yA=2523/32,xA=16384/2610,Yx=32/2523,vA=[[.3592832590121217,.6976051147779502,-.035891593232029],[-.1920808463704993,1.100476797037432,.0753748658519118],[.0070797844607479,.0748396662186362,.8433265453898765]],bA=[[2048/4096,2048/4096,0],[6610/4096,-13613/4096,7003/4096],[17933/4096,-17390/4096,-543/4096]],SA=[[.9999999999999998,.0086090370379328,.111029625003026],[.9999999999999998,-.0086090370379328,-.1110296250030259],[.9999999999999998,.5600313357106791,-.3206271749873188]],wA=[[2.0701522183894223,-1.3263473389671563,.2066510476294053],[.3647385209748072,.6805660249472273,-.0453045459220347],[-.0497472075358123,-.0492609666966131,1.1880659249923042]];var af=new qt({id:"ictcp",name:"ICTCP",coords:{i:{refRange:[0,1],name:"I"},ct:{refRange:[-.5,.5],name:"CT"},cp:{refRange:[-.5,.5],name:"CP"}},base:P0,fromBase(t){let e=gn(vA,t);return CA(e)},toBase(t){let e=kA(t);return gn(wA,e)}});function CA(t){let e=t.map(function(r){let n=ZS+XS*(r/1e4)**Jx,s=1+QS*(r/1e4)**Jx;return(n/s)**yA});return gn(bA,e)}function kA(t){return gn(SA,t).map(function(n){let s=Math.max(n**Yx-ZS,0),i=XS-QS*n**Yx;return 1e4*(s/i)**xA})}function IA(t,e){[t,e]=Cr([t,e]);let[r,n,s]=af.from(t),[i,a,l]=af.from(e);return 720*Math.sqrt((r-i)**2+.25*(n-a)**2+(s-l)**2)}const jA=ps.D65,e4=.42,Kx=1/e4,Cm=2*Math.PI,t4=[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],TA=[[1.8620678550872327,-1.0112546305316843,.14918677544445175],[.38752654323613717,.6214474419314753,-.008973985167612518],[-.015841498849333856,-.03412293802851557,1.0499644368778496]],EA=[[460,451,288],[460,-891,-261],[460,-220,-6300]],MA={dark:[.8,.525,.8],dim:[.9,.59,.9],average:[1,.69,1]},Qi={h:[20.14,90,164.25,237.53,380.14],e:[.8,.7,1,1.2,.8],H:[0,100,200,300,400]},AA=180/Math.PI,Zx=Math.PI/180;function r4(t,e){return t.map(n=>{const s=Mo(e*Math.abs(n)*.01,e4);return 400*mh(s,n)/(s+27.13)})}function PA(t,e){const r=100/e*27.13**Kx;return t.map(n=>{const s=Math.abs(n);return mh(r*Mo(s/(400-s),Kx),n)})}function NA(t){let e=$o(t);e<=Qi.h[0]&&(e+=360);const r=WS(Qi.h,e)-1,[n,s]=Qi.h.slice(r,r+2),[i,a]=Qi.e.slice(r,r+2),l=Qi.H[r],c=(e-n)/i;return l+100*c/(c+(s-e)/a)}function DA(t){let e=(t%400+400)%400;const r=Math.floor(.01*e);e=e%100;const[n,s]=Qi.h.slice(r,r+2),[i,a]=Qi.e.slice(r,r+2);return $o((e*(a*n-i*s)-100*n*a)/(e*(a-i)-100*a))}function n4(t,e,r,n,s){const i={};i.discounting=s,i.refWhite=t,i.surround=n;const a=t.map(I=>I*100);i.la=e,i.yb=r;const l=a[1],c=gn(t4,a);n=MA[i.surround];const d=n[0];i.c=n[1],i.nc=n[2];const m=(1/(5*i.la+1))**4;i.fl=m*i.la+.1*(1-m)*(1-m)*Math.cbrt(5*i.la),i.flRoot=i.fl**.25,i.n=i.yb/l,i.z=1.48+Math.sqrt(i.n),i.nbb=.725*i.n**-.2,i.ncb=i.nbb;const g=Math.max(Math.min(d*(1-1/3.6*Math.exp((-i.la-42)/92)),1),0);i.dRgb=c.map(I=>Ac(1,l/I,g)),i.dRgbInv=i.dRgb.map(I=>1/I);const y=c.map((I,S)=>I*i.dRgb[S]),v=r4(y,i.fl);return i.aW=i.nbb*(2*v[0]+v[1]+.05*v[2]),i}const Xx=n4(jA,64/Math.PI*.2,20,"average",!1);function lf(t,e){if(!(t.J!==void 0^t.Q!==void 0))throw new Error("Conversion requires one and only one: 'J' or 'Q'");if(!(t.C!==void 0^t.M!==void 0^t.s!==void 0))throw new Error("Conversion requires one and only one: 'C', 'M' or 's'");if(!(t.h!==void 0^t.H!==void 0))throw new Error("Conversion requires one and only one: 'h' or 'H'");if(t.J===0||t.Q===0)return[0,0,0];let r=0;t.h!==void 0?r=$o(t.h)*Zx:r=DA(t.H)*Zx;const n=Math.cos(r),s=Math.sin(r);let i=0;t.J!==void 0?i=Mo(t.J,1/2)*.1:t.Q!==void 0&&(i=.25*e.c*t.Q/((e.aW+4)*e.flRoot));let a=0;t.C!==void 0?a=t.C/i:t.M!==void 0?a=t.M/e.flRoot/i:t.s!==void 0&&(a=4e-4*t.s**2*(e.aW+4)/e.c);const l=Mo(a*Math.pow(1.64-Math.pow(.29,e.n),-.73),10/9),c=.25*(Math.cos(r+2)+3.8),d=e.aW*Mo(i,2/e.c/e.z),u=5e4/13*e.nc*e.ncb*c,m=d/e.nbb,g=23*(m+.305)*E0(l,23*u+l*(11*n+108*s)),y=g*n,v=g*s,I=PA(gn(EA,[m,y,v]).map(S=>S*1/1403),e.fl);return gn(TA,I.map((S,b)=>S*e.dRgbInv[b])).map(S=>S/100)}function s4(t,e){const r=t.map(A=>A*100),n=r4(gn(t4,r).map((A,C)=>A*e.dRgb[C]),e.fl),s=n[0]+(-12*n[1]+n[2])/11,i=(n[0]+n[1]-2*n[2])/9,a=(Math.atan2(i,s)%Cm+Cm)%Cm,l=.25*(Math.cos(a+2)+3.8),c=5e4/13*e.nc*e.ncb*E0(l*Math.sqrt(s**2+i**2),n[0]+n[1]+1.05*n[2]+.305),d=Mo(c,.9)*Math.pow(1.64-Math.pow(.29,e.n),.73),u=e.nbb*(2*n[0]+n[1]+.05*n[2]),m=Mo(u/e.aW,.5*e.c*e.z),g=100*Mo(m,2),y=4/e.c*m*(e.aW+4)*e.flRoot,v=d*m,I=v*e.flRoot,S=$o(a*AA),b=NA(S),k=50*Mo(e.c*d/(e.aW+4),1/2);return{J:g,C:v,h:S,s:k,Q:y,M:I,H:b}}var RA=new qt({id:"cam16-jmh",cssId:"--cam16-jmh",name:"CAM16-JMh",coords:{j:{refRange:[0,100],name:"J"},m:{refRange:[0,105],name:"Colorfulness"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:es,fromBase(t){const e=s4(t,Xx);return[e.J,e.M,e.h]},toBase(t){return lf({J:t[0],M:t[1],h:t[2]},Xx)}});const OA=ps.D65,_A=216/24389,o4=24389/27;function FA(t){return 116*(t>_A?Math.cbrt(t):(o4*t+16)/116)-16}function cf(t){return t>8?Math.pow((t+16)/116,3):t/o4}function VA(t,e){let[r,n,s]=t,i=[],a=0;if(s===0)return[0,0,0];let l=cf(s);s>0?a=.00379058511492914*s**2+.608983189401032*s+.9155088574762233:a=9514440756550361e-21*s**2+.08693057439788597*s-21.928975842194614;const c=2e-12,d=15;let u=0,m=1/0;for(;u<=d;){i=lf({J:a,C:n,h:r},e);const g=Math.abs(i[1]-l);if(g<m){if(g<=c)return i;m=g}a=a-(i[1]-l)*a/(2*i[1]),u+=1}return lf({J:a,C:n,h:r},e)}function $A(t,e){const r=FA(t[1]);if(r===0)return[0,0,0];const n=s4(t,N0);return[$o(n.h),n.C,r]}const N0=n4(OA,200/Math.PI*cf(50),cf(50)*100,"average",!1);var Nc=new qt({id:"hct",name:"HCT",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},c:{refRange:[0,145],name:"Colorfulness"},t:{refRange:[0,100],name:"Tone"}},base:es,fromBase(t){return $A(t)},toBase(t){return VA(t,N0)},formats:{color:{id:"--hct",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}});const zA=Math.PI/180,Qx=[1,.007,.0228];function e1(t){t[1]<0&&(t=Nc.fromBase(Nc.toBase(t)));const e=Math.log(Math.max(1+Qx[2]*t[1]*N0.flRoot,1))/Qx[2],r=t[0]*zA,n=e*Math.cos(r),s=e*Math.sin(r);return[t[2],n,s]}function LA(t,e){[t,e]=Cr([t,e]);let[r,n,s]=e1(Nc.from(t)),[i,a,l]=e1(Nc.from(e));return Math.sqrt((r-i)**2+(n-a)**2+(s-l)**2)}var kl={deltaE76:aA,deltaECMC:cA,deltaE2000:JS,deltaEJz:gA,deltaEITP:IA,deltaEOK:sf,deltaEHCT:LA};function BA(t){const e=t?Math.floor(Math.log10(Math.abs(t))):0;return Math.max(parseFloat(`1e${e-2}`),1e-6)}const t1={hct:{method:"hct.c",jnd:2,deltaEMethod:"hct",blackWhiteClamp:{}},"hct-tonal":{method:"hct.c",jnd:0,deltaEMethod:"hct",blackWhiteClamp:{channel:"hct.t",min:0,max:100}}};function $i(t,{method:e=$s.gamut_mapping,space:r=void 0,deltaEMethod:n="",jnd:s=2,blackWhiteClamp:i={}}={}){if(t=Cr(t),Wc(arguments[1])?r=arguments[1]:r||(r=t.space),r=qt.get(r),Pa(t,r,{epsilon:0}))return t;let a;if(e==="css")a=UA(t,{space:r});else{if(e!=="clip"&&!Pa(t,r)){Object.prototype.hasOwnProperty.call(t1,e)&&({method:e,jnd:s,deltaEMethod:n,blackWhiteClamp:i}=t1[e]);let l=JS;if(n!==""){for(let d in kl)if("deltae"+n.toLowerCase()===d.toLowerCase()){l=kl[d];break}}let c=$i(pn(t,r),{method:"clip",space:r});if(l(t,c)>s){if(Object.keys(i).length===3){let k=qt.resolveCoord(i.channel),A=Os(pn(t,k.space),k.id);if(Fi(A)&&(A=0),A>=i.max)return pn({space:"xyz-d65",coords:ps.D65},t.space);if(A<=i.min)return pn({space:"xyz-d65",coords:[0,0,0]},t.space)}let d=qt.resolveCoord(e),u=d.space,m=d.id,g=pn(t,u);g.coords.forEach((k,A)=>{Fi(k)&&(g.coords[A]=0)});let v=(d.range||d.refRange)[0],I=BA(s),S=v,b=Os(g,m);for(;b-S>I;){let k=Cl(g);k=$i(k,{space:r,method:"clip"}),l(g,k)-s<I?S=Os(g,m):b=Os(g,m),ii(g,m,(S+b)/2)}a=pn(g,r)}else a=c}else a=pn(t,r);if(e==="clip"||!Pa(a,r,{epsilon:0})){let l=Object.values(r.coords).map(c=>c.range||[]);a.coords=a.coords.map((c,d)=>{let[u,m]=l[d];return u!==void 0&&(c=Math.max(u,c)),m!==void 0&&(c=Math.min(c,m)),c})}}return r!==t.space&&(a=pn(a,t.space)),t.coords=a.coords,t}$i.returns="color";const r1={WHITE:{space:wl,coords:[1,0,0]},BLACK:{space:wl,coords:[0,0,0]}};function UA(t,{space:e}={}){t=Cr(t),e||(e=t.space),e=qt.get(e);const s=qt.get("oklch");if(e.isUnbounded)return pn(t,e);const i=pn(t,s);let a=i.coords[0];if(a>=1){const v=pn(r1.WHITE,e);return v.alpha=t.alpha,pn(v,e)}if(a<=0){const v=pn(r1.BLACK,e);return v.alpha=t.alpha,pn(v,e)}if(Pa(i,e,{epsilon:0}))return pn(i,e);function l(v){const I=pn(v,e),S=Object.values(e.coords);return I.coords=I.coords.map((b,k)=>{if("range"in S[k]){const[A,C]=S[k].range;return HS(A,b,C)}return b}),I}let c=0,d=i.coords[1],u=!0,m=Cl(i),g=l(m),y=sf(g,m);if(y<.02)return g;for(;d-c>1e-4;){const v=(c+d)/2;if(m.coords[1]=v,u&&Pa(m,e,{epsilon:0}))c=v;else if(g=l(m),y=sf(g,m),y<.02){if(.02-y<1e-4)break;u=!1,c=v}else d=v}return g}function pn(t,e,{inGamut:r}={}){t=Cr(t),e=qt.get(e);let n=e.from(t),s={space:e,coords:n,alpha:t.alpha};return r&&(s=$i(s,r===!0?void 0:r)),s}pn.returns="color";function cc(t,{precision:e=$s.precision,format:r="default",inGamut:n=!0,...s}={}){var c;let i;t=Cr(t);let a=r;r=t.space.getFormat(r)??t.space.getFormat("default")??qt.DEFAULT_FORMAT;let l=t.coords.slice();if(n||(n=r.toGamut),n&&!Pa(t)&&(l=$i(Cl(t),n===!0?void 0:n).coords),r.type==="custom")if(s.precision=e,r.serialize)i=r.serialize(l,t.alpha,s);else throw new TypeError(`format ${a} can only be used to parse colors, not for serialization`);else{let d=r.name||"color";r.serializeCoords?l=r.serializeCoords(l,e):e!==null&&(l=l.map(y=>Ru(y,{precision:e})));let u=[...l];if(d==="color"){let y=r.id||((c=r.ids)==null?void 0:c[0])||t.space.id;u.unshift(y)}let m=t.alpha;e!==null&&(m=Ru(m,{precision:e}));let g=t.alpha>=1||r.noAlpha?"":`${r.commas?",":" /"} ${m}`;i=`${d}(${u.join(r.commas?", ":" ")}${g})`}return i}const GA=[[.6369580483012914,.14461690358620832,.1688809751641721],[.2627002120112671,.6779980715188708,.05930171646986196],[0,.028072693049087428,1.060985057710791]],HA=[[1.716651187971268,-.355670783776392,-.25336628137366],[-.666684351832489,1.616481236634939,.0157685458139111],[.017639857445311,-.042770613257809,.942103121235474]];var ph=new Ps({id:"rec2020-linear",cssId:"--rec2020-linear",name:"Linear REC.2020",white:"D65",toXYZ_M:GA,fromXYZ_M:HA});const Cd=1.09929682680944,n1=.018053968510807;var i4=new Ps({id:"rec2020",name:"REC.2020",base:ph,toBase(t){return t.map(function(e){return e<n1*4.5?e/4.5:Math.pow((e+Cd-1)/Cd,1/.45)})},fromBase(t){return t.map(function(e){return e>=n1?Cd*Math.pow(e,.45)-(Cd-1):4.5*e})}});const WA=[[.4865709486482162,.26566769316909306,.1982172852343625],[.2289745640697488,.6917385218365064,.079286914093745],[0,.04511338185890264,1.043944368900976]],qA=[[2.493496911941425,-.9313836179191239,-.40271078445071684],[-.8294889695615747,1.7626640603183463,.023624685841943577],[.03584583024378447,-.07617238926804182,.9568845240076872]];var a4=new Ps({id:"p3-linear",cssId:"--display-p3-linear",name:"Linear P3",white:"D65",toXYZ_M:WA,fromXYZ_M:qA});const JA=[[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],Bn=[[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]];var l4=new Ps({id:"srgb-linear",name:"Linear sRGB",white:"D65",toXYZ_M:JA,fromXYZ_M:Bn}),s1={aliceblue:[240/255,248/255,1],antiquewhite:[250/255,235/255,215/255],aqua:[0,1,1],aquamarine:[127/255,1,212/255],azure:[240/255,1,1],beige:[245/255,245/255,220/255],bisque:[1,228/255,196/255],black:[0,0,0],blanchedalmond:[1,235/255,205/255],blue:[0,0,1],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,1,0],chocolate:[210/255,105/255,30/255],coral:[1,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[1,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0,1,1],darkblue:[0,0,139/255],darkcyan:[0,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0,100/255,0],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[1,140/255,0],darkorchid:[153/255,50/255,204/255],darkred:[139/255,0,0],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0,206/255,209/255],darkviolet:[148/255,0,211/255],deeppink:[1,20/255,147/255],deepskyblue:[0,191/255,1],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,1],firebrick:[178/255,34/255,34/255],floralwhite:[1,250/255,240/255],forestgreen:[34/255,139/255,34/255],fuchsia:[1,0,1],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,1],gold:[1,215/255,0],goldenrod:[218/255,165/255,32/255],gray:[128/255,128/255,128/255],green:[0,128/255,0],greenyellow:[173/255,1,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,1,240/255],hotpink:[1,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0,130/255],ivory:[1,1,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[1,240/255,245/255],lawngreen:[124/255,252/255,0],lemonchiffon:[1,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,1,1],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[1,182/255,193/255],lightsalmon:[1,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,153/255],lightslategrey:[119/255,136/255,153/255],lightsteelblue:[176/255,196/255,222/255],lightyellow:[1,1,224/255],lime:[0,1,0],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[1,0,1],maroon:[128/255,0,0],mediumaquamarine:[102/255,205/255,170/255],mediumblue:[0,0,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0,250/255,154/255],mediumturquoise:[72/255,209/255,204/255],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,1,250/255],mistyrose:[1,228/255,225/255],moccasin:[1,228/255,181/255],navajowhite:[1,222/255,173/255],navy:[0,0,128/255],oldlace:[253/255,245/255,230/255],olive:[128/255,128/255,0],olivedrab:[107/255,142/255,35/255],orange:[1,165/255,0],orangered:[1,69/255,0],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[1,239/255,213/255],peachpuff:[1,218/255,185/255],peru:[205/255,133/255,63/255],pink:[1,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],purple:[128/255,0,128/255],rebeccapurple:[102/255,51/255,153/255],red:[1,0,0],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[1,245/255,238/255],sienna:[160/255,82/255,45/255],silver:[192/255,192/255,192/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[1,250/255,250/255],springgreen:[0,1,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],teal:[0,128/255,128/255],thistle:[216/255,191/255,216/255],tomato:[1,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],white:[1,1,1],whitesmoke:[245/255,245/255,245/255],yellow:[1,1,0],yellowgreen:[154/255,205/255,50/255]};let o1=Array(3).fill("<percentage> | <number>[0, 255]"),i1=Array(3).fill("<number>[0, 255]");var Il=new Ps({id:"srgb",name:"sRGB",base:l4,fromBase:t=>t.map(e=>{let r=e<0?-1:1,n=e*r;return n>.0031308?r*(1.055*n**(1/2.4)-.055):12.92*e}),toBase:t=>t.map(e=>{let r=e<0?-1:1,n=e*r;return n<=.04045?e/12.92:r*((n+.055)/1.055)**2.4}),formats:{rgb:{coords:o1},rgb_number:{name:"rgb",commas:!0,coords:i1,noAlpha:!0},color:{},rgba:{coords:o1,commas:!0,lastAlpha:!0},rgba_number:{name:"rgba",commas:!0,coords:i1},hex:{type:"custom",toGamut:!0,test:t=>/^#([a-f0-9]{3,4}){1,2}$/i.test(t),parse(t){t.length<=5&&(t=t.replace(/[a-f0-9]/gi,"$&$&"));let e=[];return t.replace(/[a-f0-9]{2}/gi,r=>{e.push(parseInt(r,16)/255)}),{spaceId:"srgb",coords:e.slice(0,3),alpha:e.slice(3)[0]}},serialize:(t,e,{collapse:r=!0}={})=>{e<1&&t.push(e),t=t.map(i=>Math.round(i*255));let n=r&&t.every(i=>i%17===0);return"#"+t.map(i=>n?(i/17).toString(16):i.toString(16).padStart(2,"0")).join("")}},keyword:{type:"custom",test:t=>/^[a-z]+$/i.test(t),parse(t){t=t.toLowerCase();let e={spaceId:"srgb",coords:null,alpha:1};if(t==="transparent"?(e.coords=s1.black,e.alpha=0):e.coords=s1[t],e.coords)return e}}}}),c4=new Ps({id:"p3",cssId:"display-p3",name:"P3",base:a4,fromBase:Il.fromBase,toBase:Il.toBase});$s.display_space=Il;let YA;if(typeof CSS<"u"&&CSS.supports)for(let t of[_s,i4,c4]){let e=t.getMinCoords(),n=cc({space:t,coords:e,alpha:1});if(CSS.supports("color",n)){$s.display_space=t;break}}function KA(t,{space:e=$s.display_space,...r}={}){let n=cc(t,r);if(typeof CSS>"u"||CSS.supports("color",n)||!$s.display_space)n=new String(n),n.color=t;else{let s=t;if((t.coords.some(Fi)||Fi(t.alpha))&&!(YA??(YA=CSS.supports("color","hsl(none 50% 50%)")))&&(s=Cl(t),s.coords=s.coords.map(_n),s.alpha=_n(s.alpha),n=cc(s,r),CSS.supports("color",n)))return n=new String(n),n.color=s,n;s=pn(s,e),n=new String(cc(s,r)),n.color=s}return n}function ZA(t,e){return t=Cr(t),e=Cr(e),t.space===e.space&&t.alpha===e.alpha&&t.coords.every((r,n)=>r===e.coords[n])}function zi(t){return Os(t,[es,"y"])}function d4(t,e){ii(t,[es,"y"],e)}function XA(t){Object.defineProperty(t.prototype,"luminance",{get(){return zi(this)},set(e){d4(this,e)}})}var QA=Object.freeze({__proto__:null,getLuminance:zi,register:XA,setLuminance:d4});function eP(t,e){t=Cr(t),e=Cr(e);let r=Math.max(zi(t),0),n=Math.max(zi(e),0);return n>r&&([r,n]=[n,r]),(r+.05)/(n+.05)}const tP=.56,rP=.57,nP=.62,sP=.65,a1=.022,oP=1.414,iP=.1,aP=5e-4,lP=1.14,l1=.027,cP=1.14;function c1(t){return t>=a1?t:t+(a1-t)**oP}function Za(t){let e=t<0?-1:1,r=Math.abs(t);return e*Math.pow(r,2.4)}function dP(t,e){e=Cr(e),t=Cr(t);let r,n,s,i,a,l;e=pn(e,"srgb"),[i,a,l]=e.coords;let c=Za(i)*.2126729+Za(a)*.7151522+Za(l)*.072175;t=pn(t,"srgb"),[i,a,l]=t.coords;let d=Za(i)*.2126729+Za(a)*.7151522+Za(l)*.072175,u=c1(c),m=c1(d),g=m>u;return Math.abs(m-u)<aP?n=0:g?(r=m**tP-u**rP,n=r*lP):(r=m**sP-u**nP,n=r*cP),Math.abs(n)<iP?s=0:n>0?s=n-l1:s=n+l1,s*100}function uP(t,e){t=Cr(t),e=Cr(e);let r=Math.max(zi(t),0),n=Math.max(zi(e),0);n>r&&([r,n]=[n,r]);let s=r+n;return s===0?0:(r-n)/s}const hP=5e4;function mP(t,e){t=Cr(t),e=Cr(e);let r=Math.max(zi(t),0),n=Math.max(zi(e),0);return n>r&&([r,n]=[n,r]),n===0?hP:(r-n)/n}function pP(t,e){t=Cr(t),e=Cr(e);let r=Os(t,[_s,"l"]),n=Os(e,[_s,"l"]);return Math.abs(r-n)}const fP=216/24389,d1=24/116,kd=24389/27;let km=ps.D65;var df=new qt({id:"lab-d65",name:"Lab D65",coords:{l:{refRange:[0,100],name:"Lightness"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:km,base:es,fromBase(t){let r=t.map((n,s)=>n/km[s]).map(n=>n>fP?Math.cbrt(n):(kd*n+16)/116);return[116*r[1]-16,500*(r[0]-r[1]),200*(r[1]-r[2])]},toBase(t){let e=[];return e[1]=(t[0]+16)/116,e[0]=t[1]/500+e[1],e[2]=e[1]-t[2]/200,[e[0]>d1?Math.pow(e[0],3):(116*e[0]-16)/kd,t[0]>8?Math.pow((t[0]+16)/116,3):t[0]/kd,e[2]>d1?Math.pow(e[2],3):(116*e[2]-16)/kd].map((n,s)=>n*km[s])},formats:{"lab-d65":{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});const Im=Math.pow(5,.5)*.5+.5;function gP(t,e){t=Cr(t),e=Cr(e);let r=Os(t,[df,"l"]),n=Os(e,[df,"l"]),s=Math.abs(Math.pow(r,Im)-Math.pow(n,Im)),i=Math.pow(s,1/Im)*Math.SQRT2-40;return i<7.5?0:i}var Ld=Object.freeze({__proto__:null,contrastAPCA:dP,contrastDeltaPhi:gP,contrastLstar:pP,contrastMichelson:uP,contrastWCAG21:eP,contrastWeber:mP});function yP(t,e,r={}){Wc(r)&&(r={algorithm:r});let{algorithm:n,...s}=r;if(!n){let i=Object.keys(Ld).map(a=>a.replace(/^contrast/,"")).join(", ");throw new TypeError(`contrast() function needs a contrast algorithm. Please specify one of: ${i}`)}t=Cr(t),e=Cr(e);for(let i in Ld)if("contrast"+n.toLowerCase()===i.toLowerCase())return Ld[i](t,e,s);throw new TypeError(`Unknown contrast algorithm: ${n}`)}function fh(t){let[e,r,n]=qc(t,es),s=e+15*r+3*n;return[4*e/s,9*r/s]}function u4(t){let[e,r,n]=qc(t,es),s=e+r+n;return[e/s,r/s]}function xP(t){Object.defineProperty(t.prototype,"uv",{get(){return fh(this)}}),Object.defineProperty(t.prototype,"xy",{get(){return u4(this)}})}var vP=Object.freeze({__proto__:null,register:xP,uv:fh,xy:u4});function Xl(t,e,r={}){Wc(r)&&(r={method:r});let{method:n=$s.deltaE,...s}=r;for(let i in kl)if("deltae"+n.toLowerCase()===i.toLowerCase())return kl[i](t,e,s);throw new TypeError(`Unknown deltaE method: ${n}`)}function bP(t,e=.25){let n=[qt.get("oklch","lch"),"l"];return ii(t,n,s=>s*(1+e))}function SP(t,e=.25){let n=[qt.get("oklch","lch"),"l"];return ii(t,n,s=>s*(1-e))}var wP=Object.freeze({__proto__:null,darken:SP,lighten:bP});function h4(t,e,r=.5,n={}){return[t,e]=[Cr(t),Cr(e)],Mi(r)==="object"&&([r,n]=[.5,r]),Jc(t,e,n)(r)}function m4(t,e,r={}){let n;D0(t)&&([n,r]=[t,e],[t,e]=n.rangeArgs.colors);let{maxDeltaE:s,deltaEMethod:i,steps:a=2,maxSteps:l=1e3,...c}=r;n||([t,e]=[Cr(t),Cr(e)],n=Jc(t,e,c));let d=Xl(t,e),u=s>0?Math.max(a,Math.ceil(d/s)+1):a,m=[];if(l!==void 0&&(u=Math.min(u,l)),u===1)m=[{p:.5,color:n(.5)}];else{let g=1/(u-1);m=Array.from({length:u},(y,v)=>{let I=v*g;return{p:I,color:n(I)}})}if(s>0){let g=m.reduce((y,v,I)=>{if(I===0)return 0;let S=Xl(v.color,m[I-1].color,i);return Math.max(y,S)},0);for(;g>s;){g=0;for(let y=1;y<m.length&&m.length<l;y++){let v=m[y-1],I=m[y],S=(I.p+v.p)/2,b=n(S);g=Math.max(g,Xl(b,v.color),Xl(b,I.color)),m.splice(y,0,{p:S,color:n(S)}),y++}}}return m=m.map(g=>g.color),m}function Jc(t,e,r={}){if(D0(t)){let[c,d]=[t,e];return Jc(...c.rangeArgs.colors,{...c.rangeArgs.options,...d})}let{space:n,outputSpace:s,progression:i,premultiplied:a}=r;t=Cr(t),e=Cr(e),t=Cl(t),e=Cl(e);let l={colors:[t,e],options:r};if(n?n=qt.get(n):n=qt.registry[$s.interpolationSpace]||t.space,s=s?qt.get(s):n,t=pn(t,n),e=pn(e,n),t=$i(t),e=$i(e),n.coords.h&&n.coords.h.type==="angle"){let c=r.hue=r.hue||"shorter",d=[n,"h"],[u,m]=[Os(t,d),Os(e,d)];isNaN(u)&&!isNaN(m)?u=m:isNaN(m)&&!isNaN(u)&&(m=u),[u,m]=tA(c,[u,m]),ii(t,d,u),ii(e,d,m)}return a&&(t.coords=t.coords.map(c=>c*t.alpha),e.coords=e.coords.map(c=>c*e.alpha)),Object.assign(c=>{c=i?i(c):c;let d=t.coords.map((g,y)=>{let v=e.coords[y];return Ac(g,v,c)}),u=Ac(t.alpha,e.alpha,c),m={space:n,coords:d,alpha:u};return a&&(m.coords=m.coords.map(g=>g/u)),s!==n&&(m=pn(m,s)),m},{rangeArgs:l})}function D0(t){return Mi(t)==="function"&&!!t.rangeArgs}$s.interpolationSpace="lab";function CP(t){t.defineFunction("mix",h4,{returns:"color"}),t.defineFunction("range",Jc,{returns:"function<color>"}),t.defineFunction("steps",m4,{returns:"array<color>"})}var kP=Object.freeze({__proto__:null,isRange:D0,mix:h4,range:Jc,register:CP,steps:m4}),p4=new qt({id:"hsl",name:"HSL",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:Il,fromBase:t=>{let e=Math.max(...t),r=Math.min(...t),[n,s,i]=t,[a,l,c]=[NaN,0,(r+e)/2],d=e-r;if(d!==0){switch(l=c===0||c===1?0:(e-c)/Math.min(c,1-c),e){case n:a=(s-i)/d+(s<i?6:0);break;case s:a=(i-n)/d+2;break;case i:a=(n-s)/d+4}a=a*60}return l<0&&(a+=180,l=Math.abs(l)),a>=360&&(a-=360),[a,l*100,c*100]},toBase:t=>{let[e,r,n]=t;e=e%360,e<0&&(e+=360),r/=100,n/=100;function s(i){let a=(i+e/30)%12,l=r*Math.min(n,1-n);return n-l*Math.max(-1,Math.min(a-3,9-a,1))}return[s(0),s(8),s(4)]},formats:{hsl:{coords:["<number> | <angle>","<percentage>","<percentage>"]},hsla:{coords:["<number> | <angle>","<percentage>","<percentage>"],commas:!0,lastAlpha:!0}}}),f4=new qt({id:"hsv",name:"HSV",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},v:{range:[0,100],name:"Value"}},base:p4,fromBase(t){let[e,r,n]=t;r/=100,n/=100;let s=n+r*Math.min(n,1-n);return[e,s===0?0:200*(1-n/s),100*s]},toBase(t){let[e,r,n]=t;r/=100,n/=100;let s=n*(1-r/2);return[e,s===0||s===1?0:(n-s)/Math.min(s,1-s)*100,s*100]},formats:{color:{id:"--hsv",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}}),IP=new qt({id:"hwb",name:"HWB",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},w:{range:[0,100],name:"Whiteness"},b:{range:[0,100],name:"Blackness"}},base:f4,fromBase(t){let[e,r,n]=t;return[e,n*(100-r)/100,100-n]},toBase(t){let[e,r,n]=t;r/=100,n/=100;let s=r+n;if(s>=1){let l=r/s;return[e,0,l*100]}let i=1-n,a=i===0?0:1-r/i;return[e,a*100,i*100]},formats:{hwb:{coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}});const jP=[[.5766690429101305,.1855582379065463,.1882286462349947],[.29734497525053605,.6273635662554661,.07529145849399788],[.02703136138641234,.07068885253582723,.9913375368376388]],TP=[[2.0415879038107465,-.5650069742788596,-.34473135077832956],[-.9692436362808795,1.8759675015077202,.04155505740717557],[.013444280632031142,-.11836239223101838,1.0151749943912054]];var g4=new Ps({id:"a98rgb-linear",cssId:"--a98-rgb-linear",name:"Linear AdobeÂ® 98 RGB compatible",white:"D65",toXYZ_M:jP,fromXYZ_M:TP}),EP=new Ps({id:"a98rgb",cssId:"a98-rgb",name:"AdobeÂ® 98 RGB compatible",base:g4,toBase:t=>t.map(e=>Math.pow(Math.abs(e),563/256)*Math.sign(e)),fromBase:t=>t.map(e=>Math.pow(Math.abs(e),256/563)*Math.sign(e))});const MP=[[.7977666449006423,.13518129740053308,.0313477341283922],[.2880748288194013,.711835234241873,8993693872564e-17],[0,0,.8251046025104602]],AP=[[1.3457868816471583,-.25557208737979464,-.05110186497554526],[-.5446307051249019,1.5082477428451468,.02052744743642139],[0,0,1.2119675456389452]];var y4=new Ps({id:"prophoto-linear",cssId:"--prophoto-rgb-linear",name:"Linear ProPhoto",white:"D50",base:A0,toXYZ_M:MP,fromXYZ_M:AP});const PP=1/512,NP=16/512;var DP=new Ps({id:"prophoto",cssId:"prophoto-rgb",name:"ProPhoto",base:y4,toBase(t){return t.map(e=>e<NP?e/16:e**1.8)},fromBase(t){return t.map(e=>e>=PP?e**(1/1.8):16*e)}}),RP=new qt({id:"oklch",name:"Oklch",coords:{l:{refRange:[0,1],name:"Lightness"},c:{refRange:[0,.4],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},white:"D65",base:wl,fromBase(t){let[e,r,n]=t,s;const i=2e-4;return Math.abs(r)<i&&Math.abs(n)<i?s=NaN:s=Math.atan2(n,r)*180/Math.PI,[e,Math.sqrt(r**2+n**2),$o(s)]},toBase(t){let[e,r,n]=t,s,i;return isNaN(n)?(s=0,i=0):(s=r*Math.cos(n*Math.PI/180),i=r*Math.sin(n*Math.PI/180)),[e,s,i]},formats:{oklch:{coords:["<percentage> | <number>","<number> | <percentage>[0,1]","<number> | <angle>"]}}});let x4=ps.D65;const OP=216/24389,u1=24389/27,[h1,m1]=fh({space:es,coords:x4});var v4=new qt({id:"luv",name:"Luv",coords:{l:{refRange:[0,100],name:"Lightness"},u:{refRange:[-215,215]},v:{refRange:[-215,215]}},white:x4,base:es,fromBase(t){let e=[_n(t[0]),_n(t[1]),_n(t[2])],r=e[1],[n,s]=fh({space:es,coords:e});if(!Number.isFinite(n)||!Number.isFinite(s))return[0,0,0];let i=r<=OP?u1*r:116*Math.cbrt(r)-16;return[i,13*i*(n-h1),13*i*(s-m1)]},toBase(t){let[e,r,n]=t;if(e===0||Fi(e))return[0,0,0];r=_n(r),n=_n(n);let s=r/(13*e)+h1,i=n/(13*e)+m1,a=e<=8?e/u1:Math.pow((e+16)/116,3);return[a*(9*s/(4*i)),a,a*((12-3*s-20*i)/(4*i))]},formats:{color:{id:"--luv",coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}}),R0=new qt({id:"lchuv",name:"LChuv",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,220],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:v4,fromBase(t){let[e,r,n]=t,s;const i=.02;return Math.abs(r)<i&&Math.abs(n)<i?s=NaN:s=Math.atan2(n,r)*180/Math.PI,[e,Math.sqrt(r**2+n**2),$o(s)]},toBase(t){let[e,r,n]=t;return r<0&&(r=0),isNaN(n)&&(n=0),[e,r*Math.cos(n*Math.PI/180),r*Math.sin(n*Math.PI/180)]},formats:{color:{id:"--lchuv",coords:["<number> | <percentage>","<number> | <percentage>","<number> | <angle>"]}}});const _P=216/24389,FP=24389/27,p1=Bn[0][0],f1=Bn[0][1],jm=Bn[0][2],g1=Bn[1][0],y1=Bn[1][1],Tm=Bn[1][2],x1=Bn[2][0],v1=Bn[2][1],Em=Bn[2][2];function Xa(t,e,r){const n=e/(Math.sin(r)-t*Math.cos(r));return n<0?1/0:n}function Fu(t){const e=Math.pow(t+16,3)/1560896,r=e>_P?e:t/FP,n=r*(284517*p1-94839*jm),s=r*(838422*jm+769860*f1+731718*p1),i=r*(632260*jm-126452*f1),a=r*(284517*g1-94839*Tm),l=r*(838422*Tm+769860*y1+731718*g1),c=r*(632260*Tm-126452*y1),d=r*(284517*x1-94839*Em),u=r*(838422*Em+769860*v1+731718*x1),m=r*(632260*Em-126452*v1);return{r0s:n/i,r0i:s*t/i,r1s:n/(i+126452),r1i:(s-769860)*t/(i+126452),g0s:a/c,g0i:l*t/c,g1s:a/(c+126452),g1i:(l-769860)*t/(c+126452),b0s:d/m,b0i:u*t/m,b1s:d/(m+126452),b1i:(u-769860)*t/(m+126452)}}function b1(t,e){const r=e/360*Math.PI*2,n=Xa(t.r0s,t.r0i,r),s=Xa(t.r1s,t.r1i,r),i=Xa(t.g0s,t.g0i,r),a=Xa(t.g1s,t.g1i,r),l=Xa(t.b0s,t.b0i,r),c=Xa(t.b1s,t.b1i,r);return Math.min(n,s,i,a,l,c)}var VP=new qt({id:"hsluv",name:"HSLuv",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:R0,gamutSpace:Il,fromBase(t){let[e,r,n]=[_n(t[0]),_n(t[1]),_n(t[2])],s;if(e>99.9999999)s=0,e=100;else if(e<1e-8)s=0,e=0;else{let i=Fu(e),a=b1(i,n);s=r/a*100}return[n,s,e]},toBase(t){let[e,r,n]=[_n(t[0]),_n(t[1]),_n(t[2])],s;if(n>99.9999999)n=100,s=0;else if(n<1e-8)n=0,s=0;else{let i=Fu(n);s=b1(i,e)/100*r}return[n,s,e]},formats:{color:{id:"--hsluv",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}});Bn[0][0];Bn[0][1];Bn[0][2];Bn[1][0];Bn[1][1];Bn[1][2];Bn[2][0];Bn[2][1];Bn[2][2];function Qa(t,e){return Math.abs(e)/Math.sqrt(Math.pow(t,2)+1)}function S1(t){let e=Qa(t.r0s,t.r0i),r=Qa(t.r1s,t.r1i),n=Qa(t.g0s,t.g0i),s=Qa(t.g1s,t.g1i),i=Qa(t.b0s,t.b0i),a=Qa(t.b1s,t.b1i);return Math.min(e,r,n,s,i,a)}var $P=new qt({id:"hpluv",name:"HPLuv",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:R0,gamutSpace:"self",fromBase(t){let[e,r,n]=[_n(t[0]),_n(t[1]),_n(t[2])],s;if(e>99.9999999)s=0,e=100;else if(e<1e-8)s=0,e=0;else{let i=Fu(e),a=S1(i);s=r/a*100}return[n,s,e]},toBase(t){let[e,r,n]=[_n(t[0]),_n(t[1]),_n(t[2])],s;if(n>99.9999999)n=100,s=0;else if(n<1e-8)n=0,s=0;else{let i=Fu(n);s=S1(i)/100*r}return[n,s,e]},formats:{color:{id:"--hpluv",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}});const w1=203,C1=2610/2**14,zP=2**14/2610,LP=2523/2**5,k1=2**5/2523,I1=3424/2**12,j1=2413/2**7,T1=2392/2**7;var BP=new Ps({id:"rec2100pq",cssId:"rec2100-pq",name:"REC.2100-PQ",base:ph,toBase(t){return t.map(function(e){return(Math.max(e**k1-I1,0)/(j1-T1*e**k1))**zP*1e4/w1})},fromBase(t){return t.map(function(e){let r=Math.max(e*w1/1e4,0),n=I1+j1*r**C1,s=1+T1*r**C1;return(n/s)**LP})}});const E1=.17883277,M1=.28466892,A1=.55991073,Mm=3.7743;var UP=new Ps({id:"rec2100hlg",cssId:"rec2100-hlg",name:"REC.2100-HLG",referred:"scene",base:ph,toBase(t){return t.map(function(e){return e<=.5?e**2/3*Mm:(Math.exp((e-A1)/E1)+M1)/12*Mm})},fromBase(t){return t.map(function(e){return e/=Mm,e<=1/12?Math.sqrt(3*e):E1*Math.log(12*e-M1)+A1})}});const b4={};Vi.add("chromatic-adaptation-start",t=>{t.options.method&&(t.M=S4(t.W1,t.W2,t.options.method))});Vi.add("chromatic-adaptation-end",t=>{t.M||(t.M=S4(t.W1,t.W2,t.options.method))});function gh({id:t,toCone_M:e,fromCone_M:r}){b4[t]=arguments[0]}function S4(t,e,r="Bradford"){let n=b4[r],[s,i,a]=gn(n.toCone_M,t),[l,c,d]=gn(n.toCone_M,e),u=[[l/s,0,0],[0,c/i,0],[0,0,d/a]],m=gn(u,n.toCone_M);return gn(n.fromCone_M,m)}gh({id:"von Kries",toCone_M:[[.40024,.7076,-.08081],[-.2263,1.16532,.0457],[0,0,.91822]],fromCone_M:[[1.8599363874558397,-1.1293816185800916,.21989740959619328],[.3611914362417676,.6388124632850422,-6370596838649899e-21],[0,0,1.0890636230968613]]});gh({id:"Bradford",toCone_M:[[.8951,.2664,-.1614],[-.7502,1.7135,.0367],[.0389,-.0685,1.0296]],fromCone_M:[[.9869929054667121,-.14705425642099013,.15996265166373122],[.4323052697233945,.5183602715367774,.049291228212855594],[-.00852866457517732,.04004282165408486,.96848669578755]]});gh({id:"CAT02",toCone_M:[[.7328,.4296,-.1624],[-.7036,1.6975,.0061],[.003,.0136,.9834]],fromCone_M:[[1.0961238208355142,-.27886900021828726,.18274517938277307],[.4543690419753592,.4735331543074117,.07209780371722911],[-.009627608738429355,-.00569803121611342,1.0153256399545427]]});gh({id:"CAT16",toCone_M:[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],fromCone_M:[[1.862067855087233,-1.0112546305316845,.14918677544445172],[.3875265432361372,.6214474419314753,-.008973985167612521],[-.01584149884933386,-.03412293802851557,1.0499644368778496]]});Object.assign(ps,{A:[1.0985,1,.35585],C:[.98074,1,1.18232],D55:[.95682,1,.92149],D75:[.94972,1,1.22638],E:[1,1,1],F2:[.99186,1,.67393],F7:[.95041,1,1.08747],F11:[1.00962,1,.6435]});ps.ACES=[.32168/.33767,1,(1-.32168-.33767)/.33767];const GP=[[.6624541811085053,.13400420645643313,.1561876870049078],[.27222871678091454,.6740817658111484,.05368951740793705],[-.005574649490394108,.004060733528982826,1.0103391003129971]],HP=[[1.6410233796943257,-.32480329418479,-.23642469523761225],[-.6636628587229829,1.6153315916573379,.016756347685530137],[.011721894328375376,-.008284441996237409,.9883948585390215]];var w4=new Ps({id:"acescg",cssId:"--acescg",name:"ACEScg",coords:{r:{range:[0,65504],name:"Red"},g:{range:[0,65504],name:"Green"},b:{range:[0,65504],name:"Blue"}},referred:"scene",white:ps.ACES,toXYZ_M:GP,fromXYZ_M:HP});const Id=2**-16,Am=-.35828683,jd=(Math.log2(65504)+9.72)/17.52;var WP=new Ps({id:"acescc",cssId:"--acescc",name:"ACEScc",coords:{r:{range:[Am,jd],name:"Red"},g:{range:[Am,jd],name:"Green"},b:{range:[Am,jd],name:"Blue"}},referred:"scene",base:w4,toBase(t){const e=-.3013698630136986;return t.map(function(r){return r<=e?(2**(r*17.52-9.72)-Id)*2:r<jd?2**(r*17.52-9.72):65504})},fromBase(t){return t.map(function(e){return e<=0?(Math.log2(Id)+9.72)/17.52:e<Id?(Math.log2(Id+e*.5)+9.72)/17.52:(Math.log2(e)+9.72)/17.52})}}),P1=Object.freeze({__proto__:null,A98RGB:EP,A98RGB_Linear:g4,ACEScc:WP,ACEScg:w4,CAM16_JMh:RA,HCT:Nc,HPLuv:$P,HSL:p4,HSLuv:VP,HSV:f4,HWB:IP,ICTCP:af,JzCzHz:of,Jzazbz:KS,LCH:Pc,LCHuv:R0,Lab:_s,Lab_D65:df,Luv:v4,OKLCH:RP,OKLab:wl,P3:c4,P3_Linear:a4,ProPhoto:DP,ProPhoto_Linear:y4,REC_2020:i4,REC_2020_Linear:ph,REC_2100_HLG:UP,REC_2100_PQ:BP,XYZ_ABS_D65:P0,XYZ_D50:A0,XYZ_D65:es,sRGB:Il,sRGB_Linear:l4});let Yr=class Cs{constructor(...e){let r;e.length===1&&(r=Cr(e[0]));let n,s,i;r?(n=r.space||r.spaceId,s=r.coords,i=r.alpha):[n,s,i]=e,Object.defineProperty(this,"space",{value:qt.get(n),writable:!1,enumerable:!0,configurable:!0}),this.coords=s?s.slice():[0,0,0],this.alpha=i>1||i===void 0?1:i<0?0:i;for(let a=0;a<this.coords.length;a++)this.coords[a]==="NaN"&&(this.coords[a]=NaN);for(let a in this.space.coords)Object.defineProperty(this,a,{get:()=>this.get(a),set:l=>this.set(a,l)})}get spaceId(){return this.space.id}clone(){return new Cs(this.space,this.coords,this.alpha)}toJSON(){return{spaceId:this.spaceId,coords:this.coords,alpha:this.alpha}}display(...e){let r=KA(this,...e);return r.color=new Cs(r.color),r}static get(e,...r){return e instanceof Cs?e:new Cs(e,...r)}static defineFunction(e,r,n=r){let{instance:s=!0,returns:i}=n,a=function(...l){let c=r(...l);if(i==="color")c=Cs.get(c);else if(i==="function<color>"){let d=c;c=function(...u){let m=d(...u);return Cs.get(m)},Object.assign(c,d)}else i==="array<color>"&&(c=c.map(d=>Cs.get(d)));return c};e in Cs||(Cs[e]=a),s&&(Cs.prototype[e]=function(...l){return a(this,...l)})}static defineFunctions(e){for(let r in e)Cs.defineFunction(r,e[r],e[r])}static extend(e){if(e.register)e.register(Cs);else for(let r in e)Cs.defineFunction(r,e[r])}};Yr.defineFunctions({get:Os,getAll:qc,set:ii,setAll:M0,to:pn,equals:ZA,inGamut:Pa,toGamut:$i,distance:YS,toString:cc});Object.assign(Yr,{util:YM,hooks:Vi,WHITES:ps,Space:qt,spaces:qt.registry,parse:qS,defaults:$s});for(let t of Object.keys(P1))qt.register(P1[t]);for(let t in qt.registry)uf(t,qt.registry[t]);Vi.add("colorspace-init-end",t=>{var e;uf(t.id,t),(e=t.aliases)==null||e.forEach(r=>{uf(r,t)})});function uf(t,e){let r=t.replace(/-/g,"_");Object.defineProperty(Yr.prototype,r,{get(){let n=this.getAll(t);return typeof Proxy>"u"?n:new Proxy(n,{has:(s,i)=>{try{return qt.resolveCoord([e,i]),!0}catch{}return Reflect.has(s,i)},get:(s,i,a)=>{if(i&&typeof i!="symbol"&&!(i in s)){let{index:l}=qt.resolveCoord([e,i]);if(l>=0)return s[l]}return Reflect.get(s,i,a)},set:(s,i,a,l)=>{if(i&&typeof i!="symbol"&&!(i in s)||i>=0){let{index:c}=qt.resolveCoord([e,i]);if(c>=0)return s[c]=a,this.setAll(t,s),!0}return Reflect.set(s,i,a,l)}})},set(n){this.setAll(t,n)},configurable:!0,enumerable:!0})}Yr.extend(kl);Yr.extend({deltaE:Xl});Object.assign(Yr,{deltaEMethods:kl});Yr.extend(wP);Yr.extend({contrast:yP});Yr.extend(vP);Yr.extend(QA);Yr.extend(kP);Yr.extend(Ld);function qP(t){const{r:e,g:r,b:n}=t,s=Math.max(e,r,n),i=Math.min(e,r,n),a=s-i,l=(s+i)/2*100;if(a===0)return{h:0,s:0,l};const c=l>50?a/(2-s-i)*100:a/(s+i)*100;let d;return s===e?d=(r-n)/a%6:s===r?d=(n-e)/a+2:d=(e-r)/a+4,d=d*60,d<0&&(d+=360),{h:d,s:c,l}}function JP(t){const{h:e,s:r,l:n}=t,s=e/360,i=r/100,a=n/100;if(i===0)return{r:a,g:a,b:a};const l=(y,v,I)=>(I<0&&(I+=1),I>1&&(I-=1),I<1/6?y+(v-y)*6*I:I<1/2?v:I<2/3?y+(v-y)*(2/3-I)*6:y),c=a<.5?a*(1+i):a+i-a*i,d=2*a-c,u=l(d,c,s+1/3),m=l(d,c,s),g=l(d,c,s-1/3);return{r:u,g:m,b:g}}function jl(t){const e=JP(t);return new Yr("p3",[e.r,e.g,e.b])}function _l(t){const e=t.to("p3"),[r,n,s]=e.coords;return qP({r,g:n,b:s})}const Pm=new Map,Fl=(t,e)=>{const r=`${t}-${e}`;if(Pm.has(r))return Pm.get(r);let n;switch(t){case"sRGB":e==="polar"?n={id:"hsl",channels:["h","s","l"],defaultChannels:["s","l"],thirdChannel:"h"}:n={id:"srgb",channels:["r","g","b"],defaultChannels:["r","g"],thirdChannel:"b"};break;case"Display P3":e==="polar"?n={id:"p3-hsl",channels:["h","s","l"],defaultChannels:["s","l"],thirdChannel:"h"}:n={id:"p3",channels:["r","g","b"],defaultChannels:["r","g"],thirdChannel:"b"};break;case"OKlch":e==="polar"?n={id:"oklch",channels:["l","c","h"],defaultChannels:["c","h"],thirdChannel:"l"}:n={id:"oklab",channels:["l","a","b"],defaultChannels:["a","b"],thirdChannel:"l"};break;default:n={id:"srgb",channels:["r","g","b"],defaultChannels:["r","g"],thirdChannel:"b"}}return Pm.set(r,n),n},Nm=new Map,zn=(t,e)=>{const r=`${e}-${t}`;if(Nm.has(r))return Nm.get(r);let n;switch(e){case"hsl":t==="h"?n={min:0,max:360}:t==="s"||t==="l"?n={min:0,max:100}:n={min:0,max:1};break;case"p3-hsl":t==="h"?n={min:0,max:360}:t==="s"||t==="l"?n={min:0,max:100}:n={min:0,max:1};break;case"oklch":t==="l"?n={min:0,max:1}:t==="c"?n={min:0,max:.26}:t==="h"?n={min:0,max:360}:n={min:0,max:1};break;case"oklab":t==="l"?n={min:0,max:1}:t==="a"?n={min:-.13,max:.2}:t==="b"?n={min:-.28,max:.1}:n={min:0,max:1};break;default:n={min:0,max:1}}return Nm.set(r,n),n},Dc=t=>{switch(t){case"sRGB":return"srgb";case"Display-P3":return"p3";case"Rec2020":return"rec2020";default:return"srgb"}},YP=(t,e,r)=>{try{const s=new Yr(e,t).to(r),[i,a,l]=s.coords;return i<0||i>1||a<0||a>1||l<0||l>1}catch{return!0}},C4=(t,e)=>{try{let r;switch(e){case"display-p3":r=t.to("p3");break;case"srgb":default:r=t.to("srgb");break}const[n,s,i]=r.coords.map(l=>Math.max(0,Math.min(1,l))),a=Math.max(0,Math.min(1,r.alpha??1));return[Math.round(n*255),Math.round(s*255),Math.round(i*255),Math.round(a*255)]}catch{const n=t.to("srgb"),[s,i,a]=n.coords.map(c=>Math.max(0,Math.min(1,c))),l=Math.max(0,Math.min(1,n.alpha??1));return[Math.round(s*255),Math.round(i*255),Math.round(a*255),Math.round(l*255)]}},el=(t,e,r,n,s,i,a,l)=>{const c=Fl(s,i),d=a||c.defaultChannels,[u,m]=d;if(!c.channels.includes(u)||!c.channels.includes(m))throw new Error(`Invalid channels [${u}, ${m}] for color space ${s} and model ${i}`);if(c.id==="p3-hsl"){const P=_l(n),_=t/r,R=(r-e)/r,G=zn(u,c.id),ne=zn(m,c.id),he={...P};u==="h"?he.h=G.min+_*(G.max-G.min):u==="s"?he.s=G.min+_*(G.max-G.min):u==="l"&&(he.l=G.min+_*(G.max-G.min)),m==="h"?he.h=ne.min+R*(ne.max-ne.min):m==="s"?he.s=ne.min+R*(ne.max-ne.min):m==="l"&&(he.l=ne.min+R*(ne.max-ne.min));const te=jl(he),K=Dc(l);return te.inGamut(K)?te:te.toGamut({space:K})}const y=[...n.to(c.id).coords],v=t/r,I=(r-e)/r,S=c.channels.indexOf(u),b=c.channels.indexOf(m),k=zn(u,c.id),A=zn(m,c.id);y[S]=k.min+v*(k.max-k.min),y[b]=A.min+I*(A.max-A.min);const C=new Yr(c.id,y),T=Dc(l);return C.inGamut(T)?C:C.toGamut({space:T})},KP=(t,e,r,n,s)=>{const i=Fl(r,n),a=s||i.defaultChannels,[l,c]=a;if(i.id==="p3-hsl"){const T=_l(t),P=zn(l,i.id),_=zn(c,i.id);let R,G;if(l==="h"?R=T.h:l==="s"?R=T.s:l==="l"?R=T.l:R=0,c==="h"?G=T.h:c==="s"?G=T.s:c==="l"?G=T.l:G=0,n==="polar")if(l==="h"){const O=(R%360+360)%360/360,Z=(G-_.min)/(_.max-_.min);return{x:O*e,y:(1-Z)*e}}else if(c==="h"){const O=(R-P.min)/(P.max-P.min),Z=(G%360+360)%360/360;return{x:O*e,y:(1-Z)*e}}else{const O=(R-P.min)/(P.max-P.min),Z=(G-_.min)/(_.max-_.min);return{x:O*e,y:(1-Z)*e}}const ne=(R-P.min)/(P.max-P.min),he=(G-_.min)/(_.max-_.min),te=Math.max(0,Math.min(1,ne)),K=Math.max(0,Math.min(1,he));return{x:te*e,y:(1-K)*e}}const u=t.to(i.id).coords,m=i.channels.indexOf(l),g=i.channels.indexOf(c),y=u[m]||0,v=u[g]||0,I=zn(l,i.id),S=zn(c,i.id);if(n==="polar")if(l==="h"){const T=(y%360+360)%360/360,P=(v-S.min)/(S.max-S.min);return{x:T*e,y:(1-P)*e}}else if(c==="h"){const T=(y-I.min)/(I.max-I.min),P=(v%360+360)%360/360;return{x:T*e,y:(1-P)*e}}else{const T=(y-I.min)/(I.max-I.min),P=(v-S.min)/(S.max-S.min);return{x:T*e,y:(1-P)*e}}const b=(y-I.min)/(I.max-I.min),k=(v-S.min)/(S.max-S.min),A=Math.max(0,Math.min(1,b)),C=Math.max(0,Math.min(1,k));return{x:A*e,y:(1-C)*e}},tl=(t,e,r,n,s,i,a,l)=>{const c=Fl(s,i),d=a||c.defaultChannels,[u,m]=d;if(!c.channels.includes(u)||!c.channels.includes(m))throw new Error(`Invalid channels [${u}, ${m}] for color space ${s} and model ${i}`);if(c.id==="p3-hsl"){const he=_l(n),te=t/r,K=(r-e)/r,O=zn(u,c.id),Z=zn(m,c.id),ie={...he};u==="h"?ie.h=O.min+te*(O.max-O.min):u==="s"?ie.s=O.min+te*(O.max-O.min):u==="l"&&(ie.l=O.min+te*(O.max-O.min)),m==="h"?ie.h=Z.min+K*(Z.max-Z.min):m==="s"?ie.s=Z.min+K*(Z.max-Z.min):m==="l"&&(ie.l=Z.min+K*(Z.max-Z.min));const ge=jl(ie),xe=Dc(l);if(ge.inGamut(xe))return{x:t,y:e};const $=Math.max(r,r)*.5,B=16,U=12;let X={x:t,y:e},ee=1/0;for(let be=0;be<B;be++){const Se=be/B*2*Math.PI;let Me=0,se=$,de=0;for(;de<U&&se-Me>1;){const fe=(Me+se)/2,_e=t+Math.cos(Se)*fe,Y=e+Math.sin(Se)*fe,Ce=Math.max(0,Math.min(r,_e)),ue=Math.max(0,Math.min(r,Y)),Ee=Ce/r,ze=(r-ue)/r,De={...he};if(u==="h"?De.h=O.min+Ee*(O.max-O.min):u==="s"?De.s=O.min+Ee*(O.max-O.min):u==="l"&&(De.l=O.min+Ee*(O.max-O.min)),m==="h"?De.h=Z.min+ze*(Z.max-Z.min):m==="s"?De.s=Z.min+ze*(Z.max-Z.min):m==="l"&&(De.l=Z.min+ze*(Z.max-Z.min)),jl(De).inGamut(xe)){se=fe;const Te=Math.sqrt(Math.pow(Ce-t,2)+Math.pow(ue-e,2));Te<ee&&(ee=Te,X={x:Ce,y:ue})}else Me=fe;de++}}return ee===1/0?{x:r/2,y:r/2}:X}const y=[...n.to(c.id).coords],v=t/r,I=(r-e)/r,S=c.channels.indexOf(u),b=c.channels.indexOf(m),k=zn(u,c.id),A=zn(m,c.id);y[S]=k.min+v*(k.max-k.min),y[b]=A.min+I*(A.max-A.min);const C=Dc(l);if(new Yr(c.id,y).inGamut(C))return{x:t,y:e};const P=Math.max(r,r)*.5,_=16,R=12;let G={x:t,y:e},ne=1/0;for(let he=0;he<_;he++){const te=he/_*2*Math.PI;let K=0,O=P,Z=0;for(;Z<R&&O-K>1;){const ie=(K+O)/2,ge=t+Math.cos(te)*ie,xe=e+Math.sin(te)*ie,$=Math.max(0,Math.min(r,ge)),B=Math.max(0,Math.min(r,xe)),U=$/r,X=(r-B)/r,ee=[...y];if(ee[S]=k.min+U*(k.max-k.min),ee[b]=A.min+X*(A.max-A.min),new Yr(c.id,ee).inGamut(C)){O=ie;const Me=Math.sqrt(Math.pow($-t,2)+Math.pow(B-e,2));Me<ne&&(ne=Me,G={x:$,y:B})}else K=ie;Z++}}return ne===1/0?{x:r/2,y:r/2}:G},Dm=(t,e,r,n)=>{try{if(e.id==="p3-hsl"){const i={..._l(t)};return r==="h"?i.h=n:r==="s"?i.s=n:r==="l"&&(i.l=n),jl(i)}else{const i=[...t.to(e.id).coords],a=e.channels.indexOf(r);return i[a]=n,new Yr(e.id,i)}}catch(s){return console.warn("Error creating color with channel value:",s),t}},k4=M.memo(({size:t,colorSpace:e="sRGB",model:r="cartesian",colorChannels:n,color:s,gamut:i="Display-P3",className:a,"data-testid":l,...c})=>{const{colorMode:d}=Vt(),u=Fl(e,r),m=n||u.defaultChannels,g=M.useRef(null),y=M.useRef(0),v=M.useMemo(()=>{try{if(u.id==="p3-hsl"){const b=_l(s),k=u.thirdChannel;return b[k]}else{const b=s.to(u.id),k=u.channels.indexOf(u.thirdChannel);return b.coords[k]||0}}catch(b){return console.warn("Error extracting third channel value:",b),0}},[s.toString(),u.id,u.channels,u.thirdChannel]),I=M.useMemo(()=>{try{if(u.id==="p3-hsl"){const A={h:0,s:0,l:0},C=u.thirdChannel;return C==="h"?A.h=v:C==="s"?A.s=v:C==="l"&&(A.l=v),jl(A)}const b=[...u.channels.map(()=>0)],k=u.channels.indexOf(u.thirdChannel);return b[k]=v,new Yr(u.id,b)}catch(b){return console.warn("Error creating base color for rendering:",b),new Yr("srgb",[0,0,0])}},[u.id,u.channels,u.thirdChannel,v]),S=M.useCallback(()=>{const b=g.current;if(!b)return;let k=b.getContext("2d",{colorSpace:"display-p3",willReadFrequently:!1});if(!k&&(k=b.getContext("2d"),!k))return;const A=performance.now();b.width=t,b.height=t,k.clearRect(0,0,t,t);const C=k.createImageData(t,t),T=C.data,P=k.colorSpace||"srgb",[_,R]=m;if(!u.channels.includes(_)||!u.channels.includes(R)){console.warn(`ColorCanvas: Invalid channels [${_}, ${R}] for color space ${e} and model ${r}`);return}for(let ne=0;ne<t;ne++)for(let he=0;he<t;he++){const te=(ne*t+he)*4;let K;try{if(u.id==="p3-hsl"){const B=he/t,U=(t-ne)/t,X=zn(_,u.id),ee=zn(R,u.id),be={h:0,s:0,l:0},Se=u.thirdChannel;Se==="h"?be.h=v:Se==="s"?be.s=v:Se==="l"&&(be.l=v),_==="h"?be.h=X.min+B*(X.max-X.min):_==="s"?be.s=X.min+B*(X.max-X.min):_==="l"&&(be.l=X.min+B*(X.max-X.min)),R==="h"?be.h=ee.min+U*(ee.max-ee.min):R==="s"?be.s=ee.min+U*(ee.max-ee.min):R==="l"&&(be.l=ee.min+U*(ee.max-ee.min)),K=jl(be)}else{const U=[...I.to(u.id).coords],X=he/t,ee=(t-ne)/t,be=u.channels.indexOf(_),Se=u.channels.indexOf(R),Me=zn(_,u.id),se=zn(R,u.id);U[be]=Me.min+X*(Me.max-Me.min),U[Se]=se.min+ee*(se.max-se.min),K=new Yr(u.id,U)}const O=Dc(i);YP(K.coords,K.space.id,O)&&(d==="dark"?K=new Yr("srgb",[.10196078431372549,.12549019607843137,.17254901960784313]):K=new Yr("srgb",[.8862745098039215,.9098039215686274,.9411764705882353]));const[ie,ge,xe,$]=C4(K,P);T[te]=ie,T[te+1]=ge,T[te+2]=xe,T[te+3]=$}catch{d==="dark"?(T[te]=26,T[te+1]=32,T[te+2]=44,T[te+3]=255):(T[te]=226,T[te+1]=232,T[te+2]=240,T[te+3]=255)}}k.putImageData(C,0,0);const G=performance.now();y.current=G-A,y.current>16&&console.warn(`ColorCanvas: Rendering took ${y.current.toFixed(2)}ms (target: <16ms for 60fps)`)},[t,e,r,m,i,u,d,I]);return M.useEffect(()=>{S()},[S]),o.jsx(z,{as:"div",position:"relative",display:"inline-block",className:a,"data-testid":l,...c,children:o.jsx("canvas",{ref:g,width:t,height:t,style:{display:"block",cursor:"crosshair",borderRadius:"12px",border:"1px solid rgba(0, 0, 0, 0.1)"},"data-testid":`${l}-canvas`})})});k4.displayName="ColorCanvas";const I4=M.memo(({color:t,isVisible:e=!1,className:r,style:n,"data-testid":s,...i})=>{const a=t.toString({format:"hex"});return o.jsx(z,{as:"div",position:"absolute",width:"38px",height:"48px",className:r,style:n,"data-testid":s,transform:e?"translate(0, 0)":"translate(0, 16px)",opacity:e?1:0,transformOrigin:"bottom center",marginTop:"-48px",marginLeft:"-19px",transition:"transform 100ms ease-in-out, opacity 125ms ease-in-out",pointerEvents:"none",zIndex:e?2:0,...i,children:o.jsx("svg",{width:"38",height:"48",viewBox:"0 0 38 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{filter:"drop-shadow(0 1px 1px rgba(0, 0, 0, 0.3)) drop-shadow(0 0 1px rgba(0, 0, 0, 0.3))"},"data-testid":`${s}-svg`,children:o.jsx("path",{d:"M35 19C35 33.2507 19 45 19 45C19 45 3 33.2507 3 19C3 10.1634 10.1634 3 19 3C27.8366 3 35 10.1634 35 19Z",fill:a,stroke:"white",strokeWidth:"2","data-testid":`${s}-path`})})})});I4.displayName="ColorLoupe";const O0=M.memo(({color:t,isLoupeVisible:e=!1,autoShowLoupe:r=!0,onPointerDown:n,onPointerMove:s,onPointerUp:i,onPointerLeave:a,onKeyDown:l,className:c,"data-testid":d,...u})=>{const m=t.toString({format:"hex"}),[g,y]=M.useState(!1),[v,I]=M.useState(!1),S=e||r&&(g||v),b=M.useCallback(()=>{y(!0)},[]),k=M.useCallback(()=>{y(!1)},[]),A=M.useCallback(()=>{I(!0)},[]),C=M.useCallback(()=>{I(!1)},[]),T=M.useCallback(()=>{I(!1)},[]);return o.jsxs(z,{as:"div",position:"relative",width:"16px",height:"16px",className:c,"data-testid":d,tabIndex:0,onFocus:b,onBlur:k,onKeyDown:l,...u,children:[o.jsx(z,{as:"div",width:"100%",height:"100%",backgroundColor:m,border:"2px solid white",borderRadius:"50%",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.4)",position:"relative","data-testid":`${d}-handle`,onMouseDown:A,onMouseUp:C,onMouseLeave:T,onPointerDown:n,onPointerMove:s,onPointerUp:i,onPointerLeave:a,_focus:{outline:"2px solid #007AFF",outlineOffset:"2px"},_active:{transform:"scale(0.95)",transition:"transform 0.1s ease-in-out"}}),o.jsx(I4,{style:{pointerEvents:"none",zIndex:1e3,left:"8px",bottom:"20px"},color:t,isVisible:S,"data-testid":`${d}-loupe`})]})});O0.displayName="ColorHandle";const j4=M.memo(({size:t=200,colorSpace:e="sRGB",model:r="cartesian",colorChannels:n,color:s,gamut:i="Display-P3",onChange:a,className:l,"data-testid":c,...d})=>{const u=Fl(e,r),m=n||u.defaultChannels,[g,y]=M.useState(!1),[v,I]=M.useState(null),[S,b]=M.useState(null),k=M.useRef(null),A=M.useRef(null),C=M.useMemo(()=>{if(g&&v)try{return tl(v.x,v.y,t,s,e,r,m,i)}catch(O){return console.warn("Error constraining drag position to gamut:",O),v}try{const O=KP(s,t,e,r,m);return tl(O.x,O.y,t,s,e,r,m,i)}catch(O){return console.warn("Error calculating handle position:",O),{x:t/2,y:t/2}}},[s,e,r,m,t,g,v,i]),T=M.useMemo(()=>g&&S?S:s,[g,S,s]),P=M.useCallback(O=>{a&&a(O)},[a]),_=M.useCallback(O=>{const Z=O.currentTarget.getBoundingClientRect(),ie=O.clientX-Z.left,ge=O.clientY-Z.top,xe=Math.max(0,Math.min(t,ie)),$=Math.max(0,Math.min(t,ge));try{const B=tl(xe,$,t,s,e,r,m,i);I(B),y(!0),k.current=B,O.currentTarget.setPointerCapture(O.pointerId)}catch(B){console.warn("Error constraining canvas interaction to gamut:",B),I({x:xe,y:$}),y(!0),k.current={x:xe,y:$},O.currentTarget.setPointerCapture(O.pointerId)}},[t,s,e,r,m,i]),R=M.useCallback(O=>{const Z=O.currentTarget.getBoundingClientRect(),ie=O.clientX-Z.left,ge=O.clientY-Z.top,xe=Math.max(0,Math.min(t,ie)),$=Math.max(0,Math.min(t,ge));try{const B=tl(xe,$,t,s,e,r,m,i);I(B);const U=el(B.x,B.y,t,s,e,r,m,i);b(U)}catch(B){console.warn("Error constraining canvas drag to gamut:",B),I({x:xe,y:$});try{const U=el(xe,$,t,s,e,r,m,i);b(U)}catch(U){console.error("Error calculating drag color:",U)}}},[t,s,e,r,m,i]),G=M.useCallback(O=>{O.stopPropagation(),y(!0),O.currentTarget.setPointerCapture(O.pointerId)},[]),ne=M.useCallback(O=>{if(!g||!A.current)return;const Z=A.current.getBoundingClientRect(),ie=O.clientX-Z.left,ge=O.clientY-Z.top,xe=Math.max(0,Math.min(t,ie)),$=Math.max(0,Math.min(t,ge));try{const B=tl(xe,$,t,s,e,r,m,i);I(B);const U=el(B.x,B.y,t,s,e,r,m,i);b(U)}catch(B){console.error("Error constraining handle drag to gamut:",B),I({x:xe,y:$});try{const U=el(xe,$,t,s,e,r,m,i);b(U)}catch(U){console.error("Error calculating drag color:",U)}}},[g,t,s,e,r,m,i]),he=M.useCallback(()=>{if(g&&v&&a)try{const O=el(v.x,v.y,t,s,e,r,m,i);a(O)}catch(O){console.error("Error creating color from drag position:",O)}y(!1),I(null),b(null),k.current=null},[g,v,a,t,e,r,m,i,s]),te=M.useCallback(()=>{g&&he()},[g,he]),K=M.useCallback(O=>{if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(O.key))return;O.preventDefault(),O.stopPropagation();const Z=C.x,ie=C.y,ge=O.shiftKey?10:1;let xe=Z,$=ie;switch(O.key){case"ArrowUp":$=Math.max(0,ie-ge);break;case"ArrowDown":$=Math.min(t,ie+ge);break;case"ArrowLeft":xe=Math.max(0,Z-ge);break;case"ArrowRight":xe=Math.min(t,Z+ge);break}try{const B=tl(xe,$,t,s,e,r,m,i);I(B);const U=el(B.x,B.y,t,s,e,r,m,i);b(U),a&&a(U)}catch(B){console.warn("Error handling keyboard navigation:",B)}},[C,t,s,e,r,m,i,a]);return M.useEffect(()=>{if(g)return document.addEventListener("mousemove",ne),document.addEventListener("mouseup",te),()=>{document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",te)}},[g,ne,te]),M.useEffect(()=>{var $;const O=($=A.current)==null?void 0:$.querySelector("canvas");if(!O)return;const Z=B=>{_(B)},ie=B=>{R(B)},ge=()=>{he()},xe=()=>{he()};return O.addEventListener("pointerdown",Z),O.addEventListener("pointermove",ie),O.addEventListener("pointerup",ge),O.addEventListener("pointerleave",xe),()=>{O.removeEventListener("pointerdown",Z),O.removeEventListener("pointermove",ie),O.removeEventListener("pointerup",ge),O.removeEventListener("pointerleave",xe)}},[_,R,he]),o.jsxs(z,{ref:A,as:"div",position:"relative",width:`${t}px`,height:`${t}px`,className:l,"data-testid":c,...d,children:[o.jsx(k4,{size:t,colorSpace:e,model:r,colorChannels:n,color:s,gamut:i,onChange:P,"data-testid":`${c}-canvas`}),o.jsx(O0,{color:T,isLoupeVisible:g,autoShowLoupe:!0,onPointerDown:G,onKeyDown:K,style:{position:"absolute",left:`${C.x}px`,top:`${C.y}px`,transform:"translate(-50%, -50%)",pointerEvents:"auto",zIndex:10},"data-testid":`${c}-handle`})]})});j4.displayName="ColorArea";const T4=M.memo(({size:t=200,orientation:e="horizontal",colorSpace:r="sRGB",model:n="cartesian",channel:s,color:i,gamut:a="Display-P3",onChange:l,className:c,"data-testid":d,...u})=>{const{colorMode:m}=Vt(),g=Fl(r,n);g.channels.includes(s)||console.warn(`ColorSlider: Channel '${s}' not available in color space '${r}' with model '${n}'`);const[y,v]=M.useState(!1),[I,S]=M.useState(null),[b,k]=M.useState(null),A=M.useRef(null),C=M.useRef(null),T=M.useRef(null),P=M.useRef(0),_=M.useMemo(()=>{try{return Dm(i,g,s,0)}catch(B){return console.warn("Error creating base color for rendering:",B),new Yr("srgb",[0,0,0])}},[i,g,s]),R=M.useCallback(()=>{const B=T.current;if(!B)return;let U=B.getContext("2d",{colorSpace:"display-p3",willReadFrequently:!1});if(!U&&(U=B.getContext("2d"),!U))return;const X=performance.now();e==="horizontal"?(B.width=t,B.height=24):(B.width=24,B.height=t),U.clearRect(0,0,B.width,B.height);const ee=U.createImageData(B.width,B.height),be=ee.data,Se=U.colorSpace||"srgb";for(let se=0;se<B.height;se++)for(let de=0;de<B.width;de++){const fe=(se*B.width+de)*4;try{let _e;e==="horizontal"?_e=de/B.width:_e=(B.height-se)/B.height;const Y=zn(s,g.id),Ce=Y.min+_e*(Y.max-Y.min),ue=Dm(_,g,s,Ce),[Ee,ze,De,Ke]=C4(ue,Se);be[fe]=Ee,be[fe+1]=ze,be[fe+2]=De,be[fe+3]=Ke}catch{m==="dark"?(be[fe]=26,be[fe+1]=32,be[fe+2]=44,be[fe+3]=255):(be[fe]=226,be[fe+1]=232,be[fe+2]=240,be[fe+3]=255)}}U.putImageData(ee,0,0);const Me=performance.now();P.current=Me-X,P.current>16&&console.warn(`ColorSlider: Rendering took ${P.current.toFixed(2)}ms (target: <16ms for 60fps)`)},[t,e,r,n,s,a,g,m,_]),G=M.useMemo(()=>{if(y&&I!==null)return I;try{let B;if(g.id==="p3-hsl"){const be=_l(i);s==="h"?B=be.h:s==="s"?B=be.s:s==="l"?B=be.l:B=0}else{const be=i.to(g.id),Se=g.channels.indexOf(s);B=be.coords[Se]||0}const U=zn(s,g.id),X=(B-U.min)/(U.max-U.min);let ee;return e==="horizontal"?ee=X*t:ee=(1-X)*t,Math.max(0,Math.min(t,ee))}catch(B){return console.warn("Error calculating handle position:",B),t/2}},[i,g.id,g.channels,s,t,e,y,I]),ne=M.useMemo(()=>y&&b?b:i,[y,b,i]),he=M.useCallback(B=>{try{let U;e==="horizontal"?U=B/t:U=1-B/t;const X=zn(s,g.id),ee=X.min+U*(X.max-X.min);return Dm(_,g,s,ee)}catch(U){return console.warn("Error converting canvas position to color:",U),i}},[t,e,g,s,_,i]),te=M.useCallback(B=>{const U=B.currentTarget.getBoundingClientRect();let X;e==="horizontal"?X=B.clientX-U.left:X=B.clientY-U.top;const ee=Math.max(0,Math.min(t,X));S(ee),v(!0),A.current=ee,B.currentTarget.setPointerCapture(B.pointerId)},[t,e]),K=M.useCallback(B=>{const U=B.currentTarget.getBoundingClientRect();let X;e==="horizontal"?X=B.clientX-U.left:X=B.clientY-U.top;const ee=Math.max(0,Math.min(t,X));S(ee);const be=he(ee);k(be)},[t,e,he]),O=M.useCallback(B=>{B.stopPropagation(),v(!0),B.currentTarget.setPointerCapture(B.pointerId)},[]),Z=M.useCallback(B=>{if(!y||!C.current)return;const U=C.current.getBoundingClientRect();let X;e==="horizontal"?X=B.clientX-U.left:X=B.clientY-U.top;const ee=Math.max(0,Math.min(t,X));S(ee);const be=he(ee);k(be)},[y,t,e,he]),ie=M.useCallback(()=>{if(y&&I!==null&&l)try{const B=he(I);l(B)}catch(B){console.error("Error creating color from drag position:",B)}v(!1),S(null),k(null),A.current=null},[y,I,l,he]),ge=M.useCallback(()=>{y&&ie()},[y,ie]),xe=M.useCallback(B=>{if(!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(B.key))return;B.preventDefault(),B.stopPropagation();const X=G,ee=B.shiftKey?10:1;let be=X;if(e==="horizontal")switch(B.key){case"ArrowLeft":be=Math.max(0,X-ee);break;case"ArrowRight":be=Math.min(t,X+ee);break;default:return}else switch(B.key){case"ArrowUp":be=Math.max(0,X-ee);break;case"ArrowDown":be=Math.min(t,X+ee);break;default:return}S(be);const Se=he(be);k(Se),l&&l(Se)},[G,t,e,he,l]);M.useEffect(()=>{if(y)return document.addEventListener("mousemove",Z),document.addEventListener("mouseup",ge),()=>{document.removeEventListener("mousemove",Z),document.removeEventListener("mouseup",ge)}},[y,Z,ge]),M.useEffect(()=>{var Se;const B=(Se=C.current)==null?void 0:Se.querySelector("canvas");if(!B)return;const U=Me=>{te(Me)},X=Me=>{K(Me)},ee=()=>{ie()},be=()=>{ie()};return B.addEventListener("pointerdown",U),B.addEventListener("pointermove",X),B.addEventListener("pointerup",ee),B.addEventListener("pointerleave",be),()=>{B.removeEventListener("pointerdown",U),B.removeEventListener("pointermove",X),B.removeEventListener("pointerup",ee),B.removeEventListener("pointerleave",be)}},[te,K,ie]),M.useEffect(()=>{R()},[R]);const $=M.useMemo(()=>{const B={position:"absolute",transform:"translate(-50%, -50%)",pointerEvents:"auto",zIndex:10};return e==="horizontal"?{...B,left:`${G}px`,top:"11px"}:{...B,left:"13px",top:`${G}px`}},[G,e]);return o.jsxs(z,{ref:C,as:"div",position:"relative",width:e==="horizontal"?`${t}px`:"24px",height:e==="horizontal"?"24px":`${t}px`,className:c,"data-testid":d,tabIndex:0,onKeyDown:xe,...u,children:[o.jsx("canvas",{ref:T,width:e==="horizontal"?t:24,height:e==="horizontal"?24:t,style:{display:"block",cursor:"crosshair",borderRadius:"12px",border:"1px solid rgba(0, 0, 0, 0.1)"},"data-testid":`${d}-canvas`}),o.jsx(O0,{color:ne,isLoupeVisible:y,autoShowLoupe:!0,onPointerDown:O,onKeyDown:xe,style:$,"data-testid":`${d}-handle`})]})});T4.displayName="ColorSlider";const E4=nr.memo(({color:t,onChange:e,gamut:r="Display-P3",showGamutPicker:n=!0,className:s,"data-testid":i="color-picker-contents",...a})=>{const[l,c]=M.useState(()=>{try{return new Yr(t)}catch(T){return console.warn("Invalid initial color, using black:",T),new Yr("srgb",[0,0,0])}}),[d,u]=M.useState("sRGB"),[m,g]=M.useState(r),[y,v]=M.useState("cartesian"),I=M.useCallback(T=>{c(T),e&&e(T)},[e]),S=M.useMemo(()=>d==="OKlch"&&y==="polar"?["c","h"]:d==="OKlch"&&y==="cartesian"?["a","b"]:d==="sRGB"&&y==="polar"?["s","l"]:d==="Display P3"&&y==="polar"?["s","l"]:d==="Display P3"&&y==="cartesian"?["r","g"]:["r","g"],[d,y]),b=M.useMemo(()=>d==="OKlch"?"l":d==="sRGB"&&y==="polar"||d==="Display P3"&&y==="polar"?"h":"b",[d,y]),k=M.useCallback(T=>{const P=T.target.value;u(P)},[]),A=M.useCallback(T=>{const P=T.target.value;g(P)},[]),C=M.useCallback(T=>{v(T)},[]);return o.jsx(z,{as:"div",className:s,"data-testid":i,...a,children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(le,{spacing:3,justify:"space-between",children:[o.jsxs(ce,{spacing:1,align:"start",flex:1,children:[o.jsx(E,{fontSize:"xs",fontWeight:"medium",children:"Color Space"}),o.jsxs(Kt,{size:"xs",value:d,onChange:k,"data-testid":`${i}-color-space-select`,children:[o.jsx("option",{value:"sRGB",children:"sRGB"}),o.jsx("option",{value:"Display P3",children:"Display P3"}),o.jsx("option",{value:"OKlch",children:"OKLCH"})]})]}),n&&o.jsxs(ce,{spacing:1,align:"start",flex:1,children:[o.jsx(E,{fontSize:"xs",fontWeight:"medium",children:"Gamut"}),o.jsxs(Kt,{size:"xs",value:m,onChange:A,"data-testid":`${i}-gamut-select`,children:[o.jsx("option",{value:"sRGB",children:"sRGB"}),o.jsx("option",{value:"Display-P3",children:"Display P3"}),o.jsx("option",{value:"Rec2020",children:"Rec2020"})]})]}),o.jsxs(ce,{spacing:1,align:"start",children:[o.jsx(E,{fontSize:"xs",fontWeight:"medium",children:"Model"}),o.jsxs(Lw,{size:"xs",isAttached:!0,children:[o.jsx(Oe,{variant:y==="cartesian"?"solid":"outline",onClick:()=>C("cartesian"),"data-testid":`${i}-cartesian-toggle`,colorScheme:y==="cartesian"?"blue":"gray",children:o.jsx(LC,{size:14})}),o.jsx(Oe,{variant:y==="polar"?"solid":"outline",onClick:()=>C("polar"),"data-testid":`${i}-polar-toggle`,colorScheme:y==="polar"?"blue":"gray",children:o.jsx(u6,{size:14})})]})]})]}),o.jsxs(le,{spacing:4,align:"start",children:[o.jsxs(z,{children:[o.jsxs(E,{fontSize:"sm",fontWeight:"medium",mb:2,children:["Color Area (",S[0]," Ã— ",S[1],")"]}),o.jsx(j4,{size:200,colorSpace:d,model:y,colorChannels:S,color:l,gamut:m,onChange:I,"data-testid":`${i}-color-area`})]}),o.jsxs(z,{children:[o.jsxs(E,{fontSize:"sm",fontWeight:"medium",mb:2,children:[b.toUpperCase()," Channel"]}),o.jsx(T4,{size:200,orientation:"vertical",colorSpace:d,model:y,channel:b,color:l,gamut:m,onChange:I,"data-testid":`${i}-color-slider`})]})]})]})})});E4.displayName="ColorPickerContents";function N1(t){var r;const e=(r=t.valuesByMode)==null?void 0:r[0];return e?"value"in e.value?String(e.value.value):"tokenId"in e.value?`â†’ ${e.value.tokenId}`:"":""}function D1({value:t,tokens:e,excludeTokenId:r,modes:n,resolvedValueTypeId:s,resolvedValueTypes:i,onChange:a,isDisabled:l}){const{isOpen:c,onOpen:d,onClose:u}=nc(),[m,g]=M.useState(""),[y,v]=M.useState(null);console.log("[TokenValuePicker] Debug info:",{resolvedValueTypeId:s,resolvedValueTypesCount:i.length,resolvedValueTypes:i.map(R=>({id:R.id,displayName:R.displayName,type:R.type})),availableIds:i.map(R=>R.id)});const I=i.find(R=>R.id===s);if(!I)throw console.error("[TokenValuePicker] Value type not found:",{requestedId:s,availableIds:i.map(R=>R.id),allValueTypes:i}),new Error(`Unknown value type: ${s}`);console.log("[TokenValuePicker] Found value type:",I),M.useEffect(()=>{if(I.type==="COLOR"&&typeof t=="object"&&"value"in t)try{new Yr(String(t.value)),v(null)}catch{v("Color value not valid")}},[t,I.type]);const S=e.filter(R=>!(R.id===r||R.resolvedValueTypeId!==s||!R.displayName.toLowerCase().includes(m.toLowerCase()))),b=R=>{if(I.type)switch(I.type){case"COLOR":try{new Yr(String(R)),v(null)}catch{v("Color value not valid")}a({value:String(R)});break;case"FONT_FAMILY":case"CUBIC_BEZIER":a({value:String(R)});break;case"DIMENSION":case"SPACING":case"FONT_WEIGHT":case"FONT_SIZE":case"LINE_HEIGHT":case"LETTER_SPACING":case"DURATION":case"BLUR":case"SPREAD":case"RADIUS":a({value:Number(R)});break;default:a({value:String(R)})}else a({value:String(R)})},k=R=>{a({tokenId:R.id}),u()},A=()=>{if(I.type)switch(I.type){case"COLOR":return o.jsxs(ce,{spacing:1,align:"stretch",children:[o.jsxs(Xo,{placement:"bottom-start",children:[o.jsx(Qo,{children:o.jsxs(Ef,{size:"sm",width:"200px",children:[o.jsx(Vv,{children:o.jsx(z,{width:"14px",height:"14px",borderRadius:"2px",backgroundColor:typeof t=="object"&&"value"in t?String(t.value):"#000000",border:"1px solid",borderColor:"rgba(0, 0, 0, 0.1)"})}),o.jsx(yt,{value:typeof t=="object"&&"value"in t?String(t.value):"",onChange:R=>b(R.target.value),placeholder:"Enter color (hex)",isDisabled:l})]})}),o.jsx(Ai,{minWidth:"320px",p:0,children:o.jsx(Pi,{p:0,children:o.jsx(z,{p:4,children:o.jsx(E4,{color:typeof t=="object"&&"value"in t?String(t.value):"#000000",onChange:R=>{v(null),b(R.toString({format:"hex"}))},"data-testid":"token-value-picker-color-picker"})})})})]}),y&&o.jsx(E,{fontSize:"xs",color:"red.500","data-testid":"color-validation-error",children:y})]});case"DIMENSION":case"SPACING":case"FONT_WEIGHT":case"FONT_SIZE":case"LINE_HEIGHT":case"LETTER_SPACING":case"DURATION":case"BLUR":case"SPREAD":case"RADIUS":return o.jsxs(Wm,{size:"sm",width:"200px",value:typeof t=="object"&&"value"in t?Number(t.value):0,onChange:(R,G)=>b(G),isDisabled:l,children:[o.jsx(qm,{}),o.jsxs(Jm,{children:[o.jsx(Ym,{}),o.jsx(Km,{})]})]});case"FONT_FAMILY":case"CUBIC_BEZIER":return o.jsx(yt,{size:"sm",width:"200px",value:typeof t=="object"&&"value"in t?String(t.value):"",onChange:R=>b(R.target.value),placeholder:`Enter ${I.type.toLowerCase()}`,isDisabled:l});default:return o.jsx(yt,{size:"sm",width:"200px",value:typeof t=="object"&&"value"in t?String(t.value):"",onChange:R=>b(R.target.value),placeholder:"Enter value",isDisabled:l})}return o.jsx(yt,{size:"sm",width:"200px",value:typeof t=="object"&&"value"in t?String(t.value):"",onChange:R=>b(R.target.value),placeholder:"Enter value",isDisabled:l})},C=typeof t=="object"&&"tokenId"in t?e.find(R=>R.id===t.tokenId):void 0;function T(R){if(Array.isArray(R.valuesByMode)){if(Array.isArray(n)&&n.length>0){const ne=R.valuesByMode.find(he=>Array.isArray(he.modeIds)&&he.modeIds.length===n.length&&he.modeIds.every((te,K)=>te===n[K]));if(ne)return ne.value}const G=R.valuesByMode.find(ne=>Array.isArray(ne.modeIds)&&ne.modeIds.length===0);if(G)return G.value;if(R.valuesByMode.length>0)return R.valuesByMode[0].value}}const P=()=>{if(C){const R=T(C);R&&"value"in R&&a({value:R.value})}},_=o.jsxs(Ai,{children:[o.jsx(Yd,{}),o.jsx(Bw,{}),o.jsx(Pi,{children:o.jsxs(ce,{spacing:2,align:"stretch",children:[o.jsx(yt,{placeholder:"Search tokens...",value:m,size:"sm",width:"calc(100% - 40px)",onChange:R=>g(R.target.value)}),o.jsx(Uw,{spacing:0,children:S.map(R=>o.jsx(Fr,{children:o.jsx(Oe,{variant:"ghost",width:"100%",justifyContent:"flex-start",size:"sm",onClick:()=>k(R),children:o.jsx($p,{displayName:R.displayName,resolvedValueTypeId:R.resolvedValueTypeId,resolvedValueTypes:i,value:N1(R)})})},R.id))})]})})]});return o.jsx(ce,{spacing:2,align:"stretch",children:o.jsx(le,{align:"flex-start",children:typeof t=="object"&&"tokenId"in t&&C?o.jsxs(o.Fragment,{children:[o.jsxs(Xo,{isOpen:c,onClose:u,placement:"bottom-start",children:[o.jsx(Qo,{children:o.jsx(z,{width:"100%",cursor:"pointer",tabIndex:l?-1:0,onKeyDown:R=>{(R.key==="Enter"||R.key===" ")&&(R.preventDefault(),l||d())},minWidth:"200px",borderRadius:"var(--chakra-radii-md)",_hover:{bg:"gray.100"},_dark:{_hover:{bg:"gray.700"}},children:o.jsx($p,{displayName:C.displayName,resolvedValueTypeId:C.resolvedValueTypeId,resolvedValueTypes:i,value:N1(C),onClick:l?void 0:d})})}),_]}),o.jsx(Bt,{size:"sm","aria-label":"Unlink token alias",icon:o.jsx(zk,{size:16}),onClick:P,isDisabled:l})]}):o.jsxs(o.Fragment,{children:[A(),o.jsxs(Xo,{isOpen:c,onClose:u,placement:"bottom-start",children:[o.jsx(Qo,{children:o.jsx(Bt,{size:"sm","aria-label":"Search tokens",icon:o.jsx(kb,{size:16}),onClick:d,isDisabled:l})}),_]})]})})})}function pi(t,e){const r=e.find(n=>n.id===t);return r?r.name:(console.warn(`Unknown modeId: ${t}`),`Unknown Mode (${t})`)}function rl(t){return t.length===0?[[]]:t.map(r=>r.modes.map(n=>n.id)).reduce((r,n)=>r.flatMap(s=>n.map(i=>[...s,i])),[[]])}function ZP(t){const e=L.getDimensionOrder(),r=[...t].sort((i,a)=>{const l=e.indexOf(i.id),c=e.indexOf(a.id);return l===-1?1:c===-1?-1:l-c}),n=r.find(i=>i.modes.length<=3),s=r.filter(i=>i!==n);return{columnDimensions:n?[n]:[],rowDimensions:s}}function Rm(t,e){const r=e.find(n=>n.id===t);if(!r)throw new Error(`Unknown value type: ${t}`);switch(r.type){case"COLOR":return{value:"#000000"};case"DIMENSION":case"SPACING":case"FONT_SIZE":case"LINE_HEIGHT":case"LETTER_SPACING":case"BLUR":case"SPREAD":case"RADIUS":return{value:0};case"FONT_WEIGHT":return{value:400};case"FONT_FAMILY":return{value:"system-ui"};case"DURATION":return{value:0};case"CUBIC_BEZIER":return{value:"cubic-bezier(0.4, 0, 0.2, 1)"};default:return{value:""}}}function XP({columnDimensions:t,rowDimensions:e,modes:r,valueMap:n,getValueEditor:s,onDeleteValue:i,resolvedValueTypeId:a,resolvedValueTypes:l,onAddValue:c,isDisabled:d}){var g;const u=rl(t),m=rl(e);if(e.length>1){const y=e[0],v=e.slice(1);return o.jsxs(ho,{size:"sm",variant:"simple",width:"100%",children:[o.jsx(jo,{children:o.jsxs(Nn,{children:[o.jsx(br,{children:y.displayName}),u.map((I,S)=>o.jsx(br,{colSpan:1,children:I.map(b=>pi(b,r)).join(" + ")},S))]})}),o.jsx(mo,{children:y.modes.map(I=>o.jsx(nr.Fragment,{children:rl(v).map((S,b)=>o.jsxs(Nn,{children:[b===0&&o.jsx(fr,{rowSpan:rl(v).length,children:pi(I.id,r)}),u.map((k,A)=>([I.id,...S,...k].sort(),o.jsx(fr,{children:o.jsx(ho,{size:"sm",variant:"simple",children:o.jsx(mo,{children:S.map((C,T)=>{const P=[I.id,...S,...k].sort(),_=P.join(","),R=n.get(_);return o.jsxs(Nn,{children:[o.jsx(fr,{align:"left",children:pi(C,r)}),o.jsx(fr,{align:"left",children:o.jsxs(z,{display:"flex",alignItems:"flex-start",gap:2,children:[R?s(R.value,P):o.jsx(Oe,{size:"sm",variant:"outline",onClick:()=>c(P,Rm(a,l)),isDisabled:d,children:"Add value"}),R&&o.jsx(Bt,{"aria-label":"Remove value",icon:o.jsx(Eo,{size:16}),size:"sm",variant:"ghost",colorScheme:"red",onClick:()=>i(P),isDisabled:d})]})})]},T)})})})},A)))]},`${I.id}-${b}`))},I.id))})]})}if(t.length>1){const y=t[0],v=t.slice(1);return o.jsxs(ho,{size:"sm",variant:"simple",children:[o.jsx(jo,{children:o.jsxs(Nn,{children:[o.jsx(br,{children:(g=e[0])==null?void 0:g.displayName}),y.modes.map(I=>o.jsx(br,{colSpan:1,children:pi(I.id,r)},I.id))]})}),o.jsx(mo,{children:m.map((I,S)=>o.jsxs(Nn,{children:[o.jsx(fr,{children:pi(I[0],r)}),y.modes.map(b=>o.jsx(fr,{children:o.jsxs(ho,{size:"sm",variant:"simple",children:[o.jsx(jo,{children:o.jsx(Nn,{children:rl(v).map((k,A)=>o.jsx(br,{children:k.map(C=>pi(C,r)).join(" + ")},A))})}),o.jsx(mo,{children:o.jsx(Nn,{children:rl(v).map((k,A)=>{const C=[...I,b.id,...k].sort(),T=C.join(","),P=n.get(T);return o.jsx(fr,{children:o.jsxs(z,{display:"flex",alignItems:"center",gap:2,children:[P?s(P.value,C):o.jsx(Oe,{size:"sm",variant:"outline",onClick:()=>c(C,Rm(a,l)),isDisabled:d,children:"Add value"}),P&&o.jsx(Bt,{"aria-label":"Remove value",icon:o.jsx(Eo,{size:16}),size:"sm",variant:"ghost",colorScheme:"red",onClick:()=>i(C),isDisabled:d})]})},A)})})})]})},b.id))]},S))})]})}return o.jsxs(ho,{size:"sm",variant:"simple",children:[o.jsx(jo,{children:o.jsxs(Nn,{children:[e.map(y=>o.jsx(br,{children:y.displayName},y.id)),u.map((y,v)=>o.jsx(br,{children:y.map(I=>pi(I,r)).join(" + ")},v))]})}),o.jsx(mo,{children:m.map((y,v)=>o.jsxs(Nn,{children:[y.map(I=>o.jsx(fr,{children:o.jsx(E,{fontSize:"sm",children:pi(I,r)})},I)),u.map((I,S)=>{const b=[...y,...I].sort(),k=b.join(","),A=n.get(k);return o.jsx(fr,{children:o.jsxs(z,{display:"flex",alignItems:"center",gap:2,children:[A?s(A.value,b):o.jsx(Oe,{size:"sm",variant:"outline",onClick:()=>c(b,Rm(a,l)),isDisabled:d,children:"Add value"}),A&&o.jsx(Bt,{"aria-label":"Remove value",icon:o.jsx(Eo,{size:16}),size:"sm",variant:"ghost",colorScheme:"red",onClick:()=>i(b),isDisabled:d})]})},S)})]},v))})]})}function QP({valuesByMode:t,modes:e,dimensions:r,getValueEditor:n,onDeleteValue:s,resolvedValueTypeId:i,resolvedValueTypes:a,onAddValue:l,isDisabled:c}){const d=y=>{if(typeof y=="string")return y;if(typeof y=="object"&&y){if("value"in y)return y.value;if("tokenId"in y)return`alias:${y.tokenId}`}return String(y)};console.log("[ValueByModeTable] Rendering with values:",{valuesByMode:t.map(y=>({modeIds:y.modeIds,value:y.value,valueType:typeof y.value,actualValue:d(y.value),valueString:JSON.stringify(y.value)})),dimensions:r.map(y=>({id:y.id,displayName:y.displayName})),modes:e.map(y=>({id:y.id,name:y.name}))});const u=new Map;t.forEach(y=>{const v=y.modeIds.slice().sort().join(",");u.set(v,y)}),console.log("[ValueByModeTable] Value map created:",{valueMapEntries:Array.from(u.entries()).map(([y,v])=>({key:y,value:{modeIds:v.modeIds,value:v.value,valueType:typeof v.value,actualValue:d(v.value),valueString:JSON.stringify(v.value)}}))});const{columnDimensions:m,rowDimensions:g}=ZP(r);return o.jsx(z,{overflowX:"auto",children:o.jsx(XP,{columnDimensions:m,rowDimensions:g,modes:e,valueMap:u,getValueEditor:n,onDeleteValue:s,resolvedValueTypeId:i,resolvedValueTypes:a,onAddValue:l,isDisabled:c})})}function eN({value:t,onChange:e,disabled:r=!1,availablePropertyTypes:n}){const s=y=>{const I=(n||[]).filter(A=>A.id!=="ALL"&&A.id!=="ANY_PROPERTY"),S=I.map(A=>A.id),b=y.includes("ANY_PROPERTY"),k=t.length===0;if(b&&!k)e([]);else if(!b&&k)e(I);else{const A=y.includes("ALL"),C=t.length===S.length&&S.every(T=>t.some(P=>P.id===T));if(A&&!C)e(I);else if(!A&&C)e([]);else{const T=y.filter(P=>P!=="ALL"&&P!=="ANY_PROPERTY").map(P=>I.find(_=>_.id===P)).filter(Boolean);e(T)}}},i=n||[],a=t.map(y=>y.id),l=i.map(y=>y.id).filter(y=>y!=="ALL"&&y!=="ANY_PROPERTY"),c=a.filter(y=>l.includes(y)),d=l.length>0&&l.every(y=>a.includes(y)),u=t.length===0,m=l.length>1;let g=[];return u?g=["ANY_PROPERTY"]:d&&m?g=["ALL",...l]:g=c,console.log("[PropertyTypePicker] Debug state:",{selectedPropertyTypeIds:a,availablePropertyTypeIds:l,visibleSelectedIds:c,allActualTypesSelected:d,anyPropertySelected:u,checkboxGroupValue:g,value:t.map(y=>({id:y.id,displayName:y.displayName})),availablePropertyTypes:i.map(y=>({id:y.id,displayName:y.displayName,compatibleValueTypes:y.compatibleValueTypes}))}),console.log("[PropertyTypePicker] CheckboxGroup value:",g),o.jsxs(Ye,{children:[o.jsx(le,{justify:"space-between",align:"center",mb:2,children:o.jsx(Qe,{fontSize:"sm",mb:0,children:"Property Types"})}),o.jsx(Gw,{value:g,onChange:s,isDisabled:r,children:o.jsx(ce,{spacing:2,align:"stretch",children:i.map(y=>o.jsx(sn,{value:y.id==="ALL"?"ALL":y.id==="ANY_PROPERTY"?"ANY_PROPERTY":y.id,size:"md",children:y.displayName},y.id))})}),o.jsx(Xd,{children:u?"Any property type (no scoping)":t.length===0?"No property types selected":`${t.length} property type(s) selected`})]})}class tN{static createPlatformOverride(e,r,n){try{const s=this.detectChanges(e,r);return s.changedFields.length===0?{success:!0,overrideData:null,changes:s}:{success:!0,overrideData:{systemId:"design-system",platformId:n,version:"1.0.0",figmaFileKey:`platform-${n}-key`,tokenOverrides:[{id:e.id,...this.extractChangedFields(e,s.changedFields)}]},changes:s}}catch(s){return{success:!1,overrideData:null,error:s instanceof Error?s.message:"Unknown error",changes:{tokenId:e.id,changedFields:[],originalValues:{},newValues:{}}}}}static createThemeOverride(e,r,n){try{if(!e.themeable)return{success:!1,overrideData:null,error:`Token "${e.id}" is not themeable and cannot be edited in theme mode`,changes:{tokenId:e.id,changedFields:[],originalValues:{},newValues:{}}};const s=this.detectChanges(e,r);return s.changedFields.length===0?{success:!0,overrideData:null,changes:s}:{success:!0,overrideData:{systemId:"design-system",themeId:n,figmaFileKey:`theme-${n}-key`,tokenOverrides:[{tokenId:e.id,valuesByMode:this.extractChangedValuesByMode(e,r)}]},changes:s}}catch(s){return{success:!1,overrideData:null,error:s instanceof Error?s.message:"Unknown error",changes:{tokenId:e.id,changedFields:[],originalValues:{},newValues:{}}}}}static detectChanges(e,r){if(!r)return{tokenId:e.id,changedFields:Object.keys(e).filter(l=>l!=="id"&&e[l]!==void 0),originalValues:{},newValues:e};const n=[],s={},i={},a=["displayName","description","themeable","private","status","tokenTier","resolvedValueTypeId","generatedByAlgorithm","algorithmId","valuesByMode"];for(const l of a){const c=r[l],d=e[l];this.hasValueChanged(c,d)&&(n.push(l),s[l]=c,i[l]=d)}return{tokenId:e.id,changedFields:n,originalValues:s,newValues:i}}static hasValueChanged(e,r){return e===r?!1:e===void 0&&r!==void 0||e!==void 0&&r===void 0?!0:typeof e=="object"&&typeof r=="object"?JSON.stringify(e)!==JSON.stringify(r):e!==r}static extractChangedFields(e,r){const n={};for(const s of r)s==="valuesByMode"?n[s]=this.extractChangedValuesByMode(e,null):n[s]=e[s];return n}static extractChangedValuesByMode(e,r){if(!r)return e.valuesByMode||[];const n=[],s=r.valuesByMode||[];for(const i of e.valuesByMode||[]){const a=s.find(l=>JSON.stringify(l.modeIds.sort())===JSON.stringify(i.modeIds.sort()));(!a||this.hasValueByModeChanged(a,i))&&n.push({modeIds:i.modeIds,value:i.value,metadata:i.metadata})}return n}static hasValueByModeChanged(e,r){return JSON.stringify(e.value)!==JSON.stringify(r.value)||JSON.stringify(e.metadata)!==JSON.stringify(r.metadata)}static createOverrideForContext(e,r,n){const{sourceType:s,sourceId:i}=n.editMode;if(!i)return{success:!1,overrideData:null,error:"No source ID specified for override creation",changes:{tokenId:e.id,changedFields:[],originalValues:{},newValues:{}}};switch(s){case"platform-extension":return this.createPlatformOverride(e,r,i);case"theme-override":return this.createThemeOverride(e,r,i);case"core":return{success:!0,overrideData:null,changes:{tokenId:e.id,changedFields:[],originalValues:{},newValues:{}}};default:return{success:!1,overrideData:null,error:`Unknown source type: ${s}`,changes:{tokenId:e.id,changedFields:[],originalValues:{},newValues:{}}}}}}const rN=(t,e,r,n,s)=>{console.log(`[formatTokenName] Starting formatting for platform: ${t}`),console.log("[formatTokenName] Token taxonomies:",e),console.log("[formatTokenName] Available syntax patterns:",r),console.log("[formatTokenName] Taxonomy order:",n);const i=r[t];if(!i)return console.log(`[formatTokenName] No syntax patterns found for platform: ${t}`),"";console.log(`[formatTokenName] Using patterns for ${t}:`,i);const a=new Map;s.forEach(v=>{a.set(v.id,v)});const l=[];for(const v of n){console.log(`[formatTokenName] Processing taxonomy order item: ${v}`);const I=e.find(S=>S.taxonomyId===v);if(I){console.log(`[formatTokenName] Found termId: ${I.termId} for taxonomyId: ${v}`);const S=a.get(v);if(S){console.log(`[formatTokenName] Found taxonomy: ${S.name}`);const b=S.terms.find(k=>k.id===I.termId);b?(console.log(`[formatTokenName] Added term: ${b.name}`),l.push(b.name)):console.log(`[formatTokenName] Term not found for termId: ${I.termId}`)}else console.log(`[formatTokenName] Taxonomy not found for taxonomyId: ${v}`)}else console.log(`[formatTokenName] No taxonomy found in token for taxonomyId: ${v}`)}if(console.log("[formatTokenName] Ordered terms:",l),l.length===0)return console.log("[formatTokenName] No terms found, returning empty string"),"";const c=i.delimiter||"";let d=l.join(c);console.log(`[formatTokenName] Joined terms with delimiter '${c}': ${d}`);const u=i.capitalization||"lowercase";switch(u){case"uppercase":d=d.toUpperCase();break;case"camelcase":d=d.replace(/\s+/g,"").replace(/^./,v=>v.toLowerCase());break;case"pascalcase":d=d.replace(/\s+/g,"").replace(/^./,v=>v.toUpperCase());break;case"kebabcase":d=d.toLowerCase().replace(/\s+/g,"-");break;case"snakecase":d=d.toLowerCase().replace(/\s+/g,"_");break;case"lowercase":default:d=d.toLowerCase();break}console.log(`[formatTokenName] Applied ${u}: ${d}`);const m=i.prefix||"",g=i.suffix||"",y=`${m}${d}${g}`;return console.log(`[formatTokenName] Final name with prefix '${m}' and suffix '${g}': ${y}`),y},nN=({token:t,platforms:e})=>{var d;const{colorMode:r}=Vt(),[n,s]=M.useState({}),[i,a]=M.useState(!0),[l,c]=M.useState(null);return M.useEffect(()=>{(async()=>{try{console.log("[PlatformNamePreview] Starting simple name generation for token:",t.id),console.log("[PlatformNamePreview] Token taxonomies:",t.taxonomies),console.log("[PlatformNamePreview] Available platforms:",e.map(T=>({id:T.id,displayName:T.displayName,extensionSource:T.extensionSource})));const g=Object.keys(localStorage).filter(T=>T.toLowerCase().includes("platform"));console.log('[PlatformNamePreview] All localStorage keys containing "platform":',g);const v=localStorage.getItem("token-model:platform-extension-data:NateBaldwinDesign/Test_Auto_platform");if(v)try{const T=JSON.parse(v);console.log("[PlatformNamePreview] Existing platform extension data:",T)}catch(T){console.warn("[PlatformNamePreview] Failed to parse existing data:",T)}else console.log("[PlatformNamePreview] No data found in existing key");a(!0),c(null);const I=L.getMergedData(),S=(I==null?void 0:I.taxonomyOrder)||[];console.log("[PlatformNamePreview] Taxonomy order from core data:",S);const b=(I==null?void 0:I.taxonomies)||[];console.log("[PlatformNamePreview] Available taxonomies:",b);const k={},A=v?JSON.parse(v):null;for(const T of e){console.log(`[PlatformNamePreview] Processing platform: ${T.id} (${T.displayName})`);let P=L.getPlatformExtensionData(T.id);if(console.log(`[PlatformNamePreview] Platform extension data for ${T.id}:`,P?"Found":"Not found"),!P&&A&&A.platformId===T.id&&(console.log(`[PlatformNamePreview] Found matching platform in existing data for ${T.id}`),P=A),!P&&T.extensionSource){const _=`${T.extensionSource.repositoryUri}/${T.extensionSource.filePath}`;console.log(`[PlatformNamePreview] Trying alternative key: ${_}`);const R=localStorage.getItem(`token-model:platform-extension-data:${_}`);if(R)try{P=JSON.parse(R),console.log("[PlatformNamePreview] Found platform extension data with alternative key:",P)}catch(G){console.warn("[PlatformNamePreview] Failed to parse platform extension data:",G)}else console.log(`[PlatformNamePreview] No data found with alternative key: ${_}`)}P&&P.syntaxPatterns?(k[T.id]=P.syntaxPatterns,console.log(`[PlatformNamePreview] Found syntax patterns for ${T.id}:`,P.syntaxPatterns)):(console.log(`[PlatformNamePreview] No syntax patterns found in extension data for ${T.id}, checking core platform data`),T.syntaxPatterns?(k[T.id]=T.syntaxPatterns,console.log(`[PlatformNamePreview] Using core syntax patterns for ${T.id}:`,T.syntaxPatterns)):console.log(`[PlatformNamePreview] No syntax patterns found in core data for ${T.id}`))}console.log("[PlatformNamePreview] All syntax patterns collected:",k);const C={};for(const T of e){console.log(`[PlatformNamePreview] Generating name for platform: ${T.id}`);const P=rN(T.id,t.taxonomies,k,S,b);console.log(`[PlatformNamePreview] Generated name for ${T.id}: "${P}"`),P&&(C[T.id]=P)}console.log("[PlatformNamePreview] Final generated names:",C),s(C)}catch(m){console.error("[PlatformNamePreview] Error generating platform names:",m),c(m instanceof Error?m.message:"Failed to generate platform names")}finally{a(!1)}})()},[t,e]),i?o.jsxs(z,{flex:1,minW:0,children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:1,children:"Platform Names"}),o.jsxs(zt,{status:"info",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsx(E,{fontSize:"sm",children:"Generating platform names..."})]})]}):l?o.jsxs(z,{flex:1,minW:0,children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:1,children:"Platform Names"}),o.jsxs(zt,{status:"error",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsx(E,{fontSize:"sm",children:l})]})]}):o.jsxs(z,{flex:1,minW:0,children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",mb:1,children:"Platform Names"}),Object.keys(n).length===0?o.jsxs(zt,{status:"warning",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(ce,{align:"start",spacing:1,children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",children:"No platform names could be generated."}),o.jsx(E,{fontSize:"xs",children:"Check that the token has valid taxonomy assignments and that taxonomy order is configured in the core data."}),o.jsxs(E,{fontSize:"xs",color:"gray.500",children:["Debug info: Token has ",((d=t.taxonomies)==null?void 0:d.length)||0," taxonomies"]})]})]}):o.jsxs(ho,{size:"sm",variant:"simple",children:[o.jsx(jo,{children:o.jsxs(Nn,{children:[o.jsx(br,{fontSize:"xs",py:2,children:"Platform"}),o.jsx(br,{fontSize:"xs",py:2,children:"Formatted name"})]})}),o.jsx(mo,{children:Object.entries(n).map(([u,m])=>{const g=e.find(v=>v.id===u),y=(g==null?void 0:g.displayName)||u;return o.jsxs(Nn,{children:[o.jsx(fr,{py:2,children:o.jsx(E,{fontSize:"sm",children:y})}),o.jsx(fr,{py:2,children:o.jsx(E,{fontSize:"sm",fontFamily:"mono",color:r==="dark"?"gray.300":"gray.700",bg:r==="dark"?"gray.800":"gray.100",px:2,py:1,borderRadius:"md",display:"inline-block",children:m})})]},u)})})]})]})};function nl(t,e){return e?zI(t,e.resolvedValueTypes):{value:""}}function R1(t,e){return t.filter(r=>Array.isArray(r.resolvedValueTypeIds)&&r.resolvedValueTypeIds.includes(e))}const hf=(t,e,r)=>{const n=e.find(l=>l.id===t);if(!n)return[];if(!n.type){const l=r.find(c=>c.id===t||c.id===t.replace(/_/g,"-")||c.id===t.replace(/-/g,"_"));return l?[{id:"ANY_PROPERTY",displayName:"Any Property (undefined)",category:"layout",compatibleValueTypes:["color","dimension","font-family","font-weight","font-size","line-height","letter-spacing","duration","cubic-bezier","blur","radius"],inheritance:!1},l,{id:"ALL",displayName:"Select All",category:"layout",compatibleValueTypes:["color","dimension","font-family","font-weight","font-size","line-height","letter-spacing","duration","cubic-bezier","blur","radius"],inheritance:!1}]:[{id:"ANY_PROPERTY",displayName:"Any Property (undefined)",category:"layout",compatibleValueTypes:["color","dimension","font-family","font-weight","font-size","line-height","letter-spacing","duration","cubic-bezier","blur","radius"],inheritance:!1},{id:"ALL",displayName:"Select All",category:"layout",compatibleValueTypes:["color","dimension","font-family","font-weight","font-size","line-height","letter-spacing","duration","cubic-bezier","blur","radius"],inheritance:!1}]}console.log("[getFilteredPropertyTypes] Debug filtering:",{resolvedValueTypeId:t,standardPropertyTypesCount:r.length,standardPropertyTypes:r.map(l=>({id:l.id,displayName:l.displayName,compatibleValueTypes:l.compatibleValueTypes}))});const s=r.filter(l=>l.compatibleValueTypes.includes(t)||l.compatibleValueTypes.includes(t.replace(/_/g,"-"))),i={id:"ANY_PROPERTY",displayName:"Any Property (undefined)",category:"layout",compatibleValueTypes:["color","dimension","font-family","font-weight","font-size","line-height","letter-spacing","duration","cubic-bezier","blur","radius"],inheritance:!1},a={id:"ALL",displayName:"Select All",category:"layout",compatibleValueTypes:["color","dimension","font-family","font-weight","font-size","line-height","letter-spacing","duration","cubic-bezier","blur","radius"],inheritance:!1};if(s.length===0){const l=r.find(c=>c.id===t||c.id===t.replace(/_/g,"-")||c.id===t.replace(/-/g,"_"));return l?[i,l]:[i]}return s.length>1?[i,...s,a]:[i,...s]},sN=(t,e,r)=>{const n=e.find(a=>a.id===t);if(!n||!n.type)return[];const s=hf(t,e,r);switch(n.type){case"FONT_FAMILY":case"FONT_WEIGHT":case"FONT_SIZE":case"LINE_HEIGHT":case"LETTER_SPACING":case"DURATION":case"CUBIC_BEZIER":case"BLUR":case"RADIUS":return s.slice(0,1);default:return[]}};function O1(t,e,r){var i;const n=[];if(!t.tokenCollectionId)return n;const s=(e??[]).find(a=>a.id===t.tokenCollectionId);return s?(s.resolvedValueTypeIds.includes(t.resolvedValueTypeId)||n.push(`Token '${t.displayName}' has type '${((i=r.find(a=>a.id===t.resolvedValueTypeId))==null?void 0:i.displayName)||t.resolvedValueTypeId}' which is not supported by collection '${s.name}'`),n):(n.push(`Token '${t.displayName}' references non-existent collection id '${t.tokenCollectionId}'`),n)}const ls=t=>{if(typeof t=="string")return t;if(typeof t=="object"&&t){if("value"in t)return t.value;if("tokenId"in t)return`alias:${t.tokenId}`}return String(t)};function oN({token:t,tokens:e,dimensions:r,modes:n,platforms:s,open:i,onClose:a,onSave:l,taxonomies:c,resolvedValueTypes:d,isNew:u=!1,onViewClassifications:m,schema:g,onDeleteToken:y,collections:v,dataSourceContext:I}){var Ke;console.log("ðŸ”„ [TokenEditorDialog] RENDER START - Component ID:",t.id,"Open:",i,"IsNew:",u),console.log("ðŸ”„ [TokenEditorDialog] Props received:",{tokenId:t.id,tokenName:t.displayName,open:i,isNew:u,resolvedValueTypesCount:d==null?void 0:d.length,schemaExists:!!g,dataSourceContextExists:!!I}),console.debug("[TokenEditorDialog] Received resolvedValueTypes:",d);const{colorMode:S}=Vt(),[b,k]=M.useState(()=>{if(u)return{...t,id:wn("token"),themeable:t.themeable??!1,valuesByMode:[{modeIds:[],value:nl(t.resolvedValueTypeId,{resolvedValueTypes:d})}]};const{valuesByMode:ve,...Te}=t;return{...Te,themeable:t.themeable??!1,valuesByMode:ve.map(je=>({...je,platformOverrides:je.platformOverrides?[...je.platformOverrides]:[]}))}}),[A,C]=M.useState(()=>Array.isArray(t.taxonomies)?t.taxonomies:[]),[T,P]=M.useState([]),_=M.useRef({}),R=M.useRef(null),[G,ne]=M.useState(()=>R1(c,t.resolvedValueTypeId));M.useEffect(()=>{const ve=R1(c,b.resolvedValueTypeId);ne(ve);const Te=new Set(ve.map(Fe=>Fe.id)),je=A.filter(Fe=>Te.has(Fe.taxonomyId));je.length!==A.length&&C(je)},[b.resolvedValueTypeId,c]),M.useEffect(()=>{const ve=b.propertyTypes||[],Te=hf(b.resolvedValueTypeId,d,(g==null?void 0:g.standardPropertyTypes)||[]),je=ve.filter(Fe=>Te.includes(Fe));if(je.length===0){const Fe=sN(b.resolvedValueTypeId,d,(g==null?void 0:g.standardPropertyTypes)||[]);k(Ue=>({...Ue,propertyTypes:Fe}))}else je.length!==ve.length&&k(Fe=>({...Fe,propertyTypes:je}))},[b.resolvedValueTypeId,d]),M.useEffect(()=>{if(i&&g){const{valuesByMode:ve,...Te}=t,je={...Te,themeable:t.themeable??!1,valuesByMode:ve.map(Fe=>({...Fe,platformOverrides:Fe.platformOverrides?[...Fe.platformOverrides]:[]}))};k(u?Fe=>({...je,id:Fe.id}):je),R.current=je,C(Array.isArray(t.taxonomies)?t.taxonomies:[]),P(r.filter(Fe=>Fe.required).map(Fe=>Fe.id)),k(u?Fe=>({...je,id:Fe.id}):je)}},[t,i,r,s,c,u]),M.useEffect(()=>{if(t.valuesByMode&&t.valuesByMode.length>0){const ve=t.valuesByMode.flatMap(je=>je.modeIds),Te=r.filter(je=>je.modes.some(Fe=>ve.includes(Fe.id))).map(je=>je.id);P(Te)}else P([])},[t,i,r]);const he=ve=>{console.log("[handleToggleDimension] Starting dimension toggle:",{dimensionId:ve,isActive:T.includes(ve),currentActiveDimensions:T,currentValuesByMode:b.valuesByMode.map(Fe=>({modeIds:Fe.modeIds,value:Fe.value,valueType:typeof Fe.value,actualValue:ls(Fe.value),valueString:JSON.stringify(Fe.value)}))});const Te=T.includes(ve);let je;if(Te)console.log("[handleToggleDimension] Removing dimension:",ve),je=T.filter(Fe=>Fe!==ve),console.log("[handleToggleDimension] After removing dimension:",{newActiveDimensions:je,valuesByMode:b.valuesByMode.map(Fe=>({modeIds:Fe.modeIds,value:Fe.value,valueType:typeof Fe.value,actualValue:ls(Fe.value),valueString:JSON.stringify(Fe.value)}))});else{console.log("[handleToggleDimension] Adding dimension:",ve);const Fe=r.find(Je=>Je.id===ve);if(!Fe){console.error("[handleToggleDimension] Dimension not found:",ve);return}je=[...T,ve];const Ue=Fe.defaultMode;console.log("[handleToggleDimension] Adding dimension details:",{dimension:Fe,defaultModeId:Ue,newActiveDimensions:je}),k(Je=>{if(console.log("[handleToggleDimension] setEditedToken callback - initial state:",{prevValuesByMode:Je.valuesByMode.map(At=>({modeIds:At.modeIds,value:At.value,valueType:typeof At.value,actualValue:ls(At.value),valueString:JSON.stringify(At.value)}))}),T.length===0){console.log("[handleToggleDimension] No previous dimensions active, creating mode values");const At=Je.valuesByMode.find(vr=>vr.modeIds.length===0),gr=Fe.modes.map(vr=>({modeIds:[vr.id],value:At?At.value:nl(Je.resolvedValueTypeId,{resolvedValueTypes:d}),platformOverrides:At?At.platformOverrides:void 0}));return console.log("[handleToggleDimension] Created new values for no previous dimensions:",{newValuesByMode:gr.map(vr=>({modeIds:vr.modeIds,value:vr.value,valueType:typeof vr.value,actualValue:ls(vr.value),valueString:JSON.stringify(vr.value)}))}),{...Je,valuesByMode:[...Je.valuesByMode,...gr]}}const ut=[...Je.valuesByMode],Ze=Je.valuesByMode.filter(At=>te(At.modeIds));return console.log("[handleToggleDimension] Current active values:",{currentValues:Ze.map(At=>({modeIds:At.modeIds,value:At.value,valueType:typeof At.value,actualValue:ls(At.value),valueString:JSON.stringify(At.value)}))}),Ze.forEach(At=>{const gr=[...At.modeIds,Ue].sort(),vr=gr.join(",");ut.some(gt=>gt.modeIds.slice().sort().join(",")===vr)||(console.log("[handleToggleDimension] Creating combinatory value:",{newModeIds:gr,sourceValue:At.value,sourceValueType:typeof At.value,sourceActualValue:ls(At.value),sourceValueString:JSON.stringify(At.value)}),ut.push({modeIds:gr,value:At.value,platformOverrides:At.platformOverrides}))}),Fe.modes.forEach(At=>{const gr=[At.id].join(",");if(!ut.some(yr=>yr.modeIds.slice().sort().join(",")===gr))if(At.id===Ue){const yr=ut.find(gt=>gt.modeIds.includes(Ue)&&gt.modeIds.length>1);if(yr)console.log("[handleToggleDimension] Creating default mode value from combinatory:",{modeId:At.id,sourceValue:yr.value,sourceValueType:typeof yr.value,sourceActualValue:ls(yr.value),sourceValueString:JSON.stringify(yr.value)}),ut.push({modeIds:[At.id],value:yr.value,platformOverrides:yr.platformOverrides});else{const gt=Ze.length>0?Ze[0].value:nl(Je.resolvedValueTypeId,{resolvedValueTypes:d});console.log("[handleToggleDimension] Creating default mode value with fallback:",{modeId:At.id,fallbackValue:gt,fallbackValueType:typeof gt,fallbackActualValue:ls(gt),fallbackValueString:JSON.stringify(gt)}),ut.push({modeIds:[At.id],value:gt,platformOverrides:Ze.length>0?Ze[0].platformOverrides:void 0})}}else{const yr=nl(Je.resolvedValueTypeId,{resolvedValueTypes:d});console.log("[handleToggleDimension] Creating non-default mode value:",{modeId:At.id,defaultValue:yr,defaultValueType:typeof yr,defaultActualValue:ls(yr),defaultValueString:JSON.stringify(yr)}),ut.push({modeIds:[At.id],value:yr,platformOverrides:void 0})}}),console.log("[handleToggleDimension] Final valuesByMode after adding dimension:",{finalValuesByMode:ut.map(At=>({modeIds:At.modeIds,value:At.value,valueType:typeof At.value,actualValue:ls(At.value),valueString:JSON.stringify(At.value)}))}),{...Je,valuesByMode:ut}})}P(je)},te=ve=>{if(console.log("[isValueActive] Checking value:",{modeIds:ve,activeDimensionIds:T,dimensions:r.map(Fe=>({id:Fe.id,modes:Fe.modes.map(Ue=>Ue.id)}))}),T.length===0){const Fe=ve.length===0;return console.log("[isValueActive] No active dimensions, result:",Fe),Fe}const Te=r.filter(Fe=>T.includes(Fe.id)).flatMap(Fe=>Fe.modes.map(Ue=>Ue.id)),je=ve.every(Fe=>Te.includes(Fe))&&ve.length===T.length;return console.log("[isValueActive] Result:",{activeModeIds:Te,modeIds:ve,everyIdActive:ve.every(Fe=>Te.includes(Fe)),lengthMatch:ve.length===T.length,finalResult:je}),je},K=(ve,Te)=>{k(je=>{const Fe=je.valuesByMode.some(Je=>Je.modeIds.slice().sort().join(",")===ve.slice().sort().join(","));let Ue;return Fe?Ue=je.valuesByMode.map(Je=>Je.modeIds.slice().sort().join(",")===ve.slice().sort().join(",")?{...Je,value:Te}:Je):Ue=[...je.valuesByMode,{modeIds:ve,value:Te}],{...je,valuesByMode:Ue}})},O=ve=>{k(Te=>({...Te,valuesByMode:Te.valuesByMode.filter(je=>je.modeIds.slice().sort().join(",")!==ve.slice().sort().join(","))}))},Z=b.valuesByMode.filter(ve=>te(ve.modeIds));console.log("[TokenEditorDialog] Displayed values calculation:",{allValuesByMode:b.valuesByMode.map(ve=>({modeIds:ve.modeIds,value:ve.value,valueType:typeof ve.value,actualValue:ls(ve.value),valueString:JSON.stringify(ve.value),isActive:te(ve.modeIds)})),displayedValuesByMode:Z.map(ve=>({modeIds:ve.modeIds,value:ve.value,valueType:typeof ve.value,actualValue:ls(ve.value),valueString:JSON.stringify(ve.value)}))});const ie=(ve,Te,je,Fe)=>(console.log("[getValueEditor] Processing value:",{value:ve,valueType:typeof ve,actualValue:typeof ve=="string"?ve:ls(ve),valueString:JSON.stringify(ve),modeIds:Te,isOverride:je}),typeof ve=="string"?(console.log("[getValueEditor] Value is string, displaying as text:",ve),o.jsx(E,{fontSize:"sm",color:"gray.500",children:ve})):(console.log("[getValueEditor] Value is object, using TokenValuePicker:",{value:ve,valueType:typeof ve,actualValue:ls(ve),valueKeys:ve?Object.keys(ve):"null/undefined"}),o.jsx(D1,{value:ve,tokens:e,excludeTokenId:b.id,modes:Te,resolvedValueTypeId:b.resolvedValueTypeId,resolvedValueTypes:d,onChange:Ue=>{console.log("[getValueEditor] TokenValuePicker onChange:",{newValue:Ue,newValueType:typeof Ue,newActualValue:ls(Ue),newValueString:JSON.stringify(Ue)}),Fe?Fe(Ue):k(Je=>({...Je,valuesByMode:Je.valuesByMode.map(ut=>ut.modeIds.slice().sort().join(",")===Te.slice().sort().join(",")?{...ut,value:Ue}:ut)}))}}))),[ge,xe]=M.useState([]);M.useEffect(()=>{if(b.tokenCollectionId){const ve=O1(b,v,d);xe(ve)}else xe([])},[b.tokenCollectionId,b.resolvedValueTypeId,v,d]);const $=()=>{if(console.debug("[TokenEditorDialog] Collections:",v),console.debug("[TokenEditorDialog] Current resolvedValueTypeId:",b.resolvedValueTypeId),!v||!b.resolvedValueTypeId)return[];const ve=v.filter(Te=>{const je=Te.resolvedValueTypeIds.includes(b.resolvedValueTypeId);return console.debug(`[TokenEditorDialog] Collection ${Te.name} (${Te.id}) compatible:`,je),je});return console.debug("[TokenEditorDialog] Compatible collections:",ve),ve},B=ve=>{if(ve.preventDefault(),console.log("[TokenEditorDialog] handleSave called with editedToken:",b),b.tokenCollectionId){const Ue=O1(b,v,d);if(Ue.length>0){console.log("[TokenEditorDialog] Collection validation errors:",Ue),xe(Ue);return}}b.tokenTier&&!["PRIMITIVE","SEMANTIC","COMPONENT"].includes(b.tokenTier)&&(b.tokenTier="PRIMITIVE");const Te=b.tokenCollectionId?b:(()=>{const{tokenCollectionId:Ue,...Je}=b;return Je})(),je=b.valuesByMode.filter(Ue=>te(Ue.modeIds)),Fe={...Te,valuesByMode:je,taxonomies:A};if(console.log("[TokenEditorDialog] Calling onSave with token:",Fe),I!=null&&I.editMode.isActive&&I.editMode.sourceType!=="core"){const Ue=e.find(ut=>ut.id===t.id)||null,Je=tN.createOverrideForContext(Fe,Ue,I);if(!Je.success){console.error("[TokenEditorDialog] Override creation failed:",Je.error);return}Je.overrideData&&(console.log("[TokenEditorDialog] Override created:",Je.overrideData),go.addOverride(Fe.id,Je.overrideData,Je.changes))}l(Fe),a()};function U(ve){C(ve),k(Te=>({...Te,taxonomies:ve}))}function X(ve){return new Set(ve.map(Te=>`${Te.taxonomyId}:${Te.termId}`))}const ee=X(A),Se=!!e.find(ve=>ve.id!==b.id&&Array.isArray(ve.taxonomies)&&ve.taxonomies.length===A.length&&X(ve.taxonomies).size===ee.size&&Array.from(ee).every(Te=>X(ve.taxonomies).has(Te))),Me=ve=>{k(Te=>({...Te,status:ve}))},se=$I(b.resolvedValueTypeId,d),[de,fe]=M.useState(""),[_e,Y]=M.useState(!1),Ce=M.useRef(null),ue=()=>{var Te,je;const ve={aliases:[],groups:[],variants:[],themeOverrides:[]};return e.forEach(Fe=>{Fe.valuesByMode.forEach(Ue=>{"tokenId"in Ue.value&&Ue.value.tokenId===t.id&&ve.aliases.push(Fe.id)})}),(Te=g==null?void 0:g.extensions)!=null&&Te.tokenGroups&&g.extensions.tokenGroups.forEach(Fe=>{Fe.tokens.some(Ue=>Ue.id===t.id)&&ve.groups.push(Fe.id)}),(je=g==null?void 0:g.extensions)!=null&&je.tokenVariants&&Object.entries(g.extensions.tokenVariants).forEach(([Fe,Ue])=>{Ue.tokens.some(Je=>Je.id===t.id)&&ve.variants.push(Fe)}),ve},Ee=()=>{y(t.id),Y(!1),a()},ze=ue(),De=Object.values(ze).some(ve=>ve.length>0);return M.useEffect(()=>{i&&(_.current={},R.current=null)},[i,t.id]),o.jsxs(o.Fragment,{children:[o.jsxs(Zr,{isOpen:i,onClose:a,size:"xl",children:[o.jsx(Dr,{}),o.jsxs(Xr,{maxW:"1200px",children:[o.jsx(Rr,{children:u?"Create Token":`Edit Token: ${b.displayName}`}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsxs(ce,{gap:6,align:"stretch",children:[o.jsxs(z,{children:[o.jsxs(le,{gap:2,align:"center",mb:3,children:[o.jsx(jb,{size:24}),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:"Settings"})]}),o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:S==="dark"?"gray.800":"gray.50",borderColor:S==="dark"?"gray.600":"gray.200",children:o.jsxs(vi,{gap:6,align:"flex-start",children:[o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Token Tier"}),o.jsxs(Kt,{value:b.tokenTier||"PRIMITIVE",onChange:ve=>{k(Te=>({...Te,tokenTier:ve.target.value}))},children:[o.jsx("option",{value:"PRIMITIVE",children:"Primitive"}),o.jsx("option",{value:"SEMANTIC",children:"Semantic"}),o.jsx("option",{value:"COMPONENT",children:"Component"})]})]}),o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Value Type"}),o.jsx(Kt,{value:b.resolvedValueTypeId,onChange:ve=>{const Te=ve.target.value;k(je=>({...je,resolvedValueTypeId:Te,valuesByMode:[{modeIds:[],value:nl(Te,{resolvedValueTypes:d})}]}))},children:d.map(ve=>o.jsx("option",{value:ve.id,children:ve.displayName},ve.id))}),b.resolvedValueTypeId&&o.jsx(E,{fontSize:"sm",color:"gray.500",mt:1,children:(Ke=d.find(ve=>ve.id===b.resolvedValueTypeId))==null?void 0:Ke.description})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Collection"}),o.jsxs(Kt,{value:b.tokenCollectionId||"",onChange:ve=>{const Te=ve.target.value;k(je=>{if(!Te){const{tokenCollectionId:Fe,...Ue}=je;return Ue}return{...je,tokenCollectionId:Te}})},children:[o.jsx("option",{value:"",children:"Auto-select"}),$().map(ve=>o.jsx("option",{value:ve.id,children:ve.name},ve.id))]}),ge.length>0&&o.jsxs(zt,{status:"error",mt:2,children:[o.jsx(Lt,{}),o.jsx(ce,{align:"start",spacing:1,children:ge.map((ve,Te)=>o.jsx(E,{fontSize:"sm",children:ve},Te))})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Release status"}),o.jsxs(Kt,{value:b.status||"",onChange:ve=>Me(ve.target.value),children:[o.jsx("option",{value:"",children:"None"}),o.jsx("option",{value:"experimental",children:"Experimental"}),o.jsx("option",{value:"stable",children:"Stable"}),o.jsx("option",{value:"deprecated",children:"Deprecated"})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Editability"}),o.jsxs(le,{spacing:6,align:"stretch",flex:1,children:[o.jsx(sn,{isChecked:b.private,onChange:ve=>k(Te=>({...Te,private:ve.target.checked})),children:"Private"}),o.jsx(sn,{isChecked:!!b.themeable,onChange:ve=>k(Te=>({...Te,themeable:ve.target.checked})),children:"Themeable"})]})]})]})})]}),o.jsxs(z,{children:[o.jsxs(le,{gap:2,align:"center",mb:3,children:[o.jsx(Z6,{size:24}),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:"Naming"})]}),o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:S==="dark"?"gray.800":"gray.50",borderColor:S==="dark"?"gray.600":"gray.200",children:o.jsxs(ce,{gap:3,align:"stretch",children:[o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Display Name"}),o.jsx(yt,{value:b.displayName,onChange:ve=>k(Te=>({...Te,displayName:ve.target.value}))})]}),o.jsxs(vi,{gap:6,align:"flex-start",children:[o.jsx(z,{flex:1,minW:0,children:o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Taxonomies"}),o.jsx(NS,{taxonomies:G,value:A,onChange:U,disabled:G.length===0,onViewClassifications:m}),G.length===0&&o.jsxs(zt,{status:"warning",mt:2,children:[o.jsx(Lt,{}),"No taxonomies available for this value type. Please select a different value type or add taxonomies for this type."]}),Se&&o.jsxs(zt,{status:"error",mt:2,children:[o.jsx(Lt,{}),"Another token already uses this exact set of taxonomy assignments. Please choose a unique combination."]})]})}),o.jsx(nN,{token:b,platforms:s,taxonomies:c,dataSourceContext:I})]})]})})]}),o.jsxs(z,{children:[o.jsxs(le,{gap:2,align:"center",mb:3,children:[o.jsx(a6,{size:24}),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:"Usage & Context"})]}),o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:S==="dark"?"gray.800":"gray.50",borderColor:S==="dark"?"gray.600":"gray.200",children:o.jsxs(vi,{gap:6,align:"flex-start",children:[o.jsx(z,{flex:1,minW:0,children:o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(Hu,{value:b.description||"",onChange:ve=>k(Te=>({...Te,description:ve.target.value})),placeholder:"Enter a description for this token...",rows:4,resize:"vertical"})]})}),o.jsx(z,{flex:1,minW:0,children:o.jsx(eN,{value:b.propertyTypes||[],onChange:ve=>k(Te=>({...Te,propertyTypes:ve})),availablePropertyTypes:hf(b.resolvedValueTypeId,d,(g==null?void 0:g.standardPropertyTypes)||[])})})]})})]}),o.jsxs(z,{children:[o.jsxs(le,{gap:2,align:"center",mb:3,children:[Ku(se),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:"Values"})]}),t.generatedByAlgorithm&&t.algorithmId&&o.jsxs(zt,{status:"info",borderRadius:"md",mb:3,children:[o.jsx(Lt,{}),o.jsxs(z,{flex:1,children:[o.jsx(E,{fontWeight:"bold",children:"Values generated by algorithm"}),o.jsxs(E,{fontSize:"sm",children:["This token's values are automatically generated by the algorithm â€œ",t.algorithmId,"â€. To modify the values, edit the algorithm instead."]})]}),o.jsx(Oe,{size:"sm",colorScheme:"blue",variant:"outline",onClick:()=>{window.location.href=`/tokens/algorithms?edit=${t.algorithmId}`},children:"Edit Algorithm"})]}),o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:S==="dark"?"gray.800":"gray.50",borderColor:S==="dark"?"gray.600":"gray.200",children:o.jsxs(ce,{gap:8,justify:"flex-start",align:"stretch",children:[o.jsxs(le,{gap:4,align:"center",width:"100%",children:[o.jsx(E,{fontSize:"sm",fontWeight:"medium",children:"Dimensions"}),r.map(ve=>o.jsx(sn,{isChecked:T.includes(ve.id),onChange:()=>he(ve.id),isDisabled:t.generatedByAlgorithm,children:ve.displayName},ve.id))]}),T.length===0?(()=>{const ve=b.valuesByMode.find(Te=>Array.isArray(Te.modeIds)&&Te.modeIds.length===0);return ve?o.jsxs(le,{gap:2,width:"100%",children:[o.jsx(D1,{value:ve.value,tokens:e,excludeTokenId:b.id,modes:[],resolvedValueTypeId:b.resolvedValueTypeId,resolvedValueTypes:d,onChange:Te=>k(je=>({...je,valuesByMode:je.valuesByMode.map(Fe=>Array.isArray(Fe.modeIds)&&Fe.modeIds.length===0?{...Fe,value:Te}:Fe)})),isDisabled:t.generatedByAlgorithm}),o.jsx(Bt,{"aria-label":"Remove value",icon:o.jsx(Eo,{}),onClick:()=>k(Te=>({...Te,valuesByMode:Te.valuesByMode.filter(je=>!(Array.isArray(je.modeIds)&&je.modeIds.length===0))})),isDisabled:t.generatedByAlgorithm})]}):o.jsx(Oe,{variant:"outline",onClick:()=>k(Te=>({...Te,valuesByMode:[...Te.valuesByMode,{modeIds:[],value:nl(Te.resolvedValueTypeId,g)}]})),children:"Add Value"})})():o.jsx(QP,{valuesByMode:Z,modes:n,dimensions:r.filter(ve=>T.includes(ve.id)),getValueEditor:ie,onDeleteValue:O,resolvedValueTypeId:b.resolvedValueTypeId,resolvedValueTypes:d,onAddValue:K,isDisabled:t.generatedByAlgorithm})]})})]})]})}),o.jsx(rn,{children:o.jsxs(vi,{width:"100%",justify:"space-between",children:[!u&&o.jsx(Oe,{colorScheme:"red",variant:"outline",onClick:()=>Y(!0),children:"Delete"}),o.jsxs(le,{spacing:3,children:[o.jsx(Oe,{variant:"ghost",onClick:a,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:B,children:u?"Create":"Save"})]})]})})]})]}),o.jsx(uc,{isOpen:_e,leastDestructiveRef:Ce,onClose:()=>Y(!1),isCentered:!0,children:o.jsx(Dr,{bg:"blackAlpha.300",backdropFilter:"blur(2px)",children:o.jsxs(hc,{maxW:"500px",mx:"auto",my:"auto",borderRadius:"lg",boxShadow:"xl",children:[o.jsx(Rr,{fontSize:"lg",fontWeight:"bold",children:"Delete Token"}),o.jsx(Or,{children:o.jsxs(ce,{align:"stretch",spacing:4,children:[o.jsxs(E,{children:["Delete â€œ",t.displayName,"â€?"]}),De&&o.jsxs(zt,{status:"warning",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(ce,{align:"start",spacing:1,children:[o.jsx(E,{fontWeight:"bold",children:"Warning: This token is referenced in:"}),ze.aliases.length>0&&o.jsxs(E,{children:["â€¢ ",ze.aliases.length," other token(s) as aliases"]}),ze.groups.length>0&&o.jsxs(E,{children:["â€¢ ",ze.groups.length," token group(s)"]}),ze.variants.length>0&&o.jsxs(E,{children:["â€¢ ",ze.variants.length," token variant(s)"]}),ze.themeOverrides.length>0&&o.jsxs(E,{children:["â€¢ ",ze.themeOverrides.length," theme override(s)"]})]})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Type â€œDeleteâ€ to confirm"}),o.jsx(yt,{value:de,onChange:ve=>fe(ve.target.value),placeholder:"Type Delete to confirm",autoFocus:!0})]})]})}),o.jsxs(rn,{children:[o.jsx(Oe,{ref:Ce,onClick:()=>Y(!1),children:"Cancel"}),o.jsx(Oe,{colorScheme:"orange",onClick:()=>{const ve={...b,status:"deprecated"};l(ve),Y(!1),a()},ml:3,children:"Deprecate"}),o.jsx(Oe,{colorScheme:"red",onClick:Ee,ml:3,isDisabled:de!=="Delete",children:"Yes, delete"})]})]})})})]})}class iN{constructor(){console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” AbstractBaseTransformer constructor called")}async validate(e,r){const n=[],s=[];try{if(e==null&&n.push({path:"input",message:"Input data is required",code:"REQUIRED_INPUT"}),r){const a=this.validateOptions(r);n.push(...a.errors),s.push(...a.warnings)}const i=await this.validateInput(e,r);return n.push(...i.errors),s.push(...i.warnings),{isValid:n.length===0,errors:n,warnings:s}}catch(i){return n.push({path:"validation",message:`Validation failed: ${i instanceof Error?i.message:"Unknown error"}`,code:"VALIDATION_ERROR",context:{originalError:i}}),{isValid:!1,errors:n,warnings:s}}}async transform(e,r){console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” AbstractBaseTransformer.transform() called with:",{transformerId:this.id,hasInput:!!e,hasOptions:!!r,optionsKeys:r?Object.keys(r):[]});try{const n=await this.validate(e,r);if(!n.isValid)return console.log("[FIGMA_ID_MAPPING_DEBUG] âŒ AbstractBaseTransformer: Validation failed"),{success:!1,error:{code:"VALIDATION_FAILED",message:"Input validation failed",details:{validationErrors:n.errors}}};console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” AbstractBaseTransformer: Validation passed, calling performTransform()");const s=await this.performTransform(e,r);return console.log("[FIGMA_ID_MAPPING_DEBUG] âœ… AbstractBaseTransformer: performTransform completed successfully"),{success:!0,data:s,metadata:{transformerId:this.id,transformerVersion:this.version,timestamp:new Date().toISOString()}}}catch(n){return{success:!1,error:{code:"TRANSFORMATION_ERROR",message:`Transformation failed: ${n instanceof Error?n.message:"Unknown error"}`,details:{transformerId:this.id},originalError:n instanceof Error?n:new Error(String(n))}}}}getInfo(){return{id:this.id,displayName:this.displayName,description:this.description,version:this.version,supportedInputTypes:this.getSupportedInputTypes(),supportedOutputTypes:this.getSupportedOutputTypes(),requiredOptions:this.getRequiredOptions(),optionalOptions:this.getOptionalOptions()}}validateOptions(e){return{isValid:!0,errors:[],warnings:[]}}getSupportedInputTypes(){return["TokenSystem"]}getSupportedOutputTypes(){return["unknown"]}getRequiredOptions(){return[]}getOptionalOptions(){return["id","metadata"]}createErrorResult(e,r,n){return{success:!1,error:{code:e,message:r,details:n}}}createSuccessResult(e,r){return{success:!0,data:e,metadata:{transformerId:this.id,transformerVersion:this.version,timestamp:new Date().toISOString(),...r}}}}function hs(t,e,r,n){return{path:t,message:e,code:r,context:n}}function yh(t,e=[],r=[]){return{isValid:t,errors:e,warnings:r}}function aN(t){const e=[],r=[];return t.systemId||e.push(hs("systemId","System ID is required","MISSING_SYSTEM_ID")),t.systemName||e.push(hs("systemName","System name is required","MISSING_SYSTEM_NAME")),t.version||e.push(hs("version","Version is required","MISSING_VERSION")),(!t.tokenCollections||t.tokenCollections.length===0)&&e.push(hs("tokenCollections","At least one token collection is required","NO_TOKEN_COLLECTIONS")),(!t.dimensions||t.dimensions.length===0)&&e.push(hs("dimensions","At least one dimension is required","NO_DIMENSIONS")),(!t.tokens||t.tokens.length===0)&&e.push(hs("tokens","At least one token is required","NO_TOKENS")),(!t.platforms||t.platforms.length===0)&&e.push(hs("platforms","At least one platform is required","NO_PLATFORMS")),(!t.resolvedValueTypes||t.resolvedValueTypes.length===0)&&e.push(hs("resolvedValueTypes","At least one resolved value type is required","NO_RESOLVED_VALUE_TYPES")),yh(e.length===0,e,r)}function lN(t,e){var c,d,u,m,g,y,v,I;const r=[],n=[],s=new Set(((c=t.resolvedValueTypes)==null?void 0:c.map(S=>S.id))||[]),i=new Set(((d=t.tokenCollections)==null?void 0:d.map(S=>S.id))||[]);new Set(((u=t.dimensions)==null?void 0:u.map(S=>S.id))||[]);const a=new Set;new Set(((m=t.platforms)==null?void 0:m.map(S=>S.id))||[]);const l=new Set(((g=t.taxonomies)==null?void 0:g.map(S=>S.id))||[]);return(y=t.dimensions)==null||y.forEach(S=>{var b;(b=S.modes)==null||b.forEach(k=>{a.add(k.id)})}),(v=t.tokenCollections)==null||v.forEach((S,b)=>{S.resolvedValueTypeIds&&S.resolvedValueTypeIds.forEach(k=>{s.has(k)||r.push(hs(`tokenCollections[${b}].resolvedValueTypeIds`,`Referenced resolved value type '${k}' does not exist`,"INVALID_RESOLVED_VALUE_TYPE_REFERENCE",{collectionId:S.id,referencedTypeId:k}))})}),(I=t.tokens)==null||I.forEach((S,b)=>{var k,A;S.resolvedValueTypeId&&!s.has(S.resolvedValueTypeId)&&r.push(hs(`tokens[${b}].resolvedValueTypeId`,`Referenced resolved value type '${S.resolvedValueTypeId}' does not exist`,"INVALID_RESOLVED_VALUE_TYPE_REFERENCE",{tokenId:S.id,referencedTypeId:S.resolvedValueTypeId})),S.tokenCollectionId&&!i.has(S.tokenCollectionId)&&r.push(hs(`tokens[${b}].tokenCollectionId`,`Referenced token collection '${S.tokenCollectionId}' does not exist`,"INVALID_COLLECTION_REFERENCE",{tokenId:S.id,referencedCollectionId:S.tokenCollectionId})),(k=S.valuesByMode)==null||k.forEach((C,T)=>{var P;(P=C.modeIds)==null||P.forEach(_=>{a.has(_)||r.push(hs(`tokens[${b}].valuesByMode[${T}].modeIds`,`Referenced mode '${_}' does not exist`,"INVALID_MODE_REFERENCE",{tokenId:S.id,referencedModeId:_}))})}),(A=S.taxonomies)==null||A.forEach((C,T)=>{l.has(C.taxonomyId)||r.push(hs(`tokens[${b}].taxonomies[${T}].taxonomyId`,`Referenced taxonomy '${C.taxonomyId}' does not exist`,"INVALID_TAXONOMY_REFERENCE",{tokenId:S.id,referencedTaxonomyId:C.taxonomyId}))})}),yh(r.length===0,r,n)}function cN(t){const e=[],r=[];return t.systemId&&!/^[a-zA-Z0-9-_]+$/.test(t.systemId)&&e.push(hs("systemId","System ID must match pattern: ^[a-zA-Z0-9-_]+$","INVALID_SYSTEM_ID_PATTERN",{systemId:t.systemId})),t.version&&!/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/.test(t.version)&&e.push(hs("version","Version must be a valid semantic version","INVALID_VERSION_FORMAT",{version:t.version})),yh(e.length===0,e,r)}function dN(t,e){const r=aN(t),n=lN(t),s=cN(t),i=[...r.errors,...n.errors,...s.errors],a=[...r.warnings,...n.warnings,...s.warnings];return yh(i.length===0,i,a)}class uN{constructor(){this.tempToRealIdMap=new Map,this.existingFigmaIds=new Set,this.existingVariableNames=new Map,this.existingCollectionNames=new Map,this.initialModeIds=new Map}initialize(e,r,n){console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaIdManager.initialize() called with:",{hasExistingFigmaData:!!e,hasTempToRealId:!!r,tempToRealIdCount:r?Object.keys(r).length:0,tempToRealIdSample:r?Object.entries(r).slice(0,5):[],hasTokenSystem:!!n}),this.tokenSystem=n,e&&(console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaIdManager: Processing existing Figma data..."),this.extractExistingFigmaIds(e)),r?(console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaIdManager: Processing tempToRealId mapping..."),this.loadTempToRealIdMapping(r)):console.log("[FIGMA_ID_MAPPING_DEBUG] âš ï¸ FigmaIdManager: No tempToRealId mapping provided!"),console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaIdManager: Pruning tempToRealId mapping..."),this.pruneTempToRealIdMapping(),console.log("[FIGMA_ID_MAPPING_DEBUG] âœ… FigmaIdManager: Initialization complete. Final state:",{tempToRealIdMappingCount:this.tempToRealIdMap.size,tempToRealIdMappingSample:Array.from(this.tempToRealIdMap.entries()).slice(0,5),existingFigmaIdsCount:this.existingFigmaIds.size,existingVariableNamesCount:this.existingVariableNames.size,existingCollectionNamesCount:this.existingCollectionNames.size})}extractExistingFigmaIds(e){if(this.existingFigmaIds.clear(),this.existingVariableNames.clear(),this.existingCollectionNames.clear(),console.log("[FigmaIdManager] ðŸ” EXTRACTING: Starting extraction from existingFigmaData:",{hasData:!!e,variablesCount:e!=null&&e.variables?Object.keys(e.variables).length:0,collectionsCount:e!=null&&e.variableCollections?Object.keys(e.variableCollections).length:0,modesCount:e!=null&&e.variableModes?Object.keys(e.variableModes).length:0}),!e){console.log("[FigmaIdManager] ðŸ” EXTRACTING: No existingFigmaData provided");return}const r=[];Object.entries(e.variables||{}).forEach(([a,l])=>{this.existingFigmaIds.add(a),r.push(a),l.name&&this.existingVariableNames.set(l.name,a)}),console.log(`[FigmaIdManager] ðŸ” EXTRACTING: Found ${r.length} variable IDs:`,r.slice(0,5));const n=[];Object.entries(e.variableCollections||{}).forEach(([a,l])=>{this.existingFigmaIds.add(a),n.push(a),l.name&&this.existingCollectionNames.set(l.name,a)}),console.log(`[FigmaIdManager] ðŸ” EXTRACTING: Found ${n.length} collection IDs:`,n.slice(0,5));const s=[];Object.entries(e.variableCollections||{}).forEach(([a,l])=>{l.initialModeId&&(this.existingFigmaIds.add(l.initialModeId),s.push(l.initialModeId),this.initialModeIds.set(a,l.initialModeId),console.log(`[FigmaIdManager] ðŸ” EXTRACTING: Initial mode for collection ${a}: ${l.initialModeId}`)),l.modes&&Object.entries(l.modes).forEach(([c,d])=>{this.existingFigmaIds.add(c),s.push(c)})}),console.log(`[FigmaIdManager] ðŸ” EXTRACTING: Found ${s.length} mode IDs from collections:`,s.slice(0,5));const i=[];Object.entries(e.variableModes||{}).forEach(([a,l])=>{this.existingFigmaIds.add(a),i.push(a)}),console.log(`[FigmaIdManager] ðŸ” EXTRACTING: Found ${i.length} dedicated mode IDs:`,i.slice(0,5)),console.log("[FigmaIdManager] ðŸ” EXTRACTING: Final summary:"),console.log(`[FigmaIdManager] - Total existing Figma IDs: ${this.existingFigmaIds.size}`),console.log(`[FigmaIdManager] - Variable names: ${this.existingVariableNames.size}`),console.log(`[FigmaIdManager] - Collection names: ${this.existingCollectionNames.size}`),console.log("[FigmaIdManager] - All extracted IDs:",Array.from(this.existingFigmaIds).slice(0,10))}loadTempToRealIdMapping(e){if(this.tempToRealIdMap.clear(),console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaIdManager.loadTempToRealIdMapping() called with:",{hasData:!!e,isObject:typeof e=="object",keys:e?Object.keys(e):[],count:e?Object.keys(e).length:0,sample:e?Object.entries(e).slice(0,5):[],fullData:e}),!e){console.log("[FIGMA_ID_MAPPING_DEBUG] âš ï¸ FigmaIdManager: No tempToRealId provided, skipping load");return}for(const[r,n]of Object.entries(e))this.tempToRealIdMap.set(r,n),console.log(`[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaIdManager: Added mapping ${r} -> ${n}`);console.log("[FIGMA_ID_MAPPING_DEBUG] âœ… FigmaIdManager: Final mapping load result:",{loadedCount:this.tempToRealIdMap.size,sampleMappings:Array.from(this.tempToRealIdMap.entries()).slice(0,5),allMappings:Array.from(this.tempToRealIdMap.entries())})}pruneTempToRealIdMapping(){const e=this.tempToRealIdMap.size,r=[],n=[],s=[],i=[];console.log(`[FigmaIdManager] ðŸ” PRUNING: Starting with ${e} mappings`),console.log(`[FigmaIdManager] ðŸ” PRUNING: Available Figma IDs (${this.existingFigmaIds.size}):`,Array.from(this.existingFigmaIds).slice(0,10));for(const[l,c]of this.tempToRealIdMap.entries()){const d=this.existingFigmaIds.has(c);console.log(`[FigmaIdManager] ðŸ” PRUNING: Checking ${l} -> ${c} (exists: ${d})`),d?(n.push(l),console.log(`[FigmaIdManager] âœ… PRUNING: Kept ${l} -> ${c} (found in Figma)`)):(this.tempToRealIdMap.delete(l),r.push(l),console.log(`[FigmaIdManager] âŒ PRUNING: Removed ${l} -> ${c} (not found in Figma)`))}console.log("[FigmaIdManager] ðŸ” ADDING INITIAL MODES: Starting initial mode addition for existing Figma collections..."),console.log("[FigmaIdManager] ðŸ” ADDING INITIAL MODES: Available initial mode mappings:",Array.from(this.initialModeIds.entries()));for(const[l,c]of this.initialModeIds.entries()){console.log(`[FigmaIdManager] ðŸ” ADDING INITIAL MODES: Processing Figma collection ${l} with initial mode ${c}`);let d;for(const[u,m]of this.tempToRealIdMap.entries())if(m===l&&(u.startsWith("tokenCollection-")||u.startsWith("collection-")||u.startsWith("dimensionId-"))){d=u,console.log(`[FigmaIdManager] ðŸ” ADDING INITIAL MODES: Found canonical collection ID ${d} for Figma collection ${l}`);break}if(d){const u=`mode-tokenCollection-${d}`;this.tempToRealIdMap.has(u)?console.log(`[FigmaIdManager] ðŸ” ADDING INITIAL MODES: Initial mode already mapped: ${u}`):(this.tempToRealIdMap.set(u,c),s.push(`${u} -> ${c}`),console.log(`[FigmaIdManager] âœ… ADDING INITIAL MODES: Added ${u} -> ${c} for collection ${d}`))}else console.log(`[FigmaIdManager] ðŸ” ADDING INITIAL MODES: No canonical collection ID found for Figma collection ${l} (not in tempToRealId mapping)`)}console.log("[FigmaIdManager] ðŸ” POPULATING MAPPINGS: Starting to populate missing mappings for existing Figma items...");const a=this.populateMissingMappings();i.push(...a),console.log("[FigmaIdManager] ðŸ” PRUNING: Final results:"),console.log(`[FigmaIdManager] - Original mappings: ${e}`),console.log(`[FigmaIdManager] - Pruned mappings: ${r.length}`,r),console.log(`[FigmaIdManager] - Kept mappings: ${n.length}`,n),console.log(`[FigmaIdManager] - Added initial mode mappings: ${s.length}`,s),console.log(`[FigmaIdManager] - Added existing item mappings: ${i.length}`,i),console.log(`[FigmaIdManager] - Remaining valid mappings: ${this.tempToRealIdMap.size}`)}populateMissingMappings(){const e=[];if(!this.tokenSystem)return console.log("[FigmaIdManager] ðŸ” POPULATING MAPPINGS: No token system available, skipping comprehensive mapping"),e;console.log("[FigmaIdManager] ðŸ” POPULATING MAPPINGS: Starting comprehensive mapping with token system...");for(const r of this.tokenSystem.dimensions||[]){const n=this.findCollectionByName(r.displayName);if(n){const s=this.generateDeterministicId(r.id,"collection");this.tempToRealIdMap.has(s)||(this.tempToRealIdMap.set(s,n),e.push(`${s} -> ${n} (dimension collection)`),console.log(`[FigmaIdManager] âœ… POPULATING MAPPINGS: Added dimension collection mapping: ${s} -> ${n}`))}}for(const r of this.tokenSystem.tokenCollections||[]){const n=this.findCollectionByName(r.name);if(n){const s=this.generateDeterministicId(r.id,"collection");this.tempToRealIdMap.has(s)||(this.tempToRealIdMap.set(s,n),e.push(`${s} -> ${n} (token collection)`),console.log(`[FigmaIdManager] âœ… POPULATING MAPPINGS: Added token collection mapping: ${s} -> ${n}`))}}for(const r of this.tokenSystem.dimensions||[])for(const n of r.modes||[]){const s=this.generateDeterministicId(r.id,"collection");if(this.tempToRealIdMap.get(s)){const a=this.generateDeterministicId(n.id,"mode");this.tempToRealIdMap.has(a)||console.log(`[FigmaIdManager] ðŸ” POPULATING MAPPINGS: Mode ${n.name} (${a}) not found in mapping - would need Figma data traversal`)}}for(const r of this.tokenSystem.tokens||[]){const n=this.findFigmaCodeSyntax(r);if(n){const s=this.findVariableByName(n.formattedName);if(s){const i=this.generateDeterministicId(r.id,"variable");this.tempToRealIdMap.has(i)||(this.tempToRealIdMap.set(i,s),e.push(`${i} -> ${s} (token variable)`),console.log(`[FigmaIdManager] âœ… POPULATING MAPPINGS: Added token variable mapping: ${i} -> ${s}`))}}}return console.log(`[FigmaIdManager] ðŸ” POPULATING MAPPINGS: Completed with ${e.length} new mappings`),e}findFigmaCodeSyntax(e){var i;if(!this.tokenSystem)return;const r=(i=this.tokenSystem.platforms)==null?void 0:i.find(a=>a.displayName==="Figma");if(!r)return;const n=e.codeSyntax,s=r.figmaPlatformMapping;if(n&&s&&n[s])return{platformId:r.id,formattedName:n[s]}}getInitialModeId(e){return this.initialModeIds.get(e)}getFigmaId(e){console.log(`[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaIdManager.getFigmaId() called with itemId: ${e}`);const r=this.tempToRealIdMap.get(e);if(r)return console.log(`[FIGMA_ID_MAPPING_DEBUG] âœ… FigmaIdManager.getFigmaId(${e}): Found mapping:`,{hasMapping:!0,mappedId:r,result:r,tempToRealIdMapSize:this.tempToRealIdMap.size,tempToRealIdMapKeys:Array.from(this.tempToRealIdMap.keys()).slice(0,10)}),r;if(console.log(`[FIGMA_ID_MAPPING_DEBUG] âš ï¸ FigmaIdManager.getFigmaId(${e}): No mapping found, checking fallbacks...`),e.startsWith("mode-tokenCollection-")){const s=e.replace("mode-tokenCollection-","");let i=this.initialModeIds.get(s);if(console.log(`[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaIdManager: FALLBACK DEBUG for ${e}:`,{extractedCollectionId:s,directFallback:i,initialModeIdsMapSize:this.initialModeIds.size,initialModeIdsMapKeys:Array.from(this.initialModeIds.keys()),initialModeIdsMapValues:Array.from(this.initialModeIds.values())}),!i&&this.isDeterministicId(s)){for(const[a,l]of this.tempToRealIdMap.entries())if((l===s||this.generateDeterministicId(a,"collection")===s)&&(i=this.initialModeIds.get(a),i)){console.log(`[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaIdManager: Found fallback via original collection ID: ${a} -> ${i}`);break}}if(i)return console.log(`[FIGMA_ID_MAPPING_DEBUG] âœ… FigmaIdManager.getFigmaId(${e}): Using fallback:`,{hasMapping:!1,hasFallback:!0,fallbackInitialModeId:i,result:i,tempToRealIdMapSize:this.tempToRealIdMap.size,tempToRealIdMapKeys:Array.from(this.tempToRealIdMap.keys()).slice(0,10)}),i}if(this.isUuid(e)){if(this.existingFigmaIds.has(e))return console.log(`[FIGMA_ID_MAPPING_DEBUG] âœ… FigmaIdManager.getFigmaId(${e}): Found in existing Figma data:`,{hasMapping:!1,existsInFigma:!0,result:e,tempToRealIdMapSize:this.tempToRealIdMap.size,tempToRealIdMapKeys:Array.from(this.tempToRealIdMap.keys()).slice(0,10)}),e;this.determineIdType(e)==="mode"&&console.log(`[FIGMA_ID_MAPPING_DEBUG] âš ï¸ FigmaIdManager.getFigmaId(${e}): Mode ID not found in mapping, will generate deterministic ID`)}const n=this.generateDeterministicId(e,this.determineIdType(e));return console.log(`[FIGMA_ID_MAPPING_DEBUG] âš ï¸ FigmaIdManager.getFigmaId(${e}): No mapping found, using deterministic ID:`,{hasMapping:!1,hasFallback:!1,mappedId:void 0,originalId:e,deterministicId:n,result:n,tempToRealIdMapSize:this.tempToRealIdMap.size,tempToRealIdMapKeys:Array.from(this.tempToRealIdMap.keys()).slice(0,10)}),n}determineIdType(e){return e.startsWith("tokenCollection-")||e.startsWith("collection-")?"collection":e.startsWith("mode-")||e.includes("mode")?"mode":(e.startsWith("token-")||e.startsWith("variable-"),"variable")}generateDeterministicId(e,r){return this.isDeterministicId(e)?e:this.isUuid(e)?this.createDeterministicId(e,r):e}isDeterministicId(e){return[/^mode-tokenCollection-/,/^intermediary-/,/^reference-/,/^collection-/,/^dimension-/,/^token-/,/^mode-/].some(n=>n.test(e))}isUuid(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}isFigmaId(e){return/^([A-Za-z]+:)?\d+:\d+$/.test(e)}createDeterministicId(e,r){const s=this.hashString(e).toString(36).substring(0,8);switch(r){case"collection":return`collection-${s}`;case"mode":return`mode-${s}`;case"variable":return`variable-${s}`;default:return`${r}-${s}`}}hashString(e){let r=0;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);r=(r<<5)-r+s,r=r&r}return Math.abs(r)}itemExists(e){const r=this.getFigmaId(e);if(r!==e)return console.log(`[FigmaIdManager] Item ${e} exists via mapping: ${r}`),!0;const n=this.existingFigmaIds.has(r);return console.log(`[FigmaIdManager] Item ${e} exists in current data: ${n}`),n}findVariableByName(e){return this.existingVariableNames.get(e)}findCollectionByName(e){return this.existingCollectionNames.get(e)}getOrCreateVariableId(e,r){const n=this.tempToRealIdMap.get(e);if(n)return n;const s=this.findVariableByName(r);return s?(this.tempToRealIdMap.set(e,s),console.log(`[FigmaIdManager] Mapped temp ID ${e} to existing variable ${s} by name "${r}"`),s):e}determineAction(e){console.log(`[FigmaIdManager] ðŸ” DETERMINING ACTION for itemId: ${e}`);const r=this.getFigmaId(e);console.log(`[FigmaIdManager] getFigmaId(${e}) returned: ${r}`);const n=this.itemExists(e);console.log(`[FigmaIdManager] itemExists(${e}) returned: ${n}`);const s=n?"UPDATE":"CREATE";return console.log(`[FigmaIdManager] âœ… FINAL ACTION for ${e}: ${s}`),s}determineActionByName(e){return this.findVariableByName(e)?"UPDATE":"CREATE"}isInitialMode(e,r){return r.some(n=>n.initialModeId===e)}getTempToRealIdMapping(){const e={};for(const[r,n]of this.tempToRealIdMap.entries())e[r]=n;return e}mergeApiResponse(e){for(const[r,n]of Object.entries(e))this.tempToRealIdMap.set(r,n),this.existingFigmaIds.add(n);console.log(`[FigmaIdManager] Merged ${Object.keys(e).length} new mappings`)}}function hN(t,e){var r;return(r=t.resolvedValueTypes)==null?void 0:r.find(n=>n.id===e)}const _1={"background-color":["FRAME_FILL","SHAPE_FILL"],"text-color":"TEXT_FILL","border-color":"STROKE_COLOR","shadow-color":"EFFECT_COLOR","width-height":"WIDTH_HEIGHT","border-width":"STROKE_FLOAT","border-radius":"CORNER_RADIUS",padding:"GAP",margin:"GAP","gap-spacing":"GAP","font-family":"FONT_FAMILY","font-size":"FONT_SIZE","font-weight":"FONT_WEIGHT","font-style":"FONT_STYLE","line-height":"LINE_HEIGHT","letter-spacing":"LETTER_SPACING","text-alignment":"ALL_SCOPES","text-transform":"ALL_SCOPES",opacity:"OPACITY",shadow:["EFFECT_FLOAT","EFFECT_COLOR"],blur:"EFFECT_FLOAT",position:"ALL_SCOPES","z-index":"ALL_SCOPES","flex-properties":"ALL_SCOPES",duration:"EFFECT_FLOAT",easing:"ALL_SCOPES",delay:"EFFECT_FLOAT"};function mf(t){var r;if(!t||t.length===0||t.some(n=>typeof n=="string"&&n==="ALL_PROPERTY_TYPES"))return["ALL_SCOPES"];const e=new Set;for(const n of t)if(typeof n=="string"){const s=n.toLowerCase().replace(/_/g,"-"),i=_1[s];Array.isArray(i)?i.forEach(a=>e.add(a)):typeof i=="string"&&e.add(i)}else{const s=(r=n.platformMappings)==null?void 0:r.figma;if(s&&Array.isArray(s))s.forEach(i=>e.add(i));else{const i=n.id.toLowerCase().replace(/_/g,"-"),a=_1[i];Array.isArray(a)?a.forEach(l=>e.add(l)):typeof a=="string"&&e.add(a)}}return e.size>0?Array.from(e):["ALL_SCOPES"]}class mN{convertValue(e,r,n,s="srgb"){const i=this.mapToFigmaVariableType(r,n);if(console.log("[FigmaValueConverter] Converting value:",{value:e,resolvedValueTypeId:r,figmaType:i,valueType:typeof e,fileColorProfile:s}),this.isAliasValue(e))return this.convertAliasValue(e);switch(i){case"COLOR":return this.convertToFigmaColor(e,s);case"FLOAT":return this.convertToFigmaFloat(e);case"BOOLEAN":return this.convertToFigmaBoolean(e);case"STRING":default:return this.convertToFigmaString(e)}}mapToFigmaVariableType(e,r){var i;const n=hN(r,e);if(!n)return console.warn(`[FigmaValueConverter] No resolvedValueType found for ${e}, defaulting to STRING`),"STRING";switch(n.id||n.type||((i=n.displayName)==null?void 0:i.toLowerCase())){case"color":return"COLOR";case"spacing":case"font-size":case"line_height":case"letter_spacing":case"blur":case"spread":case"radius":case"opacity":return"FLOAT";case"font_family":case"font_weight":case"duration":case"cubic_bezier":case"shadow":case"border":case"z_index":return"STRING";default:return"STRING"}}isAliasValue(e){return typeof e=="object"&&e!==null&&"type"in e&&e.type==="VARIABLE_ALIAS"}convertAliasValue(e){return{type:"VARIABLE_ALIAS",id:e.id||e.variableId||""}}convertToFigmaColor(e,r="srgb"){try{return typeof e=="string"?this.convertStringToFigmaColor(e,r):typeof e=="object"&&e!==null?this.convertObjectToFigmaColor(e,r):(console.warn("[FigmaValueConverter] Unsupported color value type:",e),{r:0,g:0,b:0})}catch(n){return console.error("[FigmaValueConverter] Color conversion error:",n),{r:0,g:0,b:0}}}convertStringToFigmaColor(e,r="srgb"){console.log(`[FigmaValueConverter] Converting color string: "${e}" with profile: ${r}`);try{const n=new Yr(e);console.log("[FigmaValueConverter] Created color object:",n);let s;r==="srgb"?(s=n.toGamut("srgb").to("srgb"),console.log("[FigmaValueConverter] Converted to sRGB:",s.coords)):r==="display-p3"?(s=n.to("p3"),console.log("[FigmaValueConverter] Converted to Display-P3:",s.coords)):(s=n.toGamut("srgb").to("srgb"),console.log("[FigmaValueConverter] Fallback to sRGB:",s.coords));const i=s.coords,a={r:Math.max(0,Math.min(1,i[0])),g:Math.max(0,Math.min(1,i[1])),b:Math.max(0,Math.min(1,i[2]))};return s.alpha!==1&&(a.a=s.alpha),console.log("[FigmaValueConverter] Final RGB result:",a),a}catch(n){return console.error(`[FigmaValueConverter] Error converting color string "${e}":`,n),{r:0,g:0,b:0}}}convertObjectToFigmaColor(e,r="srgb"){console.log("[FigmaValueConverter] Converting color object:",e,`with profile: ${r}`);try{if(e.value&&typeof e.value=="string")return this.convertStringToFigmaColor(e.value,r);if(e.r!==void 0&&e.g!==void 0&&e.b!==void 0){const c=Math.max(e.r,e.g,e.b)>1?255:1,d={r:e.r/c,g:e.g/c,b:e.b/c};return e.a!==void 0&&(d.a=e.a),console.log("[FigmaValueConverter] RGB object result:",d),d}if(e.hex)return this.convertStringToFigmaColor(e.hex,r);if(e.p3&&e.p3.r!==void 0&&e.p3.g!==void 0&&e.p3.b!==void 0){const l={r:e.p3.r,g:e.p3.g,b:e.p3.b};return e.p3.a!==void 0&&(l.a=e.p3.a),console.log("[FigmaValueConverter] P3 object result:",l),l}console.log("[FigmaValueConverter] Attempting to convert object as color using colorjs.io");const n=new Yr(e);let s;r==="srgb"?s=n.toGamut("srgb").to("srgb"):r==="display-p3"?s=n.to("p3"):s=n.toGamut("srgb").to("srgb");const i=s.coords,a={r:Math.max(0,Math.min(1,i[0])),g:Math.max(0,Math.min(1,i[1])),b:Math.max(0,Math.min(1,i[2]))};return s.alpha!==1&&(a.a=s.alpha),console.log("[FigmaValueConverter] Colorjs.io conversion result:",a),a}catch(n){return console.error("[FigmaValueConverter] Error converting color object:",n),{r:0,g:0,b:0}}}convertToFigmaFloat(e){if(typeof e=="number")return e;if(typeof e=="string"){const r=e.match(/^([0-9]+(\.[0-9]+)?)/);if(r)return parseFloat(r[1])}if(typeof e=="object"&&e!==null){const r=e;if(typeof r.value=="number")return r.value}return 0}convertToFigmaString(e){if(typeof e=="string")return e;if(typeof e=="object"&&e!==null){const r=e;return typeof r.value=="string"?r.value:r.tokenId?(console.log(`[FigmaValueConverter] Token reference detected: ${r.tokenId}, using placeholder string`),"placeholder"):JSON.stringify(e)}return String(e)}convertToFigmaBoolean(e){return typeof e=="boolean"?e:typeof e=="string"?e.toLowerCase()==="true":typeof e=="number"?e!==0:!!e}getAliasPlaceholderValue(e,r){switch(this.mapToFigmaVariableType(r,e)){case"COLOR":return{r:0,g:0,b:0};case"FLOAT":return 0;case"BOOLEAN":return!1;case"STRING":default:return""}}}class pN{constructor(e,r){this.idManager=e,this.valueConverter=r}transformTokenWithDaisyChaining(e,r,n,s="srgb"){var u;console.log(`[FigmaDaisyChain] ðŸ” Starting daisy-chaining for token: ${e.id} (${e.displayName})`),console.log("[FigmaDaisyChain] ðŸ” Token system dimensionOrder:",r.dimensionOrder),console.log("[FigmaDaisyChain] ðŸ” Token system dimensions:",(u=r.dimensions)==null?void 0:u.map(m=>({id:m.id,displayName:m.displayName})));const i=[],a=[],l=this.getUsedDimensionsForToken(e,r);if(console.log(`[FigmaDaisyChain] ðŸ” Used dimensions for token ${e.id}:`,l.map(m=>({id:m.id,displayName:m.displayName}))),l.length===0){console.log(`[FigmaDaisyChain] Token ${e.id} has no dimension dependencies, creating direct variable`);const m=this.createDirectVariable(e,r,n);return i.push(m),{variables:i,modeValues:a}}console.log(`[FigmaDaisyChain] Token ${e.id} uses dimensions:`,l.map(m=>m.displayName));let c={};for(let m=0;m<l.length;m++){const g=l[m],y=m===0;l.length-1;const v=l.length===1;if(console.log(`[FigmaDaisyChain] Stage ${m+1}: Creating intermediaries for dimension "${g.displayName}"`),y&&!v){const I=this.createIntermediaryVariablesForDimension(e,r,n,g,l,!0,s);i.push(...I.dimensionVariables),a.push(...I.dimensionModeValues),Object.assign(c,I.modeToVariableMap)}else{const I=this.createReferenceVariablesForDimension(e,r,n,g,c,l.slice(0,m+1),s);i.push(...I.referenceVariables),a.push(...I.referenceModeValues),Object.assign(c,I.newModeToVariableMap)}}console.log(`[FigmaDaisyChain] Stage ${l.length+1}: Creating final token variable`);const d=this.createFinalTokenVariable(e,r,n,c);if(i.push(d),l.length>0){const m=l[l.length-1],g=this.createFinalTokenVariableModeValues(e,r,d.id,m,c);a.push(...g)}return{variables:i,modeValues:a}}getUsedDimensionsForToken(e,r){var a,l,c;console.log(`[FigmaDaisyChain] ðŸ” getUsedDimensionsForToken called for token: ${e.id}`),console.log("[FigmaDaisyChain] ðŸ” Token valuesByMode:",e.valuesByMode),console.log("[FigmaDaisyChain] ðŸ” Token system dimensionOrder:",r.dimensionOrder);const n=new Set;if((a=e.valuesByMode)==null?void 0:a.some(d=>d.modeIds.length===0)){console.log("[FigmaDaisyChain] ðŸ” Platform extension token detected (empty modeIds), using all dimensions from dimensionOrder");for(const d of r.dimensionOrder||[])n.add(d)}else for(const d of e.valuesByMode||[]){console.log("[FigmaDaisyChain] ðŸ” Processing valueByMode with modeIds:",d.modeIds);for(const u of d.modeIds)for(const m of r.dimensions||[])if((l=m.modes)!=null&&l.some(g=>g.id===u)){console.log(`[FigmaDaisyChain] ðŸ” Found mode ${u} belongs to dimension: ${m.displayName} (${m.id})`),n.add(m.id);break}}console.log("[FigmaDaisyChain] ðŸ” Used dimension IDs found:",Array.from(n));const i=[];for(const d of r.dimensionOrder||[])if(n.has(d)){const u=(c=r.dimensions)==null?void 0:c.find(m=>m.id===d);u&&i.push(u)}return console.log("[FigmaDaisyChain] ðŸ” Final used dimensions (ordered):",i.map(d=>({id:d.id,displayName:d.displayName}))),i}createIntermediaryVariablesForDimension(e,r,n,s,i,a,l="srgb"){var g,y,v,I;const c=[],d=[],u={},m=this.idManager.generateDeterministicId(s.id,"collection");if(a){const S=i[1];if(S)for(const b of S.modes||[]){const k=this.idManager.generateDeterministicId(b.id,"mode"),A=`intermediary-${e.id}-${m}-${k}`,C=`${n.formattedName} (${s.displayName} - ${b.name})`;console.log(`[FigmaDaisyChain] Creating intermediary variable "${C}" action: CREATE`);const T={action:this.idManager.determineAction(A),id:this.idManager.getFigmaId(A),name:C,variableCollectionId:this.idManager.getFigmaId(m),resolvedType:this.valueConverter.mapToFigmaVariableType(e.resolvedValueTypeId,r),scopes:["ALL_SCOPES"],hiddenFromPublishing:!0};c.push(T),u[k]=this.idManager.getFigmaId(A);for(const P of s.modes||[]){const _=this.idManager.generateDeterministicId(P.id,"mode"),R=this.findValueByModeForModeCombination(e,[_,k]);let G;if(R.value&&typeof R.value=="object"&&"tokenId"in R.value){const ne=R.value.tokenId,he=(g=r.tokens)==null?void 0:g.find(te=>te.id===ne);if(he)if((y=he.valuesByMode)==null?void 0:y.find(K=>K.modeIds.includes(P.id)))if(this.getUsedDimensionsForToken(he,r).length===1){const O=this.idManager.getFigmaId(ne);G={variableId:this.idManager.getFigmaId(A),modeId:this.idManager.getFigmaId(_),value:{type:"VARIABLE_ALIAS",id:O}}}else{const O=`intermediary-${ne}-${m}-${_}`;G={variableId:this.idManager.getFigmaId(A),modeId:this.idManager.getFigmaId(_),value:{type:"VARIABLE_ALIAS",id:this.idManager.getFigmaId(O)}}}else G={variableId:this.idManager.getFigmaId(A),modeId:this.idManager.getFigmaId(_),value:this.valueConverter.getAliasPlaceholderValue(r,e.resolvedValueTypeId)};else G={variableId:this.idManager.getFigmaId(A),modeId:this.idManager.getFigmaId(_),value:this.valueConverter.getAliasPlaceholderValue(r,e.resolvedValueTypeId)}}else{const ne=this.valueConverter.convertValue(R.value,e.resolvedValueTypeId,r,l);G={variableId:this.idManager.getFigmaId(A),modeId:this.idManager.getFigmaId(_),value:ne}}d.push(G)}}}else{const S=`intermediary-${e.id}-${m}`,b=`${n.formattedName} (${s.displayName})`;console.log(`[FigmaDaisyChain] Creating intermediary variable "${b}" action: CREATE`);const k={action:this.idManager.determineAction(S),id:this.idManager.getFigmaId(S),name:b,variableCollectionId:this.idManager.getFigmaId(m),resolvedType:this.valueConverter.mapToFigmaVariableType(e.resolvedValueTypeId,r),scopes:["ALL_SCOPES"],hiddenFromPublishing:!0};c.push(k),u[m]=this.idManager.getFigmaId(S);for(const A of s.modes||[]){const C=this.idManager.generateDeterministicId(A.id,"mode"),T=this.findValueByModeForModeCombination(e,[C]);let P;if(T.value&&typeof T.value=="object"&&"tokenId"in T.value){const _=T.value.tokenId,R=(v=r.tokens)==null?void 0:v.find(G=>G.id===_);if(R)if((I=R.valuesByMode)==null?void 0:I.find(ne=>ne.modeIds.includes(A.id)))if(this.getUsedDimensionsForToken(R,r).length===1){const he=this.idManager.getFigmaId(_);P={variableId:this.idManager.getFigmaId(S),modeId:this.idManager.getFigmaId(C),value:{type:"VARIABLE_ALIAS",id:he}}}else{const he=`intermediary-${_}-${m}-${C}`;P={variableId:this.idManager.getFigmaId(S),modeId:this.idManager.getFigmaId(C),value:{type:"VARIABLE_ALIAS",id:this.idManager.getFigmaId(he)}}}else P={variableId:this.idManager.getFigmaId(S),modeId:this.idManager.getFigmaId(C),value:this.valueConverter.getAliasPlaceholderValue(r,e.resolvedValueTypeId)};else P={variableId:this.idManager.getFigmaId(S),modeId:this.idManager.getFigmaId(C),value:this.valueConverter.getAliasPlaceholderValue(r,e.resolvedValueTypeId)}}else{const _=this.valueConverter.convertValue(T.value,e.resolvedValueTypeId,r,l);P={variableId:this.idManager.getFigmaId(S),modeId:this.idManager.getFigmaId(C),value:_}}d.push(P)}}return{dimensionVariables:c,dimensionModeValues:d,modeToVariableMap:u}}createReferenceVariablesForDimension(e,r,n,s,i,a,l="srgb"){var y,v;const c=[],d=[],u={},m=this.idManager.generateDeterministicId(s.id,"collection");if(Object.keys(i).length===0){const I=`intermediary-${e.id}-${m}`,S=`${n.formattedName} (${s.displayName})`;console.log(`[FigmaDaisyChain] Creating single-dimension intermediary variable "${S}" action: CREATE`);const b={action:this.idManager.determineAction(I),id:this.idManager.getFigmaId(I),name:S,variableCollectionId:this.idManager.getFigmaId(m),resolvedType:this.valueConverter.mapToFigmaVariableType(e.resolvedValueTypeId,r),scopes:["ALL_SCOPES"],hiddenFromPublishing:!0};c.push(b),u[m]=this.idManager.getFigmaId(I);for(const k of s.modes||[]){const A=this.idManager.generateDeterministicId(k.id,"mode"),C=this.findValueByModeForModeCombination(e,[A]);let T;if(C.value&&typeof C.value=="object"&&"tokenId"in C.value){const P=C.value.tokenId,_=(y=r.tokens)==null?void 0:y.find(R=>R.id===P);if(_)if((v=_.valuesByMode)==null?void 0:v.find(G=>G.modeIds.includes(k.id)))if(this.getUsedDimensionsForToken(_,r).length===1){const ne=this.idManager.getFigmaId(P);T={variableId:this.idManager.getFigmaId(I),modeId:this.idManager.getFigmaId(A),value:{type:"VARIABLE_ALIAS",id:ne}}}else{const ne=`intermediary-${P}-${m}-${A}`;T={variableId:this.idManager.getFigmaId(I),modeId:this.idManager.getFigmaId(A),value:{type:"VARIABLE_ALIAS",id:this.idManager.getFigmaId(ne)}}}else T={variableId:this.idManager.getFigmaId(I),modeId:this.idManager.getFigmaId(A),value:this.valueConverter.getAliasPlaceholderValue(r,e.resolvedValueTypeId)};else T={variableId:this.idManager.getFigmaId(I),modeId:this.idManager.getFigmaId(A),value:this.valueConverter.getAliasPlaceholderValue(r,e.resolvedValueTypeId)}}else{const P=this.valueConverter.convertValue(C.value,e.resolvedValueTypeId,r,l);T={variableId:this.idManager.getFigmaId(I),modeId:this.idManager.getFigmaId(A),value:P}}d.push(T)}}else{const I=`reference-${e.id}-${m}`,S=`${n.formattedName} (${s.displayName})`;console.log(`[FigmaDaisyChain] Creating reference variable "${S}" action: CREATE`);const b={action:this.idManager.determineAction(I),id:this.idManager.getFigmaId(I),name:S,variableCollectionId:this.idManager.getFigmaId(m),resolvedType:this.valueConverter.mapToFigmaVariableType(e.resolvedValueTypeId,r),scopes:["ALL_SCOPES"],hiddenFromPublishing:!0};c.push(b);for(const k of s.modes||[]){const A=this.idManager.generateDeterministicId(k.id,"mode");let C=i[A]||i[m];if(C&&C.startsWith("token-")&&(C=this.idManager.getFigmaId(C)),C){const T={variableId:this.idManager.getFigmaId(I),modeId:this.idManager.getFigmaId(A),value:{type:"VARIABLE_ALIAS",id:C}};d.push(T),u[A]=this.idManager.getFigmaId(I)}}}return{referenceVariables:c,referenceModeValues:d,newModeToVariableMap:u}}getModeCombinationsForDimension(e,r,n){const s=[];for(const i of e.valuesByMode||[])if(i.modeIds.length>0&&i.modeIds.some(l=>{var c;return(c=r.modes)==null?void 0:c.some(d=>d.id===l)})){const l=this.expandModeCombinationWithDefaults(i.modeIds,n);s.push(l)}return s}expandModeCombinationWithDefaults(e,r){const n=[...e];for(const s of r)!e.some(a=>{var l;return(l=s.modes)==null?void 0:l.some(c=>c.id===a)})&&s.defaultMode&&n.push(s.defaultMode);return n}expandModeCombinations(e,r){const n=[...e];for(const s of r)!e.some(a=>{var l;return(l=s.modes)==null?void 0:l.some(c=>c.id===a)})&&s.defaultMode&&n.push(s.defaultMode);return n}findValueByModeForModeCombination(e,r){var a,l,c;const n=(a=e.valuesByMode)==null?void 0:a.find(d=>r.every(u=>d.modeIds.includes(u)));if(n)return n;const s=(l=e.valuesByMode)==null?void 0:l.find(d=>d.modeIds.length===0);if(s)return console.log(`[FigmaDaisyChain] Using default value for token ${e.id} with modeIds:`,r),s;const i=(c=e.valuesByMode)==null?void 0:c[0];return i?(console.log(`[FigmaDaisyChain] Using first available value for token ${e.id} with modeIds:`,r),i):(console.warn(`[FigmaDaisyChain] No value found for token ${e.id} with modeIds:`,r),{value:null})}createModeKey(e){return e.sort().join("|")}getDefaultModeIdsForDimensions(e){return e.map(r=>r.defaultMode).filter(Boolean)}createFinalTokenVariable(e,r,n,s){const i=this.idManager.getFigmaId(e.id),a=this.idManager.determineAction(e.id);console.log(`[FigmaDaisyChain] Creating final token variable "${n.formattedName}" action: ${a}`);const l={action:a,id:i,name:n.formattedName,variableCollectionId:this.getTokenCollectionId(e,r),resolvedType:this.valueConverter.mapToFigmaVariableType(e.resolvedValueTypeId,r),scopes:mf(e.propertyTypes||[]),hiddenFromPublishing:e.private||!1,codeSyntax:this.buildCodeSyntax(e,r)};return e.description&&e.description.trim()!==""?(l.description=e.description,console.log(`[FigmaDaisyChain] Added description to final variable ${e.id}: "${e.description}"`)):console.log(`[FigmaDaisyChain] No valid description for final token ${e.id}`),l}createFinalTokenVariableModeValues(e,r,n,s,i){const a=[],l=this.findTokenCollection(e,r);if(l){const d=`mode-tokenCollection-${this.idManager.generateDeterministicId(l.id,"collection")}`,u=this.idManager.getFigmaId(d),m=`reference-${e.id}-${s.id}`;let g=null;for(const y of s.modes||[]){const v=this.idManager.generateDeterministicId(y.id,"mode");if(i[v]===this.idManager.getFigmaId(m)){g=this.idManager.getFigmaId(m);break}}if(!g){const y=this.idManager.generateDeterministicId(s.id,"collection");g=i[y]}if(g&&g.startsWith("token-")&&(g=this.idManager.getFigmaId(g)),g){const y={variableId:n,modeId:u,value:{type:"VARIABLE_ALIAS",id:g}};a.push(y)}}else for(const c of s.modes||[]){const d=i[c.id];if(d){const u={variableId:n,modeId:c.id,value:{type:"VARIABLE_ALIAS",id:d}};a.push(u)}}return a}createDirectVariable(e,r,n){const s=this.idManager.getFigmaId(e.id),a={action:this.idManager.determineAction(e.id),id:s,name:n.formattedName,variableCollectionId:this.getTokenCollectionId(e,r),resolvedType:this.valueConverter.mapToFigmaVariableType(e.resolvedValueTypeId,r),scopes:mf(e.propertyTypes||[]),hiddenFromPublishing:e.private||!1,codeSyntax:this.buildCodeSyntax(e,r)};return e.description&&e.description.trim()!==""?(a.description=e.description,console.log(`[FigmaDaisyChain] Added description to direct variable ${e.id}: "${e.description}"`)):console.log(`[FigmaDaisyChain] No valid description for direct token ${e.id}`),a}getTokenCollectionId(e,r){const n=this.findTokenCollection(e,r);if(!n)return"default-collection";const s=this.idManager.generateDeterministicId(n.id,"collection");return this.idManager.getFigmaId(s)}findTokenCollection(e,r){var n;return((n=r.tokenCollections)==null?void 0:n.find(s=>s.resolvedValueTypeIds.includes(e.resolvedValueTypeId)))||null}buildCodeSyntax(e,r){return e.codeSyntax||{}}getUniqueModeCombinationsForDimension(e,r,n){const s=[];for(const i of e.valuesByMode||[])if(i.modeIds.length>0&&i.modeIds.some(l=>{var c;return(c=r.modes)==null?void 0:c.some(d=>d.id===l)})){const l=this.expandModeCombinationWithDefaults(i.modeIds,n),c=this.createModeKey(l);!s.some(u=>this.createModeKey(u)===c)&&s.push(l)}return s}getOtherDimensionModeCombinations(e,r){const n=[];for(const s of e.valuesByMode||[])if(s.modeIds.length>0){const i=s.modeIds.filter(a=>r.some(l=>{var c;return(c=l.modes)==null?void 0:c.some(d=>d.id===a)}));if(i.length>0){const a=this.expandModeCombinationWithDefaults(i,r),l=this.createModeKey(a);!n.some(d=>this.createModeKey(d)===l)&&n.push(a)}}return n}}class fN extends iN{constructor(){super(),this.id="figma-variables",this.displayName="Figma Variables",this.description="Transform design tokens to Figma Variables API format",this.version="1.0.0",console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer constructor called"),this.idManager=new uN,this.valueConverter=new mN,this.daisyChainService=new pN(this.idManager,this.valueConverter)}async validateInput(e,r){const n=[],s=[],i=dN(e);if(n.push(...i.errors),s.push(...i.warnings),r){const a=!r.fileKey,l=!r.accessToken;(a||l)&&s.push({path:"options",message:"Figma file key and access token are required for publishing, but optional for export generation",code:"MISSING_FIGMA_CREDENTIALS"})}return{isValid:n.length===0,errors:n,warnings:s}}async performTransform(e,r){var y,v,I,S,b,k,A;console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer.performTransform() called with:",{hasInput:!!e,inputTokensCount:((y=e.tokens)==null?void 0:y.length)||0,hasOptions:!!r,optionsFileKey:r==null?void 0:r.fileKey,hasTempToRealId:!!(r!=null&&r.tempToRealId),tempToRealIdCount:r!=null&&r.tempToRealId?Object.keys(r.tempToRealId).length:0}),console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” DEEP DEBUG: Starting transformation"),console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” DEEP DEBUG: Input tokenSystem structure:",{hasTokens:!!e.tokens,tokensLength:((v=e.tokens)==null?void 0:v.length)||0,hasCollections:!!e.tokenCollections,collectionsLength:((I=e.tokenCollections)==null?void 0:I.length)||0,hasDimensions:!!e.dimensions,dimensionsLength:((S=e.dimensions)==null?void 0:S.length)||0,hasPlatforms:!!e.platforms,platformsLength:((b=e.platforms)==null?void 0:b.length)||0,hasResolvedValueTypes:!!e.resolvedValueTypes,resolvedValueTypesLength:((k=e.resolvedValueTypes)==null?void 0:k.length)||0,dimensionOrder:e.dimensionOrder,systemName:e.systemName,systemId:e.systemId}),e.tokens&&e.tokens.length>0?console.log("[FigmaTransformer] ðŸ” DEEP DEBUG: Sample tokens:",e.tokens.slice(0,3).map(C=>{var T;return{id:C.id,displayName:C.displayName,resolvedValueTypeId:C.resolvedValueTypeId,hasValuesByMode:!!C.valuesByMode,valuesByModeLength:((T=C.valuesByMode)==null?void 0:T.length)||0}})):console.warn("[FigmaTransformer] ðŸ” DEEP DEBUG: NO TOKENS FOUND IN INPUT!"),e.platforms&&e.platforms.length>0?console.log("[FigmaTransformer] ðŸ” DEEP DEBUG: Available platforms:",e.platforms.map(C=>({id:C.id,displayName:C.displayName,hasFigmaPlatformMapping:!!C.figmaPlatformMapping}))):console.warn("[FigmaTransformer] ðŸ” DEEP DEBUG: NO PLATFORMS FOUND IN INPUT!");const n=await this.validate(e,r);if(!n.isValid)return{variables:[],collections:[],variableModes:[],variableModeValues:[],stats:{created:0,updated:0,deleted:0,collectionsCreated:0,collectionsUpdated:0},error:{code:"VALIDATION_FAILED",message:"Input validation failed",details:{validationErrors:n.errors}}};console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer: INITIALIZING ID MANAGER..."),console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer: Options passed to ID manager:",{hasExistingFigmaData:!!(r!=null&&r.existingFigmaData),existingFigmaDataKeys:r!=null&&r.existingFigmaData?Object.keys(r.existingFigmaData):[],hasTempToRealId:!!(r!=null&&r.tempToRealId),tempToRealIdCount:r!=null&&r.tempToRealId?Object.keys(r.tempToRealId).length:0,tempToRealIdSample:r!=null&&r.tempToRealId?Object.entries(r.tempToRealId).slice(0,5):[]}),this.idManager.initialize(r==null?void 0:r.existingFigmaData,r==null?void 0:r.tempToRealId,e),console.log("[FIGMA_ID_MAPPING_DEBUG] âœ… FigmaTransformer: ID MANAGER INITIALIZED"),console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer: ID Manager state after initialization:",{tempToRealIdMappingCount:Object.keys(this.idManager.getTempToRealIdMapping()).length,tempToRealIdMappingSample:Object.entries(this.idManager.getTempToRealIdMapping()).slice(0,5)}),console.log("[FIGMA_ID_MAPPING_DEBUG] âœ… FigmaTransformer: Using pre-generated code syntax from preprocessor");const s=[],i=[],a=[],l={created:0,updated:0,deleted:0,collectionsCreated:0,collectionsUpdated:0};console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer: Creating dimension collections...");const c=this.createDimensionCollections(e);console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer: Dimension collections created:",{count:c.length,sample:c.slice(0,3).map(C=>({id:C.id,name:C.name,action:C.action}))}),s.push(...c),l.collectionsCreated+=c.filter(C=>C.action==="CREATE").length,l.collectionsUpdated+=c.filter(C=>C.action==="UPDATE").length,console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer: Creating modeless collections...");const d=this.createModelessCollections(e);console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer: Modeless collections created:",{count:d.length,sample:d.slice(0,3).map(C=>({id:C.id,name:C.name,action:C.action}))}),s.push(...d),l.collectionsCreated+=d.filter(C=>C.action==="CREATE").length,l.collectionsUpdated+=d.filter(C=>C.action==="UPDATE").length,console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer: Transforming tokens with daisy-chaining...");const{variables:u,modeValues:m}=this.transformTokensWithDaisyChaining(e,((A=e.figmaConfiguration)==null?void 0:A.fileColorProfile)||"srgb");console.log("[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer: Tokens transformed:",{variablesCount:u.length,modeValuesCount:m.length,sampleVariables:u.slice(0,3).map(C=>({id:C.id,name:C.name,action:C.action}))}),i.push(...u),a.push(...m),l.created+=u.filter(C=>C.action==="CREATE").length,l.updated+=u.filter(C=>C.action==="UPDATE").length;const g=this.createVariableModes(e,s);return l.collectionsUpdated+=g.filter(C=>C.action==="UPDATE").length,console.log("[FigmaTransformer] Transformation complete:",{collections:s.length,variables:i.length,modes:g.length,modeValues:a.length}),{variables:i,collections:s,variableModes:g,variableModeValues:a,stats:l}}createDimensionCollections(e){var n;const r=[];for(const s of e.dimensions||[]){const i=this.idManager.generateDeterministicId(s.id,"collection"),a=this.idManager.getFigmaId(i),l=this.idManager.determineAction(i);console.log(`[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer: Creating dimension collection "${s.displayName}":`,{originalId:s.id,deterministicId:i,figmaId:a,action:l});const c=(n=s.modes)==null?void 0:n.find(g=>g.id===s.defaultMode);if(!c){console.warn(`[FIGMA_ID_MAPPING_DEBUG] âš ï¸ FigmaTransformer: Default mode ${s.defaultMode} not found for dimension ${s.id}`);continue}const d=this.idManager.generateDeterministicId(c.id,"mode"),u=this.idManager.getFigmaId(d);console.log(`[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer: Dimension collection "${s.displayName}" mode:`,{originalModeId:c.id,deterministicModeId:d,figmaModeId:u,modeName:c.name});const m={action:l,id:a,name:s.displayName,initialModeId:u,hiddenFromPublishing:!0};r.push(m)}return r}createModelessCollections(e){const r=[];for(const n of e.tokenCollections||[]){const s=this.idManager.generateDeterministicId(n.id,"collection"),i=this.idManager.getFigmaId(s),a=this.idManager.determineAction(s);console.log(`[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer: Creating modeless collection "${n.name}":`,{originalId:n.id,deterministicId:s,figmaId:i,action:a});const l=`mode-tokenCollection-${s}`,c=this.idManager.getFigmaId(l);console.log(`[FIGMA_ID_MAPPING_DEBUG] ðŸ” FigmaTransformer: Modeless collection "${n.name}" mode:`,{deterministicModeId:l,figmaModeId:c});const d={action:a,id:i,name:n.name,initialModeId:c};r.push(d)}return r}transformTokensWithDaisyChaining(e,r="srgb"){var i,a,l,c;const n=[],s=[];if(console.log("[FigmaTransformer] ðŸ” DEEP DEBUG: Checking dimensionOrder for daisy-chaining"),console.log("[FigmaTransformer] ðŸ” DEEP DEBUG: dimensionOrder:",e.dimensionOrder),console.log("[FigmaTransformer] ðŸ” DEEP DEBUG: dimensions:",(i=e.dimensions)==null?void 0:i.map(d=>({id:d.id,displayName:d.displayName}))),!e.dimensionOrder||e.dimensionOrder.length===0)return console.warn("[FigmaTransformer] No dimensionOrder specified, falling back to simple variable creation"),console.warn("[FigmaTransformer] This will prevent daisy-chaining from working properly!"),this.createSimpleVariables(e);console.log("[FigmaTransformer] Processing tokens with dimensionOrder:",e.dimensionOrder);for(const d of e.tokens||[]){const u=this.buildCodeSyntax(d,e),m=this.getFigmaCodeSyntax(d,u,e);if(!m){console.warn(`[FigmaTransformer] No Figma code syntax found for token ${d.id}, skipping`);continue}const g=this.getUsedDimensionsForToken(d,e),y=g.length>0;if(console.log(`[FigmaTransformer] Token ${d.id} (${d.displayName}):`,{hasDimensionDependencies:y,usedDimensions:g.map(v=>v.displayName),valuesByModeCount:((a=d.valuesByMode)==null?void 0:a.length)||0,hasModeSpecificValues:((l=d.valuesByMode)==null?void 0:l.some(v=>v.modeIds.length>0))||!1}),y){console.log(`[FigmaTransformer] Using daisy-chaining for token ${d.id} with ${g.length} dimension dependencies`);const{variables:v,modeValues:I}=this.daisyChainService.transformTokenWithDaisyChaining(d,e,m,r);n.push(...v),s.push(...I)}else{console.log(`[FigmaTransformer] Creating simple variable for token ${d.id} (no dimension dependencies)`);const v=this.createSimpleVariable(d,e,m);n.push(v);const I=(c=d.valuesByMode)==null?void 0:c.find(S=>S.modeIds.length===0);if(I){const S=this.createModeValueForSimpleVariable(d,e,I);S&&s.push(S)}}}return console.log(`[FigmaTransformer] Daisy-chaining transformation complete: ${n.length} variables, ${s.length} mode values`),{variables:n,modeValues:s}}createSimpleVariables(e){var s;const r=[],n=[];for(const i of e.tokens||[]){const a=this.buildCodeSyntax(i,e),l=this.getFigmaCodeSyntax(i,a,e);if(!l){console.warn(`[FigmaTransformer] No Figma code syntax found for token ${i.id}, skipping`);continue}const c=this.createSimpleVariable(i,e,l);r.push(c);const d=(s=i.valuesByMode)==null?void 0:s.find(u=>u.modeIds.length===0);if(d){const u=this.createModeValueForSimpleVariable(i,e,d);u&&n.push(u)}}return{variables:r,modeValues:n}}createSimpleVariable(e,r,n){const s=this.idManager.getFigmaId(e.id),i=this.idManager.determineAction(e.id),a=this.findTokenCollection(e,r),l=a?this.idManager.generateDeterministicId(a.id,"collection"):"default-collection",c=mf(e.propertyTypes||[]),d={action:i,id:s,name:n.formattedName,variableCollectionId:this.idManager.getFigmaId(l),resolvedType:this.valueConverter.mapToFigmaVariableType(e.resolvedValueTypeId,r),scopes:c,hiddenFromPublishing:e.private||!1,codeSyntax:this.buildCodeSyntax(e,r)};return e.description&&e.description.trim()!==""&&(d.description=e.description),d}createModeValueForSimpleVariable(e,r,n){const s=this.findTokenCollection(e,r);if(!s)return null;const i=this.idManager.generateDeterministicId(s.id,"collection");let a;if("tokenId"in n.value){const c=n.value.tokenId;a={type:"VARIABLE_ALIAS",id:this.idManager.getFigmaId(c)}}else a=n.value.value;const l=this.valueConverter.convertValue(a,e.resolvedValueTypeId,r);return{variableId:this.idManager.getFigmaId(e.id),modeId:this.idManager.getFigmaId(`mode-tokenCollection-${i}`),value:l}}createVariableModes(e,r){const n=[];for(const s of e.tokenCollections||[]){const i=this.idManager.generateDeterministicId(s.id,"collection"),a=`mode-tokenCollection-${i}`,l=this.idManager.getFigmaId(a);let c=this.idManager.determineAction(a);const d=r.some(u=>u.initialModeId===l);d&&(c="UPDATE",console.log(`[FigmaTransformer] ðŸ”§ FORCING UPDATE for token collection mode "${s.name}" because it's used as initialModeId`)),console.log(`[FigmaTransformer] Creating "Value" mode for collection "${s.name}":`,{deterministicModeId:a,figmaModeId:l,action:c,collectionId:this.idManager.getFigmaId(i),isInitialMode:d}),n.push({action:c,id:l,name:"Value",variableCollectionId:this.idManager.getFigmaId(i)})}for(const s of e.dimensions||[]){const i=this.idManager.generateDeterministicId(s.id,"collection");for(const a of s.modes||[]){const l=this.idManager.generateDeterministicId(a.id,"mode"),c=this.idManager.getFigmaId(l);let d=this.idManager.determineAction(l);const u=r.some(m=>m.initialModeId===c);u&&(d="UPDATE",console.log(`[FigmaTransformer] ðŸ”§ FORCING UPDATE for mode "${a.name}" because it's used as initialModeId`)),console.log(`[FigmaTransformer] Creating mode "${a.name}" for dimension "${s.displayName}":`,{deterministicModeId:l,figmaModeId:c,action:d,collectionId:this.idManager.getFigmaId(i),isDefault:a.id===s.defaultMode,isInitialMode:u}),n.push({action:d,id:c,name:a.name,variableCollectionId:this.idManager.getFigmaId(i)})}}return n}findTokenCollection(e,r){var n;return((n=r.tokenCollections)==null?void 0:n.find(s=>s.resolvedValueTypeIds.includes(e.resolvedValueTypeId)))||null}buildCodeSyntax(e,r){return e.codeSyntax||{}}getFigmaCodeSyntax(e,r,n){const s=e.figmaVariableName;return s?(console.log(`[FigmaTransformer] Using pre-generated Figma variable name for token ${e.id}: "${s}"`),{platformId:"figma",formattedName:s}):(console.warn(`[FigmaTransformer] No pre-generated Figma variable name found for token ${e.id}, using display name`),{platformId:"figma",formattedName:e.displayName})}getUsedDimensionsForToken(e,r){var i,a;const n=new Set;for(const l of e.valuesByMode||[])for(const c of l.modeIds)for(const d of r.dimensions||[])if((i=d.modes)!=null&&i.some(u=>u.id===c)){n.add(d.id);break}const s=[];for(const l of r.dimensionOrder||[])if(n.has(l)){const c=(a=r.dimensions)==null?void 0:a.find(d=>d.id===l);c&&s.push(c)}return s}getTempToRealIdMapping(){return this.idManager.getTempToRealIdMapping()}mergeApiResponse(e){this.idManager.mergeApiResponse(e)}getSupportedInputTypes(){return["TokenSystem"]}getSupportedOutputTypes(){return["FigmaTransformationResult"]}getRequiredOptions(){return[]}getOptionalOptions(){return["id","metadata","updateExisting","existingFigmaData","tempToRealId"]}}const xi=class xi{static saveMapping(e,r){const n=`${this.STORAGE_KEY_PREFIX}${e}`,s={...r,lastUpdated:new Date().toISOString()};try{localStorage.setItem(n,JSON.stringify(s)),console.log(`[FigmaMappingService] Saved mapping for file ${e}:`,s)}catch(i){console.error(`[FigmaMappingService] Failed to save mapping for file ${e}:`,i)}}static async saveMappingToGitHub(e,r,n){try{await this.ensureFigmaDirectory(n.owner,n.repo);const s=`${this.MAPPINGS_DIR}/${e}.json`,i={...r,repositoryContext:{owner:n.owner,repo:n.repo,type:n.type,systemId:n.systemId,themeId:n.themeId},lastUpdated:new Date().toISOString()},a=JSON.stringify(i,null,2),l=`AUTOCOMMIT: Update Figma mapping for ${e} - ${new Date().toLocaleString()}`;let c;try{c=(await xt.getFileContent(`${n.owner}/${n.repo}`,s,"main")).sha,console.log(`[FigmaMappingService] Found existing file with SHA: ${c}`)}catch{console.log(`[FigmaMappingService] File doesn't exist, will create new: ${s}`)}try{await xt.createOrUpdateFile(`${n.owner}/${n.repo}`,s,a,"main",l),console.log(`[FigmaMappingService] Successfully saved mapping to GitHub: ${s}`)}catch(d){if(d instanceof Error&&d.message.includes("409")){console.log("[FigmaMappingService] Got 409 conflict, retrying with exponential backoff...");for(let u=1;u<=3;u++)try{const m=Math.pow(2,u)*1e3;console.log(`[FigmaMappingService] Retry attempt ${u}/3, waiting ${m}ms...`),await new Promise(g=>setTimeout(g,m)),await xt.createOrUpdateFile(`${n.owner}/${n.repo}`,s,a,"main",l),console.log(`[FigmaMappingService] Successfully saved mapping to GitHub after retry attempt ${u}: ${s}`);return}catch(m){if(console.warn(`[FigmaMappingService] Retry attempt ${u}/3 failed:`,m),u===3)throw console.error(`[FigmaMappingService] All retry attempts failed for file ${e}`),m}}else throw console.error("[FigmaMappingService] Failed to save mapping to GitHub:",d),d}}catch(s){throw console.error(`[FigmaMappingService] Failed to save mapping to GitHub for file ${e}:`,s),s}}static async ensureFigmaDirectory(e,r){const n=[this.FIGMA_DIR,this.MAPPINGS_DIR,`${this.FIGMA_DIR}/cache`,`${this.FIGMA_DIR}/config`];for(const s of n)try{const i=`${s}/.gitkeep`;await xt.createFile(`${e}/${r}`,i,`# This file ensures the directory is tracked by Git
`,"main",`Add .gitkeep for ${s} directory`),console.log(`[FigmaMappingService] Created directory structure: ${s}`)}catch(i){console.log(`[FigmaMappingService] Directory ${s} might already exist:`,i)}}static async getMappingFromGitHub(e,r){try{const n=`${this.MAPPINGS_DIR}/${e}.json`,s=await xt.getFileContent(`${r.owner}/${r.repo}`,n,"main"),i=JSON.parse(s.content);return i.systemId!==r.systemId?(console.warn(`[FigmaMappingService] System ID mismatch for mapping ${e}: expected ${r.systemId}, got ${i.systemId}`),null):(console.log(`[FigmaMappingService] Retrieved mapping from GitHub for file ${e}:`,i),i)}catch(n){return console.log(`[FigmaMappingService] No mapping found in GitHub for file ${e}:`,n),null}}static async isGitHubIntegrationAvailable(){try{const{GitHubApiService:e}=await ir(async()=>{const{GitHubApiService:r}=await Promise.resolve().then(()=>fo);return{GitHubApiService:r}},void 0);return e.hasSelectedRepository()}catch(e){return console.error("[FigmaMappingService] Failed to check GitHub integration availability:",e),localStorage.getItem("github_selected_repo")!==null}}static async getCurrentRepositoryInfo(){var e,r;try{const{GitHubApiService:n}=await ir(async()=>{const{GitHubApiService:l}=await Promise.resolve().then(()=>fo);return{GitHubApiService:l}},void 0),s=n.getSelectedRepositoryInfo();if(s){const[l,c]=s.fullName.split("/");return{owner:l,repo:c,type:s.fileType==="theme-override"?"theme-override":"core",systemId:"design-system",themeId:s.fileType==="theme-override"?"default-theme":void 0}}const i=localStorage.getItem("github_selected_repo");if(!i)return null;const a=JSON.parse(i);return{owner:a.owner||((e=a.fullName)==null?void 0:e.split("/")[0]),repo:a.repo||((r=a.fullName)==null?void 0:r.split("/")[1]),type:a.fileType==="theme-override"?"theme-override":"core",systemId:"design-system",themeId:a.fileType==="theme-override"?"default-theme":void 0}}catch(n){return console.error("[FigmaMappingService] Failed to get current repository info:",n),null}}static async testGitHubConnection(){try{const e=await this.getCurrentRepositoryInfo();return e?(await xt.getFileContent(`${e.owner}/${e.repo}`,"README.md","main"),{success:!0,message:`Successfully connected to ${e.owner}/${e.repo}`}):{success:!1,message:"No GitHub repository selected"}}catch(e){return{success:!1,message:`Failed to connect to GitHub: ${e instanceof Error?e.message:"Unknown error"}`}}}static getMapping(e){const r=`${this.STORAGE_KEY_PREFIX}${e}`;try{const n=localStorage.getItem(r);if(!n)return console.log(`[FigmaMappingService] No mapping found for file ${e}`),null;const s=JSON.parse(n);return console.log(`[FigmaMappingService] Retrieved mapping for file ${e}:`,s),s}catch(n){return console.error(`[FigmaMappingService] Failed to retrieve mapping for file ${e}:`,n),null}}static async updateMappingFromApiResponse(e,r){console.log(`[FigmaMappingService] Processing API response for file ${e}:`,r),console.log("[FigmaMappingService] API response keys:",Object.keys(r));const n={};if(r.variables&&console.log("[FigmaMappingService] Variables structure:",typeof r.variables,r.variables),r.variableCollections&&console.log("[FigmaMappingService] VariableCollections structure:",typeof r.variableCollections,r.variableCollections),r.meta&&console.log("[FigmaMappingService] Meta structure:",typeof r.meta,r.meta),r.variables&&typeof r.variables=="object"){const d=r.variables;console.log("[FigmaMappingService] Processing variables:",d);for(const[u,m]of Object.entries(d)){console.log("[FigmaMappingService] Processing variable entry:",u,m);const g=m;g.id&&typeof g.id=="string"?(n[u]=g.id,console.log(`[FigmaMappingService] Mapped variable ${u} -> ${g.id}`)):console.warn(`[FigmaMappingService] Variable ${u} missing or invalid id:`,g.id)}}if(r.variableCollections&&typeof r.variableCollections=="object"){const d=r.variableCollections;console.log("[FigmaMappingService] Processing collections:",d);for(const[u,m]of Object.entries(d)){console.log("[FigmaMappingService] Processing collection entry:",u,m);const g=m;g.id&&typeof g.id=="string"?(n[u]=g.id,console.log(`[FigmaMappingService] Mapped collection ${u} -> ${g.id}`)):console.warn(`[FigmaMappingService] Collection ${u} missing or invalid id:`,g.id)}}if(r.meta&&typeof r.meta=="object"){const d=r.meta;if(console.log("[FigmaMappingService] Processing meta object:",d),console.log("[FigmaMappingService] Meta keys:",Object.keys(d)),d.tempIdToRealId&&(console.log("[FigmaMappingService] tempIdToRealId structure:",typeof d.tempIdToRealId,d.tempIdToRealId),typeof d.tempIdToRealId=="object"&&console.log("[FigmaMappingService] tempIdToRealId keys:",Object.keys(d.tempIdToRealId))),d.variables&&typeof d.variables=="object"){const u=d.variables;console.log("[FigmaMappingService] Processing meta.variables:",u);for(const[m,g]of Object.entries(u)){console.log("[FigmaMappingService] Processing meta variable entry:",m,g);const y=g;y.id&&typeof y.id=="string"?(n[m]=y.id,console.log(`[FigmaMappingService] Mapped meta variable ${m} -> ${y.id}`)):console.warn(`[FigmaMappingService] Meta variable ${m} missing or invalid id:`,y.id)}}if(d.variableCollections&&typeof d.variableCollections=="object"){const u=d.variableCollections;console.log("[FigmaMappingService] Processing meta.variableCollections:",u);for(const[m,g]of Object.entries(u)){console.log("[FigmaMappingService] Processing meta collection entry:",m,g);const y=g;y.id&&typeof y.id=="string"?(n[m]=y.id,console.log(`[FigmaMappingService] Mapped meta collection ${m} -> ${y.id}`)):console.warn(`[FigmaMappingService] Meta collection ${m} missing or invalid id:`,y.id)}}if(d.tempToRealId&&typeof d.tempToRealId=="object"){const u=d.tempToRealId;console.log("[FigmaMappingService] Processing meta.tempToRealId:",u);for(const[m,g]of Object.entries(u))typeof g=="string"&&(n[m]=g,console.log(`[FigmaMappingService] Found meta tempToRealId mapping ${m} -> ${g}`))}if(d.tempIdToRealId&&typeof d.tempIdToRealId=="object"){const u=d.tempIdToRealId;console.log("[FigmaMappingService] Processing meta.tempIdToRealId:",u);for(const[m,g]of Object.entries(u))typeof g=="string"&&(n[m]=g,console.log(`[FigmaMappingService] Found meta tempIdToRealId mapping ${m} -> ${g}`))}if(d.created&&typeof d.created=="object"){const u=d.created;if(console.log("[FigmaMappingService] Processing meta.created:",u),u.variables&&typeof u.variables=="object"){const m=u.variables;for(const[g,y]of Object.entries(m)){const v=y;v.id&&typeof v.id=="string"&&(n[g]=v.id,console.log(`[FigmaMappingService] Mapped created variable ${g} -> ${v.id}`))}}if(u.variableCollections&&typeof u.variableCollections=="object"){const m=u.variableCollections;for(const[g,y]of Object.entries(m)){const v=y;v.id&&typeof v.id=="string"&&(n[g]=v.id,console.log(`[FigmaMappingService] Mapped created collection ${g} -> ${v.id}`))}}}if(d.updated&&typeof d.updated=="object"){const u=d.updated;if(console.log("[FigmaMappingService] Processing meta.updated:",u),u.variables&&typeof u.variables=="object"){const m=u.variables;for(const[g,y]of Object.entries(m)){const v=y;v.id&&typeof v.id=="string"&&(n[g]=v.id,console.log(`[FigmaMappingService] Mapped updated variable ${g} -> ${v.id}`))}}if(u.variableCollections&&typeof u.variableCollections=="object"){const m=u.variableCollections;for(const[g,y]of Object.entries(m)){const v=y;v.id&&typeof v.id=="string"&&(n[g]=v.id,console.log(`[FigmaMappingService] Mapped updated collection ${g} -> ${v.id}`))}}}}if(Object.keys(n).length===0){if(console.log("[FigmaMappingService] No mappings found in standard structure, checking alternative formats..."),typeof r=="object"&&r!==null)for(const[d,u]of Object.entries(r))typeof u=="string"&&(d.includes("token")||d.includes("collection")||d.includes("variable"))&&(n[d]=u,console.log(`[FigmaMappingService] Found direct mapping ${d} -> ${u}`));if(r.mapping&&typeof r.mapping=="object"){const d=r.mapping;for(const[u,m]of Object.entries(d))typeof m=="string"&&(n[u]=m,console.log(`[FigmaMappingService] Found nested mapping ${u} -> ${m}`))}if(r.tempToRealId&&typeof r.tempToRealId=="object"){const d=r.tempToRealId;for(const[u,m]of Object.entries(d))typeof m=="string"&&(n[u]=m,console.log(`[FigmaMappingService] Found tempToRealId mapping ${u} -> ${m}`))}}console.log("[FigmaMappingService] Extracted new mappings:",n),console.log("[FigmaMappingService] Total new mappings found:",Object.keys(n).length);const s=this.getMapping(e),i={...s==null?void 0:s.tempToRealId,...n};console.log("[FigmaMappingService] Existing mappings:",s==null?void 0:s.tempToRealId),console.log("[FigmaMappingService] Merged mappings:",i);const a={fileKey:e,systemId:(s==null?void 0:s.systemId)||"design-system",lastUpdated:new Date().toISOString(),tempToRealId:i,metadata:{...s==null?void 0:s.metadata,lastExport:new Date().toISOString()}};this.saveMapping(e,a);const l=await this.getCurrentRepositoryInfo(),c=await this.isGitHubIntegrationAvailable();if(console.log(`[FigmaMappingService] Auto-commit check for file ${e}:`,{hasRepoInfo:!!l,isGitHubAvailable:c,repoInfo:l?{owner:l.owner,repo:l.repo,type:l.type}:null}),l&&c){const d=this.autoCommitTimers.get(e);d&&(clearTimeout(d),console.log(`[FigmaMappingService] Cleared existing auto-commit timer for file ${e}`));const u=setTimeout(async()=>{try{console.log(`[FigmaMappingService] Executing debounced auto-commit for file ${e}...`),await this.saveMappingToGitHub(e,a,l),console.log(`[FigmaMappingService] âœ… Successfully auto-committed mapping to both localStorage and GitHub for file ${e}`)}catch(m){console.error(`[FigmaMappingService] âŒ Failed to auto-commit mapping to GitHub for file ${e}:`,m)}finally{this.autoCommitTimers.delete(e)}},this.AUTO_COMMIT_DEBOUNCE_MS);this.autoCommitTimers.set(e,u),console.log(`[FigmaMappingService] Scheduled debounced auto-commit for file ${e} in ${this.AUTO_COMMIT_DEBOUNCE_MS}ms`)}else console.log(`[FigmaMappingService] âš ï¸ GitHub integration not available for auto-commit, saved mapping to localStorage only for file ${e}`),l||console.log("[FigmaMappingService] Reason: No repository info available"),c||console.log("[FigmaMappingService] Reason: GitHub integration not available");console.log(`[FigmaMappingService] Updated mapping for file ${e}:`,a)}static clearMapping(e){const r=`${this.STORAGE_KEY_PREFIX}${e}`;localStorage.removeItem(r),console.log(`[FigmaMappingService] Cleared mapping for file ${e}`)}static listAllMappings(){const e=[];for(let r=0;r<localStorage.length;r++){const n=localStorage.key(r);if(n&&n.startsWith(this.STORAGE_KEY_PREFIX))try{const s=JSON.parse(localStorage.getItem(n)||"");e.push(s)}catch(s){console.error(`[FigmaMappingService] Failed to parse mapping from key ${n}:`,s)}}return e}static async getTransformerOptions(e){console.log(`[FigmaMappingService] Getting transformer options for fileKey: ${e}`);const r=this.getMapping(e);if(r!=null&&r.tempToRealId)return console.log(`[FigmaMappingService] âœ… Found mapping in localStorage for ${e}:`,{mappingCount:Object.keys(r.tempToRealId).length,sampleMappings:Object.entries(r.tempToRealId).slice(0,5)}),{tempToRealId:r.tempToRealId};console.log("[FigmaMappingService] No mapping found in localStorage, trying GitHub...");const n=await this.getCurrentRepositoryInfo(),s=await this.isGitHubIntegrationAvailable();if(n&&s)try{const i=await this.getMappingFromGitHub(e,n);if(i!=null&&i.tempToRealId)return console.log(`[FigmaMappingService] âœ… Found mapping in GitHub for ${e}:`,{mappingCount:Object.keys(i.tempToRealId).length,sampleMappings:Object.entries(i.tempToRealId).slice(0,5)}),this.saveMapping(e,i),{tempToRealId:i.tempToRealId};console.log(`[FigmaMappingService] âŒ No mapping found in GitHub for ${e}`)}catch(i){console.error(`[FigmaMappingService] Error loading mapping from GitHub for ${e}:`,i)}else console.log(`[FigmaMappingService] GitHub integration not available for ${e}`);return console.log(`[FigmaMappingService] âŒ No mapping found anywhere for ${e}`),{tempToRealId:void 0}}};rt(xi,"STORAGE_KEY_PREFIX","figma-mapping:"),rt(xi,"FIGMA_DIR",".figma"),rt(xi,"MAPPINGS_DIR",`${xi.FIGMA_DIR}/mappings`),rt(xi,"autoCommitTimers",new Map),rt(xi,"AUTO_COMMIT_DEBOUNCE_MS",1e4);let Na=xi;const gN=Object.freeze(Object.defineProperty({__proto__:null,FigmaMappingService:Na},Symbol.toStringTag,{value:"Module"}));class yN{constructor(){rt(this,"platformSyntaxPatternService",gc.getInstance());rt(this,"dataSourceManager",xr.getInstance())}async preprocessForFigma(e={}){var c,d;console.log("[FigmaPreprocessor] Starting preprocessing for Figma export...");const r=L.getMergedData();if(!r)throw new Error("No merged data available for Figma export");if(console.log("[FigmaPreprocessor] ðŸ” CRITICAL DEBUG - mergedData dimensionOrder:",r.dimensionOrder),console.log("[FigmaPreprocessor] ðŸ” CRITICAL DEBUG - mergedData dimensions:",(c=r.dimensions)==null?void 0:c.map(u=>({id:u.id,displayName:u.displayName}))),!r.dimensionOrder||r.dimensionOrder.length===0)throw console.error("[FigmaPreprocessor] ðŸš¨ CRITICAL ERROR: mergedData dimensionOrder is missing or empty!"),console.error("[FigmaPreprocessor] ðŸš¨ This will prevent daisy-chaining from working!"),new Error("Design system is missing dimension order. This will prevent proper variable creation.");const n=this.dataSourceManager.getCurrentContext();await this.platformSyntaxPatternService.collectAndStoreSyntaxPatterns();const s=this.determineTargetPlatforms(r.platforms||[],n,e),i=await this.generateCodeSyntax(r,s,e);if(console.log("[FigmaPreprocessor] ðŸ” CRITICAL DEBUG - enhancedTokenSystem dimensionOrder:",i.dimensionOrder),console.log("[FigmaPreprocessor] ðŸ” CRITICAL DEBUG - enhancedTokenSystem dimensions:",(d=i.dimensions)==null?void 0:d.map(u=>({id:u.id,displayName:u.displayName}))),!i.dimensionOrder||i.dimensionOrder.length===0)throw console.error("[FigmaPreprocessor] ðŸš¨ CRITICAL ERROR: enhancedTokenSystem dimensionOrder is missing or empty!"),console.error("[FigmaPreprocessor] ðŸš¨ This will prevent daisy-chaining from working!"),new Error("Dimension order was lost during code syntax generation. This will prevent proper variable creation.");const a=this.validatePreprocessedData(i,s),l={targetPlatforms:s,figmaSyntaxPatterns:this.getFigmaSyntaxPatterns(r),sourceContext:n};return{enhancedTokenSystem:i,context:l,validation:a}}determineTargetPlatforms(e,r,n){let s=e;return r.currentPlatform&&r.currentPlatform!=="none"&&(s=s.filter(i=>i.id===r.currentPlatform),console.log("[FigmaPreprocessor] Filtered to current platform:",r.currentPlatform)),n.targetPlatformIds&&n.targetPlatformIds.length>0&&(s=s.filter(i=>n.targetPlatformIds.includes(i.id)),console.log("[FigmaPreprocessor] Filtered to specific platforms:",n.targetPlatformIds)),s=s.filter(i=>i.figmaPlatformMapping),console.log("[FigmaPreprocessor] Final target platforms with Figma mapping:",s.map(i=>({id:i.id,figmaMapping:i.figmaPlatformMapping}))),s}async generateCodeSyntax(e,r,n){var c,d,u;console.log("[FigmaPreprocessor] Generating code syntax for",r.length,"platforms");const s=this.platformSyntaxPatternService.getAllSyntaxPatterns(),i=this.getFigmaSyntaxPatterns(e);console.log("[FigmaPreprocessor] Using Figma syntax patterns for variable naming:",i);const a=((c=e.tokens)==null?void 0:c.map(m=>{const g={},y=this.generateFigmaVariableName(m,i,e);for(const v of r){const I=s[v.id];if(I&&v.figmaPlatformMapping)try{const S=this.generateFormattedName(m,I,e);g[v.figmaPlatformMapping]=S,console.log(`[FigmaPreprocessor] Generated platform code syntax "${S}" for token ${m.id} on platform ${v.id}`)}catch(S){console.warn(`[FigmaPreprocessor] Failed to generate platform code syntax for token ${m.id} on platform ${v.id}:`,S),g[v.figmaPlatformMapping]=m.displayName}}return{...m,figmaVariableName:y,codeSyntax:Object.keys(g).length>0?g:void 0}}))||[],l={...e,tokens:a,dimensionOrder:e.dimensionOrder,figmaConfiguration:{...e.figmaConfiguration,fileColorProfile:((d=e.figmaConfiguration)==null?void 0:d.fileColorProfile)||"srgb"}};return(!l.dimensionOrder||l.dimensionOrder.length===0)&&(console.error("[FigmaPreprocessor] ðŸš¨ CRITICAL ERROR: dimensionOrder was lost during code syntax generation!"),console.error("[FigmaPreprocessor] ðŸš¨ Attempting to reconstruct from dimensions..."),l.dimensionOrder=((u=e.dimensions)==null?void 0:u.map(m=>m.id))||[],console.log("[FigmaPreprocessor] Reconstructed dimensionOrder:",l.dimensionOrder)),l}generateFigmaVariableName(e,r,n){console.log(`[FigmaPreprocessor] Generating Figma variable name for token ${e.id} using core syntax patterns`);const s=this.extractOrderedTerms(e,n);if(s.length===0)return e.displayName;let i=s.join(r.delimiter||"/");switch(r.capitalization){case"camel":i=i.replace(/(?:^|[-_\s]+)([a-z])/g,(a,l)=>l.toUpperCase());break;case"uppercase":i=i.toUpperCase();break;case"lowercase":i=i.toLowerCase();break;case"capitalize":i=i.split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" ");break}return i=`${r.prefix||""}${i}${r.suffix||""}`,console.log(`[FigmaPreprocessor] Generated Figma variable name "${i}" for token ${e.id}`),i}generateFormattedName(e,r,n){const s=this.extractOrderedTerms(e,n);if(s.length===0)return e.displayName;let i=s.join(r.delimiter||"_");switch(r.capitalization){case"camel":i=i.replace(/(?:^|[-_\s]+)([a-z])/g,(a,l)=>l.toUpperCase());break;case"uppercase":i=i.toUpperCase();break;case"lowercase":i=i.toLowerCase();break;case"capitalize":i=i.split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" ");break}return i=`${r.prefix||""}${i}${r.suffix||""}`,i}extractOrderedTerms(e,r){if(!e.taxonomies||e.taxonomies.length===0)return[];const n=r.taxonomyOrder||[],s=[],i=new Map;return e.taxonomies.forEach(a=>{i.set(a.taxonomyId,a.termId)}),n.forEach(a=>{var c;const l=i.get(a);if(l){const d=(c=r.taxonomies)==null?void 0:c.find(m=>m.id===a),u=d==null?void 0:d.terms.find(m=>m.id===l);u&&s.push(u.name)}}),s}getFigmaSyntaxPatterns(e){var n;const r=(n=e.figmaConfiguration)==null?void 0:n.syntaxPatterns;return r?{prefix:r.prefix||"",suffix:r.suffix||"",delimiter:r.delimiter||"/",capitalization:r.capitalization||"capitalize",formatString:r.formatString||""}:{prefix:"",suffix:"",delimiter:"/",capitalization:"capitalize",formatString:""}}validatePreprocessedData(e,r){var a;const n=[],s=[],i=this.platformSyntaxPatternService.getAllSyntaxPatterns();for(const l of r)i[l.id]||n.push(`Platform ${l.id} missing syntax patterns`);for(const l of e.tokens||[])for(const c of r)c.figmaPlatformMapping&&!((a=l.codeSyntax)!=null&&a[c.figmaPlatformMapping])&&s.push(`Token ${l.id} missing code syntax for platform ${c.id}`);return{isValid:n.length===0,errors:n,warnings:s}}}class F1{constructor(){rt(this,"transformer");rt(this,"preprocessor");this.transformer=new fN,this.preprocessor=new yN}getTokenSystemForExport(){var a,l,c,d;const r=xr.getInstance().getCurrentContext(),n=r.currentPlatform&&r.currentPlatform!=="none",s=r.currentTheme&&r.currentTheme!=="none";if(n||s){console.log("[FigmaExportService] Using merged data for Figma export (platform extension or theme override detected)");const u=gu.getInstance(),m=L.getCoreData(),g=L.getAllPlatformExtensionData(),y=L.getAllThemeOverrideData();if(m){console.log("[FigmaExportService] Core data dimensionOrder before merging:",m.dimensionOrder);const v=u.mergeData(r,m,g,y);console.log("[FigmaExportService] Merged data dimensionOrder after merging:",v.dimensionOrder);const I=((a=m.figmaConfiguration)==null?void 0:a.fileKey)||"default-figma-file",S={...m,tokens:v.tokens,platforms:v.platforms,tokenCollections:m.tokenCollections,dimensions:m.dimensions,resolvedValueTypes:m.resolvedValueTypes,themes:m.themes,taxonomies:m.taxonomies,figmaConfiguration:{...m.figmaConfiguration,fileKey:I,fileColorProfile:((l=m.figmaConfiguration)==null?void 0:l.fileColorProfile)||"srgb"},systemName:m.systemName,systemId:m.systemId,version:m.version,versionHistory:m.versionHistory,dimensionOrder:v.dimensionOrder,taxonomyOrder:m.taxonomyOrder,standardPropertyTypes:m.standardPropertyTypes,componentProperties:m.componentProperties,componentCategories:m.componentCategories,components:m.components,extensions:m.extensions};return console.log("[FigmaExportService] Final tokenSystem dimensionOrder:",S.dimensionOrder),console.log("[FigmaExportService] Merged data stats:",{tokensCount:((c=S.tokens)==null?void 0:c.length)||0,platformsCount:((d=S.platforms)==null?void 0:d.length)||0,currentPlatform:r.currentPlatform,currentTheme:r.currentTheme}),S}}console.log("[FigmaExportService] Using core data for Figma export");const i=L.getCoreData();if(!i)throw new Error("No core data available for Figma export");return i}async getFigmaSyntaxPatternsFromCore(){var e;console.log("[FigmaExportService] Getting Figma syntax patterns from core data...");try{const r=L.getCoreData();return(e=r==null?void 0:r.figmaConfiguration)!=null&&e.syntaxPatterns?(console.log("[FigmaExportService] Found Figma syntax patterns in core data:",r.figmaConfiguration.syntaxPatterns),{prefix:r.figmaConfiguration.syntaxPatterns.prefix||"",suffix:r.figmaConfiguration.syntaxPatterns.suffix||"",delimiter:r.figmaConfiguration.syntaxPatterns.delimiter||"/",capitalization:r.figmaConfiguration.syntaxPatterns.capitalization||"capitalize",formatString:r.figmaConfiguration.syntaxPatterns.formatString||""}):(console.log("[FigmaExportService] No Figma syntax patterns found in core data, using defaults"),{prefix:"",suffix:"",delimiter:"/",capitalization:"capitalize",formatString:""})}catch(r){return console.warn("[FigmaExportService] Error getting Figma syntax patterns from core data:",r),{prefix:"",suffix:"",delimiter:"/",capitalization:"capitalize",formatString:""}}}generateFigmaVariableNames(e,r){return console.log("[FigmaExportService] Generating Figma variable names using syntax patterns:",r),{...e,figmaConfiguration:{...e.figmaConfiguration,syntaxPatterns:r}}}getMappedPlatforms(e){const r=[],n=[];for(const s of e.platforms||[])s.figmaPlatformMapping?r.push({platformId:s.id,figmaPlatform:s.figmaPlatformMapping,displayName:s.displayName}):n.push(s.displayName);return{mappedPlatforms:r,unmappedPlatforms:n}}cleanLegacyPlatformOverrides(e){var s,i;console.log("[FigmaExportService] Cleaning legacy platform data...");const r=new Set(((s=e.platforms)==null?void 0:s.map(a=>a.id))||[]);console.log("[FigmaExportService] Valid platform IDs:",Array.from(r));const n=((i=e.tokens)==null?void 0:i.map(a=>{var c;const l=(c=a.valuesByMode)==null?void 0:c.map(d=>{const{platformOverrides:u,...m}=d;return u&&console.log(`[FigmaExportService] Removed platformOverrides from token ${a.id}`),m});return{...a,valuesByMode:l}}))||[];return{...e,tokens:n}}async exportToFigma(e={},r){var n,s,i;console.log("[FigmaExportService] Starting Figma export...");try{let a;if(r?(console.log("[FigmaExportService] Using provided merged token system"),a=r):(console.log("[FigmaExportService] Getting token system for export..."),a=await this.getTokenSystemForExport()),console.log("[FigmaExportService] ðŸ” CRITICAL DEBUG - tokenSystem dimensionOrder:",a.dimensionOrder),console.log("[FigmaExportService] ðŸ” CRITICAL DEBUG - tokenSystem dimensions:",(n=a.dimensions)==null?void 0:n.map(m=>({id:m.id,displayName:m.displayName}))),console.log("[FigmaExportService] ðŸ” CRITICAL DEBUG - tokenSystem tokens count:",(s=a.tokens)==null?void 0:s.length),!a.dimensionOrder||a.dimensionOrder.length===0)return console.error("[FigmaExportService] ðŸš¨ CRITICAL ERROR: tokenSystem dimensionOrder is missing or empty!"),console.error("[FigmaExportService] ðŸš¨ This will prevent daisy-chaining from working!"),{success:!1,error:{code:"MISSING_DIMENSION_ORDER",message:"Design system is missing dimension order. This will prevent proper variable creation."}};const l={includePlatformCodeSyntax:!0},c=await this.preprocessor.preprocessForFigma(l);if(console.log("[FigmaExportService] ðŸ” CRITICAL DEBUG - preprocessorResult dimensionOrder:",c.enhancedTokenSystem.dimensionOrder),console.log("[FigmaExportService] ðŸ” CRITICAL DEBUG - preprocessorResult dimensions:",(i=c.enhancedTokenSystem.dimensions)==null?void 0:i.map(m=>({id:m.id,displayName:m.displayName}))),!c.enhancedTokenSystem.dimensionOrder||c.enhancedTokenSystem.dimensionOrder.length===0)return console.error("[FigmaExportService] ðŸš¨ CRITICAL ERROR: preprocessorResult dimensionOrder is missing or empty!"),console.error("[FigmaExportService] ðŸš¨ This will prevent daisy-chaining from working!"),{success:!1,error:{code:"PREPROCESSOR_DIMENSION_ORDER_LOST",message:"Dimension order was lost during preprocessing. This will prevent proper variable creation."}};if(!c.validation.isValid)return console.error("[FigmaExportService] Preprocessing validation failed:",c.validation.errors),{success:!1,error:{code:"PREPROCESSING_FAILED",message:"Data preprocessing failed",details:c.validation.errors}};c.validation.warnings.length>0&&console.warn("[FigmaExportService] Preprocessing warnings:",c.validation.warnings);const d=this.buildTransformerOptions(e);console.log("[FigmaExportService] Starting transformation with pre-processed data...");const u=await this.transformer.transform(c.enhancedTokenSystem,d);return u.success?(console.log("[FigmaExportService] Export completed successfully"),{success:!0,data:u.data}):(console.error("[FigmaExportService] Transformation failed:",u.error),{success:!1,error:u.error})}catch(a){return console.error("[FigmaExportService] Unexpected error during export:",a),{success:!1,error:{code:"TRANSFORMATION_ERROR",message:a instanceof Error?a.message:"Unknown transformation error",details:a}}}}buildTransformerOptions(e){const r={updateExisting:!0};return e.fileId&&(r.fileKey=e.fileId),e.accessToken&&(r.accessToken=e.accessToken),r}async getExportPreview(e={}){return this.exportToFigma(e)}validateExportOptions(e){const r=[];return e.createNewFile&&!e.fileName&&r.push("fileName is required when creating a new file"),{isValid:r.length===0,errors:r}}getTransformerInfo(){return this.transformer.getInfo()}async publishToFigma(e={},r){if(console.log("[FigmaExportService] Starting publishing to Figma..."),console.log("[FigmaExportService] Options:",e),console.log("[FigmaExportService] Merged token system provided:",!!r),!e.fileId)return{success:!1,error:{code:"MISSING_FILE_ID",message:"File ID is required for publishing to Figma"}};if(!e.accessToken)return{success:!1,error:{code:"MISSING_ACCESS_TOKEN",message:"Access token is required for publishing to Figma"}};try{const s=xr.getInstance().getCurrentContext();console.log("[FigmaExportService] Debug - Full context:",{currentPlatform:s.currentPlatform,currentTheme:s.currentTheme,repositories:{core:s.repositories.core,platforms:Object.keys(s.repositories.platforms),themes:Object.keys(s.repositories.themes)}});const i=s.currentPlatform?"platform-extension":s.currentTheme?"theme-override":"core";let a=i==="core"?s.repositories.core:i==="platform-extension"?s.repositories.platforms[s.currentPlatform]:s.repositories.themes[s.currentTheme];if(!a){console.log("[FigmaExportService] No repository found in DataSourceManager, trying GitHubApiService fallback...");try{const{GitHubApiService:b}=await ir(async()=>{const{GitHubApiService:A}=await Promise.resolve().then(()=>fo);return{GitHubApiService:A}},void 0),k=b.getSelectedRepositoryInfo();if(k)console.log("[FigmaExportService] Found repository from GitHubApiService:",k),a={fullName:k.fullName,branch:k.branch||"main",filePath:k.filePath,fileType:k.fileType==="theme-override"?"theme-override":"schema"};else{const A=localStorage.getItem("github_selected_repo");if(A)try{const C=JSON.parse(A);console.log("[FigmaExportService] Found repository from localStorage:",C),a={fullName:C.fullName,branch:C.branch||"main",filePath:C.filePath,fileType:C.fileType==="theme-override"?"theme-override":"schema"}}catch(C){console.error("[FigmaExportService] Error parsing stored repository:",C)}else console.log("[FigmaExportService] No repository found in GitHubApiService or localStorage")}}catch(b){console.error("[FigmaExportService] Error getting repository from GitHubApiService:",b)}}if(!a)return{success:!1,error:{code:"NO_REPOSITORY_FOUND",message:`No repository found for ${i}: ${s.currentPlatform||s.currentTheme}. Please ensure you have selected a GitHub repository.`}};console.log("[FigmaExportService] Repository context:",{sourceType:i,targetRepository:a.fullName,currentPlatform:s.currentPlatform,currentTheme:s.currentTheme});const l=await Na.getMappingFromGitHub(e.fileId,{owner:a.fullName.split("/")[0],repo:a.fullName.split("/")[1],type:i,systemId:"design-system"});let c={};l!=null&&l.tempToRealId?(c={...l.tempToRealId},console.log("[FigmaExportService] ðŸ” ORIGINAL tempToRealId mappings loaded:",{count:Object.keys(c).length,mappings:c})):console.log("[FigmaExportService] ðŸ” NO existing tempToRealId mappings found");const d=await this.fetchExistingFigmaData(e.fileId,e.accessToken),u=this.flattenFigmaIds(d);console.log(`[FigmaExportService] ðŸ” Found ${u.length} existing Figma IDs:`,u);const m=this.pruneMappings(c,u);console.log("[FigmaExportService] ðŸ” PRUNED tempToRealId mappings:",{count:Object.keys(m).length,mappings:m});const g={fileKey:e.fileId,accessToken:e.accessToken,updateExisting:!0,existingFigmaData:d,tempToRealId:m};let y;r?(console.log("[FigmaExportService] Using provided merged token system"),y=r):(console.log("[FigmaExportService] Getting token system for export..."),y=await this.getTokenSystemForExport());const v=await this.transformer.transform(y,g);if(!v.success)return v;const I=await this.postToFigmaAPI(v.data,e);console.log("[FigmaExportService] ðŸ” API RESPONSE tempToRealId:",{count:Object.keys(I.tempToRealId).length,mappings:I.tempToRealId});const S={...m,...I.tempToRealId};return console.log("[FigmaExportService] ðŸ” MERGED tempToRealId mappings:",{count:Object.keys(S).length,mappings:S}),await this.saveAndCommitMappings(e.fileId,S,s,a),{success:!0,data:v.data}}catch(n){return console.error("[FigmaExportService] Publishing failed:",n),{success:!1,error:{code:"PUBLISHING_FAILED",message:n instanceof Error?n.message:"Unknown error during publishing"}}}}async publishToFigmaAPI(e,r){console.log("[FigmaExportService] Publishing to Figma API...");const n=await fetch(`https://api.figma.com/v1/files/${r.fileId}/variables`,{method:"POST",headers:{"X-Figma-Token":r.accessToken,"Content-Type":"application/json"},body:JSON.stringify({variables:e.variables,variableCollections:e.collections,variableModes:e.variableModes,variableModeValues:e.variableModeValues})});if(!n.ok){const i=await n.text();return console.error("[FigmaExportService] Figma API error:",n.status,i),{success:!1,error:{code:"FIGMA_API_ERROR",message:`Figma API request failed: ${n.status} ${n.statusText} - ${i}`}}}const s=await n.json();return console.log("[FigmaExportService] Figma API response:",s),await Na.updateMappingFromApiResponse(r.fileId,s),{success:!0,data:e}}async fetchExistingFigmaData(e,r){try{const n=await fetch(`https://api.figma.com/v1/files/${e}/variables/local`,{headers:{"X-Figma-Token":r,"Content-Type":"application/json"}});if(!n.ok){if(n.status===404)return console.log("[FigmaExportService] No existing variables found in Figma file (404)"),null;throw new Error(`Failed to fetch Figma variables: ${n.status}`)}const s=await n.json();return console.log("[FigmaExportService] Successfully fetched existing Figma data"),s}catch(n){return console.error("[FigmaExportService] Error fetching Figma data:",n),null}}flattenFigmaIds(e){const r=[];if(e&&typeof e=="object"&&"variables"in e){const n=e.variables;Object.keys(n).forEach(s=>r.push(s))}if(e&&typeof e=="object"&&"variableCollections"in e){const n=e.variableCollections;Object.keys(n).forEach(s=>r.push(s))}if(e&&typeof e=="object"&&"variableModes"in e){const n=e.variableModes;Object.keys(n).forEach(s=>r.push(s))}return r}pruneMappings(e,r){const n={};let s=0;for(const[i,a]of Object.entries(e))r.includes(a)?n[i]=a:(s++,console.log(`[FigmaExportService] Pruned invalid mapping: ${i} -> ${a}`));return console.log(`[FigmaExportService] Pruned ${s} invalid mappings, kept ${Object.keys(n).length} valid mappings`),n}async postToFigmaAPI(e,r){var a,l;const n=await fetch(`https://api.figma.com/v1/files/${r.fileId}/variables`,{method:"POST",headers:{"X-Figma-Token":r.accessToken,"Content-Type":"application/json"},body:JSON.stringify({variables:e.variables,variableCollections:e.collections,variableModes:e.variableModes,variableModeValues:e.variableModeValues})});if(!n.ok){const c=await n.text();throw new Error(`Figma API request failed: ${n.status} ${n.statusText} - ${c}`)}const s=await n.json();console.log("[FigmaExportService] ðŸ” RAW API RESPONSE:",s),console.log("[FigmaExportService] ðŸ” API RESPONSE KEYS:",Object.keys(s));let i={};return s.tempToRealId?(i=s.tempToRealId,console.log("[FigmaExportService] ðŸ” Found tempToRealId in root:",i)):(a=s.meta)!=null&&a.tempToRealId?(i=s.meta.tempToRealId,console.log("[FigmaExportService] ðŸ” Found tempToRealId in meta:",i)):(l=s.meta)!=null&&l.tempIdToRealId?(i=s.meta.tempIdToRealId,console.log("[FigmaExportService] ðŸ” Found tempIdToRealId in meta:",i)):(console.log("[FigmaExportService] ðŸ” NO tempToRealId found in API response"),console.log("[FigmaExportService] ðŸ” Meta object:",s.meta)),console.log("[FigmaExportService] ðŸ” FINAL tempToRealId extracted:",{count:Object.keys(i).length,mappings:i}),{tempToRealId:i||{}}}async saveAndCommitMappings(e,r,n,s){const i={fileKey:e,systemId:"design-system",lastUpdated:new Date().toISOString(),tempToRealId:r,metadata:{lastExport:new Date().toISOString(),exportVersion:"1.0.0"},repositoryContext:{owner:s.fullName.split("/")[0],repo:s.fullName.split("/")[1],type:n.currentPlatform?"platform-extension":n.currentTheme?"theme-override":"core",systemId:"design-system"}};await Na.saveMappingToGitHub(e,i,{owner:s.fullName.split("/")[0],repo:s.fullName.split("/")[1],type:n.currentPlatform?"platform-extension":n.currentTheme?"theme-override":"core",systemId:"design-system"}),console.log("[FigmaExportService] Successfully saved and committed updated mappings")}}const xN=({isOpen:t,onClose:e,onPublish:r,transformationResult:n,figmaFileId:s,accessToken:i})=>{const{colorMode:a}=Vt(),[l,c]=M.useState(!1),[d,u]=M.useState(null),[m,g]=M.useState([]),[y,v]=M.useState(new Set),[I,S]=M.useState(0);M.useEffect(()=>{t&&s&&i&&b()},[t,s,i]),M.useEffect(()=>{d&&n&&k()},[d,n]);const b=async()=>{c(!0);try{const te=await fetch(`https://api.figma.com/v1/files/${s}/variables/local`,{headers:{"X-Figma-Token":`${i}`,"Content-Type":"application/json"}});if(te.ok){const K=await te.json();u(K)}else te.status===404?(console.log("[FigmaPrePublishDialog] No existing variables found in file (404) - treating as empty file"),u({variables:{},variableCollections:{}})):(console.warn("[FigmaPrePublishDialog] Failed to load existing variables:",te.status,te.statusText),u({variables:{},variableCollections:{}}))}catch(te){console.error("Failed to load existing variables:",te),u({variables:{},variableCollections:{}})}finally{c(!1)}},k=()=>{const te=[],K=Na.getMapping(s),O=(K==null?void 0:K.tempToRealId)||{};n.collections.forEach(Z=>{var $;const ie=O[Z.id]||Z.id,ge=($=d==null?void 0:d.variableCollections)==null?void 0:$[ie],xe={id:Z.id,name:Z.name,type:"collection",action:ge?"UPDATE":"CREATE",currentValue:ge?{name:ge.name,initialModeId:ge.initialModeId}:void 0,newValue:{name:Z.name,initialModeId:Z.initialModeId},hasConflict:ge?ge.name!==Z.name||ge.initialModeId!==Z.initialModeId:!1};te.push(xe)}),n.variables.forEach(Z=>{var $;const ie=O[Z.id]||Z.id,ge=($=d==null?void 0:d.variables)==null?void 0:$[ie],xe={id:Z.id,name:Z.name,type:"variable",action:ge?"UPDATE":"CREATE",currentValue:ge?{name:ge.name,resolvedType:ge.resolvedType,variableCollectionId:ge.variableCollectionId}:void 0,newValue:{name:Z.name,resolvedType:Z.resolvedType,variableCollectionId:Z.variableCollectionId},hasConflict:ge?ge.name!==Z.name||ge.resolvedType!==Z.resolvedType||ge.variableCollectionId!==Z.variableCollectionId:!1};te.push(xe)}),n.variableModes.forEach(Z=>{const ie={id:Z.id,name:Z.name,type:"mode",action:"CREATE",newValue:{name:Z.name,variableCollectionId:Z.variableCollectionId},hasConflict:!1};te.push(ie)}),g(te),v(new Set(te.map(Z=>Z.id)))},A=te=>{const K=new Set(y);K.has(te)?K.delete(te):K.add(te),v(K)},C=()=>{v(new Set(m.map(te=>te.id)))},T=()=>{v(new Set)},P=()=>{const te=m.filter(O=>y.has(O.id)&&O.type==="variable").map(O=>O.id),K=m.filter(O=>y.has(O.id)&&O.type==="collection").map(O=>O.id);r(te,K)},_=te=>{switch(te){case"CREATE":return"green";case"UPDATE":return"blue";case"DELETE":return"red";default:return"gray"}},R=te=>{switch(te){case"variable":return"ðŸ”§";case"collection":return"ðŸ“";case"mode":return"ðŸŽ›ï¸";default:return"ðŸ“„"}},G=m.some(te=>te.hasConflict),ne=y.size,he=m.length;return o.jsxs(Zr,{isOpen:t,onClose:e,size:"6xl",scrollBehavior:"inside",children:[o.jsx(Dr,{}),o.jsxs(Xr,{maxW:"1200px",children:[o.jsx(Rr,{children:o.jsxs(ce,{align:"start",spacing:2,children:[o.jsx(E,{fontSize:"xl",fontWeight:"bold",children:"Pre-Publish Review"}),o.jsx(E,{fontSize:"sm",color:"gray.500",children:"Review changes before publishing to Figma"})]})}),o.jsx(Or,{children:l?o.jsxs(ce,{spacing:4,py:8,children:[o.jsx(kn,{size:"lg"}),o.jsx(E,{children:"Loading existing Figma variables..."})]}):o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsxs(z,{p:4,bg:a==="dark"?"gray.800":"gray.50",borderRadius:"md",children:[o.jsxs(le,{justify:"space-between",mb:3,children:[o.jsx(E,{fontWeight:"bold",children:"Summary"}),o.jsxs(le,{spacing:4,children:[o.jsxs(wt,{colorScheme:"green",children:[n.stats.created," to create"]}),o.jsxs(wt,{colorScheme:"blue",children:[n.stats.updated," to update"]}),o.jsxs(wt,{colorScheme:"purple",children:[n.collections.length," collections"]}),o.jsxs(wt,{colorScheme:"orange",children:[n.variableModes.length," modes"]})]})]}),o.jsxs(E,{fontSize:"sm",color:"gray.500",children:[ne," of ",he," items selected for publishing"]})]}),G&&o.jsxs(zt,{status:"warning",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsx(tn,{children:"Some items have conflicts with existing Figma variables. Review carefully before publishing."})]}),o.jsxs(le,{justify:"space-between",children:[o.jsxs(le,{spacing:3,children:[o.jsx(Oe,{size:"sm",variant:"outline",onClick:C,children:"Select All"}),o.jsx(Oe,{size:"sm",variant:"outline",onClick:T,children:"Deselect All"})]}),o.jsxs(E,{fontSize:"sm",color:"gray.500",children:[ne," selected"]})]}),o.jsxs(Es,{index:I,onChange:S,children:[o.jsxs(Ms,{children:[o.jsxs(pr,{children:["All Items (",m.length,")"]}),o.jsxs(pr,{children:["Collections (",m.filter(te=>te.type==="collection").length,")"]}),o.jsxs(pr,{children:["Variables (",m.filter(te=>te.type==="variable").length,")"]}),o.jsxs(pr,{children:["Modes (",m.filter(te=>te.type==="mode").length,")"]}),G&&o.jsxs(pr,{color:"orange.500",children:["Conflicts (",m.filter(te=>te.hasConflict).length,")"]})]}),o.jsxs(Ls,{children:[o.jsx(Ir,{children:o.jsx(Jl,{items:m,selectedItems:y,onItemToggle:A,getActionColor:_,getTypeIcon:R})}),o.jsx(Ir,{children:o.jsx(Jl,{items:m.filter(te=>te.type==="collection"),selectedItems:y,onItemToggle:A,getActionColor:_,getTypeIcon:R})}),o.jsx(Ir,{children:o.jsx(Jl,{items:m.filter(te=>te.type==="variable"),selectedItems:y,onItemToggle:A,getActionColor:_,getTypeIcon:R})}),o.jsx(Ir,{children:o.jsx(Jl,{items:m.filter(te=>te.type==="mode"),selectedItems:y,onItemToggle:A,getActionColor:_,getTypeIcon:R})}),G&&o.jsx(Ir,{children:o.jsx(Jl,{items:m.filter(te=>te.hasConflict),selectedItems:y,onItemToggle:A,getActionColor:_,getTypeIcon:R})})]})]})]})}),o.jsx(rn,{children:o.jsxs(le,{spacing:3,children:[o.jsx(Oe,{variant:"ghost",onClick:e,children:"Cancel"}),o.jsxs(Oe,{colorScheme:"blue",onClick:P,isDisabled:ne===0,leftIcon:o.jsx(Bf,{size:16}),children:["Publish to Figma (",ne," items)"]})]})})]})]})},Jl=({items:t,selectedItems:e,onItemToggle:r,getActionColor:n,getTypeIcon:s})=>{const{colorMode:i}=Vt();return o.jsx(z,{overflowX:"auto",children:o.jsxs(ho,{variant:"simple",size:"sm",children:[o.jsx(jo,{children:o.jsxs(Nn,{children:[o.jsx(br,{width:"50px",children:o.jsx(sn,{isChecked:t.length>0&&t.every(a=>e.has(a.id)),isIndeterminate:t.some(a=>e.has(a.id))&&!t.every(a=>e.has(a.id)),onChange:a=>{a.target.checked?t.forEach(l=>r(l.id)):t.forEach(l=>r(l.id))}})}),o.jsx(br,{children:"Type"}),o.jsx(br,{children:"Name"}),o.jsx(br,{children:"Action"}),o.jsx(br,{children:"Current Value"}),o.jsx(br,{children:"New Value"}),o.jsx(br,{children:"Status"})]})}),o.jsx(mo,{children:t.map(a=>o.jsxs(Nn,{children:[o.jsx(fr,{children:o.jsx(sn,{isChecked:e.has(a.id),onChange:()=>r(a.id)})}),o.jsx(fr,{children:o.jsxs(le,{spacing:2,children:[o.jsx(E,{children:s(a.type)}),o.jsx(E,{fontSize:"xs",textTransform:"uppercase",children:a.type})]})}),o.jsxs(fr,{children:[o.jsx(E,{fontWeight:"medium",children:a.name}),o.jsx(E,{fontSize:"xs",color:"gray.500",fontFamily:"mono",children:a.id})]}),o.jsx(fr,{children:o.jsx(wt,{colorScheme:n(a.action),children:a.action})}),o.jsx(fr,{children:a.currentValue?o.jsx(z,{fontSize:"xs",fontFamily:"mono",p:2,bg:i==="dark"?"gray.800":"gray.100",borderRadius:"md",children:JSON.stringify(a.currentValue,null,2)}):o.jsx(E,{fontSize:"xs",color:"gray.400",children:"â€”"})}),o.jsx(fr,{children:o.jsx(z,{fontSize:"xs",fontFamily:"mono",p:2,bg:i==="dark"?"gray.800":"gray.100",borderRadius:"md",children:JSON.stringify(a.newValue,null,2)})}),o.jsx(fr,{children:a.hasConflict?o.jsxs(le,{spacing:1,children:[o.jsx(Ro,{size:14,color:"orange"}),o.jsx(E,{fontSize:"xs",color:"orange.500",children:"Conflict"})]}):o.jsxs(le,{spacing:1,children:[o.jsx(Fd,{size:14,color:"green"}),o.jsx(E,{fontSize:"xs",color:"green.500",children:"OK"})]})})]},a.id))})]})})};class M4{static getConfiguration(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return null;const r=JSON.parse(e);return!r.syntaxPatterns||!r.fileKey?(console.warn("[FigmaConfigurationService] Invalid configuration found, resetting to defaults"),null):r}catch(e){return console.error("[FigmaConfigurationService] Error loading configuration:",e),null}}static saveConfiguration(e){try{const r={...e,lastUpdated:new Date().toISOString()};return localStorage.setItem(this.STORAGE_KEY,JSON.stringify(r)),console.log("[FigmaConfigurationService] Configuration saved:",r),!0}catch(r){return console.error("[FigmaConfigurationService] Error saving configuration:",r),!1}}static getDefaultConfiguration(){return{syntaxPatterns:{prefix:"",suffix:"",delimiter:"_",capitalization:"none",formatString:""},fileKey:"",accessToken:"",autoPublish:!1,publishStrategy:"merge"}}static loadFromTokenSystem(){return this.getDefaultConfiguration()}static updateSyntaxPatterns(e){const r=this.getConfiguration()||this.getDefaultConfiguration();return this.saveConfiguration({...r,syntaxPatterns:e})}static updateFileKey(e){const r=this.getConfiguration()||this.getDefaultConfiguration();return this.saveConfiguration({...r,fileKey:e})}static updateAccessToken(e){const r=this.getConfiguration()||this.getDefaultConfiguration();return this.saveConfiguration({...r,accessToken:e})}static updateAutoPublishSettings(e,r){const n=this.getConfiguration()||this.getDefaultConfiguration();return this.saveConfiguration({...n,autoPublish:e,publishStrategy:r})}static validateConfiguration(e){const r=[];return e.fileKey||r.push("File key is required"),e.syntaxPatterns?(e.syntaxPatterns.delimiter&&!["","_","-",".","/"].includes(e.syntaxPatterns.delimiter)&&r.push("Invalid delimiter value"),e.syntaxPatterns.capitalization&&!["none","uppercase","lowercase","capitalize"].includes(e.syntaxPatterns.capitalization)&&r.push("Invalid capitalization value")):r.push("Syntax patterns are required"),e.autoPublish&&!e.publishStrategy&&r.push("Publish strategy is required when auto publish is enabled"),e.publishStrategy&&!["merge","commit"].includes(e.publishStrategy)&&r.push("Invalid publish strategy"),{isValid:r.length===0,errors:r}}static clearConfiguration(){localStorage.removeItem(this.STORAGE_KEY),console.log("[FigmaConfigurationService] Configuration cleared")}static exportConfiguration(){const e=this.getConfiguration();if(!e)throw new Error("No configuration to export");return JSON.stringify(e,null,2)}static importConfiguration(e){try{const r=JSON.parse(e),n=this.validateConfiguration(r);return n.isValid?this.saveConfiguration(r):(console.error("[FigmaConfigurationService] Invalid configuration during import:",n.errors),!1)}catch(r){return console.error("[FigmaConfigurationService] Error importing configuration:",r),!1}}}rt(M4,"STORAGE_KEY","figma-configuration");function vN({open:t,onClose:e,onSave:r,collection:n,isNew:s=!1,resolvedValueTypes:i}){const[a,l]=M.useState({name:"",description:"",resolvedValueTypeIds:[],private:!1}),[c,d]=M.useState({}),u=Hr();M.useEffect(()=>{if(t){if(n){const y=n;l({name:n.name||"",description:n.description||"",resolvedValueTypeIds:y.resolvedValueTypeIds||[],private:!!n.private})}else l({name:"",description:"",resolvedValueTypeIds:[],private:!1});d({})}},[t,n]);const m=(y,v)=>{l(I=>({...I,[y]:v}))},g=()=>{if(d({}),!a.name||!a.name.trim()){d({name:"Name is required"}),u({title:"Validation Error",description:"Name is required",status:"error",duration:2e3});return}if(!Array.isArray(a.resolvedValueTypeIds)||a.resolvedValueTypeIds.length===0){d({resolvedValueTypeIds:"At least one value type is required"}),u({title:"Validation Error",description:"At least one value type is required",status:"error",duration:2e3});return}r({...n,name:a.name,description:a.description,resolvedValueTypeIds:a.resolvedValueTypeIds,private:!!a.private,id:(n==null?void 0:n.id)||crypto.randomUUID()})};return o.jsxs(Zr,{isOpen:t,onClose:e,size:"md",children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:s?"Create Collection":"Edit Collection"}),o.jsx(Hn,{}),o.jsx(Or,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(Ye,{isInvalid:!!c.name,isRequired:!0,children:[o.jsx(Qe,{children:"Name"}),o.jsx(yt,{value:a.name||"",onChange:y=>m("name",y.target.value)}),c.name&&o.jsx(E,{color:"red.500",fontSize:"sm",children:c.name})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(yt,{value:a.description||"",onChange:y=>m("description",y.target.value),as:"textarea",rows:2})]}),o.jsx(Ye,{isInvalid:!!c.resolvedValueTypeIds,isRequired:!0,children:o.jsx(DS,{value:a.resolvedValueTypeIds,onChange:y=>m("resolvedValueTypeIds",y),label:"Resolved Value Types",isRequired:!0,error:c.resolvedValueTypeIds})}),o.jsx(Ye,{children:o.jsx(sn,{isChecked:!!a.private,onChange:y=>m("private",y.target.checked),children:"Private"})})]})}),o.jsxs(rn,{children:[o.jsx(Oe,{variant:"ghost",mr:3,onClick:e,children:"Cancel"}),o.jsx(Oe,{colorScheme:"blue",onClick:g,children:s?"Create":"Save"})]})]})]})}function A4({collections:t,onUpdate:e,tokens:r,resolvedValueTypes:n,canEdit:s=!1}){const{colorMode:i}=Vt(),[a,l]=M.useState(!1),[c,d]=M.useState(null),[u,m]=M.useState(!1),g=Hr();function y(C){return r.filter(T=>T.tokenCollectionId===C.id&&!C.resolvedValueTypeIds.includes(T.resolvedValueTypeId)).length}function v(C){return r.filter(T=>T.tokenCollectionId===C.id&&!C.resolvedValueTypeIds.includes(T.resolvedValueTypeId)).map(T=>{const P=n.find(_=>_.id===T.resolvedValueTypeId);return{name:T.displayName,type:(P==null?void 0:P.displayName)||T.resolvedValueTypeId}})}const I=()=>{d(null),m(!0),l(!0)},S=C=>{d(C),m(!1),l(!0)},b=C=>{let T;u?T=[...t,C]:T=t.map(P=>P.id===C.id?C:P),e(T),g({title:u?"Collection created":"Collection updated",status:"success",duration:2e3}),l(!1)},k=()=>{l(!1)},A=C=>{const T=t.filter(P=>P.id!==C);e(T),g({title:"Collection deleted",status:"info",duration:2e3})};return o.jsxs(z,{children:[o.jsx(E,{fontSize:"2xl",fontWeight:"bold",mb:4,children:"Collections"}),o.jsxs(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:i==="dark"?"gray.900":"white",children:[s&&o.jsx(Oe,{size:"sm",onClick:I,colorScheme:"blue",mb:4,leftIcon:o.jsx(xs,{}),children:"Create New Collection"}),o.jsx(ce,{align:"stretch",spacing:2,children:t.map(C=>{const T=C.resolvedValueTypeIds.length===1;return o.jsxs(z,{p:3,borderWidth:1,borderRadius:"md",bg:i==="dark"?"gray.800":"gray.50",borderColor:i==="dark"?"gray.600":"gray.200",children:[o.jsxs(le,{justify:"space-between",align:"center",children:[o.jsx(z,{children:o.jsxs(le,{children:[o.jsx(_o,{title:C.name,cardType:"collection"}),T&&o.jsx(Cn,{label:"Type-based collections support only one resolved value type",placement:"top",children:o.jsx(Yn,{size:"sm",colorScheme:"blackAlpha",ml:2,children:"Type-based"})})]})}),s&&o.jsxs(le,{children:[o.jsx(Bt,{"aria-label":"Edit collection",icon:o.jsx(ys,{}),size:"sm",onClick:()=>S(C)}),o.jsx(Bt,{"aria-label":"Delete collection",icon:o.jsx(As,{}),size:"sm",colorScheme:"red",onClick:()=>A(C.id)})]})]}),o.jsxs(ce,{align:"start",spacing:1,mt:2,ml:2,children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:o.jsx("b",{children:"Value Types:"})}),o.jsx(Ra,{spacing:2,children:Array.isArray(C.resolvedValueTypeIds)&&C.resolvedValueTypeIds.map(P=>{const _=n.find(te=>te.id===P),R=r.filter(te=>te.tokenCollectionId===C.id&&te.resolvedValueTypeId===P).length,G=r.filter(te=>!te.tokenCollectionId&&te.resolvedValueTypeId===P).length,ne=R+G,he=[R>0?`${R} ${R===1?"token is":"tokens are"} assigned to this collection`:null,G>0?`${G} ${G===1?"token is":"tokens are"} compatible but not assigned`:null].filter(Boolean).join(`
`);return _?o.jsx(Cn,{label:he,placement:"top",hasArrow:!0,children:o.jsx(Yn,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"blue",children:o.jsxs(Ni,{children:[_.displayName," (",ne,")"]})})},P):null})}),y(C)>0&&o.jsxs(zt,{status:"warning",size:"sm",mt:2,borderRadius:"md",children:[o.jsx(Lt,{}),v(C).map((P,_)=>o.jsxs(E,{fontSize:"sm",children:["Token '",P.name,"' has type '",P.type,"' which is not supported by collection '",C.name,"'"]},_))]}),C.private&&o.jsx(E,{fontSize:"sm",color:"gray.500",children:o.jsx("b",{children:"Private"})})]})]},C.id)})})]}),o.jsx(vN,{open:a,onClose:k,onSave:b,collection:c,isNew:u,resolvedValueTypes:n})]})}const bN=({tokenSystem:t,canEdit:e=!1,dataSourceContext:r,hasEditPermissions:n})=>{const{colorMode:s}=Vt(),i=Hr(),[a,l]=M.useState(""),[c,d]=M.useState(""),[u,m]=M.useState("srgb"),[g,y]=M.useState(!1),[v,I]=M.useState(!1),[S,b]=M.useState(!1),[k,A]=M.useState(null),[C,T]=M.useState(!0),[P,_]=M.useState(null),[R,G]=M.useState(!1),[ne,he]=M.useState({prefix:"",suffix:"",delimiter:"_",capitalization:"none",formatString:""}),te=async()=>{var Y,Ce,ue,Ee;console.log("[FigmaConfigurationsView] ðŸ”„ SAFETY: Force refreshing data before Figma operation..."),await xr.getInstance().forceRefreshPermissions();const _e=L.getSourceContext();console.log("[FigmaConfigurationsView] ðŸ”„ Fresh source context:",_e),console.log("[FigmaConfigurationsView] ðŸ”„ Loading Figma mappings data...");try{const{FigmaMappingService:ze}=await ir(async()=>{const{FigmaMappingService:De}=await Promise.resolve().then(()=>gN);return{FigmaMappingService:De}},void 0);if(c){console.log("[FigmaConfigurationsView] ðŸ”„ Loading mappings for file key:",c);let De=ze.getMapping(c);if(console.log("[FigmaConfigurationsView] ðŸ”„ Local mappings:",{hasMappings:!!De,tempToRealIdCount:De!=null&&De.tempToRealId?Object.keys(De.tempToRealId).length:0}),!De){console.log("[FigmaConfigurationsView] ðŸ”„ No local mapping found, trying GitHub...");const Ke=await ze.getCurrentRepositoryInfo();Ke?(console.log("[FigmaConfigurationsView] ðŸ”„ Loading from GitHub with repo info:",Ke),De=await ze.getMappingFromGitHub(c,Ke),De?console.log("[FigmaConfigurationsView] ðŸ”„ GitHub mappings loaded:",{hasMappings:!!De,tempToRealIdCount:De!=null&&De.tempToRealId?Object.keys(De.tempToRealId).length:0}):console.log("[FigmaConfigurationsView] ðŸ”„ No GitHub mapping found either")):console.log("[FigmaConfigurationsView] ðŸ”„ No repository info available for GitHub loading")}console.log("[FigmaConfigurationsView] ðŸ”„ Final mappings status:",{hasMappings:!!De,tempToRealIdCount:De!=null&&De.tempToRealId?Object.keys(De.tempToRealId).length:0,fileKey:c})}else console.warn("[FigmaConfigurationsView] ðŸ”„ No file key available, skipping mappings load")}catch(ze){console.error("[FigmaConfigurationsView] ðŸ”„ Failed to load Figma mappings:",ze)}if((_e==null?void 0:_e.sourceType)==="core"||!_e){console.log("[FigmaConfigurationsView] ðŸ”„ Refreshing core data...");const ze=L.getCoreData();if(console.log("[FigmaConfigurationsView] ðŸ”„ Core data refreshed:",{hasData:!!ze,tokenCount:((Y=ze==null?void 0:ze.tokens)==null?void 0:Y.length)||0,dimensionOrder:ze==null?void 0:ze.dimensionOrder}),!ze)return console.warn("[FigmaConfigurationsView] ðŸ”„ No core data available after refresh, using fallback"),Sl();if(!ze.dimensionOrder||ze.dimensionOrder.length===0){const De=L.getDimensionOrder();De&&De.length>0&&(console.log("[FigmaConfigurationsView] ðŸ”„ Adding dimensionOrder from localStorage:",De),ze.dimensionOrder=De)}return console.log("[FigmaConfigurationsView] ðŸ”„ Core data ready for Figma:",{dimensionOrder:ze.dimensionOrder,tokenCount:((Ce=ze.tokens)==null?void 0:Ce.length)||0}),ze}else{console.log("[FigmaConfigurationsView] ðŸ”„ Refreshing merged data for:",{sourceType:_e.sourceType,sourceId:_e.sourceId});const De=await Ma.getInstance().computeMergedData();return console.log("[FigmaConfigurationsView] ðŸ”„ Merged data refreshed:",{hasData:!!De,tokenCount:((ue=De==null?void 0:De.tokens)==null?void 0:ue.length)||0,dimensionOrder:De==null?void 0:De.dimensionOrder}),De?(console.log("[FigmaConfigurationsView] ðŸ”„ Merged data ready for Figma:",{dimensionOrder:De.dimensionOrder,tokenCount:((Ee=De.tokens)==null?void 0:Ee.length)||0}),De):(console.warn("[FigmaConfigurationsView] ðŸ”„ No merged data available after refresh, using core data fallback"),L.getCoreData()||Sl())}},K=L.getMergedData(),O=(K==null?void 0:K.tokenCollections)||[],Z=(K==null?void 0:K.tokens)||[],ie=(K==null?void 0:K.resolvedValueTypes)||[];M.useEffect(()=>{const fe=()=>{console.log("[FigmaConfigurationsView] Data source changed, updating Publishing tab visibility")};window.addEventListener("token-model:data-source-changed",fe);const _e=()=>{console.log("[FigmaConfigurationsView] URL changed, updating Publishing tab visibility")};return window.addEventListener("popstate",_e),()=>{window.removeEventListener("token-model:data-source-changed",fe),window.removeEventListener("popstate",_e)}},[]),M.useEffect(()=>{const fe=async()=>{var Ue;T(!0);const Y=L.getSourceContext();((r==null?void 0:r.currentPlatform)!==((Y==null?void 0:Y.sourceType)==="platform"?Y==null?void 0:Y.sourceId:null)||(r==null?void 0:r.currentTheme)!==((Y==null?void 0:Y.sourceType)==="theme"?Y==null?void 0:Y.sourceId:null))&&console.warn("[FigmaConfigurationsView] Props mismatch with current source context:",{propsPlatform:r==null?void 0:r.currentPlatform,propsTheme:r==null?void 0:r.currentTheme,currentSourceType:Y==null?void 0:Y.sourceType,currentSourceId:Y==null?void 0:Y.sourceId}),r!=null&&r.editMode.isActive&&uo.initializeSession(r);let Ce="",ue={},Ee="srgb";const ze=L.getCoreData(),De=L.getLocalEdits(),Ke=L.getSourceContext(),ve=(Ke==null?void 0:Ke.sourceType)||"core",Te=Ke==null?void 0:Ke.sourceId;if(console.log("[FigmaConfigurationsView] Loading config for:",{currentSourceType:ve,currentSourceId:Te,isEditMode:r==null?void 0:r.editMode.isActive}),console.log("[FigmaConfigurationsView] Core data available:",!!ze),console.log("[FigmaConfigurationsView] Local edits available:",!!De),r!=null&&r.editMode.isActive){const Je=uo.getStagedConfigurationChanges();console.log("[FigmaConfigurationsView] Checking for staged changes..."),console.log("[FigmaConfigurationsView] Staged changes found:",Je),Je?(console.log("[FigmaConfigurationsView] === USING STAGED CHANGES ==="),console.log("[FigmaConfigurationsView] Staged figmaFileKey:",Je.figmaFileKey),console.log("[FigmaConfigurationsView] Staged fileColorProfile:",Je.fileColorProfile),console.log("[FigmaConfigurationsView] Staged syntaxPatterns:",Je.syntaxPatterns),Ce=Je.figmaFileKey||"",Ee=Je.fileColorProfile||"srgb",ue=Je.syntaxPatterns||{}):console.log("[FigmaConfigurationsView] No staged changes found")}else console.log("[FigmaConfigurationsView] Not in edit mode, skipping staged changes check");if(!Ce&&!ue.prefix){if(console.log("[FigmaConfigurationsView] No staged changes found, loading from source data"),console.log("[FigmaConfigurationsView] Current source type:",ve),console.log("[FigmaConfigurationsView] Current source ID:",Te),ve==="core"){const Je=De||ze,ut=Je==null?void 0:Je.figmaConfiguration;console.log("[FigmaConfigurationsView] === CORE DATA SOURCE ==="),console.log("[FigmaConfigurationsView] Source: localEdits.figmaConfiguration or coreData.figmaConfiguration"),console.log("[FigmaConfigurationsView] Raw figmaConfiguration:",ut),console.log("[FigmaConfigurationsView] figmaConfiguration.fileKey:",ut==null?void 0:ut.fileKey),console.log("[FigmaConfigurationsView] figmaConfiguration.fileColorProfile:",ut==null?void 0:ut.fileColorProfile),console.log("[FigmaConfigurationsView] figmaConfiguration.syntaxPatterns:",ut==null?void 0:ut.syntaxPatterns),ut?(Ce=ut.fileKey||"",Ee=ut.fileColorProfile||"srgb",ue=ut.syntaxPatterns||{},console.log("[FigmaConfigurationsView] Extracted core fileKey:",Ce),console.log("[FigmaConfigurationsView] Extracted core fileColorProfile:",Ee),console.log("[FigmaConfigurationsView] Extracted core syntaxPatterns:",ue)):console.log("[FigmaConfigurationsView] WARNING: No figmaConfiguration found in source data")}else if(ve==="platform"&&Te){console.log("[FigmaConfigurationsView] === PLATFORM EXTENSION SOURCE ==="),console.log("[FigmaConfigurationsView] Source ID:",Te);const Je=L.getPlatformExtensionData(Te)||De;console.log("[FigmaConfigurationsView] Platform data:",Je),Je?(Ce=Je.figmaFileKey||"",Ee=Je.fileColorProfile||"srgb",console.log("[FigmaConfigurationsView] Extracted platform fileKey:",Ce),console.log("[FigmaConfigurationsView] Extracted platform fileColorProfile:",Ee)):console.log("[FigmaConfigurationsView] WARNING: No platform data found for ID:",Te)}else if(ve==="theme"&&Te){console.log("[FigmaConfigurationsView] === THEME OVERRIDE SOURCE ==="),console.log("[FigmaConfigurationsView] Source ID:",Te);const Je=L.getThemeOverrideData(Te)||De;console.log("[FigmaConfigurationsView] Theme data:",Je),Je?(Ce=Je.figmaFileKey||"",Ee=Je.fileColorProfile||"srgb",console.log("[FigmaConfigurationsView] Extracted theme fileKey:",Ce),console.log("[FigmaConfigurationsView] Extracted theme fileColorProfile:",Ee)):console.log("[FigmaConfigurationsView] WARNING: No theme data found for ID:",Te)}}else console.log("[FigmaConfigurationsView] Using staged changes, skipping source data loading");(Ue=ze==null?void 0:ze.figmaConfiguration)!=null&&Ue.syntaxPatterns?(ue=ze.figmaConfiguration.syntaxPatterns,console.log("[FigmaConfigurationsView] Using core syntax patterns:",ue)):console.log("[FigmaConfigurationsView] WARNING: No syntax patterns found in core data"),console.log("[FigmaConfigurationsView] === FINAL CONFIGURATION ==="),console.log("[FigmaConfigurationsView] Final sourceFileKey:",Ce),console.log("[FigmaConfigurationsView] Final sourceFileColorProfile:",Ee),console.log("[FigmaConfigurationsView] Final sourceSyntaxPatterns:",ue),d(Ce);const je={prefix:ue.prefix||"",suffix:ue.suffix||"",delimiter:ue.delimiter||"_",capitalization:ue.capitalization==="camel"?"none":ue.capitalization||"none",formatString:ue.formatString||""};he(je),m(Ee),console.log("[FigmaConfigurationsView] === UI STATE UPDATES ==="),console.log("[FigmaConfigurationsView] Setting fileKey state to:",Ce),console.log("[FigmaConfigurationsView] Setting syntaxPatterns state to:",je),console.log("[FigmaConfigurationsView] Setting fileColorProfile state to:",Ee);const Fe=M4.getConfiguration();Fe&&l(Fe.accessToken||"");try{const Je=L.getSourceSnapshot(),ut=L.getLocalEdits();if(console.log("[FigmaConfigurationsView] Checking change tracking with new system:",{hasSourceSnapshot:!!Je,hasLocalEdits:!!ut,sourceSnapshotType:Je?typeof Je:"null",localEditsType:ut?typeof ut:"null"}),!Je||!ut)console.log("[FigmaConfigurationsView] Missing data for change tracking, allowing export"),A({hasLocalChanges:!1,hasGitHubDivergence:!1,canExport:!0,changeCount:0});else{const Ze=Nb(Je,ut),At=Ze.length>0;console.log("[FigmaConfigurationsView] Change detection results:",{totalChanges:Ze.length,hasLocalChanges:At,changes:Ze.map(vr=>`${vr.type} ${vr.entityType}: ${vr.entityName}`)}),A({hasLocalChanges:At,hasGitHubDivergence:!1,canExport:!At,changeCount:Ze.length})}}catch(Je){console.error("[FigmaConfigurationsView] Error checking change tracking:",Je),A({hasLocalChanges:!1,hasGitHubDivergence:!1,canExport:!0,changeCount:0})}finally{T(!1)}};fe();const _e=()=>{fe()};return window.addEventListener("token-model:data-change",_e),()=>{window.removeEventListener("token-model:data-change",_e)}},[t.figmaConfiguration,r]);const ge=async()=>{var fe,_e;if(!a||!c){i({title:"Missing credentials",description:"Please enter both access token and file key",status:"warning",duration:3e3,isClosable:!0});return}try{console.log("[FigmaConfigurationsView] Test 1: Getting file info...");const Y=await fetch(`https://api.figma.com/v1/files/${c}`,{method:"GET",headers:{"X-Figma-Token":`${a}`,"Content-Type":"application/json"}});if(console.log("[FigmaConfigurationsView] File response status:",Y.status),Y.ok){const ue=await Y.json();console.log("[FigmaConfigurationsView] File data:",ue),i({title:"Token test successful",description:`File: ${ue.name}`,status:"success",duration:5e3,isClosable:!0})}else{const ue=await Y.text();console.error("[FigmaConfigurationsView] File test failed:",Y.status,ue),i({title:"Token test failed",description:`File access failed: ${Y.status}`,status:"error",duration:5e3,isClosable:!0})}console.log("[FigmaConfigurationsView] Test 2: Getting variables...");const Ce=await fetch(`https://api.figma.com/v1/files/${c}/variables`,{method:"GET",headers:{"X-Figma-Token":`${a}`,"Content-Type":"application/json"}});if(console.log("[FigmaConfigurationsView] Variables response status:",Ce.status),Ce.ok){const ue=await Ce.json();console.log("[FigmaConfigurationsView] Variables data:",ue),i({title:"Variables access successful",description:`Found ${((_e=(fe=ue.meta)==null?void 0:fe.variables)==null?void 0:_e.length)||0} variables`,status:"success",duration:5e3,isClosable:!0})}else{const ue=await Ce.text();console.error("[FigmaConfigurationsView] Variables test failed:",Ce.status,ue),i({title:"Variables access failed",description:`Variables access failed: ${Ce.status}`,status:"error",duration:5e3,isClosable:!0})}}catch(Y){console.error("[FigmaConfigurationsView] Test failed:",Y),i({title:"Test failed",description:Y instanceof Error?Y.message:"An unknown error occurred",status:"error",duration:5e3,isClosable:!0})}},xe=async()=>{var fe,_e,Y,Ce,ue;if(!(!a||!c)){I(!0);try{console.log("[FigmaConfigurationsView] Starting Figma publishing...");let Ee;try{Ee=await te()}catch(Ke){console.error("[FigmaConfigurationsView] Failed to refresh data for publishing:",Ke),i({title:"Publishing failed",description:"Could not refresh design system data. Please try again.",status:"error",duration:5e3,isClosable:!0});return}if(console.log("[FigmaConfigurationsView] Using complete token system for publishing"),console.log("[FigmaConfigurationsView] Token system stats:",{tokensCount:((fe=Ee.tokens)==null?void 0:fe.length)||0,collectionsCount:((_e=Ee.tokenCollections)==null?void 0:_e.length)||0,dimensionsCount:((Y=Ee.dimensions)==null?void 0:Y.length)||0}),console.log("[FigmaConfigurationsView] ðŸ” CRITICAL DEBUG - dimensionOrder before FigmaExportService:",Ee.dimensionOrder),console.log("[FigmaConfigurationsView] ðŸ” CRITICAL DEBUG - dimensions before FigmaExportService:",(Ce=Ee.dimensions)==null?void 0:Ce.map(Ke=>({id:Ke.id,displayName:Ke.displayName}))),!Ee.dimensionOrder||Ee.dimensionOrder.length===0){console.error("[FigmaConfigurationsView] ðŸš¨ CRITICAL ERROR: dimensionOrder is missing or empty!"),console.error("[FigmaConfigurationsView] ðŸš¨ This will prevent daisy-chaining from working!"),i({title:"No Design System Data Found",description:"No design system data is loaded. Please load example data or connect to a GitHub repository first.",status:"error",duration:8e3,isClosable:!0});return}const De=await new F1().publishToFigma({accessToken:a,fileId:c},Ee);De.success?(_(De),i({title:"Published successfully",description:"Your design tokens have been published to Figma.",status:"success",duration:5e3,isClosable:!0})):i({title:"Publishing failed",description:((ue=De.error)==null?void 0:ue.message)||"An unknown error occurred during publishing.",status:"error",duration:5e3,isClosable:!0})}catch(Ee){console.error("[FigmaConfigurationsView] Publishing failed:",Ee),i({title:"Publishing failed",description:Ee instanceof Error?Ee.message:"An unknown error occurred during publishing.",status:"error",duration:5e3,isClosable:!0})}finally{I(!1)}}},$=async()=>{var fe;if(!(!a||!c)){y(!0);try{console.log("[FigmaConfigurationsView] Starting export only...");let _e;try{_e=await te()}catch(ue){console.error("[FigmaConfigurationsView] Failed to refresh data for export:",ue),i({title:"Export failed",description:"Could not refresh design system data. Please try again.",status:"error",duration:5e3,isClosable:!0});return}console.log("[FigmaConfigurationsView] Canonical token system:",_e);const Ce=await new F1().exportToFigma({accessToken:a,fileId:c},_e);console.log("[FigmaConfigurationsView] Export result:",Ce),_(Ce),Ce.success&&Ce.data?i({title:"Export successful",description:`Generated ${Ce.data.variables.length} variables and ${Ce.data.collections.length} collections`,status:"success",duration:5e3,isClosable:!0}):i({title:"Export failed",description:((fe=Ce.error)==null?void 0:fe.message)||"Unknown error occurred",status:"error",duration:5e3,isClosable:!0})}catch(_e){console.error("[FigmaConfigurationsView] Export failed:",_e),i({title:"Export failed",description:_e instanceof Error?_e.message:"Unknown error occurred",status:"error",duration:5e3,isClosable:!0})}finally{y(!1)}}},B=()=>{if(!(P!=null&&P.data))return;const fe=new Blob([JSON.stringify(P.data,null,2)],{type:"application/json"}),_e=URL.createObjectURL(fe),Y=document.createElement("a");Y.href=_e,Y.download="figma-variables-export.json",document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),URL.revokeObjectURL(_e),i({title:"Download started",description:"Figma variables export downloaded",status:"success",duration:3e3,isClosable:!0})},U=()=>{P!=null&&P.data&&(navigator.clipboard.writeText(JSON.stringify(P.data,null,2)),i({title:"Copied to clipboard",description:"Figma variables export copied to clipboard",status:"success",duration:3e3,isClosable:!0}))},X=fe=>{if(!(r!=null&&r.editMode.isActive))return;he(fe);const _e={...fe,capitalization:fe.capitalization==="none"?"camel":fe.capitalization},{sourceType:Y,sourceId:Ce}=r.editMode;if(Y==="core"){const ue={fileKey:c,syntaxPatterns:_e};L.setFigmaConfiguration(ue),window.dispatchEvent(new CustomEvent("token-model:data-change"))}else Y==="platform-extension"&&Ce?uo.stageConfigurationChange(c,_e):Y==="theme-override"&&Ce&&console.log("[FigmaConfigurationsView] Theme overrides do not support syntax pattern changes")},ee=fe=>{var Ce,ue;if(!(r!=null&&r.editMode.isActive))return;d(fe);const{sourceType:_e,sourceId:Y}=r.editMode;if(_e==="core"){const Ee={fileKey:fe,syntaxPatterns:(Ce=t.figmaConfiguration)==null?void 0:Ce.syntaxPatterns};L.setFigmaConfiguration(Ee),window.dispatchEvent(new CustomEvent("token-model:data-change"))}else _e==="platform-extension"&&Y?uo.stageConfigurationChange(fe,(ue=t.figmaConfiguration)==null?void 0:ue.syntaxPatterns):_e==="theme-override"&&Y&&uo.stageConfigurationChange(fe)},be=fe=>{var Ce,ue;if(!(r!=null&&r.editMode.isActive))return;m(fe);const{sourceType:_e,sourceId:Y}=r.editMode;if(_e==="core"){const Ee={fileKey:c,syntaxPatterns:(Ce=t.figmaConfiguration)==null?void 0:Ce.syntaxPatterns,fileColorProfile:fe};L.setFigmaConfiguration(Ee),window.dispatchEvent(new CustomEvent("token-model:data-change"))}else _e==="platform-extension"&&Y?uo.stageConfigurationChange(c,(ue=t.figmaConfiguration)==null?void 0:ue.syntaxPatterns,fe):_e==="theme-override"&&Y&&uo.stageConfigurationChange(c,void 0,fe)},Se=()=>{const fe=L.getSourceContext();return((fe==null?void 0:fe.sourceType)||"core")==="core"},Me=()=>{const fe=(n==null?void 0:n())??!1;return console.log("[FigmaConfigurationsView] Publishing tab visibility check:",{hasEditPermissions:fe,shouldShow:fe}),fe},se=()=>C?o.jsxs(zt,{status:"info",borderRadius:"md",children:[o.jsx(Lt,{as:kn}),o.jsx(tn,{children:"Checking for unsaved changes..."})]}):k!=null&&k.canExport?null:o.jsxs(zt,{status:"error",borderRadius:"md",children:[o.jsx(Lt,{as:Ro}),o.jsx(tn,{children:k!=null&&k.hasLocalChanges&&(k!=null&&k.hasGitHubDivergence)?`Export blocked: ${k==null?void 0:k.changeCount} local changes detected AND data has diverged from baseline. Please save your changes first.`:k!=null&&k.hasLocalChanges?`Export blocked: ${k==null?void 0:k.changeCount} local changes detected. Please save your changes first.`:"Export blocked: Local data has diverged from baseline. Please sync with GitHub first."})]}),de=()=>o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsxs(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:s==="dark"?"gray.900":"white",children:[o.jsx(Tt,{size:"md",mb:0,children:"Figma Credentials"}),o.jsxs(ce,{spacing:6,align:"stretch",children:[se(),o.jsx(z,{children:o.jsxs(ce,{spacing:4,align:"stretch",children:[o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Figma Access Token"}),o.jsxs(Ef,{children:[o.jsx(yt,{type:"password",value:a,onChange:fe=>l(fe.target.value),placeholder:"figd_...",fontFamily:"mono"}),o.jsx($v,{width:"auto",mr:2,children:o.jsx(Oe,{size:"sm",variant:"outline",onClick:ge,isDisabled:!a||!c,leftIcon:o.jsx(Ak,{size:14}),children:"Test"})})]})]}),o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Figma File Key"}),o.jsx(yt,{value:c,onChange:fe=>ee(fe.target.value),placeholder:"yTy5ytxeFPRiGou5Poed8a",fontFamily:"mono",isReadOnly:!(r!=null&&r.editMode.isActive)})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"File Color Profile"}),o.jsxs(Kt,{value:u,onChange:fe=>be(fe.target.value),isDisabled:!(r!=null&&r.editMode.isActive),children:[o.jsx("option",{value:"srgb",children:"sRGB"}),o.jsx("option",{value:"display-p3",children:"Display P3"})]})]})]})}),o.jsx(on,{}),Se()&&o.jsxs(o.Fragment,{children:[o.jsxs(z,{children:[o.jsx(Tt,{size:"sm",mb:4,children:"Syntax Patterns"}),o.jsx(Du,{syntaxPatterns:ne,onSyntaxPatternsChange:X,showTitle:!1,isReadOnly:!(r!=null&&r.editMode.isActive)})]}),o.jsx(on,{})]}),o.jsxs(le,{spacing:3,justify:"flex-end",children:[o.jsx(Oe,{variant:"outline",onClick:$,isLoading:g,loadingText:"Generating API data...",isDisabled:!a||!c||(r==null?void 0:r.editMode.isActive)&&!(k!=null&&k.canExport),leftIcon:o.jsx(xu,{size:14}),children:"Generate API Data"}),o.jsx(Oe,{colorScheme:"green",onClick:xe,isLoading:v,loadingText:"Publishing...",isDisabled:!a||!c||(r==null?void 0:r.editMode.isActive)&&!(k!=null&&k.canExport),children:"Publish to Figma"})]}),(P==null?void 0:P.data)&&o.jsx(z,{p:4,bg:s==="dark"?"gray.800":"gray.50",borderRadius:"md",children:o.jsxs(ce,{spacing:3,align:"stretch",children:[o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{fontWeight:"bold",children:"Export Summary"}),o.jsxs(le,{spacing:2,children:[o.jsxs(wt,{colorScheme:"green",children:[P.data.variables.length," variables"]}),o.jsxs(wt,{colorScheme:"blue",children:[P.data.collections.length," collections"]}),o.jsxs(wt,{colorScheme:"purple",children:[P.data.variableModes.length," modes"]})]})]}),o.jsxs(le,{spacing:2,justify:"center",children:[o.jsxs(Oe,{size:"sm",variant:"outline",onClick:()=>G(!R),leftIcon:R?o.jsx(y6,{size:14}):o.jsx(v6,{size:14}),children:[R?"Hide":"Show"," Preview"]}),o.jsx(Oe,{size:"sm",variant:"outline",onClick:B,leftIcon:o.jsx(xu,{size:14}),children:"Download JSON"}),o.jsx(Oe,{size:"sm",variant:"outline",onClick:U,leftIcon:o.jsx(c6,{size:14}),children:"Copy JSON"})]}),R&&o.jsx(z,{p:3,bg:s==="dark"?"gray.900":"white",borderWidth:1,borderRadius:"md",maxH:"300px",overflowY:"auto",children:o.jsx("pre",{style:{fontSize:"12px",margin:0},children:JSON.stringify(P.data,null,2)})})]})})]})]}),(P==null?void 0:P.data)&&o.jsx(xN,{isOpen:S,onClose:()=>b(!1),onPublish:xe,transformationResult:P.data,tokenSystem:t,figmaFileId:c,accessToken:a})]});return o.jsx(no,{title:"Figma",description:"Configure Figma integration settings and manage variable collections for publishing design tokens.",children:o.jsxs(Es,{children:[o.jsxs(Ms,{children:[Me()&&o.jsx(pr,{children:"Publishing"}),o.jsx(pr,{children:"Variable Collections"})]}),o.jsxs(Ls,{mt:4,children:[Me()&&o.jsx(Ir,{children:de()}),o.jsx(Ir,{children:o.jsx(A4,{collections:O,onUpdate:fe=>L.setCollections(fe),tokens:Z,resolvedValueTypes:ie,canEdit:e})})]})]})})};function SN({tabs:t,activeTab:e=0,onChange:r,width:n="100%",height:s="100%"}){const i=Qd("gray.100","gray.800"),a=Qd("gray.50","gray.700"),{colorMode:l}=Vt(),c=l==="dark"?"gray.800":"white",d=l==="dark"?"gray.700":"gray.200",u=l==="dark"?"gray.200":"gray.500";return o.jsx(z,{width:n,height:s,display:"flex",flexDirection:"column",bg:c,flex:"1",children:o.jsxs(Es,{orientation:"vertical",variant:"line",index:e,onChange:r,display:"flex",flexDirection:"row",height:"100%",flex:"1",children:[o.jsx(Ms,{borderLeft:"none",width:"200px",height:"100%",overflowY:"auto",flexShrink:0,py:4,children:t.map(m=>o.jsx(pr,{justifyContent:"flex-start",width:"100%",_selected:{bg:i,borderRight:"2px",borderRightColor:u},_hover:{bg:a},children:m.label},m.id))}),o.jsx(Ls,{flex:"1",overflowY:"auto",borderLeft:"1px",borderColor:d,height:"100%",display:"flex",flexDirection:"column",bg:l==="dark"?"gray.900":"gray.50",children:t.map(m=>o.jsx(Ir,{p:12,flex:"1",display:"flex",flexDirection:"column",children:m.content},m.id))})]})})}function wN(t,e){if(t==null)return{};var r,n,s=Hw(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(s[r]=t[r])}return s}function pf(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function CN(t){if(Array.isArray(t))return pf(t)}function kN(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function IN(t,e){if(t){if(typeof t=="string")return pf(t,e);var r={}.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?pf(t,e):void 0}}function jN(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ff(t){return CN(t)||kN(t)||IN(t)||jN()}function V1(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),r.push.apply(r,n)}return r}function ll(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?V1(Object(r),!0).forEach(function(n){Uv(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):V1(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function TN(t){var e=t.length;if(e===0||e===1)return t;if(e===2)return[t[0],t[1],"".concat(t[0],".").concat(t[1]),"".concat(t[1],".").concat(t[0])];if(e===3)return[t[0],t[1],t[2],"".concat(t[0],".").concat(t[1]),"".concat(t[0],".").concat(t[2]),"".concat(t[1],".").concat(t[0]),"".concat(t[1],".").concat(t[2]),"".concat(t[2],".").concat(t[0]),"".concat(t[2],".").concat(t[1]),"".concat(t[0],".").concat(t[1],".").concat(t[2]),"".concat(t[0],".").concat(t[2],".").concat(t[1]),"".concat(t[1],".").concat(t[0],".").concat(t[2]),"".concat(t[1],".").concat(t[2],".").concat(t[0]),"".concat(t[2],".").concat(t[0],".").concat(t[1]),"".concat(t[2],".").concat(t[1],".").concat(t[0])];if(e>=4)return[t[0],t[1],t[2],t[3],"".concat(t[0],".").concat(t[1]),"".concat(t[0],".").concat(t[2]),"".concat(t[0],".").concat(t[3]),"".concat(t[1],".").concat(t[0]),"".concat(t[1],".").concat(t[2]),"".concat(t[1],".").concat(t[3]),"".concat(t[2],".").concat(t[0]),"".concat(t[2],".").concat(t[1]),"".concat(t[2],".").concat(t[3]),"".concat(t[3],".").concat(t[0]),"".concat(t[3],".").concat(t[1]),"".concat(t[3],".").concat(t[2]),"".concat(t[0],".").concat(t[1],".").concat(t[2]),"".concat(t[0],".").concat(t[1],".").concat(t[3]),"".concat(t[0],".").concat(t[2],".").concat(t[1]),"".concat(t[0],".").concat(t[2],".").concat(t[3]),"".concat(t[0],".").concat(t[3],".").concat(t[1]),"".concat(t[0],".").concat(t[3],".").concat(t[2]),"".concat(t[1],".").concat(t[0],".").concat(t[2]),"".concat(t[1],".").concat(t[0],".").concat(t[3]),"".concat(t[1],".").concat(t[2],".").concat(t[0]),"".concat(t[1],".").concat(t[2],".").concat(t[3]),"".concat(t[1],".").concat(t[3],".").concat(t[0]),"".concat(t[1],".").concat(t[3],".").concat(t[2]),"".concat(t[2],".").concat(t[0],".").concat(t[1]),"".concat(t[2],".").concat(t[0],".").concat(t[3]),"".concat(t[2],".").concat(t[1],".").concat(t[0]),"".concat(t[2],".").concat(t[1],".").concat(t[3]),"".concat(t[2],".").concat(t[3],".").concat(t[0]),"".concat(t[2],".").concat(t[3],".").concat(t[1]),"".concat(t[3],".").concat(t[0],".").concat(t[1]),"".concat(t[3],".").concat(t[0],".").concat(t[2]),"".concat(t[3],".").concat(t[1],".").concat(t[0]),"".concat(t[3],".").concat(t[1],".").concat(t[2]),"".concat(t[3],".").concat(t[2],".").concat(t[0]),"".concat(t[3],".").concat(t[2],".").concat(t[1]),"".concat(t[0],".").concat(t[1],".").concat(t[2],".").concat(t[3]),"".concat(t[0],".").concat(t[1],".").concat(t[3],".").concat(t[2]),"".concat(t[0],".").concat(t[2],".").concat(t[1],".").concat(t[3]),"".concat(t[0],".").concat(t[2],".").concat(t[3],".").concat(t[1]),"".concat(t[0],".").concat(t[3],".").concat(t[1],".").concat(t[2]),"".concat(t[0],".").concat(t[3],".").concat(t[2],".").concat(t[1]),"".concat(t[1],".").concat(t[0],".").concat(t[2],".").concat(t[3]),"".concat(t[1],".").concat(t[0],".").concat(t[3],".").concat(t[2]),"".concat(t[1],".").concat(t[2],".").concat(t[0],".").concat(t[3]),"".concat(t[1],".").concat(t[2],".").concat(t[3],".").concat(t[0]),"".concat(t[1],".").concat(t[3],".").concat(t[0],".").concat(t[2]),"".concat(t[1],".").concat(t[3],".").concat(t[2],".").concat(t[0]),"".concat(t[2],".").concat(t[0],".").concat(t[1],".").concat(t[3]),"".concat(t[2],".").concat(t[0],".").concat(t[3],".").concat(t[1]),"".concat(t[2],".").concat(t[1],".").concat(t[0],".").concat(t[3]),"".concat(t[2],".").concat(t[1],".").concat(t[3],".").concat(t[0]),"".concat(t[2],".").concat(t[3],".").concat(t[0],".").concat(t[1]),"".concat(t[2],".").concat(t[3],".").concat(t[1],".").concat(t[0]),"".concat(t[3],".").concat(t[0],".").concat(t[1],".").concat(t[2]),"".concat(t[3],".").concat(t[0],".").concat(t[2],".").concat(t[1]),"".concat(t[3],".").concat(t[1],".").concat(t[0],".").concat(t[2]),"".concat(t[3],".").concat(t[1],".").concat(t[2],".").concat(t[0]),"".concat(t[3],".").concat(t[2],".").concat(t[0],".").concat(t[1]),"".concat(t[3],".").concat(t[2],".").concat(t[1],".").concat(t[0])]}var Om={};function EN(t){if(t.length===0||t.length===1)return t;var e=t.join(".");return Om[e]||(Om[e]=TN(t)),Om[e]}function MN(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=t.filter(function(i){return i!=="token"}),s=EN(n);return s.reduce(function(i,a){return ll(ll({},i),r[a])},e)}function $1(t){return t.join(" ")}function AN(t,e){var r=0;return function(n){return r+=1,n.map(function(s,i){return P4({node:s,stylesheet:t,useInlineStyles:e,key:"code-segment-".concat(r,"-").concat(i)})})}}function P4(t){var e=t.node,r=t.stylesheet,n=t.style,s=n===void 0?{}:n,i=t.useInlineStyles,a=t.key,l=e.properties,c=e.type,d=e.tagName,u=e.value;if(c==="text")return u;if(d){var m=AN(r,i),g;if(!i)g=ll(ll({},l),{},{className:$1(l.className)});else{var y=Object.keys(r).reduce(function(b,k){return k.split(".").forEach(function(A){b.includes(A)||b.push(A)}),b},[]),v=l.className&&l.className.includes("token")?["token"]:[],I=l.className&&v.concat(l.className.filter(function(b){return!y.includes(b)}));g=ll(ll({},l),{},{className:$1(I)||void 0,style:MN(l.className,Object.assign({},l.style,s),r)})}var S=m(e.children);return nr.createElement(d,Mf({key:a},g),S)}}const PN=function(t,e){var r=t.listLanguages();return r.indexOf(e)!==-1};var NN=["language","children","style","customStyle","codeTagProps","useInlineStyles","showLineNumbers","showInlineLineNumbers","startingLineNumber","lineNumberContainerStyle","lineNumberStyle","wrapLines","wrapLongLines","lineProps","renderer","PreTag","CodeTag","code","astGenerator"];function z1(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),r.push.apply(r,n)}return r}function Si(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?z1(Object(r),!0).forEach(function(n){Uv(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):z1(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var DN=/\n/g;function RN(t){return t.match(DN)}function ON(t){var e=t.lines,r=t.startingLineNumber,n=t.style;return e.map(function(s,i){var a=i+r;return nr.createElement("span",{key:"line-".concat(i),className:"react-syntax-highlighter-line-number",style:typeof n=="function"?n(a):n},"".concat(a,`
`))})}function _N(t){var e=t.codeString,r=t.codeStyle,n=t.containerStyle,s=n===void 0?{float:"left",paddingRight:"10px"}:n,i=t.numberStyle,a=i===void 0?{}:i,l=t.startingLineNumber;return nr.createElement("code",{style:Object.assign({},r,s)},ON({lines:e.replace(/\n$/,"").split(`
`),style:a,startingLineNumber:l}))}function FN(t){return"".concat(t.toString().length,".25em")}function N4(t,e){return{type:"element",tagName:"span",properties:{key:"line-number--".concat(t),className:["comment","linenumber","react-syntax-highlighter-line-number"],style:e},children:[{type:"text",value:t}]}}function D4(t,e,r){var n={display:"inline-block",minWidth:FN(r),paddingRight:"1em",textAlign:"right",userSelect:"none"},s=typeof t=="function"?t(e):t,i=Si(Si({},n),s);return i}function Bd(t){var e=t.children,r=t.lineNumber,n=t.lineNumberStyle,s=t.largestLineNumber,i=t.showInlineLineNumbers,a=t.lineProps,l=a===void 0?{}:a,c=t.className,d=c===void 0?[]:c,u=t.showLineNumbers,m=t.wrapLongLines,g=t.wrapLines,y=g===void 0?!1:g,v=y?Si({},typeof l=="function"?l(r):l):{};if(v.className=v.className?[].concat(ff(v.className.trim().split(/\s+/)),ff(d)):d,r&&i){var I=D4(n,r,s);e.unshift(N4(r,I))}return m&u&&(v.style=Si({display:"flex"},v.style)),{type:"element",tagName:"span",properties:v,children:e}}function R4(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=0;n<t.length;n++){var s=t[n];if(s.type==="text")r.push(Bd({children:[s],className:ff(new Set(e))}));else if(s.children){var i=e.concat(s.properties.className);R4(s.children,i).forEach(function(a){return r.push(a)})}}return r}function VN(t,e,r,n,s,i,a,l,c){var d,u=R4(t.value),m=[],g=-1,y=0;function v(T,P){var _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return Bd({children:T,lineNumber:P,lineNumberStyle:l,largestLineNumber:a,showInlineLineNumbers:s,lineProps:r,className:_,showLineNumbers:n,wrapLongLines:c,wrapLines:e})}function I(T,P){if(n&&P&&s){var _=D4(l,P,a);T.unshift(N4(P,_))}return T}function S(T,P){var _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return e||_.length>0?v(T,P,_):I(T,P)}for(var b=function(){var P=u[y],_=P.children[0].value,R=RN(_);if(R){var G=_.split(`
`);G.forEach(function(ne,he){var te=n&&m.length+i,K={type:"text",value:"".concat(ne,`
`)};if(he===0){var O=u.slice(g+1,y).concat(Bd({children:[K],className:P.properties.className})),Z=S(O,te);m.push(Z)}else if(he===G.length-1){var ie=u[y+1]&&u[y+1].children&&u[y+1].children[0],ge={type:"text",value:"".concat(ne)};if(ie){var xe=Bd({children:[ge],className:P.properties.className});u.splice(y+1,0,xe)}else{var $=[ge],B=S($,te,P.properties.className);m.push(B)}}else{var U=[K],X=S(U,te,P.properties.className);m.push(X)}}),g=y}y++};y<u.length;)b();if(g!==u.length-1){var k=u.slice(g+1,u.length);if(k&&k.length){var A=n&&m.length+i,C=S(k,A);m.push(C)}}return e?m:(d=[]).concat.apply(d,m)}function $N(t){var e=t.rows,r=t.stylesheet,n=t.useInlineStyles;return e.map(function(s,i){return P4({node:s,stylesheet:r,useInlineStyles:n,key:"code-segement".concat(i)})})}function O4(t){return t&&typeof t.highlightAuto<"u"}function zN(t){var e=t.astGenerator,r=t.language,n=t.code,s=t.defaultCodeValue;if(O4(e)){var i=PN(e,r);return r==="text"?{value:s,language:"text"}:i?e.highlight(r,n):e.highlightAuto(n)}try{return r&&r!=="text"?{value:e.highlight(n,r)}:{value:s}}catch{return{value:s}}}function LN(t,e){return function(n){var s=n.language,i=n.children,a=n.style,l=a===void 0?e:a,c=n.customStyle,d=c===void 0?{}:c,u=n.codeTagProps,m=u===void 0?{className:s?"language-".concat(s):void 0,style:Si(Si({},l['code[class*="language-"]']),l['code[class*="language-'.concat(s,'"]')])}:u,g=n.useInlineStyles,y=g===void 0?!0:g,v=n.showLineNumbers,I=v===void 0?!1:v,S=n.showInlineLineNumbers,b=S===void 0?!0:S,k=n.startingLineNumber,A=k===void 0?1:k,C=n.lineNumberContainerStyle,T=n.lineNumberStyle,P=T===void 0?{}:T,_=n.wrapLines,R=n.wrapLongLines,G=R===void 0?!1:R,ne=n.lineProps,he=ne===void 0?{}:ne,te=n.renderer,K=n.PreTag,O=K===void 0?"pre":K,Z=n.CodeTag,ie=Z===void 0?"code":Z,ge=n.code,xe=ge===void 0?(Array.isArray(i)?i[0]:i)||"":ge,$=n.astGenerator,B=wN(n,NN);$=$||t;var U=I?nr.createElement(_N,{containerStyle:C,codeStyle:m.style||{},numberStyle:P,startingLineNumber:A,codeString:xe}):null,X=l.hljs||l['pre[class*="language-"]']||{backgroundColor:"#fff"},ee=O4($)?"hljs":"prismjs",be=y?Object.assign({},B,{style:Object.assign({},X,d)}):Object.assign({},B,{className:B.className?"".concat(ee," ").concat(B.className):ee,style:Object.assign({},d)});if(G?m.style=Si({whiteSpace:"pre-wrap"},m.style):m.style=Si({whiteSpace:"pre"},m.style),!$)return nr.createElement(O,be,U,nr.createElement(ie,m,xe));(_===void 0&&te||G)&&(_=!0),te=te||$N;var Se=[{type:"text",value:xe}],Me=zN({astGenerator:$,language:s,code:xe,defaultCodeValue:Se});Me.language===null&&(Me.value=Se);var se=Me.value.length;se===1&&Me.value[0].type==="text"&&(se=Me.value[0].value.split(`
`).length);var de=se+A,fe=VN(Me,_,he,I,b,A,de,P,G);return nr.createElement(O,be,nr.createElement(ie,m,!b&&U,te({rows:fe,stylesheet:l,useInlineStyles:y})))}}var qa={};function _0(t){return t instanceof Map?t.clear=t.delete=t.set=function(){throw new Error("map is read-only")}:t instanceof Set&&(t.add=t.clear=t.delete=function(){throw new Error("set is read-only")}),Object.freeze(t),Object.getOwnPropertyNames(t).forEach(function(e){var r=t[e];typeof r=="object"&&!Object.isFrozen(r)&&_0(r)}),t}var _4=_0,BN=_0;_4.default=BN;class L1{constructor(e){e.data===void 0&&(e.data={}),this.data=e.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}}function cl(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function wi(t,...e){const r=Object.create(null);for(const n in t)r[n]=t[n];return e.forEach(function(n){for(const s in n)r[s]=n[s]}),r}const UN="</span>",B1=t=>!!t.kind;class GN{constructor(e,r){this.buffer="",this.classPrefix=r.classPrefix,e.walk(this)}addText(e){this.buffer+=cl(e)}openNode(e){if(!B1(e))return;let r=e.kind;e.sublanguage||(r=`${this.classPrefix}${r}`),this.span(r)}closeNode(e){B1(e)&&(this.buffer+=UN)}value(){return this.buffer}span(e){this.buffer+=`<span class="${e}">`}}class F0{constructor(){this.rootNode={children:[]},this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(e){this.top.children.push(e)}openNode(e){const r={kind:e,children:[]};this.add(r),this.stack.push(r)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(e){return this.constructor._walk(e,this.rootNode)}static _walk(e,r){return typeof r=="string"?e.addText(r):r.children&&(e.openNode(r),r.children.forEach(n=>this._walk(e,n)),e.closeNode(r)),e}static _collapse(e){typeof e!="string"&&e.children&&(e.children.every(r=>typeof r=="string")?e.children=[e.children.join("")]:e.children.forEach(r=>{F0._collapse(r)}))}}class HN extends F0{constructor(e){super(),this.options=e}addKeyword(e,r){e!==""&&(this.openNode(r),this.addText(e),this.closeNode())}addText(e){e!==""&&this.add(e)}addSublanguage(e,r){const n=e.root;n.kind=r,n.sublanguage=!0,this.add(n)}toHTML(){return new GN(this,this.options).value()}finalize(){return!0}}function WN(t){return new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"m")}function Rc(t){return t?typeof t=="string"?t:t.source:null}function qN(...t){return t.map(r=>Rc(r)).join("")}function JN(...t){return"("+t.map(r=>Rc(r)).join("|")+")"}function YN(t){return new RegExp(t.toString()+"|").exec("").length-1}function KN(t,e){const r=t&&t.exec(e);return r&&r.index===0}const ZN=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function XN(t,e="|"){let r=0;return t.map(n=>{r+=1;const s=r;let i=Rc(n),a="";for(;i.length>0;){const l=ZN.exec(i);if(!l){a+=i;break}a+=i.substring(0,l.index),i=i.substring(l.index+l[0].length),l[0][0]==="\\"&&l[1]?a+="\\"+String(Number(l[1])+s):(a+=l[0],l[0]==="("&&r++)}return a}).map(n=>`(${n})`).join(e)}const QN=/\b\B/,F4="[a-zA-Z]\\w*",V0="[a-zA-Z_]\\w*",$0="\\b\\d+(\\.\\d+)?",V4="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",$4="\\b(0b[01]+)",eD="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",tD=(t={})=>{const e=/^#![ ]*\//;return t.binary&&(t.begin=qN(e,/.*\b/,t.binary,/\b.*/)),wi({className:"meta",begin:e,end:/$/,relevance:0,"on:begin":(r,n)=>{r.index!==0&&n.ignoreMatch()}},t)},Oc={begin:"\\\\[\\s\\S]",relevance:0},rD={className:"string",begin:"'",end:"'",illegal:"\\n",contains:[Oc]},nD={className:"string",begin:'"',end:'"',illegal:"\\n",contains:[Oc]},z4={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},xh=function(t,e,r={}){const n=wi({className:"comment",begin:t,end:e,contains:[]},r);return n.contains.push(z4),n.contains.push({className:"doctag",begin:"(?:TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):",relevance:0}),n},sD=xh("//","$"),oD=xh("/\\*","\\*/"),iD=xh("#","$"),aD={className:"number",begin:$0,relevance:0},lD={className:"number",begin:V4,relevance:0},cD={className:"number",begin:$4,relevance:0},dD={className:"number",begin:$0+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},uD={begin:/(?=\/[^/\n]*\/)/,contains:[{className:"regexp",begin:/\//,end:/\/[gimuy]*/,illegal:/\n/,contains:[Oc,{begin:/\[/,end:/\]/,relevance:0,contains:[Oc]}]}]},hD={className:"title",begin:F4,relevance:0},mD={className:"title",begin:V0,relevance:0},pD={begin:"\\.\\s*"+V0,relevance:0},fD=function(t){return Object.assign(t,{"on:begin":(e,r)=>{r.data._beginMatch=e[1]},"on:end":(e,r)=>{r.data._beginMatch!==e[1]&&r.ignoreMatch()}})};var Td=Object.freeze({__proto__:null,MATCH_NOTHING_RE:QN,IDENT_RE:F4,UNDERSCORE_IDENT_RE:V0,NUMBER_RE:$0,C_NUMBER_RE:V4,BINARY_NUMBER_RE:$4,RE_STARTERS_RE:eD,SHEBANG:tD,BACKSLASH_ESCAPE:Oc,APOS_STRING_MODE:rD,QUOTE_STRING_MODE:nD,PHRASAL_WORDS_MODE:z4,COMMENT:xh,C_LINE_COMMENT_MODE:sD,C_BLOCK_COMMENT_MODE:oD,HASH_COMMENT_MODE:iD,NUMBER_MODE:aD,C_NUMBER_MODE:lD,BINARY_NUMBER_MODE:cD,CSS_NUMBER_MODE:dD,REGEXP_MODE:uD,TITLE_MODE:hD,UNDERSCORE_TITLE_MODE:mD,METHOD_GUARD:pD,END_SAME_AS_BEGIN:fD});function gD(t,e){t.input[t.index-1]==="."&&e.ignoreMatch()}function yD(t,e){e&&t.beginKeywords&&(t.begin="\\b("+t.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",t.__beforeBegin=gD,t.keywords=t.keywords||t.beginKeywords,delete t.beginKeywords,t.relevance===void 0&&(t.relevance=0))}function xD(t,e){Array.isArray(t.illegal)&&(t.illegal=JN(...t.illegal))}function vD(t,e){if(t.match){if(t.begin||t.end)throw new Error("begin & end are not supported with match");t.begin=t.match,delete t.match}}function bD(t,e){t.relevance===void 0&&(t.relevance=1)}const SD=["of","and","for","in","not","or","if","then","parent","list","value"],wD="keyword";function L4(t,e,r=wD){const n={};return typeof t=="string"?s(r,t.split(" ")):Array.isArray(t)?s(r,t):Object.keys(t).forEach(function(i){Object.assign(n,L4(t[i],e,i))}),n;function s(i,a){e&&(a=a.map(l=>l.toLowerCase())),a.forEach(function(l){const c=l.split("|");n[c[0]]=[i,CD(c[0],c[1])]})}}function CD(t,e){return e?Number(e):kD(t)?0:1}function kD(t){return SD.includes(t.toLowerCase())}function ID(t,{plugins:e}){function r(l,c){return new RegExp(Rc(l),"m"+(t.case_insensitive?"i":"")+(c?"g":""))}class n{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(c,d){d.position=this.position++,this.matchIndexes[this.matchAt]=d,this.regexes.push([d,c]),this.matchAt+=YN(c)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);const c=this.regexes.map(d=>d[1]);this.matcherRe=r(XN(c),!0),this.lastIndex=0}exec(c){this.matcherRe.lastIndex=this.lastIndex;const d=this.matcherRe.exec(c);if(!d)return null;const u=d.findIndex((g,y)=>y>0&&g!==void 0),m=this.matchIndexes[u];return d.splice(0,u),Object.assign(d,m)}}class s{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(c){if(this.multiRegexes[c])return this.multiRegexes[c];const d=new n;return this.rules.slice(c).forEach(([u,m])=>d.addRule(u,m)),d.compile(),this.multiRegexes[c]=d,d}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(c,d){this.rules.push([c,d]),d.type==="begin"&&this.count++}exec(c){const d=this.getMatcher(this.regexIndex);d.lastIndex=this.lastIndex;let u=d.exec(c);if(this.resumingScanAtSamePosition()&&!(u&&u.index===this.lastIndex)){const m=this.getMatcher(0);m.lastIndex=this.lastIndex+1,u=m.exec(c)}return u&&(this.regexIndex+=u.position+1,this.regexIndex===this.count&&this.considerAll()),u}}function i(l){const c=new s;return l.contains.forEach(d=>c.addRule(d.begin,{rule:d,type:"begin"})),l.terminatorEnd&&c.addRule(l.terminatorEnd,{type:"end"}),l.illegal&&c.addRule(l.illegal,{type:"illegal"}),c}function a(l,c){const d=l;if(l.isCompiled)return d;[vD].forEach(m=>m(l,c)),t.compilerExtensions.forEach(m=>m(l,c)),l.__beforeBegin=null,[yD,xD,bD].forEach(m=>m(l,c)),l.isCompiled=!0;let u=null;if(typeof l.keywords=="object"&&(u=l.keywords.$pattern,delete l.keywords.$pattern),l.keywords&&(l.keywords=L4(l.keywords,t.case_insensitive)),l.lexemes&&u)throw new Error("ERR: Prefer `keywords.$pattern` to `mode.lexemes`, BOTH are not allowed. (see mode reference) ");return u=u||l.lexemes||/\w+/,d.keywordPatternRe=r(u,!0),c&&(l.begin||(l.begin=/\B|\b/),d.beginRe=r(l.begin),l.endSameAsBegin&&(l.end=l.begin),!l.end&&!l.endsWithParent&&(l.end=/\B|\b/),l.end&&(d.endRe=r(l.end)),d.terminatorEnd=Rc(l.end)||"",l.endsWithParent&&c.terminatorEnd&&(d.terminatorEnd+=(l.end?"|":"")+c.terminatorEnd)),l.illegal&&(d.illegalRe=r(l.illegal)),l.contains||(l.contains=[]),l.contains=[].concat(...l.contains.map(function(m){return jD(m==="self"?l:m)})),l.contains.forEach(function(m){a(m,d)}),l.starts&&a(l.starts,c),d.matcher=i(d),d}if(t.compilerExtensions||(t.compilerExtensions=[]),t.contains&&t.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return t.classNameAliases=wi(t.classNameAliases||{}),a(t)}function B4(t){return t?t.endsWithParent||B4(t.starts):!1}function jD(t){return t.variants&&!t.cachedVariants&&(t.cachedVariants=t.variants.map(function(e){return wi(t,{variants:null},e)})),t.cachedVariants?t.cachedVariants:B4(t)?wi(t,{starts:t.starts?wi(t.starts):null}):Object.isFrozen(t)?wi(t):t}var TD="10.7.3";function ED(t){return!!(t||t==="")}function MD(t){const e={props:["language","code","autodetect"],data:function(){return{detectedLanguage:"",unknownLanguage:!1}},computed:{className(){return this.unknownLanguage?"":"hljs "+this.detectedLanguage},highlighted(){if(!this.autoDetect&&!t.getLanguage(this.language))return console.warn(`The language "${this.language}" you specified could not be found.`),this.unknownLanguage=!0,cl(this.code);let n={};return this.autoDetect?(n=t.highlightAuto(this.code),this.detectedLanguage=n.language):(n=t.highlight(this.language,this.code,this.ignoreIllegals),this.detectedLanguage=this.language),n.value},autoDetect(){return!this.language||ED(this.autodetect)},ignoreIllegals(){return!0}},render(n){return n("pre",{},[n("code",{class:this.className,domProps:{innerHTML:this.highlighted}})])}};return{Component:e,VuePlugin:{install(n){n.component("highlightjs",e)}}}}const AD={"after:highlightElement":({el:t,result:e,text:r})=>{const n=U1(t);if(!n.length)return;const s=document.createElement("div");s.innerHTML=e.value,e.value=PD(n,U1(s),r)}};function gf(t){return t.nodeName.toLowerCase()}function U1(t){const e=[];return function r(n,s){for(let i=n.firstChild;i;i=i.nextSibling)i.nodeType===3?s+=i.nodeValue.length:i.nodeType===1&&(e.push({event:"start",offset:s,node:i}),s=r(i,s),gf(i).match(/br|hr|img|input/)||e.push({event:"stop",offset:s,node:i}));return s}(t,0),e}function PD(t,e,r){let n=0,s="";const i=[];function a(){return!t.length||!e.length?t.length?t:e:t[0].offset!==e[0].offset?t[0].offset<e[0].offset?t:e:e[0].event==="start"?t:e}function l(u){function m(g){return" "+g.nodeName+'="'+cl(g.value)+'"'}s+="<"+gf(u)+[].map.call(u.attributes,m).join("")+">"}function c(u){s+="</"+gf(u)+">"}function d(u){(u.event==="start"?l:c)(u.node)}for(;t.length||e.length;){let u=a();if(s+=cl(r.substring(n,u[0].offset)),n=u[0].offset,u===t){i.reverse().forEach(c);do d(u.splice(0,1)[0]),u=a();while(u===t&&u.length&&u[0].offset===n);i.reverse().forEach(l)}else u[0].event==="start"?i.push(u[0].node):i.pop(),d(u.splice(0,1)[0])}return s+cl(r.substr(n))}const G1={},_m=t=>{console.error(t)},H1=(t,...e)=>{console.log(`WARN: ${t}`,...e)},Ys=(t,e)=>{G1[`${t}/${e}`]||(console.log(`Deprecated as of ${t}. ${e}`),G1[`${t}/${e}`]=!0)},Fm=cl,W1=wi,q1=Symbol("nomatch"),ND=function(t){const e=Object.create(null),r=Object.create(null),n=[];let s=!0;const i=/(^(<[^>]+>|\t|)+|\n)/gm,a="Could not find the language '{}', did you forget to load/include a language module?",l={disableAutodetect:!0,name:"Plain text",contains:[]};let c={noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",tabReplace:null,useBR:!1,languages:null,__emitter:HN};function d(ee){return c.noHighlightRe.test(ee)}function u(ee){let be=ee.className+" ";be+=ee.parentNode?ee.parentNode.className:"";const Se=c.languageDetectRe.exec(be);if(Se){const Me=Z(Se[1]);return Me||(H1(a.replace("{}",Se[1])),H1("Falling back to no-highlight mode for this block.",ee)),Me?Se[1]:"no-highlight"}return be.split(/\s+/).find(Me=>d(Me)||Z(Me))}function m(ee,be,Se,Me){let se="",de="";typeof be=="object"?(se=ee,Se=be.ignoreIllegals,de=be.language,Me=void 0):(Ys("10.7.0","highlight(lang, code, ...args) has been deprecated."),Ys("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),de=ee,se=be);const fe={code:se,language:de};B("before:highlight",fe);const _e=fe.result?fe.result:g(fe.language,fe.code,Se,Me);return _e.code=fe.code,B("after:highlight",_e),_e}function g(ee,be,Se,Me){function se(gt,Dt){const Ct=Te.case_insensitive?Dt[0].toLowerCase():Dt[0];return Object.prototype.hasOwnProperty.call(gt.keywords,Ct)&&gt.keywords[Ct]}function de(){if(!Ue.keywords){ut.addText(Ze);return}let gt=0;Ue.keywordPatternRe.lastIndex=0;let Dt=Ue.keywordPatternRe.exec(Ze),Ct="";for(;Dt;){Ct+=Ze.substring(gt,Dt.index);const Qt=se(Ue,Dt);if(Qt){const[Zt,at]=Qt;if(ut.addText(Ct),Ct="",At+=at,Zt.startsWith("_"))Ct+=Dt[0];else{const Q=Te.classNameAliases[Zt]||Zt;ut.addKeyword(Dt[0],Q)}}else Ct+=Dt[0];gt=Ue.keywordPatternRe.lastIndex,Dt=Ue.keywordPatternRe.exec(Ze)}Ct+=Ze.substr(gt),ut.addText(Ct)}function fe(){if(Ze==="")return;let gt=null;if(typeof Ue.subLanguage=="string"){if(!e[Ue.subLanguage]){ut.addText(Ze);return}gt=g(Ue.subLanguage,Ze,!0,Je[Ue.subLanguage]),Je[Ue.subLanguage]=gt.top}else gt=v(Ze,Ue.subLanguage.length?Ue.subLanguage:null);Ue.relevance>0&&(At+=gt.relevance),ut.addSublanguage(gt.emitter,gt.language)}function _e(){Ue.subLanguage!=null?fe():de(),Ze=""}function Y(gt){return gt.className&&ut.openNode(Te.classNameAliases[gt.className]||gt.className),Ue=Object.create(gt,{parent:{value:Ue}}),Ue}function Ce(gt,Dt,Ct){let Qt=KN(gt.endRe,Ct);if(Qt){if(gt["on:end"]){const Zt=new L1(gt);gt["on:end"](Dt,Zt),Zt.isMatchIgnored&&(Qt=!1)}if(Qt){for(;gt.endsParent&&gt.parent;)gt=gt.parent;return gt}}if(gt.endsWithParent)return Ce(gt.parent,Dt,Ct)}function ue(gt){return Ue.matcher.regexIndex===0?(Ze+=gt[0],1):(yr=!0,0)}function Ee(gt){const Dt=gt[0],Ct=gt.rule,Qt=new L1(Ct),Zt=[Ct.__beforeBegin,Ct["on:begin"]];for(const at of Zt)if(at&&(at(gt,Qt),Qt.isMatchIgnored))return ue(Dt);return Ct&&Ct.endSameAsBegin&&(Ct.endRe=WN(Dt)),Ct.skip?Ze+=Dt:(Ct.excludeBegin&&(Ze+=Dt),_e(),!Ct.returnBegin&&!Ct.excludeBegin&&(Ze=Dt)),Y(Ct),Ct.returnBegin?0:Dt.length}function ze(gt){const Dt=gt[0],Ct=be.substr(gt.index),Qt=Ce(Ue,gt,Ct);if(!Qt)return q1;const Zt=Ue;Zt.skip?Ze+=Dt:(Zt.returnEnd||Zt.excludeEnd||(Ze+=Dt),_e(),Zt.excludeEnd&&(Ze=Dt));do Ue.className&&ut.closeNode(),!Ue.skip&&!Ue.subLanguage&&(At+=Ue.relevance),Ue=Ue.parent;while(Ue!==Qt.parent);return Qt.starts&&(Qt.endSameAsBegin&&(Qt.starts.endRe=Qt.endRe),Y(Qt.starts)),Zt.returnEnd?0:Dt.length}function De(){const gt=[];for(let Dt=Ue;Dt!==Te;Dt=Dt.parent)Dt.className&&gt.unshift(Dt.className);gt.forEach(Dt=>ut.openNode(Dt))}let Ke={};function ve(gt,Dt){const Ct=Dt&&Dt[0];if(Ze+=gt,Ct==null)return _e(),0;if(Ke.type==="begin"&&Dt.type==="end"&&Ke.index===Dt.index&&Ct===""){if(Ze+=be.slice(Dt.index,Dt.index+1),!s){const Qt=new Error("0 width match regex");throw Qt.languageName=ee,Qt.badRule=Ke.rule,Qt}return 1}if(Ke=Dt,Dt.type==="begin")return Ee(Dt);if(Dt.type==="illegal"&&!Se){const Qt=new Error('Illegal lexeme "'+Ct+'" for mode "'+(Ue.className||"<unnamed>")+'"');throw Qt.mode=Ue,Qt}else if(Dt.type==="end"){const Qt=ze(Dt);if(Qt!==q1)return Qt}if(Dt.type==="illegal"&&Ct==="")return 1;if(vr>1e5&&vr>Dt.index*3)throw new Error("potential infinite loop, way more iterations than matches");return Ze+=Ct,Ct.length}const Te=Z(ee);if(!Te)throw _m(a.replace("{}",ee)),new Error('Unknown language: "'+ee+'"');const je=ID(Te,{plugins:n});let Fe="",Ue=Me||je;const Je={},ut=new c.__emitter(c);De();let Ze="",At=0,gr=0,vr=0,yr=!1;try{for(Ue.matcher.considerAll();;){vr++,yr?yr=!1:Ue.matcher.considerAll(),Ue.matcher.lastIndex=gr;const gt=Ue.matcher.exec(be);if(!gt)break;const Dt=be.substring(gr,gt.index),Ct=ve(Dt,gt);gr=gt.index+Ct}return ve(be.substr(gr)),ut.closeAllNodes(),ut.finalize(),Fe=ut.toHTML(),{relevance:Math.floor(At),value:Fe,language:ee,illegal:!1,emitter:ut,top:Ue}}catch(gt){if(gt.message&&gt.message.includes("Illegal"))return{illegal:!0,illegalBy:{msg:gt.message,context:be.slice(gr-100,gr+100),mode:gt.mode},sofar:Fe,relevance:0,value:Fm(be),emitter:ut};if(s)return{illegal:!1,relevance:0,value:Fm(be),emitter:ut,language:ee,top:Ue,errorRaised:gt};throw gt}}function y(ee){const be={relevance:0,emitter:new c.__emitter(c),value:Fm(ee),illegal:!1,top:l};return be.emitter.addText(ee),be}function v(ee,be){be=be||c.languages||Object.keys(e);const Se=y(ee),Me=be.filter(Z).filter(ge).map(Y=>g(Y,ee,!1));Me.unshift(Se);const se=Me.sort((Y,Ce)=>{if(Y.relevance!==Ce.relevance)return Ce.relevance-Y.relevance;if(Y.language&&Ce.language){if(Z(Y.language).supersetOf===Ce.language)return 1;if(Z(Ce.language).supersetOf===Y.language)return-1}return 0}),[de,fe]=se,_e=de;return _e.second_best=fe,_e}function I(ee){return c.tabReplace||c.useBR?ee.replace(i,be=>be===`
`?c.useBR?"<br>":be:c.tabReplace?be.replace(/\t/g,c.tabReplace):be):ee}function S(ee,be,Se){const Me=be?r[be]:Se;ee.classList.add("hljs"),Me&&ee.classList.add(Me)}const b={"before:highlightElement":({el:ee})=>{c.useBR&&(ee.innerHTML=ee.innerHTML.replace(/\n/g,"").replace(/<br[ /]*>/g,`
`))},"after:highlightElement":({result:ee})=>{c.useBR&&(ee.value=ee.value.replace(/\n/g,"<br>"))}},k=/^(<[^>]+>|\t)+/gm,A={"after:highlightElement":({result:ee})=>{c.tabReplace&&(ee.value=ee.value.replace(k,be=>be.replace(/\t/g,c.tabReplace)))}};function C(ee){let be=null;const Se=u(ee);if(d(Se))return;B("before:highlightElement",{el:ee,language:Se}),be=ee;const Me=be.textContent,se=Se?m(Me,{language:Se,ignoreIllegals:!0}):v(Me);B("after:highlightElement",{el:ee,result:se,text:Me}),ee.innerHTML=se.value,S(ee,Se,se.language),ee.result={language:se.language,re:se.relevance,relavance:se.relevance},se.second_best&&(ee.second_best={language:se.second_best.language,re:se.second_best.relevance,relavance:se.second_best.relevance})}function T(ee){ee.useBR&&(Ys("10.3.0","'useBR' will be removed entirely in v11.0"),Ys("10.3.0","Please see https://github.com/highlightjs/highlight.js/issues/2559")),c=W1(c,ee)}const P=()=>{if(P.called)return;P.called=!0,Ys("10.6.0","initHighlighting() is deprecated.  Use highlightAll() instead."),document.querySelectorAll("pre code").forEach(C)};function _(){Ys("10.6.0","initHighlightingOnLoad() is deprecated.  Use highlightAll() instead."),R=!0}let R=!1;function G(){if(document.readyState==="loading"){R=!0;return}document.querySelectorAll("pre code").forEach(C)}function ne(){R&&G()}typeof window<"u"&&window.addEventListener&&window.addEventListener("DOMContentLoaded",ne,!1);function he(ee,be){let Se=null;try{Se=be(t)}catch(Me){if(_m("Language definition for '{}' could not be registered.".replace("{}",ee)),s)_m(Me);else throw Me;Se=l}Se.name||(Se.name=ee),e[ee]=Se,Se.rawDefinition=be.bind(null,t),Se.aliases&&ie(Se.aliases,{languageName:ee})}function te(ee){delete e[ee];for(const be of Object.keys(r))r[be]===ee&&delete r[be]}function K(){return Object.keys(e)}function O(ee){Ys("10.4.0","requireLanguage will be removed entirely in v11."),Ys("10.4.0","Please see https://github.com/highlightjs/highlight.js/pull/2844");const be=Z(ee);if(be)return be;throw new Error("The '{}' language is required, but not loaded.".replace("{}",ee))}function Z(ee){return ee=(ee||"").toLowerCase(),e[ee]||e[r[ee]]}function ie(ee,{languageName:be}){typeof ee=="string"&&(ee=[ee]),ee.forEach(Se=>{r[Se.toLowerCase()]=be})}function ge(ee){const be=Z(ee);return be&&!be.disableAutodetect}function xe(ee){ee["before:highlightBlock"]&&!ee["before:highlightElement"]&&(ee["before:highlightElement"]=be=>{ee["before:highlightBlock"](Object.assign({block:be.el},be))}),ee["after:highlightBlock"]&&!ee["after:highlightElement"]&&(ee["after:highlightElement"]=be=>{ee["after:highlightBlock"](Object.assign({block:be.el},be))})}function $(ee){xe(ee),n.push(ee)}function B(ee,be){const Se=ee;n.forEach(function(Me){Me[Se]&&Me[Se](be)})}function U(ee){return Ys("10.2.0","fixMarkup will be removed entirely in v11.0"),Ys("10.2.0","Please see https://github.com/highlightjs/highlight.js/issues/2534"),I(ee)}function X(ee){return Ys("10.7.0","highlightBlock will be removed entirely in v12.0"),Ys("10.7.0","Please use highlightElement now."),C(ee)}Object.assign(t,{highlight:m,highlightAuto:v,highlightAll:G,fixMarkup:U,highlightElement:C,highlightBlock:X,configure:T,initHighlighting:P,initHighlightingOnLoad:_,registerLanguage:he,unregisterLanguage:te,listLanguages:K,getLanguage:Z,registerAliases:ie,requireLanguage:O,autoDetection:ge,inherit:W1,addPlugin:$,vuePlugin:MD(t).VuePlugin}),t.debugMode=function(){s=!1},t.safeMode=function(){s=!0},t.versionString=TD;for(const ee in Td)typeof Td[ee]=="object"&&_4(Td[ee]);return Object.assign(t,Td),t.addPlugin(b),t.addPlugin(AD),t.addPlugin(A),t};var DD=ND({}),RD=DD,U4={exports:{}};(function(t){(function(){var e;e=t.exports=s,e.format=s,e.vsprintf=n,typeof console<"u"&&typeof console.log=="function"&&(e.printf=r);function r(){console.log(s.apply(null,arguments))}function n(i,a){return s.apply(null,[i].concat(a))}function s(i){for(var a=1,l=[].slice.call(arguments),c=0,d=i.length,u="",m,g=!1,y,v,I=!1,S,b=function(){return l[a++]},k=function(){for(var A="";/\d/.test(i[c]);)A+=i[c++],m=i[c];return A.length>0?parseInt(A):null};c<d;++c)if(m=i[c],g)switch(g=!1,m=="."?(I=!1,m=i[++c]):m=="0"&&i[c+1]=="."?(I=!0,c+=2,m=i[c]):I=!0,S=k(),m){case"b":u+=parseInt(b(),10).toString(2);break;case"c":y=b(),typeof y=="string"||y instanceof String?u+=y:u+=String.fromCharCode(parseInt(y,10));break;case"d":u+=parseInt(b(),10);break;case"f":v=String(parseFloat(b()).toFixed(S||6)),u+=I?v:v.replace(/^0/,"");break;case"j":u+=JSON.stringify(b());break;case"o":u+="0"+parseInt(b(),10).toString(8);break;case"s":u+=b();break;case"x":u+="0x"+parseInt(b(),10).toString(16);break;case"X":u+="0x"+parseInt(b(),10).toString(16).toUpperCase();break;default:u+=m;break}else m==="%"?g=!0:u+=m;return u}})()})(U4);var OD=U4.exports,_D=OD,Ui=Gi(Error),FD=Ui;Ui.eval=Gi(EvalError);Ui.range=Gi(RangeError);Ui.reference=Gi(ReferenceError);Ui.syntax=Gi(SyntaxError);Ui.type=Gi(TypeError);Ui.uri=Gi(URIError);Ui.create=Gi;function Gi(t){return e.displayName=t.displayName||t.name,e;function e(r){return r&&(r=_D.apply(null,arguments)),new t(r)}}var Io=RD,Ud=FD;qa.highlight=G4;qa.highlightAuto=$D;qa.registerLanguage=zD;qa.listLanguages=LD;qa.registerAlias=BD;ci.prototype.addText=HD;ci.prototype.addKeyword=UD;ci.prototype.addSublanguage=GD;ci.prototype.openNode=WD;ci.prototype.closeNode=qD;ci.prototype.closeAllNodes=H4;ci.prototype.finalize=H4;ci.prototype.toHTML=JD;var VD="hljs-";function G4(t,e,r){var n=Io.configure({}),s=r||{},i=s.prefix,a;if(typeof t!="string")throw Ud("Expected `string` for name, got `%s`",t);if(!Io.getLanguage(t))throw Ud("Unknown language: `%s` is not registered",t);if(typeof e!="string")throw Ud("Expected `string` for value, got `%s`",e);if(i==null&&(i=VD),Io.configure({__emitter:ci,classPrefix:i}),a=Io.highlight(e,{language:t,ignoreIllegals:!0}),Io.configure(n||{}),a.errorRaised)throw a.errorRaised;return{relevance:a.relevance,language:a.language,value:a.emitter.rootNode.children}}function $D(t,e){var r=e||{},n=r.subset||Io.listLanguages();r.prefix;var s=n.length,i=-1,a,l,c,d;if(typeof t!="string")throw Ud("Expected `string` for value, got `%s`",t);for(l={relevance:0,language:null,value:[]},a={relevance:0,language:null,value:[]};++i<s;)d=n[i],Io.getLanguage(d)&&(c=G4(d,t,e),c.language=d,c.relevance>l.relevance&&(l=c),c.relevance>a.relevance&&(l=a,a=c));return l.language&&(a.secondBest=l),a}function zD(t,e){Io.registerLanguage(t,e)}function LD(){return Io.listLanguages()}function BD(t,e){var r=t,n;e&&(r={},r[t]=e);for(n in r)Io.registerAliases(r[n],{languageName:n})}function ci(t){this.options=t,this.rootNode={children:[]},this.stack=[this.rootNode]}function UD(t,e){this.openNode(e),this.addText(t),this.closeNode()}function GD(t,e){var r=this.stack,n=r[r.length-1],s=t.rootNode.children,i=e?{type:"element",tagName:"span",properties:{className:[e]},children:s}:s;n.children=n.children.concat(i)}function HD(t){var e=this.stack,r,n;t!==""&&(r=e[e.length-1],n=r.children[r.children.length-1],n&&n.type==="text"?n.value+=t:r.children.push({type:"text",value:t}))}function WD(t){var e=this.stack,r=this.options.classPrefix+t,n=e[e.length-1],s={type:"element",tagName:"span",properties:{className:[r]},children:[]};n.children.push(s),e.push(s)}function qD(){this.stack.pop()}function JD(){return""}function H4(){}function YD(t){const e={literal:"true false null"},r=[t.C_LINE_COMMENT_MODE,t.C_BLOCK_COMMENT_MODE],n=[t.QUOTE_STRING_MODE,t.C_NUMBER_MODE],s={end:",",endsWithParent:!0,excludeEnd:!0,contains:n,keywords:e},i={begin:/\{/,end:/\}/,contains:[{className:"attr",begin:/"/,end:/"/,contains:[t.BACKSLASH_ESCAPE],illegal:"\\n"},t.inherit(s,{begin:/:/})].concat(r),illegal:"\\S"},a={begin:"\\[",end:"\\]",contains:[t.inherit(s)],illegal:"\\S"};return n.push(i,a),r.forEach(function(l){n.push(l)}),{name:"JSON",contains:n,keywords:e,illegal:"\\S"}}var KD=YD;const ZD=Kw(KD);var z0=LN(qa,{});z0.registerLanguage=qa.registerLanguage;const XD={hljs:{display:"block",overflowX:"auto",padding:"0.5em",color:"#abb2bf",background:"#282c34"},"hljs-comment":{color:"#5c6370",fontStyle:"italic"},"hljs-quote":{color:"#5c6370",fontStyle:"italic"},"hljs-doctag":{color:"#c678dd"},"hljs-keyword":{color:"#c678dd"},"hljs-formula":{color:"#c678dd"},"hljs-section":{color:"#e06c75"},"hljs-name":{color:"#e06c75"},"hljs-selector-tag":{color:"#e06c75"},"hljs-deletion":{color:"#e06c75"},"hljs-subst":{color:"#e06c75"},"hljs-literal":{color:"#56b6c2"},"hljs-string":{color:"#98c379"},"hljs-regexp":{color:"#98c379"},"hljs-addition":{color:"#98c379"},"hljs-attribute":{color:"#98c379"},"hljs-meta-string":{color:"#98c379"},"hljs-built_in":{color:"#e6c07b"},"hljs-class .hljs-title":{color:"#e6c07b"},"hljs-attr":{color:"#d19a66"},"hljs-variable":{color:"#d19a66"},"hljs-template-variable":{color:"#d19a66"},"hljs-type":{color:"#d19a66"},"hljs-selector-class":{color:"#d19a66"},"hljs-selector-attr":{color:"#d19a66"},"hljs-selector-pseudo":{color:"#d19a66"},"hljs-number":{color:"#d19a66"},"hljs-symbol":{color:"#61aeee"},"hljs-bullet":{color:"#61aeee"},"hljs-link":{color:"#61aeee",textDecoration:"underline"},"hljs-meta":{color:"#61aeee"},"hljs-selector-id":{color:"#61aeee"},"hljs-title":{color:"#61aeee"},"hljs-emphasis":{fontStyle:"italic"},"hljs-strong":{fontWeight:"bold"}},QD={hljs:{display:"block",overflowX:"auto",padding:"0.5em",color:"#383a42",background:"#fafafa"},"hljs-comment":{color:"#a0a1a7",fontStyle:"italic"},"hljs-quote":{color:"#a0a1a7",fontStyle:"italic"},"hljs-doctag":{color:"#a626a4"},"hljs-keyword":{color:"#a626a4"},"hljs-formula":{color:"#a626a4"},"hljs-section":{color:"#e45649"},"hljs-name":{color:"#e45649"},"hljs-selector-tag":{color:"#e45649"},"hljs-deletion":{color:"#e45649"},"hljs-subst":{color:"#e45649"},"hljs-literal":{color:"#0184bb"},"hljs-string":{color:"#50a14f"},"hljs-regexp":{color:"#50a14f"},"hljs-addition":{color:"#50a14f"},"hljs-attribute":{color:"#50a14f"},"hljs-meta-string":{color:"#50a14f"},"hljs-built_in":{color:"#c18401"},"hljs-class .hljs-title":{color:"#c18401"},"hljs-attr":{color:"#986801"},"hljs-variable":{color:"#986801"},"hljs-template-variable":{color:"#986801"},"hljs-type":{color:"#986801"},"hljs-selector-class":{color:"#986801"},"hljs-selector-attr":{color:"#986801"},"hljs-selector-pseudo":{color:"#986801"},"hljs-number":{color:"#986801"},"hljs-symbol":{color:"#4078f2"},"hljs-bullet":{color:"#4078f2"},"hljs-link":{color:"#4078f2",textDecoration:"underline"},"hljs-meta":{color:"#4078f2"},"hljs-selector-id":{color:"#4078f2"},"hljs-title":{color:"#4078f2"},"hljs-emphasis":{fontStyle:"italic"},"hljs-strong":{fontWeight:"bold"}};z0.registerLanguage("json",ZD);const Tr=({code:t,showLineNumbers:e=!1})=>{const{colorMode:r}=Vt(),[n,s,i,a]=Ww("colors",["gray.900","white","gray.700","gray.200"]);return o.jsx(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:r==="dark"?n:s,borderColor:r==="dark"?i:a,children:o.jsx(z0,{language:"json",showLineNumbers:e,style:r==="dark"?XD:QD,customStyle:{background:"transparent",padding:0,margin:0,fontSize:"0.875rem",lineHeight:"1.5",fontFamily:"monospace"},children:t})})},eR=()=>o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"System Name & ID"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"systemName"})," (required): Human-readable name for the design token system.",o.jsx("br",{}),o.jsx("b",{children:"systemId"})," (required): Unique identifier for the design token system, using the same pattern as other IDs.",o.jsx("br",{}),o.jsx("b",{children:"description"})," (optional): Human-readable description of the design token system.",o.jsx("br",{}),o.jsx("br",{}),"These fields are required at the top level of every token data file. They ensure that every data set is uniquely and clearly identified, and provide a summary for documentation and discovery."]}),o.jsx(Tr,{code:JSON.stringify({systemName:"Acme Design System",systemId:"acme-design-system",description:"The canonical design token set for Acme Corp."},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Version & Version History"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"version"})," (required): Semantic version of the token set, following ",o.jsx("a",{href:"https://semver.org/",target:"_blank",rel:"noopener noreferrer",children:"semantic versioning"})," (e.g., 1.0.0).",o.jsx("br",{}),o.jsx("b",{children:"versionHistory"})," (required): Array of previous versions, each with dimension configuration and date. This supports migrations and compatibility tracking."]}),o.jsx(Tr,{code:JSON.stringify({version:"1.0.0",versionHistory:[{version:"1.0.0",dimensions:["dimension-color-scheme"],date:"2024-06-01",migrationStrategy:{emptyModeIds:"mapToDefaults",preserveOriginalValues:!0}}]},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Metadata & Configuration"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"metadata"})," (optional): Additional information about the token set including maintainers and last updated date.",o.jsx("br",{}),o.jsx("b",{children:"dimensionOrder"})," (optional): Order of dimensions to use when resolving token values.",o.jsx("br",{}),o.jsx("b",{children:"exportConfigurations"})," (optional): Platform-specific export configuration rules."]}),o.jsx(Tr,{code:JSON.stringify({metadata:{description:"Core design tokens for Acme Corp applications",lastUpdated:"2024-06-01",maintainers:["design-team@acme.com"]},dimensionOrder:["dimension-color-scheme","dimension-size"],exportConfigurations:{"platform-web":{prefix:"--",delimiter:"-",capitalization:"lowercase"}}},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Resolved Value Types"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"resolvedValueTypes"})," (required): The canonical list of value types supported by the system.",o.jsx("br",{}),"Each value type has a unique ",o.jsx(Nt,{colorScheme:"purple",children:"id"})," (referenced by tokens, collections, dimensions, and taxonomies), a human-readable ",o.jsx(Nt,{colorScheme:"purple",children:"displayName"}),", and an optional standard ",o.jsx(Nt,{colorScheme:"purple",children:"type"})," (UPPER_CASE, for standards compliance).",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Custom value types:"})," You may define your own custom value types by omitting the ",o.jsx(Nt,{colorScheme:"purple",children:"type"})," field. Custom types must still have a unique ",o.jsx(Nt,{colorScheme:"purple",children:"id"})," and ",o.jsx(Nt,{colorScheme:"purple",children:"displayName"}),". These can be referenced by tokens, collections, dimensions, and taxonomies using their ",o.jsx(Nt,{colorScheme:"purple",children:"id"}),".",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Technical notes:"}),o.jsxs(Yo,{mt:1,mb:1,children:[o.jsxs(Fr,{children:["All references to value types elsewhere in the data model must use the ",o.jsx("b",{children:"id"})," field from this array (never UPPER_CASE enums)."]}),o.jsxs(Fr,{children:["Additional fields like ",o.jsx(Nt,{colorScheme:"purple",children:"description"})," and ",o.jsx(Nt,{colorScheme:"purple",children:"validation"})," may be present for documentation and validation purposes."]}),o.jsx(Fr,{children:"Custom value types allow for extensibility beyond the standard set (see example below)."}),o.jsxs(Fr,{children:["See ",o.jsx(Nt,{colorScheme:"purple",children:"schema.json"})," and ",o.jsx(Nt,{colorScheme:"purple",children:"technical-decisions.md"})," for full structure and rationale."]})]})]}),o.jsx(Tr,{code:JSON.stringify({resolvedValueTypes:[{id:"color",displayName:"Color",type:"COLOR",description:"A color value, e.g. #RRGGBB or rgba()."},{id:"fontFamily",displayName:"Font Family",type:"FONT_FAMILY",description:"A font family name or stack."},{id:"dimension",displayName:"Dimension",type:"DIMENSION",description:"A numeric value with a unit, e.g. 16px or 1.5rem."},{id:"spacing",displayName:"Spacing",type:"SPACING",description:"A spacing value, e.g. 16px or 1rem."},{id:"icon",displayName:"Icon",description:"A custom value type for referencing icon names in the design system.",validation:{pattern:"^[a-z0-9-]+$"}}]},null,2)}),o.jsxs(E,{fontSize:"sm",color:"gray.500",mt:2,children:[o.jsx("b",{children:"Custom value type example:"})," The ",o.jsx(Nt,{colorScheme:"purple",children:"icon"})," value type above is a custom type (no ",o.jsx(Nt,{colorScheme:"purple",children:"type"})," field). It can be referenced by tokens, collections, dimensions, and taxonomies using ",o.jsx(Nt,{colorScheme:"purple",children:'resolvedValueTypeId: "icon"'})," or ",o.jsx(Nt,{colorScheme:"purple",children:'resolvedValueTypeIds: ["icon"]'}),". Custom types are validated and referenced exactly like standard types."]})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Token Collections"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"tokenCollections"})," (required): Collections of tokens grouped by type.",o.jsx("br",{}),"Each collection specifies which value types it supports using ",o.jsx(Nt,{colorScheme:"purple",children:"resolvedValueTypeIds"})," (string IDs, not enums).",o.jsx("br",{}),o.jsx("b",{children:"Technical note:"})," All reference fields use the ",o.jsx("b",{children:"ID/Ids suffix"})," convention for clarity and validation."]}),o.jsx(Tr,{code:JSON.stringify({tokenCollections:[{id:"collection-color",name:"Color",description:"Color tokens for the design system",resolvedValueTypeIds:["color"],private:!1},{id:"collection-typography",name:"Typography",description:"Typography tokens for the design system",resolvedValueTypeIds:["fontFamily","fontSize","fontWeight","lineHeight"],private:!1}]},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Dimensions"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"dimensions"})," (required): Dimensions that can modify token values.",o.jsx("br",{}),"Each dimension contains one or more ",o.jsx("b",{children:"modes"})," (with ",o.jsx(Nt,{colorScheme:"purple",children:"id"}),", ",o.jsx(Nt,{colorScheme:"purple",children:"name"}),", and ",o.jsx(Nt,{colorScheme:"purple",children:"dimensionId"}),"), and specifies supported value types via ",o.jsx(Nt,{colorScheme:"purple",children:"resolvedValueTypeIds"}),".",o.jsx("br",{}),o.jsx("b",{children:"Technical note:"})," All reference fields use the ",o.jsx("b",{children:"ID/Ids suffix"})," convention. Value types are referenced by string ID only."]}),o.jsx(Tr,{code:JSON.stringify({dimensions:[{id:"dimension-color-scheme",displayName:"Color Scheme",description:"Color scheme dimension for light and dark themes",modes:[{id:"mode-light",name:"Light",description:"Light theme mode",dimensionId:"dimension-color-scheme"},{id:"mode-dark",name:"Dark",description:"Dark theme mode",dimensionId:"dimension-color-scheme"}],resolvedValueTypeIds:["color","dimension","spacing"],defaultMode:"mode-light",required:!0}]},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Tokens"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"tokens"})," (required): Design tokens with values that can vary by mode.",o.jsx("br",{}),"Each token references its collection and value type by ID (",o.jsx(Nt,{colorScheme:"purple",children:"tokenCollectionId"}),", ",o.jsx(Nt,{colorScheme:"purple",children:"resolvedValueTypeId"}),").",o.jsx("br",{}),o.jsx("b",{children:"valuesByMode"}),": Each entry must use ",o.jsx(Nt,{colorScheme:"purple",children:"modeIds"})," (array of string IDs). Value type is determined by the token's ",o.jsx(Nt,{colorScheme:"purple",children:"resolvedValueTypeId"}),".",o.jsx("br",{}),o.jsx("b",{children:"Technical note:"})," Never use UPPER_CASE enums for value types; always reference by string ID. Platform-specific overrides are now handled through platform extension files rather than inline ",o.jsx(Nt,{colorScheme:"purple",children:"platformOverrides"}),"."]}),o.jsx(Tr,{code:JSON.stringify({tokens:[{id:"token-blue-500",displayName:"Blue 500",description:"Primary blue color token",tokenCollectionId:"collection-color",resolvedValueTypeId:"color",tokenTier:"PRIMITIVE",private:!1,status:"stable",themeable:!0,generatedByAlgorithm:!1,propertyTypes:["color","background-color"],valuesByMode:[{modeIds:["mode-light"],value:{value:"#3B82F6"}},{modeIds:["mode-dark"],value:{value:"#60A5FA"}},{modeIds:[],value:{tokenId:"token-blue-400"}}]}]},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Figma Configuration"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"figmaConfiguration"})," (optional): Figma publishing configuration for design tool integration.",o.jsx("br",{}),"Contains ",o.jsx(Nt,{colorScheme:"purple",children:"syntaxPatterns"})," for generating Figma token names and a ",o.jsx(Nt,{colorScheme:"purple",children:"fileKey"})," for the default Figma file.",o.jsx("br",{}),o.jsx("b",{children:"Technical note:"})," Figma is now properly conceptualized as a publishing destination rather than a platform."]}),o.jsx(Tr,{code:JSON.stringify({figmaConfiguration:{syntaxPatterns:{prefix:"",suffix:"",delimiter:"_",capitalization:"camel",formatString:""},fileKey:"default-design-system-figma"}},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Platforms"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"platforms"})," (required): Runtime platforms that can be used to resolve token values.",o.jsx("br",{}),"Each platform must reference an external platform extension file via ",o.jsx(Nt,{colorScheme:"purple",children:"extensionSource"})," containing platform-specific syntax patterns, value formatters, and overrides.",o.jsx("br",{}),o.jsx("b",{children:"Technical note:"})," All platform-specific configuration and data is contained in external platform extension files, keeping the core schema focused on the canonical token structure."]}),o.jsx(Tr,{code:JSON.stringify({platforms:[{id:"platform-web",displayName:"Web",description:"Web platform for CSS and JavaScript",extensionSource:{repositoryUri:"web-team/design-tokens-web",filePath:"platforms/platform-web.json"},status:"active"},{id:"platform-ios",displayName:"iOS",description:"iOS platform for Swift and SwiftUI",extensionSource:{repositoryUri:"ios-team/design-tokens-ios",filePath:"platforms/platform-ios.json"},status:"active"}]},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Themes"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"themes"})," (required): Themes that can override token values across the entire dataset.",o.jsx("br",{}),"Each theme has an ",o.jsx(Nt,{colorScheme:"purple",children:"overrideFileUri"})," that points to a theme override file.",o.jsx("br",{}),o.jsx("b",{children:"Technical note:"})," Exactly one theme must be marked as ",o.jsx(Nt,{colorScheme:"purple",children:"isDefault: true"}),"."]}),o.jsx(Tr,{code:JSON.stringify({themes:[{id:"theme-default",displayName:"Default Theme",description:"The default theme for the design system",isDefault:!0,overrideFileUri:"themed/default-overrides.json"},{id:"theme-brand-a",displayName:"Brand A Theme",description:"Brand A specific theme overrides",isDefault:!1,overrideFileUri:"themed/brand-a-overrides.json"}]},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Taxonomies"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"taxonomies"})," (optional): Categorical classification system for organizing tokens.",o.jsx("br",{}),"Each taxonomy contains terms and specifies which value types it supports via ",o.jsx(Nt,{colorScheme:"purple",children:"resolvedValueTypeIds"}),".",o.jsx("br",{}),o.jsx("b",{children:"Technical note:"})," Taxonomies provide flexible categorization beyond traditional grouping by value type."]}),o.jsx(Tr,{code:JSON.stringify({taxonomies:[{id:"taxonomy-semantic",name:"Semantic Classification",description:"Semantic classification of tokens",terms:[{id:"term-primary",name:"Primary",description:"Primary brand colors and elements"},{id:"term-secondary",name:"Secondary",description:"Secondary brand colors and elements"}],resolvedValueTypeIds:["color","dimension","spacing"]}]},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Naming Rules"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"namingRules"})," (optional): Rules for generating code syntax and naming conventions for tokens.",o.jsx("br",{}),o.jsx(Nt,{colorScheme:"purple",children:"taxonomyOrder"})," determines the order of taxonomy terms when generating code syntax strings."]}),o.jsx(Tr,{code:JSON.stringify({namingRules:{taxonomyOrder:["taxonomy-semantic","taxonomy-component"]}},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Dimension Evolution"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"dimensionEvolution"})," (optional): Rules for handling dimension changes and migrations.",o.jsx("br",{}),"Defines how to handle empty modeIds and whether to preserve default values when mapping."]}),o.jsx(Tr,{code:JSON.stringify({dimensionEvolution:{rules:[{whenAdding:"dimension-size",mapEmptyModeIdsTo:["mode-default"],preserveDefaultValues:!0}]}},null,2)})]})]}),tR=()=>{const[t,e]=M.useState(""),[r,n]=M.useState(!0),[s,i]=M.useState(null),{colorMode:a}=Vt();return M.useEffect(()=>{(async()=>{n(!0),i(null);try{const c=await zf.core();e(JSON.stringify(c.default,null,2))}catch{i("Failed to load example data")}finally{n(!1)}})()},[]),r?o.jsx(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:o.jsx(kn,{})}):s?o.jsx(z,{p:4,children:o.jsx(E,{color:"red.500",children:s})}):o.jsx(z,{overflow:"auto",height:"100%",children:o.jsx(Tr,{code:t})})},rR=()=>o.jsxs(zc,{maxW:"1000px",p:0,children:[o.jsxs(ce,{spacing:4,align:"stretch",mb:6,children:[o.jsx(Tt,{size:"lg",children:"Core Data Schema"}),o.jsxs(E,{children:["The core data schema defines the canonical structure for the Token Model system, including tokens, collections, dimensions, platforms, themes, and taxonomies. It serves as the single source of truth for validation and interoperability, defining which tokens are themeable, how they can be customized, and how they relate to each other. The schema requires system identification, versioning, and comprehensive token definitions with support for multi-dimensional modes, platform-specific code syntax, and algorithmic generation.",o.jsx("b",{children:"Key updates:"})," Figma is now properly conceptualized as a publishing destination with dedicated configuration, and platform-specific overrides are handled through external platform extension files referenced via the ",o.jsx(Nt,{colorScheme:"purple",children:"extensionSource"})," property in platforms."]})]}),o.jsxs(Es,{children:[o.jsxs(Ms,{children:[o.jsx(pr,{children:"Properties"}),o.jsx(pr,{children:"Example"})]}),o.jsxs(Ls,{children:[o.jsx(Ir,{children:o.jsx(eR,{})}),o.jsx(Ir,{children:o.jsx(tR,{})})]})]})]}),nR=()=>o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"System ID"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"systemId"})," (required): ID of the core token system this theme override is for. This field ensures that the theme override file is linked to the correct core data set. It must match the ",o.jsx(Nt,{colorScheme:"purple",children:"systemId"})," in the main core data file. This guarantees referential integrity and prevents accidental overrides of the wrong system.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Why is this required?"}),o.jsxs(Yo,{mt:1,mb:1,children:[o.jsx(Fr,{children:"Ensures that overrides are only applied to the intended design system."}),o.jsx(Fr,{children:"Prevents data corruption and accidental cross-system overrides."}),o.jsx(Fr,{children:"Supports validation and safe merging of theme data."})]})]}),o.jsx(Tr,{code:JSON.stringify({systemId:"acme-design-system"},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Theme ID"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"themeId"})," (required): ID of the theme these overrides belong to. This field references the specific theme being customized. It must match a theme defined in the core data file's ",o.jsx(Nt,{colorScheme:"purple",children:"themes"})," array. This linkage ensures that each override file is associated with a valid, existing theme.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Why is this required?"}),o.jsxs(Yo,{mt:1,mb:1,children:[o.jsx(Fr,{children:"Guarantees that overrides are only applied to valid, pre-defined themes."}),o.jsx(Fr,{children:"Prevents orphaned or misapplied overrides."}),o.jsx(Fr,{children:"Supports validation and safe theme management."})]})]}),o.jsx(Tr,{code:JSON.stringify({themeId:"theme-brand-a"},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Token Overrides"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"tokenOverrides"})," (required): Overrides for tokens in this theme. This array lists all the tokens whose values are being customized for the theme. Each entry must reference a valid, themeable token from the core data set. Only tokens marked as ",o.jsx(Nt,{colorScheme:"purple",children:"themeable: true"})," in the core data can be overridden.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"valuesByMode Structure:"})," Each token override uses the same ",o.jsx(Nt,{colorScheme:"purple",children:"valuesByMode"})," structure as the core schema, with ",o.jsx(Nt,{colorScheme:"purple",children:"modeIds"})," arrays and support for both direct values and aliases.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Why this structure?"}),o.jsxs(Yo,{mt:1,mb:1,children:[o.jsx(Fr,{children:"Ensures that only explicitly themeable tokens can be overridden, preserving the integrity of core tokens."}),o.jsx(Fr,{children:"Allows theme designers to safely extend or customize the design system without modifying the core data."}),o.jsx(Fr,{children:"Supports mode-specific overrides, enabling different values for different theme modes (e.g., light/dark)."}),o.jsx(Fr,{children:"Supports validation: each override is checked for type and value constraints, and must reference a valid token ID."})]}),o.jsx("b",{children:"Technical note:"})," The ",o.jsx(Nt,{colorScheme:"purple",children:"value"})," object must match the type and constraints of the original token. This ensures that overrides are always valid and compatible with the core schema."]}),o.jsx(Tr,{code:JSON.stringify({tokenOverrides:[{tokenId:"token-primary-color",valuesByMode:[{modeIds:["mode-light"],value:{value:"#FF6F61"}},{modeIds:["mode-dark"],value:{value:"#FF8A80"}},{modeIds:[],value:{tokenId:"token-accent-color"}}]}]},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Platform Overrides"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"platformOverrides"})," (optional): Platform-specific overrides within each ",o.jsx(Nt,{colorScheme:"purple",children:"valuesByMode"})," entry. This allows you to specify different override values for different platforms (e.g., Web, iOS, Android) within a specific mode combination.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Why platform overrides?"}),o.jsxs(Yo,{mt:1,mb:1,children:[o.jsx(Fr,{children:"Enables fine-grained control over how tokens are rendered or exported for each platform."}),o.jsx(Fr,{children:"Supports platform-specific design requirements and constraints."}),o.jsx(Fr,{children:"Ensures that overrides remain valid and consistent across all platforms."}),o.jsx(Fr,{children:"Allows mode-specific platform overrides (e.g., different web colors for light vs dark modes)."})]}),o.jsx("b",{children:"Technical note:"})," Each ",o.jsx(Nt,{colorScheme:"purple",children:"platformId"})," must reference a valid platform defined in the core data. The ",o.jsx(Nt,{colorScheme:"purple",children:"value"})," must be a string that matches the platform's expected format."]}),o.jsx(Tr,{code:JSON.stringify({tokenOverrides:[{tokenId:"token-primary-color",valuesByMode:[{modeIds:["mode-light"],value:{value:"#FF6F61"},platformOverrides:[{platformId:"platform-web",value:"#FF6F61",metadata:{description:"Web-specific primary color override"}},{platformId:"platform-ios",value:"#FF6F61",metadata:{description:"iOS-specific primary color override"}}]}]}]},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Metadata"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"metadata"})," (optional): Additional information about specific value overrides. This can include descriptions, change reasons, or other contextual information about why a particular override was made.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Why metadata?"}),o.jsxs(Yo,{mt:1,mb:1,children:[o.jsx(Fr,{children:"Provides context for why specific overrides were made."}),o.jsx(Fr,{children:"Supports documentation and change tracking."}),o.jsx(Fr,{children:"Helps maintainers understand the reasoning behind theme customizations."})]})]}),o.jsx(Tr,{code:JSON.stringify({tokenOverrides:[{tokenId:"token-primary-color",valuesByMode:[{modeIds:["mode-light"],value:{value:"#FF6F61"},metadata:{description:"Brand A primary color for light mode",changeReason:"Brand guidelines update",approvedBy:"design-team"}}]}]},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Complete Example"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"Complete theme override structure:"})," This example shows a comprehensive theme override file with all available features including mode-specific values, platform overrides, and metadata."]}),o.jsx(Tr,{code:JSON.stringify({systemId:"acme-design-system",themeId:"theme-brand-a",tokenOverrides:[{tokenId:"token-primary-color",valuesByMode:[{modeIds:["mode-light"],value:{value:"#FF6F61"},platformOverrides:[{platformId:"platform-web",value:"#FF6F61"}],metadata:{description:"Brand A primary color for light mode"}},{modeIds:["mode-dark"],value:{value:"#FF8A80"},metadata:{description:"Brand A primary color for dark mode"}}]},{tokenId:"token-accent-color",valuesByMode:[{modeIds:[],value:{tokenId:"token-primary-color"}}]}]},null,2)})]})]}),sR=()=>{const[t,e]=M.useState(""),[r,n]=M.useState(!0),[s,i]=M.useState(null),{colorMode:a}=Vt();return M.useEffect(()=>{(async()=>{n(!0),i(null);try{const c=await zf.brandAOverrides();e(JSON.stringify(c.default,null,2))}catch{i("Failed to load example data")}finally{n(!1)}})()},[]),r?o.jsx(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:o.jsx(kn,{})}):s?o.jsx(z,{p:4,children:o.jsx(E,{color:"red.500",children:s})}):o.jsx(z,{overflow:"auto",height:"100%",children:o.jsx(Tr,{code:t})})},oR=()=>o.jsxs(zc,{maxW:"1000px",p:0,children:[o.jsxs(ce,{spacing:4,align:"stretch",mb:6,children:[o.jsx(Tt,{size:"lg",children:"Theme Overrides Schema"}),o.jsx(E,{children:"Theme overrides provide a safe, schema-driven way to extend or customize tokens that are explicitly marked as themeable in the core data. This schema enables teams to create and maintain different themes independently, without modifying the core token set. Each theme override file must reference the core system ID and can only override tokens that are explicitly marked as themeable. The schema supports mode-specific overrides, platform-specific values, and comprehensive metadata for change tracking and documentation."})]}),o.jsxs(Es,{children:[o.jsxs(Ms,{children:[o.jsx(pr,{children:"Properties"}),o.jsx(pr,{children:"Example"})]}),o.jsxs(Ls,{children:[o.jsx(Ir,{children:o.jsx(nR,{})}),o.jsx(Ir,{children:o.jsx(sR,{})})]})]})]}),iR=()=>o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"System & Platform Identification"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"systemId"})," (required): ID of the core system this extension belongs to.",o.jsx("br",{}),o.jsx("b",{children:"platformId"})," (required): ID of the platform this extension is for.",o.jsx("br",{}),o.jsx("b",{children:"version"})," (required): Version of this platform extension.",o.jsx("br",{}),o.jsx("b",{children:"status"}),' (optional): Lifecycle status - "active" or "deprecated".',o.jsx("br",{}),o.jsx("br",{}),"These fields ensure proper identification and versioning of platform extensions, linking them to the correct core system and platform."]}),o.jsx(Tr,{code:JSON.stringify({systemId:"acme-design-system",platformId:"platform-ios",version:"1.0.0",status:"active"},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Figma Configuration"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"figmaFileKey"})," (required): Unique Figma file key for this platform extension.",o.jsx("br",{}),"This key must be unique across all platform extensions and cannot be overridden.",o.jsx("br",{}),o.jsx("b",{children:"Technical note:"})," Each platform extension must have its own unique Figma file for platform-specific publishing."]}),o.jsx(Tr,{code:JSON.stringify({figmaFileKey:"ios-platform-figma-file-key"},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Syntax Patterns"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"syntaxPatterns"})," (optional): Platform-specific syntax patterns for code generation.",o.jsx("br",{}),"These patterns are used for generating platform-specific code syntax, not for Figma.",o.jsx("br",{}),o.jsx("b",{children:"Technical note:"})," Figma uses the core ",o.jsx(Nt,{colorScheme:"purple",children:"figmaConfiguration.syntaxPatterns"})," for consistency."]}),o.jsx(Tr,{code:JSON.stringify({syntaxPatterns:{prefix:"",suffix:"",delimiter:"_",capitalization:"camel",formatString:""}},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Value Formatters"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"valueFormatters"})," (optional): Platform-specific value formatting rules.",o.jsx("br",{}),"Defines how values should be formatted for this platform (colors, dimensions, precision).",o.jsx("br",{}),o.jsx("b",{children:"Technical note:"})," These formatters are applied when generating platform-specific code."]}),o.jsx(Tr,{code:JSON.stringify({valueFormatters:{color:"hex",dimension:"dp",numberPrecision:2}},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Token Overrides"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"tokenOverrides"})," (optional): Platform-specific token overrides and additions.",o.jsx("br",{}),"Each override can modify existing tokens or add new platform-specific tokens.",o.jsx("br",{}),o.jsx("b",{children:"omit"}),": If true, the token is omitted from this platform (hidden, not deleted).",o.jsx("br",{}),o.jsx("b",{children:"Technical note:"})," Token overrides maintain the same structure as core tokens but allow platform-specific customization."]}),o.jsx(Tr,{code:JSON.stringify({tokenOverrides:[{id:"token-blue-500",displayName:"iOS Blue 500",description:"iOS-specific blue color with different value",themeable:!0,private:!1,status:"stable",tokenTier:"PRIMITIVE",resolvedValueTypeId:"color",generatedByAlgorithm:!1,valuesByMode:[{modeIds:["mode-light"],value:{value:"#007AFF"}},{modeIds:["mode-dark"],value:{value:"#0A84FF"}}],omit:!1}]},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Algorithm Variable Overrides"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"algorithmVariableOverrides"})," (optional): Platform-specific algorithm variable overrides.",o.jsx("br",{}),"Allows platforms to customize algorithm variables (not formulas) for platform-specific needs.",o.jsx("br",{}),o.jsx("b",{children:"Technical note:"})," Only variable values can be overridden, not the algorithm formulas themselves."]}),o.jsx(Tr,{code:JSON.stringify({algorithmVariableOverrides:[{algorithmId:"algorithm-spacing-scale",variableId:"base-spacing",valuesByMode:[{modeIds:["mode-light"],value:8},{modeIds:["mode-dark"],value:10}]}]},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Omissions"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"omittedModes"})," (optional): List of mode IDs omitted from this platform (hidden, not deleted).",o.jsx("br",{}),o.jsx("b",{children:"omittedDimensions"})," (optional): List of dimension IDs omitted from this platform (hidden, not deleted).",o.jsx("br",{}),o.jsx("b",{children:"Technical note:"})," Omissions allow platforms to hide certain modes or dimensions without affecting the core data structure."]}),o.jsx(Tr,{code:JSON.stringify({omittedModes:["mode-high-contrast"],omittedDimensions:["dimension-accessibility"]},null,2)})]})]}),aR=()=>{const t={systemId:"acme-design-system",platformId:"platform-ios",version:"1.0.0",status:"active",figmaFileKey:"ios-platform-figma-file-key",syntaxPatterns:{prefix:"",suffix:"",delimiter:"_",capitalization:"camel",formatString:""},valueFormatters:{color:"hex",dimension:"dp",numberPrecision:2},algorithmVariableOverrides:[{algorithmId:"algorithm-spacing-scale",variableId:"base-spacing",valuesByMode:[{modeIds:["mode-light"],value:8},{modeIds:["mode-dark"],value:10}]},{algorithmId:"algorithm-typography-scale",variableId:"base-font-size",valuesByMode:[{modeIds:["mode-light"],value:16},{modeIds:["mode-dark"],value:18}]}],tokenOverrides:[{id:"token-blue-500",displayName:"iOS Blue 500",description:"iOS-specific blue color optimized for iOS Human Interface Guidelines",themeable:!0,private:!1,status:"stable",tokenTier:"PRIMITIVE",resolvedValueTypeId:"color",generatedByAlgorithm:!1,valuesByMode:[{modeIds:["mode-light"],value:{value:"#007AFF"}},{modeIds:["mode-dark"],value:{value:"#0A84FF"}}],omit:!1},{id:"token-spacing-xs",displayName:"iOS Extra Small Spacing",description:"iOS-specific extra small spacing using dp units",themeable:!1,private:!1,status:"stable",tokenTier:"PRIMITIVE",resolvedValueTypeId:"spacing",generatedByAlgorithm:!0,algorithmId:"algorithm-spacing-scale",valuesByMode:[{modeIds:["mode-light"],value:{value:4}},{modeIds:["mode-dark"],value:{value:5}}],omit:!1},{id:"token-button-primary",displayName:"iOS Primary Button",description:"iOS-specific primary button styling",themeable:!0,private:!1,status:"stable",tokenTier:"COMPONENT",resolvedValueTypeId:"color",generatedByAlgorithm:!1,propertyTypes:[{id:"background-color",displayName:"Background Color",category:"color",compatibleValueTypes:["color"],platformMappings:{ios:[".background()",".backgroundColor"],android:["background","colorBackground"]}}],valuesByMode:[{modeIds:["mode-light"],value:{value:"#007AFF"}},{modeIds:["mode-dark"],value:{value:"#0A84FF"}}],omit:!1},{id:"token-web-only-feature",displayName:"Web Only Feature",description:"This token is omitted from iOS platform",themeable:!1,private:!1,status:"stable",tokenTier:"SEMANTIC",resolvedValueTypeId:"color",generatedByAlgorithm:!1,valuesByMode:[{modeIds:["mode-light"],value:{value:"#FF0000"}}],omit:!0}],omittedModes:["mode-high-contrast"],omittedDimensions:["dimension-accessibility"]};return o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Complete Platform Extension Example"}),o.jsx(E,{mb:4,children:"This example shows a complete iOS platform extension file that demonstrates all the key features of the platform extension schema:"}),o.jsxs(E,{mb:4,fontSize:"sm",color:"gray.600",children:["â€¢ System and platform identification",o.jsx("br",{}),"â€¢ Unique Figma file key for platform-specific publishing",o.jsx("br",{}),"â€¢ iOS-specific syntax patterns and value formatters",o.jsx("br",{}),"â€¢ Algorithm variable overrides for platform-specific customization",o.jsx("br",{}),"â€¢ Token overrides with iOS-optimized values",o.jsx("br",{}),"â€¢ Token omissions for platform-specific filtering",o.jsx("br",{}),"â€¢ Mode and dimension omissions for platform simplification"]})]}),o.jsx(z,{children:o.jsx(Tr,{code:JSON.stringify(t,null,2)})}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Key Features Demonstrated"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"Platform-Specific Customization:"})," The iOS platform extension customizes colors, spacing, and typography to match iOS Human Interface Guidelines.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Algorithm Integration:"})," Algorithm variable overrides allow the platform to customize the base values used by algorithms while maintaining the core algorithm logic.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Selective Omission:"})," The platform omits web-specific tokens and high-contrast modes that aren't relevant for iOS.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Figma Publishing:"})," The unique ",o.jsx("code",{children:"figmaFileKey"})," ensures iOS tokens are published to a dedicated Figma file for platform-specific design work."]})]})]})},lR=()=>o.jsxs(zc,{maxW:"1000px",p:0,children:[o.jsxs(ce,{spacing:4,align:"stretch",mb:6,children:[o.jsx(Tt,{size:"lg",children:"Platform Extension Schema"}),o.jsxs(E,{children:["Platform extensions provide a safe, schema-driven way to extend or customize tokens for specific platforms while maintaining the core token set as the single source of truth. This schema enables platform teams to create and maintain platform-specific overrides, additions, and configurations independently. Each platform extension must reference the core system ID and platform ID, and includes a unique ",o.jsx(Nt,{colorScheme:"purple",children:"figmaFileKey"})," for platform-specific Figma publishing. The schema supports token overrides, algorithm variable overrides, syntax patterns, value formatters, and mode/dimension omissions for platform-specific customization."]})]}),o.jsxs(Es,{children:[o.jsxs(Ms,{children:[o.jsx(pr,{children:"Properties"}),o.jsx(pr,{children:"Example"})]}),o.jsxs(Ls,{children:[o.jsx(Ir,{children:o.jsx(iR,{})}),o.jsx(Ir,{children:o.jsx(aR,{})})]})]})]}),cR=()=>o.jsxs(ce,{spacing:6,align:"stretch",children:[o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Schema Version & Profile"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"schemaVersion"})," (required): Semantic version of the algorithm schema, following semantic versioning (e.g., 5.0.0).",o.jsx("br",{}),o.jsx("b",{children:"profile"})," (optional): Complexity profile determining available features and validation strictness. Options are ",o.jsx(Nt,{colorScheme:"purple",children:"basic"}),", ",o.jsx(Nt,{colorScheme:"purple",children:"standard"}),", or ",o.jsx(Nt,{colorScheme:"purple",children:"advanced"}),".",o.jsx("br",{}),o.jsx("br",{}),"The profile determines which features are available and how strict validation should be. Basic profiles have simpler validation rules, while advanced profiles support complex mathematical operations and conditional logic."]}),o.jsx(Tr,{code:JSON.stringify({schemaVersion:"5.0.0",profile:"basic"},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Metadata"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"metadata"})," (optional): Information about the algorithm collection including name, description, version, and author.",o.jsx("br",{}),"This provides context and documentation for the algorithm collection, making it easier to understand its purpose and maintain it over time."]}),o.jsx(Tr,{code:JSON.stringify({metadata:{name:"Design System Algorithm Collection",description:"Algorithms for generating design tokens programmatically",version:"1.0.0",author:"Design System Team"}},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"System Variables"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"config.systemVariables"})," (optional): Global variables that can be referenced by algorithms across the collection.",o.jsx("br",{}),"System variables can be mode-based, allowing different values for different contexts (e.g., viewport sizes, text size indices).",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Mode-Based Variables:"})," Variables with ",o.jsx(Nt,{colorScheme:"purple",children:"modeBased: true"})," use the same ",o.jsx(Nt,{colorScheme:"purple",children:"valuesByMode"})," structure as tokens, with ",o.jsx(Nt,{colorScheme:"purple",children:"modeIds"})," arrays and mode-specific values."]}),o.jsx(Tr,{code:JSON.stringify({config:{systemVariables:[{id:"viewport-width",name:"viewportWidth",type:"number",defaultValue:320,description:"Current viewport width for responsive calculations",modeBased:!0,dimensionId:"dimension-viewport",valuesByMode:[{modeIds:["mode-mobile"],value:320},{modeIds:["mode-tablet"],value:768},{modeIds:["mode-desktop"],value:1200}]},{id:"text-size-index",name:"textSizeIndex",type:"number",defaultValue:0,description:"Text size index for typography scaling",constraints:{min:-2,max:2,step:1}}]}},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Algorithms"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"algorithms"})," (required): Array of algorithm definitions for generating design tokens programmatically.",o.jsx("br",{}),"Each algorithm specifies variables, formulas, conditions, and execution steps to produce token values.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Key Components:"}),o.jsxs(Yo,{mt:1,mb:1,children:[o.jsxs(Fr,{children:[o.jsx(Nt,{colorScheme:"purple",children:"resolvedValueTypeId"}),": References the value type this algorithm generates (must match core schema)"]}),o.jsxs(Fr,{children:[o.jsx(Nt,{colorScheme:"purple",children:"variables"}),": Input variables with types, defaults, and constraints"]}),o.jsxs(Fr,{children:[o.jsx(Nt,{colorScheme:"purple",children:"formulas"}),": Mathematical expressions in multiple formats (LaTeX, JavaScript, AST)"]}),o.jsxs(Fr,{children:[o.jsx(Nt,{colorScheme:"purple",children:"conditions"}),": Validation and conditional logic"]}),o.jsxs(Fr,{children:[o.jsx(Nt,{colorScheme:"purple",children:"steps"}),": Execution order of formulas and conditions"]})]})]}),o.jsx(Tr,{code:JSON.stringify({algorithms:[{id:"typography-scale-algorithm",name:"Typography Scale Algorithm",description:"Generates font sizes using modular scale",resolvedValueTypeId:"fontSize",variables:[{id:"base",name:"Base",type:"number",defaultValue:"16",description:"Base font size"},{id:"ratio",name:"Ratio",type:"number",defaultValue:"1.25",description:"Modular scale ratio"}],formulas:[{id:"font-size-calculation",name:"Font Size Calculation",description:"Calculate font size using modular scale",expressions:{latex:{value:"fontSize = base \\times ratio^n"},javascript:{value:"fontSize = base * Math.pow(ratio, n)",metadata:{allowedOperations:["math"]}},ast:{type:"assignment",variableName:"fontSize",expression:{type:"binary",operator:"*",left:{type:"variable",variableName:"base"},right:{type:"function",functionName:"Math.pow",arguments:[{type:"variable",variableName:"ratio"},{type:"variable",variableName:"n"}]}}}},variableIds:["base","ratio"]}],conditions:[{id:"validate-ratio",name:"Validate Ratio",expression:"ratio > 0 && ratio <= 2",variableIds:["ratio"]}],steps:[{type:"condition",id:"validate-ratio",name:"Validate Ratio"},{type:"formula",id:"font-size-calculation",name:"Calculate Font Size"}]}]},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Expression Formats"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"expressions"}),": Each formula supports multiple expression formats for different use cases and validation.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"LaTeX:"})," Mathematical notation for documentation and display purposes.",o.jsx("br",{}),o.jsx("b",{children:"JavaScript:"})," Executable code with metadata about allowed operations.",o.jsx("br",{}),o.jsx("b",{children:"AST:"})," Abstract Syntax Tree for validation, analysis, and transformation.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Technical note:"})," All expressions must produce the same result regardless of format. The AST format enables advanced validation and optimization."]}),o.jsx(Tr,{code:JSON.stringify({expressions:{latex:{value:"result = base \\times multiplier^n"},javascript:{value:"result = base * Math.pow(multiplier, n)",metadata:{allowedOperations:["math"]}},ast:{type:"assignment",variableName:"result",expression:{type:"binary",operator:"*",left:{type:"variable",variableName:"base"},right:{type:"function",functionName:"Math.pow",arguments:[{type:"variable",variableName:"multiplier"},{type:"variable",variableName:"n"}]}},metadata:{astVersion:"1.0.0",validationErrors:[],complexity:"medium"}}}},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Execution Configuration"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"execution"})," (optional): Configuration for algorithm execution including order, parallel processing, and error handling.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Key Features:"}),o.jsxs(Yo,{mt:1,mb:1,children:[o.jsxs(Fr,{children:[o.jsx(Nt,{colorScheme:"purple",children:"order"}),": Explicit execution order for algorithms (optional if auto-detected)"]}),o.jsxs(Fr,{children:[o.jsx(Nt,{colorScheme:"purple",children:"parallel"}),": Enable parallel execution if supported"]}),o.jsxs(Fr,{children:[o.jsx(Nt,{colorScheme:"purple",children:"onError"}),": Error handling strategy (stop, skip, warn)"]})]})]}),o.jsx(Tr,{code:JSON.stringify({execution:{order:["typography-scale-algorithm","spacing-scale-algorithm"],parallel:!1,onError:"stop"}},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Integration Settings"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"integration"})," (optional): Settings for integrating with the main token schema and output generation.",o.jsx("br",{}),o.jsx("br",{}),o.jsx("b",{children:"Key Features:"}),o.jsxs(Yo,{mt:1,mb:1,children:[o.jsxs(Fr,{children:[o.jsx(Nt,{colorScheme:"purple",children:"targetSchema"}),": URI or path to the target token schema"]}),o.jsxs(Fr,{children:[o.jsx(Nt,{colorScheme:"purple",children:"outputFormat"}),": Format for generated tokens (design-tokens, custom)"]}),o.jsxs(Fr,{children:[o.jsx(Nt,{colorScheme:"purple",children:"mergeStrategy"}),": How to handle existing tokens (replace, merge, append)"]}),o.jsxs(Fr,{children:[o.jsx(Nt,{colorScheme:"purple",children:"validation"}),": Whether to validate generated tokens against the target schema"]})]})]}),o.jsx(Tr,{code:JSON.stringify({integration:{targetSchema:"https://designsystem.org/schemas/tokens/v1.0.0",outputFormat:"design-tokens",mergeStrategy:"merge",validation:!0}},null,2)})]}),o.jsxs(z,{children:[o.jsx(Tt,{size:"md",mb:4,children:"Examples"}),o.jsxs(E,{mb:2,children:[o.jsx("b",{children:"examples"})," (optional): Use case examples for testing and validation of algorithms.",o.jsx("br",{}),"Each example includes configuration, algorithms, and expected output to help users understand how to use the algorithms effectively."]}),o.jsx(Tr,{code:JSON.stringify({examples:[{name:"Basic Typography Scale",description:"Generate font sizes for a typography scale",useCase:"Typography system generation",config:{baseFontSize:16,ratio:1.25},algorithms:[{id:"typography-scale-algorithm",variables:{base:16,ratio:1.25}}],expectedOutput:{tokens:[{name:"font-size-0",value:16,description:"Base font size"},{name:"font-size-1",value:20,description:"Font size with ratio applied once"}]}}]},null,2)})]})]}),dR=()=>{const[t,e]=M.useState(""),[r,n]=M.useState(!0),[s,i]=M.useState(null);return M.useEffect(()=>{(async()=>{n(!0),i(null);try{const l=await hb.minimal();if(l)e(JSON.stringify(l.default,null,2));else throw new Error("No algorithm example data available")}catch(l){i("Failed to load example data"),console.error("Error loading algorithm example data:",l)}finally{n(!1)}})()},[]),r?o.jsx(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:o.jsx(kn,{})}):s?o.jsx(z,{p:4,children:o.jsx(E,{color:"red.500",children:s})}):o.jsx(z,{overflow:"auto",height:"100%",children:o.jsx(Tr,{code:t})})},uR=()=>o.jsxs(zc,{maxW:"1000px",p:0,children:[o.jsxs(ce,{spacing:4,align:"stretch",mb:6,children:[o.jsx(Tt,{size:"lg",children:"Algorithm Data Schema"}),o.jsx(E,{children:"The algorithm data schema defines the structure for algorithmic design token generation with support for multiple expression formats, system variables, and execution workflows. It serves as the foundation for programmatic token generation, enabling teams to create dynamic design systems that can adapt to different contexts and requirements. The schema supports mathematical formulas, conditional logic, platform-specific execution, and seamless integration with the core token system."})]}),o.jsxs(Es,{children:[o.jsxs(Ms,{children:[o.jsx(pr,{children:"Properties"}),o.jsx(pr,{children:"Example"})]}),o.jsxs(Ls,{children:[o.jsx(Ir,{children:o.jsx(cR,{})}),o.jsx(Ir,{children:o.jsx(dR,{})})]})]})]}),hR=()=>{const[t,e]=M.useState(0),r=[{id:"core-data",label:"Core Data",content:o.jsx(rR,{})},{id:"theme-overrides",label:"Theme Overrides",content:o.jsx(oR,{})},{id:"platform-extensions",label:"Platform Extensions",content:o.jsx(lR,{})},{id:"algorithm-data",label:"Algorithm Data",content:o.jsx(uR,{})}],n=s=>{e(s)};return o.jsx(SN,{tabs:r,activeTab:t,onChange:n,width:"100%",height:"100%"})},mR=({open:t,onClose:e,onSave:r,form:n,componentCategories:s,componentProperties:i,handleFormChange:a,handlePropertyDialogOpen:l,handlePropertyDelete:c})=>{const{colorMode:d}=Vt(),u=m=>{const g=i.find(y=>y.id===m);return g?g.displayName:`Unknown Property (${m})`};return o.jsxs(hh,{open:t,onClose:e,onSave:r,title:n.editingIndex!==null?"Edit Component":"Add Component",children:[o.jsx(I0,{value:n.displayName,onChange:m=>a("displayName",m)}),o.jsx(j0,{value:n.description,onChange:m=>a("description",m)}),o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Category"}),o.jsx(Kt,{value:n.componentCategoryId,onChange:m=>a("componentCategoryId",m.target.value),placeholder:"Select a category...",children:s.map(m=>o.jsx("option",{value:m.id,children:m.displayName},m.id))})]}),o.jsxs(z,{children:[o.jsxs(le,{justify:"space-between",align:"center",mb:2,children:[o.jsx(E,{fontWeight:"bold",children:"Component Properties"}),o.jsx(Oe,{leftIcon:o.jsx(xs,{}),size:"sm",onClick:()=>l(null),colorScheme:"blue",children:"Add Property"})]}),o.jsxs(ce,{align:"stretch",spacing:2,children:[n.componentProperties.map((m,g)=>o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:d==="dark"?"gray.800":"gray.50",borderColor:d==="dark"?"gray.600":"gray.200",children:o.jsxs(le,{justify:"space-between",align:"start",children:[o.jsxs(z,{flex:"1",children:[o.jsx(E,{fontWeight:"medium",children:u(m.componentPropertyId)}),o.jsx(E,{fontSize:"sm",color:"gray.600",children:m.description}),m.supportedOptionIds&&m.supportedOptionIds.length>0&&o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["Supported Options: ",m.supportedOptionIds.length]}),m.default!==void 0&&o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["Default: ",typeof m.default=="boolean"?m.default?"True":"False":m.default]})]}),o.jsxs(le,{children:[o.jsx(Bt,{"aria-label":"Edit property",icon:o.jsx(ys,{}),size:"xs",onClick:()=>l(g)}),o.jsx(Bt,{"aria-label":"Delete property",icon:o.jsx(As,{}),size:"xs",colorScheme:"red",onClick:()=>c(g)})]})]})},m.componentPropertyId)),n.componentProperties.length===0&&o.jsx(E,{fontSize:"sm",color:"gray.500",textAlign:"center",py:4,children:'No properties added yet. Click "Add Property" to get started.'})]})]})]})},pR=({open:t,onClose:e,onSave:r,propertyForm:n,componentProperties:s,handlePropertyFormChange:i,propertyEditIndex:a})=>{const l=s.find(d=>d.id===n.componentPropertyId),c=d=>{const u=s.find(m=>m.id===d);if(u){let m=[],g;u.type==="list"&&u.options&&u.default?(m=[u.default],g=u.default):u.type==="boolean"?g=u.default:g=u.type==="boolean"?!1:"",i("componentPropertyId",d),i("supportedOptionIds",m),i("default",g)}else i("componentPropertyId",d)};return o.jsxs(hh,{open:t,onClose:e,onSave:r,title:a!==null?"Edit Component Property":"Add Component Property",children:[o.jsxs(Ye,{isRequired:!0,children:[o.jsx(Qe,{children:"Property"}),o.jsx(Kt,{value:n.componentPropertyId,onChange:d=>c(d.target.value),placeholder:"Select a property...",children:s.map(d=>o.jsx("option",{value:d.id,children:d.displayName},d.id))})]}),o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Description"}),o.jsx(yt,{value:n.description,onChange:d=>i("description",d.target.value),placeholder:"Describe how this property applies to this component (optional)..."})]}),l&&l.type==="list"&&l.options&&o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Supported Options"}),o.jsx(ce,{align:"stretch",spacing:2,children:l.options.map(d=>{var u;return o.jsxs(le,{justify:"space-between",children:[o.jsx(E,{fontSize:"md",children:d.displayName}),o.jsx(hl,{isChecked:((u=n.supportedOptionIds)==null?void 0:u.includes(d.id))||!1,onChange:m=>{const g=n.supportedOptionIds||[],y=m.target.checked?[...g,d.id]:g.filter(v=>v!==d.id);i("supportedOptionIds",y)},size:"md"})]},d.id)})})]}),l&&o.jsxs(Ye,{children:[o.jsx(Qe,{children:"Default Value"}),l.type==="boolean"?o.jsxs(le,{children:[o.jsx(E,{fontSize:"md",children:"False"}),o.jsx(hl,{isChecked:n.default||!1,onChange:d=>i("default",d.target.checked),colorScheme:"blue",size:"md"}),o.jsx(E,{fontSize:"md",children:"True"})]}):l.type==="list"&&l.options?o.jsx(Kt,{value:n.default||"",onChange:d=>i("default",d.target.value),placeholder:"Select default option...",children:l.options.map(d=>o.jsx("option",{value:d.id,children:d.displayName},d.id))}):null]})]})};function fR({components:t=[],setComponents:e,componentCategories:r=[],componentProperties:n=[],canEdit:s=!1}){const{colorMode:i}=Vt(),[a,l]=M.useState(!1),[c,d]=M.useState(null),[u,m]=M.useState({id:"",displayName:"",description:"",componentCategoryId:"",componentProperties:[]}),[g,y]=M.useState({componentPropertyId:"",description:"",supportedOptionIds:[],default:void 0}),[v,I]=M.useState(!1),[S,b]=M.useState(null),k=Hr();M.useEffect(()=>{e&&L.updateLocalEditsComponents(t)},[t,e]);const[A,C]=M.useState(t);M.useEffect(()=>{C(t)},[t]);const T=(xe=null)=>{if(d(xe),xe!==null){const $=A[xe];m({id:$.id,displayName:$.displayName,description:$.description||"",componentCategoryId:$.componentCategoryId,componentProperties:$.componentProperties.map(B=>({...B,description:B.description||""}))||[]})}else m({id:wn("component"),displayName:"",description:"",componentCategoryId:"",componentProperties:[]});l(!0)},P=()=>{l(!1),d(null)},_=(xe,$)=>{m(B=>({...B,[xe]:$}))},R=async xe=>{try{const $=JSON.parse(localStorage.getItem("token-model:root")||"{}"),{systemName:B="Design System",systemId:U="design-system",version:X="1.0.0",versionHistory:ee=[]}=$,be={systemName:B,systemId:U,description:"Design system with components",tokenCollections:L.getCollections()||[],dimensions:L.getDimensions()||[],tokens:L.getTokens()||[],platforms:L.getPlatforms()||[],themes:L.getThemes()||[{id:"default",displayName:"Default",isDefault:!0}],taxonomies:L.getTaxonomies()||[],resolvedValueTypes:L.getValueTypes()||[],componentProperties:n||[],componentCategories:r||[],components:xe||[],standardPropertyTypes:[],propertyTypes:[],version:X,versionHistory:ee||[]},Se=Aa.validateData(be);if(!Se.isValid){const Me=Array.isArray(Se.errors)?Se.errors.map(se=>typeof se=="string"?se:JSON.stringify(se)).join(", "):"See console for details.";return k({title:"Validation Error",description:`Schema Validation Failed: ${Me}`,status:"error",duration:5e3,isClosable:!0}),!1}return!0}catch($){return console.error("[ComponentsView] Validation error:",$),k({title:"Validation Error",description:"An error occurred while validating the data",status:"error",duration:5e3,isClosable:!0}),!1}},G=async()=>{const xe=u.id&&u.id.trim()?u.id:wn("component");if(!u.displayName.trim()){k({title:"Name is required",status:"error",duration:2e3});return}if(!u.componentCategoryId){k({title:"Category is required",status:"error",duration:2e3});return}for(const X of u.componentProperties)if(!X.componentPropertyId){k({title:"All properties must have a property selected",status:"error",duration:2e3});return}const $=[...A],B={id:xe,displayName:u.displayName,description:u.description,componentCategoryId:u.componentCategoryId,componentProperties:u.componentProperties};c!==null?$[c]=B:$.push(B),C($),L.updateLocalEditsComponents($),e&&e($),await R($)&&(window.dispatchEvent(new CustomEvent("token-model:data-change")),l(!1),d(null),k({title:"Component saved",status:"success",duration:2e3}))},ne=xe=>{const $=A.filter((B,U)=>U!==xe);C($),L.updateLocalEditsComponents($),e&&e($),window.dispatchEvent(new CustomEvent("token-model:data-change")),k({title:"Component deleted",status:"info",duration:2e3})},he=xe=>{if(xe!==null&&u.componentProperties[xe]){const $=u.componentProperties[xe];y({componentPropertyId:$.componentPropertyId,description:$.description||"",supportedOptionIds:$.supportedOptionIds||[],default:$.default})}else y({componentPropertyId:"",description:"",supportedOptionIds:[],default:void 0});I(!0),b(xe)},te=()=>{I(!1),b(null)},K=(xe,$)=>{y(B=>({...B,[xe]:xe==="description"?$||"":$}))},O=()=>{if(!g.componentPropertyId){k({title:"Property is required",status:"error",duration:2e3});return}const xe=[...u.componentProperties];S!==null?xe[S]={...g}:xe.push({...g}),m({...u,componentProperties:xe}),I(!1),b(null)},Z=xe=>{m($=>({...$,componentProperties:$.componentProperties.filter((B,U)=>U!==xe)}))},ie=xe=>{const $=r.find(B=>B.id===xe);return $?$.displayName:`Unknown Category (${xe})`},ge=xe=>{const $=n.find(B=>B.id===xe);return $?$.displayName:`Unknown Property (${xe})`};return o.jsxs(no,{title:"Components",description:"Components are reusable UI elements with defined properties and behaviors. Each component belongs to a category and can have multiple properties with component-specific configurations.",children:[o.jsxs(z,{p:4,mb:4,borderWidth:1,borderRadius:"md",bg:i==="dark"?"gray.900":"white",children:[s&&o.jsx(Oe,{size:"sm",leftIcon:o.jsx(xs,{}),onClick:()=>T(null),colorScheme:"blue",mb:4,children:"Add Component"}),o.jsx(ce,{align:"stretch",spacing:2,children:A.map((xe,$)=>o.jsx(z,{p:3,borderWidth:1,borderRadius:"md",bg:i==="dark"?"gray.800":"gray.50",borderColor:i==="dark"?"gray.600":"gray.200",children:o.jsxs(le,{justify:"space-between",align:"center",children:[o.jsxs(z,{children:[o.jsx(_o,{title:xe.displayName,cardType:"collection"}),o.jsx(E,{fontSize:"sm",color:"gray.600",children:xe.description}),o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["Category: ",ie(xe.componentCategoryId)]}),o.jsxs(E,{fontSize:"sm",color:"gray.600",children:["Properties: ",xe.componentProperties.length]}),xe.componentProperties.length>0&&o.jsx(E,{fontSize:"sm",color:"gray.600",children:xe.componentProperties.map(B=>ge(B.componentPropertyId)).join(", ")})]}),s&&o.jsxs(le,{children:[o.jsx(Bt,{"aria-label":"Edit component",icon:o.jsx(ys,{}),size:"sm",onClick:()=>T($)}),o.jsx(Bt,{"aria-label":"Delete component",icon:o.jsx(As,{}),size:"sm",colorScheme:"red",onClick:()=>ne($)})]})]})},xe.id))})]}),o.jsx(mR,{open:a,onClose:P,onSave:G,form:{...u,editingIndex:c},componentCategories:r,componentProperties:n,handleFormChange:_,handlePropertyDialogOpen:he,handlePropertyDelete:Z}),o.jsx(pR,{open:v,onClose:te,onSave:O,propertyForm:g,componentProperties:n,handlePropertyFormChange:K,propertyEditIndex:S})]})}function J1(t,e){let r=0,n=0;if(e===void 0)for(let s of t)s!=null&&(s=+s)>=s&&(++r,n+=s);else{let s=-1;for(let i of t)(i=e(i,++s,t))!=null&&(i=+i)>=i&&(++r,n+=i)}if(r)return n/r}var gR={value:()=>{}};function Yc(){for(var t=0,e=arguments.length,r={},n;t<e;++t){if(!(n=arguments[t]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new Gd(r)}function Gd(t){this._=t}function yR(t,e){return t.trim().split(/^|\s+/).map(function(r){var n="",s=r.indexOf(".");if(s>=0&&(n=r.slice(s+1),r=r.slice(0,s)),r&&!e.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}Gd.prototype=Yc.prototype={constructor:Gd,on:function(t,e){var r=this._,n=yR(t+"",r),s,i=-1,a=n.length;if(arguments.length<2){for(;++i<a;)if((s=(t=n[i]).type)&&(s=xR(r[s],t.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++i<a;)if(s=(t=n[i]).type)r[s]=Y1(r[s],t.name,e);else if(e==null)for(s in r)r[s]=Y1(r[s],t.name,null);return this},copy:function(){var t={},e=this._;for(var r in e)t[r]=e[r].slice();return new Gd(t)},call:function(t,e){if((s=arguments.length-2)>0)for(var r=new Array(s),n=0,s,i;n<s;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=this._[t],n=0,s=i.length;n<s;++n)i[n].value.apply(e,r)},apply:function(t,e,r){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],s=0,i=n.length;s<i;++s)n[s].value.apply(e,r)}};function xR(t,e){for(var r=0,n=t.length,s;r<n;++r)if((s=t[r]).name===e)return s.value}function Y1(t,e,r){for(var n=0,s=t.length;n<s;++n)if(t[n].name===e){t[n]=gR,t=t.slice(0,n).concat(t.slice(n+1));break}return r!=null&&t.push({name:e,value:r}),t}var yf="http://www.w3.org/1999/xhtml";const K1={svg:"http://www.w3.org/2000/svg",xhtml:yf,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function vh(t){var e=t+="",r=e.indexOf(":");return r>=0&&(e=t.slice(0,r))!=="xmlns"&&(t=t.slice(r+1)),K1.hasOwnProperty(e)?{space:K1[e],local:t}:t}function vR(t){return function(){var e=this.ownerDocument,r=this.namespaceURI;return r===yf&&e.documentElement.namespaceURI===yf?e.createElement(t):e.createElementNS(r,t)}}function bR(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function W4(t){var e=vh(t);return(e.local?bR:vR)(e)}function SR(){}function L0(t){return t==null?SR:function(){return this.querySelector(t)}}function wR(t){typeof t!="function"&&(t=L0(t));for(var e=this._groups,r=e.length,n=new Array(r),s=0;s<r;++s)for(var i=e[s],a=i.length,l=n[s]=new Array(a),c,d,u=0;u<a;++u)(c=i[u])&&(d=t.call(c,c.__data__,u,i))&&("__data__"in c&&(d.__data__=c.__data__),l[u]=d);return new zs(n,this._parents)}function CR(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function kR(){return[]}function q4(t){return t==null?kR:function(){return this.querySelectorAll(t)}}function IR(t){return function(){return CR(t.apply(this,arguments))}}function jR(t){typeof t=="function"?t=IR(t):t=q4(t);for(var e=this._groups,r=e.length,n=[],s=[],i=0;i<r;++i)for(var a=e[i],l=a.length,c,d=0;d<l;++d)(c=a[d])&&(n.push(t.call(c,c.__data__,d,a)),s.push(c));return new zs(n,s)}function J4(t){return function(){return this.matches(t)}}function Y4(t){return function(e){return e.matches(t)}}var TR=Array.prototype.find;function ER(t){return function(){return TR.call(this.children,t)}}function MR(){return this.firstElementChild}function AR(t){return this.select(t==null?MR:ER(typeof t=="function"?t:Y4(t)))}var PR=Array.prototype.filter;function NR(){return Array.from(this.children)}function DR(t){return function(){return PR.call(this.children,t)}}function RR(t){return this.selectAll(t==null?NR:DR(typeof t=="function"?t:Y4(t)))}function OR(t){typeof t!="function"&&(t=J4(t));for(var e=this._groups,r=e.length,n=new Array(r),s=0;s<r;++s)for(var i=e[s],a=i.length,l=n[s]=[],c,d=0;d<a;++d)(c=i[d])&&t.call(c,c.__data__,d,i)&&l.push(c);return new zs(n,this._parents)}function K4(t){return new Array(t.length)}function _R(){return new zs(this._enter||this._groups.map(K4),this._parents)}function Vu(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Vu.prototype={constructor:Vu,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function FR(t){return function(){return t}}function VR(t,e,r,n,s,i){for(var a=0,l,c=e.length,d=i.length;a<d;++a)(l=e[a])?(l.__data__=i[a],n[a]=l):r[a]=new Vu(t,i[a]);for(;a<c;++a)(l=e[a])&&(s[a]=l)}function $R(t,e,r,n,s,i,a){var l,c,d=new Map,u=e.length,m=i.length,g=new Array(u),y;for(l=0;l<u;++l)(c=e[l])&&(g[l]=y=a.call(c,c.__data__,l,e)+"",d.has(y)?s[l]=c:d.set(y,c));for(l=0;l<m;++l)y=a.call(t,i[l],l,i)+"",(c=d.get(y))?(n[l]=c,c.__data__=i[l],d.delete(y)):r[l]=new Vu(t,i[l]);for(l=0;l<u;++l)(c=e[l])&&d.get(g[l])===c&&(s[l]=c)}function zR(t){return t.__data__}function LR(t,e){if(!arguments.length)return Array.from(this,zR);var r=e?$R:VR,n=this._parents,s=this._groups;typeof t!="function"&&(t=FR(t));for(var i=s.length,a=new Array(i),l=new Array(i),c=new Array(i),d=0;d<i;++d){var u=n[d],m=s[d],g=m.length,y=BR(t.call(u,u&&u.__data__,d,n)),v=y.length,I=l[d]=new Array(v),S=a[d]=new Array(v),b=c[d]=new Array(g);r(u,m,I,S,b,y,e);for(var k=0,A=0,C,T;k<v;++k)if(C=I[k]){for(k>=A&&(A=k+1);!(T=S[A])&&++A<v;);C._next=T||null}}return a=new zs(a,n),a._enter=l,a._exit=c,a}function BR(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function UR(){return new zs(this._exit||this._groups.map(K4),this._parents)}function GR(t,e,r){var n=this.enter(),s=this,i=this.exit();return typeof t=="function"?(n=t(n),n&&(n=n.selection())):n=n.append(t+""),e!=null&&(s=e(s),s&&(s=s.selection())),r==null?i.remove():r(i),n&&s?n.merge(s).order():s}function HR(t){for(var e=t.selection?t.selection():t,r=this._groups,n=e._groups,s=r.length,i=n.length,a=Math.min(s,i),l=new Array(s),c=0;c<a;++c)for(var d=r[c],u=n[c],m=d.length,g=l[c]=new Array(m),y,v=0;v<m;++v)(y=d[v]||u[v])&&(g[v]=y);for(;c<s;++c)l[c]=r[c];return new zs(l,this._parents)}function WR(){for(var t=this._groups,e=-1,r=t.length;++e<r;)for(var n=t[e],s=n.length-1,i=n[s],a;--s>=0;)(a=n[s])&&(i&&a.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(a,i),i=a);return this}function qR(t){t||(t=JR);function e(m,g){return m&&g?t(m.__data__,g.__data__):!m-!g}for(var r=this._groups,n=r.length,s=new Array(n),i=0;i<n;++i){for(var a=r[i],l=a.length,c=s[i]=new Array(l),d,u=0;u<l;++u)(d=a[u])&&(c[u]=d);c.sort(e)}return new zs(s,this._parents).order()}function JR(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function YR(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function KR(){return Array.from(this)}function ZR(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var n=t[e],s=0,i=n.length;s<i;++s){var a=n[s];if(a)return a}return null}function XR(){let t=0;for(const e of this)++t;return t}function QR(){return!this.node()}function eO(t){for(var e=this._groups,r=0,n=e.length;r<n;++r)for(var s=e[r],i=0,a=s.length,l;i<a;++i)(l=s[i])&&t.call(l,l.__data__,i,s);return this}function tO(t){return function(){this.removeAttribute(t)}}function rO(t){return function(){this.removeAttributeNS(t.space,t.local)}}function nO(t,e){return function(){this.setAttribute(t,e)}}function sO(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function oO(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttribute(t):this.setAttribute(t,r)}}function iO(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,r)}}function aO(t,e){var r=vh(t);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((e==null?r.local?rO:tO:typeof e=="function"?r.local?iO:oO:r.local?sO:nO)(r,e))}function Z4(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function lO(t){return function(){this.style.removeProperty(t)}}function cO(t,e,r){return function(){this.style.setProperty(t,e,r)}}function dO(t,e,r){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(t):this.style.setProperty(t,n,r)}}function uO(t,e,r){return arguments.length>1?this.each((e==null?lO:typeof e=="function"?dO:cO)(t,e,r??"")):Tl(this.node(),t)}function Tl(t,e){return t.style.getPropertyValue(e)||Z4(t).getComputedStyle(t,null).getPropertyValue(e)}function hO(t){return function(){delete this[t]}}function mO(t,e){return function(){this[t]=e}}function pO(t,e){return function(){var r=e.apply(this,arguments);r==null?delete this[t]:this[t]=r}}function fO(t,e){return arguments.length>1?this.each((e==null?hO:typeof e=="function"?pO:mO)(t,e)):this.node()[t]}function X4(t){return t.trim().split(/^|\s+/)}function B0(t){return t.classList||new Q4(t)}function Q4(t){this._node=t,this._names=X4(t.getAttribute("class")||"")}Q4.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function e5(t,e){for(var r=B0(t),n=-1,s=e.length;++n<s;)r.add(e[n])}function t5(t,e){for(var r=B0(t),n=-1,s=e.length;++n<s;)r.remove(e[n])}function gO(t){return function(){e5(this,t)}}function yO(t){return function(){t5(this,t)}}function xO(t,e){return function(){(e.apply(this,arguments)?e5:t5)(this,t)}}function vO(t,e){var r=X4(t+"");if(arguments.length<2){for(var n=B0(this.node()),s=-1,i=r.length;++s<i;)if(!n.contains(r[s]))return!1;return!0}return this.each((typeof e=="function"?xO:e?gO:yO)(r,e))}function bO(){this.textContent=""}function SO(t){return function(){this.textContent=t}}function wO(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function CO(t){return arguments.length?this.each(t==null?bO:(typeof t=="function"?wO:SO)(t)):this.node().textContent}function kO(){this.innerHTML=""}function IO(t){return function(){this.innerHTML=t}}function jO(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function TO(t){return arguments.length?this.each(t==null?kO:(typeof t=="function"?jO:IO)(t)):this.node().innerHTML}function EO(){this.nextSibling&&this.parentNode.appendChild(this)}function MO(){return this.each(EO)}function AO(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function PO(){return this.each(AO)}function NO(t){var e=typeof t=="function"?t:W4(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function DO(){return null}function RO(t,e){var r=typeof t=="function"?t:W4(t),n=e==null?DO:typeof e=="function"?e:L0(e);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}function OO(){var t=this.parentNode;t&&t.removeChild(this)}function _O(){return this.each(OO)}function FO(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function VO(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function $O(t){return this.select(t?VO:FO)}function zO(t){return arguments.length?this.property("__data__",t):this.node().__data__}function LO(t){return function(e){t.call(this,e,this.__data__)}}function BO(t){return t.trim().split(/^|\s+/).map(function(e){var r="",n=e.indexOf(".");return n>=0&&(r=e.slice(n+1),e=e.slice(0,n)),{type:e,name:r}})}function UO(t){return function(){var e=this.__on;if(e){for(var r=0,n=-1,s=e.length,i;r<s;++r)i=e[r],(!t.type||i.type===t.type)&&i.name===t.name?this.removeEventListener(i.type,i.listener,i.options):e[++n]=i;++n?e.length=n:delete this.__on}}}function GO(t,e,r){return function(){var n=this.__on,s,i=LO(e);if(n){for(var a=0,l=n.length;a<l;++a)if((s=n[a]).type===t.type&&s.name===t.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=i,s.options=r),s.value=e;return}}this.addEventListener(t.type,i,r),s={type:t.type,name:t.name,value:e,listener:i,options:r},n?n.push(s):this.__on=[s]}}function HO(t,e,r){var n=BO(t+""),s,i=n.length,a;if(arguments.length<2){var l=this.node().__on;if(l){for(var c=0,d=l.length,u;c<d;++c)for(s=0,u=l[c];s<i;++s)if((a=n[s]).type===u.type&&a.name===u.name)return u.value}return}for(l=e?GO:UO,s=0;s<i;++s)this.each(l(n[s],e,r));return this}function r5(t,e,r){var n=Z4(t),s=n.CustomEvent;typeof s=="function"?s=new s(e,r):(s=n.document.createEvent("Event"),r?(s.initEvent(e,r.bubbles,r.cancelable),s.detail=r.detail):s.initEvent(e,!1,!1)),t.dispatchEvent(s)}function WO(t,e){return function(){return r5(this,t,e)}}function qO(t,e){return function(){return r5(this,t,e.apply(this,arguments))}}function JO(t,e){return this.each((typeof e=="function"?qO:WO)(t,e))}function*YO(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var n=t[e],s=0,i=n.length,a;s<i;++s)(a=n[s])&&(yield a)}var n5=[null];function zs(t,e){this._groups=t,this._parents=e}function Kc(){return new zs([[document.documentElement]],n5)}function KO(){return this}zs.prototype=Kc.prototype={constructor:zs,select:wR,selectAll:jR,selectChild:AR,selectChildren:RR,filter:OR,data:LR,enter:_R,exit:UR,join:GR,merge:HR,selection:KO,order:WR,sort:qR,call:YR,nodes:KR,node:ZR,size:XR,empty:QR,each:eO,attr:aO,style:uO,property:fO,classed:vO,text:CO,html:TO,raise:MO,lower:PO,append:NO,insert:RO,remove:_O,clone:$O,datum:zO,on:HO,dispatch:JO,[Symbol.iterator]:YO};function Jr(t){return typeof t=="string"?new zs([[document.querySelector(t)]],[document.documentElement]):new zs([[t]],n5)}function ZO(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Jo(t,e){if(t=ZO(t),e===void 0&&(e=t.currentTarget),e){var r=e.ownerSVGElement||e;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=t.clientX,n.y=t.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}}return[t.pageX,t.pageY]}const XO={passive:!1},_c={capture:!0,passive:!1};function Vm(t){t.stopImmediatePropagation()}function dl(t){t.preventDefault(),t.stopImmediatePropagation()}function s5(t){var e=t.document.documentElement,r=Jr(t).on("dragstart.drag",dl,_c);"onselectstart"in e?r.on("selectstart.drag",dl,_c):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function o5(t,e){var r=t.document.documentElement,n=Jr(t).on("dragstart.drag",null);e&&(n.on("click.drag",dl,_c),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}const Ed=t=>()=>t;function xf(t,{sourceEvent:e,subject:r,target:n,identifier:s,active:i,x:a,y:l,dx:c,dy:d,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:u}})}xf.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function QO(t){return!t.ctrlKey&&!t.button}function e_(){return this.parentNode}function t_(t,e){return e??{x:t.x,y:t.y}}function r_(){return navigator.maxTouchPoints||"ontouchstart"in this}function n_(){var t=QO,e=e_,r=t_,n=r_,s={},i=Yc("start","drag","end"),a=0,l,c,d,u,m=0;function g(C){C.on("mousedown.drag",y).filter(n).on("touchstart.drag",S).on("touchmove.drag",b,XO).on("touchend.drag touchcancel.drag",k).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(C,T){if(!(u||!t.call(this,C,T))){var P=A(this,e.call(this,C,T),C,T,"mouse");P&&(Jr(C.view).on("mousemove.drag",v,_c).on("mouseup.drag",I,_c),s5(C.view),Vm(C),d=!1,l=C.clientX,c=C.clientY,P("start",C))}}function v(C){if(dl(C),!d){var T=C.clientX-l,P=C.clientY-c;d=T*T+P*P>m}s.mouse("drag",C)}function I(C){Jr(C.view).on("mousemove.drag mouseup.drag",null),o5(C.view,d),dl(C),s.mouse("end",C)}function S(C,T){if(t.call(this,C,T)){var P=C.changedTouches,_=e.call(this,C,T),R=P.length,G,ne;for(G=0;G<R;++G)(ne=A(this,_,C,T,P[G].identifier,P[G]))&&(Vm(C),ne("start",C,P[G]))}}function b(C){var T=C.changedTouches,P=T.length,_,R;for(_=0;_<P;++_)(R=s[T[_].identifier])&&(dl(C),R("drag",C,T[_]))}function k(C){var T=C.changedTouches,P=T.length,_,R;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),_=0;_<P;++_)(R=s[T[_].identifier])&&(Vm(C),R("end",C,T[_]))}function A(C,T,P,_,R,G){var ne=i.copy(),he=Jo(G||P,T),te,K,O;if((O=r.call(C,new xf("beforestart",{sourceEvent:P,target:g,identifier:R,active:a,x:he[0],y:he[1],dx:0,dy:0,dispatch:ne}),_))!=null)return te=O.x-he[0]||0,K=O.y-he[1]||0,function Z(ie,ge,xe){var $=he,B;switch(ie){case"start":s[R]=Z,B=a++;break;case"end":delete s[R],--a;case"drag":he=Jo(xe||ge,T),B=a;break}ne.call(ie,C,new xf(ie,{sourceEvent:ge,subject:O,target:g,identifier:R,active:B,x:he[0]+te,y:he[1]+K,dx:he[0]-$[0],dy:he[1]-$[1],dispatch:ne}),_)}}return g.filter=function(C){return arguments.length?(t=typeof C=="function"?C:Ed(!!C),g):t},g.container=function(C){return arguments.length?(e=typeof C=="function"?C:Ed(C),g):e},g.subject=function(C){return arguments.length?(r=typeof C=="function"?C:Ed(C),g):r},g.touchable=function(C){return arguments.length?(n=typeof C=="function"?C:Ed(!!C),g):n},g.on=function(){var C=i.on.apply(i,arguments);return C===i?g:C},g.clickDistance=function(C){return arguments.length?(m=(C=+C)*C,g):Math.sqrt(m)},g}function U0(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function i5(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}function Zc(){}var Fc=.7,$u=1/Fc,ul="\\s*([+-]?\\d+)\\s*",Vc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Po="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",s_=/^#([0-9a-f]{3,8})$/,o_=new RegExp(`^rgb\\(${ul},${ul},${ul}\\)$`),i_=new RegExp(`^rgb\\(${Po},${Po},${Po}\\)$`),a_=new RegExp(`^rgba\\(${ul},${ul},${ul},${Vc}\\)$`),l_=new RegExp(`^rgba\\(${Po},${Po},${Po},${Vc}\\)$`),c_=new RegExp(`^hsl\\(${Vc},${Po},${Po}\\)$`),d_=new RegExp(`^hsla\\(${Vc},${Po},${Po},${Vc}\\)$`),Z1={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};U0(Zc,La,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:X1,formatHex:X1,formatHex8:u_,formatHsl:h_,formatRgb:Q1,toString:Q1});function X1(){return this.rgb().formatHex()}function u_(){return this.rgb().formatHex8()}function h_(){return a5(this).formatHsl()}function Q1(){return this.rgb().formatRgb()}function La(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=s_.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?ev(e):r===3?new js(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?Md(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?Md(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=o_.exec(t))?new js(e[1],e[2],e[3],1):(e=i_.exec(t))?new js(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=a_.exec(t))?Md(e[1],e[2],e[3],e[4]):(e=l_.exec(t))?Md(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=c_.exec(t))?nv(e[1],e[2]/100,e[3]/100,1):(e=d_.exec(t))?nv(e[1],e[2]/100,e[3]/100,e[4]):Z1.hasOwnProperty(t)?ev(Z1[t]):t==="transparent"?new js(NaN,NaN,NaN,0):null}function ev(t){return new js(t>>16&255,t>>8&255,t&255,1)}function Md(t,e,r,n){return n<=0&&(t=e=r=NaN),new js(t,e,r,n)}function m_(t){return t instanceof Zc||(t=La(t)),t?(t=t.rgb(),new js(t.r,t.g,t.b,t.opacity)):new js}function vf(t,e,r,n){return arguments.length===1?m_(t):new js(t,e,r,n??1)}function js(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}U0(js,vf,i5(Zc,{brighter(t){return t=t==null?$u:Math.pow($u,t),new js(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Fc:Math.pow(Fc,t),new js(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new js(Da(this.r),Da(this.g),Da(this.b),zu(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:tv,formatHex:tv,formatHex8:p_,formatRgb:rv,toString:rv}));function tv(){return`#${ja(this.r)}${ja(this.g)}${ja(this.b)}`}function p_(){return`#${ja(this.r)}${ja(this.g)}${ja(this.b)}${ja((isNaN(this.opacity)?1:this.opacity)*255)}`}function rv(){const t=zu(this.opacity);return`${t===1?"rgb(":"rgba("}${Da(this.r)}, ${Da(this.g)}, ${Da(this.b)}${t===1?")":`, ${t})`}`}function zu(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Da(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ja(t){return t=Da(t),(t<16?"0":"")+t.toString(16)}function nv(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new po(t,e,r,n)}function a5(t){if(t instanceof po)return new po(t.h,t.s,t.l,t.opacity);if(t instanceof Zc||(t=La(t)),!t)return new po;if(t instanceof po)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,s=Math.min(e,r,n),i=Math.max(e,r,n),a=NaN,l=i-s,c=(i+s)/2;return l?(e===i?a=(r-n)/l+(r<n)*6:r===i?a=(n-e)/l+2:a=(e-r)/l+4,l/=c<.5?i+s:2-i-s,a*=60):l=c>0&&c<1?0:a,new po(a,l,c,t.opacity)}function f_(t,e,r,n){return arguments.length===1?a5(t):new po(t,e,r,n??1)}function po(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}U0(po,f_,i5(Zc,{brighter(t){return t=t==null?$u:Math.pow($u,t),new po(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Fc:Math.pow(Fc,t),new po(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,s=2*r-n;return new js($m(t>=240?t-240:t+120,s,n),$m(t,s,n),$m(t<120?t+240:t-120,s,n),this.opacity)},clamp(){return new po(sv(this.h),Ad(this.s),Ad(this.l),zu(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=zu(this.opacity);return`${t===1?"hsl(":"hsla("}${sv(this.h)}, ${Ad(this.s)*100}%, ${Ad(this.l)*100}%${t===1?")":`, ${t})`}`}}));function sv(t){return t=(t||0)%360,t<0?t+360:t}function Ad(t){return Math.max(0,Math.min(1,t||0))}function $m(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}const l5=t=>()=>t;function g_(t,e){return function(r){return t+r*e}}function y_(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function x_(t){return(t=+t)==1?c5:function(e,r){return r-e?y_(e,r,t):l5(isNaN(e)?r:e)}}function c5(t,e){var r=e-t;return r?g_(t,r):l5(isNaN(t)?e:t)}const ov=function t(e){var r=x_(e);function n(s,i){var a=r((s=vf(s)).r,(i=vf(i)).r),l=r(s.g,i.g),c=r(s.b,i.b),d=c5(s.opacity,i.opacity);return function(u){return s.r=a(u),s.g=l(u),s.b=c(u),s.opacity=d(u),s+""}}return n.gamma=t,n}(1);function yi(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}var bf=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,zm=new RegExp(bf.source,"g");function v_(t){return function(){return t}}function b_(t){return function(e){return t(e)+""}}function S_(t,e){var r=bf.lastIndex=zm.lastIndex=0,n,s,i,a=-1,l=[],c=[];for(t=t+"",e=e+"";(n=bf.exec(t))&&(s=zm.exec(e));)(i=s.index)>r&&(i=e.slice(r,i),l[a]?l[a]+=i:l[++a]=i),(n=n[0])===(s=s[0])?l[a]?l[a]+=s:l[++a]=s:(l[++a]=null,c.push({i:a,x:yi(n,s)})),r=zm.lastIndex;return r<e.length&&(i=e.slice(r),l[a]?l[a]+=i:l[++a]=i),l.length<2?c[0]?b_(c[0].x):v_(e):(e=c.length,function(d){for(var u=0,m;u<e;++u)l[(m=c[u]).i]=m.x(d);return l.join("")})}var iv=180/Math.PI,Sf={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function d5(t,e,r,n,s,i){var a,l,c;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(c=t*r+e*n)&&(r-=t*c,n-=e*c),(l=Math.sqrt(r*r+n*n))&&(r/=l,n/=l,c/=l),t*n<e*r&&(t=-t,e=-e,c=-c,a=-a),{translateX:s,translateY:i,rotate:Math.atan2(e,t)*iv,skewX:Math.atan(c)*iv,scaleX:a,scaleY:l}}var Pd;function w_(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Sf:d5(e.a,e.b,e.c,e.d,e.e,e.f)}function C_(t){return t==null||(Pd||(Pd=document.createElementNS("http://www.w3.org/2000/svg","g")),Pd.setAttribute("transform",t),!(t=Pd.transform.baseVal.consolidate()))?Sf:(t=t.matrix,d5(t.a,t.b,t.c,t.d,t.e,t.f))}function u5(t,e,r,n){function s(d){return d.length?d.pop()+" ":""}function i(d,u,m,g,y,v){if(d!==m||u!==g){var I=y.push("translate(",null,e,null,r);v.push({i:I-4,x:yi(d,m)},{i:I-2,x:yi(u,g)})}else(m||g)&&y.push("translate("+m+e+g+r)}function a(d,u,m,g){d!==u?(d-u>180?u+=360:u-d>180&&(d+=360),g.push({i:m.push(s(m)+"rotate(",null,n)-2,x:yi(d,u)})):u&&m.push(s(m)+"rotate("+u+n)}function l(d,u,m,g){d!==u?g.push({i:m.push(s(m)+"skewX(",null,n)-2,x:yi(d,u)}):u&&m.push(s(m)+"skewX("+u+n)}function c(d,u,m,g,y,v){if(d!==m||u!==g){var I=y.push(s(y)+"scale(",null,",",null,")");v.push({i:I-4,x:yi(d,m)},{i:I-2,x:yi(u,g)})}else(m!==1||g!==1)&&y.push(s(y)+"scale("+m+","+g+")")}return function(d,u){var m=[],g=[];return d=t(d),u=t(u),i(d.translateX,d.translateY,u.translateX,u.translateY,m,g),a(d.rotate,u.rotate,m,g),l(d.skewX,u.skewX,m,g),c(d.scaleX,d.scaleY,u.scaleX,u.scaleY,m,g),d=u=null,function(y){for(var v=-1,I=g.length,S;++v<I;)m[(S=g[v]).i]=S.x(y);return m.join("")}}}var k_=u5(w_,"px, ","px)","deg)"),I_=u5(C_,", ",")",")"),j_=1e-12;function av(t){return((t=Math.exp(t))+1/t)/2}function T_(t){return((t=Math.exp(t))-1/t)/2}function E_(t){return((t=Math.exp(2*t))-1)/(t+1)}const M_=function t(e,r,n){function s(i,a){var l=i[0],c=i[1],d=i[2],u=a[0],m=a[1],g=a[2],y=u-l,v=m-c,I=y*y+v*v,S,b;if(I<j_)b=Math.log(g/d)/e,S=function(_){return[l+_*y,c+_*v,d*Math.exp(e*_*b)]};else{var k=Math.sqrt(I),A=(g*g-d*d+n*I)/(2*d*r*k),C=(g*g-d*d-n*I)/(2*g*r*k),T=Math.log(Math.sqrt(A*A+1)-A),P=Math.log(Math.sqrt(C*C+1)-C);b=(P-T)/e,S=function(_){var R=_*b,G=av(T),ne=d/(r*k)*(G*E_(e*R+T)-T_(T));return[l+ne*y,c+ne*v,d*G/av(e*R+T)]}}return S.duration=b*1e3*e/Math.SQRT2,S}return s.rho=function(i){var a=Math.max(.001,+i),l=a*a,c=l*l;return t(a,l,c)},s}(Math.SQRT2,2,4);var El=0,Ql=0,Yl=0,h5=1e3,Lu,ec,Bu=0,Ba=0,bh=0,$c=typeof performance=="object"&&performance.now?performance:Date,m5=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function G0(){return Ba||(m5(A_),Ba=$c.now()+bh)}function A_(){Ba=0}function Uu(){this._call=this._time=this._next=null}Uu.prototype=H0.prototype={constructor:Uu,restart:function(t,e,r){if(typeof t!="function")throw new TypeError("callback is not a function");r=(r==null?G0():+r)+(e==null?0:+e),!this._next&&ec!==this&&(ec?ec._next=this:Lu=this,ec=this),this._call=t,this._time=r,wf()},stop:function(){this._call&&(this._call=null,this._time=1/0,wf())}};function H0(t,e,r){var n=new Uu;return n.restart(t,e,r),n}function P_(){G0(),++El;for(var t=Lu,e;t;)(e=Ba-t._time)>=0&&t._call.call(void 0,e),t=t._next;--El}function lv(){Ba=(Bu=$c.now())+bh,El=Ql=0;try{P_()}finally{El=0,D_(),Ba=0}}function N_(){var t=$c.now(),e=t-Bu;e>h5&&(bh-=e,Bu=t)}function D_(){for(var t,e=Lu,r,n=1/0;e;)e._call?(n>e._time&&(n=e._time),t=e,e=e._next):(r=e._next,e._next=null,e=t?t._next=r:Lu=r);ec=t,wf(n)}function wf(t){if(!El){Ql&&(Ql=clearTimeout(Ql));var e=t-Ba;e>24?(t<1/0&&(Ql=setTimeout(lv,t-$c.now()-bh)),Yl&&(Yl=clearInterval(Yl))):(Yl||(Bu=$c.now(),Yl=setInterval(N_,h5)),El=1,m5(lv))}}function cv(t,e,r){var n=new Uu;return e=e==null?0:+e,n.restart(s=>{n.stop(),t(s+e)},e,r),n}var R_=Yc("start","end","cancel","interrupt"),O_=[],p5=0,dv=1,Cf=2,Hd=3,uv=4,kf=5,Wd=6;function Sh(t,e,r,n,s,i){var a=t.__transition;if(!a)t.__transition={};else if(r in a)return;__(t,r,{name:e,index:n,group:s,on:R_,tween:O_,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:p5})}function W0(t,e){var r=yo(t,e);if(r.state>p5)throw new Error("too late; already scheduled");return r}function zo(t,e){var r=yo(t,e);if(r.state>Hd)throw new Error("too late; already running");return r}function yo(t,e){var r=t.__transition;if(!r||!(r=r[e]))throw new Error("transition not found");return r}function __(t,e,r){var n=t.__transition,s;n[e]=r,r.timer=H0(i,0,r.time);function i(d){r.state=dv,r.timer.restart(a,r.delay,r.time),r.delay<=d&&a(d-r.delay)}function a(d){var u,m,g,y;if(r.state!==dv)return c();for(u in n)if(y=n[u],y.name===r.name){if(y.state===Hd)return cv(a);y.state===uv?(y.state=Wd,y.timer.stop(),y.on.call("interrupt",t,t.__data__,y.index,y.group),delete n[u]):+u<e&&(y.state=Wd,y.timer.stop(),y.on.call("cancel",t,t.__data__,y.index,y.group),delete n[u])}if(cv(function(){r.state===Hd&&(r.state=uv,r.timer.restart(l,r.delay,r.time),l(d))}),r.state=Cf,r.on.call("start",t,t.__data__,r.index,r.group),r.state===Cf){for(r.state=Hd,s=new Array(g=r.tween.length),u=0,m=-1;u<g;++u)(y=r.tween[u].value.call(t,t.__data__,r.index,r.group))&&(s[++m]=y);s.length=m+1}}function l(d){for(var u=d<r.duration?r.ease.call(null,d/r.duration):(r.timer.restart(c),r.state=kf,1),m=-1,g=s.length;++m<g;)s[m].call(t,u);r.state===kf&&(r.on.call("end",t,t.__data__,r.index,r.group),c())}function c(){r.state=Wd,r.timer.stop(),delete n[e];for(var d in n)return;delete t.__transition}}function qd(t,e){var r=t.__transition,n,s,i=!0,a;if(r){e=e==null?null:e+"";for(a in r){if((n=r[a]).name!==e){i=!1;continue}s=n.state>Cf&&n.state<kf,n.state=Wd,n.timer.stop(),n.on.call(s?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete r[a]}i&&delete t.__transition}}function F_(t){return this.each(function(){qd(this,t)})}function V_(t,e){var r,n;return function(){var s=zo(this,t),i=s.tween;if(i!==r){n=r=i;for(var a=0,l=n.length;a<l;++a)if(n[a].name===e){n=n.slice(),n.splice(a,1);break}}s.tween=n}}function $_(t,e,r){var n,s;if(typeof r!="function")throw new Error;return function(){var i=zo(this,t),a=i.tween;if(a!==n){s=(n=a).slice();for(var l={name:e,value:r},c=0,d=s.length;c<d;++c)if(s[c].name===e){s[c]=l;break}c===d&&s.push(l)}i.tween=s}}function z_(t,e){var r=this._id;if(t+="",arguments.length<2){for(var n=yo(this.node(),r).tween,s=0,i=n.length,a;s<i;++s)if((a=n[s]).name===t)return a.value;return null}return this.each((e==null?V_:$_)(r,t,e))}function q0(t,e,r){var n=t._id;return t.each(function(){var s=zo(this,n);(s.value||(s.value={}))[e]=r.apply(this,arguments)}),function(s){return yo(s,n).value[e]}}function f5(t,e){var r;return(typeof e=="number"?yi:e instanceof La?ov:(r=La(e))?(e=r,ov):S_)(t,e)}function L_(t){return function(){this.removeAttribute(t)}}function B_(t){return function(){this.removeAttributeNS(t.space,t.local)}}function U_(t,e,r){var n,s=r+"",i;return function(){var a=this.getAttribute(t);return a===s?null:a===n?i:i=e(n=a,r)}}function G_(t,e,r){var n,s=r+"",i;return function(){var a=this.getAttributeNS(t.space,t.local);return a===s?null:a===n?i:i=e(n=a,r)}}function H_(t,e,r){var n,s,i;return function(){var a,l=r(this),c;return l==null?void this.removeAttribute(t):(a=this.getAttribute(t),c=l+"",a===c?null:a===n&&c===s?i:(s=c,i=e(n=a,l)))}}function W_(t,e,r){var n,s,i;return function(){var a,l=r(this),c;return l==null?void this.removeAttributeNS(t.space,t.local):(a=this.getAttributeNS(t.space,t.local),c=l+"",a===c?null:a===n&&c===s?i:(s=c,i=e(n=a,l)))}}function q_(t,e){var r=vh(t),n=r==="transform"?I_:f5;return this.attrTween(t,typeof e=="function"?(r.local?W_:H_)(r,n,q0(this,"attr."+t,e)):e==null?(r.local?B_:L_)(r):(r.local?G_:U_)(r,n,e))}function J_(t,e){return function(r){this.setAttribute(t,e.call(this,r))}}function Y_(t,e){return function(r){this.setAttributeNS(t.space,t.local,e.call(this,r))}}function K_(t,e){var r,n;function s(){var i=e.apply(this,arguments);return i!==n&&(r=(n=i)&&Y_(t,i)),r}return s._value=e,s}function Z_(t,e){var r,n;function s(){var i=e.apply(this,arguments);return i!==n&&(r=(n=i)&&J_(t,i)),r}return s._value=e,s}function X_(t,e){var r="attr."+t;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;var n=vh(t);return this.tween(r,(n.local?K_:Z_)(n,e))}function Q_(t,e){return function(){W0(this,t).delay=+e.apply(this,arguments)}}function eF(t,e){return e=+e,function(){W0(this,t).delay=e}}function tF(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Q_:eF)(e,t)):yo(this.node(),e).delay}function rF(t,e){return function(){zo(this,t).duration=+e.apply(this,arguments)}}function nF(t,e){return e=+e,function(){zo(this,t).duration=e}}function sF(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?rF:nF)(e,t)):yo(this.node(),e).duration}function oF(t,e){if(typeof e!="function")throw new Error;return function(){zo(this,t).ease=e}}function iF(t){var e=this._id;return arguments.length?this.each(oF(e,t)):yo(this.node(),e).ease}function aF(t,e){return function(){var r=e.apply(this,arguments);if(typeof r!="function")throw new Error;zo(this,t).ease=r}}function lF(t){if(typeof t!="function")throw new Error;return this.each(aF(this._id,t))}function cF(t){typeof t!="function"&&(t=J4(t));for(var e=this._groups,r=e.length,n=new Array(r),s=0;s<r;++s)for(var i=e[s],a=i.length,l=n[s]=[],c,d=0;d<a;++d)(c=i[d])&&t.call(c,c.__data__,d,i)&&l.push(c);return new ai(n,this._parents,this._name,this._id)}function dF(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,r=t._groups,n=e.length,s=r.length,i=Math.min(n,s),a=new Array(n),l=0;l<i;++l)for(var c=e[l],d=r[l],u=c.length,m=a[l]=new Array(u),g,y=0;y<u;++y)(g=c[y]||d[y])&&(m[y]=g);for(;l<n;++l)a[l]=e[l];return new ai(a,this._parents,this._name,this._id)}function uF(t){return(t+"").trim().split(/^|\s+/).every(function(e){var r=e.indexOf(".");return r>=0&&(e=e.slice(0,r)),!e||e==="start"})}function hF(t,e,r){var n,s,i=uF(e)?W0:zo;return function(){var a=i(this,t),l=a.on;l!==n&&(s=(n=l).copy()).on(e,r),a.on=s}}function mF(t,e){var r=this._id;return arguments.length<2?yo(this.node(),r).on.on(t):this.each(hF(r,t,e))}function pF(t){return function(){var e=this.parentNode;for(var r in this.__transition)if(+r!==t)return;e&&e.removeChild(this)}}function fF(){return this.on("end.remove",pF(this._id))}function gF(t){var e=this._name,r=this._id;typeof t!="function"&&(t=L0(t));for(var n=this._groups,s=n.length,i=new Array(s),a=0;a<s;++a)for(var l=n[a],c=l.length,d=i[a]=new Array(c),u,m,g=0;g<c;++g)(u=l[g])&&(m=t.call(u,u.__data__,g,l))&&("__data__"in u&&(m.__data__=u.__data__),d[g]=m,Sh(d[g],e,r,g,d,yo(u,r)));return new ai(i,this._parents,e,r)}function yF(t){var e=this._name,r=this._id;typeof t!="function"&&(t=q4(t));for(var n=this._groups,s=n.length,i=[],a=[],l=0;l<s;++l)for(var c=n[l],d=c.length,u,m=0;m<d;++m)if(u=c[m]){for(var g=t.call(u,u.__data__,m,c),y,v=yo(u,r),I=0,S=g.length;I<S;++I)(y=g[I])&&Sh(y,e,r,I,g,v);i.push(g),a.push(u)}return new ai(i,a,e,r)}var xF=Kc.prototype.constructor;function vF(){return new xF(this._groups,this._parents)}function bF(t,e){var r,n,s;return function(){var i=Tl(this,t),a=(this.style.removeProperty(t),Tl(this,t));return i===a?null:i===r&&a===n?s:s=e(r=i,n=a)}}function g5(t){return function(){this.style.removeProperty(t)}}function SF(t,e,r){var n,s=r+"",i;return function(){var a=Tl(this,t);return a===s?null:a===n?i:i=e(n=a,r)}}function wF(t,e,r){var n,s,i;return function(){var a=Tl(this,t),l=r(this),c=l+"";return l==null&&(c=l=(this.style.removeProperty(t),Tl(this,t))),a===c?null:a===n&&c===s?i:(s=c,i=e(n=a,l))}}function CF(t,e){var r,n,s,i="style."+e,a="end."+i,l;return function(){var c=zo(this,t),d=c.on,u=c.value[i]==null?l||(l=g5(e)):void 0;(d!==r||s!==u)&&(n=(r=d).copy()).on(a,s=u),c.on=n}}function kF(t,e,r){var n=(t+="")=="transform"?k_:f5;return e==null?this.styleTween(t,bF(t,n)).on("end.style."+t,g5(t)):typeof e=="function"?this.styleTween(t,wF(t,n,q0(this,"style."+t,e))).each(CF(this._id,t)):this.styleTween(t,SF(t,n,e),r).on("end.style."+t,null)}function IF(t,e,r){return function(n){this.style.setProperty(t,e.call(this,n),r)}}function jF(t,e,r){var n,s;function i(){var a=e.apply(this,arguments);return a!==s&&(n=(s=a)&&IF(t,a,r)),n}return i._value=e,i}function TF(t,e,r){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,jF(t,e,r??""))}function EF(t){return function(){this.textContent=t}}function MF(t){return function(){var e=t(this);this.textContent=e??""}}function AF(t){return this.tween("text",typeof t=="function"?MF(q0(this,"text",t)):EF(t==null?"":t+""))}function PF(t){return function(e){this.textContent=t.call(this,e)}}function NF(t){var e,r;function n(){var s=t.apply(this,arguments);return s!==r&&(e=(r=s)&&PF(s)),e}return n._value=t,n}function DF(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,NF(t))}function RF(){for(var t=this._name,e=this._id,r=y5(),n=this._groups,s=n.length,i=0;i<s;++i)for(var a=n[i],l=a.length,c,d=0;d<l;++d)if(c=a[d]){var u=yo(c,e);Sh(c,t,r,d,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new ai(n,this._parents,t,r)}function OF(){var t,e,r=this,n=r._id,s=r.size();return new Promise(function(i,a){var l={value:a},c={value:function(){--s===0&&i()}};r.each(function(){var d=zo(this,n),u=d.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(c)),d.on=e}),s===0&&i()})}var _F=0;function ai(t,e,r,n){this._groups=t,this._parents=e,this._name=r,this._id=n}function y5(){return++_F}var Wo=Kc.prototype;ai.prototype={constructor:ai,select:gF,selectAll:yF,selectChild:Wo.selectChild,selectChildren:Wo.selectChildren,filter:cF,merge:dF,selection:vF,transition:RF,call:Wo.call,nodes:Wo.nodes,node:Wo.node,size:Wo.size,empty:Wo.empty,each:Wo.each,on:mF,attr:q_,attrTween:X_,style:kF,styleTween:TF,text:AF,textTween:DF,remove:fF,tween:z_,delay:tF,duration:sF,ease:iF,easeVarying:lF,end:OF,[Symbol.iterator]:Wo[Symbol.iterator]};function FF(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var VF={time:null,delay:0,duration:250,ease:FF};function $F(t,e){for(var r;!(r=t.__transition)||!(r=r[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return r}function zF(t){var e,r;t instanceof ai?(e=t._id,t=t._name):(e=y5(),(r=VF).time=G0(),t=t==null?null:t+"");for(var n=this._groups,s=n.length,i=0;i<s;++i)for(var a=n[i],l=a.length,c,d=0;d<l;++d)(c=a[d])&&Sh(c,t,e,d,a,r||$F(c,e));return new ai(n,this._parents,t,e)}Kc.prototype.interrupt=F_;Kc.prototype.transition=zF;function LF(t,e){var r,n=1;t==null&&(t=0),e==null&&(e=0);function s(){var i,a=r.length,l,c=0,d=0;for(i=0;i<a;++i)l=r[i],c+=l.x,d+=l.y;for(c=(c/a-t)*n,d=(d/a-e)*n,i=0;i<a;++i)l=r[i],l.x-=c,l.y-=d}return s.initialize=function(i){r=i},s.x=function(i){return arguments.length?(t=+i,s):t},s.y=function(i){return arguments.length?(e=+i,s):e},s.strength=function(i){return arguments.length?(n=+i,s):n},s}function BF(t){const e=+this._x.call(null,t),r=+this._y.call(null,t);return x5(this.cover(e,r),e,r,t)}function x5(t,e,r,n){if(isNaN(e)||isNaN(r))return t;var s,i=t._root,a={data:n},l=t._x0,c=t._y0,d=t._x1,u=t._y1,m,g,y,v,I,S,b,k;if(!i)return t._root=a,t;for(;i.length;)if((I=e>=(m=(l+d)/2))?l=m:d=m,(S=r>=(g=(c+u)/2))?c=g:u=g,s=i,!(i=i[b=S<<1|I]))return s[b]=a,t;if(y=+t._x.call(null,i.data),v=+t._y.call(null,i.data),e===y&&r===v)return a.next=i,s?s[b]=a:t._root=a,t;do s=s?s[b]=new Array(4):t._root=new Array(4),(I=e>=(m=(l+d)/2))?l=m:d=m,(S=r>=(g=(c+u)/2))?c=g:u=g;while((b=S<<1|I)===(k=(v>=g)<<1|y>=m));return s[k]=i,s[b]=a,t}function UF(t){var e,r,n=t.length,s,i,a=new Array(n),l=new Array(n),c=1/0,d=1/0,u=-1/0,m=-1/0;for(r=0;r<n;++r)isNaN(s=+this._x.call(null,e=t[r]))||isNaN(i=+this._y.call(null,e))||(a[r]=s,l[r]=i,s<c&&(c=s),s>u&&(u=s),i<d&&(d=i),i>m&&(m=i));if(c>u||d>m)return this;for(this.cover(c,d).cover(u,m),r=0;r<n;++r)x5(this,a[r],l[r],t[r]);return this}function GF(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var r=this._x0,n=this._y0,s=this._x1,i=this._y1;if(isNaN(r))s=(r=Math.floor(t))+1,i=(n=Math.floor(e))+1;else{for(var a=s-r||1,l=this._root,c,d;r>t||t>=s||n>e||e>=i;)switch(d=(e<n)<<1|t<r,c=new Array(4),c[d]=l,l=c,a*=2,d){case 0:s=r+a,i=n+a;break;case 1:r=s-a,i=n+a;break;case 2:s=r+a,n=i-a;break;case 3:r=s-a,n=i-a;break}this._root&&this._root.length&&(this._root=l)}return this._x0=r,this._y0=n,this._x1=s,this._y1=i,this}function HF(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function WF(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function ms(t,e,r,n,s){this.node=t,this.x0=e,this.y0=r,this.x1=n,this.y1=s}function qF(t,e,r){var n,s=this._x0,i=this._y0,a,l,c,d,u=this._x1,m=this._y1,g=[],y=this._root,v,I;for(y&&g.push(new ms(y,s,i,u,m)),r==null?r=1/0:(s=t-r,i=e-r,u=t+r,m=e+r,r*=r);v=g.pop();)if(!(!(y=v.node)||(a=v.x0)>u||(l=v.y0)>m||(c=v.x1)<s||(d=v.y1)<i))if(y.length){var S=(a+c)/2,b=(l+d)/2;g.push(new ms(y[3],S,b,c,d),new ms(y[2],a,b,S,d),new ms(y[1],S,l,c,b),new ms(y[0],a,l,S,b)),(I=(e>=b)<<1|t>=S)&&(v=g[g.length-1],g[g.length-1]=g[g.length-1-I],g[g.length-1-I]=v)}else{var k=t-+this._x.call(null,y.data),A=e-+this._y.call(null,y.data),C=k*k+A*A;if(C<r){var T=Math.sqrt(r=C);s=t-T,i=e-T,u=t+T,m=e+T,n=y.data}}return n}function JF(t){if(isNaN(u=+this._x.call(null,t))||isNaN(m=+this._y.call(null,t)))return this;var e,r=this._root,n,s,i,a=this._x0,l=this._y0,c=this._x1,d=this._y1,u,m,g,y,v,I,S,b;if(!r)return this;if(r.length)for(;;){if((v=u>=(g=(a+c)/2))?a=g:c=g,(I=m>=(y=(l+d)/2))?l=y:d=y,e=r,!(r=r[S=I<<1|v]))return this;if(!r.length)break;(e[S+1&3]||e[S+2&3]||e[S+3&3])&&(n=e,b=S)}for(;r.data!==t;)if(s=r,!(r=r.next))return this;return(i=r.next)&&delete r.next,s?(i?s.next=i:delete s.next,this):e?(i?e[S]=i:delete e[S],(r=e[0]||e[1]||e[2]||e[3])&&r===(e[3]||e[2]||e[1]||e[0])&&!r.length&&(n?n[b]=r:this._root=r),this):(this._root=i,this)}function YF(t){for(var e=0,r=t.length;e<r;++e)this.remove(t[e]);return this}function KF(){return this._root}function ZF(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function XF(t){var e=[],r,n=this._root,s,i,a,l,c;for(n&&e.push(new ms(n,this._x0,this._y0,this._x1,this._y1));r=e.pop();)if(!t(n=r.node,i=r.x0,a=r.y0,l=r.x1,c=r.y1)&&n.length){var d=(i+l)/2,u=(a+c)/2;(s=n[3])&&e.push(new ms(s,d,u,l,c)),(s=n[2])&&e.push(new ms(s,i,u,d,c)),(s=n[1])&&e.push(new ms(s,d,a,l,u)),(s=n[0])&&e.push(new ms(s,i,a,d,u))}return this}function QF(t){var e=[],r=[],n;for(this._root&&e.push(new ms(this._root,this._x0,this._y0,this._x1,this._y1));n=e.pop();){var s=n.node;if(s.length){var i,a=n.x0,l=n.y0,c=n.x1,d=n.y1,u=(a+c)/2,m=(l+d)/2;(i=s[0])&&e.push(new ms(i,a,l,u,m)),(i=s[1])&&e.push(new ms(i,u,l,c,m)),(i=s[2])&&e.push(new ms(i,a,m,u,d)),(i=s[3])&&e.push(new ms(i,u,m,c,d))}r.push(n)}for(;n=r.pop();)t(n.node,n.x0,n.y0,n.x1,n.y1);return this}function eV(t){return t[0]}function tV(t){return arguments.length?(this._x=t,this):this._x}function rV(t){return t[1]}function nV(t){return arguments.length?(this._y=t,this):this._y}function J0(t,e,r){var n=new Y0(e??eV,r??rV,NaN,NaN,NaN,NaN);return t==null?n:n.addAll(t)}function Y0(t,e,r,n,s,i){this._x=t,this._y=e,this._x0=r,this._y0=n,this._x1=s,this._y1=i,this._root=void 0}function hv(t){for(var e={data:t.data},r=e;t=t.next;)r=r.next={data:t.data};return e}var bs=J0.prototype=Y0.prototype;bs.copy=function(){var t=new Y0(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,r,n;if(!e)return t;if(!e.length)return t._root=hv(e),t;for(r=[{source:e,target:t._root=new Array(4)}];e=r.pop();)for(var s=0;s<4;++s)(n=e.source[s])&&(n.length?r.push({source:n,target:e.target[s]=new Array(4)}):e.target[s]=hv(n));return t};bs.add=BF;bs.addAll=UF;bs.cover=GF;bs.data=HF;bs.extent=WF;bs.find=qF;bs.remove=JF;bs.removeAll=YF;bs.root=KF;bs.size=ZF;bs.visit=XF;bs.visitAfter=QF;bs.x=tV;bs.y=nV;function fs(t){return function(){return t}}function Ci(t){return(t()-.5)*1e-6}function sV(t){return t.x+t.vx}function oV(t){return t.y+t.vy}function iV(t){var e,r,n,s=1,i=1;typeof t!="function"&&(t=fs(t==null?1:+t));function a(){for(var d,u=e.length,m,g,y,v,I,S,b=0;b<i;++b)for(m=J0(e,sV,oV).visitAfter(l),d=0;d<u;++d)g=e[d],I=r[g.index],S=I*I,y=g.x+g.vx,v=g.y+g.vy,m.visit(k);function k(A,C,T,P,_){var R=A.data,G=A.r,ne=I+G;if(R){if(R.index>g.index){var he=y-R.x-R.vx,te=v-R.y-R.vy,K=he*he+te*te;K<ne*ne&&(he===0&&(he=Ci(n),K+=he*he),te===0&&(te=Ci(n),K+=te*te),K=(ne-(K=Math.sqrt(K)))/K*s,g.vx+=(he*=K)*(ne=(G*=G)/(S+G)),g.vy+=(te*=K)*ne,R.vx-=he*(ne=1-ne),R.vy-=te*ne)}return}return C>y+ne||P<y-ne||T>v+ne||_<v-ne}}function l(d){if(d.data)return d.r=r[d.data.index];for(var u=d.r=0;u<4;++u)d[u]&&d[u].r>d.r&&(d.r=d[u].r)}function c(){if(e){var d,u=e.length,m;for(r=new Array(u),d=0;d<u;++d)m=e[d],r[m.index]=+t(m,d,e)}}return a.initialize=function(d,u){e=d,n=u,c()},a.iterations=function(d){return arguments.length?(i=+d,a):i},a.strength=function(d){return arguments.length?(s=+d,a):s},a.radius=function(d){return arguments.length?(t=typeof d=="function"?d:fs(+d),c(),a):t},a}function aV(t){return t.index}function mv(t,e){var r=t.get(e);if(!r)throw new Error("node not found: "+e);return r}function lV(t){var e=aV,r=m,n,s=fs(30),i,a,l,c,d,u=1;t==null&&(t=[]);function m(S){return 1/Math.min(l[S.source.index],l[S.target.index])}function g(S){for(var b=0,k=t.length;b<u;++b)for(var A=0,C,T,P,_,R,G,ne;A<k;++A)C=t[A],T=C.source,P=C.target,_=P.x+P.vx-T.x-T.vx||Ci(d),R=P.y+P.vy-T.y-T.vy||Ci(d),G=Math.sqrt(_*_+R*R),G=(G-i[A])/G*S*n[A],_*=G,R*=G,P.vx-=_*(ne=c[A]),P.vy-=R*ne,T.vx+=_*(ne=1-ne),T.vy+=R*ne}function y(){if(a){var S,b=a.length,k=t.length,A=new Map(a.map((T,P)=>[e(T,P,a),T])),C;for(S=0,l=new Array(b);S<k;++S)C=t[S],C.index=S,typeof C.source!="object"&&(C.source=mv(A,C.source)),typeof C.target!="object"&&(C.target=mv(A,C.target)),l[C.source.index]=(l[C.source.index]||0)+1,l[C.target.index]=(l[C.target.index]||0)+1;for(S=0,c=new Array(k);S<k;++S)C=t[S],c[S]=l[C.source.index]/(l[C.source.index]+l[C.target.index]);n=new Array(k),v(),i=new Array(k),I()}}function v(){if(a)for(var S=0,b=t.length;S<b;++S)n[S]=+r(t[S],S,t)}function I(){if(a)for(var S=0,b=t.length;S<b;++S)i[S]=+s(t[S],S,t)}return g.initialize=function(S,b){a=S,d=b,y()},g.links=function(S){return arguments.length?(t=S,y(),g):t},g.id=function(S){return arguments.length?(e=S,g):e},g.iterations=function(S){return arguments.length?(u=+S,g):u},g.strength=function(S){return arguments.length?(r=typeof S=="function"?S:fs(+S),v(),g):r},g.distance=function(S){return arguments.length?(s=typeof S=="function"?S:fs(+S),I(),g):s},g}const cV=1664525,dV=1013904223,pv=4294967296;function uV(){let t=1;return()=>(t=(cV*t+dV)%pv)/pv}function hV(t){return t.x}function mV(t){return t.y}var pV=10,fV=Math.PI*(3-Math.sqrt(5));function gV(t){var e,r=1,n=.001,s=1-Math.pow(n,1/300),i=0,a=.6,l=new Map,c=H0(m),d=Yc("tick","end"),u=uV();t==null&&(t=[]);function m(){g(),d.call("tick",e),r<n&&(c.stop(),d.call("end",e))}function g(I){var S,b=t.length,k;I===void 0&&(I=1);for(var A=0;A<I;++A)for(r+=(i-r)*s,l.forEach(function(C){C(r)}),S=0;S<b;++S)k=t[S],k.fx==null?k.x+=k.vx*=a:(k.x=k.fx,k.vx=0),k.fy==null?k.y+=k.vy*=a:(k.y=k.fy,k.vy=0);return e}function y(){for(var I=0,S=t.length,b;I<S;++I){if(b=t[I],b.index=I,b.fx!=null&&(b.x=b.fx),b.fy!=null&&(b.y=b.fy),isNaN(b.x)||isNaN(b.y)){var k=pV*Math.sqrt(.5+I),A=I*fV;b.x=k*Math.cos(A),b.y=k*Math.sin(A)}(isNaN(b.vx)||isNaN(b.vy))&&(b.vx=b.vy=0)}}function v(I){return I.initialize&&I.initialize(t,u),I}return y(),e={tick:g,restart:function(){return c.restart(m),e},stop:function(){return c.stop(),e},nodes:function(I){return arguments.length?(t=I,y(),l.forEach(v),e):t},alpha:function(I){return arguments.length?(r=+I,e):r},alphaMin:function(I){return arguments.length?(n=+I,e):n},alphaDecay:function(I){return arguments.length?(s=+I,e):+s},alphaTarget:function(I){return arguments.length?(i=+I,e):i},velocityDecay:function(I){return arguments.length?(a=1-I,e):1-a},randomSource:function(I){return arguments.length?(u=I,l.forEach(v),e):u},force:function(I,S){return arguments.length>1?(S==null?l.delete(I):l.set(I,v(S)),e):l.get(I)},find:function(I,S,b){var k=0,A=t.length,C,T,P,_,R;for(b==null?b=1/0:b*=b,k=0;k<A;++k)_=t[k],C=I-_.x,T=S-_.y,P=C*C+T*T,P<b&&(R=_,b=P);return R},on:function(I,S){return arguments.length>1?(d.on(I,S),e):d.on(I)}}}function yV(){var t,e,r,n,s=fs(-30),i,a=1,l=1/0,c=.81;function d(y){var v,I=t.length,S=J0(t,hV,mV).visitAfter(m);for(n=y,v=0;v<I;++v)e=t[v],S.visit(g)}function u(){if(t){var y,v=t.length,I;for(i=new Array(v),y=0;y<v;++y)I=t[y],i[I.index]=+s(I,y,t)}}function m(y){var v=0,I,S,b=0,k,A,C;if(y.length){for(k=A=C=0;C<4;++C)(I=y[C])&&(S=Math.abs(I.value))&&(v+=I.value,b+=S,k+=S*I.x,A+=S*I.y);y.x=k/b,y.y=A/b}else{I=y,I.x=I.data.x,I.y=I.data.y;do v+=i[I.data.index];while(I=I.next)}y.value=v}function g(y,v,I,S){if(!y.value)return!0;var b=y.x-e.x,k=y.y-e.y,A=S-v,C=b*b+k*k;if(A*A/c<C)return C<l&&(b===0&&(b=Ci(r),C+=b*b),k===0&&(k=Ci(r),C+=k*k),C<a&&(C=Math.sqrt(a*C)),e.vx+=b*y.value*n/C,e.vy+=k*y.value*n/C),!0;if(y.length||C>=l)return;(y.data!==e||y.next)&&(b===0&&(b=Ci(r),C+=b*b),k===0&&(k=Ci(r),C+=k*k),C<a&&(C=Math.sqrt(a*C)));do y.data!==e&&(A=i[y.data.index]*n/C,e.vx+=b*A,e.vy+=k*A);while(y=y.next)}return d.initialize=function(y,v){t=y,r=v,u()},d.strength=function(y){return arguments.length?(s=typeof y=="function"?y:fs(+y),u(),d):s},d.distanceMin=function(y){return arguments.length?(a=y*y,d):Math.sqrt(a)},d.distanceMax=function(y){return arguments.length?(l=y*y,d):Math.sqrt(l)},d.theta=function(y){return arguments.length?(c=y*y,d):Math.sqrt(c)},d}function xV(t){var e=fs(.1),r,n,s;typeof t!="function"&&(t=fs(t==null?0:+t));function i(l){for(var c=0,d=r.length,u;c<d;++c)u=r[c],u.vx+=(s[c]-u.x)*n[c]*l}function a(){if(r){var l,c=r.length;for(n=new Array(c),s=new Array(c),l=0;l<c;++l)n[l]=isNaN(s[l]=+t(r[l],l,r))?0:+e(r[l],l,r)}}return i.initialize=function(l){r=l,a()},i.strength=function(l){return arguments.length?(e=typeof l=="function"?l:fs(+l),a(),i):e},i.x=function(l){return arguments.length?(t=typeof l=="function"?l:fs(+l),a(),i):t},i}function vV(t){var e=fs(.1),r,n,s;typeof t!="function"&&(t=fs(t==null?0:+t));function i(l){for(var c=0,d=r.length,u;c<d;++c)u=r[c],u.vy+=(s[c]-u.y)*n[c]*l}function a(){if(r){var l,c=r.length;for(n=new Array(c),s=new Array(c),l=0;l<c;++l)n[l]=isNaN(s[l]=+t(r[l],l,r))?0:+e(r[l],l,r)}}return i.initialize=function(l){r=l,a()},i.strength=function(l){return arguments.length?(e=typeof l=="function"?l:fs(+l),a(),i):e},i.y=function(l){return arguments.length?(t=typeof l=="function"?l:fs(+l),a(),i):t},i}function bV(t){var e=0,r=t.children,n=r&&r.length;if(!n)e=1;else for(;--n>=0;)e+=r[n].value;t.value=e}function SV(){return this.eachAfter(bV)}function wV(t,e){let r=-1;for(const n of this)t.call(e,n,++r,this);return this}function CV(t,e){for(var r=this,n=[r],s,i,a=-1;r=n.pop();)if(t.call(e,r,++a,this),s=r.children)for(i=s.length-1;i>=0;--i)n.push(s[i]);return this}function kV(t,e){for(var r=this,n=[r],s=[],i,a,l,c=-1;r=n.pop();)if(s.push(r),i=r.children)for(a=0,l=i.length;a<l;++a)n.push(i[a]);for(;r=s.pop();)t.call(e,r,++c,this);return this}function IV(t,e){let r=-1;for(const n of this)if(t.call(e,n,++r,this))return n}function jV(t){return this.eachAfter(function(e){for(var r=+t(e.data)||0,n=e.children,s=n&&n.length;--s>=0;)r+=n[s].value;e.value=r})}function TV(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})}function EV(t){for(var e=this,r=MV(e,t),n=[e];e!==r;)e=e.parent,n.push(e);for(var s=n.length;t!==r;)n.splice(s,0,t),t=t.parent;return n}function MV(t,e){if(t===e)return t;var r=t.ancestors(),n=e.ancestors(),s=null;for(t=r.pop(),e=n.pop();t===e;)s=t,t=r.pop(),e=n.pop();return s}function AV(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e}function PV(){return Array.from(this)}function NV(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t}function DV(){var t=this,e=[];return t.each(function(r){r!==t&&e.push({source:r.parent,target:r})}),e}function*RV(){var t=this,e,r=[t],n,s,i;do for(e=r.reverse(),r=[];t=e.pop();)if(yield t,n=t.children)for(s=0,i=n.length;s<i;++s)r.push(n[s]);while(r.length)}function K0(t,e){t instanceof Map?(t=[void 0,t],e===void 0&&(e=FV)):e===void 0&&(e=_V);for(var r=new Gu(t),n,s=[r],i,a,l,c;n=s.pop();)if((a=e(n.data))&&(c=(a=Array.from(a)).length))for(n.children=a,l=c-1;l>=0;--l)s.push(i=a[l]=new Gu(a[l])),i.parent=n,i.depth=n.depth+1;return r.eachBefore($V)}function OV(){return K0(this).eachBefore(VV)}function _V(t){return t.children}function FV(t){return Array.isArray(t)?t[1]:null}function VV(t){t.data.value!==void 0&&(t.value=t.data.value),t.data=t.data.data}function $V(t){var e=0;do t.height=e;while((t=t.parent)&&t.height<++e)}function Gu(t){this.data=t,this.depth=this.height=0,this.parent=null}Gu.prototype=K0.prototype={constructor:Gu,count:SV,each:wV,eachAfter:kV,eachBefore:CV,find:IV,sum:jV,sort:TV,path:EV,ancestors:AV,descendants:PV,leaves:NV,links:DV,copy:OV,[Symbol.iterator]:RV};function zV(t){return t==null?null:LV(t)}function LV(t){if(typeof t!="function")throw new Error;return t}function fv(){return 0}function BV(t){return function(){return t}}const UV=1664525,GV=1013904223,gv=4294967296;function HV(){let t=1;return()=>(t=(UV*t+GV)%gv)/gv}function WV(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function qV(t,e){let r=t.length,n,s;for(;r;)s=e()*r--|0,n=t[r],t[r]=t[s],t[s]=n;return t}function JV(t,e){for(var r=0,n=(t=qV(Array.from(t),e)).length,s=[],i,a;r<n;)i=t[r],a&&v5(a,i)?++r:(a=KV(s=YV(s,i)),r=0);return a}function YV(t,e){var r,n;if(Lm(e,t))return[e];for(r=0;r<t.length;++r)if(Nd(e,t[r])&&Lm(tc(t[r],e),t))return[t[r],e];for(r=0;r<t.length-1;++r)for(n=r+1;n<t.length;++n)if(Nd(tc(t[r],t[n]),e)&&Nd(tc(t[r],e),t[n])&&Nd(tc(t[n],e),t[r])&&Lm(b5(t[r],t[n],e),t))return[t[r],t[n],e];throw new Error}function Nd(t,e){var r=t.r-e.r,n=e.x-t.x,s=e.y-t.y;return r<0||r*r<n*n+s*s}function v5(t,e){var r=t.r-e.r+Math.max(t.r,e.r,1)*1e-9,n=e.x-t.x,s=e.y-t.y;return r>0&&r*r>n*n+s*s}function Lm(t,e){for(var r=0;r<e.length;++r)if(!v5(t,e[r]))return!1;return!0}function KV(t){switch(t.length){case 1:return ZV(t[0]);case 2:return tc(t[0],t[1]);case 3:return b5(t[0],t[1],t[2])}}function ZV(t){return{x:t.x,y:t.y,r:t.r}}function tc(t,e){var r=t.x,n=t.y,s=t.r,i=e.x,a=e.y,l=e.r,c=i-r,d=a-n,u=l-s,m=Math.sqrt(c*c+d*d);return{x:(r+i+c/m*u)/2,y:(n+a+d/m*u)/2,r:(m+s+l)/2}}function b5(t,e,r){var n=t.x,s=t.y,i=t.r,a=e.x,l=e.y,c=e.r,d=r.x,u=r.y,m=r.r,g=n-a,y=n-d,v=s-l,I=s-u,S=c-i,b=m-i,k=n*n+s*s-i*i,A=k-a*a-l*l+c*c,C=k-d*d-u*u+m*m,T=y*v-g*I,P=(v*C-I*A)/(T*2)-n,_=(I*S-v*b)/T,R=(y*A-g*C)/(T*2)-s,G=(g*b-y*S)/T,ne=_*_+G*G-1,he=2*(i+P*_+R*G),te=P*P+R*R-i*i,K=-(Math.abs(ne)>1e-6?(he+Math.sqrt(he*he-4*ne*te))/(2*ne):te/he);return{x:n+P+_*K,y:s+R+G*K,r:K}}function yv(t,e,r){var n=t.x-e.x,s,i,a=t.y-e.y,l,c,d=n*n+a*a;d?(i=e.r+r.r,i*=i,c=t.r+r.r,c*=c,i>c?(s=(d+c-i)/(2*d),l=Math.sqrt(Math.max(0,c/d-s*s)),r.x=t.x-s*n-l*a,r.y=t.y-s*a+l*n):(s=(d+i-c)/(2*d),l=Math.sqrt(Math.max(0,i/d-s*s)),r.x=e.x+s*n-l*a,r.y=e.y+s*a+l*n)):(r.x=e.x+r.r,r.y=e.y)}function xv(t,e){var r=t.r+e.r-1e-6,n=e.x-t.x,s=e.y-t.y;return r>0&&r*r>n*n+s*s}function vv(t){var e=t._,r=t.next._,n=e.r+r.r,s=(e.x*r.r+r.x*e.r)/n,i=(e.y*r.r+r.y*e.r)/n;return s*s+i*i}function Dd(t){this._=t,this.next=null,this.previous=null}function XV(t,e){if(!(i=(t=WV(t)).length))return 0;var r,n,s,i,a,l,c,d,u,m,g;if(r=t[0],r.x=0,r.y=0,!(i>1))return r.r;if(n=t[1],r.x=-n.r,n.x=r.r,n.y=0,!(i>2))return r.r+n.r;yv(n,r,s=t[2]),r=new Dd(r),n=new Dd(n),s=new Dd(s),r.next=s.previous=n,n.next=r.previous=s,s.next=n.previous=r;e:for(c=3;c<i;++c){yv(r._,n._,s=t[c]),s=new Dd(s),d=n.next,u=r.previous,m=n._.r,g=r._.r;do if(m<=g){if(xv(d._,s._)){n=d,r.next=n,n.previous=r,--c;continue e}m+=d._.r,d=d.next}else{if(xv(u._,s._)){r=u,r.next=n,n.previous=r,--c;continue e}g+=u._.r,u=u.previous}while(d!==u.next);for(s.previous=r,s.next=n,r.next=n.previous=n=s,a=vv(r);(s=s.next)!==n;)(l=vv(s))<a&&(r=s,a=l);n=r.next}for(r=[n._],s=n;(s=s.next)!==n;)r.push(s._);for(s=JV(r,e),c=0;c<i;++c)r=t[c],r.x-=s.x,r.y-=s.y;return s.r}function QV(t){return Math.sqrt(t.value)}function e$(){var t=null,e=1,r=1,n=fv;function s(i){const a=HV();return i.x=e/2,i.y=r/2,t?i.eachBefore(bv(t)).eachAfter(Bm(n,.5,a)).eachBefore(Sv(1)):i.eachBefore(bv(QV)).eachAfter(Bm(fv,1,a)).eachAfter(Bm(n,i.r/Math.min(e,r),a)).eachBefore(Sv(Math.min(e,r)/(2*i.r))),i}return s.radius=function(i){return arguments.length?(t=zV(i),s):t},s.size=function(i){return arguments.length?(e=+i[0],r=+i[1],s):[e,r]},s.padding=function(i){return arguments.length?(n=typeof i=="function"?i:BV(+i),s):n},s}function bv(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function Bm(t,e,r){return function(n){if(s=n.children){var s,i,a=s.length,l=t(n)*e||0,c;if(l)for(i=0;i<a;++i)s[i].r+=l;if(c=XV(s,r),l)for(i=0;i<a;++i)s[i].r-=l;n.r=c+l}}}function Sv(t){return function(e){var r=e.parent;e.r*=t,r&&(e.x=r.x+t*e.x,e.y=r.y+t*e.y)}}const Rd=t=>()=>t;function t$(t,{sourceEvent:e,target:r,transform:n,dispatch:s}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:s}})}function Zo(t,e,r){this.k=t,this.x=e,this.y=r}Zo.prototype={constructor:Zo,scale:function(t){return t===1?this:new Zo(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Zo(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ua=new Zo(1,0,0);If.prototype=Zo.prototype;function If(t){for(;!t.__zoom;)if(!(t=t.parentNode))return Ua;return t.__zoom}function Um(t){t.stopImmediatePropagation()}function Kl(t){t.preventDefault(),t.stopImmediatePropagation()}function r$(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function n$(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function wv(){return this.__zoom||Ua}function s$(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function o$(){return navigator.maxTouchPoints||"ontouchstart"in this}function i$(t,e,r){var n=t.invertX(e[0][0])-r[0][0],s=t.invertX(e[1][0])-r[1][0],i=t.invertY(e[0][1])-r[0][1],a=t.invertY(e[1][1])-r[1][1];return t.translate(s>n?(n+s)/2:Math.min(0,n)||Math.max(0,s),a>i?(i+a)/2:Math.min(0,i)||Math.max(0,a))}function S5(){var t=r$,e=n$,r=i$,n=s$,s=o$,i=[0,1/0],a=[[-1/0,-1/0],[1/0,1/0]],l=250,c=M_,d=Yc("start","zoom","end"),u,m,g,y=500,v=150,I=0,S=10;function b(O){O.property("__zoom",wv).on("wheel.zoom",R,{passive:!1}).on("mousedown.zoom",G).on("dblclick.zoom",ne).filter(s).on("touchstart.zoom",he).on("touchmove.zoom",te).on("touchend.zoom touchcancel.zoom",K).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}b.transform=function(O,Z,ie,ge){var xe=O.selection?O.selection():O;xe.property("__zoom",wv),O!==xe?T(O,Z,ie,ge):xe.interrupt().each(function(){P(this,arguments).event(ge).start().zoom(null,typeof Z=="function"?Z.apply(this,arguments):Z).end()})},b.scaleBy=function(O,Z,ie,ge){b.scaleTo(O,function(){var xe=this.__zoom.k,$=typeof Z=="function"?Z.apply(this,arguments):Z;return xe*$},ie,ge)},b.scaleTo=function(O,Z,ie,ge){b.transform(O,function(){var xe=e.apply(this,arguments),$=this.__zoom,B=ie==null?C(xe):typeof ie=="function"?ie.apply(this,arguments):ie,U=$.invert(B),X=typeof Z=="function"?Z.apply(this,arguments):Z;return r(A(k($,X),B,U),xe,a)},ie,ge)},b.translateBy=function(O,Z,ie,ge){b.transform(O,function(){return r(this.__zoom.translate(typeof Z=="function"?Z.apply(this,arguments):Z,typeof ie=="function"?ie.apply(this,arguments):ie),e.apply(this,arguments),a)},null,ge)},b.translateTo=function(O,Z,ie,ge,xe){b.transform(O,function(){var $=e.apply(this,arguments),B=this.__zoom,U=ge==null?C($):typeof ge=="function"?ge.apply(this,arguments):ge;return r(Ua.translate(U[0],U[1]).scale(B.k).translate(typeof Z=="function"?-Z.apply(this,arguments):-Z,typeof ie=="function"?-ie.apply(this,arguments):-ie),$,a)},ge,xe)};function k(O,Z){return Z=Math.max(i[0],Math.min(i[1],Z)),Z===O.k?O:new Zo(Z,O.x,O.y)}function A(O,Z,ie){var ge=Z[0]-ie[0]*O.k,xe=Z[1]-ie[1]*O.k;return ge===O.x&&xe===O.y?O:new Zo(O.k,ge,xe)}function C(O){return[(+O[0][0]+ +O[1][0])/2,(+O[0][1]+ +O[1][1])/2]}function T(O,Z,ie,ge){O.on("start.zoom",function(){P(this,arguments).event(ge).start()}).on("interrupt.zoom end.zoom",function(){P(this,arguments).event(ge).end()}).tween("zoom",function(){var xe=this,$=arguments,B=P(xe,$).event(ge),U=e.apply(xe,$),X=ie==null?C(U):typeof ie=="function"?ie.apply(xe,$):ie,ee=Math.max(U[1][0]-U[0][0],U[1][1]-U[0][1]),be=xe.__zoom,Se=typeof Z=="function"?Z.apply(xe,$):Z,Me=c(be.invert(X).concat(ee/be.k),Se.invert(X).concat(ee/Se.k));return function(se){if(se===1)se=Se;else{var de=Me(se),fe=ee/de[2];se=new Zo(fe,X[0]-de[0]*fe,X[1]-de[1]*fe)}B.zoom(null,se)}})}function P(O,Z,ie){return!ie&&O.__zooming||new _(O,Z)}function _(O,Z){this.that=O,this.args=Z,this.active=0,this.sourceEvent=null,this.extent=e.apply(O,Z),this.taps=0}_.prototype={event:function(O){return O&&(this.sourceEvent=O),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(O,Z){return this.mouse&&O!=="mouse"&&(this.mouse[1]=Z.invert(this.mouse[0])),this.touch0&&O!=="touch"&&(this.touch0[1]=Z.invert(this.touch0[0])),this.touch1&&O!=="touch"&&(this.touch1[1]=Z.invert(this.touch1[0])),this.that.__zoom=Z,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(O){var Z=Jr(this.that).datum();d.call(O,this.that,new t$(O,{sourceEvent:this.sourceEvent,target:b,transform:this.that.__zoom,dispatch:d}),Z)}};function R(O,...Z){if(!t.apply(this,arguments))return;var ie=P(this,Z).event(O),ge=this.__zoom,xe=Math.max(i[0],Math.min(i[1],ge.k*Math.pow(2,n.apply(this,arguments)))),$=Jo(O);if(ie.wheel)(ie.mouse[0][0]!==$[0]||ie.mouse[0][1]!==$[1])&&(ie.mouse[1]=ge.invert(ie.mouse[0]=$)),clearTimeout(ie.wheel);else{if(ge.k===xe)return;ie.mouse=[$,ge.invert($)],qd(this),ie.start()}Kl(O),ie.wheel=setTimeout(B,v),ie.zoom("mouse",r(A(k(ge,xe),ie.mouse[0],ie.mouse[1]),ie.extent,a));function B(){ie.wheel=null,ie.end()}}function G(O,...Z){if(g||!t.apply(this,arguments))return;var ie=O.currentTarget,ge=P(this,Z,!0).event(O),xe=Jr(O.view).on("mousemove.zoom",X,!0).on("mouseup.zoom",ee,!0),$=Jo(O,ie),B=O.clientX,U=O.clientY;s5(O.view),Um(O),ge.mouse=[$,this.__zoom.invert($)],qd(this),ge.start();function X(be){if(Kl(be),!ge.moved){var Se=be.clientX-B,Me=be.clientY-U;ge.moved=Se*Se+Me*Me>I}ge.event(be).zoom("mouse",r(A(ge.that.__zoom,ge.mouse[0]=Jo(be,ie),ge.mouse[1]),ge.extent,a))}function ee(be){xe.on("mousemove.zoom mouseup.zoom",null),o5(be.view,ge.moved),Kl(be),ge.event(be).end()}}function ne(O,...Z){if(t.apply(this,arguments)){var ie=this.__zoom,ge=Jo(O.changedTouches?O.changedTouches[0]:O,this),xe=ie.invert(ge),$=ie.k*(O.shiftKey?.5:2),B=r(A(k(ie,$),ge,xe),e.apply(this,Z),a);Kl(O),l>0?Jr(this).transition().duration(l).call(T,B,ge,O):Jr(this).call(b.transform,B,ge,O)}}function he(O,...Z){if(t.apply(this,arguments)){var ie=O.touches,ge=ie.length,xe=P(this,Z,O.changedTouches.length===ge).event(O),$,B,U,X;for(Um(O),B=0;B<ge;++B)U=ie[B],X=Jo(U,this),X=[X,this.__zoom.invert(X),U.identifier],xe.touch0?!xe.touch1&&xe.touch0[2]!==X[2]&&(xe.touch1=X,xe.taps=0):(xe.touch0=X,$=!0,xe.taps=1+!!u);u&&(u=clearTimeout(u)),$&&(xe.taps<2&&(m=X[0],u=setTimeout(function(){u=null},y)),qd(this),xe.start())}}function te(O,...Z){if(this.__zooming){var ie=P(this,Z).event(O),ge=O.changedTouches,xe=ge.length,$,B,U,X;for(Kl(O),$=0;$<xe;++$)B=ge[$],U=Jo(B,this),ie.touch0&&ie.touch0[2]===B.identifier?ie.touch0[0]=U:ie.touch1&&ie.touch1[2]===B.identifier&&(ie.touch1[0]=U);if(B=ie.that.__zoom,ie.touch1){var ee=ie.touch0[0],be=ie.touch0[1],Se=ie.touch1[0],Me=ie.touch1[1],se=(se=Se[0]-ee[0])*se+(se=Se[1]-ee[1])*se,de=(de=Me[0]-be[0])*de+(de=Me[1]-be[1])*de;B=k(B,Math.sqrt(se/de)),U=[(ee[0]+Se[0])/2,(ee[1]+Se[1])/2],X=[(be[0]+Me[0])/2,(be[1]+Me[1])/2]}else if(ie.touch0)U=ie.touch0[0],X=ie.touch0[1];else return;ie.zoom("touch",r(A(B,U,X),ie.extent,a))}}function K(O,...Z){if(this.__zooming){var ie=P(this,Z).event(O),ge=O.changedTouches,xe=ge.length,$,B;for(Um(O),g&&clearTimeout(g),g=setTimeout(function(){g=null},y),$=0;$<xe;++$)B=ge[$],ie.touch0&&ie.touch0[2]===B.identifier?delete ie.touch0:ie.touch1&&ie.touch1[2]===B.identifier&&delete ie.touch1;if(ie.touch1&&!ie.touch0&&(ie.touch0=ie.touch1,delete ie.touch1),ie.touch0)ie.touch0[1]=this.__zoom.invert(ie.touch0[0]);else if(ie.end(),ie.taps===2&&(B=Jo(B,this),Math.hypot(m[0]-B[0],m[1]-B[1])<S)){var U=Jr(this).on("dblclick.zoom");U&&U.apply(this,arguments)}}}return b.wheelDelta=function(O){return arguments.length?(n=typeof O=="function"?O:Rd(+O),b):n},b.filter=function(O){return arguments.length?(t=typeof O=="function"?O:Rd(!!O),b):t},b.touchable=function(O){return arguments.length?(s=typeof O=="function"?O:Rd(!!O),b):s},b.extent=function(O){return arguments.length?(e=typeof O=="function"?O:Rd([[+O[0][0],+O[0][1]],[+O[1][0],+O[1][1]]]),b):e},b.scaleExtent=function(O){return arguments.length?(i[0]=+O[0],i[1]=+O[1],b):[i[0],i[1]]},b.translateExtent=function(O){return arguments.length?(a[0][0]=+O[0][0],a[1][0]=+O[1][0],a[0][1]=+O[0][1],a[1][1]=+O[1][1],b):[[a[0][0],a[0][1]],[a[1][0],a[1][1]]]},b.constrain=function(O){return arguments.length?(r=O,b):r},b.duration=function(O){return arguments.length?(l=+O,b):l},b.interpolate=function(O){return arguments.length?(c=O,b):c},b.on=function(){var O=d.on.apply(d,arguments);return O===d?b:O},b.clickDistance=function(O){return arguments.length?(I=(O=+O)*O,b):Math.sqrt(I)},b.tapDistance=function(O){return arguments.length?(S=+O,b):S},b}function a$(t,e,r={}){const{linkDistance:n=150,linkStrength:s=.2,chargeStrength:i=-400,chargeDistance:a=300,collisionRadius:l=30,centerStrength:c=.1,clustering:d=!0}=r,u=gV().force("link",lV().id(m=>m.id).distance(n).strength(s)).force("charge",yV().strength(i).distanceMax(a)).force("center",LF(t/2,e/2)).force("collision",iV(l)).force("x",xV(t/2).strength(c)).force("y",vV(e/2).strength(c));return d&&u.force("cluster",l$(u,.2)),u}function l$(t,e=.2){return r=>{const n=t.nodes(),s=new Map;n.forEach(a=>{var c;const l=a.resolvedValueTypeCategory;s.has(l)||s.set(l,[]),(c=s.get(l))==null||c.push(a)});const i=new Map;s.forEach((a,l)=>{const c={x:J1(a,d=>d.x??0)??0,y:J1(a,d=>d.y??0)??0};i.set(l,c)}),n.forEach(a=>{const l=i.get(a.resolvedValueTypeCategory);if(l){const c=l.x-(a.x??0),d=l.y-(a.y??0);a.x=(a.x??0)+c*e*r,a.y=(a.y??0)+d*e*r}})}}function c$(t,e=[.1,4]){return S5().scaleExtent(e).on("zoom",r=>{Jr(t).select("g").attr("transform",r.transform)})}function d$(t){const e=s=>{s.active||t.alphaTarget(.3).restart(),s.subject.fx=s.subject.x,s.subject.fy=s.subject.y},r=s=>{s.subject.fx=s.x,s.subject.fy=s.y},n=s=>{s.active||t.alphaTarget(0),s.subject.fx=null,s.subject.fy=null};return n_().on("start",e).on("drag",r).on("end",n)}function u$(t,e,r,n=50){t.forEach(s=>{s.x=Math.max(n,Math.min(e-n,s.x??0)),s.y=Math.max(n,Math.min(r-n,s.y??0))})}function h$(t,e=8,r=20){if(t===0)return e;const n=Math.log(t+1)/Math.log(10);return Math.min(r,e+n*6)}function Cv(t){const e={base:"#48BB78",alias:"#4299E1",circular:"#F56565"};return t.hasCircularDependency?e.circular:e[t.type]||e.base}function m$(t){const e={direct:"#4A5568",indirect:"#A0AEC0",circular:"#F56565"};return e[t.type]||e.direct}function p$(t){return 1+t.strength*3}function f$(t,e,r){var n;r.nodes(t),(n=r.force("link"))==null||n.links(e),r.alpha(1).restart()}function g$(t,e){const{width:r,height:n,padding:s=50}=e,i=new Map;let a=0;t.forEach(c=>{const d=c.dependencyDepth;a=Math.max(a,d),i.has(d)||i.set(d,[]),i.get(d).push(c)});const l=(n-2*s)/Math.max(1,a);i.forEach((c,d)=>{const u=s+d*l,g=(r-2*s)/Math.max(1,c.length-1);c.forEach((y,v)=>{c.length===1?y.x=r/2:y.x=s+v*g,y.y=u,y.fx=y.x,y.fy=y.y})})}function y$(t,e){const{width:r,height:n,padding:s=50}=e,i=r/2,a=n/2,l=Math.min(r,n)/2-s,c=new Map;t.forEach(g=>{const y=g.resolvedValueTypeCategory;c.has(y)||c.set(y,[]),c.get(y).push(g)});const d=c.size,u=l/Math.max(1,d);let m=0;c.forEach(g=>{const y=u*(m+1),v=2*Math.PI/g.length;g.forEach((I,S)=>{const b=S*v;I.x=i+y*Math.cos(b),I.y=a+y*Math.sin(b),I.fx=I.x,I.fy=I.y}),m++})}function x$(t,e){const{width:r,height:n,padding:s=50}=e,i=Math.ceil(Math.sqrt(t.length)),a=Math.ceil(t.length/i),l=(r-2*s)/i,c=(n-2*s)/a;[...t].sort((u,m)=>u.displayName.localeCompare(m.displayName)).forEach((u,m)=>{const g=m%i,y=Math.floor(m/i);u.x=s+g*l+l/2,u.y=s+y*c+c/2,u.fx=u.x,u.fy=u.y})}function kv(t){t.forEach(e=>{e.fx=null,e.fy=null})}function Iv(t,e,r,n,s){switch(kv(e),t){case"hierarchical":g$(e,s);break;case"circular":y$(e,s);break;case"grid":x$(e,s);break;case"force":default:f$(e,r,n);break}t!=="force"&&(n.alpha(.3).restart(),s.animated!==!1&&setTimeout(()=>{t==="force"&&kv(e)},s.duration||1e3))}function v$(t,e,r){if(t.length===0)return{transform:Ua,boundingBox:{x:0,y:0,width:r.width,height:r.height}};const n=t.map(T=>T.x||0),s=t.map(T=>T.y||0),i=Math.min(...n),a=Math.max(...n),l=Math.min(...s),c=Math.max(...s),d={x:i,y:l,width:a-i,height:c-l},u=100,m=d.width+2*u,g=d.height+2*u,y=r.width/m,v=r.height/g,I=Math.min(y,v,2),S=i+d.width/2,b=l+d.height/2,k=r.width/2-S*I,A=r.height/2-b*I;return{transform:Ua.translate(k,A).scale(I),boundingBox:d}}function b$(t,e){t.style("cursor","pointer").on("click",function(r,n){var s;r.stopPropagation(),(s=e.onNodeClick)==null||s.call(e,n,r)}).on("mouseenter",function(r,n){var s;Jr(this).transition().duration(200).attr("r",function(){return parseFloat(Jr(this).attr("r"))*1.3}).attr("stroke-width",3),(s=e.onNodeHover)==null||s.call(e,n,r)}).on("mouseleave",function(r,n){var s;Jr(this).transition().duration(200).attr("r",function(){return parseFloat(Jr(this).attr("r"))/1.3}).attr("stroke-width",2),(s=e.onNodeHover)==null||s.call(e,null,r)})}function S$(t,e){t.style("cursor","pointer").on("click",function(r,n){var s;r.stopPropagation(),(s=e.onEdgeClick)==null||s.call(e,n,r)}).on("mouseenter",function(r,n){var s;Jr(this).transition().duration(200).attr("stroke-width",function(){const i=parseFloat(Jr(this).attr("stroke-width"));return Math.max(3,i*2)}).attr("stroke-opacity",1),(s=e.onEdgeHover)==null||s.call(e,n,r)}).on("mouseleave",function(r,n){var s;Jr(this).transition().duration(200).attr("stroke-width",function(){const i=parseFloat(Jr(this).attr("stroke-width"));return Math.max(1,i/2)}).attr("stroke-opacity",.8),(s=e.onEdgeHover)==null||s.call(e,null,r)})}function w$(t,e){t.on("click",function(r){var n;r.target===this&&((n=e.onBackgroundClick)==null||n.call(e,r))})}function jv(t,e,r,n="#F56565"){Z0(t,e),t.filter(s=>r.includes(s.id)).attr("stroke",n).attr("stroke-width",4).style("filter","drop-shadow(0 0 6px rgba(245, 101, 101, 0.6))"),e.filter(s=>{const i=r.includes(s.source.id),a=r.includes(s.target.id);return i&&a}).attr("stroke",n).attr("stroke-width",4).attr("stroke-opacity",1).style("filter","drop-shadow(0 0 4px rgba(245, 101, 101, 0.6))")}function Z0(t,e){t.attr("stroke",function(r){const n={base:"#2D6A4F",alias:"#1E40AF",circular:"#DC2626"};return n[r.type]||n.base}).attr("stroke-width",2).style("filter",null),e.attr("stroke",function(r){const n={direct:"#4A5568",indirect:"#A0AEC0",circular:"#F56565"};return n[r.type]||n.direct}).attr("stroke-width",function(r){return 1+r.strength*3}).attr("stroke-opacity",.8).style("filter",null)}function C$(t,e,r,n={}){const{fadeUnconnected:s=!0,highlightColor:i="#F59E0B",connectionColor:a="#3B82F6"}=n,l=e.filter(d=>d.source.id===r.id||d.target.id===r.id),c=new Set;l.each(d=>{c.add(d.source.id),c.add(d.target.id)}),t.filter(d=>d.id===r.id).attr("stroke",i).attr("stroke-width",4).style("filter","drop-shadow(0 0 8px rgba(245, 158, 11, 0.6))"),t.filter(d=>c.has(d.id)&&d.id!==r.id).attr("stroke",a).attr("stroke-width",3),l.attr("stroke",a).attr("stroke-width",3).attr("stroke-opacity",1),s&&(t.filter(d=>!c.has(d.id)).transition().duration(300).style("opacity",.3),e.filter(d=>!(d.source.id===r.id||d.target.id===r.id)).transition().duration(300).style("opacity",.2))}function k$(t,e){Z0(t,e),t.transition().duration(300).style("opacity",1),e.transition().duration(300).style("opacity",.8)}function I$(){let t=null;return{show:(s,i,a)=>{t||(t=Jr("body").append("div").style("position","absolute").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("padding","8px 12px").style("border-radius","4px").style("font-size","12px").style("pointer-events","none").style("z-index","1000").style("opacity",0)),t.html(s).style("left",`${i+10}px`).style("top",`${a-10}px`).transition().duration(200).style("opacity",1)},hide:()=>{t&&t.transition().duration(200).style("opacity",0)},remove:()=>{t&&(t.remove(),t=null)}}}const w5=M.forwardRef((t,e)=>{const{data:r,onNodeClick:n,onEdgeClick:s,onNodeHover:i,highlightPath:a=[],layout:l="force",showLabels:c=!0,showLegend:d=!1,showStatistics:u=!1,width:m=800,height:g=600,interactive:y=!0,clustered:v=!0,filterOptions:I}=t,S=M.useRef(null);M.useRef(null);const[b,k]=M.useState({isLoading:!1,error:null,selectedNode:null,hoveredNode:null,highlightedPath:[],showStatistics:!1,currentLayout:l}),A=M.useRef({simulation:null,zoom:null,drag:null}),C=M.useRef({svg:null,container:null,nodes:null,edges:null,labels:null}),T=M.useRef(I$()),P=M.useCallback(()=>{var he,te;if(!I)return r;let R=[...r.nodes],G=[...r.edges];I.hideIsolatedNodes&&(R=R.filter(K=>K.usageCount>0||K.dependencyDepth>0)),I.showOnlyCircular&&(R=R.filter(K=>K.hasCircularDependency)),I.minDependencyDepth!==void 0&&(R=R.filter(K=>K.dependencyDepth>=I.minDependencyDepth)),I.maxDependencyDepth!==void 0&&(R=R.filter(K=>K.dependencyDepth<=I.maxDependencyDepth)),(he=I.resolvedValueTypes)!=null&&he.length&&(R=R.filter(K=>I.resolvedValueTypes.includes(K.resolvedValueTypeId))),(te=I.collections)!=null&&te.length&&(R=R.filter(K=>K.collectionIds.some(O=>I.collections.includes(O))));const ne=new Set(R.map(K=>K.id));return G=G.filter(K=>ne.has(K.source.id)&&ne.has(K.target.id)),{...r,nodes:R,edges:G}},[r,I]),_=M.useCallback(()=>{var R;if(!(!S.current||!r.nodes.length))try{k(xe=>({...xe,isLoading:!0,error:null})),Jr(S.current).selectAll("*").remove();const G=P(),ne=Jr(S.current),he=ne.append("g");C.current.svg=ne,C.current.container=he;const te=a$(m,g,{clustering:v,linkDistance:150,linkStrength:.2,chargeStrength:-400}),K=c$("svg");ne.call(K);const O=d$(te);A.current={simulation:te,zoom:K,drag:O};const Z=he.append("g").attr("class","edges").selectAll("line").data(G.edges).enter().append("line").attr("stroke",m$).attr("stroke-width",p$).attr("stroke-opacity",.8),ie=he.append("g").attr("class","nodes").selectAll("circle").data(G.nodes).enter().append("circle").attr("r",xe=>h$(xe.usageCount)).attr("fill",Cv).attr("stroke",xe=>{var B;const $=Cv(xe);return((B=La($))==null?void 0:B.darker(.5).toString())||$}).attr("stroke-width",2);let ge=null;if(c&&(ge=he.append("g").attr("class","labels").selectAll("text").data(G.nodes).enter().append("text").text(xe=>xe.displayName).attr("font-size",12).attr("dx",12).attr("dy",4).attr("fill","#2D3748").attr("pointer-events","none")),C.current.nodes=ie,C.current.edges=Z,C.current.labels=ge,y){const xe={onNodeClick:($,B)=>{k(U=>({...U,selectedNode:$})),C$(ie,Z,$),n==null||n($)},onNodeHover:($,B)=>{k(U=>({...U,hoveredNode:$})),$&&B?T.current.show(`<strong>${$.displayName}</strong><br/>
                Type: ${$.type}<br/>
                Dependencies: ${$.dependencyDepth}<br/>
                Usage: ${$.usageCount}`,B.pageX,B.pageY):T.current.hide(),i==null||i($)},onEdgeClick:($,B)=>{s==null||s($)},onBackgroundClick:()=>{k($=>({...$,selectedNode:null})),k$(ie,Z)}};b$(ie,xe),S$(Z,xe),w$(ne,xe),ie.call(O)}(R=te.force("link"))==null||R.links(G.edges),te.nodes(G.nodes),te.on("tick",()=>{u$(G.nodes,m,g,50),Z.attr("x1",xe=>xe.source.x||0).attr("y1",xe=>xe.source.y||0).attr("x2",xe=>xe.target.x||0).attr("y2",xe=>xe.target.y||0),ie.attr("cx",xe=>xe.x||0).attr("cy",xe=>xe.y||0),ge&&ge.attr("x",xe=>xe.x||0).attr("y",xe=>xe.y||0)}),Iv(b.currentLayout,G.nodes,G.edges,te,{width:m,height:g}),k(xe=>({...xe,isLoading:!1}))}catch(G){console.error("[NetworkDiagram] Error initializing visualization:",G),k(ne=>({...ne,isLoading:!1,error:G instanceof Error?G.message:"Unknown error"}))}},[r,m,g,c,y,v,P,b.currentLayout,n,i,s]);return M.useEffect(()=>{_()},[_]),M.useEffect(()=>{a.length>0&&C.current.nodes&&C.current.edges&&(jv(C.current.nodes,C.current.edges,a),k(R=>({...R,highlightedPath:a})))},[a]),M.useImperativeHandle(e,()=>({zoomIn:()=>{A.current.zoom&&S.current&&A.current.zoom.scaleBy(Jr(S.current),1.3)},zoomOut:()=>{A.current.zoom&&S.current&&A.current.zoom.scaleBy(Jr(S.current),.7)},resetView:()=>{A.current.zoom&&S.current&&Jr(S.current).transition().duration(750).call(A.current.zoom.transform,Ua)},focusOnNode:R=>{const G=r.nodes.find(ne=>ne.id===R);if(G&&A.current.zoom&&S.current){const{transform:ne}=v$([G],r.nodes,{width:m,height:g});Jr(S.current).transition().duration(750).call(A.current.zoom.transform,ne)}},exportVisualization:R=>{console.log(`Exporting as ${R}`)},highlightPath:R=>{C.current.nodes&&C.current.edges&&(jv(C.current.nodes,C.current.edges,R),k(G=>({...G,highlightedPath:R})))},clearHighlights:()=>{C.current.nodes&&C.current.edges&&(Z0(C.current.nodes,C.current.edges),k(R=>({...R,highlightedPath:[]})))},changeLayout:R=>{if(k(G=>({...G,currentLayout:R})),A.current.simulation){const G=P();Iv(R,G.nodes,G.edges,A.current.simulation,{width:m,height:g})}}})),M.useEffect(()=>()=>{T.current.remove()},[]),b.error?o.jsxs(zt,{status:"error",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(tn,{children:["Failed to render network diagram: ",b.error]})]}):o.jsxs(z,{position:"relative",width:m,height:g,children:[o.jsx("svg",{ref:S,width:m,height:g,style:{background:"#F7FAFC",border:"1px solid #E2E8F0",borderRadius:"6px"}}),b.isLoading&&o.jsx(z,{position:"absolute",top:0,left:0,right:0,bottom:0,bg:"white",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px",children:"Loading visualization..."})]})});w5.displayName="NetworkDiagram";function j$(t){var r;console.log("[D3 Helpers] Creating hierarchy with data:",t);const e=K0(t).sum(n=>n.value||1).sort((n,s)=>(s.value||0)-(n.value||0));return console.log("[D3 Helpers] Created hierarchy root:",e),console.log("[D3 Helpers] Root children:",(r=e.children)==null?void 0:r.map(n=>{var s;return{name:n.data.name,children:(s=n.children)==null?void 0:s.length,value:n.value}})),e}function T$(t,e,r=3){return e$().size([t,e]).padding(r)}function E$(t,e,r){return T$(e,r)(t),t}function C5(t){const e=["#EBF8FF","#BEE3F8","#90CDF4","#63B3ED","#4299E1","#3182CE","#2B6CB0","#2C5282","#2A4365","#1A365D"],r=t.depth||0,n=Math.min(r,e.length-1);return e[n]}function Tv(t){const e=C5(t),r=La(e);return r?r.darker(.5).toString():e}function M$(){return Jr("body").append("div").attr("class","circle-pack-tooltip").style("position","fixed").style("visibility","hidden").style("background","rgba(26, 32, 44, 0.95)").style("color","white").style("padding","10px 14px").style("border-radius","8px").style("font-size","13px").style("font-family","system-ui, -apple-system, sans-serif").style("font-weight","500").style("line-height","1.4").style("pointer-events","none").style("z-index","9999").style("box-shadow","0 8px 25px rgba(0, 0, 0, 0.25)").style("max-width","220px").style("white-space","nowrap").style("backdrop-filter","blur(8px)").style("border","1px solid rgba(255, 255, 255, 0.1)")}function A$(t,e,r){let n=e.type;e.entityType&&(n=`${e.type} (${e.entityType})`);const s=`
    <div style="margin-bottom: 6px; font-weight: 600; color: #E2E8F0;">${e.name}</div>
    <div style="margin-bottom: 4px; color: #A0AEC0;">Type: ${n}</div>
    ${e.value&&e.value>1?`<div style="margin-bottom: 4px; color: #A0AEC0;">Items: ${e.value}</div>`:""}
    ${e.hasChildren?'<div style="color: #68D391;">âœ“ Has children</div>':""}
  `,i=window.innerWidth,a=window.innerHeight,l=220,c=90;let d=r.clientX+10,u=r.clientY-10;d+l>i&&(d=r.clientX-l-10),u+c>a&&(u=r.clientY-c-10),d=Math.max(10,Math.min(d,i-l-10)),u=Math.max(10,Math.min(u,a-c-10)),t.html(s).style("visibility","visible").style("left",d+"px").style("top",u+"px")}function P$(t){t.style("visibility","hidden")}function N$(t,e,r,n){return t.append("g").attr("class","nodes").selectAll("circle").data(e).enter().append("circle").attr("r",i=>i.r||10).attr("fill",C5).attr("stroke",Tv).attr("stroke-width",2).style("cursor","pointer").on("click",(i,a)=>{console.log("[D3 Helpers] Circle clicked:",a.data.name,"depth:",a.depth,"data:",a.data),i.stopPropagation(),r==null||r(a)}).on("mouseover",(i,a)=>{Jr(i.target).attr("stroke-width",3).attr("stroke","#E53E3E"),n==null||n(a)}).on("mouseout",(i,a)=>{Jr(i.target).attr("stroke-width",2).attr("stroke",Tv(a)),n==null||n(null)})}function D$(t,e,r=!0){if(!r)return null;const n=e.filter(i=>{const a=i.r||0,l=i.children&&i.children.length>0,c=i.data.type,d=i.data.name||"";return i.depth===0?a>=15:i.depth===1?c==="entity"?a>=20:c==="token"||c==="collection"||c==="taxonomy"||c==="dimension"||c==="component"||c==="tokenOverride"?a>=18:a>=25&&d.length>0:i.depth===2?c==="entity"?a>=25:c==="token"||c==="collection"||c==="taxonomy"||c==="dimension"||c==="component"||c==="tokenOverride"?a>=22:a>=30&&l:i.depth>=3?a>=35&&l&&d.length>0:!1});return t.append("g").attr("class","labels").selectAll("text").data(n).enter().append("text").style("font-size",i=>{const a=i.r||0,l=i.depth||0;return l===0?Math.max(16,Math.min(24,a/3))+"px":l===1?Math.max(12,Math.min(18,a/2.5))+"px":l===2?Math.max(10,Math.min(14,a/3))+"px":l>=3?Math.max(8,Math.min(12,a/4))+"px":"10px"}).style("font-weight","bold").style("text-anchor","middle").style("pointer-events","none").style("fill",i=>i.depth===0?"#E2E8F0":"white").style("text-shadow",i=>i.depth===0?"2px 2px 4px rgba(0,0,0,0.9)":"1px 1px 2px rgba(0,0,0,0.8)").attr("dy",i=>i.depth===0?-((i.r||0)+25):"0.35em").text(i=>{const a=i.data.name||"",l=i.r||0,c=i.depth||0;let d;return c===0?d=Math.max(15,Math.min(25,l/2)):c===1?d=Math.max(12,Math.min(18,l/2.5)):c===2?d=Math.max(8,Math.min(14,l/3)):d=Math.max(6,Math.min(10,l/4)),a.length>d?a.substring(0,Math.floor(d))+"...":a}).style("opacity",i=>{const a=i.r||0,l=i.children&&i.children.length>0,c=i.data.type,d=i.depth||0,u=i.data.name||"";return d===0?a>=15?1:0:d===1?c==="entity"?a>=20?1:a>=15?.7:0:c==="token"||c==="collection"||c==="taxonomy"||c==="dimension"||c==="component"||c==="tokenOverride"?a>=18?1:a>=15?.6:0:a>=25&&u.length>0?1:0:d===2?c==="entity"?a>=25?1:a>=20?.8:0:c==="token"||c==="collection"||c==="taxonomy"||c==="dimension"||c==="component"||c==="tokenOverride"?a>=22?1:a>=18?.6:0:a>=30&&l?.8:0:d>=3&&a>=35&&l&&u.length>0?.6:0})}function R$(t,e){t.attr("cx",r=>r.x||0).attr("cy",r=>r.y||0),e&&e.attr("x",r=>r.x||0).attr("y",r=>r.y||0).attr("dy",r=>r.depth===0?-((r.r||0)+25):"0.35em")}function k5(t){const e=t.node();return e?new XMLSerializer().serializeToString(e):""}function O$(t){return new Promise(e=>{if(!t.node()){e("");return}const n=k5(t),s=document.createElement("canvas"),i=s.getContext("2d"),a=new Image;a.onload=()=>{s.width=a.width,s.height=a.height,i==null||i.drawImage(a,0,0),e(s.toDataURL("image/png"))},a.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n)))})}const I5=M.forwardRef((t,e)=>{const{data:r,onNodeClick:n,onZoomChange:s,width:i=800,height:a=600,showLabels:l=!0,showBreadcrumbs:c=!0,interactive:d=!0}=t,u=M.useRef(null),m=M.useRef(null),[g,y]=M.useState({isLoading:!1,error:null,zoomState:{currentPath:[],zoomLevel:1,focusedNode:null,breadcrumbs:[]},selectedNode:null,hoveredNode:null}),v=M.useRef({svg:null,container:null,circles:null,labels:null,zoom:null,tooltip:null,focus:null}),I=M.useCallback(()=>{if(!(!u.current||!r))try{y(R=>({...R,isLoading:!0,error:null})),Jr(u.current).selectAll("*").remove();const C=Jr(u.current),T=C.append("g");v.current.svg=C,v.current.container=T,v.current.tooltip=M$();const P=j$(r),_=E$(P,i,a);if(v.current.focus=_,d){const R=S5().scaleExtent([1,8]).on("zoom",G=>{(!v.current.focus||v.current.focus.depth===0)&&T.attr("transform",G.transform)});C.call(R),v.current.zoom=R}S(_),y(R=>({...R,isLoading:!1}))}catch(C){console.error("[CirclePack] Error initializing visualization:",C),y(T=>({...T,isLoading:!1,error:C instanceof Error?C.message:"Unknown error"}))}},[r,i,a,d,s]),S=M.useCallback(C=>{if(console.log("[CirclePack] Updating visualization for focus:",C.data.name,"depth:",C.depth),!v.current.container)return;const T=v.current.container;T.selectAll("*").remove();const P=C.descendants();console.log("[CirclePack] Rendering nodes:",P.map(R=>({name:R.data.name,depth:R.depth,r:R.r}))),v.current.circles=N$(T,P,b,R=>{y(G=>({...G,hoveredNode:R}))}),v.current.circles&&v.current.tooltip&&v.current.circles.on("mouseover",(R,G)=>{A$(v.current.tooltip,G.data,R)}).on("mouseout",()=>{P$(v.current.tooltip)}),v.current.labels=D$(T,P,l),R$(v.current.circles,v.current.labels);const _=A(C);y(R=>({...R,zoomState:{...R.zoomState,focusedNode:C,breadcrumbs:_.map(G=>({name:G.name,type:G.node.data.type}))}}))},[l]),b=M.useCallback(C=>{var T,P;if(console.log("[CirclePack] Node clicked:",C.data.name,"depth:",C.depth,"children:",(T=C.children)==null?void 0:T.length),console.log("[CirclePack] Node data:",C.data),console.log("[CirclePack] Node children:",C.children),console.log("[CirclePack] Node data children:",C.data.children),!C.children||C.children.length===0){console.log("[CirclePack] Leaf node clicked, calling callback"),n==null||n(C);return}if(console.log("[CirclePack] Zooming into node:",C.data.name),v.current.svg&&v.current.container){const _=v.current.container,R=Ua.translate(i/2,a/2).scale(80/(C.r||1)).translate(-(C.x||0),-(C.y||0));console.log("[CirclePack] Transform calculated:",{x:R.x,y:R.y,k:R.k,nodeX:C.x,nodeY:C.y,nodeR:C.r}),_.transition().duration(750).attr("transform",`translate(${R.x},${R.y})scale(${R.k})`),console.log("[CirclePack] Transform applied to container"),console.log("[CirclePack] Updating focus from:",(P=v.current.focus)==null?void 0:P.data.name,"to:",C.data.name),v.current.focus=C,S(C)}},[i,a,n,S]),k=M.useCallback(()=>{if(console.log("[CirclePack] Background clicked, resetting to root"),!v.current.focus){console.log("[CirclePack] No focus node, nothing to reset");return}let C=v.current.focus;for(;C.parent;)C=C.parent;if(C===v.current.focus){console.log("[CirclePack] Already at root, no action needed");return}console.log("[CirclePack] Resetting from",v.current.focus.data.name,"to",C.data.name),v.current.svg&&v.current.container&&(v.current.container.transition().duration(750).attr("transform","translate(0,0)scale(1)"),v.current.focus=C,S(C))},[S]),A=M.useCallback(C=>{const T=[];let P=C;for(;P.parent;)T.unshift({name:P.data.name,node:P}),P=P.parent;return T},[]);return M.useEffect(()=>{I()},[I]),M.useEffect(()=>()=>{v.current.tooltip&&v.current.tooltip.remove()},[]),M.useImperativeHandle(e,()=>({zoomIn:()=>{if(v.current.svg&&v.current.zoom){const C=If(v.current.svg.node()),T=Math.min(C.k*1.5,8),P=C.scale(T);v.current.svg.transition().duration(300).call(v.current.zoom.transform,P)}},zoomOut:()=>{if(v.current.svg&&v.current.zoom){const C=If(v.current.svg.node()),T=Math.max(C.k/1.5,1),P=C.scale(T);v.current.svg.transition().duration(300).call(v.current.zoom.transform,P)}},resetView:()=>{if(v.current.svg&&v.current.container&&(v.current.container.transition().duration(750).attr("transform","translate(0,0)scale(1)"),v.current.focus&&v.current.focus.parent)){let C=v.current.focus;for(;C.parent;)C=C.parent;v.current.focus=C,S(C)}},zoomToNode:C=>{console.log("[CirclePack] Zoom to node:",C)},exportVisualization:async C=>{if(!v.current.svg)return;const T=(P,_,R)=>{const G=new Blob([P],{type:R}),ne=URL.createObjectURL(G),he=document.createElement("a");he.href=ne,he.download=_,document.body.appendChild(he),he.click(),document.body.removeChild(he),URL.revokeObjectURL(ne)};switch(C){case"svg":{const P=k5(v.current.svg);T(P,"circle-pack.svg","image/svg+xml");break}case"png":{const P=await O$(v.current.svg);T(P,"circle-pack.png","image/png");break}case"json":{const P=JSON.stringify(r,null,2);T(P,"circle-pack-data.json","application/json");break}}},getZoomState:()=>g.zoomState})),g.isLoading?o.jsx(z,{width:i,height:a,display:"flex",alignItems:"center",justifyContent:"center",children:o.jsxs(zt,{status:"info",children:[o.jsx(Lt,{}),o.jsx(tn,{children:"Loading circle pack visualization..."})]})}):g.error?o.jsx(z,{width:i,height:a,display:"flex",alignItems:"center",justifyContent:"center",children:o.jsxs(zt,{status:"error",children:[o.jsx(Lt,{}),o.jsx(tn,{children:g.error})]})}):o.jsxs(z,{ref:m,width:i,height:a,position:"relative",children:[o.jsx("svg",{ref:u,width:i,height:a,style:{cursor:d?"grab":"default"},onClick:C=>{C.target===C.currentTarget&&k()},children:o.jsx("rect",{width:i,height:a,fill:"transparent",style:{cursor:d?"grab":"default"},onClick:C=>{C.stopPropagation(),k()}})}),c&&g.zoomState.breadcrumbs.length>0&&o.jsx(z,{position:"absolute",top:2,left:2,bg:"white",px:2,py:1,borderRadius:"md",boxShadow:"sm",fontSize:"sm",children:g.zoomState.breadcrumbs.map((C,T)=>o.jsxs("span",{children:[T>0&&" > ",C.name]},T))})]})});I5.displayName="CirclePack";const Ev=({title:t,description:e,children:r,toolbar:n,legend:s,isLoading:i=!1,error:a,onRetry:l,height:c=600,width:d="100%"})=>i?o.jsx(z,{width:d,height:c,p:8,children:o.jsx(Wu,{height:"100%",children:o.jsxs(ce,{spacing:4,children:[o.jsx(kn,{size:"xl",color:"blue.500"}),o.jsx(E,{color:"gray.600",children:"Loading visualization..."})]})})}):a?o.jsx(z,{width:d,height:c,p:6,children:o.jsxs(zt,{status:"error",borderRadius:"md",children:[o.jsx(Lt,{}),o.jsxs(ce,{align:"start",spacing:2,flex:1,children:[o.jsx(tn,{fontWeight:"medium",children:"Failed to load visualization"}),o.jsx(E,{fontSize:"sm",color:"gray.600",children:a}),l&&o.jsx(Oe,{size:"sm",leftIcon:o.jsx(Hf,{size:16}),onClick:l,colorScheme:"red",variant:"outline",children:"Retry"})]})]})}):o.jsxs(z,{width:d,children:[(t||e)&&o.jsxs(ce,{align:"start",spacing:2,mb:4,children:[t&&o.jsx(Tt,{size:"md",color:"gray.800",children:t}),e&&o.jsx(E,{fontSize:"sm",color:"gray.600",children:e})]}),n&&o.jsx(z,{mb:4,children:n}),o.jsxs(le,{align:"start",spacing:4,children:[o.jsx(z,{flex:1,height:c,overflow:"hidden",position:"relative",children:r}),s&&o.jsx(z,{flexShrink:0,children:s})]})]}),_$=({onZoomIn:t,onZoomOut:e,onReset:r,onExport:n,onLayoutChange:s,availableLayouts:i=[],currentLayout:a,showExport:l=!0,showLayoutSelector:c=!0})=>o.jsxs(le,{spacing:2,mb:4,children:[o.jsx(Cn,{label:"Zoom In",children:o.jsx(Bt,{"aria-label":"Zoom In",icon:o.jsx(Wk,{size:16}),size:"sm",onClick:t})}),o.jsx(Cn,{label:"Zoom Out",children:o.jsx(Bt,{"aria-label":"Zoom Out",icon:o.jsx(Jk,{size:16}),size:"sm",onClick:e})}),o.jsx(Cn,{label:"Reset View",children:o.jsx(Bt,{"aria-label":"Reset View",icon:o.jsx(vc,{size:16}),size:"sm",onClick:r})}),c&&i.length>0&&o.jsxs(le,{spacing:2,ml:4,children:[o.jsx(H6,{size:16}),o.jsx(Kt,{size:"sm",value:a,onChange:d=>s==null?void 0:s(d.target.value),width:"120px",children:i.map(d=>o.jsx("option",{value:d,children:d.charAt(0).toUpperCase()+d.slice(1)},d))})]}),l&&n&&o.jsxs(sl,{children:[o.jsx(Cn,{label:"Export Visualization",children:o.jsx(Od,{as:Bt,"aria-label":"Export",icon:o.jsx(xu,{size:16}),size:"sm",ml:4})}),o.jsxs(ol,{children:[o.jsx(ds,{onClick:()=>n("png"),children:"Export as PNG"}),o.jsx(ds,{onClick:()=>n("svg"),children:"Export as SVG"}),o.jsx(ds,{onClick:()=>n("json"),children:"Export Data (JSON)"})]})]})]}),F$=({items:t,title:e="Legend",position:r="right",orientation:n="vertical"})=>{const s=l=>{const c={size:12,color:l.color,fill:l.color};switch(l.shape){case"square":return o.jsx(Ck,{...c});case"line":return o.jsx(Yu,{...c});case"circle":default:return o.jsx(Lf,{...c})}},i=l=>o.jsxs(le,{spacing:2,cursor:l.onClick?"pointer":"default",opacity:l.visible===!1?.5:1,onClick:()=>{var c;return(c=l.onClick)==null?void 0:c.call(l,l.id)},_hover:l.onClick?{bg:"gray.50"}:void 0,px:2,py:1,borderRadius:"sm",children:[s(l),o.jsx(E,{fontSize:"sm",color:"gray.700",children:l.label}),l.count!==void 0&&o.jsx(wt,{size:"sm",colorScheme:"gray",children:l.count})]},l.id),a=o.jsxs(z,{children:[e&&o.jsx(Tt,{size:"sm",mb:3,color:"gray.700",children:e}),n==="vertical"?o.jsx(ce,{align:"start",spacing:1,children:t.map(i)}):o.jsx(Qs,{columns:Math.ceil(t.length/2),spacing:2,children:t.map(i)})]});return o.jsx(z,{p:4,borderWidth:1,borderRadius:"md",bg:"white",shadow:"sm",minW:n==="vertical"?"200px":"auto",maxW:n==="vertical"?"250px":"auto",children:a})};class X0{constructor(e){rt(this,"transformerName");rt(this,"version","1.0.0");this.transformerName=e}validateInput(e){return e?!0:(console.error(`[${this.transformerName}] Input is null or undefined`),!1)}applyFilters(e,r){if(!r||!e)return e;let n=[...e];return r.tokenTypes&&r.tokenTypes.length>0&&(n=n.filter(s=>r.tokenTypes.includes(s.resolvedValueTypeId||s.type))),r.collections&&r.collections.length>0&&(n=n.filter(s=>{const i=s.collectionIds||[];return r.collections.some(a=>i.includes(a))})),r.platforms&&r.platforms.length>0&&(n=n.filter(s=>r.platforms.includes(s.platformId))),r.themes&&r.themes.length>0&&(n=n.filter(s=>r.themes.includes(s.themeId))),r.resolvedValueTypes&&r.resolvedValueTypes.length>0&&(n=n.filter(s=>r.resolvedValueTypes.includes(s.resolvedValueTypeId))),r.minDependencyDepth!==void 0&&(n=n.filter(s=>(s.dependencyDepth||0)>=r.minDependencyDepth)),r.maxDependencyDepth!==void 0&&(n=n.filter(s=>(s.dependencyDepth||0)<=r.maxDependencyDepth)),n}enrichWithMetadata(e,r){const n={...e};return r&&(n.metadata={...r,transformedBy:this.transformerName,transformedAt:new Date().toISOString(),version:this.version}),n}createVisualizationMetadata(e,r,n,s){return{title:`${this.transformerName} Visualization`,description:`Generated by ${this.transformerName} transformer`,generatedAt:new Date().toISOString(),dataSource:e,schemaVersion:this.version,tokenCount:r,dependencyCount:n,...s}}createResult(e,r,n,s){return{data:e,metadata:r,...n&&n.length>0&&{errors:n},...s&&s.length>0&&{warnings:s}}}logProgress(e,r){console.log(`[${this.transformerName}] ${e}`,r||"")}handleError(e,r){throw console.error(`[${this.transformerName}] Error in ${r}:`,e),new Error(`${this.transformerName} failed during ${r}: ${e.message}`)}}class V${constructor(){rt(this,"tokens",[]);rt(this,"dependencyMap",new Map);rt(this,"reverseDependencyMap",new Map);rt(this,"memoizedDepths",new Map);rt(this,"memoizedCircularPaths",new Map)}async analyzeDependencies(e){try{console.log("[TokenDependencyAnalyzer] Starting dependency analysis"),this.tokens=e.tokens||[],this.buildDependencyMaps();const r=this.detectCircularDependencies(),n=this.analyzeDepths(),s=this.findIsolatedTokens(),i=this.findRootTokens(),a=this.findLeafTokens(),l=this.findMostReferencedTokens(),c=this.findDeepestDependencyChains(),d=this.calculateComplexityMetrics(),u=this.generateRecommendations(r,n),m={totalTokens:this.tokens.length,totalDependencies:this.getTotalDependencyCount(),circularDependencies:r,maxDependencyDepth:Math.max(...n.map(g=>g.depth),0),averageDependencyDepth:this.calculateAverageDependencyDepth(n),isolatedTokens:s,rootTokens:i,leafTokens:a,mostReferencedTokens:l,deepestDependencyChains:c,complexityMetrics:d,recommendations:u};return console.log("[TokenDependencyAnalyzer] Analysis completed:",{totalTokens:m.totalTokens,totalDependencies:m.totalDependencies,circularCount:m.circularDependencies.length,maxDepth:m.maxDependencyDepth}),m}catch(r){throw console.error("[TokenDependencyAnalyzer] Error during analysis:",r),r}}analyzeTokenDependencies(e){const r=this.tokens.find(u=>u.id===e);if(!r)return console.warn(`[TokenDependencyAnalyzer] Token not found: ${e}`),null;const n=this.getTokenDependencies(e),s=this.getTokenDependents(e),i=this.calculateDependencyDepth(e),a=s.length,l=this.findCircularPathsForToken(e),c=l.length>0,d=this.calculateBlastRadius(e);return{tokenId:e,tokenName:r.displayName,dependencies:n,dependents:s,dependencyDepth:i,usageCount:a,hasCircularDependency:c,circularDependencyPaths:c?l:void 0,blastRadius:d}}validateDependencies(){const e=[],r=[],n=[],s=this.detectCircularDependencies();return this.tokens.forEach(a=>{var l;(l=a.valuesByMode)==null||l.forEach(c=>{const d=c.value;if(d&&typeof d=="object"&&"tokenId"in d){const u=d.tokenId;this.tokens.find(g=>g.id===u)||(n.push({tokenId:a.id,tokenName:a.displayName,referencedTokenId:u,modeId:c.modeId,context:`Mode: ${c.modeId}`}),e.push({tokenId:a.id,tokenName:a.displayName,errorType:"missing_reference",message:`Token references non-existent token: ${u}`,referencedTokenId:u}))}})}),this.tokens.forEach(a=>{const l=this.calculateDependencyDepth(a.id);l>5&&r.push({tokenId:a.id,tokenName:a.displayName,warningType:"deep_nesting",message:`Token has deep dependency nesting (depth: ${l})`,details:{depth:l}})}),this.findIsolatedTokens().forEach(a=>{const l=this.tokens.find(c=>c.id===a);l&&r.push({tokenId:l.id,tokenName:l.displayName,warningType:"unused_token",message:"Token is not referenced by any other tokens",details:{isolated:!0}})}),{isValid:e.length===0&&s.length===0,errors:e,warnings:r,circularDependencies:s,unresolvedReferences:n}}buildDependencyMaps(){this.dependencyMap.clear(),this.reverseDependencyMap.clear(),this.memoizedDepths.clear(),this.memoizedCircularPaths.clear(),this.tokens.forEach(e=>{var n;const r=new Set;(n=e.valuesByMode)==null||n.forEach(s=>{const i=s.value;if(i&&typeof i=="object"&&"tokenId"in i){const a=i.tokenId;r.add(a),this.reverseDependencyMap.has(a)||this.reverseDependencyMap.set(a,new Set),this.reverseDependencyMap.get(a).add(e.id)}}),this.dependencyMap.set(e.id,r)}),console.log("[TokenDependencyAnalyzer] Built dependency maps:",{totalTokens:this.tokens.length,dependencyMapSize:this.dependencyMap.size,reverseDependencyMapSize:this.reverseDependencyMap.size})}calculateDependencyDepth(e,r=new Set){if(this.memoizedDepths.has(e))return this.memoizedDepths.get(e);if(r.has(e))return 0;r.add(e);const n=this.dependencyMap.get(e)||new Set;if(n.size===0)return this.memoizedDepths.set(e,0),0;let s=0;for(const a of n){const l=this.calculateDependencyDepth(a,new Set(r));s=Math.max(s,l)}const i=s+1;return this.memoizedDepths.set(e,i),i}detectCircularDependencies(){const e=[],r=new Set,n=new Set,s=(i,a)=>{if(n.has(i)){const c=a.indexOf(i),d=[...a.slice(c),i],u=`circular-${d.join("-")}`,m=d.map(g=>{var y;return((y=this.tokens.find(v=>v.id===g))==null?void 0:y.displayName)||g});return e.push({id:u,tokenIds:d,dependencyChain:d,severity:"error",description:`Circular dependency detected: ${m.join(" â†’ ")}`,affectedPlatforms:[],affectedThemes:[],suggestedResolution:`Break the circular dependency by removing one of the references in the chain: ${m.join(" â†’ ")}`}),!0}if(r.has(i))return!1;r.add(i),n.add(i),a.push(i);const l=this.dependencyMap.get(i)||new Set;for(const c of l)s(c,[...a]);return n.delete(i),!1};return this.tokens.forEach(i=>{r.has(i.id)||s(i.id,[])}),e}getTokenDependencies(e){return[]}getTokenDependents(e){return[]}findIsolatedTokens(){return this.tokens.filter(e=>{const r=(this.dependencyMap.get(e.id)||new Set).size===0,n=(this.reverseDependencyMap.get(e.id)||new Set).size===0;return r&&n}).map(e=>e.id)}findRootTokens(){return this.tokens.filter(e=>(this.reverseDependencyMap.get(e.id)||new Set).size===0).map(e=>e.id)}findLeafTokens(){return this.tokens.filter(e=>(this.dependencyMap.get(e.id)||new Set).size===0).map(e=>e.id)}findMostReferencedTokens(){return this.tokens.map(e=>({tokenId:e.id,tokenName:e.displayName,referenceCount:(this.reverseDependencyMap.get(e.id)||new Set).size})).filter(e=>e.referenceCount>0).sort((e,r)=>r.referenceCount-e.referenceCount).slice(0,10)}findDeepestDependencyChains(){return[]}calculateComplexityMetrics(){const e=this.tokens.map(n=>(this.dependencyMap.get(n.id)||new Set).size),r={};return this.tokens.forEach(n=>{const s=this.calculateDependencyDepth(n.id);r[s]=(r[s]||0)+1}),{averageReferences:e.reduce((n,s)=>n+s,0)/e.length,maxReferences:Math.max(...e),dependencyDistribution:r}}generateRecommendations(e,r){const n=[];e.forEach(i=>{n.push({type:"circular_dependency",severity:"error",title:"Circular Dependency Detected",description:i.description,affectedTokens:i.tokenIds,suggestedAction:i.suggestedResolution||"Break the circular dependency chain",estimatedEffort:"medium"})});const s=r.filter(i=>i.depth>5);return s.length>0&&n.push({type:"deep_nesting",severity:"warning",title:"Deep Token Dependencies Detected",description:`${s.length} tokens have dependency depth greater than 5 levels`,affectedTokens:s.map(i=>i.tokenId),suggestedAction:"Consider flattening the dependency hierarchy by creating intermediate tokens",estimatedEffort:"high"}),n}getTotalDependencyCount(){let e=0;return this.dependencyMap.forEach(r=>e+=r.size),e}analyzeDepths(){return this.tokens.map(e=>({tokenId:e.id,tokenName:e.displayName,depth:this.calculateDependencyDepth(e.id),dependencyChain:[],isLeaf:(this.dependencyMap.get(e.id)||new Set).size===0,isRoot:(this.reverseDependencyMap.get(e.id)||new Set).size===0}))}calculateAverageDependencyDepth(e){return e.length===0?0:e.reduce((n,s)=>n+s.depth,0)/e.length}findCircularPathsForToken(e){return[]}calculateBlastRadius(e){const r=Array.from(this.reverseDependencyMap.get(e)||new Set);return{directlyAffected:r,indirectlyAffected:[],totalAffected:r.length,maxDepth:1,estimatedImpact:r.length>10?"high":r.length>5?"medium":"low",affectedPlatforms:[],affectedThemes:[],affectedCollections:[]}}}class $$ extends X0{constructor(){super("TokenDependencyTransformer");rt(this,"analyzer");this.analyzer=new V$}async transformData(r,n){try{if(this.logProgress("Starting token dependency transformation"),!this.validateInput(r))throw new Error("Invalid token system input");const s=r.tokens||[],i=r.resolvedValueTypes||[];this.logProgress("Analyzing dependencies",{tokenCount:s.length,valueTypeCount:i.length});const a=await this.analyzer.analyzeDependencies(r);let l=s;n!=null&&n.filters&&(l=this.applyFilters(s,n.filters),this.logProgress("Applied filters",{originalCount:s.length,filteredCount:l.length}));const c=this.buildTokenNodes(l,i,a),d=this.buildDependencyEdges(l,c),u=this.buildClusters(c,i,n),m=this.calculateStatistics(c,d,a),g=a.circularDependencies.filter(v=>v.tokenIds.some(I=>l.some(S=>S.id===I))),y={nodes:c,edges:d,clusters:u,circularDependencies:g,statistics:m};return this.logProgress("Transformation completed successfully",{nodeCount:c.length,edgeCount:d.length,clusterCount:u.length,circularDependencies:g.length}),y}catch(s){this.handleError(s,"transformData")}}validateInput(r){return super.validateInput(r)?!r.tokens||!Array.isArray(r.tokens)?(console.error(`[${this.transformerName}] Invalid tokens array`),!1):!r.resolvedValueTypes||!Array.isArray(r.resolvedValueTypes)?(console.error(`[${this.transformerName}] Invalid resolvedValueTypes array`),!1):!0:!1}buildTokenNodes(r,n,s){return r.map(i=>{var u,m,g;const a=n.find(y=>y.id===i.resolvedValueTypeId),l=this.analyzer.analyzeTokenDependencies(i.id);let c="base";return((u=i.valuesByMode)==null?void 0:u.some(y=>{const v=y.value;return v&&typeof v=="object"&&"tokenId"in v}))&&(c="alias"),l!=null&&l.hasCircularDependency&&(c="circular"),{id:i.id,name:i.displayName,displayName:i.displayName,tokenId:i.id,type:c,resolvedValueTypeId:i.resolvedValueTypeId,resolvedValueTypeName:(a==null?void 0:a.displayName)||"Unknown",resolvedValueTypeCategory:(a==null?void 0:a.type)||"Unknown",collectionIds:i.collectionIds||[],dependencyDepth:(l==null?void 0:l.dependencyDepth)||0,usageCount:(l==null?void 0:l.usageCount)||0,hasCircularDependency:(l==null?void 0:l.hasCircularDependency)||!1,value:(g=(m=i.valuesByMode)==null?void 0:m[0])==null?void 0:g.value}})}buildDependencyEdges(r,n){const s=[],i=new Set;return r.forEach(a=>{var c;const l=n.find(d=>d.id===a.id);l&&((c=a.valuesByMode)==null||c.forEach(d=>{const u=d.value;if(u&&typeof u=="object"&&"tokenId"in u){const m=u.tokenId,g=n.find(y=>y.id===m);if(g){const y=`${l.id}->${g.id}`;if(!i.has(y)){i.add(y);let v="direct";l.hasCircularDependency&&g.hasCircularDependency&&(v="circular"),s.push({id:y,source:l,target:g,type:v,strength:1,distance:this.calculateEdgeDistance(l,g),platformSpecific:!1,themeSpecific:!1})}}}}))}),s}buildClusters(r,n,s){const i=[],a=new Map;return r.forEach(l=>{const c=l.resolvedValueTypeId;a.has(c)||a.set(c,[]),a.get(c).push(l)}),a.forEach((l,c)=>{const d=n.find(u=>u.id===c);d&&l.length>1&&i.push({id:`cluster-${c}`,type:"resolvedValueType",name:d.displayName,nodeIds:l.map(u=>u.id),color:this.getValueTypeColor(d.type||"Unknown")})}),i}calculateStatistics(r,n,s){var c;r.map(d=>d.usageCount);const i=r.map(d=>d.dependencyDepth),a=r.filter(d=>d.usageCount>0).sort((d,u)=>u.usageCount-d.usageCount)[0],l=r.sort((d,u)=>u.dependencyDepth-d.dependencyDepth)[0];return{totalTokens:r.length,totalDependencies:n.length,circularDependencies:((c=s.circularDependencies)==null?void 0:c.length)||0,maxDependencyDepth:Math.max(...i,0),avgDependencyDepth:i.reduce((d,u)=>d+u,0)/i.length||0,isolatedTokens:r.filter(d=>d.usageCount===0&&d.dependencyDepth===0).length,mostReferencedToken:a?{tokenId:a.id,name:a.name,referenceCount:a.usageCount}:void 0,deepestDependencyChain:l?{tokenIds:[l.id],depth:l.dependencyDepth}:void 0}}calculateEdgeDistance(r,n){let s=100;return r.resolvedValueTypeId!==n.resolvedValueTypeId&&(s+=50),r.collectionIds.filter(a=>n.collectionIds.includes(a)).length>0&&(s-=25),Math.max(50,s)}getValueTypeColor(r){return{COLOR:"#48BB78",DIMENSION:"#4299E1",SPACING:"#667EEA",FONT_FAMILY:"#9F7AEA",FONT_WEIGHT:"#ED64A6",FONT_SIZE:"#F56565",LINE_HEIGHT:"#ED8936",LETTER_SPACING:"#ECC94B",DURATION:"#38B2AC",CUBIC_BEZIER:"#4FD1C5",BLUR:"#4A5568",SPREAD:"#718096",RADIUS:"#A0AEC0"}[r]||"#A0AEC0"}}class z$ extends X0{constructor(){super("ChordDataTransformer")}async transformData(e,r){try{if(this.logProgress("Starting chord diagram transformation"),!this.validateInput(e))throw new Error("Invalid token system input");const n=e.tokens||[],s=this.extractModes(e),i=e.platforms||[];this.logProgress("Analyzing mode and platform relationships",{tokenCount:n.length,modeCount:s.length,platformCount:i.length,tokenSample:n.slice(0,2).map(y=>({id:y.id,valuesByMode:y.valuesByMode})),modesSample:s.slice(0,3),platformsSample:i.slice(0,2)});const a=this.analyzeModeRelationships(n,s),l=this.analyzePlatformDeviations(n,i,s);if(s.length===0&&i.length===0)return this.logProgress("Warning: No modes or platforms found, creating minimal chord diagram"),{nodes:[{id:"tokens-global",name:"All Tokens",type:"token-value-group",tokenIds:n.map(v=>v.id),valueCount:n.length,color:"#A0AEC0",conflicts:0}],links:[],matrix:[[0]],modeAnalysis:a,platformAnalysis:l,statistics:this.calculateChordStatistics(n,s,i,a,l,[])};const c=this.buildChordNodes(n,s,i,a,l),d=this.buildChordLinks(n,s,i,c),u=this.buildAdjacencyMatrix(c,d),m=this.calculateChordStatistics(n,s,i,a,l,d),g={nodes:c,links:d,matrix:u,modeAnalysis:a,platformAnalysis:l,statistics:m};return this.logProgress("Chord diagram transformation completed successfully",{nodeCount:c.length,linkCount:d.length,conflicts:m.totalConflicts}),g}catch(n){this.handleError(n,"transformData")}}extractModes(e){var n;const r=[];return(n=e.dimensions)==null||n.forEach(s=>{var i;(i=s.modes)==null||i.forEach(a=>{r.find(l=>l.id===a.id)||r.push(a)})}),r}analyzeModeRelationships(e,r){const n=[],s=this.buildModeConflictMatrix(e,r),i=this.findVolatileTokens(e,r);for(let a=0;a<r.length;a++)for(let l=a+1;l<r.length;l++){const c=r[a],d=r[l],u=this.calculateModeCoupling(e,c,d);u.couplingStrength>.3&&n.push(u)}return{totalModes:r.length,modeCouplings:n,conflictMatrix:s,mostVolatileTokens:i}}buildModeConflictMatrix(e,r){const n=r.map(i=>i.id),s=Array(r.length).fill(null).map(()=>Array(r.length).fill(0));return e.forEach(i=>{var l;const a=new Map;(l=i.valuesByMode)==null||l.forEach(c=>{c.modeIds.forEach(d=>{a.set(d,c.value)})});for(let c=0;c<r.length;c++)for(let d=c+1;d<r.length;d++){const u=a.get(r[c].id),m=a.get(r[d].id);u&&m&&!this.valuesEqual(u,m)&&(s[c][d]++,s[d][c]++)}}),{modeIds:n,conflicts:s}}calculateModeCoupling(e,r,n){let s=0,i=0;const a=[];e.forEach(c=>{var g,y,v,I,S,b;const d=(y=(g=c.valuesByMode)==null?void 0:g.find(k=>k.modeIds.includes(r.id)))==null?void 0:y.value,u=(I=(v=c.valuesByMode)==null?void 0:v.find(k=>k.modeIds.includes(n.id)))==null?void 0:I.value,m=(b=(S=c.valuesByMode)==null?void 0:S[0])==null?void 0:b.value;if(d&&u&&m){s++;const k=!this.valuesEqual(d,m),A=!this.valuesEqual(u,m);k&&A&&(i++,a.push(c.id))}});const l=s>0?i/s:0;return{modeIds:[r.id,n.id],modeNames:[r.name,n.name],couplingStrength:l,sharedTokenIds:a,couplingType:l>.8?"always-together":l>.5?"conditional":"inverse"}}findVolatileTokens(e,r){return e.map(n=>{var c,d,u,m;const s=new Set;let i=0;(c=n.valuesByMode)==null||c.forEach(g=>{s.add(JSON.stringify(g.value)),g.platformOverrides&&(i+=g.platformOverrides.length)});const a=((d=n.valuesByMode)==null?void 0:d.length)||1,l=a>1?(s.size-1)/Math.max(1,a-1):0;return{tokenId:n.id,tokenName:n.displayName,changeFrequency:l,uniqueValues:s.size,mostCommonValue:(m=(u=n.valuesByMode)==null?void 0:u[0])==null?void 0:m.value,platformOverrides:i}}).filter(n=>n.changeFrequency>.1).sort((n,s)=>s.changeFrequency-n.changeFrequency).slice(0,20)}analyzePlatformDeviations(e,r,n){const s=[];r.forEach(a=>{const l=this.calculatePlatformDeviation(e,a,n);s.push(l)});const i=this.calculatePlatformComplexity(s);return{totalPlatforms:r.length,platformDeviations:s,overridePatterns:[],complexityScore:i}}calculatePlatformDeviation(e,r,n){const s=[];return{platformId:r.id,platformName:r.displayName,deviationScore:0,affectedTokenIds:s,uniqueOverrides:0,inheritedValues:0}}buildChordNodes(e,r,n,s,i){const a=[];return r.forEach((l,c)=>{var m;const d=e.filter(g=>{var y;return(y=g.valuesByMode)==null?void 0:y.some(v=>v.modeIds.includes(l.id))}),u=((m=s.conflictMatrix.conflicts[c])==null?void 0:m.reduce((g,y)=>g+y,0))||0;a.push({id:`mode-${l.id}`,name:l.name,type:"mode",modeId:l.id,tokenIds:d.map(g=>g.id),valueCount:d.length,color:this.getModeColor(c),conflicts:u})}),n.forEach((l,c)=>{const d=i.platformDeviations.find(u=>u.platformId===l.id);a.push({id:`platform-${l.id}`,name:l.displayName,type:"platform",platformId:l.id,tokenIds:(d==null?void 0:d.affectedTokenIds)||[],valueCount:(d==null?void 0:d.uniqueOverrides)||0,color:this.getPlatformColor(c),conflicts:Math.round(((d==null?void 0:d.deviationScore)||0)*100)})}),a}buildChordLinks(e,r,n,s){const i=[];return r.forEach((a,l)=>{r.forEach((c,d)=>{if(l<d){const u=this.calculateModeCoupling(e,a,c);if(u.couplingStrength>.1){const m=s.find(y=>y.id===`mode-${a.id}`),g=s.find(y=>y.id===`mode-${c.id}`);m&&g&&i.push({source:m,target:g,value:u.couplingStrength*100,conflictType:"mode-coupling",tokenIds:u.sharedTokenIds,examples:[]})}}})}),i}buildAdjacencyMatrix(e,r){const n=e.length,s=Array(n).fill(null).map(()=>Array(n).fill(0));return r.forEach(i=>{const a=e.findIndex(c=>c.id===i.source.id),l=e.findIndex(c=>c.id===i.target.id);a!==-1&&l!==-1&&(s[a][l]=i.value,s[l][a]=i.value)}),s}calculateChordStatistics(e,r,n,s,i,a){const l=s.conflictMatrix.conflicts.flat().reduce((d,u)=>d+u,0)/2,c=[];return s.modeCouplings.length>r.length*.3&&c.push({type:"coupling-reduction",severity:"warning",title:"High Mode Coupling Detected",description:`${s.modeCouplings.length} strong mode couplings found, indicating potential over-complexity`,affectedItems:s.modeCouplings.flatMap(d=>d.modeNames),estimatedImpact:"medium",suggestedAction:"Consider consolidating highly coupled modes or restructuring token values"}),{totalTokens:e.length,totalModes:r.length,totalPlatforms:n.length,totalConflicts:l,avgConflictsPerToken:e.length>0?l/e.length:0,maxConflictsPerToken:Math.max(...s.mostVolatileTokens.map(d=>d.uniqueValues)),modeCouplingScore:s.modeCouplings.length>0?s.modeCouplings.reduce((d,u)=>d+u.couplingStrength,0)/s.modeCouplings.length:0,platformComplexityScore:i.complexityScore,recommendations:c}}valuesEqual(e,r){return JSON.stringify(e)===JSON.stringify(r)}calculatePlatformComplexity(e){return e.length===0?0:e.reduce((r,n)=>r+n.deviationScore,0)/e.length}getModeColor(e){const r=["#3182CE","#38A169","#D69E2E","#E53E3E","#9F7AEA","#00B5D8"];return r[e%r.length]}getPlatformColor(e){const r=["#2B6CB0","#2F855A","#B7791F","#C53030","#805AD5","#0987A0"];return r[e%r.length]}}const Ca=class Ca{constructor(){rt(this,"cache",new Map);rt(this,"CACHE_TTL",5*60*1e3);rt(this,"loadingPromises",new Map)}static getInstance(){return Ca.instance||(Ca.instance=new Ca),Ca.instance}async loadPlatformData(e){const r=`platform-${e}`;if(this.loadingPromises.has(r))return this.loadingPromises.get(r);if(this.isDataFresh(r)){const s=this.getCachedData(r);if(s)return console.log(`[DataAggregationService] Using cached platform data for ${e}`),s}const n=this.loadPlatformDataFromSource(e,r);this.loadingPromises.set(r,n);try{const s=await n;return this.loadingPromises.delete(r),s}catch(s){return this.loadingPromises.delete(r),console.error(`[DataAggregationService] Failed to load platform data for ${e}:`,s),null}}async loadThemeData(e){const r=`theme-${e}`;if(this.loadingPromises.has(r))return this.loadingPromises.get(r);if(this.isDataFresh(r)){const s=this.getCachedData(r);if(s)return console.log(`[DataAggregationService] Using cached theme data for ${e}`),s}const n=this.loadThemeDataFromSource(e,r);this.loadingPromises.set(r,n);try{const s=await n;return this.loadingPromises.delete(r),s}catch(s){return this.loadingPromises.delete(r),console.error(`[DataAggregationService] Failed to load theme data for ${e}:`,s),null}}invalidateCache(e,r){if(r){const n=`${e}-${r}`;this.cache.delete(n),console.log(`[DataAggregationService] Invalidated cache for ${n}`)}else Array.from(this.cache.keys()).filter(s=>s.startsWith(`${e}-`)).forEach(s=>this.cache.delete(s)),console.log(`[DataAggregationService] Invalidated all ${e} cache entries`)}isDataFresh(e){const r=this.cache.get(e);return r?Date.now()-r.timestamp<this.CACHE_TTL:!1}getCachedData(e){const r=this.cache.get(e);return r?r.data:null}getCacheStatus(){const e={};for(const[r,n]of this.cache.entries()){const s=Date.now()-n.timestamp;e[r]={fresh:s<this.CACHE_TTL,age:s,source:n.source}}return e}clearCache(){this.cache.clear(),console.log("[DataAggregationService] Cleared all cache")}isLoading(e){return this.loadingPromises.has(e)}async loadPlatformDataFromSource(e,r){var n;try{console.log(`[DataAggregationService] Loading platform data for ${e}`);const s=L.getMergedData(),i=(n=s==null?void 0:s.platforms)==null?void 0:n.find(u=>u.id===e);if(!(i!=null&&i.extensionSource))return console.warn(`[DataAggregationService] No extension source found for platform ${e}`),null;const{repositoryUri:a,filePath:l}=i.extensionSource;let c;try{if(Yt.isAuthenticated())c=await xt.getFileContent(a,l,"main");else throw new Error("User not authenticated, trying public access")}catch{console.log(`[DataAggregationService] Platform authenticated access failed, trying public access for ${e}`),c=await xt.getPublicFileContent(a,l,"main")}if(!c)return console.warn(`[DataAggregationService] No file content found for platform ${e}`),null;const d=JSON.parse(c.content);return this.cache.set(r,{data:d,timestamp:Date.now(),source:`github:${a}/${l}`}),console.log(`[DataAggregationService] Successfully loaded platform data for ${e}`),d}catch(s){return console.error(`[DataAggregationService] Error loading platform data for ${e}:`,s),null}}async loadThemeDataFromSource(e,r){var n;try{console.log(`[DataAggregationService] Loading theme data for ${e}`);const s=L.getMergedData(),i=(n=s==null?void 0:s.themes)==null?void 0:n.find(u=>u.id===e);if(!(i!=null&&i.overrideSource))return console.warn(`[DataAggregationService] No override source found for theme ${e}`),null;const{repositoryUri:a,filePath:l}=i.overrideSource;let c;try{if(Yt.isAuthenticated())c=await xt.getFileContent(a,l,"main");else throw new Error("User not authenticated, trying public access")}catch{console.log(`[DataAggregationService] Theme authenticated access failed, trying public access for ${e}`),c=await xt.getPublicFileContent(a,l,"main")}if(!c)return console.warn(`[DataAggregationService] No file content found for theme ${e}`),null;const d=JSON.parse(c.content);return this.cache.set(r,{data:d,timestamp:Date.now(),source:`github:${a}/${l}`}),console.log(`[DataAggregationService] Successfully loaded theme data for ${e}`),d}catch(s){return console.error(`[DataAggregationService] Error loading theme data for ${e}:`,s),null}}};rt(Ca,"instance");let jf=Ca;class L$ extends X0{constructor(){super("CirclePackTransformer");rt(this,"dataAggregationService");this.dataAggregationService=jf.getInstance()}async transformData(r,n){var s,i,a;try{if(this.logProgress("Starting circle pack transformation"),!this.validateInput(r))throw new Error("Invalid token system input");this.logProgress("Building system hierarchy",{tokenCount:((s=r.tokens)==null?void 0:s.length)||0,platformCount:((i=r.platforms)==null?void 0:i.length)||0,themeCount:((a=r.themes)==null?void 0:a.length)||0});const l=await this.buildSystemNode(r),c=this.calculateStatistics(l),d=this.dataAggregationService.getCacheStatus(),u={data:l,statistics:c,metadata:{generatedAt:new Date().toISOString(),dataSources:["core","platforms","themes"],cacheStatus:Object.fromEntries(Object.entries(d).map(([m,g])=>[m,g.fresh?"fresh":"stale"]))}};return this.logProgress("Circle pack transformation completed",{totalNodes:c.totalNodes,maxDepth:c.maxDepth}),u}catch(l){throw console.error("[CirclePackTransformer] Error during transformation:",l),l}}async buildSystemNode(r){const n=[],s=this.buildCoreDataNode(r);s.hasChildren&&n.push(s);const i=await this.buildPlatformsNode(r);i.hasChildren&&n.push(i);const a=await this.buildThemesNode(r);return a.hasChildren&&n.push(a),{name:"Design System",children:n,type:"system",value:n.length,hasChildren:n.length>0}}buildCoreDataNode(r){const n=[];return r.tokens&&r.tokens.length>0&&n.push({name:"Tokens",type:"entity",entityType:"tokens",value:r.tokens.length,hasChildren:r.tokens.length>0,dataSource:"core",children:r.tokens.map(s=>({name:s.displayName||`Token ${s.id}`,type:"token",tokenId:s.id,value:1,hasChildren:!1,dataSource:"core"}))}),r.tokenCollections&&r.tokenCollections.length>0&&n.push({name:"Collections",type:"entity",entityType:"collections",value:r.tokenCollections.length,hasChildren:r.tokenCollections.length>0,dataSource:"core",children:r.tokenCollections.map(s=>({name:s.name||`Collection ${s.id}`,type:"collection",collectionId:s.id,value:1,hasChildren:!1,dataSource:"core"}))}),r.dimensions&&r.dimensions.length>0&&n.push({name:"Dimensions",type:"entity",entityType:"dimensions",value:r.dimensions.length,hasChildren:r.dimensions.length>0,dataSource:"core",children:r.dimensions.map(s=>{var i,a;return{name:s.displayName||`Dimension ${s.id}`,type:"dimension",dimensionId:s.id,value:((i=s.modes)==null?void 0:i.length)||0,hasChildren:s.modes&&s.modes.length>0||!1,dataSource:"core",children:((a=s.modes)==null?void 0:a.map(l=>({name:l.name||`Mode ${l.id}`,type:"mode",modeId:l.id,value:1,hasChildren:!1,dataSource:"core"})))||[]}})}),r.taxonomies&&r.taxonomies.length>0&&n.push({name:"Taxonomies",type:"entity",entityType:"taxonomies",value:r.taxonomies.length,hasChildren:r.taxonomies.length>0,dataSource:"core",children:r.taxonomies.map(s=>{var i,a;return{name:s.name||`Taxonomy ${s.id}`,type:"taxonomy",taxonomyId:s.id,value:((i=s.terms)==null?void 0:i.length)||0,hasChildren:s.terms&&s.terms.length>0||!1,dataSource:"core",children:((a=s.terms)==null?void 0:a.map(l=>({name:l.name||`Term ${l.id}`,type:"term",termId:l.id,value:1,hasChildren:!1,dataSource:"core"})))||[]}})}),r.components&&r.components.length>0&&n.push({name:"Components",type:"entity",entityType:"components",value:r.components.length,hasChildren:r.components.length>0,dataSource:"core",children:r.components.map(s=>({name:s.name||`Component ${s.id}`,type:"component",componentId:s.id,value:1,hasChildren:!1,dataSource:"core"}))}),r.componentCategories&&r.componentCategories.length>0&&n.push({name:"Component Categories",type:"entity",entityType:"componentCategories",value:r.componentCategories.length,hasChildren:r.componentCategories.length>0,dataSource:"core",children:r.componentCategories.map(s=>({name:s.name||`Category ${s.id}`,type:"componentCategory",categoryId:s.id,value:1,hasChildren:!1,dataSource:"core"}))}),r.componentProperties&&r.componentProperties.length>0&&n.push({name:"Component Properties",type:"entity",entityType:"componentProperties",value:r.componentProperties.length,hasChildren:r.componentProperties.length>0,dataSource:"core",children:r.componentProperties.map(s=>({name:s.name||`Property ${s.id}`,type:"componentProperty",propertyId:s.id,value:1,hasChildren:!1,dataSource:"core"}))}),r.resolvedValueTypes&&r.resolvedValueTypes.length>0&&n.push({name:"Value Types",type:"entity",entityType:"resolvedValueTypes",value:r.resolvedValueTypes.length,hasChildren:r.resolvedValueTypes.length>0,dataSource:"core",children:r.resolvedValueTypes.map(s=>({name:s.name||`Value Type ${s.id}`,type:"valueType",valueTypeId:s.id,value:1,hasChildren:!1,dataSource:"core"}))}),r.standardPropertyTypes&&r.standardPropertyTypes.length>0&&n.push({name:"Standard Property Types",type:"entity",entityType:"standardPropertyTypes",value:r.standardPropertyTypes.length,hasChildren:r.standardPropertyTypes.length>0,dataSource:"core",children:r.standardPropertyTypes.map(s=>({name:s.name||`Property Type ${s.id}`,type:"standardPropertyType",propertyTypeId:s.id,value:1,hasChildren:!1,dataSource:"core"}))}),r.propertyTypes&&r.propertyTypes.length>0&&n.push({name:"Custom Property Types",type:"entity",entityType:"propertyTypes",value:r.propertyTypes.length,hasChildren:r.propertyTypes.length>0,dataSource:"core",children:r.propertyTypes.map(s=>({name:s.name||`Property Type ${s.id}`,type:"customPropertyType",propertyTypeId:s.id,value:1,hasChildren:!1,dataSource:"core"}))}),r.algorithms&&r.algorithms.length>0&&n.push({name:"Algorithms",type:"entity",entityType:"algorithms",value:r.algorithms.length,hasChildren:r.algorithms.length>0,dataSource:"core",children:r.algorithms.map(s=>({name:s.name||`Algorithm ${s.id}`,type:"algorithm",algorithmId:s.id,value:1,hasChildren:!1,dataSource:"core"}))}),{name:"Core Data",children:n,type:"core",value:n.length,hasChildren:n.length>0,dataSource:"core"}}async buildPlatformsNode(r){const n=[];if(r.platforms)for(const s of r.platforms)try{const i=await this.loadPlatformData(s.id);i?n.push(i):n.push({name:s.displayName||s.id,type:"platform",platformId:s.id,value:1,hasChildren:!1,dataSource:"platform",error:"No data found"})}catch(i){console.error(`[CirclePackTransformer] Error loading platform data for ${s.id}:`,i),n.push({name:s.displayName||s.id,type:"platform",platformId:s.id,value:1,hasChildren:!1,dataSource:"platform",error:"Failed to load data"})}return{name:"Platforms",children:n,type:"platform",value:n.length,hasChildren:n.length>0,dataSource:"platform"}}async buildThemesNode(r){const n=[];if(r.themes)for(const s of r.themes)try{const i=await this.loadThemeData(s.id,r.tokens);i?n.push(i):n.push({name:s.displayName||s.id,type:"theme",themeId:s.id,value:1,hasChildren:!1,dataSource:"theme",error:"No data found"})}catch(i){console.error(`[CirclePackTransformer] Error loading theme data for ${s.id}:`,i),n.push({name:s.displayName||s.id,type:"theme",themeId:s.id,value:1,hasChildren:!1,dataSource:"theme",error:"Failed to load data"})}return{name:"Themes",children:n,type:"theme",value:n.length,hasChildren:n.length>0,dataSource:"theme"}}async loadPlatformData(r){try{const n=await this.dataAggregationService.loadPlatformData(r);if(!n)return null;const s=[];return n.tokenOverrides&&n.tokenOverrides.length>0&&s.push({name:"Token Overrides",type:"entity",entityType:"tokenOverrides",value:n.tokenOverrides.length,hasChildren:n.tokenOverrides.length>0,dataSource:"platform",children:n.tokenOverrides.map(i=>({name:i.displayName||i.id,type:"tokenOverride",tokenId:i.id,value:1,hasChildren:!1,dataSource:"platform"}))}),n.algorithmVariableOverrides&&n.algorithmVariableOverrides.length>0&&s.push({name:"Algorithm Overrides",type:"entity",entityType:"algorithmVariableOverrides",value:n.algorithmVariableOverrides.length,hasChildren:n.algorithmVariableOverrides.length>0,dataSource:"platform"}),n.componentImplementations&&n.componentImplementations.length>0&&s.push({name:"Component Implementations",type:"entity",entityType:"componentImplementations",value:n.componentImplementations.length,hasChildren:n.componentImplementations.length>0,dataSource:"platform"}),{name:n.platformName||n.platformId||"Platform",children:s,type:"platform",platformId:n.platformId,value:s.length,hasChildren:s.length>0,dataSource:"platform"}}catch(n){return console.error(`[CirclePackTransformer] Error loading platform data for ${r}:`,n),null}}async loadThemeData(r,n){try{const s=await this.dataAggregationService.loadThemeData(r);if(!s)return null;const i=[];return s.tokenOverrides&&s.tokenOverrides.length>0&&i.push({name:"Token Overrides",type:"entity",entityType:"tokenOverrides",value:s.tokenOverrides.length,hasChildren:s.tokenOverrides.length>0,dataSource:"theme",children:s.tokenOverrides.map(a=>{const l=n==null?void 0:n.find(d=>d.id===a.tokenId);return{name:(l==null?void 0:l.displayName)||(l==null?void 0:l.name)||a.tokenId,type:"tokenOverride",tokenId:a.tokenId,value:1,hasChildren:!1,dataSource:"theme"}})}),{name:s.themeName||String(s.themeId)||"Theme",children:i,type:"theme",themeId:String(s.themeId),value:i.length,hasChildren:i.length>0,dataSource:"theme"}}catch(s){return console.error(`[CirclePackTransformer] Error loading theme data for ${r}:`,s),null}}calculateStatistics(r){const n=this.flattenNodes(r),s=n.filter(y=>y.type==="entity"&&y.dataSource==="core"),i=n.filter(y=>y.type==="platform"),a=n.filter(y=>y.type==="theme"),l=n.map(y=>y.depth||0),c=Math.max(...l,0),d=l.length>0?l.reduce((y,v)=>y+v,0)/l.length:0,u=n.filter(y=>y.value!==void 0),m=u.length>0?u.reduce((y,v)=>(y.value||0)>(v.value||0)?y:v):null,g=u.length>0?u.reduce((y,v)=>(y.value||0)<(v.value||0)?y:v):null;return{totalNodes:n.length,totalCoreEntities:s.length,totalPlatforms:i.length,totalThemes:a.length,maxDepth:c,averageDepth:d,largestNode:m,smallestNode:g}}flattenNodes(r){const n=[r];if(r.children)for(const s of r.children)n.push(...this.flattenNodes(s));return n}}const ka=class ka{constructor(){rt(this,"transformers",new Map);this.initializeDefaultTransformers()}static getInstance(){return ka.instance||(ka.instance=new ka),ka.instance}async transformMergedData(e,r,n){var a;console.log("[DataTransformationService] Transforming merged data:",{transformType:r,tokenCount:((a=e.tokens)==null?void 0:a.length)||0,hasOptions:!!n});const i=await this.getTransformer(r).transformData(e,n);return console.log("[DataTransformationService] Merge data transformation completed"),i}async transformPlatformData(e,r,n){console.log("[DataTransformationService] Transforming platform data:",{transformType:r,platformId:e.id,hasTokens:!!e.tokens});const s={systemName:e.name,systemId:e.id,version:"1.0.0",versionHistory:[],tokens:e.tokens||[],resolvedValueTypes:e.resolvedValueTypes||[],tokenCollections:e.tokenCollections||[],dimensions:[],platforms:[],taxonomies:[],themes:[]},a=await this.getTransformer(r).transformData(s,n);return console.log("[DataTransformationService] Platform data transformation completed"),a}async transformThemeData(e,r,n){console.log("[DataTransformationService] Transforming theme data:",{transformType:r,themeId:e.id,hasOverrides:!!e.overrides});const s={systemName:e.name,systemId:e.id,version:"1.0.0",versionHistory:[],tokens:Object.values(e.overrides||{}),resolvedValueTypes:[],tokenCollections:[],dimensions:[],platforms:[],taxonomies:[],themes:[]},a=await this.getTransformer(r).transformData(s,n);return console.log("[DataTransformationService] Theme data transformation completed"),a}registerTransformer(e,r){console.log(`[DataTransformationService] Registering transformer for type: ${e}`),this.transformers.set(e,r)}getTransformer(e){const r=this.transformers.get(e);if(!r)throw new Error(`No transformer registered for visualization type: ${e}`);return r}initializeDefaultTransformers(){console.log("[DataTransformationService] Initializing default transformers"),this.registerTransformer("network",new $$),this.registerTransformer("chord",new z$),this.registerTransformer("circlePack",new L$)}getAvailableTypes(){return Array.from(this.transformers.keys())}isTypeSupported(e){return this.transformers.has(e)}clearTransformers(){this.transformers.clear()}getTransformerStats(){return{registeredTypes:Array.from(this.transformers.keys()),totalTransformers:this.transformers.size}}};rt(ka,"instance");let Tf=ka;const B$=()=>{const[t,e]=M.useState(!1),[r,n]=M.useState(null),[s,i]=M.useState(null),[a,l]=M.useState(null),[c,d]=M.useState("force"),[u]=M.useState(!0),[m]=M.useState(!0),[g]=M.useState({hideIsolatedNodes:!1,showOnlyCircular:!1}),y=M.useRef(null),v=M.useRef(null),I=async()=>{var G,ne;try{e(!0),n(null);const he=L.getMergedData();if(!he)throw new Error("No data available for analysis. Please load a design system first.");console.log("[AnalysisView] Loading analysis data:",{tokenCount:((G=he.tokens)==null?void 0:G.length)||0,hasResolvedValueTypes:!!he.resolvedValueTypes});const te=Tf.getInstance(),K=await te.transformMergedData(he,"network",{layout:{type:c,clustering:!0},metadata:{generatedBy:"AnalysisView"}}),O=await te.transformMergedData(he,"circlePack",{metadata:{generatedBy:"AnalysisView"}});i(K),l(O),console.log("[AnalysisView] Analysis data loaded successfully:",{networkNodes:K.nodes.length,networkEdges:K.edges.length,circlePackNodes:((ne=O.data.children)==null?void 0:ne.length)||0,circularDependencies:K.circularDependencies.length})}catch(he){console.error("[AnalysisView] Error loading analysis data:",he),n(he instanceof Error?he.message:"Failed to load analysis data")}finally{e(!1)}};M.useEffect(()=>{I()},[]);const S=s?[{id:"base-tokens",label:"Base Tokens",color:"#48BB78",shape:"circle",count:s.nodes.filter(G=>G.type==="base").length},{id:"alias-tokens",label:"Alias Tokens",color:"#4299E1",shape:"circle",count:s.nodes.filter(G=>G.type==="alias").length},{id:"circular-deps",label:"Circular Dependencies",color:"#F56565",shape:"circle",count:s.nodes.filter(G=>G.hasCircularDependency).length},{id:"direct-deps",label:"Direct Dependencies",color:"#4A5568",shape:"line",count:s.edges.filter(G=>G.type==="direct").length},{id:"circular-edges",label:"Circular References",color:"#F56565",shape:"line",count:s.edges.filter(G=>G.type==="circular").length}]:[],b=()=>{var G;return(G=y.current)==null?void 0:G.zoomIn()},k=()=>{var G;return(G=y.current)==null?void 0:G.zoomOut()},A=()=>{var G;return(G=y.current)==null?void 0:G.resetView()},C=G=>{var ne;d(G),(ne=y.current)==null||ne.changeLayout(G)},T=G=>{var ne;(ne=y.current)==null||ne.exportVisualization(G)},P=G=>{console.log("[AnalysisView] Circle pack node clicked:",G)},_=G=>{console.log("[AnalysisView] Circle pack zoom changed:",G)},R=()=>{if(!s||!m)return null;const G=s.statistics;return o.jsxs(Zn,{children:[o.jsx(ss,{children:o.jsx(Tt,{size:"sm",children:"Dependency Statistics"})}),o.jsxs(Xn,{children:[o.jsxs(Qs,{columns:2,spacing:4,children:[o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Total Tokens"}),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:G.totalTokens})]}),o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Dependencies"}),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:G.totalDependencies})]}),o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Max Depth"}),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:G.maxDependencyDepth})]}),o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Avg Depth"}),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:G.avgDependencyDepth.toFixed(1)})]}),o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Isolated Tokens"}),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:G.isolatedTokens})]}),o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Circular Issues"}),o.jsx(wt,{colorScheme:G.circularDependencies>0?"red":"green",children:G.circularDependencies})]})]}),G.mostReferencedToken&&o.jsxs(z,{mt:4,children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Most Referenced"}),o.jsxs(E,{fontSize:"md",fontWeight:"medium",children:[G.mostReferencedToken.name," (",G.mostReferencedToken.referenceCount," refs)"]})]})]})]})};return t?o.jsx(no,{title:"Analysis",children:o.jsx(Wu,{h:"400px",children:o.jsxs(ce,{spacing:4,children:[o.jsx(kn,{size:"xl",color:"blue.500"}),o.jsx(E,{children:"Analyzing token dependencies..."})]})})}):r?o.jsx(no,{title:"Analysis",children:o.jsxs(zt,{status:"error",children:[o.jsx(Lt,{}),o.jsxs(ce,{align:"start",spacing:2,children:[o.jsx(tn,{fontWeight:"medium",children:r}),o.jsx(Oe,{size:"sm",leftIcon:o.jsx(Hf,{size:16}),onClick:I,colorScheme:"red",variant:"outline",children:"Retry"})]})]})}):o.jsx(no,{title:"Analysis",maxWidth:"100%",children:o.jsxs(Es,{children:[o.jsxs(Ms,{children:[o.jsx(pr,{children:"System"}),o.jsx(pr,{children:"Tokens"}),o.jsx(pr,{children:"Modes"}),o.jsx(pr,{children:"Platforms & Themes"}),o.jsx(pr,{children:"Taxonomies"})]}),o.jsxs(Ls,{children:[o.jsx(Ir,{children:o.jsx(ce,{spacing:6,align:"stretch",children:o.jsxs(Zn,{children:[o.jsxs(ss,{children:[o.jsx(Tt,{size:"md",children:"System Overview"}),o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Interactive visualization of your entire design system ecosystem"})]}),o.jsx(Xn,{children:o.jsxs(le,{align:"start",spacing:6,children:[o.jsx(z,{flex:1,children:o.jsx(Ev,{height:600,children:a&&o.jsx(I5,{ref:v,data:a.data,onNodeClick:P,onZoomChange:_,width:800,height:600,showLabels:!0,showBreadcrumbs:!0,interactive:!0})})}),o.jsx(z,{minW:"250px",children:a&&o.jsxs(Zn,{children:[o.jsx(ss,{children:o.jsx(Tt,{size:"sm",children:"System Statistics"})}),o.jsx(Xn,{children:o.jsx(ce,{spacing:4,align:"stretch",children:o.jsxs(Qs,{columns:1,spacing:3,children:[o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Total Nodes"}),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:a.statistics.totalNodes})]}),o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Core Entities"}),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:a.statistics.totalCoreEntities})]}),o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Platforms"}),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:a.statistics.totalPlatforms})]}),o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Themes"}),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:a.statistics.totalThemes})]}),o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Max Depth"}),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:a.statistics.maxDepth})]}),o.jsxs(z,{children:[o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Avg Depth"}),o.jsx(E,{fontSize:"lg",fontWeight:"bold",children:a.statistics.averageDepth.toFixed(1)})]})]})})})]})})]})})]})})}),o.jsx(Ir,{children:o.jsx(ce,{spacing:6,align:"stretch",children:o.jsxs(Zn,{children:[o.jsxs(ss,{children:[o.jsx(Tt,{size:"md",children:"Token Dependency Network"}),o.jsx(E,{fontSize:"sm",color:"gray.600",children:"Interactive visualization showing token alias relationships and circular dependencies"})]}),o.jsx(Xn,{children:o.jsxs(le,{align:"start",spacing:6,children:[o.jsx(z,{flex:1,children:o.jsx(Ev,{toolbar:o.jsx(_$,{onZoomIn:b,onZoomOut:k,onReset:A,onExport:T,onLayoutChange:C,availableLayouts:["force","hierarchical","circular"],currentLayout:c}),legend:o.jsx(F$,{items:S,title:"Legend"}),height:500,children:s&&o.jsx(w5,{ref:y,data:s,layout:c,showLabels:u,showStatistics:m,width:700,height:500,clustered:!0,filterOptions:g,onNodeClick:G=>{console.log("[AnalysisView] Node clicked:",G)},onNodeHover:()=>{}})})}),o.jsx(z,{minW:"250px",children:R()})]})})]})})})]})]})})},U$=({currentView:t,tokens:e,collections:r,modes:n,dimensions:s,resolvedValueTypes:i,platforms:a,themes:l,taxonomies:c,componentProperties:d,componentCategories:u,components:m,algorithms:g,schema:y,githubUser:v,isViewOnlyMode:I=!1,canEdit:S=!1,dataSourceContext:b,isAppLoading:k=!1,dimensionOrder:A,taxonomyOrder:C,setDimensionOrder:T,setTaxonomyOrder:P,onUpdateTokens:_,onUpdateCollections:R,onUpdateDimensions:G,onUpdateResolvedValueTypes:ne,onUpdatePlatforms:he,onUpdateThemes:te,onUpdateTaxonomies:K,onUpdateComponentProperties:O,onUpdateComponentCategories:Z,onUpdateComponents:ie,onUpdateAlgorithms:ge,selectedToken:xe,isEditorOpen:$,onAddToken:B,onEditToken:U,onCloseEditor:X,onSaveToken:ee,onDeleteToken:be,hasEditPermissions:Se})=>{const Me=S,se=()=>{switch(t){case"dashboard":return o.jsx($y,{tokens:e,platforms:a,themes:l,componentCategories:u,componentProperties:d,components:m,githubUser:v});case"tokens":return o.jsxs(o.Fragment,{children:[o.jsx(BI,{tokens:e,collections:r,resolvedValueTypes:i,modes:n,dimensions:s,taxonomies:c,canEdit:Me,dataSourceContext:b,dimensionOrder:A,renderAddTokenButton:Me?o.jsx(Oe,{colorScheme:"blue",size:"sm",onClick:B,leftIcon:o.jsx(to,{}),children:"Add Token"}):null,onEditToken:Me?U:void 0}),$&&xe&&o.jsx(oN,{token:xe,tokens:e,dimensions:s,modes:n,platforms:a,open:$,onClose:X,onSave:ee,taxonomies:c,resolvedValueTypes:i,isNew:!xe.id,onViewClassifications:()=>{},onDeleteToken:be,collections:r,schema:y,dataSourceContext:b})]});case"system-variables":return o.jsx(GI,{dimensions:s,canEdit:Me});case"foundations":return o.jsx(sM,{canEdit:Me});case"algorithms":return o.jsx(nM,{algorithms:g,onUpdate:ge,onUpdateTokens:_,canEdit:Me});case"analysis":return o.jsx(B$,{});case"dimensions":return o.jsx(RS,{dimensions:s,setDimensions:G,canEdit:Me});case"classification":return o.jsx(OS,{taxonomies:c,setTaxonomies:K,tokens:e,collections:r,dimensions:s,platforms:a,resolvedValueTypes:i,canEdit:Me});case"value-types":return o.jsx(VS,{valueTypes:i,onUpdate:ne,tokens:e,collections:r,dimensions:s,platforms:a,taxonomies:c,themes:l,canEdit:Me});case"collections":return o.jsx(A4,{collections:r,onUpdate:R,tokens:e,resolvedValueTypes:i,canEdit:Me});case"themes":return o.jsx(DM,{themes:l,setThemes:te,canEdit:Me});case"platforms":return o.jsx(zM,{platforms:a,setPlatforms:he,canEdit:Me});case"figma-settings":{const de=()=>{const fe=b;if((fe==null?void 0:fe.currentPlatform)===null&&(fe==null?void 0:fe.currentTheme)===null){const _e=L.getCoreData();if(!_e)return Sl();if(!_e.dimensionOrder||_e.dimensionOrder.length===0){const Y=L.getDimensionOrder();Y&&Y.length>0&&(_e.dimensionOrder=Y)}return _e}else return Sl()};return o.jsx(bN,{tokenSystem:de(),canEdit:Me,dataSourceContext:b,hasEditPermissions:Se})}case"validation":return o.jsx(BM,{tokens:e,collections:r,dimensions:s,platforms:a,taxonomies:c,version:"1.0.0",versionHistory:[],onValidate:()=>{}});case"schemas":return o.jsx(hR,{});case"system":return o.jsx(qM,{canEdit:Me});case"components":return o.jsx(fR,{components:m,setComponents:ie,componentCategories:u,componentProperties:d,canEdit:Me});default:return o.jsx($y,{tokens:e,platforms:a,themes:l,componentCategories:u,componentProperties:d,components:m,githubUser:v})}};return o.jsx(PI,{isLoading:k,children:se()})},G$=()=>{console.log("ðŸ” [App] App component rendering");const{colorMode:t}=Vt(),{schema:e}=EC();console.log("ðŸ” [App] Current color mode:",t);const[r,n]=M.useState([]),[s,i]=M.useState([]),[a,l]=M.useState([]),[c,d]=M.useState([]),[u,m]=M.useState([]),[g,y]=M.useState([]),[v,I]=M.useState([]),[S,b]=M.useState([]),[k,A]=M.useState([]),[C,T]=M.useState([]),[P,_]=M.useState([]),[R,G]=M.useState([]),[ne,he]=M.useState(!0),[te,K]=M.useState([]),[O,Z]=M.useState(()=>{const Re=L.getDimensionOrder();return Re&&Array.isArray(Re)&&Re.length>0?Re:a.map(Ge=>Ge.id)}),[ie,ge]=M.useState(null),[xe,$]=M.useState(!1),[B,U]=M.useState(!1),[X,ee]=M.useState(null),[be,Se]=M.useState(null),[Me,se]=M.useState(!1),[de,fe]=M.useState(void 0),[_e,Y]=M.useState(!1),[Ce,ue]=M.useState(!1),[Ee,ze]=M.useState("main"),[De,Ke]=M.useState(!1),[ve,Te]=M.useState(null),je=Hr(),[Fe,Ue]=M.useState({currentData:{},baselineData:null}),[Je,ut]=M.useState([]),Ze=M.useRef({isConnected:!1,user:null}),[At,gr]=M.useState(!1),{currentView:vr,navigateToView:yr}=MC();M.useEffect(()=>{const Re=localStorage.getItem("token-model-edit-mode");if(Re)try{const{isEditMode:Ge,branch:q}=JSON.parse(Re);Ge&&q===Ee?(Ke(!0),Te(q)):(Ke(!1),Te(null))}catch(Ge){console.warn("Failed to parse saved edit mode state:",Ge),Ke(!1),Te(null)}else Ke(!1),Te(null)},[Ee]),M.useEffect(()=>{if(De&&de){const Ge=go.getPendingOverrides().map(q=>{const bt=u.find(pe=>pe.id===q.tokenId);return{tokenId:q.tokenId,tokenName:(bt==null?void 0:bt.displayName)||q.tokenId,overrideType:q.sourceType==="platform-extension"?"platform":"theme",overrideSource:q.sourceId}});ut(Ge)}else ut([])},[De,de,u]);const gt=()=>{const Ge=new URLSearchParams(window.location.search).get("repo")!==null,bt=Un.getInstance().hasExistingData(),pe=xt.hasSelectedRepository();return!Ge&&!bt&&!pe},Dt=M.useCallback(()=>{const Ge=$a.getInstance().getCurrentData(),q={};return Ge.platformExtensions.forEach((bt,pe)=>{q[pe]=bt}),{collections:L.getCollections(),modes:L.getModes(),dimensions:L.getDimensions(),resolvedValueTypes:L.getValueTypes(),platforms:L.getPlatforms(),themes:L.getThemes(),tokens:L.getTokens(),taxonomies:L.getTaxonomies(),componentProperties:L.getComponentProperties(),componentCategories:L.getComponentCategories(),components:L.getComponents(),algorithms:L.getAlgorithms(),taxonomyOrder:L.getTaxonomyOrder(),dimensionOrder:L.getDimensionOrder(),algorithmFile:L.getAlgorithmFile(),platformExtensions:q}},[]),Ct=M.useCallback(()=>{const Re=Dt(),q=Gn.getBaselineDataSnapshot()||Re;Ue({currentData:Re,baselineData:q})},[Dt]);M.useEffect(()=>{(async()=>{var Ge,q,bt,pe,me;try{const ke=Un.getInstance(),qe={onDataLoaded:dt=>{console.log("[App] Data loaded via DataManager:",{tokens:dt.tokens.length,collections:dt.collections.length,dimensions:dt.dimensions.length}),n(dt.collections),i(dt.modes),l(dt.dimensions),d(dt.resolvedValueTypes),y(dt.platforms),I(dt.themes),m(dt.tokens),b(dt.taxonomies),A(dt.componentProperties),T(dt.componentCategories),_(dt.components),G(dt.algorithms),K(dt.taxonomyOrder),Z(dt.dimensionOrder),console.log("[App] Calling collectAndStoreSyntaxPatterns after data loaded"),gc.getInstance().collectAndStoreSyntaxPatterns().then(()=>{console.log("[App] âœ… Successfully collected syntax patterns at app load")}).catch(tr=>{console.error("[App] âŒ Error collecting syntax patterns at app load:",tr)}),Ct(),he(!1),Y(!1)},onDataChanged:dt=>{n(dt.collections),i(dt.modes),l(dt.dimensions),d(dt.resolvedValueTypes),y(dt.platforms),I(dt.themes),m(dt.tokens),b(dt.taxonomies),A(dt.componentProperties),T(dt.componentCategories),_(dt.components),G(dt.algorithms),K(dt.taxonomyOrder),Z(dt.dimensionOrder)},onBaselineUpdated:dt=>{const tr=dt;Ue({currentData:tr,baselineData:tr})}},nt=xr.getInstance();nt.setCallbacks({onDataSourceChanged:async dt=>{var ln,dr;console.log("[App] Data source changed, updating UI state:",dt);const tr=De,rr=ve;fe(dt);const _t=L.getMergedData();if(_t){console.log("[App] Updating UI state with merged data:",{tokens:((ln=_t.tokens)==null?void 0:ln.length)||0,collections:((dr=_t.tokenCollections)==null?void 0:dr.length)||0}),m(_t.tokens||[]),n(_t.tokenCollections||[]),i(L.getModes()),l(_t.dimensions||[]),d(_t.resolvedValueTypes||[]),y(_t.platforms||[]),I(_t.themes||[]),b(_t.taxonomies||[]),A(_t.componentProperties||[]),T(_t.componentCategories||[]),_(_t.components||[]),G([]),K(_t.taxonomyOrder||[]),Z(_t.dimensionOrder||[]);const xo={collections:_t.tokenCollections||[],modes:L.getModes(),dimensions:_t.dimensions||[],resolvedValueTypes:_t.resolvedValueTypes||[],platforms:_t.platforms||[],themes:_t.themes||[],tokens:_t.tokens||[],taxonomies:_t.taxonomies||[],componentProperties:_t.componentProperties||[],componentCategories:_t.componentCategories||[],components:_t.components||[],algorithms:[],taxonomyOrder:_t.taxonomyOrder||[]};Gn.setBaselineData(xo),Ue({currentData:xo,baselineData:xo}),window.dispatchEvent(new CustomEvent(Dn))}tr&&(console.log("[App] Restoring edit mode state after data source change"),Ke(tr),Te(rr))},onPermissionsChanged:dt=>{console.log("[App] Permissions changed:",dt)},onError:dt=>{console.error("[App] DataSourceManager error:",dt),je({title:"Data Source Error",description:dt,status:"error",duration:5e3,isClosable:!0})}}),nt.initializeFromURL();const Xe=new URLSearchParams(window.location.search),Mt=Xe.get("repo"),Xt=Xe.get("path")||"schema.json",Ot=Xe.get("branch")||"main",cr=Xe.get("platform"),kr=Xe.get("theme");if(ze(Ot),Ke(!1),Te(null),er(),Mt){if(_e){console.log("[App] Already loading data from URL, skipping duplicate request");return}console.log("[App] Loading from URL parameters using DataLoaderService:",{repo:Mt,path:Xt,branch:Ot,platform:cr,theme:kr}),Y(!0);try{console.log("[App] Clearing caches before loading from URL"),L.clearAll();const dt=xr.getInstance();dt.clear(),Ea.getInstance().clearCache();const rr=Tp.getInstance(),_t=Ma.getInstance();L.migrateExistingData(),console.log("[App] Attempting to load from URL using DataLoaderService...");const ln=await rr.loadFromURL(Xe);if(!ln.success)throw new Error(ln.error||"Failed to load data from URL");const dr=await _t.computeMergedData();if(!dr)throw new Error("Failed to compute merged data");console.log("[App] Successfully loaded from URL using DataLoaderService:",{tokens:((Ge=dr.tokens)==null?void 0:Ge.length)||0,collections:((q=dr.tokenCollections)==null?void 0:q.length)||0,dimensions:((bt=dr.dimensions)==null?void 0:bt.length)||0}),dt.updateRepositoryInfo("core",{fullName:Mt,branch:Ot,filePath:Xt,fileType:"schema"}),Sn.getInstance().updateRepositoryContext({fullName:Mt,branch:Ot,filePath:Xt,fileType:"schema"});const Hi={fullName:Mt,branch:Ot,filePath:Xt,fileType:"schema"};if(Se(Hi),localStorage.setItem("github_selected_repo",JSON.stringify(Hi)),dt.initializeFromURL(),cr&&await dt.switchToPlatform(cr==="none"?null:cr),kr&&await dt.switchToTheme(kr==="none"?null:kr),Yt.getCurrentUser()){const Wi=await xt.hasWriteAccessToRepository(Mt),wh=Ks(Ot);se(!(Wi&&!wh)),await dt.updatePermissions()}else se(!0);const Jn=dt.getCurrentContext();console.log("[App] Setting final dataSourceContext after platform/theme switching:",{currentPlatform:Jn.currentPlatform,currentTheme:Jn.currentTheme,availablePlatforms:Jn.availablePlatforms.length,availableThemes:Jn.availableThemes.length,repositories:{core:(pe=Jn.repositories.core)==null?void 0:pe.fullName,platforms:Object.keys(Jn.repositories.platforms),themes:Object.keys(Jn.repositories.themes)}}),fe(Jn),n(dr.tokenCollections||[]);const di=((me=dr.dimensions)==null?void 0:me.flatMap(Wi=>Wi.modes||[]))||[];i(di),l(dr.dimensions||[]),d(dr.resolvedValueTypes||[]),y(dr.platforms||[]),I(dr.themes||[]),m(dr.tokens||[]),b(dr.taxonomies||[]),A(dr.componentProperties||[]),T(dr.componentCategories||[]),_(dr.components||[]),G([]),K(dr.taxonomyOrder||[]),Z(dr.dimensionOrder||[]),await dt.updateAvailableSources(),he(!1),Y(!1)}catch(dt){console.warn("[App] Failed to load from URL, falling back to default initialization:",dt),he(!1),Y(!1);const tr=dt instanceof Error?dt.message:"Unknown error";console.log("[App] Showing error toast for:",tr),tr.includes("Repository not found")?(console.log('[App] Showing "Repository not found" toast'),je({title:"Repository Not Found",description:`The repository ${Mt} does not exist. Loading default data instead.`,status:"warning",duration:5e3,isClosable:!0})):tr.includes("File not found")?(console.log('[App] Showing "File not found" toast'),je({title:"Repository File Not Found",description:`The file "${Xt}" was not found in ${Mt}. Loading default data instead.`,status:"warning",duration:5e3,isClosable:!0})):tr.includes("Repository is private")?(console.log('[App] Showing "Private repository" toast'),je({title:"Private Repository",description:`The repository ${Mt} is private. Please connect to GitHub to access private repositories. Loading default data instead.`,status:"warning",duration:5e3,isClosable:!0})):(console.log('[App] Showing "General error" toast'),je({title:"URL Loading Failed",description:`Failed to load data from ${Mt}. Loading default data instead.`,status:"warning",duration:5e3,isClosable:!0})),await ke.initialize(qe);const rr=xr.getInstance();await rr.updateAvailableSources();const _t=rr.getCurrentContext();console.log("[App] Setting fallback dataSourceContext:",{currentPlatform:_t.currentPlatform,currentTheme:_t.currentTheme,availablePlatforms:_t.availablePlatforms.length,availableThemes:_t.availableThemes.length}),fe(_t),se(!1),Y(!1)}}else{new URLSearchParams(window.location.search).toString()===""&&(console.log("[App] No URL parameters detected - clearing cache for fresh start"),L.clearAll(),xr.getInstance().clear(),Ea.getInstance().clearCache(),console.log("[App] Cache cleared - loading fresh example data")),await ke.initialize(qe);const rr=xr.getInstance();await rr.updateAvailableSources();const _t=rr.getCurrentContext();console.log("[App] Setting default dataSourceContext:",{currentPlatform:_t.currentPlatform,currentTheme:_t.currentTheme,availablePlatforms:_t.availablePlatforms.length,availableThemes:_t.availableThemes.length}),fe(_t),se(!1),Y(!1)}const or=Yt.getCurrentUser(),xn=xt.getSelectedRepositoryInfo();ee(or),Se(xn)}catch(ke){console.error("[App] Error initializing data manager:",ke),he(!1),Y(!1)}})()},[]),M.useEffect(()=>{const Re=()=>{const ke=Yt.isAuthenticated(),qe=Yt.getCurrentUser(),nt=xt.getSelectedRepositoryInfo();console.log("[App] Checking GitHub connection:",{isConnected:ke,currentUser:qe,repoInfo:nt}),ke!==B&&U(ke),JSON.stringify(qe)!==JSON.stringify(X)&&ee(qe),JSON.stringify(nt)!==JSON.stringify(be)&&Se(nt)};Re();const Ge=setInterval(()=>{const ke=Yt.isAuthenticated(),qe=Yt.getCurrentUser(),nt=ke!==Ze.current.isConnected,Xe=JSON.stringify(qe)!==JSON.stringify(Ze.current.user);(nt||Xe)&&(console.log("[App] Periodic check: GitHub state changed, updating"),Ze.current={isConnected:ke,user:qe},Re())},1e4),q=()=>{console.log("[App] Storage change detected, rechecking GitHub connection"),Re()},bt=()=>{console.log("[App] GitHub file loaded event received"),Re(),Qt()},pe=ke=>{const{hasWriteAccess:qe,repoInfo:nt}=ke.detail;console.log("[App] Permissions checked:",{hasWriteAccess:qe,repoInfo:nt});const Xe=Ks(Ee);se(!(qe&&!Xe)),Se(nt),U(!0);const Xt=Yt.getCurrentUser();ee(Xt),Qt()},me=()=>{console.log("[App] OAuth completion event received"),Re(),Ks(Ee)||se(!1)};return window.addEventListener("storage",q),window.addEventListener("github:file-loaded",bt),window.addEventListener("github:permissions-checked",pe),window.addEventListener("github:oauth-complete",me),()=>{window.removeEventListener("storage",q),window.removeEventListener("github:file-loaded",bt),window.removeEventListener("github:permissions-checked",pe),window.removeEventListener("github:oauth-complete",me),clearInterval(Ge)}},[Ee]),M.useEffect(()=>{},[]),M.useEffect(()=>{if(Ce||gt())return;const Ge=Un.getInstance().hasExistingData(),q=xt.hasSelectedRepository();if(Ge||q){console.log("[App] Found existing data, not loading example data"),ue(!0);const bt=xr.getInstance();bt.updateAvailableSources().catch(me=>{console.error("[App] Failed to update available sources:",me)}),Yt.getCurrentUser()&&bt.updatePermissions().catch(me=>{console.error("[App] Failed to update permissions:",me)}),fe(bt.getCurrentContext()),he(!1)}},[Ce]);const Qt=M.useCallback(()=>{const Ge=Un.getInstance().getPresentationSnapshot();n(Ge.collections),i(Ge.modes),l(Ge.dimensions),d(Ge.resolvedValueTypes),y(Ge.platforms),I(Ge.themes),m(Ge.tokens),b(Ge.taxonomies),A(Ge.componentProperties),T(Ge.componentCategories),_(Ge.components),G(Ge.algorithms),K(Ge.taxonomyOrder),Z(Ge.dimensionOrder);const q={collections:Ge.collections,modes:Ge.modes,dimensions:Ge.dimensions,resolvedValueTypes:Ge.resolvedValueTypes,platforms:Ge.platforms,themes:Ge.themes,tokens:Ge.tokens,taxonomies:Ge.taxonomies,componentProperties:Ge.componentProperties,componentCategories:Ge.componentCategories,components:Ge.components,algorithms:Ge.algorithms,taxonomyOrder:Ge.taxonomyOrder};Gn.setBaselineData(q),Ue({currentData:q,baselineData:q}),window.dispatchEvent(new CustomEvent(Dn))},[]);M.useEffect(()=>(window.refreshAppData=Qt,()=>{delete window.refreshAppData}),[Qt]),M.useEffect(()=>{const Re=()=>{Ct()};return window.addEventListener(Dn,Re),()=>{window.removeEventListener(Dn,Re)}},[Ct]);const Zt=()=>{Un.getInstance().clearAllData(),"caches"in window&&caches.keys().then(Ge=>{Ge.forEach(q=>{caches.delete(q)})}),window.location.reload()},at=async()=>{try{console.log("[App] Initiating GitHub authentication"),Yt.isAuthenticated()&&(console.log("[App] User already authenticated, clearing OAuth state before new auth"),Yt.clearOAuthState()),await Yt.initiateAuth()}catch(Re){console.error("[App] GitHub connection error:",Re),je({title:"GitHub Connection Failed",description:Re instanceof Error?Re.message:"Failed to connect to GitHub. Please try again.",status:"error",duration:5e3,isClosable:!0})}},Q=()=>{Yt.logout(),ee(null),Se(null),U(!1),localStorage.removeItem("github_selected_repo"),je({title:"Signed out",description:"Successfully signed out.",status:"info",duration:3e3,isClosable:!0})},Ae=async(Re,Ge)=>{console.log("[App] handleFileSelected called with:",{fileType:Ge,fileContent:Re}),Y(!0);try{console.log("[App] Clearing caches before loading new source"),L.clearSchemaData(),xr.getInstance().clear(),Ea.getInstance().clearCache(),await Un.getInstance().loadFromGitHub(Re,Ge),Qt(),je({title:"Data Loaded",description:`Successfully loaded ${Ge==="schema"?"core data":"theme override"} from GitHub`,status:"success",duration:3e3,isClosable:!0})}catch(q){console.error("[App] Error loading file data:",q),je({title:"Error Loading Data",description:"Failed to load data from GitHub. Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{Y(!1)}},oe=async(Re=!1)=>{console.log("[App] handleRefreshCurrentData called"),Y(!0);try{await yc.refreshForManualRefresh(),Re||je({title:"Data Refreshed",description:"Successfully refreshed data from GitHub",status:"success",duration:3e3,isClosable:!0})}catch(Ge){console.error("[App] Error refreshing data:",Ge),je({title:"Refresh Failed",description:Ge instanceof Error?Ge.message:"Failed to refresh data from GitHub",status:"error",duration:5e3,isClosable:!0})}finally{Y(!1)}},Ne=()=>{ge({id:"",displayName:"",description:"",tokenCollectionId:"",resolvedValueTypeId:"color",propertyTypes:[],private:!1,themeable:!1,status:"experimental",tokenTier:"PRIMITIVE",generatedByAlgorithm:!1,taxonomies:[],valuesByMode:[]}),$(!0)},st=()=>{$(!1),ge(null)},tt=Re=>{console.log("[App] handleSaveToken called with token:",Re),m(Ge=>{console.log("[App] Previous tokens:",Ge);let q;const bt=Ge.findIndex(pe=>pe.id===Re.id);return bt!==-1?(console.log("[App] Updating existing token at index:",bt),q=Ge.map(pe=>pe.id===Re.id?Re:pe)):(console.log("[App] Adding new token with ID:",Re.id),q=[...Ge,Re]),console.log("[App] Updated tokens:",q),L.updateLocalEditsTokens(q),Ct(),window.dispatchEvent(new CustomEvent(Dn)),q}),je({title:"Token saved",description:`Token "${Re.displayName}" has been saved successfully`,status:"success",duration:3e3,isClosable:!0}),st()},Ie=Re=>{const Ge=u.find(q=>q.id===Re);m(q=>{const bt=q.filter(pe=>pe.id!==Re);return L.updateLocalEditsTokens(bt),Ct(),window.dispatchEvent(new CustomEvent(Dn)),bt}),Ge&&je({title:"Token deleted",description:`Token "${Ge.displayName}" has been deleted`,status:"info",duration:3e3,isClosable:!0})},We=Re=>{m(Re),L.updateLocalEditsTokens(Re),Ct(),window.dispatchEvent(new CustomEvent(Dn))},lt=Re=>{n(Re),L.updateLocalEditsCollections(Re),Ct(),window.dispatchEvent(new CustomEvent(Dn))},Et=Re=>{l(Re),L.updateLocalEditsDimensions(Re),Ct(),window.dispatchEvent(new CustomEvent(Dn))},et=Re=>{d(Re),L.updateLocalEditsValueTypes(Re),Ct(),window.dispatchEvent(new CustomEvent(Dn))},pt=Re=>{y(Re),L.setPlatforms(Re);const Ge=xr.getInstance();Ge.updateAvailableSources().catch(q=>{console.error("[App] Failed to update available sources:",q)}),Yt.getCurrentUser()&&Ge.updatePermissions(),Ct(),window.dispatchEvent(new CustomEvent(Dn))},Wt=Re=>{I(Re),L.setThemes(Re);const Ge=xr.getInstance();Ge.updateAvailableSources().catch(q=>{console.error("[App] Failed to update available sources:",q)}),Yt.getCurrentUser()&&Ge.updatePermissions(),Ct(),window.dispatchEvent(new CustomEvent(Dn))},In=Re=>{console.log("[App] handleUpdateTaxonomies called with:",{updatedTaxonomiesCount:Re.length,updatedTaxonomies:Re.map(Ge=>({id:Ge.id,name:Ge.name})),currentTaxonomiesCount:S.length,currentTaxonomies:S.map(Ge=>({id:Ge.id,name:Ge.name}))}),b(Re),L.setTaxonomies(Re),console.log("[App] State updated and saved to StorageService"),Ct(),window.dispatchEvent(new CustomEvent(Dn))},Mn=Re=>{A(Re),L.setComponentProperties(Re),Ct(),window.dispatchEvent(new CustomEvent(Dn))},An=Re=>{T(Re),L.setComponentCategories(Re),Ct(),window.dispatchEvent(new CustomEvent(Dn))},ts=Re=>{_(Re),L.setComponents(Re),Ct(),window.dispatchEvent(new CustomEvent(Dn))},jn=Re=>{G(Re),L.setAlgorithms(Re),Ct(),window.dispatchEvent(new CustomEvent(Dn))},Be=async(Re,Ge)=>{if(Ks(Ge))return"main";try{return(await xc.loadBranchesForRepository(Re,!0)).find(pe=>pe===Ge)?(console.log(`[App] Found matching branch "${Ge}" in repository "${Re}", using it`),Ge):(console.log(`[App] Branch "${Ge}" not found in repository "${Re}", falling back to main`),"main")}catch(q){return console.warn(`[App] Error checking branches for repository "${Re}", falling back to main:`,q),"main"}},w=async Re=>{var Ge,q,bt,pe,me,ke,qe,nt,Xe,Mt,Xt;Y(!0);try{const Ot=new URL(window.location.href);Re?Ot.searchParams.set("platform",Re):Ot.searchParams.delete("platform"),window.history.replaceState({},"",Ot.toString());let cr=Ee;if(Re&&!Ks(Ee)){const tr=L.getCoreData(),rr=(Ge=tr==null?void 0:tr.platforms)==null?void 0:Ge.find(ln=>ln.id===Re),_t=(q=rr==null?void 0:rr.extensionSource)==null?void 0:q.repositoryUri;if(_t){cr=await Be(_t,Ee);const ln=new URL(window.location.href);ln.searchParams.set("branch",cr),window.history.replaceState({},"",ln.toString()),console.log(`[App] Platform switch: Selected branch "${cr}" for repository "${_t}"`)}}else if(!Re&&!Ks(Ee)){const rr=new URLSearchParams(window.location.search).get("repo");if(rr){cr=await Be(rr,Ee);const _t=new URL(window.location.href);_t.searchParams.set("branch",cr),window.history.replaceState({},"",_t.toString()),console.log(`[App] Platform switch to core: Selected branch "${cr}" for repository "${rr}"`)}}const kr=xr.getInstance();await kr.switchToPlatform(Re);const or=kr.getCurrentContext();fe(or);const dt=await Ma.getInstance().computeMergedData();if(dt){n(dt.tokenCollections||[]);const tr=((bt=dt.dimensions)==null?void 0:bt.flatMap(rr=>rr.modes||[]))||[];i(tr),l(dt.dimensions||[]),d(dt.resolvedValueTypes||[]),y(dt.platforms||[]),I(dt.themes||[]),m(dt.tokens||[]),b(dt.taxonomies||[]),A(dt.componentProperties||[]),T(dt.componentCategories||[]),_(dt.components||[]),G([]),K(dt.taxonomyOrder||[]),Z(dt.dimensionOrder||[]),L.setPlatforms(dt.platforms||[]),L.setThemes(dt.themes||[]),cr!==Ee&&(ze(cr),console.log(`[App] Platform switch: Updated current branch from "${Ee}" to "${cr}"`),console.log("[App] Platform switch: Refreshing data to load from new branch"),Qt()),console.log("[App] Platform change completed - UI data updated:",{tokens:((pe=dt.tokens)==null?void 0:pe.length)||0,collections:((me=dt.tokenCollections)==null?void 0:me.length)||0,dimensions:((ke=dt.dimensions)==null?void 0:ke.length)||0,selectedBranch:cr})}if(X){await kr.forceRefreshPermissions();const tr=kr.getCurrentContext();let rr=!1;Re?rr=((nt=(qe=tr.permissions)==null?void 0:qe.platforms)==null?void 0:nt[Re])||!1:tr.currentTheme&&tr.currentTheme!=="none"?rr=((Mt=(Xe=tr.permissions)==null?void 0:Xe.themes)==null?void 0:Mt[tr.currentTheme])||!1:rr=((Xt=tr.permissions)==null?void 0:Xt.core)||!1;const _t=Ks(Ee),ln=rr;se(!(rr&&!_t))}Ct()}catch(Ot){je({title:"Error switching platform",description:Ot instanceof Error?Ot.message:"Unknown error",status:"error",duration:3e3,isClosable:!0})}finally{Y(!1)}},N=async Re=>{var Ge,q,bt,pe,me,ke,qe,nt,Xe,Mt,Xt;Y(!0);try{const Ot=new URL(window.location.href);Re?Ot.searchParams.set("theme",Re):Ot.searchParams.delete("theme"),window.history.replaceState({},"",Ot.toString());let cr=Ee;if(Re&&!Ks(Ee)){const tr=L.getCoreData(),rr=(Ge=tr==null?void 0:tr.themes)==null?void 0:Ge.find(ln=>ln.id===Re),_t=(q=rr==null?void 0:rr.overrideSource)==null?void 0:q.repositoryUri;if(_t){cr=await Be(_t,Ee);const ln=new URL(window.location.href);ln.searchParams.set("branch",cr),window.history.replaceState({},"",ln.toString()),console.log(`[App] Theme switch: Selected branch "${cr}" for repository "${_t}"`)}}else if(!Re&&!Ks(Ee)){const rr=new URLSearchParams(window.location.search).get("repo");if(rr){cr=await Be(rr,Ee);const _t=new URL(window.location.href);_t.searchParams.set("branch",cr),window.history.replaceState({},"",_t.toString()),console.log(`[App] Theme switch to core: Selected branch "${cr}" for repository "${rr}"`)}}const kr=xr.getInstance();await kr.switchToTheme(Re);const or=kr.getCurrentContext();fe(or);const dt=await Ma.getInstance().computeMergedData();if(dt){n(dt.tokenCollections||[]);const tr=((bt=dt.dimensions)==null?void 0:bt.flatMap(rr=>rr.modes||[]))||[];i(tr),l(dt.dimensions||[]),d(dt.resolvedValueTypes||[]),y(dt.platforms||[]),I(dt.themes||[]),m(dt.tokens||[]),b(dt.taxonomies||[]),A(dt.componentProperties||[]),T(dt.componentCategories||[]),_(dt.components||[]),G([]),K(dt.taxonomyOrder||[]),Z(dt.dimensionOrder||[]),L.setPlatforms(dt.platforms||[]),L.setThemes(dt.themes||[]),cr!==Ee&&(ze(cr),console.log(`[App] Theme switch: Updated current branch from "${Ee}" to "${cr}"`),console.log("[App] Theme switch: Refreshing data to load from new branch"),Qt()),console.log("[App] Theme change completed - UI data updated:",{tokens:((pe=dt.tokens)==null?void 0:pe.length)||0,collections:((me=dt.tokenCollections)==null?void 0:me.length)||0,dimensions:((ke=dt.dimensions)==null?void 0:ke.length)||0,selectedBranch:cr})}if(X){await kr.forceRefreshPermissions();const tr=kr.getCurrentContext();let rr=!1;Re?rr=((nt=(qe=tr.permissions)==null?void 0:qe.themes)==null?void 0:nt[Re])||!1:tr.currentPlatform&&tr.currentPlatform!=="none"?rr=((Mt=(Xe=tr.permissions)==null?void 0:Xe.platforms)==null?void 0:Mt[tr.currentPlatform])||!1:rr=((Xt=tr.permissions)==null?void 0:Xt.core)||!1;const _t=Ks(Ee),ln=rr;se(!(rr&&!_t))}Ct()}catch(Ot){je({title:"Error switching theme",description:Ot instanceof Error?Ot.message:"Unknown error",status:"error",duration:3e3,isClosable:!0})}finally{Y(!1)}},Le=async(Re,Ge,q)=>{try{console.log("[App] handleBranchCreated called with:",Re,"editMode:",Ge,"repositoryInfo:",q);const bt=ri.getInstance(),pe=bt.getContext();console.log("[App] DataSourceManager current context:",xr.getInstance().getCurrentContext());let me;if(q&&q.fullName)console.log("[App] Using repository info from BranchCreationDialog:",q),me={fullName:q.fullName,branch:"main",filePath:q.filePath,fileType:q.fileType};else if(pe!=null&&pe.repositoryInfo)console.log("[App] Using current source context repository:",pe.repositoryInfo),me={fullName:pe.repositoryInfo.fullName,branch:pe.repositoryInfo.branch,filePath:pe.repositoryInfo.filePath,fileType:pe.repositoryInfo.fileType};else{const Xt=xr.getInstance().getCurrentContext().repositories.core;if(console.log("[App] Using core repository:",Xt),!Xt)throw new Error("No repository context available for branch switching");me={fullName:Xt.fullName,branch:"main",filePath:Xt.filePath,fileType:Xt.fileType}}if(console.log("[App] Final repository context for branch switching:",me),Sn.getInstance().updateRepositoryContext(me),await xc.switchToBranch(me.fullName,Re,!0,{...me,fileType:me.fileType}),pe){const Mt={...pe,repositoryInfo:{...pe.repositoryInfo,branch:Re},editMode:{isActive:Ge||!1,branchName:Re}};bt.setContext(Mt)}const nt=ni.getInstance().getCurrentSourceContext();if(nt){const Mt={...nt,sourceRepository:{...nt.sourceRepository,branch:Re},coreRepository:{...nt.coreRepository,branch:Re}};L.setSourceContext(Mt)}if(Ge){const Mt=me.fileType==="schema"?"core":me.fileType;yu.enterEditMode(Re,Mt),Ke(!0),Te(Re),console.log(`[App] Entered edit mode on branch "${Re}"`)}const Xe=new URL(window.location.href);Xe.searchParams.set("branch",Re),window.history.replaceState({},"",Xe.toString()),console.log(`[App] Updated URL with new branch: ${Re}`),ze(Re),console.log("[App] Branch creation and switching completed successfully")}catch(bt){console.error("[App] Error in handleBranchCreated:",bt),je({title:"Error",description:`Failed to switch to new branch: ${bt instanceof Error?bt.message:"Unknown error"}`,status:"error",duration:5e3,isClosable:!0})}},V=()=>{Ks(Ee)||(Te(Ee),Ke(!0),console.log("[App] Re-checking edit permissions for non-main branch"),xr.getInstance().enterEditMode(),ae(!0,Ee))},ae=(Re,Ge)=>{try{localStorage.setItem("token-model-edit-mode",JSON.stringify({isEditMode:Re,branch:Ge}))}catch(q){console.warn("Failed to save edit mode state:",q)}},er=()=>{try{localStorage.removeItem("token-model-edit-mode")}catch(Re){console.warn("Failed to clear edit mode state:",Re)}},it=async()=>{try{console.log("[App] handleExitEditMode called"),await yu.exitEditMode(!0),Ke(!1),Te(null),je({title:"Edit Mode Exited",description:"Changes discarded and returned to view mode",status:"info",duration:2e3,isClosable:!0})}catch(Re){console.error("Failed to exit edit mode:",Re),je({title:"Error Exiting Edit Mode",description:Re instanceof Error?Re.message:"Failed to exit edit mode",status:"error",duration:3e3,isClosable:!0})}},Ar=async()=>{try{go.clearSession(),await oe(!0),await it()}catch(Re){console.error("Failed to discard changes:",Re),je({title:"Discard Failed",description:Re instanceof Error?Re.message:"Failed to discard changes",status:"error",duration:3e3,isClosable:!0})}},yn=()=>{gr(!1)},kt=Re=>{ge(Re),$(!0)},sr=M.useCallback(()=>{var bt;if(!X)return!1;const Ge=ni.getInstance().getCurrentSourceContext();return Ge?(bt=Ge.editMode)!=null&&bt.isActive?!0:xr.getInstance().getCurrentEditPermissions():!1},[X]);return ne?o.jsx(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:o.jsx(kn,{})}):o.jsx(Xw,{children:o.jsx(l3,{currentData:{tokens:u,collections:r,modes:s,dimensions:a,resolvedValueTypes:c,platforms:g,themes:v,taxonomies:S,componentProperties:k,componentCategories:C,components:P,algorithms:R,platformExtensions:(()=>{const Ge=$a.getInstance().getCurrentData(),q={};return Ge.platformExtensions.forEach((bt,pe)=>{q[pe]=bt}),q})(),themeOverrides:L.getAllThemeOverrideData()},children:o.jsxs(z,{h:"100vh",display:"flex",flexDirection:"column",children:[o.jsxs(Qw,{children:[o.jsx(hd,{path:"/auth/github/callback",element:o.jsx(Vy,{})}),o.jsx(hd,{path:"/callback",element:o.jsx(Vy,{})}),o.jsx(hd,{path:"/",element:o.jsx(z,{flex:"1",position:"relative",children:gt()?o.jsx(AI,{isGitHubConnected:B,githubUser:X,selectedRepoInfo:be,onGitHubConnect:at,onGitHubDisconnect:Q}):o.jsx(MI,{onResetData:Zt,onExportData:()=>{},isGitHubConnected:B,githubUser:X,selectedRepoInfo:be,onGitHubConnect:at,onGitHubDisconnect:Q,onFileSelected:Ae,onRefreshData:oe,currentView:vr,onNavigate:yr,isViewOnlyMode:Me,urlRepoInfo:Me?(()=>{const Re=new URLSearchParams(window.location.search),Ge=Re.get("repo"),q=Re.get("path"),bt=Re.get("branch");return Ge&&q&&bt?{repo:Ge,path:q,branch:bt}:null})():null,dataSourceContext:de,onPlatformChange:w,onThemeChange:N,isEditMode:De,currentBranch:Ee,editModeBranch:ve,onBranchCreated:Le,onEnterEditMode:V,onExitEditMode:it,editContext:De?(()=>{var nt,Xe;if(!de)return;const{currentPlatform:Re,currentTheme:Ge,availablePlatforms:q,availableThemes:bt}=de,pe=Re&&Re!=="none"?((nt=q.find(Mt=>Mt.id===Re))==null?void 0:nt.displayName)||Re:void 0,me=Ge&&Ge!=="none"?((Xe=bt.find(Mt=>Mt.id===Ge))==null?void 0:Xe.displayName)||Ge:void 0;let ke="core",qe="Core Design System";return Re&&Re!=="none"?(ke="platform-extension",qe=pe||Re):Ge&&Ge!=="none"&&(ke="theme-override",qe=me||Ge),{isEditMode:!0,sourceType:ke,sourceId:Re!=="none"?Re:Ge!=="none"?Ge:null,sourceName:qe}})():void 0,onSaveChanges:void 0,onDiscardChanges:Ar,pendingOverrides:Je,hasEditPermissions:sr,children:o.jsx(U$,{currentView:vr,tokens:u,collections:r,modes:s,dimensions:a,resolvedValueTypes:c,platforms:g,themes:v,taxonomies:S,componentProperties:k,componentCategories:C,components:P,algorithms:R,dimensionOrder:O,taxonomyOrder:te,schema:e,githubUser:X,isViewOnlyMode:Me,dataSourceContext:de,isAppLoading:_e,canEdit:De,hasEditPermissions:sr,onUpdateTokens:We,onUpdateCollections:lt,onUpdateDimensions:Et,onUpdateResolvedValueTypes:et,onUpdatePlatforms:pt,onUpdateThemes:Wt,onUpdateTaxonomies:In,onUpdateComponentProperties:Mn,onUpdateComponentCategories:An,onUpdateComponents:ts,onUpdateAlgorithms:jn,setDimensionOrder:Z,setTaxonomyOrder:K,selectedToken:ie,isEditorOpen:xe,onAddToken:Ne,onEditToken:kt,onCloseEditor:st,onSaveToken:tt,onDeleteToken:Ie})})})}),o.jsx(hd,{path:"*",element:o.jsx("div",{})})]}),o.jsxs(Zr,{isOpen:At,onClose:yn,size:"6xl",children:[o.jsx(Dr,{}),o.jsxs(Xr,{children:[o.jsx(Rr,{children:"Change Log"}),o.jsx(Hn,{}),o.jsx(Or,{pb:6,children:o.jsx(Db,{previousData:Fe.baselineData,currentData:Fe.currentData})})]})]})]})})})};console.log("ðŸ” [Theme] Creating theme configuration");const rc=typeof window<"u"?localStorage.getItem("chakra-ui-color-mode"):null;console.log("ðŸ” [Theme] Stored color mode from HTML script:",rc);const H$=rc==="light"||rc==="dark"||rc==="system"?rc:void 0,j5={initialColorMode:"system",useSystemColorMode:!H$};console.log("ðŸ” [Theme] Theme config:",j5);const Q0=qw({config:j5,styles:{global:t=>({body:{transition:"background-color 0.2s, color 0.2s",bg:t.colorMode==="dark"?"gray.900":"white",color:t.colorMode==="dark"?"white":"gray.900"}})},components:{VStack:{baseStyle:{bg:"transparent"}},Modal:{baseStyle:{dialog:{bg:"chakra-body-bg"}}},Drawer:{baseStyle:{dialog:{bg:"chakra-body-bg"}}},Menu:{baseStyle:{list:{bg:"chakra-body-bg"}}},Popover:{baseStyle:{content:{bg:"chakra-body-bg"}}},Tooltip:{baseStyle:{bg:"chakra-body-bg",color:"chakra-body-text"}}},colors:{gray:{50:"#f7fafc",100:"#edf2f7",200:"#e2e8f0",300:"#cbd5e0",400:"#a0aec0",500:"#718096",600:"#4a5568",700:"#2d3748",800:"#1a202c",900:"#171923"}}});console.log("ðŸ” [Theme] Theme created with config:",Q0.config);console.log("ðŸ” [Main] Starting application initialization");console.log("ðŸ” [Main] Theme config:",Q0.config);if(typeof window<"u"){const t=window.matchMedia("(prefers-color-scheme: dark)");console.log("ðŸ” [Main] Initial media query state:",t.matches?"dark":"light"),t.addEventListener("change",e=>{console.log("ðŸ” [Main] System color scheme changed:",e.matches?"dark":"light")})}const T5=document.getElementById("root");if(!T5)throw new Error("Failed to find the root element");console.log("ðŸ” [Main] Root element found, rendering app");Zm.createRoot(T5).render(o.jsx(nr.StrictMode,{children:o.jsx(Jw,{theme:Q0,children:o.jsx(G$,{})})}));console.log("ðŸ” [Main] App rendered with ChakraProvider");
