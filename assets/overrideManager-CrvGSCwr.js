var p=Object.defineProperty;var u=(o,e,t)=>e in o?p(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var h=(o,e,t)=>u(o,typeof e!="symbol"?e+"":e,t);const a=class a{constructor(){h(this,"tokenThemeableCache",new Map)}static getInstance(){return a.instance||(a.instance=new a),a.instance}createPlatformOverride(e,t,r,i){const n=this.validateOverrideCreation(e,"platform-extension",r);if(!n.isValid)throw new Error(`Cannot create platform override: ${n.errors.join(", ")}`);const s=i==null?void 0:i.tokens.find(l=>l.id===e);if(!s)throw new Error(`Token ${e} not found in core data`);return{systemId:(i==null?void 0:i.systemId)||"design-system",platformId:r,version:"1.0.0",figmaFileKey:`platform-${r}-${Date.now()}`,tokenOverrides:[{id:e,displayName:s.displayName,description:s.description,themeable:s.themeable,private:s.private,tokenTier:s.tokenTier,resolvedValueTypeId:s.resolvedValueTypeId,generatedByAlgorithm:s.generatedByAlgorithm,algorithmId:s.algorithmId,taxonomies:s.taxonomies,propertyTypes:s.propertyTypes,valuesByMode:t.valuesByMode||s.valuesByMode,omit:!1}]}}createThemeOverride(e,t,r,i){if(!this.isTokenThemeable(e,i))throw new Error(`Token ${e} is not themeable and cannot be edited in theme mode`);const n=this.validateOverrideCreation(e,"theme-override",r);if(!n.isValid)throw new Error(`Cannot create theme override: ${n.errors.join(", ")}`);return{systemId:(i==null?void 0:i.systemId)||"design-system",themeId:r,figmaFileKey:`theme-${r}-${Date.now()}`,tokenOverrides:[{tokenId:e,valuesByMode:t.valuesByMode||[]}]}}validateOverrideCreation(e,t,r){const i=[],n=[];return e||i.push("Token ID is required"),r||i.push("Source ID is required"),t==="theme-override"&&(this.isTokenThemeable(e)||i.push(`Token ${e} is not themeable and cannot be edited in theme mode`)),t==="platform-extension"&&e.includes("theme-")&&n.push(`Token ${e} appears to be theme-specific and may not be appropriate for platform override`),{isValid:i.length===0,errors:i,warnings:n}}isTokenThemeable(e,t){if(this.tokenThemeableCache.has(e))return this.tokenThemeableCache.get(e);if(t){const r=t.tokens.find(i=>i.id===e);if(r){const i=r.themeable===!0;return this.tokenThemeableCache.set(e,i),i}}return this.tokenThemeableCache.set(e,!1),!1}getOverridePreview(e,t,r,i,n){const s=n==null?void 0:n.tokens.find(f=>f.id===e),m=s?{...s}:null,l=this.validateOverrideCreation(e,r,i),v=l.isValid;return{tokenId:e,tokenName:(s==null?void 0:s.displayName)||e,originalValue:m,newValue:t,sourceType:r,sourceId:i,willCreateOverride:v,validationResult:l}}clearCache(){this.tokenThemeableCache.clear()}updateCache(e){e.tokens.forEach(t=>{this.tokenThemeableCache.set(t.id,t.themeable===!0)})}};h(a,"instance");let d=a;export{d as OverrideManager};
